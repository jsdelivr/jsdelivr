/*!
 * SharepointPlus v3.13
 * Copyright 2016, Aymeric (@aymkdn)
 * Contact: http://kodono.info
 * Documentation: http://aymkdn.github.com/SharepointPlus/
 * License: GPL-3 (http://aymkdn.github.com/SharepointPlus/license.md)
 */
var SPIsArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},SPArrayIndexOf=function(e,t){"use strict";if(Array.prototype.indexOf)return e.indexOf(t);var r=Object(e),i=r.length>>>0;if(0===i)return-1;var n=0;if(arguments.length>1&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&n!=1/0&&n!=-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var o=n>=0?n:Math.max(i-Math.abs(n),0);i>o;o++)if(o in r&&r[o]===t)return o;return-1},SPArrayForEach=function(e,t,r){"use strict";if(Array.prototype.forEach)return e.forEach(t,r);var i,n;if(null==e)throw new TypeError(" this is null or not defined");var o=Object(e),s=o.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(i=r),n=0;s>n;){var a;n in o&&(a=o[n],t.call(i,a,n,o)),n++}};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),_SP_APPROVED=0,_SP_REJECTED=1,_SP_PENDING=2,_SP_DRAFT=3,_SP_SCHEDULED=4,_SP_CACHE_FORMFIELDS=null,_SP_CACHE_CONTENTTYPES=[],_SP_CACHE_CONTENTTYPE=[],_SP_CACHE_SAVEDVIEW=void 0,_SP_CACHE_SAVEDVIEWS=void 0,_SP_CACHE_SAVEDLISTS=void 0,_SP_CACHE_USERGROUPS=[],_SP_CACHE_GROUPMEMBERS=[],_SP_CACHE_DISTRIBUTIONLISTS=[],_SP_ADD_PROGRESSVAR={},_SP_UPDATE_PROGRESSVAR={},_SP_MODERATE_PROGRESSVAR={},_SP_REMOVE_PROGRESSVAR={},_SP_BASEURL=void 0,_SP_NOTIFY_READY=!1,_SP_NOTIFY_QUEUE=[],_SP_NOTIFY=[],_SP_PLUGINS={},"function"==typeof jQuery&&$(".ms-lookuptypeintextbox").each(function(){for(var e=$(this),t=$("#"+e.attr("optHid")).val(),r=e.attr("choices").split("|"),i='<select id="'+e.attr("id")+'_Lookup" name="'+e.attr("name").replace(/\_/g,"$")+'" data-info="This SELECT has been created by SharepointPlus" title="'+e.attr("title")+'">',n=0;n<r.length;n+=2)i+='<option value="'+r[n+1]+'"'+(r[n+1]==t?' selected="selected"':"")+">"+r[n]+"</option>";i+="</select>",e.closest("span").hide().before(i),$("#"+e.attr("id")+"_Lookup").on("change",function(){var e=$("#"+$(this).attr("id").slice(0,-7)),t=$("#"+e.attr("optHid")),r=$(this).val();t.val(r),e.val($(this).find("option[value='"+("0"!==r?r:"")+"']").text())}).trigger("change")}),function(window,document,undefined){function SharepointPlus(){return this instanceof arguments.callee?void 0:new arguments.callee}var fastMap=function(e,t){for(var r=e.length,i=new Array(r),n=r/8,o=r%8,s=r-1;s>-1;s--){var a=n,l=o;do{switch(l){case 0:i[s]=t(e[s]),s--;case 7:i[s]=t(e[s]),s--;case 6:i[s]=t(e[s]),s--;case 5:i[s]=t(e[s]),s--;case 4:i[s]=t(e[s]),s--;case 3:i[s]=t(e[s]),s--;case 2:i[s]=t(e[s]),s--;case 1:i[s]=t(e[s]),s--}l=0}while(--a>0)}return i};SharepointPlus.prototype={data:[],length:0,listQueue:[],needQueue:!1,getVersion:function(){return"3.13"},decode_b64:function(e,t,r,i,n,o,s){for(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=o=s="";r=e.charAt(s++);~r&&(i=o%4?64*i+r:r,o++%4)?n+=String.fromCharCode(255&i>>(-2*o&6)):0)r=t.indexOf(r);return n},encode_b64:function(e,t,r,i,n,o){for(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="=",i=o="";n&=3,e.charAt(i++)||(t="=",n);o+=t.charAt(63&r>>2*++n))r=r<<8|e.charCodeAt(i-=!n);return o},ajax:function(e){if("undefined"!=typeof jQuery&&jQuery.ajax)fct=jQuery.ajax(e);else{if("undefined"==typeof nanoajax)throw"[SharepointPlus] Fatal Error : No AJAX library has been found... Please use jQuery or nanoajax";var t={"Content-Type":e.contentType||"text/xml; charset=utf-8"};if("function"==typeof e.beforeSend){var r={setRequestHeader:function(e,r){t[e]=r}};e.beforeSend(r)}nanoajax.ajax({url:e.url,method:e.method||"POST",headers:t,body:e.data},function(t,r,i){200===t&&"Error"!==r&&"Abort"!==r&&"Timeout"!==r?e.success(i.responseXML||i.responseText):"function"==typeof e.error&&e.error(i,t,r)})}},list:function(e,t){return this.reset(),t?("/"===t.substring(t.length-1,t.length)&&(t=t.substring(0,t.length-1)),this.url=t):this._getURL(),this.listID=e.replace(/&/g,"&amp;"),this},_getURL:function(e){if(e=e===!1?!1:!0,"undefined"==typeof this.url)if("undefined"!=typeof _SP_BASEURL)this.url=_SP_BASEURL;else if("undefined"!=typeof L_Menu_BaseUrl)this.url=_SP_BASEURL=L_Menu_BaseUrl;else if(_spPageContextInfo&&"undefined"!=typeof _spPageContextInfo.webServerRelativeUrl)this.url=_SP_BASEURL=_spPageContextInfo.webServerRelativeUrl;else{this.needQueue=!0;var t=this,r=t._buildBodyForSOAP("WebUrlFromPageUrl","<pageUrl>"+window.location.href.replace(/&/g,"&amp;")+"</pageUrl>"),i="/_vti_bin/Webs.asmx";t.ajax({type:"POST",cache:!1,async:e,url:i,data:r,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var r=e.getElementsByTagName("WebUrlFromPageUrlResult");r.length&&(t.url=_SP_BASEURL=r[0].firstChild.nodeValue.toLowerCase()),t.needQueue=!1}})}return this},getURL:function(){return"undefined"!=typeof _SP_BASEURL?_SP_BASEURL:(this._getURL(!1),this.url)},_buildBodyForSOAP:function(e,t,r){return r=r||"http://schemas.microsoft.com/sharepoint/soap/",'<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><'+e+' xmlns="'+r+'">'+t+"</"+e+"></soap:Body></soap:Envelope>"},_addInQueue:function(e){return this.listQueue.push(e),1===this.listQueue.length&&this._testQueue(),this},_testQueue:function(){if(this.needQueue){var e=this;setTimeout(function(){e._testQueue.call(e)},25)}else{if(this.listQueue.length>0){var t=this.listQueue.shift();t.callee.apply(this,Array.prototype.slice.call(t))}if(this.needQueue=this.listQueue.length>0,this.needQueue){var e=this;setTimeout(function(){e._testQueue.call(e)},25)}}},parse:function(e,t){var r=e.replace(/(\s+)?(=|~=|<=|>=|<>|<|>| LIKE | IN )(\s+)?/g,"$2").replace(/""|''/g,"Null").replace(/==/g,"="),i=[];t=t===!1?!1:!0;for(var n=e.length,o="",s="",a=!1,l="",u={open:0},c=!1,f=0;f<r.length;f++){var d=r.charAt(f);switch(d){case"(":for(var h=f,p=!1;"("==r.charAt(f)&&n>f;)f++,u.open++;for(;u.open>0&&n>f;){f++;var m=r.charAt(f);"\\"==m?a=!0:a||"'"!=m&&'"'!=m?a||")"!=m||p?a=!1:u.open--:p=!p}var g=i.length-1;g>=0?(""!=o&&(i[0]="<"+o+">"+i[0]),i[0]+=this.parse(r.substring(h+1,f)),""!=o&&(i[0]+="</"+o+">"),o=""):i[0]=this.parse(r.substring(h+1,f));break;case"[":for(var h=f,p=!1;n>f;){f++;var m=r.charAt(f);if("\\"==m)a=!0;else if(a||"'"!=m&&'"'!=m){if(!a&&!p&&"]"==m)break;a=!1}else p=!p}var g=i.length-1;i[g]+='<FieldRef Name="'+l+'" /><Values><Value Type="Text">'+JSON.parse("["+r.substring(h+1,f)+"]").join('</Value><Value Type="Text">')+"</Value></Values>"+s,l="",s="";break;case">":case"<":f++,"="==r.charAt(f)?(i.push("<"+(">"==d?"G":"L")+"eq>"),s="</"+(">"==d?"G":"L")+"eq>"):"<"==d&&">"==r.charAt(f)?(i.push("<Neq>"),s="</Neq>"):(f--,i.push("<"+(">"==d?"G":"L")+"t>"),s="</"+(">"==d?"G":"L")+"t>");break;case"~":"="==r.charAt(f+1)&&(c=!0);break;case"=":i.push("<Eq>"),s="</Eq>";break;case" ":" AND "==r.substring(f,f+5).toUpperCase()?(o="And",f+=4):" OR "==r.substring(f,f+4).toUpperCase()?(o="Or",f+=3):" LIKE "==r.slice(f,f+6).toUpperCase()?(f+=5,i.push("<Contains>"),s="</Contains>"):" IN "==r.slice(f,f+4).toUpperCase()?(f+=3,i.push("<In>"),s="</In>"):l+=d;break;case'"':case"'":for(var y=d,S="",v="";(d=r.charAt(++f))!=y&&n>f;)"\\"==d&&(d=r.charAt(++f)),S+=d;g=i.length-1,i[g]+='<FieldRef Name="'+l+'" '+("[Me]"==S?'LookupId="True" ':"")+"/>",l="";var b="Text";/\d{4}-\d\d?-\d\d?((T| )\d{2}:\d{2}:\d{2})?/.test(S)&&(b="DateTime",/\d{4}-\d\d?-\d\d?((T| )\d{2}:\d{2}:\d{2})/.test(S)&&(v=' IncludeTimeValue="TRUE"')),t&&(S=this._cleanString(S)),"[Me]"===S?(S='<UserID Type="Integer" />',b="Integer"):"[Today"==S.slice(0,6)&&(b="DateTime",S='<Today OffsetDays="'+1*S.slice(6,-1)+'" />'),i[g]+='<Value Type="'+b+'"'+v+">"+S+"</Value>",i[g]+=s,s="",g>0&&(""!=o&&(i[0]="<"+o+">"+i[0]),i[0]+=i[g],""!=o&&(i[0]+="</"+o+">"),delete i[g],o="");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":if(""!=s){for(var _=d;!isNaN(d=r.charAt(++f))&&n>f;)_+=""+d;g=i.length-1,i[g]+='<FieldRef Name="'+l+'"'+(c?' LookupId="True"':"")+" />",l="",i[g]+='<Value Type="'+(c?"Integer":"Number")+'">'+_.replace(/ $/,"")+"</Value>",i[g]+=s,s="",g>0&&(""!=o&&(i[0]="<"+o+">"+i[0]),i[0]+=i[g],""!=o&&(i[0]+="</"+o+">"),delete i[g],o=""),f-=2;break}default:""==s?l+=d:"n"==d.toLowerCase()&&"null"==r.substring(f,f+4).toLowerCase()&&(g=i.length-1,"</Neq>"==s?(i[g]="<IsNotNull>",s="</IsNotNull>"):"</Eq>"==s&&(i[g]="<IsNull>",s="</IsNull>"),f+=3,i[g]+='<FieldRef Name="'+l+'" />',l="",i[g]+=s,s="",g>0&&(""!=o&&(i[0]="<"+o+">"+i[0]),i[0]+=i[g],""!=o&&(i[0]+="</"+o+">"),delete i[g],o=""))}}return i.join("")},_parseOn:function(e){for(var t=[],r=e.replace(/(\s+)?(=)(\s+)?/g,"$2").replace(/==/g,"=").split(" AND "),i=0;i<r.length;i++){var n=r[i].match(/'([^']+)'\.([a-zA-Z0-9_]+)='([^']+)'\.([a-zA-Z0-9_]+)/);if(n&&5==n.length){var o={};o[n[1]]=n[2],o[n[3]]=n[4],t.push(o)}}return t},_cleanString:function(e){return e.replace(/&(?!amp;|lt;|gt;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},cleanResult:function(e,t){return null===e||"undefined"==typeof e?"":(t=t||";","string"==typeof e?e.replace(/;#[0-9]+;#/g,t).replace(/^[0-9]+;#/,"").replace(/^;#|;#$/g,"").replace(/;#/g,t).replace(/^(string;|float;)#?/,""):e)},get:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'get': you have to define the list ID/Name";if(1===arguments.length&&"function"==typeof e)return this.get({},e);if(e=e||{},this.url==undefined)throw"Error 'get': not able to find the URL!";if(e.fields=e.fields||"",e.where=e.where||"",e.whereFct=e.whereFct||function(e){return e},e.orderby=e.orderby||"",e.useIndexForOrderBy=e.useIndexForOrderBy===!0?!0:!1,e.groupby=e.groupby||"",e.rowlimit=e.rowlimit||0,e.whereEscapeChar=e.whereEscapeChar===!1?!1:!0,e.paging=e.paging===!0?!0:!1,e.page=e.paging===!1||isNaN(e.page)?5e3:e.page,e.paging&&0===e.rowlimit&&(e.rowlimit=5e3),e.expandUserField=e.expandUserField===!0||"True"===e.expandUserField?"True":"False",e.dateInUTC=e.dateInUTC===!0?"True":"False",e.folderOptions=e.folderOptions||null,e.view=e.view||"",e.calendar=e.calendar===!0?!0:!1,e.calendar===!0&&(e.calendarOptions=e.calendarOptions||{},e.calendarOptions.referenceDate=e.calendarOptions.referenceDate||new Date,"string"!=typeof e.calendarOptions.referenceDate&&(e.calendarOptions.referenceDate=this.toSPDate(e.calendarOptions.referenceDate)),e.calendarOptions.splitRecurrence=e.calendarOptions.splitRecurrence===!1?"FALSE":"TRUE",e.calendarOptions.range=e.calendarOptions.range||"Month"),e.results=e.results||[],e.listItemCollectionPositionNext=e.listItemCollectionPositionNext||"","object"==typeof e.where?(e.where=e.where.slice(0),e.originalWhere==undefined&&(e.originalWhere=e.where.slice(0)),e.nextWhere=e.where.slice(1),e.where=e.where.shift()):(e.originalWhere=e.where,e.nextWhere=[]),e.progress=e.progress||function(){},""!==e.view){var r=this;return r.view(e.view,function(i,n){e.view=n,e.fields;var o=e.whereCAML?e.where:r.parse(e.where),s=i.whereCAML.match(/^<And>(<DateRangesOverlap>.*<\/DateRangesOverlap>)(.*)<\/And>$/);return s&&3===s.length&&(i.whereCAML="<And>"+s[2]+s[1]+"</And>"),o+=i.whereCAML,""!==e.where&&""!==i.whereCAML&&(o="<And>"+o+"</And>"),e.where=o,e.fields+=(""===e.fields?"":",")+i.fields.join(","),e.orderby+=(""===e.orderby?"":",")+i.orderby,e.whereCAML=!0,e.useOWS=!0,e.calendarViaView=e.calendar,e.calendar=!1,delete e.view,r.get.call(r,e,t)}),this}var i=!0,n="";if(""==e.fields||e.fields==[])n="";else{"string"==typeof e.fields&&(e.fields=e.fields.replace(/^\s+/,"").replace(/\s+$/,"").replace(/( )?,( )?/g,",").split(","));for(var o=0;o<e.fields.length;o++)n+='<FieldRef Name="'+e.fields[o]+'" />'}var s="";if(""!=e.orderby){var a=e.orderby.split(",");for(o=0;o<a.length;o++){var l="ASC",u=a[o].trim().split(" ");u.length>0&&(2==u.length&&(l=u[1].toUpperCase()),s+=i?'<FieldRef Name="'+u[0]+'" Ascending="'+("ASC"==l)+'" />':'<OrderField Name="'+u[0]+'" Direction="'+l+'" />')}}e.calendar!==!0&&e.calendarViaView!==!0||""!==s||(s='<FieldRef Name="EventDate" Ascending="ASC" />');var c="";if(""!=e.groupby){var f=e.groupby.split(",");for(o=0;o<f.length;o++)c+='<FieldRef Name="'+f[o]+'" />'}if(e.calendar===!0||e.calendarViaView===!0){var d=["Title","EventDate","EndDate","Duration","fAllDayEvent","fRecurrence","RecurrenceData","ID"];for(o=0;o<d.length;o++)n+='<FieldRef Name="'+d[o]+'" />'}var h="",p=[];if(e.queryOptions===undefined)if(e._queryOptions="<DateInUtc>"+e.dateInUTC+'</DateInUtc><Paging ListItemCollectionPositionNext="'+e.listItemCollectionPositionNext.replace(/&/g,"&amp;")+'"></Paging><IncludeAttachmentUrls>True</IncludeAttachmentUrls>'+(""===n?"":"<IncludeMandatoryColumns>False</IncludeMandatoryColumns>")+"<ExpandUserField>"+e.expandUserField+"</ExpandUserField>",e.folderOptions){var m;switch(e.folderOptions.show){case"FilesAndFolders_Recursive":m="RecursiveAll";break;case"FilesOnly_InFolder":m="FilesOnly";break;case"FilesAndFolders_InFolder":m="";break;case"FilesOnly_Recursive":default:m="Recursive"}e._queryOptions+='<ViewAttributes Scope="'+m+'"></ViewAttributes>',e.folderOptions.path&&(e._queryOptions+="<Folder>"+this.url+"/"+this.listID+"/"+e.folderOptions.path+"</Folder>")}else e._queryOptions+='<ViewAttributes Scope="Recursive"></ViewAttributes>';else e._queryOptions=e.queryOptions;e.calendarOptions&&(e._queryOptions+="<CalendarDate>"+e.calendarOptions.referenceDate+"</CalendarDate><RecurrencePatternXMLVersion>v3</RecurrencePatternXMLVersion><ExpandRecurrence>"+e.calendarOptions.splitRecurrence+"</ExpandRecurrence>");var g="";if(""!==e.where&&(g=e.whereCAML?e.where:this.parse(e.where)),e.calendar===!0){var y="<DateRangesOverlap><FieldRef Name='EventDate' /><FieldRef Name='EndDate' /><FieldRef Name='RecurrenceID' /><Value Type='DateTime'><"+e.calendarOptions.range+" /></Value></DateRangesOverlap>";g=""!==g?"<And>"+g+y+"</And>":y}g=e.whereFct(g);var r=this;if(i){h="<listName>"+r.listID+"</listName><viewName>"+e.view+"</viewName><query><Query>"+(""!=g?"<Where>"+g+"</Where>":"")+(""!=c?"<GroupBy>"+c+"</GroupBy>":"")+(""!=s?"<OrderBy"+(e.useIndexForOrderBy?" UseIndexForOrderBy='TRUE' Override='TRUE'":"")+">"+s+"</OrderBy>":"")+"</Query></query><viewFields><ViewFields Properties='True'>"+n+"</ViewFields></viewFields><rowLimit>"+e.rowlimit+"</rowLimit><queryOptions><QueryOptions>"+e._queryOptions+"</QueryOptions></queryOptions>",h=r._buildBodyForSOAP("GetListItems",h);var S=r.url+"/_vti_bin/Lists.asmx";r.ajax({type:"POST",cache:!1,async:!0,url:S,data:h,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(i){var n=i.getElementsByTagName("z:row");if(0==n.length&&(n=i.getElementsByTagName("row")),p=fastMap(n,function(e){return myElem(e)}),e.joinData){var o=e.joinData.noindex,s=[],a="",l={length:0};o.length||alert("$SP.get() -- Error 'get': you must define the ON clause with JOIN is used.");for(var u=0,c=p.length;c>u;u++){for(var f="",d=0;d<o.length;d++)f+=p[u].getAttribute(o[d][r.listID]);if(e.joinData[f]){a!==f&&(l[e.joinIndex[f]]=!0,l.length++,a=f);for(var d=0,h=e.joinData[f].length;h>d;d++){for(var m=[],g=p[u].getAttributes(),y=g.length;y--;)m[r.listID+"."+g[y].nodeName.slice(4)]=g[y].nodeValue;var S=e.joinData[f][d].getAttributes();for(var y in S)m[y]=e.joinData[f][d].getAttribute(y);s.push(new extendMyObject(m))}}e.innerjoin&&(e.join=e.innerjoin),e.outerjoin&&(e.join=e.outerjoin,e.join.outer=!0)}if(p=s,e.outer){var v=e.joinIndex.length;if(l.length<v)for(u=0;v>u;u++)if(l[u]!==!0){var b=e.joinIndex[u];if(b===undefined||e.joinData[b]===undefined)continue;for(var d=0,h=e.joinData[b].length;h>d;d++){var m=[],S=e.joinData[b][d].getAttributes();for(var y in S)m[y]=e.joinData[b][d].getAttribute(y);s.push(new extendMyObject(m))}}}}if(e.outerjoin?(e.join=e.outerjoin,e.join.outer=!0):e.innerjoin&&(e.join=e.innerjoin),e.join){var _=[],A=[],o=r._parseOn(e.join.on);_.noindex=o;for(var u=0,c=p.length;c>u;u++){for(var f="",m=[],d=0;d<o.length;d++)f+=p[u].getAttribute(o[d][r.listID])||p[u].getAttribute(r.listID+"."+o[d][r.listID]);if(_[f]||(A[f]=A.length,A.push(f),_[f]=[]),e.joinData)_[f].push(p[u]);else{for(var T=p[u].getAttributes(),d=T.length;d--;)m[r.listID+"."+T[d].nodeName.slice(4)]=T[d].nodeValue;_[f].push(new extendMyObject(m))}}delete e.joinData;var E,w=$SP().list(e.join.list,e.join.url||r.url);e.join.joinData=_,e.join.joinIndex=A,w.get(e.join,t)}else{if(e.results.length>0)for(var u=0,c=p.length;c>u;u++)e.results.push(p[u]);if("string"!=typeof e.originalWhere&&e.progress(e.originalWhere.length-e.nextWhere.length,e.originalWhere.length),e.paging){var I=i.getElementsByTagName("rs:data")[0];("undefined"==typeof I||0==I.length)&&(I=i.getElementsByTagName("data")[0]),I&&(E=I.getAttribute("ListItemCollectionPositionNext"))}e.paging&&--e.page>0?(0===e.results.length&&(e.results=p),e.progress(e.results.length),E?(e.listItemCollectionPositionNext=r._cleanString(E),r.get(e,t)):"function"==typeof t&&t.call(r,e.results,E)):e.nextWhere.length>0?(0===e.results.length&&(e.results=p),e.where=e.nextWhere.slice(0),r.get(e,t)):"function"==typeof t&&(e.where=e.originalWhere,t.call(r,e.results.length>0?e.results:p,E))}},error:function(e,i,n){var o=e.responseXML,s=o.getElementsByTagName("errorstring");s&&s[0]?t.call(r,[],"Error: "+s[0].firstChild.nodeValue):t.call(r,[],i+": "+n)}})}return this},createFile:function(e){if(e=e||{},e.content==undefined)throw"Error 'createFile': not able to find the file content.";if(e.destination==undefined)throw"Error 'createFile': not able to find the file destination path.";if(e.url=e.url||this.url,!e.url)return this._getURL(),this._addInQueue(arguments);if(e.url==undefined)throw"Error 'createFile': not able to find the URL!";e.after=e.after||function(){},e.success=e.success||function(){},e.error=e.error||function(){},e.encoded=e.encoded==undefined?!1:e.encoded,"/"===e.destination.charAt(0)&&(e.destination=window.location.protocol+"//"+window.location.host+e.destination);var t=this,r="<SourceUrl>http://null</SourceUrl><DestinationUrls><string>"+e.destination+"</string></DestinationUrls><Fields><FieldInformation Type='File' /></Fields><Stream>"+(e.encoded?e.content:t.encode_b64(e.content))+"</Stream>";return r=t._buildBodyForSOAP("CopyIntoItems",r),t.ajax({url:e.url+"/_vti_bin/copy.asmx",type:"POST",dataType:"xml",data:r,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/CopyIntoItems")},contentType:'text/xml; charset="utf-8"',success:function(r){var i=r.getElementsByTagName("CopyResult");i&&i[0]&&"Success"!==i[0].getAttribute("ErrorCode")?"function"==typeof e.error&&e.error.call(t,e.destination,"Error 'createFile': "+i[0].getAttribute("ErrorCode")+" - "+i[0].getAttribute("ErrorMessage")):"function"==typeof e.success&&e.success.call(t,e.destination),"function"==typeof e.after&&e.after.call(t,e.destination)},error:function(r,i,n){"function"==typeof e.error&&e.error.call(t,e.destination,"Error 'createFile': "+n),"function"==typeof e.after&&e.after.call(t,e.destination)}}),this},createFolder:function(e){if(e=e||{},e.path==undefined)throw"Error 'createFolder': please provide the 'path'.";if(e.library==undefined)throw"Error 'createFolder': please provide the library name.";if(e.url=e.url||this.url,!e.url)return this._getURL(),this._addInQueue(arguments);if(e.url==undefined)throw"Error 'createFolder': not able to find the URL!";e.after=e.after||function(){};for(var t=e.path.split("/"),r=[],i="",n=0;n<t.length;n++)i+=(n>0?"/":"")+t[n],r.push({FSObjType:1,BaseName:i});return this.list(e.library,e.url).add(r,{after:e.after}),this},checkin:function(e){if(e=e||{},e.destination==undefined)throw"Error 'checkin': not able to find the file destination path.";if(e.url=e.url||this.url,!e.url)return this._getURL(),this._addInQueue(arguments);if(this.url==undefined)throw"Error 'checkin': not able to find the URL!";e.url=this.url,e.comments=e.comments||"",e.success=e.success||function(){},e.error=e.error||function(){},e.after=e.after||function(){};var t=this,r=t._buildBodyForSOAP("CheckInFile","<pageUrl>"+e.destination+"</pageUrl><comment>"+e.comments+"</comment><CheckinType>1</CheckinType></CheckInFile>");t.ajax({url:e.url+"/_vti_bin/Lists.asmx",type:"POST",dataType:"xml",data:r,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/CheckInFile")},contentType:"text/xml; charset=utf-8",success:function(r){var i=r.getElementsByTagName("CheckInFileResult");i&&i[0]&&"true"!=i[0].firstChild.nodeValue?e.error.call(t):e.success.call(t),e.after.call(t)}})},getAttachment:function(e,t,r){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'getAttachment': you have to define the list ID/Name";if(1===arguments.length&&"function"==typeof e)throw"Error 'getAttachment': you have to define the item ID";if(this.url==undefined)throw"Error 'getAttachment': not able to find the URL!";"object"!=typeof e&&(e=e.split(",")),r=r||[];var i=this,n=i._buildBodyForSOAP("GetAttachmentCollection","<listName>"+this.listID+"</listName><listItemID>"+e.shift()+"</listItemID>"),o=this.url+"/_vti_bin/lists.asmx",s=[];return i.ajax({type:"POST",cache:!1,async:!0,url:o,data:n,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetAttachmentCollection")},dataType:"xml",success:function(n){for(var o=n.getElementsByTagName("Attachment"),a=0;a<o.length;a++)s.push(o[a].firstChild.nodeValue);0===s.length?s="":1===s.length&&(s=s[0]),r.push(s),0===e.length?"function"==typeof t&&t.call(i,r):i.getAttachment(e,t,r)}}),this},getContentTypes:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'getContentTypes': you have to define the list ID";if(1===arguments.length&&"function"==typeof e)return this.getContentTypes(null,e);if(this.url==undefined)throw"Error 'getContentTypes': not able to find the URL!";if(e||(e={cache:!0}),e.cache)for(var r=0;r<_SP_CACHE_CONTENTTYPES.length;r++)if(_SP_CACHE_CONTENTTYPES[r].list===this.listID&&_SP_CACHE_CONTENTTYPES[r].url===this.url)return"function"==typeof t&&t.call(this,_SP_CACHE_CONTENTTYPES[r].contentTypes),this;var i=this,n=i._buildBodyForSOAP("GetListContentTypes","<listName>"+i.listID+"</listName>"),o=this.url+"/_vti_bin/lists.asmx",s=[];return i.ajax({type:"POST",cache:!1,async:!0,url:o,data:n,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetListContentTypes")},dataType:"xml",success:function(e){for(var r,n=e.getElementsByTagName("ContentType"),o=0;o<n.length;o++)r=n[o].getAttribute("ID"),r&&s.push({ID:r,Name:n[o].getAttribute("Name"),Description:n[o].getAttribute("Description")});_SP_CACHE_CONTENTTYPES.push({list:i.listID,url:i.url,contentTypes:s}),"function"==typeof t&&t.call(i,s)}}),this},getContentTypeInfo:function(e,t,r){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'getContentTypeInfo': you have to define the list ID";if(arguments.length>=1&&"string"!=typeof e)throw"Error 'getContentTypeInfo': you have to provide the Content Type Name/ID";if(2===arguments.length&&"function"==typeof t)return this.getContentTypeInfo(e,null,t);if(this.url==undefined)throw"Error 'getContentTypeInfo': not able to find the URL!";if(t||(t={cache:!0}),t.cache)for(var i=0;i<_SP_CACHE_CONTENTTYPE.length;i++)if(_SP_CACHE_CONTENTTYPE[i].list===this.listID&&_SP_CACHE_CONTENTTYPE[i].url===this.url&&_SP_CACHE_CONTENTTYPE[i].contentType===e)return"function"==typeof r&&r.call(this,_SP_CACHE_CONTENTTYPE[i].info),this;if("0x"!==e.slice(0,2))return this.getContentTypes(t,function(i){for(var n=!1,o=i.length;o--;)if(i[o].Name===e){this.getContentTypeInfo(i[o].ID,t,r),n=!0;break}if(!n)throw"Error 'getContentTypeInfo': not able to find the Content Type called '"+e+"' at "+this.url}),this;var n=this,o=n._buildBodyForSOAP("GetListContentType","<listName>"+n.listID+"</listName><contentTypeId>"+e+"</contentTypeId>"),s=this.url+"/_vti_bin/lists.asmx",a=[];return n.ajax({type:"POST",cache:!1,async:!0,url:s,data:o,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetListContentType")},dataType:"xml",success:function(t){for(var i,o,s,l,u=t.getElementsByTagName("Field"),c=0,f=0;f<u.length;f++)if(u[f].getAttribute("ID")){a[c]=[],i=a[c],o=u[f].attributes;for(var d=o.length;d--;){if(s=o[d].nodeName,attrValue=o[d].nodeValue,"Type"===s)switch(attrValue){case"Choice":case"MultiChoice":i.FillInChoice=u[f].getAttribute("FillInChoice");for(var h=u[f].getElementsByTagName("CHOICE"),p=[],m=0;m<h.length;m++)p.push(h[m].firstChild.nodeValue);i.Choices=p;break;case"Lookup":case"LookupMulti":i.Choices={list:u[f].getAttribute("List"),field:u[f].getAttribute("ShowField")};break;default:i.Choices=[]}i[s]=attrValue}if(l=u[f].getElementsByTagName("Default").length,l>0){nodeDefault=u[f].getElementsByTagName("Default"),a[c].DefaultValue=[];for(var g=0;l>g;g++)nodeDefault[g].firstChild&&a[c].DefaultValue.push(nodeDefault[g].firstChild.nodeValue);1===l&&(a[c].DefaultValue=a[c].DefaultValue[0])}else a[c].DefaultValue=null;c++}_SP_CACHE_CONTENTTYPE.push({list:n.listID,url:n.url,contentType:e,info:a}),"function"==typeof r&&r.call(n,a)}}),this},info:function(e){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'info': you have to define the list ID";if(this.url==undefined)throw"Error 'info': not able to find the URL!";var t=this,r=t._buildBodyForSOAP("GetList","<listName>"+t.listID+"</listName>"),i=this.url+"/_vti_bin/lists.asmx",n=[];return t.ajax({type:"POST",cache:!1,async:!0,url:i,data:r,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetList")},dataType:"xml",success:function(r){for(var i,o,s,a,l=r.getElementsByTagName("Field"),u=0,c=0;c<l.length;c++)if(l[c].getAttribute("ID")){n[u]=[],i=n[u],o=l[c].attributes;for(var f=o.length;f--;){if(s=o[f].nodeName,attrValue=o[f].nodeValue,"Type"===s)switch(attrValue){case"Choice":case"MultiChoice":i.FillInChoice=l[c].getAttribute("FillInChoice");for(var d=l[c].getElementsByTagName("CHOICE"),h=[],p=0;p<d.length;p++)h.push(d[p].firstChild.nodeValue);i.Choices=h;break;case"Lookup":case"LookupMulti":i.Choices={list:l[c].getAttribute("List"),field:l[c].getAttribute("ShowField")};break;default:i.Choices=[]}i[s]=attrValue}if(a=l[c].getElementsByTagName("Default").length,a>0){nodeDefault=l[c].getElementsByTagName("Default"),n[u].DefaultValue=[];for(var m=0;a>m;m++)nodeDefault[m].firstChild&&n[u].DefaultValue.push(nodeDefault[m].firstChild.nodeValue);1===a&&(n[u].DefaultValue=n[u].DefaultValue[0])}else n[u].DefaultValue=null;u++}"function"==typeof e&&e.call(t,n)}}),this},view:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'view': you have to define the list ID/Name";if(1===arguments.length&&"function"==typeof e)return this.view("",e);if(list=this.listID,this.url==undefined)throw"Error 'view': not able to find the URL!";e=e||"";var r=arguments[2]||e;r=r.toLowerCase();var i=_SP_CACHE_SAVEDVIEW;if(i!=undefined){for(var n=i.length;n--;)if(i[n].url===this.url&&i[n].list===list&&(i[n].viewID===e||i[n].viewName===r))return t.call(this,i[n].data,e),this}else i=[];if("{"!==e.charAt(0))return this.views(function(r){for(var i=!1,n=r.length;n--;)if(r[n].Name===e){this.view(r[n].ID,t,e),i=!0;break}if(!i)throw"Error 'view': not able to find the view called '"+e+"' at "+this.url}),this;var o=this,s=o._buildBodyForSOAP("GetView","<listName>"+o.listID+"</listName><viewName>"+e+"</viewName>"),a=this.url+"/_vti_bin/Views.asmx",l=["fields","orderby","whereCAML"];return o.ajax({type:"POST",cache:!1,async:!0,url:a,data:s,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetView")},dataType:"xml",success:function(n){l.fields=[];for(var s=n.getElementsByTagName("ViewFields")[0].getElementsByTagName("FieldRef"),a=0;a<s.length;a++)l.fields.push(s[a].getAttribute("Name"));if(l.orderby="",s=n.getElementsByTagName("OrderBy"),s.length){var u=[];s=s[0].getElementsByTagName("FieldRef");for(var a=0;a<s.length;a++)u.push(s[a].getAttribute("Name")+" "+(s[a].getAttribute("Ascending")==undefined?"ASC":"DESC"));l.orderby=u.join(",")}l.whereCAML="";var c=n.getElementsByTagName("Where");c.length&&(c=c[0].xml||(new XMLSerializer).serializeToString(c[0]),c=c.match(/<Where [^>]+>(.*)<\/Where>/),2==c.length&&(l.whereCAML=c[1])),i.push({url:o.url,list:list,data:l,viewID:e,viewName:r}),_SP_CACHE_SAVEDVIEW=i,"function"==typeof t&&t.call(o,l,e)}}),this},views:function(e,t){if("function"==typeof e)return this.views({},e);if(e.cache=e.cache===!1?!1:!0,this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'views': you have to define the list ID";if(this.url==undefined)throw"Error 'views': not able to find the URL!";t=t||function(){};var r=_SP_CACHE_SAVEDVIEWS;if(r!=undefined&&e.cache){for(var i=r.length;i--;)if(r[i].url==this.url&&r[i].listID===this.listID)return t.call(this,r[i].data),this}else r=[];var n=this,o=n._buildBodyForSOAP("GetViewCollection","<listName>"+n.listID+"</listName>"),s=n.url+"/_vti_bin/Views.asmx",a=[];return n.ajax({type:"POST",cache:!1,async:!0,url:s,data:o,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetViewCollection")},dataType:"xml",success:function(i){for(var o=i.getElementsByTagName("View"),s=0;s<o.length;s++)a[s]=[],a[s].ID=o[s].getAttribute("Name"),a[s].Name=o[s].getAttribute("DisplayName"),a[s].Url=o[s].getAttribute("Url"),a[s].Node=o[s];e.cache===!0&&(r.push({url:n.url,listID:this.listID,data:a}),_SP_CACHE_SAVEDVIEWS=r),t.call(n,a)}}),this},lists:function(e,t){if(1===arguments.length&&"function"==typeof e)return this.lists({},e);if(e=e||{},e.url=e.url||this.url,!e.url)return this._getURL(),this._addInQueue(arguments);if(this.url=e.url,this.url==undefined)throw"Error 'lists': not able to find the URL!";var r=this,i=r._buildBodyForSOAP("GetListCollection",""),n=_SP_CACHE_SAVEDLISTS;if(n!=undefined){for(var o=n.length;o--;)if(n[o].url==this.url)return"function"==typeof t?t(n[o].data):(this.data=n[o].data,this.length=this.data.length),this}else n=[];var s=r.url+"/_vti_bin/lists.asmx",a=[];return r.ajax({type:"POST",cache:!1,async:!0,url:s,data:i,contentType:"text/xml; charset=utf-8",beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetListCollection")},dataType:"xml",success:function(e){for(var i=e.getElementsByTagName("List"),o=0;o<i.length;o++)a[o]=[],a[o].ID=i[o].getAttribute("ID"),a[o].Name=i[o].getAttribute("Title"),a[o].Url=i[o].getAttribute("DefaultViewUrl"),a[o].Description=i[o].getAttribute("Description");n.push({url:r.url,data:a}),_SP_CACHE_SAVEDLISTS=n,"function"==typeof t&&t.call(r,a)}}),this},add:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(0===arguments.length||1===arguments.length&&"object"!=typeof e)throw"Error 'add': you need to define the list of items";if(this.listID===undefined)throw"Error 'add': you need to use list() to define the list name.";if(t=t||{},this.url==undefined)throw"Error 'add': not able to find the URL!";t.success=t.success||function(){},t.error=t.error||function(){},t.after=t.after||function(){},t.escapeChar=t.escapeChar==undefined?!0:t.escapeChar,t.progress=t.progress||function(){},"object"==typeof e&&e.length==undefined&&(e=[e]);var r=e.length;if(t.progressVar=t.progressVar||{current:0,max:r,passed:[],failed:[],eventID:"spAdd"+(""+Math.random()).slice(2)},r>15){var i=e.slice(0),n=i.splice(0,15),o=this;return _SP_ADD_PROGRESSVAR[t.progressVar.eventID]=function(e){o.add(i,e)},this.add(n,t),this}if(0==r)return t.progress(1,1),t.error([]),t.success([]),t.after(),this;t.progressVar.current+=r;for(var s,a,l,u='<Batch OnError="Continue" ListVersion="1"  ViewName="">',o=this,c=0;c<e.length;c++){
u+='<Method ID="'+(c+1)+'" Cmd="New">',u+="<Field Name='ID'>New</Field>";for(l in e[c])e[c].hasOwnProperty(l)&&(s=l,a=e[c][l],SPIsArray(a)&&(a=";#"+a.join(";#")+";#"),t.escapeChar&&"string"==typeof a&&(a=o._cleanString(a)),u+="<Field Name='"+s+"'>"+a+"</Field>");u+="</Method>"}u+="</Batch>";var o=this,f=o._buildBodyForSOAP("UpdateListItems","<listName>"+o.listID+"</listName><updates>"+u+"</updates>"),d=o.url+"/_vti_bin/lists.asmx";return o.ajax({type:"POST",cache:!1,async:!0,url:d,data:f,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(r){for(var i=r.getElementsByTagName("Result"),n=i.length,s=t.progressVar.passed,a=t.progressVar.failed,l=0;n>l;l++)if("0x00000000"==i[l].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue){var u=i[l].getElementsByTagName("z:row");0==u.length&&(u=i[l].getElementsByTagName("row")),e[l]&&(e[l].ID=u[0].getAttribute("ows_ID"),s.push(e[l]))}else e[l]&&(e[l].errorMessage=i[l].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,a.push(e[l]));t.progress(t.progressVar.current,t.progressVar.max),t.progressVar.current<t.progressVar.max?_SP_ADD_PROGRESSVAR[t.progressVar.eventID]&&_SP_ADD_PROGRESSVAR[t.progressVar.eventID](t):(a.length>0&&t.error.call(o,a),s.length>0&&t.success.call(o,s),t.after.call(o),_SP_ADD_PROGRESSVAR[t.progressVar.eventID]&&delete _SP_ADD_PROGRESSVAR[t.progressVar.eventID])}}),this},update:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(this.listID===undefined)throw"Error 'update': you need to use list() to define the list name.";if(t=t||{},this.url==undefined)throw"Error 'update': not able to find the URL!";t.where=t.where||"",t.success=t.success||function(){},t.error=t.error||function(){},t.after=t.after||function(){},t.escapeChar=t.escapeChar==undefined?!0:t.escapeChar,t.progress=t.progress||function(){},"object"==typeof e&&e.length==undefined&&(e=[e]);var r=e.length;if(1==r&&t.where){delete e[0].ID;var i=this;return this.get({fields:"ID",where:t.where},function(r){for(var n=function(e){var t={};for(var r in e)t[r]=e[r];return t},o=[],s=r.length;s--;){var a=n(e[0]);a.ID=r[s].getAttribute("ID"),o.push(a)}delete t.where,i.update(o,t)}),this}if(t.progressVar=t.progressVar||{current:0,max:r,passed:[],failed:[],eventID:"spUpdate"+(""+Math.random()).slice(2)},r>15){var n=e.slice(0),o=n.splice(0,15),i=this;return _SP_UPDATE_PROGRESSVAR[t.progressVar.eventID]=function(e){i.update(n,e)},this.update(o,t),this}if(0==r)return t.progress(1,1),t.error([]),t.success([]),t.after(),this;t.progressVar.current+=r;for(var s,a,l,u='<Batch OnError="Continue" ListVersion="1"  ViewName="">',i=this,c=0;r>c;c++){if(u+='<Method ID="'+(c+1)+'" Cmd="Update">',e[c].ID==undefined)throw"Error 'update': you have to provide the item ID called 'ID'";for(l in e[c])e[c].hasOwnProperty(l)&&(s=l,a=e[c][l],SPIsArray(a)&&(a=";#"+a.join(";#")+";#"),t.escapeChar&&"string"==typeof a&&(a=i._cleanString(a)),u+="<Field Name='"+s+"'>"+a+"</Field>");u+="</Method>"}u+="</Batch>";var i=this,f=i._buildBodyForSOAP("UpdateListItems","<listName>"+i.listID+"</listName><updates>"+u+"</updates>"),d=this.url+"/_vti_bin/lists.asmx";return i.ajax({type:"POST",cache:!1,async:!0,url:d,data:f,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(r){for(var n=r.getElementsByTagName("Result"),o=n.length,s=t.progressVar.passed,a=t.progressVar.failed,l=0;o>l;l++)"0x00000000"==n[l].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue&&e[l]?s.push(e[l]):e[l]&&(e[l].errorMessage=n[l].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,a.push(e[l]));t.progress(t.progressVar.current,t.progressVar.max),t.progressVar.current<t.progressVar.max?_SP_UPDATE_PROGRESSVAR[t.progressVar.eventID]&&_SP_UPDATE_PROGRESSVAR[t.progressVar.eventID](t):(a.length>0&&t.error.call(i,a),s.length>0&&t.success.call(i,s),t.after.call(i),_SP_UPDATE_PROGRESSVAR[t.progressVar.eventID]&&delete _SP_UPDATE_PROGRESSVAR[t.progressVar.eventID])}}),this},history:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(this.listID===undefined)throw"Error 'history': you need to use list() to define the list name.";if(2!==arguments.length)throw"Error 'history': you need to provide two parameters.";if("object"!=typeof e)throw"Error 'history': the first parameter must be an object.";if(e.ID===undefined||e.Name===undefined)throw"Error 'history': the first parameter must be an object with ID and Name.";if("function"!=typeof t)throw"Error 'history': the second parameter must be a function.";var r=this,i=r._buildBodyForSOAP("GetVersionCollection","<strlistID>"+r.listID+"</strlistID><strlistItemID>"+e.ID+"</strlistItemID><strFieldName>"+e.Name+"</strFieldName>"),n=this.url+"/_vti_bin/lists.asmx";return r.ajax({type:"POST",cache:!1,async:!0,url:n,data:i,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/GetVersionCollection")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){t.call(r,e.getElementsByTagName("Version"))}}),this},moderate:function(e,t){if(this.needQueue)return this._addInQueue(arguments);if(0===arguments.length||1===arguments.length&&"object"==typeof e&&e.length===undefined)throw"Error 'moderate': you need to define the list of items";if(this.listID===undefined)throw"Error 'moderate': you need to use list() to define the list name.";if(t=t||{},this.url==undefined)throw"Error 'moderate': not able to find the URL!";t.async=t.async==undefined?!0:t.async,t.success=t.success||function(){},t.error=t.error||function(){},t.after=t.after||function(){},t.progress=t.progress||function(){},"object"==typeof e&&e.length==undefined&&(e=[e]);var r=e.length;t.progressVar=t.progressVar||{current:0,max:r,passed:[],failed:[],eventID:"spModerate"+(""+Math.random()).slice(2)};var i=this;if(r>15){var n=e.slice(0),o=n.splice(0,15);return _SP_MODERATE_PROGRESSVAR[t.progressVar.eventID]=function(e){i.moderate(n,e)},this.moderate(o,t),this}if(0==r)return t.progress(1,1),t.success([]),t.error([]),t.after(),this;t.progressVar.current+=r;for(var s,a,l,u='<Batch OnError="Continue" ListVersion="1"  ViewName="">',c=0;r>c;c++){if(u+='<Method ID="'+(c+1)+'" Cmd="Moderate">',e[c].ID==undefined)throw"Error 'moderate': you have to provide the item ID called 'ID'";if(e[c].ApprovalStatus==undefined)throw"Error 'moderate': you have to provide the approval status 'ApprovalStatus' (Approved, Rejected, Pending, Draft or Scheduled)";for(l in e[c]){if(e[c].hasOwnProperty(l)&&(s=l,a=e[c][l],"ApprovalStatus"==s))switch(s="_ModerationStatus",a.toLowerCase()){case"approve":case"approved":a=0;break;case"reject":case"deny":case"denied":case"rejected":a=1;break;case"pending":a=2;break;case"draft":a=3;break;case"scheduled":a=4;break;default:a=2}u+="<Field Name='"+s+"'>"+a+"</Field>"}u+="</Method>"}u+="</Batch>";var f=i._buildBodyForSOAP("UpdateListItems","<listName>"+i.listID+"</listName><updates>"+u+"</updates>"),d=i.url+"/_vti_bin/lists.asmx";return i.ajax({type:"POST",cache:!1,async:!0,url:d,data:f,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(r){for(var n,o=r.getElementsByTagName("Result"),s=o.length,a=t.progressVar.passed,l=t.progressVar.failed,u=0;s>u;u++){n=o[u].getElementsByTagName("z:row"),0==n.length&&(n=r.getElementsByTagName("row"));var c=myElem(n[0]);"0x00000000"==o[u].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue?a.push(c):(e[u].errorMessage=o[u].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,l.push(e[u]))}t.progress(t.progressVar.current,t.progressVar.max),t.progressVar.current<t.progressVar.max?_SP_MODERATE_PROGRESSVAR[t.progressVar.eventID]&&_SP_MODERATE_PROGRESSVAR[t.progressVar.eventID](t):(a.length>0&&t.success.call(i,a),l.length>0&&t.error.call(i,l),t.after.call(i),_SP_MODERATE_PROGRESSVAR[t.progressVar.eventID]&&delete _SP_MODERATE_PROGRESSVAR[t.progressVar.eventID])}}),this},remove:function(e,t){if(this.needQueue)return this._addInQueue(arguments);var r=this;if(!t&&e.where&&(t=e,e=[]),t=t||{},this.url==undefined)throw"Error 'remove': not able to find the URL!";t.error=t.error||function(){},t.success=t.success||function(){},t.after=t.after||function(){},t.progress=t.progress||function(){},"object"==typeof e&&e.length==undefined&&(e=[e]);var i=e.length;if(t.where)return 1==i&&delete e[0].ID,this.get({fields:"ID,FileRef",where:t.where},function(i){for(var n,o=function(e){var t={};for(var r in e)t[r]=e[r];return t},s=[],a=i.length;a--;){var l=o(e[0]);l.ID=i[a].getAttribute("ID"),n=i[a].getAttribute("FileRef"),n&&(l.FileRef=$SP().cleanResult(n)),s.push(l)}delete t.where,r.remove(s,t)}),r;if(0==i)return t.progress(1,1),t.error.call(r,[]),t.success.call(r,[]),t.after.call(r),r;if(t.progressVar=t.progressVar||{current:0,max:i,passed:[],failed:[],eventID:"spRemove"+(""+Math.random()).slice(2)},i>15){var n=e.slice(0),o=n.splice(0,15);return _SP_REMOVE_PROGRESSVAR[t.progressVar.eventID]=function(e){r.remove(n,e)},r.remove(o,t),r}t.progressVar.current+=i;for(var s='<Batch OnError="Continue" ListVersion="1"  ViewName="">',a=0;a<e.length;a++){if(s+='<Method ID="'+(a+1)+'" Cmd="Delete">',e[a].ID==undefined)throw"Error 'delete': you have to provide the item ID called 'ID'";s+="<Field Name='ID'>"+e[a].ID+"</Field>",e[a].FileRef!=undefined&&(s+="<Field Name='FileRef'>"+e[a].FileRef+"</Field>"),s+="</Method>"}s+="</Batch>";var l=r._buildBodyForSOAP("UpdateListItems","<listName>"+r.listID+"</listName><updates>"+s+"</updates>"),u=r.url+"/_vti_bin/lists.asmx";return r.ajax({type:"POST",cache:!1,async:!0,url:u,data:l,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/UpdateListItems")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(i){for(var n=i.getElementsByTagName("Result"),o=n.length,s=t.progressVar.passed,a=t.progressVar.failed,l=0;o>l;l++)"0x00000000"==n[l].getElementsByTagName("ErrorCode")[0].firstChild.nodeValue?s.push(e[l]):(e[l].errorMessage=n[l].getElementsByTagName("ErrorText")[0].firstChild.nodeValue,a.push(e[l]));t.progress(t.progressVar.current,t.progressVar.max),t.progressVar.current<t.progressVar.max?_SP_REMOVE_PROGRESSVAR[t.progressVar.eventID]&&_SP_REMOVE_PROGRESSVAR[t.progressVar.eventID](t):(a.length>0&&t.error.call(r,a),s.length>0&&t.success.call(r,s),t.after.call(r),_SP_REMOVE_PROGRESSVAR[t.progressVar.eventID]&&delete _SP_REMOVE_PROGRESSVAR[t.progressVar.eventID])}}),this},del:function(e,t){return this.remove(e,t)},usergroups:function(e,t,r){switch(arguments.length){case 1:if("object"==typeof e)return this.usergroups("",e,function(){});if("function"==typeof e)return this.usergroups("",{},e);break;case 2:if("string"==typeof e&&"function"==typeof t)return this.usergroups(e,{},t);if("object"==typeof e&&"function"==typeof t)return this.usergroups("",e,t)}if(t=t||{},t.cache=t.cache===!1?!1:!0,t.url==undefined){if(!this.url)return this._getURL(),this._addInQueue(arguments);t.url=this.url}else this.url=t.url;if(r=r||function(){},!e)throw"Error 'usergroups': you have to set an username.";e=e.toLowerCase(),t.url=t.url.toLowerCase();var i=_SP_CACHE_USERGROUPS||[];if(t.cache)for(var n=i.length;n--;)if(i[n].user.toLowerCase()==e&&i[n].url.toLowerCase()==t.url)return r.call(this,i[n].data),this;var o=this,s=o._buildBodyForSOAP("GetGroupCollectionFromUser","<userLoginName>"+e+"</userLoginName>","http://schemas.microsoft.com/sharepoint/soap/directory/"),a=t.url+"/_vti_bin/usergroup.asmx";return o.ajax({type:"POST",cache:!1,url:a,data:s,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetGroupCollectionFromUser")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(n){var s=[];n=n.getElementsByTagName("Group");for(var a=0,l=n.length;l>a;a++)s.push(n[a].getAttribute("Name"));i.push({user:e,url:t.url,data:s}),_SP_CACHE_USERGROUPS=i,r.call(o,s)},error:function(e){if(t.error===!1)r.call(o,[]);else{var i=e.responseXML.getElementsByTagName("errorstring");"object"==typeof console&&console.error("Error 'usergroups': "+i[0].firstChild.nodeValue)}}}),this},workflowStatusToText:function(e){switch(e=1*e){case 0:return"Not Started";case 1:return"Failed On Start";case 2:return"In Progress";case 3:return"Error Occurred";case 4:return"Stopped By User";case 5:return"Completed";case 6:return"Failed On Start Retrying";case 7:return"Error Occurred Retrying";case 8:return"View Query Overflow";case 15:return"Canceled";case 16:return"Approved";case 17:return"Rejected";default:return"Unknown"}},getWorkflowID:function(e){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'getWorkflowID': you have to define the list ID/Name";if(this.url==undefined)throw"Error 'getWorkflowID': not able to find the URL!";if(e=e||{},e.ID==undefined||e.workflowName==undefined||e.after==undefined)throw"Error 'getWorkflowID': all parameters are mandatory";return this.get({fields:"FieldRef",where:"ID = "+e.ID},function(t){if(0===t.length)throw"Error 'getWorkflowID': I'm not able to find the item ID "+e.ID;var r=this.cleanResult(t[0].getAttribute("FileRef")),i=r.substring(0,r.indexOf("/Lists")),t=this.url.substring(0,this.url.indexOf(i));r=t+r;var n=this,o=n._buildBodyForSOAP("GetWorkflowDataForItem","<item>"+r+"</item>","http://schemas.microsoft.com/sharepoint/soap/workflow/");n.ajax({type:"POST",cache:!1,async:!0,url:this.url+"/_vti_bin/Workflow.asmx",data:o,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/workflow/GetWorkflowDataForItem")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(t){var i,o,s={},a=t.getElementsByTagName("WorkflowTemplate");if(0===a.length){var l=SP.ClientContext.get_current(),u=l.get_web().get_lists(),c=u.getByTitle(n.listID),f=c.getItemById(e.ID);f.get_file();l.load(c),l.load(f);var d=c.get_workflowAssociations();l.load(d),l.executeQueryAsync(function(){for(var t=d.getEnumerator();t.moveNext();){var i=t.get_current();if(i.get_name()===e.workflowName){s={fileRef:r,description:i.get_description(),workflowID:"{"+i.get_id().toString()+"}",instances:[]};break}}e.after.call(n,s)},function(){throw"Error 'getWorkflowID': Problem while dealing with SP.ClientContext.get_current()"})}else{for(i=a.length;i--;)a[i].getAttribute("Name")==e.workflowName&&(s={fileRef:r,description:a[i].getAttribute("Description"),workflowID:"{"+a[i].getElementsByTagName("WorkflowTemplateIdSet")[0].getAttribute("TemplateId")+"}",instances:[]});if(!s.fileRef)throw"Error 'getWorkflowID': it seems the requested workflow ('"+e.workflowName+"') doesn't exist!";for(a=t.getElementsByTagName("Workflow"),i=0;i<a.length;i++)o=a[i],s.instances.push({StatusPageUrl:o.getAttribute("StatusPageUrl"),Id:o.getAttribute("Id"),TemplateId:o.getAttribute("TemplateId"),ListId:o.getAttribute("ListId"),SiteId:o.getAttribute("SiteId"),WebId:o.getAttribute("WebId"),ItemId:o.getAttribute("ItemId"),ItemGUID:o.getAttribute("ItemGUID"),TaskListId:o.getAttribute("TaskListId"),AdminTaskListId:o.getAttribute("AdminTaskListId"),Author:o.getAttribute("Author"),Modified:o.getAttribute("Modified"),Created:o.getAttribute("Created"),StatusVersion:o.getAttribute("StatusVersion"),Status1:{code:o.getAttribute("Status1"),text:n.workflowStatusToText(o.getAttribute("Status1"))},Status2:{code:o.getAttribute("Status2"),text:n.workflowStatusToText(o.getAttribute("Status2"))},Status3:{code:o.getAttribute("Status3"),text:n.workflowStatusToText(o.getAttribute("Status3"))},Status4:{code:o.getAttribute("Status4"),text:n.workflowStatusToText(o.getAttribute("Status4"))},Status5:{code:o.getAttribute("Status5"),text:n.workflowStatusToText(o.getAttribute("Status5"))},Status6:{code:o.getAttribute("Status6"),text:n.workflowStatusToText(o.getAttribute("Status6"))},Status7:{code:o.getAttribute("Status7"),text:n.workflowStatusToText(o.getAttribute("Status7"))},Status8:{code:o.getAttribute("Status8"),text:n.workflowStatusToText(o.getAttribute("Status8"))},Status9:{code:o.getAttribute("Status9"),text:n.workflowStatusToText(o.getAttribute("Status9"))},Status10:{code:o.getAttribute("Status10"),text:n.workflowStatusToText(o.getAttribute("Status10"))},TextStatus1:o.getAttribute("TextStatus1"),TextStatus2:o.getAttribute("TextStatus2"),TextStatus3:o.getAttribute("TextStatus3"),TextStatus4:o.getAttribute("TextStatus4"),TextStatus5:o.getAttribute("TextStatus5"),Modifications:o.getAttribute("Modifications"),InternalState:o.getAttribute("InternalState"),ProcessingId:o.getAttribute("ProcessingId")});e.after.call(n,s)}return n},error:function(){throw"Error 'getWorkflowID': Something went wrong with the request over the Workflow Web Service..."}})}),this},startWorkflow:function(e){if(this.needQueue)return this._addInQueue(arguments);if(this.listID==undefined)throw"Error 'startWorkflow': you have to define the list ID/Name";if(this.url==undefined)throw"Error 'startWorkflow': not able to find the URL!";if(e=e||{},e.after=e.after||function(){},!e.workflowName&&!e.workflowID)throw"Error 'startWorkflow': Please provide the workflow name!";if(!e.ID)throw"Error 'startWorkflow': Please provide the item ID!";if(e.fileRef||e.workflowID){var t="<root />";if(e.parameters){var r;e.parameters.length==undefined&&(e.parameters=[e.parameters]),r=e.parameters.slice(0),t="<Data>";for(var i=0;i<r.length;i++)t+="<"+r[i].name+">"+r[i].value+"</"+r[i].name+">";t+="</Data>"}var n=this,o=n._buildBodyForSOAP("StartWorkflow","<item>"+e.fileRef+"</item><templateId>"+e.workflowID+"</templateId><workflowParameters>"+t+"</workflowParameters>","http://schemas.microsoft.com/sharepoint/soap/workflow/"),s=this.url+"/_vti_bin/Workflow.asmx";n.ajax({type:"POST",cache:!1,async:!0,url:s,data:o,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/workflow/StartWorkflow")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(){e.after.call(n)},error:function(t,r,i){e.after.call(n,i)}})}else this.getWorkflowID({ID:e.ID,workflowName:e.workflowName,after:function(t){e.fileRef=t.fileRef,e.workflowID=t.workflowID,this.startWorkflow(e)}});return this},distributionLists:function(e,t,r){switch(arguments.length){case 1:if("object"==typeof e)return this.distributionLists("",e,function(){});if("function"==typeof e)return this.distributionLists("",{},e);break;case 2:if("string"==typeof e&&"function"==typeof t)return this.distributionLists(e,{},t);if("object"==typeof e&&"function"==typeof t)return this.distributionLists("",e,t)}if(t=t||{},t.url==undefined){if(!this.url)return this._getURL(),this._addInQueue(arguments);t.url=this.url}else this.url=t.url;if(r=r||function(){},!e)throw"Error 'distributionLists': you have to set an username.";e=e.toLowerCase(),t.url=t.url.toLowerCase(),t.cache=t.cache===!1?!1:!0;var i=_SP_CACHE_DISTRIBUTIONLISTS||[];if(t.cache)for(var n=i.length;n--;)if(i[n].user===e&&i[n].url===t.url)return r.call(this,i[n].data),this;var o=this,s=o._buildBodyForSOAP("GetCommonMemberships","<accountName>"+e+"</accountName>","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService"),a=t.url+"/_vti_bin/UserProfileService.asmx";return o.ajax({type:"POST",cache:!1,url:a,data:s,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserMemberships")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(n){var s=[];n=n.getElementsByTagName("MembershipData");for(var a=0,l=n.length;l>a;a++)"DistributionList"===n[a].getElementsByTagName("Source")[0].firstChild.nodeValue&&s.push({SourceReference:n[a].getElementsByTagName("SourceReference")[0].firstChild.nodeValue,DisplayName:n[a].getElementsByTagName("DisplayName")[0].firstChild.nodeValue,MailNickname:n[a].getElementsByTagName("MailNickname")[0].firstChild.nodeValue,Url:n[a].getElementsByTagName("Url")[0].firstChild.nodeValue});i.push({user:e,url:t.url,data:s}),_SP_CACHE_DISTRIBUTIONLISTS=i,r.call(o,s)},error:function(){r.call(o,[])}}),this},groupMembers:function(e,t,r){switch(arguments.length){case 1:if("object"==typeof e)return this.groupMembers("",e,function(){});if("function"==typeof e)return this.groupMembers("",{},e);break;case 2:if("string"==typeof e&&"function"==typeof t)return this.groupMembers(e,{},t);if("object"==typeof e&&"function"==typeof t)return this.groupMembers("",e,t)}if(t=t||{},t.cache=t.cache===undefined?!0:t.cache,t.url==undefined){if(!this.url)return this._getURL(),this._addInQueue(arguments);t.url=this.url}else this.url=t.url;if(r=r||function(){},!e)throw"Error 'groupMembers': you have to set an groupname.";e=e.toLowerCase(),t.url=t.url.toLowerCase();var i=[];if(t.cache){i=_SP_CACHE_GROUPMEMBERS||[];for(var n=i.length;n--;)if(i[n].group===e&&i[n].url===t.url)return r.call(this,i[n].data),this}var o=this,s=o._buildBodyForSOAP("GetUserCollectionFromGroup","<groupName>"+this._cleanString(e)+"</groupName>","http://schemas.microsoft.com/sharepoint/soap/directory/"),a=t.url+"/_vti_bin/usergroup.asmx";return o.ajax({type:"POST",cache:!1,url:a,data:s,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/directory/GetUserCollectionFromGroup")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(n){var s=[];n=n.getElementsByTagName("User");for(var a=0,l=n.length;l>a;a++)s.push({ID:n[a].getAttribute("ID"),Name:n[a].getAttribute("Name"),LoginName:n[a].getAttribute("LoginName"),Email:n[a].getAttribute("Email")});i.push({group:e,url:t.url,data:s}),_SP_CACHE_GROUPMEMBERS=i,r.call(o,s)},error:function(e){if(t.error===!1)r.call(o,[]);else{var i=e.responseXML.getElementsByTagName("errorstring");"object"==typeof console&&console.error("Error 'groupMembers': "+i[0].firstChild.nodeValue)}}}),this},isMember:function(e,t){if(e=e||{},e.cache=e.cache===!1?!1:!0,e.url==undefined){if(!this.url)return this._getURL(),this._addInQueue(arguments);e.url=this.url}else this.url=e.url;if(t=t||function(){},!e.user)throw"Error 'isMember': you have to set an user.";if(!e.group)throw"Error 'isMember': you have to set a group.";return e.group=e.group.toLowerCase(),this.usergroups(e.user,{cache:e.cache,error:!1},function(r){for(var i=r.length;i--;)if(r[i].toLowerCase()===e.group)return t.call(this,!0),this;this.groupMembers(e.group,{cache:e.cache,error:!1},function(r){for(var i=[],n=r.length;n--;)i.push(r[n].Name.toLowerCase());this.distributionLists(e.user,{cache:e.cache},function(e){for(var r=e.length;r--;)if(SPArrayIndexOf(i,e[r].DisplayName.toLowerCase())>-1)return t.call(this,!0),this;return t.call(this,!1),this})})}),this},people:function(e,t,r){switch(arguments.length){case 1:if("object"==typeof e)return this.people("",e,function(){});if("function"==typeof e)return this.people("",{},e);e=undefined;break;case 2:if("string"==typeof e&&"function"==typeof t)return this.people(e,{},t);if("object"==typeof e&&"function"==typeof t)return this.people("",e,t)}if(t=t||{},t.url==undefined){if(!this.url)return this._getURL(),this._addInQueue(arguments);t.url=this.url}else this.url=t.url;r=r||function(){},e=e||"";var i=this,n=i._buildBodyForSOAP("GetUserProfileByName","<AccountName>"+e+"</AccountName>","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService"),o=t.url+"/_vti_bin/UserProfileService.asmx";return i.ajax({type:"POST",cache:!1,url:o,data:n,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://microsoft.com/webservices/SharePointPortalServer/UserProfileService/GetUserProfileByName")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var t=[];e=e.getElementsByTagName("PropertyData");for(var n=0,o=e.length;o>n;n++){var s=e[n].getElementsByTagName("Name")[0].firstChild.nodeValue,a=e[n].getElementsByTagName("Value");a=a&&a.length>=1&&a[0].firstChild?a[0].firstChild.nodeValue:"No Value",t.push(s),t[s]=a}r.call(i,t)},error:function(e){var t=e.responseXML.getElementsByTagName("faultstring");r.call(i,"Error 'people': "+t[0].firstChild.nodeValue)}}),this},getUserInfo:function(e,t,r){if("string"!=typeof e)throw"Error 'getUserInfo': the first argument must be the username";switch(arguments.length){case 2:if("function"==typeof t)return this.getUserInfo(e,{},t);if("object"==typeof t)return this.getUserInfo(e,t,function(){});break;case 3:if("object"!=typeof t&&"function"!=typeof r)throw"Error 'getUserInfo': incorrect arguments, please review the documentation"}if(t=t||{},t.url==undefined){if(!this.url)return this._getURL(),this._addInQueue(arguments);t.url=this.url}else this.url=t.url;r=r||function(){};var i=this,n=i._buildBodyForSOAP("GetUserInfo","<userLoginName>"+e+"</userLoginName>","http://schemas.microsoft.com/sharepoint/soap/directory/"),o=t.url+"/_vti_bin/usergroup.asmx";return i.ajax({type:"POST",cache:!1,url:o,data:n,contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){e=e.getElementsByTagName("User"),0===e.length?r.call(i,"Error 'getUserInfo': nothing returned?!"):r.call(i,{ID:e[0].getAttribute("ID"),Sid:e[0].getAttribute("Sid"),Name:e[0].getAttribute("Name"),LoginName:e[0].getAttribute("LoginName"),Email:e[0].getAttribute("Email"),Notes:e[0].getAttribute("Notes"),IsSiteAdmin:e[0].getAttribute("IsSiteAdmin"),IsDomainGroup:e[0].getAttribute("IsDomainGroup"),Flags:e[0].getAttribute("Flags")})},error:function(e){var t=e.responseXML.getElementsByTagName("errorstring");r.call(i,"Error 'getUserInfo': "+t[0].firstChild.nodeValue)}}),this},whoami:function(e,t){return"function"==typeof e&&(t=e,e={}),this.people("",e,t)},addressbook:function(e,t,r){switch(arguments.length){case 1:if("object"==typeof e)return this.addressbook("",e,function(){});if("function"==typeof e)return this.addressbook("",{},e);if("string"==typeof e)return this.addressbook(e,{},function(){});e=undefined;break;case 2:if("string"==typeof e&&"function"==typeof t)return this.addressbook(e,{},t);if("object"==typeof e&&"function"==typeof t)return this.addressbook("",e,t)}if(t=t||{},t.url==undefined){if(!this.url)return this._getURL(),this._addInQueue(arguments);t.url=this.url}else this.url=t.url;t.limit=t.limit||10,t.type=t.type||"User",r=r||function(){},e=e||"";var i=this,n=i._buildBodyForSOAP("SearchPrincipals","<searchText>"+e+"</searchText><maxResults>"+t.limit+"</maxResults><principalType>"+t.type+"</principalType>"),o=t.url+"/_vti_bin/People.asmx";return i.ajax({type:"POST",cache:!1,url:o,data:n,beforeSend:function(e){e.setRequestHeader("SOAPAction","http://schemas.microsoft.com/sharepoint/soap/SearchPrincipals")},contentType:"text/xml; charset=utf-8",dataType:"xml",success:function(e){var t=[];e=e.getElementsByTagName("PrincipalInfo");for(var n=0,o=e.length;o>n;n++){var s=e[n].childNodes;t[n]=[];for(var a=0,l=s.length;l>a;a++){var u=s[a].nodeName,c=s[a].firstChild;c&&(c=c.nodeValue),t[n].push(u),t[n][u]=c}}r.call(i,t)}}),this},reset:function(){this.data=[],this.length=0,this.listID="",this.needQueue=!1,this.listQueue=[],delete this.url},toDate:function(e,t){if(e instanceof Date)return e;if(19!=e.length&&20!=e.length)throw"toDate: '"+e+"' is invalid.";var r=e.substring(0,4),i=e.substring(5,7),n=e.substring(8,10),o=e.substring(11,13),s=e.substring(14,16),a=e.substring(17,19);return e.indexOf("Z")>-1||t?new Date(Date.UTC(r,i-1,n,o,s,a)):new Date(r,i-1,n,o,s,a)},toSPDate:function(e,t){var r=function(e){return 1==e.toString().length&&(e="0"+e),e},i=r(e.getMonth()+1),n=r(e.getDate()),o=e.getFullYear(),s=r(e.getHours()),a=r(e.getMinutes()),l=r(e.getSeconds());return o+"-"+i+"-"+n+(t?" "+s+":"+a+":"+l:"")},toCurrency:function(e,t,r){e=Number(e),t===undefined&&(t=-1),r===undefined&&(r="$");var i="";0>e&&(i="-",e*=-1);var n=e;n=-1===t?n.toFixed(2).replace(".00",""):n.toFixed(t);for(var o=(Math.floor(e)+"").length,s=0,a=0,l=o%3;o>s;s++)0!=s&&s%3==l&&(n=n.substr(0,s+a)+","+n.substr(s+a),a++);return(""!=r?r:"")+i+n+(""!=r?"":" "+r)},getLookup:function(e){if(!e)return{id:"",value:""};var t=e.split(";#");return{id:t[0],value:t[1]}},toXSLString:function(e){if("string"!=typeof e)throw"Error 'toXLSString': '"+e+"' is not a string....";var t=function(e,t){t=t||!1;for(var r=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"),i="",n=0;n<e.length;n++){for(var o=e.charAt(n),s=o.charCodeAt(0),a=0,l="";s>=16;)a=s%16,s=Math.floor(s/16),l+=r[a];l+=r[s];for(var u="",c=l.length-1;c>=0;c--)u+=l.charAt(c);i+="%"+u}return i},r=e.split(" "),i="";/^[0-9]/.test(r[0])&&r[0].length<5&&(i=t(e.charAt(0)),e=e.substring(1));for(var n=0;n<e.length;n++){var o=e.charAt(n);i+=/[0-9A-Za-z_]/.test(o)===!1?t(o).toLowerCase():o}return i.replace(/%([a-zA-Z0-9][a-zA-Z0-9])/g,"_x00$1_").substring(0,32)},formfields:function(fields,settings){"use strict";this.reset(),1==arguments.length&&"object"==typeof fields&&"undefined"==typeof fields.length&&(settings=fields,fields=undefined),settings=settings||{},fields=fields||[],settings.cache=settings.cache===!1?!1:!0;var aReturn=[],bigLimit=1e4;"string"==typeof fields&&(fields=""===fields?[]:fields.split(","));var limit=fields.length>0?fields.length:bigLimit;if(limit!==bigLimit||settings.mandatory||(settings.includeAll=!0),settings.cache&&null!==_SP_CACHE_FORMFIELDS){var allFields=_SP_CACHE_FORMFIELDS.slice(0);if(settings.includeAll)return this.length=allFields.length,this.data=allFields,this;var done=0,i,len=allFields.length,idx,fieldNames=[];for(i=0;len>i;i++)fieldNames.push(allFields[i]._name);for(i=0;limit>i;i++)idx=SPArrayIndexOf(fieldNames,fields[i]),idx>-1&&aReturn.push(allFields[idx]);for(i=0,len=settings.mandatory?allFields.length:0;len>i;i++)allFields[i]._isMandatory&&-1===SPArrayIndexOf(fields,allFields[i]._name)&&aReturn.push(allFields[i]);return this.length=aReturn.length,this.data=aReturn,this}settings.includeAll=!0,settings.cache=!0;var getFieldInfoFromComments=function(e){var t=[];if("undefined"==typeof document.createNodeIterator)for(var r={COMMENT_NODE:8},i=e.childNodes,n=0,o=i.length;o>n;n++)i[n].nodeType==r.COMMENT_NODE&&t.push(i[n].nodeValue);else for(var s,a=function(){return NodeFilter.FILTER_ACCEPT},l=document.createNodeIterator(e,NodeFilter.SHOW_COMMENT,a,!1);s=l.nextNode();)t.push(s.nodeValue);var u=t.join("").replace(/\s\s*/g," ").match(/FieldName="([^"]+)".* FieldInternalName="([^"]+)".* FieldType="([^"]+)"/);return u?{Name:u[1],InternalName:u[2],SPType:u[3]}:{Name:"",InternalName:"",SPType:""}},getText=function(e){var t,r,i=e.nodeType,n="";if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;if("string"==typeof e.innerText)return e.innerText.replace(/\r/g,"");for(e=e.firstChild;e;e=e.nextSibling)n+=getText(e)}else if(3===i||4===i)return e.nodeValue}else for(t=0;r=e[t];t++)8!==r.nodeType&&(n+=getText(r));return n},setSelectedOption=function(e,t,r){r=r||"text";for(var i,n=e.querySelectorAll("option"),o=SPIsArray(t),s=0,a=n.length;a>s;s++)"all"===r?n[s].selected=!0:"none"===r?n[s].selected=!1:(i="text"===r?n[s].innerHTML:n[s].value,n[s].selected=o?SPArrayIndexOf(t,i)>-1:t==i)},getSelectedOption=function(e,t){t=t||"text";for(var r=e.querySelectorAll("option"),i=[],n=null!==e.getAttribute("multiple"),o=0,s=r.length;s>o;o++)if(r[o].selected){if("text"===t){if(i.push(getText(r[o])),n)continue;return i[0]||""}if("value"===t){if(i.push(r[o].value),n)continue;return i[0]||""}if("both"===t){if(i.push({text:getText(r[o]),value:r[o].value}),n)continue;return i[0]||""}}return n?i:0===i.length?"":i};settings.includeAll&&(limit=bigLimit);for(var a=document.querySelectorAll("td.ms-formbody"),i=-1,len=a.length,done=0;len>i&&limit>done;i++){var tr,td,isMandatory=!1,html,txt,infoFromComments,includeThisField=!1,search,fieldName,obj,tmp;if(settings.includeAll&&(includeThisField=!0),-1===i)(includeThisField||SPArrayIndexOf(fields,"Content Type")>-1)&&(infoFromComments={Name:"Content Type",
InternalName:"Content_x0020_Type",SPType:"SPContentType"},includeThisField=!0);else{if(tr=a[i].parentNode,td=tr.querySelector("td.ms-formbody"),infoFromComments=getFieldInfoFromComments(a[i]),!infoFromComments.Name){if("idAttachmentsRow"!==tr.getAttribute("id"))continue;infoFromComments={Name:"Attachments",InternalName:"Attachments",SPType:"SPAttachments"},includeThisField=!0}if(txt=tr.querySelector("td.ms-formlabel nobr"),!txt)continue;txt=getText(txt),isMandatory=/ \*$/.test(txt),settings.mandatory&&isMandatory?includeThisField=!0:limit!==bigLimit&&SPArrayIndexOf(fields,infoFromComments.Name)>-1&&(includeThisField=!0,done++)}if(includeThisField)if(fieldName=infoFromComments.Name,obj={_name:fieldName,_isMandatory:isMandatory,_description:"",_elements:[],_tr:null,_type:null},"Content Type"===fieldName?(obj._elements=document.querySelector('.ms-formbody select[title="Content Type"]'),obj._type="content type",obj._tr=tr):obj._tr=tr,obj.val=function(){},obj.elem=function(e){e=e===!1?!1:!0;var t=this._elements,r="function"==typeof jQuery&&e===!0;switch(t.length){case 0:return r?jQuery():null;case 1:return r?jQuery(t[0]):t[0];default:return r?jQuery(t):t}},obj.description=function(){return this._description},obj.type=function(){return this._type},obj.row=function(){return"function"==typeof jQuery?jQuery(this._tr):this._tr},obj.name=function(){return this._name},obj.isMandatory=function(){return this._isMandatory},obj.options=function(){},"Attachments"===obj._name)obj._type="attachments",obj.elem=function(e){e=e===!1?!1:!0;var t=document.getElementById("idAttachmentsRow").querySelector(".ms-formbody").querySelectorAll("tr"),r="function"==typeof jQuery&&e===!0;switch(t.length){case 0:return r?jQuery():null;case 1:return r?jQuery(t[0]):t[0];default:return r?jQuery(t):t}},obj.val=function(e){if("undefined"==typeof e){var e=[],t=this.elem(!1);if(t){t.length||(t=[t]);for(var r=0;r<t.length;r++)e.push(getText(t[r].querySelector("span")))}return e}return this};else if("Content Type"===obj._name)obj.val=function(v){var e=this.elem(!1);return"undefined"==typeof v?getSelectedOption(e,"text"):(setSelectedOption(e,v,"text"),eval("!function() {"+e.getAttribute("onchange").replace(/javascript:/,"")+"}()"),this)};else switch(tmp=td.querySelector(".ms-metadata"),tmp&&tmp.parentNode==td?obj._description=getText(tmp).trim():(tmp=td.childNodes,tmp=tmp[tmp.length-1],3==tmp.nodeType&&(obj._description=getText(tmp).trim())),infoFromComments.SPType){case"SPFieldText":case"SPFieldCurrency":case"SPFieldNumber":switch(infoFromComments.SPType){case"SPFieldCurrency":obj._type="currency";break;case"SPFieldNumber":obj._type="number";break;default:obj._type="text"}obj._elements.push(td.querySelector('input[type="text"]')),obj.val=function(e){var t=this.elem(!1);return"undefined"!=typeof e?(t.value=e,this):t.value};break;case"SPFieldNote":obj._type="text multiple",tmp=td.querySelector("textarea"),tmp?(obj._elements.push(tmp),obj.val=function(e){var t=this.elem(),r=this.type();if("iframe"===t[0].tagName.toLowerCase()){var i=1===t.length?t[0]:t[1],n=i.contentDocument?i.contentDocument:i.contentWindow.document;if(!e)return n.getElementsByTagName("div")[0].innerHTML;n.getElementsByTagName("div")[0].innerHTML=e}else{if("undefined"==typeof e)return t[0].value;t[0].value=e,"text multiple"===r&&(t[0].innerHTML=e)}return this}):(obj._type="html multiple",obj._elements.push(td.querySelector("div")),obj.val=function(e){var t=this.elem();if(t=t[0].querySelector("div[contenteditable]")){if(e===undefined)return t.innerHTML.replace(/^<div class="?ExternalClass[0-9A-Z]+"?>([\s\S]*)<\/div>$/i,"$1").replace(/<span (rtenodeid="1" )?id="?ms-rterangecursor-start"?><\/span><span (rtenodeid="3" )?id="?ms-rterangecursor-end"?([^>]+)?><\/span>/gi,"").replace(/^<p><\/p>$/,"");t.innerHTML=e}return e!==undefined?this:null});break;case"SPFieldUser":case"SPFieldUserMulti":obj._type="people"+("SPFieldUserMulti"===infoFromComments.SPType?" multiple":""),tmp=td.querySelector('div[contenteditable="true"]'),tmp?(obj._elements.push(tmp),obj._elements.push(td.querySelector("textarea")),!function(){for(var e=td.querySelectorAll("a"),t=0;t<e.length;t++)obj._elements.push(e[t])}()):obj._elements.push(td.querySelector("div[id]")),"function"==typeof GetPickerControlValue&&(tmp=td.querySelector("table.ms-usereditor"),tmp&&(tmp=tmp.querySelectorAll("span"),tmp&&(obj._description=getText(tmp[tmp.length-1]).trim()))),obj.val=function(e){var t,r,i=[],n=!1,o=this.elem(!1);if("object"!=typeof e||SPIsArray(e)||e.extend!==!0||(e=void 0,n=!0),r=(SPIsArray(o)?o[0]:o).getAttribute("id").replace(/_upLevelDiv$/,""),"undefined"==typeof e)return"function"==typeof GetPickerControlValue?n===!1?GetPickerControlValue(r,!1,!0).trim():(e=GetPickerControlValue(r,!1,!1),t=document.createElement("div"),t.innerHTML=e,e=t.querySelector("#divEntityData"),e?{Key:e.getAttribute("key"),DisplayText:e.getAttribute("DisplayText")}:{Key:"",DisplayText:GetPickerControlValue(r,!1,!0).trim()}):"function"==typeof SPClientPeoplePicker?(t=SPClientPeoplePicker.SPClientPeoplePickerDict[r],t?(t=t.GetAllUserInfo(),n?0===t.length?{Key:"",DisplayText:""}:1===t.length?t[0]:t:(SPArrayForEach(t,function(e){i.push(e.DisplayText)}),0===i.length?"":1===i.length?i[0]:i)):""):JSON.parse(this.elem(!1).querySelector("input").value)[0].ResolveText;if("function"==typeof EntityEditorCallback)SPIsArray(e)||(e=[e]),t='<Entities Append="False" Error="" Separator=";" MaxHeight="3">',SPArrayForEach(e,function(e){t+='<Entity Key="'+e+'" DisplayText="'+e+'" IsResolved="False" Description="'+e+'"><MultipleMatches /></Entity>'}),t+="</Entities>",EntityEditorCallback(t,r,!1),e=getUplevel(r),WebForm_DoCallback(r.replace(/(ctl\d+)(\_)/g,"$1$").replace(/(^ctl\d+\$m)(\_)/,"$1$").replace(/\_ctl/,"$ctl"),e,EntityEditorHandleCheckNameResult,r,EntityEditorHandleCheckNameError,!0);else{if("function"!=typeof SPClientPeoplePicker)throw new Error("$SP().formfields().val() failed with a People Picker, because EntityEditorCallback and SPClientPeoplePicker are not available!");if(i=SPClientPeoplePicker.SPClientPeoplePickerDict[r],!i)throw new Error("$SP().formfields().val() failed with a People Picker, because SPClientPeoplePicker.SPClientPeoplePickerDict['"+r+"'] returned an unexpected value");if(t=document.getElementById(i.ResolvedListElementId))for(t=t.querySelectorAll("span"),r=t.length;r--;)i.DeleteProcessedUser();SPIsArray(e)&&(e=e.join(";")),i.AddUserKeys(e,!1)}return this};break;case"SPFieldChoice":case"SPFieldMultiChoice":obj._type="choices",tmp=td.querySelector("table"),tmp?(tmp=td.querySelector("select"),tmp?(obj._type="choices plus",obj._elements=td.querySelectorAll("input,select")):(tmp=td.querySelector('input[type="checkbox"]'),tmp?obj._type="choices checkbox":obj._type="choices radio",tmp=td.querySelector('input[type="text"]'),tmp&&(obj._type+=" plus"),obj._elements=td.querySelectorAll("input"))):obj._elements=td.querySelector("select"),obj.val=function(e){var t,r,i,n=this.elem(!1),o=this.type();if("undefined"==typeof e)switch(o){case"choices":return getSelectedOption(n,"text");case"choices plus":return n[0].checked?getSelectedOption(n[1],"text"):n[3].value;case"choices radio":for(t=0;t<n.length;t++)if(n[t].checked)return getText(n[t].nextSibling);return"";case"choices radio plus":for(t=0;t<n.length-2;t++)if(n[t].checked)return getText(n[t].nextSibling);return n[t].checked?n[t+1].value:"";case"choices checkbox":case"choices checkbox plus":for(e=[],r="choices checkbox plus"===o,i=n.length,r&&i--,t=0;i>t;t++)n[t].checked&&e.push(r&&t+1===i?n[i].value:getText(n[t].nextSibling));return e}else switch(o){case"choices":setSelectedOption(n,e,"text");break;case"choices plus":n[0].checked=!0,setSelectedOption(n[1],e,"text"),getSelectedOption(n[1],"text")!==e?(n[2].checked=!0,n[3].value=e):n[3].value="";break;case"choices checkbox":case"choices checkbox plus":for(SPIsArray(e)||(e=[e]),i=n.length,"choices checkbox plus"===o&&(i-=2),t=0;i>t;t++)idx=SPArrayIndexOf(e,getText(n[t].nextSibling)),idx>-1?(n[t].checked=!0,e.splice(idx,1)):n[t].checked=!1;"choices checkbox plus"===o&&(e.length>0?(n[n.length-2].checked=!0,n[n.length-1].value=e[0]):(n[n.length-2].checked=!1,n[n.length-1].value=""));break;case"choices radio":case"choices radio plus":for(r=!1,i=n.length,"choices radio plus"===o&&(i-=2),t=0;i>t;t++)if(getText(n[t].nextSibling)==e){n[t].checked=!0,r=!0;break}"choices radio plus"===o&&(r?n[t+1].value="":(n[t].checked=!0,n[t+1].value=e))}return this};break;case"SPFieldDateTime":obj._type="date",tmp=td.querySelectorAll("input,select,a"),tmp.length>2&&(obj._type+=" time"),obj._elements=obj._elements.concat(tmp),obj.val=function(e){var t=this.elem();return"undefined"!=typeof e?(SPIsArray(e)||(e=[e]),t[0].value=e[0],4===t.length&&(e.length>1&&setSelectedOption(t[2],e[1]),e.length>2&&setSelectedOption(t[3],e[2])),this):4===t.length?[t[0].value,getSelectedOption(t[2],"text"),t[3].value]:t[0].value};break;case"SPFieldLookup":case"SPFieldLookupMulti":obj._type="lookup",obj._elements=td.querySelectorAll('select,input[id$="Button"],button'),"SPFieldLookupMulti"===infoFromComments.SPType?obj._type+=" multiple":obj._elements=obj._elements[0],obj.val=function(v){var params="text";"object"!=typeof v||SPIsArray(v)||(params=v.selectReturn||"text",v=void 0);var type=this.type(),e=this.elem(!1),val=[],o;if("undefined"==typeof v){if("lookup multiple"===type){for(e=e[3].querySelectorAll("option"),v=[],o=0;o<e.length;o++)v.push("text"===params?getText(e[o]):e[o].value);return 0===v.length?"":v}return getSelectedOption(e,params)}if("lookup multiple"===type){SPIsArray(v)||(v=[v]);var clickAdd=e[1].getAttribute("onclick"),clickRemove=e[2].getAttribute("onclick"),masterGroup=window[e[1].getAttribute("id").replace(/AddButton/,"MultiLookup_m")];for(setSelectedOption(e[3],"","all"),clickRemove?eval("!function() {"+clickRemove+"}()"):"function"==typeof GipRemoveSelectedItems&&GipRemoveSelectedItems(masterGroup),setSelectedOption(e[0],"","none"),o=0;o<v.length;o++)setSelectedOption(e[0],v[o],params),clickAdd?eval("!function() {"+clickAdd+"}()"):"function"==typeof GipAddSelectedItems&&GipAddSelectedItems(masterGroup)}else setSelectedOption(e,v,params);return this};break;case"SPFieldBoolean":obj._type="boolean",obj._elements=td.querySelector("input"),obj.val=function(e){var t=this.elem(!1);return"undefined"!=typeof e?(t.checked=1==e,this):t.checked};break;case"SPFieldURL":obj._type="url",obj._elements=td.querySelectorAll("span.ms-formdescription,input"),obj.val=function(e){var t=this.elem();return"undefined"!=typeof e&&(SPIsArray(e)||(e=[e,e]),e.length<2&&(e=[e[0],e[0]]),t[1].value=e[0],t[3].value=e[1]),[t[1].value,t[3].value]}}aReturn.push(obj)}return _SP_CACHE_FORMFIELDS=aReturn.slice(0),settings.includeAll=!1,this.formfields(fields,settings)},each:function(e){for(var t=0,r=this.data.length;r>t;t++)e.call(this.data[t]);return this},val:function(e){var t=!1,r=!1;if("object"!=typeof e||SPIsArray(e)||(t=e.identity===!0?!0:!1,r=e.extend===!0?!0:!1,e=void 0),"undefined"==typeof e){var i=[];return this.each(function(){t===!0?i[this.name()]=this.val():r===!0&&"people"===this.type().slice(0,6)?i.push(this.val({extend:r})):i.push(this.val())}),0===i.length?"":1===i.length?i[0]:i}if("object"!=typeof e)this.each(function(){this.val(e)});else{var n=0;if(this.length>1){if(e.length!==this.length)throw new Error("$SP.formfields.val: the array passed for val() must have the same size as the number of fields in formfields()");this.each(function(){this.val(e[n++])})}else this.each(function(){this.val(e)})}return this},elem:function(e){e=e===!1?!1:!0;var t=[],r="function"==typeof jQuery&&e===!0;switch(this.each(function(){var e=this.elem(!1);t=t.concat(e)}),t.length){case 0:return r?jQuery():null;case 1:return r?jQuery(t[0]):t[0];default:return r?jQuery(t):t}},row:function(){var e=[],t="function"==typeof jQuery;switch(this.each(function(){var t=this.row();t instanceof jQuery==!0&&(t=t[0]),e.push(t)}),e.length){case 0:return t?jQuery():null;case 1:return t?jQuery(e[0]):e[0];default:return t?jQuery(e):e}},type:function(){var e=[];switch(this.each(function(){e.push(this.type())}),e.length){case 0:return"";case 1:return e[0];default:return e}},description:function(){var e=[];switch(this.each(function(){e.push(this.description())}),e.length){case 0:return"";case 1:return e[0];default:return e}},isMandatory:function(){var e=[];switch(this.each(function(){e.push(this.isMandatory())}),e.length){case 0:return!1;case 1:return e[0];default:return e}},name:function(){var e=[];switch(this.each(function(){e.push(this.name())}),e.length){case 0:return"";case 1:return e[0];default:return e}},notify:function(e,t){if(e===undefined)throw"Error 'notify': you must provide the message to show.";if("string"!=typeof e)throw"Error 'notify': you must provide a string for the message to show.";if(t=t||{},t.timeout=isNaN(t.timeout)?5:t.timeout,t.override=t.override===!0?!0:!1,t.overrideAll=t.overrideAll===!0?!0:!1,t.overrideSticky=t.overrideSticky===!1?!1:!0,t.sticky=t.sticky===!0?!0:!1,t.name=t.name||(new Date).getTime(),t.after=t.after||function(){},t.fake=t.fake===!0?!0:!1,t.ignoreQueue=t.ignoreQueue===!0?!0:!1,_SP_NOTIFY_READY===!1)return _SP_NOTIFY_QUEUE.push({message:e,options:t}),$(document).ready(function(){ExecuteOrDelayUntilScriptLoaded(function(){ExecuteOrDelayUntilScriptLoaded(function(){_SP_NOTIFY_READY=!0,$SP().notify("fake",{fake:!0})},"core.js")},"sp.js")}),this;if(t.ignoreQueue!==!0)for(;_SP_NOTIFY_QUEUE.length>0;){var r=_SP_NOTIFY_QUEUE.shift();r.options.ignoreQueue=!0,$SP().notify(r.message,r.options)}if(t.fake!==!0){if(_SP_NOTIFY.length>0&&(t.overrideAll?$SP().removeNotify({all:!0,includeSticky:t.overrideSticky}):t.override&&$SP().removeNotify(_SP_NOTIFY[_SP_NOTIFY.length-1].name)),_SP_NOTIFY.push({name:t.name,id:SP.UI.Notify.addNotification(e,!0),options:t}),!t.sticky){setTimeout(function(){$SP().removeNotify(t.name,{timeout:!0})},1e3*t.timeout)}return this}},removeNotify:function(e,t){switch(arguments.length){case 0:throw"Error 'removeNotify': you must provide 'name' or 'options'.";case 2:if("object"!=typeof t)throw"Error 'removeNotify': you must provide an object for 'options'."}if(1===arguments.length&&"object"==typeof e&&(t=e,e=undefined),t=t||{all:!1},t.timeout=t.timeout===!0?!0:!1,_SP_NOTIFY_READY===!1&&_SP_NOTIFY_QUEUE.length>0)return setTimeout(function(){$SP().removeNotify(e,t)},150),this;var r,i=this;if(t.all===!0){for(var n=[];_SP_NOTIFY.length>0;)r=_SP_NOTIFY.shift(),t.includeSticky===!1&&r.options.sticky===!0?n.push(r):(SP.UI.Notify.removeNotification(r.id),setTimeout(function(){r.options.after.call(i,r.name,!1)},150));_SP_NOTIFY=n.slice(0)}else if(e!==undefined)for(var o=0,s=_SP_NOTIFY.length;s>o;o++)if(_SP_NOTIFY[o].name==e)return r=_SP_NOTIFY.splice(o,1)[0],SP.UI.Notify.removeNotification(r.id),setTimeout(function(){r.options.after.call(i,r.name,t.timeout)},150),this;return this},registerPlugin:function(e,t){if("undefined"!=typeof _SP_PLUGINS[e])throw"Error 'registerPlugin': '"+e+"' is already registered.";return _SP_PLUGINS[e]=t,!0},plugin:function(e,t){if(t=t||{},"function"!=typeof _SP_PLUGINS[e])throw"Error $SP().plugin: the plugin '"+e+"' is not registered.";return _SP_PLUGINS[e].call(this,t),this}};var myElem=function(){var e=function(e){return new t(e)},t=function(e){return this.mynode=e,this.singleList=!0,this};return e.fn=t.prototype={getAttribute:function(e){return this.mynode.getAttribute("ows_"+e.replace(/ /g,""))},getAttributes:function(){return this.mynode.attributes}},e}(),extendMyObject=function(e){this.attributes=e};return extendMyObject.prototype.getAttribute=function(e){return this.attributes[e]},extendMyObject.prototype.getAttributes=function(){return this.attributes},SharepointPlus.prototype.noConflict=function(){window._$SP=window._SharepointPlus=window.$SP},window.$SP=window.SharepointPlus=SharepointPlus}(this,document);