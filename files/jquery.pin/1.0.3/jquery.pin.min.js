(function(e){"use strict";e.fn.pin=function(t){var n=0,r=[],i=!1,s=e(window);t=t||{};var o=function(){for(var n=0,o=r.length;n<o;n++){var u=r[n];if(t.minWidth&&s.width()<=t.minWidth){u.parent().is(".pin-wrapper")&&u.unwrap(),u.css({width:"",left:"",top:"",position:""}),i=!0;continue}i=!1;var a=t.containerSelector?u.closest(t.containerSelector):e(document.body),f=u.offset(),l=a.offset(),c=u.offsetParent().offset();u.parent().is(".pin-wrapper")||u.wrap("<div class='pin-wrapper'>"),u.data("pin",{from:t.containerSelector?l.top:f.top,to:l.top+a.height()-u.outerHeight(),end:l.top+a.height(),parentTop:c.top}),u.css({width:u.outerWidth()}),u.parent().css("height",u.outerHeight())}},u=function(){if(i)return;n=s.scrollTop();for(var t=0,o=r.length;t<o;t++){var u=e(r[t]),a=u.data("pin"),f=a.from,l=a.to;if(f+u.outerHeight()>a.end){u.css("position","");continue}f<n&&l>n?u.css("position")!="fixed"&&u.css({left:u.offset().left,top:0}).css("position","fixed"):n>=l?u.css({left:"auto",top:l-a.parentTop}).css("position","absolute"):u.css({position:"",top:"",left:""})}},a=function(){o(),u()};return this.each(function(){var t=e(this),n=e(this).data("pin")||{};if(n&&n.update)return;r.push(t),e("img",this).one("load",o),n.update=a,e(this).data("pin",n)}),s.scroll(u),s.resize(function(){o()}),o(),s.load(a),this}})(jQuery);