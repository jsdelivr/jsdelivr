/*! formstone v0.7.6 [asap.js] 2015-07-18 | MIT License | formstone.it */

!function(a,b,c){"use strict";function d(c){q||b.support.history&&(o=b.$body,q=a.extend(s,c),q.$container=a(q.container),q.render===a.noop&&(q.render=k),q.transitionOut===a.noop&&(q.transitionOut=function(){return a.Deferred().resolve()}),y=window.location.href,t.on(w.popState,h),e())}function e(){o&&!o.hasClass(x.base)&&o.on(w.click,s.selector,g).addClass(x.base)}function f(a){q&&b.support.history?a&&i(a):window.location.href=a}function g(a){var b=a.currentTarget;a.which>1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey||window.location.protocol!==b.protocol||window.location.host!==b.host||"_blank"===b.target||(!b.hash||b.href.replace(b.hash,"")!==window.location.href.replace(location.hash,"")&&b.href!==window.location.href+"#")&&(v.killEvent(a),a.stopImmediatePropagation(),b.href===y||i(b.href))}function h(a){var b=a.originalEvent.state;b&&(q.modal&&0===z&&b.url&&!b.initial?window.location.href=b.url:b.url!==y&&(q.force?i(b.url):(t.trigger(w.request,[!0]),j(b.url,b.hash,b.data,b.scroll,!1))))}function i(b){p&&p.abort(),t.trigger(w.request,[!1]),q.transitionOutDeferred=q.transitionOut.apply(u,[!1]);var c=b.indexOf("?"),d=b.indexOf("#"),e={},f="",g=b,h="User error",i=null,k=a.Deferred();d>-1&&(f=b.slice(d),g=b.slice(0,d)),c>-1&&(e=n(b.slice(c+1,d>-1?d:b.length)),g=b.slice(0,c)),e[q.requestKey]=!0,p=a.ajax({url:g,data:e,dataType:"json",cache:q.cache,xhr:function(){var a=new u.XMLHttpRequest;return a.addEventListener("progress",function(a){if(a.lengthComputable){var b=a.loaded/a.total;t.trigger(w.progress,[b])}},!1),a},success:function(c,d,e){i="string"===a.type(c)?a.parseJSON(c):c,c.location&&(b=c.location),k.resolve()},error:function(a,b,c){h=c,k.reject()}}),a.when(k,q.transitionOutDeferred).done(function(){j(b,f,i,q.jump?0:!1,!0)}).fail(function(){t.trigger(w.error,[h])})}function j(b,c,d,e,f){if(t.trigger(w.load,[d]),m(b),l(d),q.render.call(this,d,c),y=b,f?(history.pushState({url:y,data:d,scroll:e,hash:c},"state-"+y,y),z++):l(d),t.trigger(w.render,[d]),""!==c){var g=a(c);g.length&&(e=g.offset().top)}e!==!1&&t.scrollTop(e)}function k(b,c){if("undefined"!==a.type(b)){var d;for(var e in b)b.hasOwnProperty(e)&&(d=a(e),d.length&&d.html(b[e]))}}function l(b){var c=[];if("undefined"!==a.type(b)){var d;for(var e in b)b.hasOwnProperty(e)&&(d=a(e),d.length&&(c[e]=d.html()))}history.replaceState({url:y,data:c,scroll:t.scrollTop()},"state-"+y,y)}function m(b){if(b=b.replace(window.location.protocol+"//"+window.location.host,""),q.tracking.legacy)u._gaq=u._gaq||[],u._gaq.push(["_trackPageview",b]);else if(q.tracking.manager){var c={};c[q.tracking.variable]=b,u.dataLayer=window.dataLayer||[],u.dataLayer.push(c),u.dataLayer.push({event:q.tracking.event})}else"undefined"!==a.type(u.ga)&&u.ga("send","pageview",b)}function n(a){for(var b={},c=a.slice(a.indexOf("?")+1).split("&"),d=0;d<c.length;d++){var e=c[d].split("=");b[e[0]]=e[1]}return b}var o,p,q,r=b.Plugin("asap",{utilities:{_initialize:d,load:f},events:{popState:"popstate",progress:"progress",request:"request",render:"render"}}),s={cache:!0,force:!1,jump:!0,modal:!1,selector:"a",render:a.noop,requestKey:"fs-asap",tracking:{legacy:!1,manager:!1,variable:"currentURL",event:"PageView"},transitionOut:a.noop},t=b.$window,u=t[0],v=r.functions,w=r.events,x=r.classes.raw,y="",z=0}(jQuery,Formstone);