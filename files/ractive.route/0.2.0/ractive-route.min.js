/*!
 * ractive-route 0.2.0
 * https://github.com/MartinKolarik/ractive-route/
 *
 * Copyright (c) 2014 Martin KolÃ¡rik
 * martin@kolarik.sk
 * https://kolarik.me
 *
 * Licensed under the MIT license
 * http://www.opensource.org/licenses/MIT
 */
!function(a){"undefined"!=typeof module&&module.exports?module.exports=a(require("ractive")):"function"==typeof define&&define.amd?define(["ractive"],a):a(window.Ractive)}(function(a){function b(a,b,e,g){this.pattern=a,this.map=c(a),this.regExp=d(a),this.strictRegExp=f(a),this.isComponent=!!b.extend,this.Handler=b,this.observe=i({qs:[],hash:[],state:[]},e),this.allObserved=this.observe.qs.concat(this.observe.hash,this.observe.state),this.router=g||{},this.view=null}function c(a){return(a.match(/\/:\w+/g)||[]).map(function(a){return a.substr(2)})}function d(a){return new RegExp(e(a).replace(/^\^(\\\/)?/,"^\\/?").replace(/(\\\/)?\$$/,"\\/?$"),"i")}function e(a){return("^"+a+"$").replace(/\/:\w+(\([^)]+\))?/g,"(?:/([^/]+)$1)").replace(/\(\?:\/\(\[\^\/]\+\)\(/,"(?:/(").replace(/\//g,"\\/")}function f(a){return new RegExp(e(a))}function g(a){this.basePath=a.basePath||"",this.el=a.el,this.data=a.data||function(){return{}},this.history=a.history||history,this.strictMode=!!a.strictMode,this.linksWatcher=null,this.stateWatcher=null,this.route=null,this.routes=[],this.uri={}}function h(a,b,c){return a.path!==b.path||a.qs!==b.qs||decodeURIComponent(a.hash)!==decodeURIComponent(b.hash)&&(!c||c.observe.hash.length)}function i(a){for(var b=1,c=arguments.length;c>b;b++)for(var d in arguments[b])arguments[b].hasOwnProperty(d)&&void 0!==arguments[b][d]&&(a[d]=arguments[b][d]);return a}function j(a){return r(a,function(a){return!k(a)})}function k(a){return a&&"object"==typeof a?!Object.keys(a).length:!a}function l(){return Array.prototype.slice.call(arguments).join("/").replace(/\/+/g,"/")}function m(a,b){for(;a&&a.nodeName.toLowerCase()!==b;)a=a.parentNode;return a&&a.nodeName.toLowerCase()===b?a:null}function n(a,b){try{var c=j(JSON.parse(decodeURIComponent(a.substr(2))));return b?r(c,b):c}catch(d){return{}}}function o(a){try{return JSON.parse(a)}catch(b){return a||""}}function p(a){var b=a.match(/^(?:([\w+.-]+):\/\/([^/]+))?([^?#]*)?(\?[^#]*)?(#.*)?/);return{protocol:b[1]||"",host:b[2]||"",path:b[3]||"",qs:b[4]||"",hash:b[5]||""}}function q(a,b){var c=a.indexOf("?"),d={};if(-1!==c)for(var e=a.substr(c+1).split("&"),f=[],g=0,h=e.length;h>g;g++)f=e[g].split("="),k(f[1])||k(o(f[1]))||(d[decodeURIComponent(f[0])]=o(decodeURIComponent(f[1])));return b?r(d,b):d}function r(a,b){var c={};if("function"==typeof b)for(var d in a)a.hasOwnProperty(d)&&b(a[d],d)&&(c[d]=a[d]);else for(var e=0,f=b.length;f>e;e++)c[b[e]]=a[b[e]];return c}function s(a){var b=document.getElementById(a);b?window.scrollBy(0,b.getBoundingClientRect().top):window.scrollTo(0,0)}function t(a){return a&&"object"==typeof a?JSON.stringify(a):a}function u(a){return a=j(a),k(a)?"":"#!"+encodeURIComponent(t(a))}function v(a){var b="";for(var c in a)a.hasOwnProperty(c)&&!k(a[c])&&(b+="&"+encodeURIComponent(c)+"="+encodeURIComponent(t(a[c])));return b?"?"+b.substr(1):""}return b.prototype.destroy=function(){return this.view&&(this.view.teardown(),this.view=null),this},b.prototype.getState=function(){for(var a={},b=0,c=this.allObserved.length;c>b;b++)a[this.allObserved[b]]=this.view.get(this.allObserved[b]);return{qs:r(a,this.observe.qs),hash:r(a,this.observe.hash),state:r(a,this.observe.state)}},b.prototype.init=function(a,b){var c=this;return i(b,this.parsePath(a.path),q(a.qs,this.observe.qs),n(a.hash,this.observe.hash)),this.isComponent?(this.view=new this.Handler({el:this.router.el,data:b}),this.allObserved.length&&this.view.observe(this.allObserved.join(" "),function(){c.updating||c.router.update()},{init:!1}),this.view.set("__ready",!0)):this.Handler({el:this.router.el,data:b,uri:this.router.uri}),this},b.prototype.match=function(a,b){return b?this.strictRegExp.test(a):this.regExp.test(a)},b.prototype.parsePath=function(a){for(var b=a.match(this.regExp),c={},d=0,e=this.map.length;e>d;d++)k(b[d+1])||(c[this.map[d]]=o(b[d+1]));return c},g.prototype.addRoute=function(a,c,d){return this.routes.push(new b(a,c,d,this)),this},g.prototype.buildHash=function(a){var b=this.route.getState().hash;return k(b)&&a?a:u(b)},g.prototype.buildQS=function(a){return v(i.apply(null,[{}].concat(a,this.route.getState().qs)))},g.prototype.dispatch=function(a,b){b=b||{};var c=p(a),d=this.match(c.path),e=this.uri;if(!d)return this.redirect(a);if(b.reload||h(this.uri,c,d)){var f="function"==typeof this.data?this.data():this.data,g=i(f,b.state,b.hash,b.qs);this.route&&this.route.destroy(),this.uri=c,this.route=d.init(c,g)}return s(c.hash.substr(1)),this.update(!e.path||e.path!==c.path,!b.noHistory,c)},g.prototype.getUri=function(){return location.pathname.substr(this.basePath.length)+location.search+location.hash},g.prototype.init=function(a){return this.dispatch(this.getUri(),i({noHistory:!0},a))},g.prototype.match=function(a){for(var b=-1;this.routes[++b];)if(this.routes[b].match(a))return this.routes[b];return null},g.prototype.redirect=function(a){return location.pathname=l(this.basePath,a),this},g.prototype.unwatchLinks=function(){return this.linksWatcher&&(document.body.removeEventListener("click",this.linksWatcher),this.linksWatcher=null),this},g.prototype.unwatchState=function(){return this.stateWatcher&&(window.removeEventListener("popstate",this.stateWatcher),this.stateWatcher=null),this},g.prototype.update=function(a,b,c){if(!this.route)return this;c=c||{qs:"",hash:""};var d=l(this.basePath,this.uri.path),e=this.buildQS([q(c.qs)].concat(a?[]:[q(location.search)])),f=this.buildHash(c.hash),g=d+e+f,h=location.pathname+location.search+location.hash,i=this.route.getState().state;return this.uri.qs=e,this.uri.hash=f,b===!0?this.history.pushState(i,null,g):b===!1?this.history.replaceState(i,null,g):g!==h&&this.history.pushState(i,null,g),this},g.prototype.watchLinks=function(a){a=a||new RegExp("^((https?:)?\\/\\/"+location.hostname.replace(/\./g,"\\.")+".*|((?!\\/\\/)[^:]+))$");var b=this;return document.body.addEventListener("click",this.unwatchLinks().linksWatcher=function(c){var d=m(c.target,"a");if(d){var e=d.getAttribute("href")||d.getAttribute("data-href");e&&!d.classList.contains("router-ignore")&&a.test(e)&&(b.dispatch(e),c.preventDefault())}}),this},g.prototype.watchState=function(){var a=this;return window.addEventListener("popstate",this.unwatchState().stateWatcher=function(b){b.state&&a.init({state:b.state})}),this},g.Route=b,a.Router=g});
//# sourceMappingURL=ractive-route.min.map