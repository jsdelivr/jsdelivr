/*
 * System Runtime
 * 
 * https://designfirst.io/systemruntime/
 * 
 * Copyright 2017 Erwan Carriou
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.runtime=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d={models:{"138a81fa1f16435":{_id:"138a81fa1f16435",_name:"RuntimeAdmin",_inherit:["RuntimeComponent"],_core:!0,start:{},designerWindow:{type:"object",readOnly:!1,mandatory:!1,default:null}},"135c71078810af2":{_id:"135c71078810af2",_name:"RuntimeChannel",_inherit:["RuntimeComponent"],_core:!0,$editorUpdateSchemaName:{params:[{name:"name",type:"string"},{name:"id",type:"string"}]},$designerSync:{},$appLoadSystem:{params:[{name:"system",type:"object"}]},$designerCreateBehavior:{params:[{name:"behavior",type:"object"}]},$editorUpdateBehavior:{params:[{name:"id",type:"string"},{name:"behavior",type:"object"}]},$designerUpdateBehavior:{params:[{name:"id",type:"string"},{name:"behavior",type:"object"}]},$editorDeleteBehavior:{params:[{name:"id",type:"string"}]},$designerDeleteBehavior:{params:[{name:"id",type:"string"}]},$designerCreateComponent:{params:[{name:"collection",type:"string"},{name:"component",type:"object"}]},$editorUpdateComponent:{params:[{name:"id",type:"string"},{name:"collection",type:"string"},{name:"component",type:"object"}]},$designerUpdateComponent:{params:[{name:"id",type:"string"},{name:"collection",type:"string"},{name:"component",type:"object"}]},$editorDeleteComponent:{params:[{name:"id",type:"string"},{name:"collection",type:"string"}]},$designerDeleteComponent:{params:[{name:"id",type:"string"},{name:"collection",type:"string"}]},$designerCreateType:{params:[{name:"id",type:"string"},{name:"type",type:"object"}]},$editorUpdateType:{params:[{name:"id",type:"string"},{name:"type",type:"object"}]},$editorDeleteType:{params:[{name:"id",type:"string"}]},$designerCreateSchema:{params:[{name:"id",type:"string"},{name:"schema",type:"object"}]},$editorUpdateSchema:{params:[{name:"id",type:"string"},{name:"schema",type:"object"}]},$editorUpdateSchemaId:{params:[{name:"oldId",type:"string"},{name:"newId",type:"string"}]},$designerDeleteSchema:{params:[{name:"id",type:"string"}]},$designerCreateModel:{params:[{name:"id",type:"string"},{name:"model",type:"object"}]},$editorUpdateModel:{params:[{name:"id",type:"string"},{name:"model",type:"object"}]},$designerUpdateModel:{params:[{name:"id",type:"string"},{name:"model",type:"object"}]},$editorUpdateModelId:{params:[{name:"oldId",type:"string"},{name:"newId",type:"string"}]},$designerDeleteModel:{params:[{name:"id",type:"string"}]},$editorUpdateSystem:{params:[{name:"id",type:"string"},{name:"system",type:"object"}]},$appLogDebug:{params:[{name:"message",type:"string"}]},$appLogInfo:{params:[{name:"message",type:"string"}]},$appLogWarn:{params:[{name:"message",type:"string"}]},$appLogError:{params:[{name:"message",type:"string"}]},$runtimeCreateComponent:{params:[{name:"collection",type:"string"},{name:"component",type:"object"}]},$runtimeDeleteComponent:{params:[{name:"id",type:"string"},{name:"collection",type:"string"}]},$runtimeUpdateComponent:{params:[{name:"id",type:"string"},{name:"collection",type:"string"},{name:"field",type:"string"},{name:"value",type:"any"}]},send:{params:[{name:"message",type:"message"}]},$systemInstalled:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemResolved:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemUninstalled:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemStarted:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemStopped:{params:[{name:"id",type:"string",mandatory:!0,default:""}]}},"1f4141671514c2c":{_id:"1f4141671514c2c",_name:"RuntimeStorage",get:{params:[{name:"key",type:"string",mandatory:!0,default:""}]},set:{params:[{name:"key",type:"string",mandatory:!0,default:""},{name:"value",type:"any",mandatory:!0,default:null}]},changed:{params:[{name:"changed",type:"object",mandatory:!0,default:{}}]},clear:{},remove:{params:[{name:"key",type:"string",mandatory:!0,default:""}]},_core:!0,store:{type:"object",readOnly:!1,mandatory:!1,default:{}}},"14c7c105b31a160":{_id:"14c7c105b31a160",_name:"Runtime",_core:!0,version:{type:"string",readOnly:!0,mandatory:!0,default:"0.0.0"},system:{params:[{name:"name",type:"string",mandatory:!1}],result:"object"},message:{params:[{name:"msg",type:"message",mandatory:!0}]},ready:{}},"166971fd9d107fd":{_name:"RuntimeBehavior",_core:!0,core:{type:"boolean",readOnly:!1,mandatory:!1,default:!1},useCoreAPI:{type:"boolean",readOnly:!1,mandatory:!1,default:!1},component:{type:"string",readOnly:!1,mandatory:!0,default:""},action:{type:"javascript",readOnly:!1,mandatory:!0,default:""},state:{type:"string",readOnly:!1,mandatory:!0,default:""},_id:"166971fd9d107fd"},"158321dced1014a":{_name:"RuntimeClassInfo",_core:!0,model:{type:"object",readOnly:!0,mandatory:!0,default:{}},property:{params:[{name:"name",type:"string"}],result:"object"},properties:{result:"array"},link:{params:[{name:"name",type:"string"}],result:"object"},links:{result:"array"},method:{params:[{name:"name",type:"string"}],result:"object"},methods:{result:"array"},collection:{params:[{name:"name",type:"string"}],result:"object"},collections:{result:"array"},event:{params:[{name:"name",type:"string"}],result:"object"},events:{result:"array"},_id:"158321dced1014a",schema:{type:"object",readOnly:!0,mandatory:!0,default:{}}},"123751cb591de26":{_id:"123751cb591de26",_name:"RuntimeComponent",_core:!0,on:{params:[{name:"state",type:"string"},{name:"handler",type:"function"},{name:"useCoreAPI",type:"boolean",mandatory:!1,default:!1},{name:"isCore",type:"boolean",mandatory:!1,default:!1}]},off:{params:[{name:"state",type:"string",mandatory:!1},{name:"behaviorId",type:"string",mandatory:!1}]},require:{params:[{name:"id",type:"string"}]},destroy:{params:[]},classInfo:{type:"@RuntimeClassInfo",readOnly:!1,mandatory:!1,default:{}},init:{params:[{name:"conf",type:"object"}]},error:{params:[{name:"data",type:"errorParam"}]}},"18a51169d7112d4":{_name:"RuntimeDatabase",_core:!0,system:{params:[{name:"system",type:"object",mandatory:!1}],result:"string"},subsystem:{params:[{name:"params",type:"object"}],result:"string"},collections:{result:"object"},insert:{params:[{name:"event",type:"dbInsertEvent"}]},update:{params:[{name:"event",type:"dbUpdateEvent"}]},remove:{params:[{name:"event",type:"dbRemoveEvent"}]},_id:"18a51169d7112d4"},"16b9d1ac2216ffe":{_id:"16b9d1ac2216ffe",_name:"RuntimeLogger",_core:!0,level:{type:"log",readOnly:!1,mandatory:!1,default:"warn"},debug:{params:[{name:"message",type:"any"}]},info:{params:[{name:"message",type:"any"}]},warn:{params:[{name:"message",type:"any"}]},error:{params:[{name:"message",type:"any"}]}},"1d9b6139411aa91":{_name:"RuntimeMessage",_core:!0,event:{type:"string",readOnly:!1,mandatory:!0,default:""},from:{type:"string",readOnly:!1,mandatory:!0,default:""},data:{type:"array",readOnly:!1,mandatory:!0,default:[]},_id:"1d9b6139411aa91"},"1628c13c22152e6":{_name:"RuntimeMetamodel",_core:!0,schema:{params:[{name:"schema",type:"object"}],result:"any"},model:{params:[{name:"model",type:"object"}],result:"any"},type:{params:[{name:"type",type:"object"}],result:"any"},create:{params:[]},_id:"1628c13c22152e6"},"177ac136891629f":{_name:"RuntimeState",_core:!0,name:{type:"string",readOnly:!1,mandatory:!0,default:""},parameters:{type:"object",readOnly:!1,mandatory:!1,default:{}},_id:"177ac136891629f"},"170521b88614387":{_name:"RuntimeSystem",_core:!0,name:{type:"string",readOnly:!1,mandatory:!0,default:""},master:{type:"boolean",readOnly:!1,mandatory:!1,default:!1},subsystem:{type:"boolean",readOnly:!1,mandatory:!1,default:!1},version:{type:"string",readOnly:!1,mandatory:!1,default:"0.0.1"},description:{type:"string",readOnly:!1,mandatory:!1,default:""},schemas:{type:"object",readOnly:!1,mandatory:!1,default:{}},models:{type:"object",readOnly:!1,mandatory:!1,default:{}},behaviors:{type:"object",readOnly:!1,mandatory:!1,default:{}},types:{type:"object",readOnly:!1,mandatory:!1,default:{}},components:{type:"object",readOnly:!1,mandatory:!1,default:{}},ready:{},sync:{},main:{},_id:"170521b88614387"},"100b91ed2211b15":{_id:"100b91ed2211b15",_name:"RuntimeOSGi",install:{params:[{name:"url",type:"any",mandatory:!0,default:""},{name:"async",type:"boolean",mandatory:!1,default:!0}],result:"string"},uninstall:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},start:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},stop:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},status:{result:"object"},_core:!0,bundle:{result:"string"}},"1b2811b092143f5":{_id:"1b2811b092143f5",_name:"RuntimeSystemOSGi",start:{},stop:{},_core:!0,state:{type:"string",readOnly:!1,mandatory:!1,default:"none"},location:{type:"string",readOnly:!1,mandatory:!1,default:""},uninstall:{},bundle:{result:"string"}}},schemas:{"10374180581a41f":{_id:"10374180581a41f",_name:"RuntimeAdmin",_inherit:["RuntimeComponent"],_core:!0,designerWindow:"property",start:"method"},"104ad1f48518376":{_id:"104ad1f48518376",_name:"RuntimeChannel",_core:!0,$editorUpdateSystem:"event",$editorUpdateSchema:"event",$editorUpdateSchemaId:"event",$editorUpdateSchemaName:"event",$editorUpdateModel:"event",$editorUpdateModelId:"event",$editorUpdateType:"event",$editorDeleteType:"event",$editorUpdateBehavior:"event",$editorDeleteBehavior:"event",$editorUpdateComponent:"event",$editorDeleteComponent:"event",$appLogDebug:"event",$appLogInfo:"event",$appLogWarn:"event",$appLogError:"event",$appLoadSystem:"event",$designerSync:"event",$designerCreateBehavior:"event",$designerCreateComponent:"event",$designerCreateType:"event",$designerCreateSchema:"event",$designerCreateModel:"event",$designerDeleteSchema:"event",$designerDeleteModel:"event",$designerDeleteType:"event",$designerDeleteBehavior:"event",$designerDeleteComponent:"event",$designerUpdateComponent:"event",$designerUpdateModel:"event",$designerUpdateBehavior:"event",$runtimeCreateComponent:"event",$runtimeDeleteComponent:"event",$runtimeUpdateComponent:"event",_inherit:["RuntimeComponent"],send:"event",$systemInstalled:"event",$systemResolved:"event",$systemStarted:"event",$systemStopped:"event",$systemUninstalled:"event"},"12fa8181ce127a0":{_id:"12fa8181ce127a0",_name:"RuntimeStorage",_inherit:["RuntimeComponent"],_core:!0,store:"property",get:"method",set:"method",remove:"method",clear:"method",changed:"event"},"12e211d4cd120a6":{_id:"12e211d4cd120a6",_name:"Runtime",_inherit:["RuntimeOSGi"],_core:!0,version:"property",system:"method",message:"method",ready:"event"},"1ac07185641fa9f":{_name:"RuntimeBehavior",_inherit:["RuntimeComponent"],_core:!0,core:"property",component:"property",action:"property",state:"property",useCoreAPI:"property",_id:"1ac07185641fa9f"},"1c00b13a1b1bc92":{_name:"RuntimeClassInfo",_inherit:["RuntimeComponent"],_core:!0,model:"property",schema:"property",method:"method",methods:"method",property:"method",properties:"method",link:"method",links:"method",collections:"method",collection:"method",event:"method",events:"method",_id:"1c00b13a1b1bc92"},"111df11e2b19fde":{_id:"111df11e2b19fde",_name:"RuntimeComponent",_inherit:[],_core:!0,classInfo:"property",on:"method",off:"method",require:"method",destroy:"method",init:"method",error:"event"},"1723516a30132ac":{_name:"RuntimeDatabase",_inherit:["RuntimeComponent"],_core:!0,system:"method",subsystem:"method",collections:"method",insert:"event",update:"event",remove:"event",_id:"1723516a30132ac"},"1268f1dddd1fea7":{_name:"RuntimeLogger",_core:!0,level:"property",debug:"method",info:"method",warn:"method",error:"method",_id:"1268f1dddd1fea7"},"14caa1c46414ee1":{_name:"RuntimeMessage",_inherit:["RuntimeComponent"],_core:!0,event:"property",from:"property",data:"property",_id:"14caa1c46414ee1"},"193f1166eb16609":{_name:"RuntimeMetamodel",_inherit:["RuntimeComponent"],_core:!0,schema:"method",model:"method",type:"method",create:"method",_id:"193f1166eb16609"},"158711d6f215e4b":{_name:"RuntimeState",_inherit:[],_core:!0,_class:!1,name:"property",parameters:"property",_id:"158711d6f215e4b"},"1cb761fa4510dca":{_id:"1cb761fa4510dca",_name:"RuntimeSystem",_inherit:["RuntimeSystemOSGi"],_core:!0,name:"property",master:"property",subsystem:"property",version:"property",description:"property",schemas:"property",models:"property",behaviors:"property",types:"property",components:"property",sync:"method",main:"method",ready:"event"},"157931f7a31b61d":{_id:"157931f7a31b61d",_name:"RuntimeOSGi",_inherit:["RuntimeComponent"],_core:!0,install:"method",uninstall:"method",start:"method",stop:"method",status:"method",bundle:"method"},"145fe10c7514298":{_id:"145fe10c7514298",_name:"RuntimeSystemOSGi",_inherit:["RuntimeComponent"],_core:!0,state:"property",location:"property",start:"method",stop:"method",uninstall:"method",bundle:"method"}},types:{collection:{name:"collection",type:"object",schema:{type:{type:["string"],mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},default:{type:"object",mandatory:!0},description:{type:"string",mandatory:!1},label:{type:"string",mandatory:!1}},core:!0},css:{name:"css",type:"string",core:!0},date:{name:"date",type:"object",core:!0},errorParam:{name:"errorParam",type:"object",schema:{message:{type:"string",mandatory:!0},error:{type:"object",mandatory:!0}},core:!0},event:{name:"event",type:"object",schema:{params:{type:["parameter"],mandatory:!1},description:{type:"string",mandatory:!1}},core:!0},html:{name:"html",type:"string",core:!0},javascript:{name:"javascript",type:"string",core:!0},json:{name:"json",type:"object",core:!0},link:{name:"link",type:"object",schema:{type:{type:"string",mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},default:{type:"@type",mandatory:!0},description:{type:"string",mandatory:!1},label:{type:"string",mandatory:!1}},core:!0},log:{name:"log",type:"string",value:["debug","info","warn","error"],core:!0},message:{name:"message",type:"object",schema:{event:{type:"string",mandatory:!0},from:{type:"string",mandatory:!1},data:{type:"object",mandatory:!0}},core:!0},method:{name:"method",type:"object",schema:{result:{type:"string",mandatory:!1},params:{type:["parameter"],mandatory:!1},description:{type:"string",mandatory:!1}},core:!0},parameter:{name:"parameter",type:"object",schema:{name:{type:"string",mandatory:!0},type:{type:"string",mandatory:!0},mandatory:{type:"boolean",mandatory:!1},default:{type:"@type",mandatory:!1}},core:!0},property:{name:"property",type:"object",schema:{type:{type:"string",mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},default:{type:"@type",mandatory:!0},description:{type:"string",mandatory:!1},label:{type:"string",mandatory:!1}},core:!0},osgiStates:{name:"osgiStates",type:"string",value:["none","installed","resolved","starting","active","stopping","uninstalled"],core:!0},text:{name:"text",type:"string",core:!0},dbInsertEvent:{_id:"148ef1e19810e6d",name:"dbInsertEvent",type:"object",schema:{collection:{type:"string",mandatory:!0,default:""},document:{type:"object",mandatory:!0,default:{}}}},dbRemoveEvent:{_id:"1952e1ac4213f4a",name:"dbRemoveEvent",type:"object",schema:{collection:{type:"string",mandatory:!0,default:""},id:{type:"string",mandatory:!0,default:""}}},dbUpdateEvent:{_id:"1f5c41309711752",name:"dbUpdateEvent",type:"object",schema:{collection:{type:"string",mandatory:!0,default:""},id:{type:"string",mandatory:!0,default:""},field:{type:"string",mandatory:!0,default:""},value:{type:"any",mandatory:!0,default:null}}}},behaviors:{"1c00c107e01c9b3":{_id:"1c00c107e01c9b3",component:"RuntimeAdmin",state:"start",action:"function start() {\n    var RuntimeChannel = null,\n        channel = null,\n        db = this.require('db');\n\n    if (!this.require('channel-admin')) {\n        RuntimeChannel = this.require('RuntimeChannel');\n        channel = new RuntimeChannel({\n            '_id': 'channel-admin',\n            '_core': true\n        });\n        \n        // for jquery compatibility in electron\n        if (typeof global !== 'undefined' && typeof window !== 'undefined') {\n            delete module;\n        }\n\n        channel.on('send', function send(message) {\n            this.require('admin').designerWindow().postMessage(JSON.stringify(message), '*');\n        }, false, true);\n\n        // schema change events\n        channel.on('$designerCreateSchema', function $designerCreateSchema(id, schema) {\n            this.require('logger').level('warn');\n            this.require('metamodel').schema(schema);\n            this.require('metamodel').create();\n            this.require('logger').level('debug');\n        }, true, true);\n\n        channel.on('$editorUpdateSchema', function $editorUpdateSchema(id, schema) {\n            this.require('logger').level('warn');\n            this.require('metamodel').schema(schema);\n            this.require('metamodel').create();\n            this.require('logger').level('debug');\n        }, true, true);\n\n        channel.on('$designerDeleteSchema', function $designerDeleteSchema(id) {\n            this.require('logger').level('warn');\n            var search = $db.RuntimeSchema.find({ '_id': id }),\n                modelName = '',\n                modelId = '';\n\n            if (search.length) {\n                modelName = search[0]._name;\n                $db.RuntimeSchema.remove({ '_id': id });\n\n                search = $db.RuntimeModel.find({ '_name': modelName });\n                if (search.length) {\n                    modelId = search[0]._id;\n                    $db.RuntimeModel.remove({ '_id': modelId });\n                    $component.removeFromMemory(modelName);\n                }\n\n                search = $db.RuntimeGeneratedModel.find({ '_name': modelName });\n                if (search.length) {\n                    modelId = search[0]._id;\n                    $db.RuntimeGeneratedModel.remove({ '_id': modelId });\n                    $component.removeFromMemory(modelName);\n                }\n                this.require('metamodel').create();\n            }\n            this.require('logger').level('debug');\n        }, true, true);\n\n        // model change events\n        channel.on('$designerCreateModel', function $designerCreateModel(id, model) {\n            this.require('logger').level('warn');\n            this.require('metamodel').model(model);\n            this.require('metamodel').create();\n            this.require('logger').level('debug');\n        }, true, true);\n\n        channel.on('$editorUpdateModel', function $editorUpdateModel(id, model) {\n            this.require('logger').level('warn');\n            this.require('metamodel').model(model);\n            this.require('metamodel').create();\n            this.require('logger').level('debug');\n        }, true, true);\n\n        channel.on('$designerUpdateModel', function $designerUpdateModel(id, model) {\n            this.require('logger').level('warn');\n            this.require('metamodel').model(model);\n            this.require('metamodel').create();\n            this.require('logger').level('debug');\n        }, true, true);\n\n        channel.on('$designerDeleteModel', function $designerDeleteModel(id) {\n            this.require('logger').level('warn');\n            var search = $db.RuntimeModel.find({ '_id': id }),\n                modelName = '',\n                modelId = '';\n\n            if (search.length) {\n                modelName = search[0]._name;\n                $db.RuntimeModel.remove({ '_id': id });\n                $component.removeFromMemory(modelName);\n            }\n\n            search = $db.RuntimeGeneratedModel.find({ '_name': modelName });\n            if (search.length) {\n                modelId = search[0]._id;\n                $db.RuntimeGeneratedModel.remove({ '_id': modelId });\n                $component.removeFromMemory(modelName);\n            }\n            this.require('metamodel').create();\n            this.require('logger').level('debug');\n        }, true, true);\n\n        // type change events\n        channel.on('$designerCreateType', function $designerCreateType(id, type) {\n            this.require('logger').level('warn');\n            this.require('metamodel').type(type);\n            this.require('metamodel').create();\n            this.require('logger').level('debug');\n        }, true, true);\n\n        channel.on('$editorUpdateType', function $editorUpdateType(id, type) {\n            this.require('logger').level('warn');\n            this.require('metamodel').type(type);\n            this.require('metamodel').create();\n            this.require('logger').level('debug');\n\n        }, true, true);\n\n        channel.on('$editorDeleteType', function $editorDeleteType(id) {\n            this.require('logger').level('warn');\n            $db.RuntimeType.remove({ 'name': id });\n            this.require('metamodel').create();\n            this.require('logger').level('debug');\n        }, true, true);\n\n        channel.on('$designerDeleteType', function $designerDeleteType(id) {\n            this.require('logger').level('warn');\n            $db.RuntimeType.remove({ 'name': id });\n            this.require('metamodel').create();\n            this.require('logger').level('debug');\n        }, true, true);\n\n        // component change events\n        channel.on('$designerCreateComponent', function $designerCreateComponent(model, component) {\n            $db[model].insert(component);\n        }, true, true);\n\n        channel.on('$editorUpdateComponent', function $editorUpdateComponent(id, collection, component) {\n            $db[collection].update({ '_id': id }, component, { 'upsert': true });\n        }, true, true);\n\n        channel.on('$designerUpdateComponent', function $editorUpdateComponent(id, collection, component) {\n            $db[collection].update({ '_id': id }, component, { 'upsert': true });\n        }, true, true);\n\n        channel.on('$editorDeleteComponent', function $editorDeleteComponent(id, collection) {\n            $db[collection].remove({ '_id': id });\n        }, true, true);\n\n        channel.on('$designerDeleteComponent', function $designerDeleteComponent(id, collection) {\n            $db[collection].remove({ '_id': id });\n        }, true, true);\n\n        // behavior change events\n        channel.on('$designerCreateBehavior', function createBehavior(component) {\n            $db.RuntimeBehavior.insert(component);\n        }, true, true);\n\n        channel.on('$editorUpdateBehavior', function $editorUpdateBehavior(id, behavior) {\n            if (this.require(id)) {\n                this.require(id).action(behavior.action);\n                if (behavior.state === 'main') {\n                    this.require(behavior.component).main();\n                }\n                if (behavior.state === 'start') {\n                    this.require(behavior.component).start();\n                }\n            }\n        }, true, true);\n\n        channel.on('$designerUpdateBehavior', function $designerUpdateBehavior(id, behavior) {\n            if (this.require(id)) {\n                this.require(id).action(behavior.action);\n                if (behavior.state === 'main') {\n                    this.require(behavior.component).main();\n                }\n                if (behavior.state === 'start') {\n                    this.require(behavior.component).start();\n                }\n            }\n        }, true, true);\n\n        channel.on('$editorDeleteBehavior', function $editorDeleteBehavior(id) {\n            $db.RuntimeBehavior.remove({ '_id': id });\n        }, true, true);\n\n        channel.on('$designerDeleteBehavior', function $editorDeleteBehavior(id) {\n            $db.RuntimeBehavior.remove({ '_id': id });\n        }, true, true);\n\n        // System Designer event\n        channel.on('$designerSync', function sync() {\n            var designerWindow = this.require('admin').designerWindow(),\n                system = null;\n\n            this.require('admin').designerWindow(null);\n            system = JSON.parse(this.require('db').system());\n            designerWindow = this.require('admin').designerWindow(designerWindow);\n\n            this.$appLoadSystem(system);\n        }, false, true);\n        \n        // Database insert event\n        db.on('insert', function insert(event) {\n          if (event.collection.indexOf('Runtime') !== 0) {\n            this.require('channel').$runtimeCreateComponent(event.collection, event.document);\n          }\n        });\n        \n         // Database remove event\n        db.on('remove', function remove(event) {\n          if (event.collection.indexOf('Runtime') !== 0) {\n            this.require('channel').$runtimeDeleteComponent(event.id, event.collection);\n          }\n        });\n        \n         // Database update event\n        db.on('update', function update(event) {\n          if (event.collection.indexOf('Runtime') !== 0) {\n            this.require('channel').$runtimeUpdateComponent(event.id, event.collecion, event.field, event.value);\n          }\n        });\n\n        window.addEventListener('message', function (event) {\n            var data = null;\n            try {\n                data = JSON.parse(event.data);\n                if (data &&\n                    typeof data.event !== 'undefined' &&\n                    typeof data.from !== 'undefined' &&\n                    typeof data.data !== 'undefined') {\n                    this.designerWindow(event.source);\n                    $db.RuntimeMessage.insert(data);\n                }\n            } catch (e) {\n            }\n        }.bind(this), false);\n\n        this.require('logger').info('admin is started');\n    } else {\n        this.require('logger').info('admin is already started');\n    }\n}",useCoreAPI:!0,core:!0},"1ca0f1020412d4f":{_id:"1ca0f1020412d4f",component:"RuntimeStorage",state:"get",action:"function get(key) {\n    var result = null;\n    \n    if (typeof this.store()[key]) {\n        result = this.store()[key];\n    }\n    return result;\n}",useCoreAPI:!1,core:!0},"16764100d51b5f8":{_id:"16764100d51b5f8",component:"RuntimeStorage",state:"set",action:"function set(key, value) {\n    var store = this.store(),\n        item = {};\n    \n    store[key] = value;\n    this.store(store);\n    \n    item[key] = JSON.stringify(value);\n    \n    switch (true) {\n        case typeof localStorage !== 'undefined':\n            localStorage.setItem(key, JSON.stringify(value)); \n            break;\n        default:\n            break;\n    }\n}",useCoreAPI:!1,core:!0},"134b616b1016f60":{_id:"134b616b1016f60",component:"RuntimeStorage",state:"clear",action:"function clear() {\n    this.store({});\n    \n    switch (true) {\n        case typeof localStorage !== 'undefined':\n            localStorage.clear(); \n            break;\n        default:\n            break;\n    }\n}",useCoreAPI:!1,core:!0},"14c7f1a8431b3d5":{_id:"14c7f1a8431b3d5",component:"RuntimeStorage",state:"init",action:"function init(conf) {\n    switch (true) {\n        case typeof localStorage !== 'undefined':\n            \n            // init \n            var keys = Object.keys(localStorage),\n                store = {},\n                i = 0,\n                length = 0;\n                \n            length = keys.length;    \n            for (i = 0; i < length; i++) {\n                try {\n                    store[keys[i]] = JSON.parse(localStorage[keys[i]]);\n                } catch (e) {\n                }\n            }\n            this.store(store);\n            \n            // event\n            window.addEventListener('storage', function (e) {\n                var obj = {},\n                    store = this.store();\n                    \n                try {\n                    store[e.key] = JSON.parse(e.newValue)\n                    this.store(store);\n                   \n                    obj[e.key] = {};\n                    obj[e.key].oldValue = JSON.parse(e.oldValue);\n                    obj[e.key].newValue = JSON.parse(e.newValue);\n                    \n                    this.changed(obj);\n                } catch (e) {\n                }\n            }.bind(this));\n            break;\n        default:\n            break;\n    }\n}",useCoreAPI:!1,core:!0},"1a4921ac7112bd4":{_id:"1a4921ac7112bd4",component:"RuntimeStorage",state:"remove",action:"function remove(key) {\n    var store = this.store();\n    \n    delete store[key];\n    this.store(store);\n    \n    switch (true) {\n        case typeof localStorage !== 'undefined':\n            localStorage.removeItem(key); \n            break;\n        default:\n            break;\n    }\n}",useCoreAPI:!1,core:!0},"13010167f313f87":{_id:"13010167f313f87",component:"Runtime",state:"system",action:"function system(name) {\n    var RuntimeSystem = null,\n    system = {},\n    systemId = '',\n    result = [],\n    conf = {};\n    \n    if (name) {\n        conf.master = true;\n        conf.name = name;\n        RuntimeSystem = this.require('RuntimeSystem');\n        system = new RuntimeSystem(conf);\n    } else {\n        result = $db.RuntimeSystem.find({\n            'master': true\n        });\n        if (result.length) {\n            systemId = result[0]._id;\n            system = $component.get(systemId);\n        }\n    }\n    return system;\n}",core:!0,useCoreAPI:!0},"155141e40312cd8":{_id:"155141e40312cd8",component:"RuntimeClassInfo",state:"collection",action:"function collection(name) {\n    var result = {};\n    if (this.schema()[name] === 'collection') {\n        result = this.model()[name];\n    } \n    \n    return result; \n}",core:!0},"1f6941a0c012c1f":{_id:"1f6941a0c012c1f",component:"RuntimeClassInfo",state:"collections",action:"function collections(name) {\n    var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = 0;\n    \n    length = keys.length; \n    \n    for (i = 0; i < length; i++) { \n        item = keys[i]; \n        if (this.schema()[item] === 'collection') {\n            result.push(item);\n        }\n    }\n    \n    return result;\n}",core:!0},"1ef711b4171c849":{_id:"1ef711b4171c849",component:"RuntimeClassInfo",state:"event",action:"function event(name) {\n    var result = {};\n    \n    if (this.schema()[name] === 'event') {\n        result = this.model()[name];\n    } \n    \n    return result;\n}",core:!0},"1bae51b6ed1d25c":{_id:"1bae51b6ed1d25c",component:"RuntimeClassInfo",state:"events",action:"function events(name) {\n    var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = 0;\n    \n    length = keys.length;\n    \n    for (i = 0; i < length; i++) {\n        item = keys[i];\n        if (this.schema()[item] === 'event') {\n            result.push(item);\n        }\n    } \n    return result;\n}",core:!0},"19ac2125221528b":{_id:"19ac2125221528b",component:"RuntimeClassInfo",state:"link",action:"function link(name) {\n    var result = {};\n    \n    if (this.schema()[name] === 'link') {\n        result = this.model()[name];\n    }\n    return result;\n}",core:!0},"17ed21dfc01b8e8":{_id:"17ed21dfc01b8e8",component:"RuntimeClassInfo",state:"links",action:"function links(name) { \n    var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = 0;\n    length = keys.length;\n    \n    for (i = 0; i < length; i++) {\n        item = keys[i];\n        if (this.schema()[item] === 'link') {\n            result.push(item);\n        }\n    } return result;\n}",
core:!0},"11ce318a561ac61":{_id:"11ce318a561ac61",component:"RuntimeClassInfo",state:"method",action:"function method(name) {\n    var result = {};\n    if (this.schema()[name] === 'method') {\n        result = this.model()[name];\n        \n    }\n    \n    return result;\n}",core:!0},"12ff2190a018046":{_id:"12ff2190a018046",component:"RuntimeClassInfo",state:"methods",action:"function methods(name) {\n    var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = 0;\n    length = keys.length;\n    for (i = 0; i < length; i++) {\n        item = keys[i];\n        if (this.schema()[item] === 'method') {\n            result.push(item);\n        }\n    } \n    \n    return result;\n}",core:!0},"1028d1681e1fd58":{_id:"1028d1681e1fd58",component:"RuntimeClassInfo",state:"properties",action:"function properties(name) { \n    var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = 0;\n    length = keys.length;\n    \n    for (i = 0; i < length; i++) {\n        item = keys[i];\n        if (this.schema()[item] === 'property') {\n            result.push(item);\n        }\n    } return result;\n}",core:!0},"18eeb10c5319368":{_id:"18eeb10c5319368",component:"RuntimeClassInfo",state:"property",action:"function property(name) {\n    var result = {};\n    \n    if (this.schema()[name] === 'property') {\n        result = this.model()[name];\n    }\n    return result;\n}",core:!0},"1ba721201114b6b":{_id:"1ba721201114b6b",component:"RuntimeComponent",state:"destroy",action:"function destroy() {\n    $component.destroy(this.id());\n}",core:!0,useCoreAPI:!0},"15486186f41a48c":{_id:"15486186f41a48c",component:"RuntimeComponent",state:"off",action:'function off(state, behaviorId) {\n    var args = [],\n    i = 0,\n    length = 0;\n    length = arguments.length;\n    \n    for (i = 0; i < length - 7; i++) {\n        args.push(arguments[i]);\n    }\n    \n    if ($workflow.checkParams({\n        "component": this, \n        "methodName": "off", \n        "args": args\n        })) {\n        \n        if (state || behaviorId) {\n            if ($metamodel.isValidState(state, this.constructor.name)) {\n                $behavior.remove({\n                    "behaviorId": behaviorId, \n                    "componentId": this.id(), \n                    "state": state\n                });\n            } else { \n                this.require(\'logger\').warn("invoke \\\'off\\\' method of component \'" + this.id() + "\' with an invalid state \'" + state + "\'"); \n            }\n        } else {\n            $behavior.remove({\n                "componentId": this.id()\n            });\n        }\n    }\n}',core:!0,useCoreAPI:!0},"1da0a17878104c3":{_id:"1da0a17878104c3",component:"RuntimeComponent",state:"require",action:"function require(id) {\n    return $component.get(id);\n}",core:!0,useCoreAPI:!0},"1a5111d17a1800c":{_id:"1a5111d17a1800c",component:"RuntimeDatabase",state:"collections",action:"function collections() {\n    var result = {},\n    collectionName = '';\n    \n    for (collectionName in $db.store) {\n        if ($db.store.hasOwnProperty(collectionName) && collectionName.indexOf('Runtime') !== 0) {\n            result[collectionName] = $db[collectionName];\n            \n        }\n    }\n    return result;\n}",core:!0,useCoreAPI:!0},"1e5bf167ca1b61e":{_id:"1e5bf167ca1b61e",component:"RuntimeDatabase",state:"subsystem",action:"function subsystem(params) {\n    return $db.subsystem(params);\n}",core:!0,useCoreAPI:!0},"15ab1112e81b1b4":{_id:"15ab1112e81b1b4",component:"RuntimeDatabase",state:"system",action:"function system(system) {\n    return $db.system(system);\n}",core:!0,useCoreAPI:!0},"1d993108fa18ef2":{_id:"1d993108fa18ef2",component:"RuntimeLogger",state:"debug",action:"function debug(message) {\n    if (this.level() === 'debug') {\n        console.log('runtime: ' + message);\n    }\n}",core:!0},"1a37a188e11fe73":{_id:"1a37a188e11fe73",component:"RuntimeLogger",state:"error",action:"function error(message) {\n    console.error('runtime: ' + message);\n}",core:!0},"1edd21e12a16534":{_id:"1edd21e12a16534",component:"RuntimeLogger",state:"info",action:"function info(message) {\n    if (this.level() === 'info' || this.level() === 'debug') {\n        console.info('runtime: ' + message);\n    }\n}",core:!0},"141f2143d3122a4":{_id:"141f2143d3122a4",component:"RuntimeLogger",state:"level",action:"function level(val) {\n    $log.level(val);\n}",core:!0,useCoreAPI:!0},"192401bab21304e":{_id:"192401bab21304e",component:"RuntimeLogger",state:"warn",action:"function warn(message) {\n    if (this.level() === 'info' || this.level() === 'warn' || this.level() === 'debug') {\n        console.warn('runtime: ' + message);\n    } \n}",core:!0},"11fc715e2f1a31e":{_id:"11fc715e2f1a31e",component:"RuntimeMetamodel",state:"create",action:"function create() {\n        $metamodel.create();\n}",core:!0,useCoreAPI:!0},"1232f1f107142cf":{_id:"1232f1f107142cf",component:"RuntimeMetamodel",state:"model",action:"function model(model) {\n    return $metamodel.model(model);\n}",core:!0,useCoreAPI:!0},"1365412f69153d2":{_id:"1365412f69153d2",component:"RuntimeMetamodel",state:"schema",action:"function schema(schema) {\n    return $metamodel.schema(schema);\n}",core:!0,useCoreAPI:!0},"194db147fe161a2":{_id:"194db147fe161a2",component:"RuntimeMetamodel",state:"type",action:"function type(type) {\n    return $metamodel.type(type);\n}",core:!0,useCoreAPI:!0},"129f71568717a22":{_id:"129f71568717a22",component:"RuntimeSystem",state:"sync",action:"function sync() {\n    var system = JSON.parse($db.system());\n    \n    this.schemas(system.schemas);\n    this.types(system.types);\n    this.behaviors(system.behaviors);\n    this.components(system.components);\n}",core:!0,useCoreAPI:!0},"1ef951f1411b895":{_id:"1ef951f1411b895",component:"RuntimeOSGi",state:"install",action:"function install(url, async) { \n  var importedSystem = null,\n      system = {},\n      systemId = '',\n      callbackLoad = null,\n      xhr = null,\n      result = '',\n      channel = $component.get('channel');\n\n  if (typeof url === 'object') {\n    importedSystem = url;\n  } else {\n    if (url.indexOf('{') === 0) {\n      importedSystem = JSON.parse(url);\n    }\n  }\n  \n  if (importedSystem) {\n    systemId = this.require('db').system(importedSystem); \n    if (systemId) {\n      system = this.require(systemId);\n      \n      if (typeof url === 'string') {\n        system.location(url);\n      }\n      system.state('installed');    \n      channel.$systemInstalled(systemId);\n      system.state('resolved');\n      channel.$systemResolved(systemId);\n      \n      result = systemId;\n    }\n  } else {   \n    if (typeof global !== 'undefined' && typeof window === 'undefined') {\n      if (url.indexOf('.json') !== -1) {\n        system = global.require(global.process.env.PWD + '/' + url);\n      } else {\n        system = global.require(url);\n      }\n      systemId = this.require('db').system(system);\n      system = this.require(systemId);\n      \n      if (typeof url === 'string') {\n        system.location(url);\n      }\n      system.state('installed');    \n      channel.$systemInstalled(systemId);\n      system.state('resolved');\n      channel.$systemResolved(systemId);\n      \n      result = systemId;\n    } else {\n      xhr = new XMLHttpRequest();\n      callbackLoad = function callbackLoad(system, url) {\n        var sysId = $db.system(system),\n            sys = $component.get(sysId),\n            channel = $component.get('channel');\n            \n        if (typeof url === 'string') {    \n          sys.location(url);    \n        }\n        sys.state('installed');    \n        channel.$systemInstalled(sysId);\n        sys.state('resolved');\n        channel.$systemResolved(sysId);\n        \n        result = sysId;\n      };\n      \n      if (async) {\n        xhr.open('GET', url, true);\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === 4) {\n            if (xhr.status === 200) {\n              callbackLoad(JSON.parse(xhr.response), url);\n            }\n          }\n        };\n        xhr.send(null);\n      } else {\n        xhr.open('GET', url, false);\n        xhr.send(null);\n        if (xhr.status === 200) {\n          callbackLoad(JSON.parse(xhr.response), url);\n        }\n      }\n    }\n  }\n  return result;\n}",useCoreAPI:!0,core:!0},"14c1517b711cb78":{_id:"14c1517b711cb78",component:"RuntimeOSGi",state:"uninstall",action:"function uninstall(id) { \n\tvar search = {},\n\t    system = null,\n\t    behaviorId = '',\n\t    collection =  '',\n\t    componentId = '',\n\t    length = 0,\n\t    i = 0,\n\t    coreComponents = ['admin', 'channel', 'db', 'logger', 'metamodel', 'runtime'];\n\t\n\tsearch = $db.RuntimeSystem.find({\n\t  '_id': id\n\t});\n\t\n\tif (search.length) {\n\t  system = search[0];\n\t  // remove behaviors\n\t  if (system.behaviors) {\n\t    for (behaviorId in system.behaviors) {\n\t      $db.RuntimeBehavior.remove({ \n\t        '_id': system.behaviors[behaviorId]._id\n\t      });\n\t    }\n\t  }\n\t  // remove components\n\t  if (system.components) {\n\t    for (collection in system.components) {\n\t      for (componentId in system.components[collection]) {\n\t        if (coreComponents.indexOf(componentId) === -1) {\n  \t        $db[collection].remove({ \n  \t          '_id': componentId\n  \t        });\n\t        }\n\t      }\n\t    }\n\t  }\n\t}\n\t\n\tthis.require(id).state('uninstalled');\n\tchannel.$systemUninstalled(id);\n}",useCoreAPI:!0,core:!0},"1cb9d103d41dd97":{_id:"1cb9d103d41dd97",component:"e89c617b6b15d24",state:"start",action:"function start() {\n  var subsystems = [],\n    systems = [],\n    system = null,\n    scripts = [],\n    script = null,\n    mode = '',\n    logLevel = 'warn',\n    i = 0,\n    length = 0;\n\n  // in a browser\n  if (typeof document !== 'undefined') {\n    systems = document.querySelectorAll('link[rel=system]');\n    length = systems.length;\n\n    // logger\n    scripts = document.querySelectorAll('script[log]');\n    if (scripts.length) {\n      logLevel = scripts[0].getAttribute('log');\n      this.require('logger').level(logLevel);\n    }\n\n    // mode\n    scripts = document.querySelectorAll('script[mode]');\n    if (scripts.length) {\n      mode = scripts[0].getAttribute('mode');\n      \n      if (mode === 'dev') {\n        document.addEventListener('dragenter', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n        }, false);\n\n        document.addEventListener('dragover', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n        }, false);\n\n        document.addEventListener('drop', function (e) {\n          e.stopPropagation();\n          e.preventDefault();\n          var files = e.dataTransfer.files;\n          var reader = new FileReader();\n          var json = '';\n          reader.onload = function (event) {\n            json += event.target.result;\n          };\n          reader.onloadend = function () {\n            var sys = JSON.parse(json);\n            runtime.install(sys);\n          };\n          reader.readAsText(files[0], 'UTF-8');\n        });\n      }\n      if (mode === 'admin') {\n        this.require('admin').start();\n      }\n    }\n\n    // systems\n    for (i = 0; i < length; i++) {\n      system = systems[i];\n\n      if (system.getAttribute('async') === 'false') {\n        this.require('runtime').install(system.href, false);\n      } else {\n        this.require('runtime').install(system.href, true);\n      }\n    }\n\n    // designer (deprecated)\n    scripts = document.querySelectorAll('script[designer]');\n    if (scripts.length) {\n      this.require('admin').start();\n    }\n\n    // ready event\n    if (length === 0) {\n      this.require('runtime').ready();\n    }\n  }\n}",useCoreAPI:!0,core:!0},"105f219c6813643":{_id:"105f219c6813643",component:"RuntimeOSGi",state:"start",action:"function start(id) { \n\tvar system = this.require(id),\n\t    channel = this.require('channel');\n\t\n\tif (system.state() === 'resolved' || system.state() === 'installed') {\n  \tsystem.state('starting');\n  \tif (system.main) {\n  \t  system.main();\n  \t}\n  \tif (system.start) {\n  \t  system.start();\n  \t}\n  \tchannel.$systemStarted(id);\n  \tsystem.state('active');\n\t}\n}",useCoreAPI:!1,core:!0},"1a81a1f00d17269":{_id:"1a81a1f00d17269",component:"RuntimeOSGi",state:"stop",action:"function stop(id) { \n\tvar system = this.require(id),\n\t    channel = this.require('channel');\n\t    \n\tif (system.state() === 'active') {\n  \tsystem.state('stopping');\n  \tif (system.stop) {\n  \t  system.stop();\n  \t}\n  \tchannel.$systemStopped(id);\n  \tsystem.state('resolved');\n  \tchannel.$systemResolved(id);\n\t}\n}",useCoreAPI:!1,core:!0},"116851b602128d1":{_id:"116851b602128d1",component:"RuntimeOSGi",state:"status",action:"function status() { \n\tvar result = {},\n\t    system = null,\n\t    length = 0,\n\t    i = 0;\n\t\n\tsystems = $db.RuntimeSystem.find({});\n\t\n\tlength = systems.length;\n\tfor (i = 0; i < length; i++) {\n\t    system = systems[i];\n\t    result[system.name] = {\n\t      'id': system._id,\n\t      'state': system.state,\n\t      'name': system.name,\n\t      'version': system.version,\n\t      'location': system.location,\n\t      'master': system.master\n\t    };\n\t}\n\t\n\treturn result;\n}",useCoreAPI:!0,core:!0},"12e491859c13918":{_id:"12e491859c13918",component:"RuntimeChannel",state:"$systemStarted",action:"function $systemStarted(id) { \n  var systems = null;\n    \n  if (id !== 'e89c617b6b15d24') {\n    if (typeof document !== 'undefined') {\n      systems = document.querySelectorAll('link[rel=system]');\n         \n      if ($state.get('runtime') && $state.get('runtime').name === 'ready') {    \n      } else {\n        if (systems.length + 1 === $db.RuntimeSystem.count()) {\n          $component.get('runtime').ready();\n        }\n      }\n    }\n  }\n}",useCoreAPI:!0,core:!0},"1e9021bd4e1bc6e":{_id:"1e9021bd4e1bc6e",component:"RuntimeChannel",state:"$systemInstalled",action:"function $systemInstalled(id) {\n    var systems = null,\n        dependencies = [],\n        master = [],\n        canStart = true;\n\n    if (id !== 'e89c617b6b15d24') {\n      // if all systems are installed\n      systems = $db.RuntimeSystem.find({});\n\n      systems.forEach(function (system) {\n          var sys = this.require(system._id);\n          if (sys.state() === 'none') {\n              canStart = false;\n          }\n      }.bind(this));\n\n      // start all the systems\n      if (canStart) {\n          dependencies = $db.RuntimeSystem.find({\n              'master': false\n          });\n\n          dependencies.forEach(function (dep) {\n              var system = this.require(dep._id);\n              channel = this.require('channel');\n              \n              if (system.state() === 'resolved') {\n                system.state('starting');\n                system.start();\n                channel.$systemStarted(dep._id);\n                system.state('active');\n              }\n          }.bind(this));\n\n          master = $db.RuntimeSystem.find({\n              'master': true\n          });\n\n          master.forEach(function (dep) {\n              var system = this.require(dep._id);\n              channel = this.require('channel');\n              \n              if (system.state() === 'resolved') {\n                system.state('starting');\n                system.start();\n                channel.$systemStarted(dep._id);\n                system.state('active');\n              }\n          }.bind(this));\n      }\n  }\n}",useCoreAPI:!0,core:!0},"1cfa4145f614da8":{_id:"1cfa4145f614da8",component:"Runtime",state:"message",action:"function message(msg) { \n\t$db.RuntimeMessage.insert(msg);\n}",useCoreAPI:!0,core:!0},"182c51edc31ad97":{_id:"182c51edc31ad97",component:"RuntimeSystemOSGi",state:"uninstall",action:"function uninstall() { \n\tthis.require('runtime').uninstall(this.id());\n}",useCoreAPI:!1,core:!0},"15643114f31bf40":{_id:"15643114f31bf40",component:"RuntimeSystemOSGi",state:"state",action:"function state(value) { \n  if (this.require('logger')) {\n\t  this.require('logger').debug('the state of the system \\'' + this.name() + '\\' is now \\'' + value + '\\'');\n  }\t\n}",useCoreAPI:!1,core:!0},"19cf317d7217331":{_id:"19cf317d7217331",component:"RuntimeOSGi",state:"bundle",action:"function bundle() { \n\tvar result = this.require('db').system();\n\treturn result;\n}",useCoreAPI:!1,core:!0},"14b77144911ce48":{_id:"14b77144911ce48",component:"RuntimeSystemOSGi",state:"bundle",action:"function bundle() { \n\tvar result = '',\n\tsystem = [];\n\t\n\tsystems = $db.RuntimeSystem.find({\n    '_id': this.id()\n  });\n  \n  if (systems.length) {\n    result = JSON.stringify(systems[0]);\n  }\n  \n\treturn result;\n}",useCoreAPI:!0,core:!0}},components:{RuntimeAdmin:{admin:{_id:"admin",_core:!0,designerWindow:null}},RuntimeStorage:{storage:{_id:"storage",_core:!0}},Runtime:{runtime:{_id:"runtime",version:"1.9.4"}},RuntimeDatabase:{db:{_id:"db"}},RuntimeLogger:{logger:{_id:"logger"}},RuntimeMetamodel:{metamodel:{_id:"metamodel"}},RuntimeSystem:{},RuntimeChannel:{channel:{_id:"channel"}}},name:"system-runtime",version:"1.9.4",description:"System Runtime",_id:"e89c617b6b15d24",master:!1,subsystem:!1};c.system=d},{}],2:[function(a,b,c){"use strict";function d(a,b,c,d){var e="",f=-1,g="",h=[],i=[],j="",k="",l=null;return f=b.indexOf("{"),k=b.substring(0,f),e=k.split("(")[0].replace("function","").trim(),g=k.split("(")[1].replace(")","").trim(),h=g.split(","),h.forEach(function(a){i.push(a.trim())}),j=b.substring(f+1),j=j.substring(0,j.lastIndexOf("}")).trim(),e=e||a,""===h[0]&&(h=[]),d&&(h.push("$component"),h.push("$db"),h.push("$metamodel"),h.push("$workflow"),h.push("$behavior"),h.push("$state"),h.push("$log")),l=""!==h[0]?new Function("body","return function "+e+" ("+h.join(",")+") { return new Function('"+h.join("','")+"', body).apply(this, arguments) };")(j):new Function("body","return function "+e+" () { return new Function(body).apply(this, arguments) };")(j)}function e(a,b,c,e,f){var g=l.generateId(),h=c.toString();return"undefined"==typeof f&&(f=!1),"undefined"==typeof e&&(e=!1),c=d(b,h,f,e),m[g]=c,k.RuntimeBehavior.insert({_id:g,component:a,state:b,action:h,useCoreAPI:e,core:f}),g}function f(a){var b=[];a=a||{},a.behaviorId=a.behaviorId||"",a.componentId=a.componentId||"",a.state=a.state||"",a.componentId&&(a.behaviorId?(k.RuntimeBehavior.remove({_id:a.behaviorId,component:a.componentId,state:a.state}),delete m[a.behaviorId]):(b=a.state?k.RuntimeBehavior.remove({component:a.componentId,state:a.state}):k.RuntimeBehavior.remove({component:a.componentId}),b.forEach(function(a){delete m[a]})))}function g(a){delete m[a]}function h(a,b){var c=[],e=[],f=null;return e=k.RuntimeBehavior.find({component:a,state:b}),e.forEach(function(a){f=m[a._id],"undefined"==typeof f&&(f=d(a.state,a.action,a.core,a.useCoreAPI),m[a._id]=f),c.push({useCoreAPI:a.useCoreAPI,action:f})}),c}function i(){m={}}function j(a){return m[a]}var k=a("./db.js"),l=a("./helper.js"),m={};c.add=e,c.get=j,c.remove=f,c.getActions=h,c.clear=i,c.removeFromMemory=g},{"./db.js":4,"./helper.js":5}],3:[function(a,b,c){"use strict";function d(a){function b(a,b,c,d){var e=!1,l=0,m=0,n=[];if(k)H.readOnlyProperty(h,i,j);else if(e=g.indexOf("@")!==-1)if(a&&E.inheritFrom(a.constructor.name,g.replace("@",""))){switch(!0){case"push"===b:f.push(a.id());break;case"unshift"===b:f.unshift(a.id());break;case"splice"===b:for(n=f.splice(c,d,a),m=n.length,l=0;l<m;l++)C.state({component:h,state:j,data:[n[l],"remove"]})}G.isRuntime()&&G.getRuntime().require("db").update({collection:i,id:h,field:j,value:f}),C.state({component:h,state:j,data:[a.id(),"add"]})}else"undefined"!=typeof a.id?H.invalidPropertyName(h,i,j,a.id(),g):H.invalidPropertyName(h,i,j,a,g);else if(a&&E.isValidType(a,g)){switch(!0){case"push"===b:f.push(a);break;case"unshift"===b:f.unshift(a);break;case"splice"===b:f.splice(c,d,a)}G.isRuntime()&&G.getRuntime().require("db").update({collection:i,id:h,field:j,value:f}),C.state({component:h,state:j,data:[a,"add"]})}else H.invalidPropertyName(h,i,j,a,g);return f.length}function c(a){var b,c=null,d=!1;if(k)H.readOnlyProperty(h,i,j);else if(0!==f.length){switch(!0){case"pop"===a:c=f.pop();break;case"shift"===a:c=f.shift()}G.isRuntime()&&G.getRuntime().require("db").update({collection:i,id:h,field:j,value:f}),C.state({component:h,state:j,data:[c,"remove"]}),d=g.indexOf("@")!==-1,b=d?Q[c]:c}return b}var e=[],f=[],g="",h="",i="",j="",k=!1;return a=a||{},g=a.type||"",h=a.id||"",j=a.propertyName||"",f=a.arr||[],i=a.classId||"","undefined"!=typeof a.readOnly&&(k=a.readOnly),f.forEach(function(a){g.indexOf("@")!==-1?e.push(G.getRuntime().require(a)):e.push(a)}),e.push=function(a){return b(a,"push")},e.unshift=function(a){return b(a,"unshift")},e.concat=function(c){var e=0,g=0;if(Array.isArray(c))for(g=c.length,e=0;e<g;e++)b(c[e],"push");return a.arr=f,new d(a)},e.pop=function(){return c("pop")},e.shift=function(){return c("shift")},e.sort=function(a){return f.sort(a),G.isRuntime()&&G.getRuntime().require("db").update({collection:i,id:h,field:j,value:f}),e},e.reverse=function(){return f.reverse(),G.isRuntime()&&G.getRuntime().require("db").update({collection:i,id:h,field:j,value:f}),e},e.splice=function(a,c,d){var e=[],g=0,k=0;if("undefined"!=typeof d)b(d,"splice",a,c);else for(e=f.splice(a,c),G.isRuntime()&&G.getRuntime().require("db").update({collection:i,id:h,field:j,value:f}),k=e.length,g=0;g<k;g++)C.state({component:h,state:j,data:[e[g],"remove"]});return e},e.slice=function(a,b){var c=f.slice(a,b);return c},e}function e(a,b){var c=[],d=[],e=0,f=0;if(c=E.getModel(a)[b].params)for(e=c.length,f=0;f<e;f++)d.push(c[f].name);return d}function f(a){var b=null,c=null,d=[],e=0,f=0,g=[];for(b=E.getModel(a),c=E.getSchema(b[P]),d=Object.keys(c),e=d.length,f=0;f<e;f++)c[d[f]]!==L&&c[d[f]]!==K&&c[d[f]]!==M||g.push({name:d[f],type:b[d[f]].type,readOnly:b[d[f]].readOnly});return g}function g(a){var b=null,c=null,d=[],e=0,f=0,g=[];for(b=E.getModel(a),c=E.getSchema(b[P]),d=Object.keys(c),e=d.length,f=0;f<e;f++)c[d[f]]===N&&g.push(d[f]);return g}function h(a,b){var c=null,d=null,e=null,f=[],g=[];return c=E.getModel(b),d=c[a].type,e=E.getType(d),e.schema&&(g=Object.keys(e.schema),g.forEach(function(a){e.schema[a].name=a,f.push(e.schema[a])})),f}function i(a){var b=null,c=null,d=[],e=0,f=0,g=[];for(b=E.getModel(a),c=E.getSchema(b[P]),d=Object.keys(c),e=d.length,f=0;f<e;f++)c[d[f]]===O&&g.push(d[f]);return g}function j(a,b,c){var d=null,e=D.store[a][b],f=c.split("."),g=f.length,h=0;for(d=e,h=0;h<g;h++)d=d[f[h]];return d}function k(a,b,c,d){var e=null,f=D.store[a][b],g=c.split("."),h=g.length,i=0;for(e=f,i=0;i<h-1;i++)e=e[g[i]];e[g[i]]=d}function l(a){var b=function(b){b=b||{};var c={};"Object"!==b.constructor.name&&(H.invalidConctructorParameters(b,a),b={}),E.isValidObject(b,E.getModel(a),!0,!0)||H.invalidParameters(a),E.prepareObject(b,E.getModel(a)),"undefined"==typeof b._id&&(b._id=G.generateId()),Q[b._id]=this,c=function(){return b._id},this.id=new Function("body","return function id () { return body.call(this) };")(c),E.inheritFrom(a,"RuntimeComponent")&&(b.classInfo=a+"Info"),D.store[a][b._id]=b,G.isRuntime()&&G.getRuntime().require("db")&&G.getRuntime().require("db").insert({collection:a,document:b}),Object.freeze(this),this.init&&this.init(b)};return new Function("body","return function "+a+" (config) { body.call(this,config) };")(b)}function m(a,b){var c=function(){return b};a.id=new Function("body","return function id (prop, val) { return body.call(this, prop, val) };")(c)}function n(a,b,c){var e=f(a);e.forEach(function(e){function f(a,b){var c=!0;return a.forEach(function(a){E.isValidType(a,b)&&E.inheritFrom(a.constructor.name,b.replace("@",""))&&b.indexOf("@")!==-1||(c=c&&!1)}),!0}function g(a,b){var c=[];return a.forEach(function(a){if(b[0].indexOf("@")!==-1)switch(!0){case"string"==typeof a:c.push(a);break;case"undefined"!=typeof a.id:c.push(a.id());break;default:c.push(null)}else c.push(a)}),c}var h={},i="",j="",k="";i=e.name,j=e.type,k=e.readOnly,Array.isArray(j)?(h=function(a,b){var e=[],h=null,l=null,m=null,n=null;if("undefined"==typeof b){if("undefined"==typeof a)return l=new d({id:this.id(),propertyName:i,readOnly:k,classId:c,type:j[0],arr:D.store[c][this.id()][i]});if(Array.isArray(a))f(a,j[0])?(e=D[c].find({_id:this.id()}),e.length&&(h=e[0],n=g(a,j[0]),C.state({component:this.id(),state:i,data:[n,"reset"]}),h[i]=n,G.isRuntime()&&G.getRuntime().require("db").update({collection:c,id:this.id(),field:i,value:h[i]}))):H.invalidPropertyName(this.id(),this.constructor.name,i,a,j);else if("number"==typeof a){if(m=D.store[c][this.id()][i][a])return n=j[0].indexOf("@")!==-1?G.getRuntime().require(m):m}else H.invalidPropertyName(this.id(),this.constructor.name,i,a,"number")}else if(k)H.readOnlyProperty(this.id(),this.constructor.name,i);else if(E.isValidType(b,j[0])||E.inheritFrom(b.constructor.name,j[0].replace("@",""))&&j[0].indexOf("@")!==-1){if(e=D[c].find({_id:this.id()}),e.length){if(j[0].indexOf("@")!==-1)switch(!0){case"string"==typeof b:n=b;break;case"undefined"!=typeof b.id:n=b.id();break;default:n=""}else n=b;h=e[0],h[i][a]=n,G.isRuntime()&&G.getRuntime().require("db").update({collection:c,id:this.id(),field:i,value:h[i]}),C.state({component:this.id(),state:i,data:[n,"add"]})}}else H.invalidPropertyName(this.id(),this.constructor.name,i,b,j)},b.prototype[i]=new Function("body","return function "+i+" (position,value) { return body.call(this, position, value) };")(h)):(h=function(b){var d=[],e=null,f=null;if("undefined"==typeof b){if(e=D.store[c][this.id()]){switch(!0){case j.indexOf("@")!==-1:f=x(e[i]);break;case"date"===j:f=new Date(e[i]);break;case E.isStructure(i,c):f=o("",i,a,this.id());break;default:f=e[i]}return f}H.destroyedComponentCall(i,this.id())}else if(k)H.readOnlyProperty(this.id(),this.constructor.name,i);else if(E.isValidType(b,j)){if(d=D[c].find({_id:this.id()}),d.length){switch(e=d[0],!0){case j.indexOf("@")!==-1:null===b?e[i]=b:e[i]=b.id();break;case"date"===j:"string"==typeof b?e[i]=b:e[i]=b.toISOString();break;default:e[i]=b}G.isRuntime()&&G.getRuntime().require("db")&&G.getRuntime().require("db").update({collection:c,id:this.id(),field:i,value:b}),"RuntimeBehavior"===c&&F.removeFromMemory(this.id()),C.state({component:this.id(),state:i,data:[b]})}}else H.invalidPropertyName(this.id(),this.constructor.name,i,b,j)},b.prototype[i]=new Function("body","return function "+i+" (value) { return body.call(this,value) };")(h))})}function o(a,b,c,d){var e=h(b,c),f={};return e.forEach(function(e){var g={},h="",i="",l="";h=e.name,i=e.type,l=e.readOnly,g=function(f){var g=[],m=null,n=null,p="",q="";if(p=a?p+"."+b:b,q=p+"."+h,"undefined"==typeof f){if(m=D.store[c][d]){switch(!0){case i.indexOf("@")!==-1:n=x(j(c,d,q));break;case"date"===i:n=new Date(j(c,d,q));break;case E.isStructure(h,c):n=o(p,h,c,d);break;default:n=j(c,d,q)}return void 0===n&&void 0!==e.default&&(n=e.default),n}H.destroyedComponentCall(q,d)}else if(l)H.readOnlyProperty(d,c,q);else if(E.isValidType(f,i)){if(g=D[c].find({_id:d}),g.length){switch(m=g[0],!0){case i.indexOf("@")!==-1:k(c,d,q,f.id());break;case"date"===i:k(c,d,q,f.toISOString());break;default:k(c,d,q,f)}G.isRuntime()&&G.getRuntime().require("db")&&G.getRuntime().require("db").update({collection:c,id:d,field:q,value:f}),"RuntimeBehavior"===c&&F.removeFromMemory(d),C.state({component:d,state:q,data:[f]})}}else H.invalidPropertyName(d,c,q,f,i)},f[h]=new Function("body","return function "+h+" (value) { return body.call(this,value) };")(g)}),f}function p(a,b,c){var d=g(a);d.forEach(function(a){var d=e(c,a),f=d.join(","),g=function(){var b=null;return b=C.state({component:this.id(),state:a,data:arguments})};f?b.prototype[a]=new Function("body","return function "+a+" ("+f+") { return body.call(this,"+f+") };")(g):b.prototype[a]=new Function("body","return function "+a+" () { return body.call(this) };")(g)})}function q(a,b,c){var d=i(a);d.forEach(function(a){var d=e(c,a),f=d.join(","),g=function(){var b=[],d="e89c617b6b15d24",e=[],f=0,g=-1,h={};if("RuntimeChannel"===c){for(b=D.RuntimeSystem.find({master:!0}),b.length&&(d=b[0]._id),h.from=d,g=arguments.length,f=0;f<g;f++)e.push(arguments[f]);h.data=e,h.event=a,D.RuntimeMessage.insert(h),C.state({component:this.id(),state:"send",data:[{event:h.event,from:h.from,data:h.data}]})}else C.state({component:this.id(),state:a,data:arguments})};f?b.prototype[a]=new Function("body","return function "+a+" ("+f+") { return body.call(this,"+f+") };")(g):b.prototype[a]=new Function("body","return function "+a+" () { return body.call(this) };")(g)})}function r(a,b){var c=function(a,c,d,e){var f="",g="";return C.checkParams({component:this,methodName:"on",args:arguments})&&(E.isValidState(a,b)?E.isEvent(a,b)||E.isProperty(a,b)||E.isLink(a,b)||E.isCollection(a,b)||!(D.RuntimeBehavior.find({component:this.id(),state:a}).length>=1)?I.validParamNumbers(b,a,c)?(f=F.add(this.id(),a,c,d,e),g=J.get(this.id()),g&&a===g.name&&C.action(f,g.parameters.data)):H.invalidParamNumberMethodOn(this.id(),this.constructor.name,a):H.behaviorNotUnique(b,a):H.invalidStateOn(b,a)),f};a.prototype.on=new Function("body","return function on (state,handler,useCoreAPI,isCore) { return body.call(this,state,handler,useCoreAPI,isCore) };")(c)}function s(a,b){var c=function(a,c,d,e){var f="",g="";return C.checkParams({component:this,methodName:"on",args:arguments})&&(E.isValidState(a,b)?E.isEvent(a,b)||E.isProperty(a,b)||E.isLink(a,b)||E.isCollection(a,b)||!(D.RuntimeBehavior.find({component:this.id(),state:a}).length>=1)?I.validParamNumbers(b,a,c)?(f=F.add(this.id(),a,c,d,e),g=J.get(this.id()),g&&a===g.name&&C.action(f,g.parameters.data)):H.invalidParamNumberMethodOn(this.id(),this.constructor.name,a):H.behaviorNotUnique(b,a):H.invalidStateOn(b,a)),f};a.on=new Function("body","return function on (state,handler,useCoreAPI,isCore) { return body.call(this, state, handler, useCoreAPI,isCore) };")(c)}function t(a,b){var c=function(a,c){C.checkParams({component:this,methodName:"off",args:arguments})&&(E.isValidState(a,b)?F.remove({behaviorId:c,componentId:b,state:a}):H.InvalidStateOff(b,a))};a.off=new Function("body","return function off (state, behaviorId) { return body.call(this, state, behaviorId) };")(c)}function u(a){var b=function(){var a=this.id(),b=[],c=0,d=0;for(D[a]&&(b=D[a].remove()),delete Q[a],F.remove({componentId:a}),d=b.length,c=0;c<d;c++)F.remove({componentId:b[c]});C.state({component:a,state:"destroy"})};a.destroy=new Function("body","return function destroy () { return body.call(this) };")(b)}function v(a){var b=function(){return x(this.id()+"Info")};a.classInfo=new Function("body","return function classInfo () { return body.call(this) };")(b)}function w(a){a=a||{};var b={},c="";return c="undefined"==typeof a.model?G.generateId():a.model,b=l(c),Q[c]=b,m(b,c),n(a.model,b,c),p(a.model,b,c),q(a.model,b,c),E.inheritFrom(c,"RuntimeComponent")&&(r(b,c),s(b,c),t(b,c),u(b),v(b)),Object.freeze(b),b}function x(a){return Q[a]}function y(a){return w(a)}function z(a){var b=Q[a],c="";b&&(delete Q[a],c=b.constructor.name,D[c].remove({_id:a}),F.remove({componentId:a}),"RuntimeBehavior"===c&&F.removeFromMemory(a))}function A(a){delete Q[a]}function B(){Q={}}var C=a("./workflow.js"),D=a("./db.js"),E=a("./metamodel.js"),F=a("./behavior.js"),G=a("./helper.js"),H=a("./log.js"),I=a("./workflow.js"),J=a("./state.js"),K="property",L="link",M="collection",N="method",O="event",P="_name",Q={};d.prototype=new Array,c.create=y,c.get=x,c.removeFromMemory=A,c.clear=B,c.destroy=z},{"./behavior.js":2,"./db.js":4,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":9,"./workflow.js":10}],4:[function(a,b,c){"use strict";function d(){var a={},b="",d="",e="",f=null,g=null,h=null,i=null,j=null,k="",l="",m=0,n=0,o="";
if(a.schemas={},c.RuntimeSchema.count())for(k in r.RuntimeSchema)h=JSON.parse(JSON.stringify(r.RuntimeSchema[k])),h._core||(a.schemas[k]=h);if(a.models={},c.RuntimeModel.count())for(l in r.RuntimeModel)i=JSON.parse(JSON.stringify(r.RuntimeModel[l])),i._core||(a.models[l]=i);if(a.types={},c.RuntimeType.count())for(e in r.RuntimeType)f=JSON.parse(JSON.stringify(r.RuntimeType[e])),f.core||(a.types[f.name]=f);a.behaviors={};for(d in r.RuntimeBehavior)g=JSON.parse(JSON.stringify(r.RuntimeBehavior[d])),delete g.classInfo,g.core||(a.behaviors[d]=g);for(a.components={},m=s.length,n=0;n<m;n++)if(b=s[n],c[b].count()){j=JSON.parse(JSON.stringify(r[b]));for(o in j)delete j[o].classInfo,j[o]._core&&delete j[o];Object.keys(j).length&&(a.components[b]=j)}return a}function e(a,b){var c=!0,d="";for(d in a){if("undefined"==typeof b[d]){c=!1;break}if(a[d]instanceof RegExp){if(null===b[d].match(a[d])){c=!1;break}}else if(b[d]!==a[d]){c=!1;break}}return c}function f(a){c[a]=new v(a)}function g(a){var b="",e="",f="",g="",h="",i="",j="",k=[],m=null,o=null,p=null,q=null,r={};if(a){for(g in a.types)l.type(a.types[g]);for(h in a.schemas)l.schema(a.schemas[h]);for(i in a.models)l.model(a.models[i]);l.create();for(j in a.behaviors)c.RuntimeBehavior.insert(a.behaviors[j]);for(e in a.components)for(f in a.components[e])c[e].insert(a.components[e][f]);k=c.RuntimeSystem.find({master:!0}),k.length&&(k[0]._id===a._id?a.master=!0:(a.master=!0,k[0].master=!1)),c.RuntimeSystem.insert(a),b=a._id}else if(k=c.RuntimeSystem.find({master:!0}),k.length){p=k[0],m=p._id,r._id=m,r.name=p.name,r.description=p.description,r.version=p.version,r.master=!0,r.subsystem=!1,o=d();for(e in o)o.hasOwnProperty(e)&&(r[e]=o[e]);for(j in r.behaviors)q=r.behaviors[j],"main"!==q.state&&"start"!==q.state&&"stop"!==q.state||(q.component=m);b=JSON.stringify(r)}else b="{}",n.masterSystemNotFound();return b}function h(a){var b={},d=[],e="",f=0,g=0,h=null,i=null,j=null,k=null,l=null,m="";if(d=c.RuntimeSystem.find({master:!0}),d.length&&(e=d[0].name),b.name=a.name||"sub_"+e,b.version=a.version||"0.0.1",b.description=a.description||"",b.subsystem=!0,b.schemas={},a.schemas)for(d=c.RuntimeSchema.find(a.schema),g=d.length,f=0;f<g;f++)h=d[f],h._core||(b.schemas[h._id]=h);if(b.models={},a.models)for(d=c.RuntimeModel.find(a.models),g=d.length,f=0;f<g;f++)j=d[f],j._core||(b.models[j._id]=j);if(b.types={},a.types)for(d=c.RuntimeType.find(a.types),g=d.length,f=0;f<g;f++)i=d[f],i._core||(b.types[i._id]=i);if(b.behaviors={},a.behaviors)for(k=c.RuntimeBehavior.find(a.behaviors),g=d.length,f=0;f<g;f++)k=d[f],k.core||(b.behaviors[k._id]=k);if(b.components={},a.components)for(m in a.components)if(c[m])for(b.components[m]={},d=c[m].find(a.components[m]),g=d.length,f=0;f<g;f++)l=d[f],b.components[m][l._id]=l;return JSON.stringify(b)}function i(){var a=0,b=0,d="";for(a=s.length,b=0;b<a;b++)d=s[b],c[d].remove();for(a=t.length,b=0;b<a;b++)d=t[b],c[d].remove()}function j(){var a="",b=null;b=c.RuntimeSystem.find({_id:"e89c617b6b15d24"})[0],c.clear(),k.clear(),l.clear(),p.clear(),o.clear(),l.init(),a=c.system(b),k.get(a).main()}var k=a("./component.js"),l=a("./metamodel.js"),m=a("./helper.js"),n=a("./log.js"),o=a("./behavior.js"),p=a("./state.js"),q=a("./workflow.js"),r={},s=[],t=["Runtime","RuntimeSchema","RuntimeModel","RuntimeGeneratedModel","RuntimeBehavior","RuntimeState","RuntimeType","RuntimeMetamodel","RuntimeDatabase","RuntimeSystem","RuntimeClassInfo","RuntimeMessage","RuntimeChannel","RuntimeLogger"],u=["RuntimeSchema","RuntimeLogger","RuntimeModel","RuntimeGeneratedModel","RuntimeState","RuntimeType"],v=function(a){l.getSchema(a)||t.indexOf(a)!==-1?(r[a]={},this.name=a,t.indexOf(a)===-1&&s.push(a)):n.invalidCollectionName(a)};v.prototype.find=function(a){var b=[],c="",d={};if(a=a||null,a&&Object.keys(a).length)if(Array.isArray(a))a.forEach(function(a){for(c in r[this.name])d=r[this.name][c],e(a,d)&&b.push(d)}.bind(this));else for(c in r[this.name])d=r[this.name][c],e(a,d)&&b.push(d);else for(c in r[this.name])d=r[this.name][c],b.push(d);return b},v.prototype.insert=function(a){var b=[],d=null,e=[];return Array.isArray(a)?b=a:b.push(a),b.forEach(function(a){var b=null,f=[],g=null;switch(!0){case"RuntimeSchema"===this.name:case"RuntimeLogger"===this.name:case"RuntimeModel"===this.name:case"RuntimeType"===this.name:case"RuntimeGeneratedModel"===this.name:case l.isValidObject(a,l.getModel(this.name)):if("undefined"==typeof a._id&&(a._id=m.generateId()),l.prepareObject(a,l.getModel(this.name)),r[this.name][a._id]=a,d=k.get(this.name),d?(b=new d(a),e.push(b.id())):m.isRuntime()&&m.getRuntime().require("db")&&m.getRuntime().require("db").insert({collection:this.name,document:a}),"RuntimeMessage"===this.name&&m.isRuntime()){f=c.RuntimeChannel.find({});for(var h=f.length,i=0;i<h;i++)g=m.getRuntime().require(f[i]._id),q.state({component:f[i]._id,state:a.event,data:a.data})}break;default:n.invalidDocumentOnDbInsert(a,this.name)}}.bind(this)),e},v.prototype.update=function(a,b,c){var d=this.find(a),e=0,f=0,g=d.length,h="",i=l.getModel(this.name),j="";if(c=c||{},"undefined"==typeof c.upsert&&(c.upsert=c.upsert||!1),b)for(0===g&&c.upsert&&(a._id&&(b._id=a._id),this.insert(b),e+=1),f=0;f<g;f++){"undefined"!=typeof b._id&&b._id!==d[f]._id&&n.updateUuid(d[f]._id,b._id,"undefined"!=typeof k.get(b._id));for(h in b)"undefined"!=typeof d[f][h]&&("RuntimeSchema"!==this.name&&"RuntimeModel"!==this.name&&"RuntimeGeneratedModel"!==this.name?(j="",0!==h.indexOf("_")?j=i[h].type:l.getMetaDef()[h]&&(j=l.getMetaDef()[h].type),j?l.isValidType(b[h],j)?(d[f][h]=b[h],e+=1,m.isRuntime()&&m.getRuntime().require("db")&&m.getRuntime().require("db").update({collection:this.name,id:d[f]._id,field:h,value:b[h]}),q.state({component:d[f]._id,state:h,data:[b[h]]})):n.invalidPropertyTypeOnDbUpdate(this.name,d[f]._id,h,b[h],i[h].type):n.unknownPropertyOnDbUpdate(this.name,h,d[f]._id)):(d[f][h]=b[h],e+=1,m.isRuntime()&&m.getRuntime().require("db")&&m.getRuntime().require("db").update({collection:this.name,id:d[f]._id,field:h,value:b[h]})))}return e},v.prototype.remove=function(a){var b=[],c="",d=null,f={};if(a=a||null,a&&Object.keys(a).length)if(Array.isArray(a))a.forEach(function(a){for(c in r[this.name])f=r[this.name][c],e(a,f)&&(delete r[this.name][c],d=k.get(c),d&&d.destroy(),m.isRuntime()&&m.getRuntime().require("db")&&m.getRuntime().require("db").remove({collection:this.name,id:c}),b.push(c))}.bind(this));else for(c in r[this.name])f=r[this.name][c],e(a,f)&&(delete r[this.name][c],d=k.get(c),d&&d.destroy(),m.isRuntime()&&m.getRuntime().require("db")&&m.getRuntime().require("db").remove({collection:this.name,id:c}),b.push(c));else for(c in r[this.name])delete r[this.name][c],u.indexOf(this.name)==-1&&(d=k.get(c),d&&d.destroy()),m.isRuntime()&&m.getRuntime().require("db")&&m.getRuntime().require("db").remove({collection:this.name,id:c}),b.push(c);return b},v.prototype.count=function(){var a=0,b="";for(b in r[this.name])a++;return a},c.collection=f,c.store=r,c.system=g,c.subsystem=h,c.clear=i,c.init=j},{"./behavior.js":2,"./component.js":3,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":9,"./workflow.js":10}],5:[function(a,b,c){"use strict";function d(){var a=!1;return h.Runtime&&h.Runtime.find().length&&(a=!0),a}function e(){var a="";return j||(a=h.Runtime.find()[0]._id,j=i.get(a)),j}function f(){function a(){return Math.floor(65536*(1+Math.random())).toString(16)}function b(){var a="abcdefghijklmnopqrstuvwxyz";return a.charAt(Math.floor(Math.random()*a.length))}return b()+a()+a()+a()}function g(){void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){var a=/function\s([^(]{1,})\(/,b=a.exec(this.toString());return b&&b.length>1?b[1].trim():""},set:function(a){}})}var h=a("./db.js"),i=a("./component.js"),j=null;c.getRuntime=e,c.isRuntime=d,c.generateId=f,c.polyfill=g},{"./component.js":3,"./db.js":4}],6:[function(a,b,c){"use strict";function d(){var a="",b=[],c=null;return ga.getModel("RuntimeLogger")?(b=ha.RuntimeLogger.find(),b.length?(a=b[0][ja],ia.get(a)?(ma=ia.get(a),c=ma):c=na):c=na):c=na,c}function e(a){la=a}function f(a,b){var c="";c=b[ka]?"unknown property '"+a+"' for the definition of '"+b[ka]+"'":"unknown property '"+a+"' for a model",d().warn(c)}function g(a,b,c){d().warn("invalid type for property '"+a+"': expected type '"+b+"' instead of type '"+typeof c+"'")}function h(a,b){d().warn("'"+a+"' is an invalid value for the type enum '"+b+"'")}function i(a,b,c){d().warn("invalid class name for component '"+a+"': expected '"+b+"' instead of '"+c+"'")}function j(a){d().warn("missing property '"+a+"'")}function k(a){d().warn("schema '"+a+"' is missing.")}function l(a,b){d().error("the property '"+a+"' of the model '"+b+"' is invalid")}function m(a,b){d().warn("missing property '"+a+"' for the definition of '"+b+"'")}function n(a,b){d().error("the model '"+b+"' has an unknown property '"+a+"'")}function o(a){d().warn("the type '"+a+"' is not valid")}function p(a,b,c,e,f){var g="";"Function"!==b&&(g=" (class '"+b+"')"),"string"==typeof f?d().warn("invalid type for property '"+c+"' on component '"+a+"'"+g+": expected '"+f.replace("@","")+"' instead of '"+typeof e+"'"):d().warn("invalid type for property type '"+c+"' on component '"+g+": expected 'string' instead of '"+typeof f+"'")}function q(a,b,c){var e="";"Function"!==b&&(e=" (class '"+b+"')"),d().warn("can not set read-only property '"+c+"' on component '"+a+"'"+e)}function r(a,b){d().warn("invalid document '"+JSON.stringify(a).replace(/,/g,", ")+"' on an insert operation on collection '"+b+"'")}function s(a,b,c,e,f){d().warn("invalid type when trying to update the property '"+c+"' of document '"+b+"' (collection '"+a+"') with the value '"+JSON.stringify(e)+"': expected type '"+f+"'")}function t(a,b,c){d().warn("unknown property '"+a+"' on an update operation on collection '"+b+"' with component '"+c+"'")}function u(a,b){d().warn("try to call an unknown method '"+b+"' for the class '"+a+"'")}function v(a){d().warn("invalid name for creating the collection '"+a+"': there is no schema '"+a+"' in the metamodel")}function w(a,b,c,e,f){var g="";"Function"!==b&&(g=" (class '"+b+"')"),f?d().warn("invalid type for the result of method '"+c+"' on component '"+a+"'"+g+": expected type '"+e+"' instead of type '"+f+"'"):d().warn("invalid type for the result of method '"+c+"' on component '"+a+"'"+g+": expected type '"+e+"'")}function x(a,b){d().warn("unkown class component '"+a+"' for component '"+b+"'")}function y(){d().warn("runtime has been restarted")}function z(a,b,c){var e="";"Function"!==b&&(e=" (class '"+b+"')"),d().warn("invalid number of parameters when calling the method '"+c+"' on component '"+a+"'"+e)}function A(a,b,c,e){var f="";"Function"!==b&&(f=" (class '"+b+"')"),d().warn("invalid type for the parameter '"+e+"' when calling the method '"+c+"' on component '"+a+"'"+f)}function B(a,b){d().warn("try to add more than one behavior for the state '"+b+"' on class '"+a+"'")}function C(a,b){d().warn("try to add a behavior with an unkwown state '"+b+"' on class '"+a+"'")}function D(a,b){d().warn("try to remove a behavior from an unkwown state '"+b+"' on class '"+a+"'")}function E(){d().warn("can not export the database because no system was defined")}function F(a,b){d().warn("invalid type for value '"+JSON.stringify(a)+"': expected '"+b+"'")}function G(a){d().warn("unknown type for value '"+JSON.stringify(a)+"'")}function H(a,b){d().debug("can not yet validate if the component '"+a+"' is an instance of '"+b+"'")}function I(a,b,c){d().warn("invalid type for the message '"+JSON.stringify(a)+"': expected type '"+c+"' for event '"+b+"'")}function J(a,b,c){var e="";"Function"!==b&&(e=" (class '"+b+"')"),d().warn("invalid number of parameters when adding an action on method '"+c+"' on component '"+a+"'"+e)}function K(a,b,c){c?d().warn("try to update a component of id '"+a+"' with the new id '"+b+"' that is already used"):d().warn("try to update a component of id '"+a+"' with the new id '"+b+"'")}function L(a){d().warn("try to change the state of the destroyed component '"+a+"'")}function M(a){d().warn("the schema '"+a+"' is not valid")}function N(a){d().warn("the model '"+a+"' is not valid")}function O(a){d().warn("the parameters for creating a component of class '"+a+"' are not compliant with the model")}function P(a,b){d().warn("trying to get the property '"+a+"' on the destroyed component '"+b+"'")}function Q(a,b){d().warn("the constructor parameter '"+JSON.stringify(a).replace(/,/g,", ")+"' for creating a component of class '"+b+"' is not an object")}function R(a){d().warn("try get the information of an unknown model '"+a+"'")}function S(a){d().warn("the schema '"+a+"' is missing")}function T(a){a?d().error("a cyclic inheritance dependency with "+a+" schema has been found, please check the '_inherit' properties of your schemas"):d().error("a cyclic inheritance dependency has been found, please check the '_inherit' properties of your schemas")}function U(a,b,c){d().warn("invalid type for enumerated type '"+b+"': expected type '"+c+"' instead of type '"+typeof a+"'")}function V(a){d().debug("load schema '"+a+"'")}function W(a){d().debug("load model '"+a+"'")}function X(a){d().debug("load type '"+a+"'")}function Y(a){d().debug("compile schema '"+a+"'...")}function Z(a){d().debug("generate model '"+a+"'...")}function $(a){d().debug("analyze model '"+a+"'...")}function _(a){d().debug("create collection '"+a+"'")}function aa(a){d().debug("create class '"+a+"'")}function ba(){d().debug("starting model creation...")}function ca(){d().debug("model creation ended")}function da(a,b,c,e){"Function"!==c?d().error("error when trying to call the method '"+a+"' on component '"+b+"' (class '"+c+"'): "+e):d().error("error when trying to call the method '"+a+"' on component '"+b+"': "+e)}function ea(a,b){d().warn("invalid property '"+b+"' for schema '"+a+"': only 'property', 'link', 'collection', 'method' and 'event' are allowed.")}function fa(a){d().warn("invalid format for a definition of a property': '"+a+"' is not an object")}var ga=(a("./helper.js"),a("./workflow.js"),a("./metamodel.js")),ha=a("./db.js"),ia=a("./component.js"),ja="_id",ka="_name",la="warn",ma=null,na={currentLevel:"warn",level:function(a){return a&&(this.currentLevel=a),this.currentLevel},debug:function(a){"debug"===this.currentLevel&&console.log("runtime: "+a)},info:function(a){"info"!==this.currentLevel&&"debug"!==this.currentLevel||console.info("runtime: "+a)},warn:function(a){"info"!==this.currentLevel&&"warn"!==this.currentLevel&&"debug"!==this.currentLevel||console.warn("runtime: "+a)},error:function(a){console.error("runtime: "+a)}};c.level=e,c.unknownProperty=f,c.invalidPropertyType=g,c.invalidEnumValue=h,c.invalidClassName=i,c.missingProperty=j,c.missingImplementation=k,c.invalidTypeImp=l,c.missingPropertyImp=m,c.unknownPropertyImp=n,c.invalidTypeDefinition=o,c.invalidPropertyName=p,c.readOnlyProperty=q,c.invalidDocumentOnDbInsert=r,c.invalidPropertyTypeOnDbUpdate=s,c.unknownMethod=u,c.invalidCollectionName=v,c.invalidResultType=w,c.unknownComponent=x,c.workflowRestarted=y,c.invalidParamNumber=z,c.invalidParamType=A,c.behaviorNotUnique=B,c.invalidStateOn=C,c.invalidStateOff=D,c.masterSystemNotFound=E,c.invalidType=F,c.unknownType=G,c.canNotYetValidate=H,c.invalidChannelEvent=I,c.invalidParamNumberMethodOn=J,c.updateUuid=K,c.unknownPropertyOnDbUpdate=t,c.invalidUseOfComponent=L,c.invalidSchema=M,c.invalidModel=N,c.invalidParameters=O,c.destroyedComponentCall=P,c.invalidConctructorParameters=Q,c.unknownModel=R,c.missingSchema=S,c.cyclicDependency=T,c.invalidEnumType=U,c.loadSchema=V,c.loadModel=W,c.loadType=X,c.compileSchema=Y,c.generateModel=Z,c.checkModel=$,c.createCollection=_,c.createClass=aa,c.modelCreationBegin=ba,c.modelCreationEnd=ca,c.actionInvokeError=da,c.invalidSchemaProperty=ea,c.invalidPropertyFormat=fa},{"./component.js":3,"./db.js":4,"./helper.js":5,"./metamodel.js":7,"./workflow.js":10}],7:[function(a,b,c){"use strict";function d(){var a="",b="",c="",d={},e="",f=null,g=null,i=null,j={},k={},l=[],m=0,n=0,o=0,p=0,q=[];for(c in oa.compiledSchemas){d=oa.compiledSchemas[c],j={_name:d._name},"undefined"!=typeof d._core&&(j._core=d._core),Array.isArray(d._inherit)&&(j._inherit=d._inherit),"undefined"!=typeof d._class&&(j._class=d._class),"undefined"!=typeof d._description&&(j._description=d._description);for(a in d)switch(!0){case"property"===d[a]:j[a]={type:"any",readOnly:!1,mandatory:!1,default:"",description:a,label:a};break;case"link"===d[a]:j[a]={type:"@RuntimeComponent",readOnly:!1,mandatory:!1,default:"",description:a,label:a};break;case"method"===d[a]:j[a]={params:[{name:"param",type:"any",mandatory:!1}],result:"any",description:a};break;case"event"===d[a]:j[a]={params:[{name:"param",type:"any",mandatory:!1}],description:a};break;case"collection"===d[a]:j[a]={type:["@RuntimeComponent"],readOnly:!1,mandatory:!1,default:[],description:a,label:a};break;default:0!==a.indexOf("_")&&$.invalidSchemaProperty(d._name,a)}oa.generatedModels[j._name]=j}for(e in oa.generatedModels)j=oa.generatedModels[e],b=j[ca],g=oa.models[b],g&&(k=A(g,j),delete k._id,oa.generatedModels[b]=k);for(q=h(),p=q.length,n=0;n<p;n++)if(e=q[n],j=oa.generatedModels[e]){l=X(e),l.reverse();JSON.parse(JSON.stringify(j));for(m=l.length,o=0;o<m;o++)b=l[o],f=oa.generatedModels[b],f&&(k=A(f,j),delete k._id,oa.generatedModels[e]=k);g=oa.models[e],g&&(k=A(g,oa.generatedModels[e]),delete k._id,oa.generatedModels[e]=k)}for(e in oa.generatedModels)i=oa.generatedModels[e],Z.RuntimeGeneratedModel.insert(i),i._core||$.generateModel(e)}function e(){var a=[],b=[],c=null,d={},e=[],f=null,g="",h="",i=0,j=0;for(oa.inheritance={},oa.inheritanceTree={},oa.schemas={},oa.compiledSchemas={},oa.models={},oa.generatedModels={},oa.states={},oa.type={},a=Z.RuntimeSchema.find({}),j=a.length,i=0;i<j;i++)c=a[i],g=c[ca],h=c[ea],oa.schemas[g]=c,h&&(oa.inheritance[g]=h),c._core||$.loadSchema(g);for(e=Z.RuntimeModel.find({}),j=e.length,i=0;i<j;i++)d=e[i],g=d[ca],oa.models[g]=d,d._core||$.loadModel(g);for(b=Z.RuntimeType.find({}),j=b.length,i=0;i<j;i++)f=b[i],oa.type[f.name]=f,f.core||$.loadType(f.name)}function f(){function a(a){var b=0,c=0,d=!0;for(c=a.length,b=0;b<c;b++)a[b].length&&(d=!1);return d}function b(a,b){var c=0,d=0,e=[];for(d=b.length,c=0;c<d;c++)0===b[c].indexOf(a)&&(e=b[c],e.reverse(),e.pop(),e.reverse(),b[c]=e)}function c(a,b){var c=!0,d=0,e=0;for(e=b.length,d=0;d<e;d++)b[d].indexOf(a)>0&&(c=!1);return c}function d(a){var d=0,e=0,f=[];for(e=a.length,d=0;d<e;d++)if(c(a[d][0],a)){f.push(a[d][0]),b(a[d][0],a);break}return f}function e(b){var c=[],e=[];for(e=d(b);void 0!==e[0];)c=c.concat(e),e=d(b);return a(b)||$.cyclicDependency(),c}function f(a){function b(a,b){var c=!1;return Array.isArray(oa.inheritance[b])&&oa.inheritance[b].indexOf(a)!==-1&&($.cyclicDependency(a),c=!0),c}var c=[],d=[],g=0,h=0;for(Array.isArray(oa.inheritance[a])?d=oa.inheritance[a].slice():$.missingSchema(a),h=d.length,g=0;g<h;g++)if(b(a,d[g])){d=[];break}return c=d.length?[a].concat(e(d.map(f).concat([d]))):[a]}var g="",h=[],i=[];for(g in oa.inheritance)h=f(g),i=h.reverse(),i.pop(),i.length&&(oa.inheritanceTree[g]=i)}function g(a){var b={},c=oa.schemas[a],d=oa.inheritanceTree[a],e=0,f=0,g=null,h="";for(d&&(e=d.length,d.reverse()),f=0;f<e;f++){g=oa.schemas[d[f]];for(h in g)0!==h.indexOf("_")&&(b[h]=g[h])}for(h in c)b[h]=c[h];return b}function h(){var a=[],b={},c=[],d="",e=0;for(d in oa.inheritanceTree)e=oa.inheritanceTree[d].length,"undefined"==typeof b[e]&&(b[e]=[]),b[e].push(d);return c=Object.keys(b).sort(),c.forEach(function(c){b[c].forEach(function(b){a.push(b)})}),a}function i(){var a="";for(a in oa.schemas)oa.schemas[a]._core||$.compileSchema(a),oa.compiledSchemas[a]=g(a)}function j(){var a="",b=null,c="";for(a in oa.generatedModels)b=oa.generatedModels[a],b&&(c=oa.compiledSchemas[a],c?(b._core||$.checkModel(a),l(b,c)):$.missingImplementation(a))}function k(){var a="",b=null,c="",d=[],e="";for(a in oa.compiledSchemas){if(d=[],b=oa.compiledSchemas[a])for(e in b)c=b[e],0!==e.indexOf("_")&&ma.indexOf(c)!==-1&&d.push(e);oa.states[a]=d}}function l(a,b){var c="",d=null;for(c in b)c!==ba&&c!==ca&&c!==da&&c!==ea&&c!==fa&&c!==ga&&("undefined"!=typeof a[c]?(d=a[c],m(d,b[c])||$.invalidTypeImp(c,a[ca])):$.missingPropertyImp(c,a[ca]));for(c in a)c!==ba&&c!==ca&&c!==da&&c!==ea&&c!==fa&&c!==ga&&"undefined"==typeof b[c]&&$.unknownPropertyImp(c,a[ca])}function m(a,b){var c=!0;return c=y(b,"string")&&na.indexOf(b)!==-1?y(a,b):n(a,b)}function n(a,b){var c=!0,d=oa.type[b],e=0,f=0;if(y(d,"undefined"))c=!1;else if(y(a,"undefined"))c=!1;else if("array"===d.type)for(e=a.length,f=0;f<e&&(c=y(d.schema,"undefined")?O(a[f],d.type):Q(a[f],d.schema),c!==!1);f++);else c=y(d.schema,"undefined")?O(a,d.type):Q(a,d.schema);return c}function o(){Z.collection("RuntimeLogger"),Z.collection("RuntimeSchema"),Z.collection("RuntimeModel"),Z.collection("RuntimeGeneratedModel"),Z.collection("RuntimeClassInfo"),Z.collection("RuntimeBehavior"),Z.collection("RuntimeState"),Z.collection("RuntimeType"),Z.collection("RuntimeMessage"),Z.collection("RuntimeChannel")}function p(){var a="",b={};for(a in oa.generatedModels)b=oa.generatedModels[a],"undefined"==typeof Z[b[ca]]&&b[fa]!==!1&&(Z.collection(b[ca]),b._core||$.createCollection(b[ca]))}function q(){var a="",b={};for(a in oa.generatedModels)b=oa.generatedModels[a],b[fa]!==!1&&(_.create({model:a}),b._core||$.createClass(a))}function r(){var a="",b={},c="";for(a in oa.generatedModels)b=oa.generatedModels[a],c=b[ca]+"Info",b[fa]!==!1&&Y(b[ca],"RuntimeComponent")&&(_.get(c)?Z.RuntimeClassInfo.update({_id:c},{_id:c,schema:oa.compiledSchemas[a],model:b}):Z.RuntimeClassInfo.insert({_id:c,schema:oa.compiledSchemas[a],model:b}))}function s(a){return a.replace("@","")}function t(a){var b=y(a,"string")&&na.indexOf(a)===-1&&!u(a);return b}function u(a){return a.indexOf("@")!==-1}function v(a){var b="";return b=Array.isArray(a)?"array":typeof a,"any"===a&&(b="any"),b}function w(a){var b="";return a&&a.constructor&&(b=a.constructor.name),b}function x(a,b){return b.indexOf(a)!==-1}function y(a,b){var c=!0,d=null;switch(b){case"array":c=Array.isArray(a);break;case"date":"string"==typeof a?(d=new Date(a),c=!isNaN(d.getDate())):c=a instanceof Date;break;case"any":c=!0;break;default:c=b===typeof a}return c}function z(a,b,c){var d=!1,e=oa.generatedModels[b],f="";return e&&e[ca]&&(e=oa.compiledSchemas[e[ca]]),e&&(f=e[a],f===c&&(d=!0)),d}function A(a,b,c){var d="",e=b;for(d in a)a.hasOwnProperty(d)&&0!==d.indexOf("_")&&(e[d]=a[d]);return e}function B(a){var b=null,c=[],d=null,e="",f={},g=[];return d=JSON.parse(JSON.stringify(a)),e=d[ca],"undefined"==typeof d[ba]&&(d[ba]=aa.generateId()),"undefined"==typeof d[ea]&&(d[ea]=["RuntimeComponent"]),R(d,oa.metadef.schema,!1)?(g=Z.RuntimeSchema.find({_name:e}),g.length?(f=A(d,g[0]),delete f._id,Z.RuntimeSchema.update({_name:e},f),b=g[0]._id):(c=Z.RuntimeSchema.insert(d),b=c[0])):$.invalidSchema(d[ca]),b}function C(a){var b=null,c=null,d=[],e="",f={},g=[];return b=JSON.parse(JSON.stringify(a)),e=b[ca],"undefined"==typeof b[ba]&&(b[ba]=aa.generateId()),R(b,oa.metadef.model,!1)?(g=Z.RuntimeModel.find({_name:e}),g.length?(f=A(b,g[0]),delete f._id,Z.RuntimeModel.update({_name:e},f),c=g[0]._id):(d=Z.RuntimeModel.insert(b),c=d[0])):$.invalidModel(b[ca]),c}function D(a){var b=null,c=[],d=a.name;return R(a,oa.metadef.type)?(c=Z.RuntimeType.insert(a),b=c[0]):$.invalidTypeDefinition(d),b}function E(){F(),oa.metadef={schema:{_id:{type:"string",mandatory:!0},_name:{type:"string",mandatory:!0},_inherit:{type:["string"],mandatory:!1,default:["RuntimeComponent"]},_class:{type:"boolean",mandatory:!1},_core:{type:"boolean",mandatory:!1},_description:{type:"string",mandatory:!1}},model:{_id:{type:"string",mandatory:!0},_name:{type:"string",mandatory:!0},_inherit:{type:["string"],mandatory:!1},_class:{type:"boolean",mandatory:!1},_core:{type:"boolean",mandatory:!1},_description:{type:"string",mandatory:!1}},type:{_id:{type:"string",mandatory:!1},name:{type:"string",mandatory:!0},type:{type:"string",mandatory:!0},schema:{type:"object",mandatory:!1},value:{type:["any"],mandatory:!1},core:{type:"boolean",mandatory:!1},_description:{type:"string",mandatory:!1}}},o()}function F(){oa={metadef:{},inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}}}function G(){$.modelCreationBegin(),e(),f(),i(),d(),j(),k(),p(),q(),r(),$.modelCreationEnd()}function H(a,b){return z(a,b,ia)}function I(a,b){return z(a,b,ja)}function J(a,b){return z(a,b,ka)}function K(a,b){return z(a,b,la)}function L(a,b){return z(a,b,ha)}function M(a,b){var c=!1,d=oa.generatedModels[b],e="";return d[a]&&(e=oa.type[d[a].type]),e&&e.schema&&(c=!0),c}function N(a,b){var c=!1,d=oa.generatedModels[b],e={};return d&&d[ca]&&(d=oa.generatedModels[d[ca]]),e=oa.states[d[ca]],Array.isArray(e)&&(c=e.indexOf(a)!==-1),c}function O(a,b){function c(a,b){var c=oa.type[b],d=!0;return Array.isArray(c.value)&&c.value.indexOf(a)===-1&&(d=!1),d===!1&&$.invalidEnumValue(a,b),d}function d(a,b){var c=!0,d=s(b),e=a;return""!==a&&null!==a&&(y(a,"string")&&(e=_.get(a)),w(e)!==d&&"{}"!==JSON.stringify(e)&&(c=!1,$.invalidType(a,b.replace("@","")))),c}function e(a,b){var c=!0,e="",f=0,g=0;switch(e=v(b)){case"string":c=y(a,b);break;case"array":for(g=a.length,f=0;f<g;f++)switch(!0){case t(b[0]):c=n(a[f],b[0]);break;case u(b[0]):c=d(a[f],b[0]);break;default:c=y(a[f],b[0])}}return c}var f=!0;if(y(b,"string"))switch(!0){case t(b):f=n(a,b),f||$.invalidEnumType(a,b,oa.type[b].type),f&&(f=c(a,b));break;case u(b):f=d(a,b);break;default:f=e(a,b)}else f=!1;return f}function P(a,b){function c(a,b){var c=!1,d="";return d=a.constructor.name,"Function"===d&&(d=a.name),c=d===b}var d=!0;return u(b.type)?(d=c(_.get(a),s(b.type))&&b.value.indexOf(a)!==-1,d||$.invalidEnumValue(a,b.type)):(d=y(a,b.type)&&b.value.indexOf(a)!==-1,d||$.invalidEnumValue(a,b.type)),d}function Q(a,b){function c(){var b=!0,c=[];return j=s(i),j=a[j],t(j)?oa.type[j]?oa.type[j].schema?b=Q(f,oa.type[j].schema):(b=y(f,oa.type[j].type),c=oa.type[j].value,c&&(b=x(f,c))):b=!1:b="array"===j?Array.isArray(f):u(j)?y(f,"object")||y(f,"string"):y(f,j),b||$.invalidPropertyType(e,j,f),b}function d(){var a=!0;switch(k=v(i)){case"string":if(t(k))a=Q(f,i);else if(!y(f,i)){$.invalidPropertyType(e,i,f),a=!1;break}break;case"array":for(l=f.length,m=0;m<l;m++)if(t(i[0]))a=Q(f[m],oa.type[i[0]].schema);else if(!y(f[m],i[0])){$.invalidPropertyType(f[m],i[0],f[m]),a=!1;break}}return a}var e="",f=null,g=!0,h=!0,i="",j="",k="",l=0,m=0;if(y(a,"object")){for(e in a){if(f=a[e],y(b[e],"undefined"))return $.unknownProperty(e,b),!1;switch(i=b[e].type,!0){case u(i):g=c();break;default:g=d()}if(!g)break}for(e in b)if(f=b[e],h=f.mandatory,h===!0&&y(a[e],"undefined")&&void 0!==a[e]){$.missingProperty(e),g=!1;break}}else g=!1,$.invalidPropertyFormat(a);return g}function R(a,b,c,d){function e(a,b){var c=!0,d="";if(d=oa.type[b])switch(!0){case!y(d.schema,"undefined"):c=R(a,d.schema);break;case!y(d.value,"undefined"):c=P(a,d);break;default:c=O(a,d.type)}else c=!1;return c}function f(b,c){var e=!0,f=null,g=!1;if(m=s(c),b&&b.id?(f=b,g=!0):f=_.get(b),y(f,"undefined"))switch(!0){case y(b,"object")&&null!==b&&Object.keys(b).length>0:case y(b,"string")&&""!==b:$.canNotYetValidate(b,m)}else Y(f.constructor.name,m)?g&&d&&(a[h]=f.id()):(e=!1,$.invalidType(b,m));return e}function g(a,b){var c=!0,e=null,f="";switch(n=v(b)){case"any":break;case"string":if(t(n))c=R(a,b);else if("array"===b){if("array"!==v(a)){$.invalidPropertyType(h,b,a),c=!1;break}}else if("date"===b){if(e=new Date(a),c=!isNaN(e.getDate()),!c){$.invalidPropertyType(h,b,a);break}}else if(v(a)!==b&&"any"!==v(a)){$.invalidPropertyType(h,b,a),c=!1;break}break;case"array":if(Array.isArray(a)){for(o=a.length,f=b[0],p=0;p<o;p++)if(t(f))c=R(a[p],oa.type[f].schema);else if(u(f))if("string"===v(a[p]))if(_.get(a[p])){if(!Y(w(_.get(a[p])),s(f))){$.invalidClassName(JSON.stringify(a[p]),s(f),w(_.get(a[p]))),c=!1;break}}else""!==a[p]&&$.canNotYetValidate(a[p],s(f));else{if(!Y(w(a[p]),s(f))){$.invalidClassName(JSON.stringify(a[p]),s(f),w(a[p])),c=!1;break}d&&(a[p]=a[p].id())}else if(v(a[p])!==f&&"any"!==f){$.invalidPropertyType(a[p],f,a[p]),c=!1;break}}else c=!1,$.invalidType(a,"array");break;default:c=!1,$.unknownType(a)}return c}var h="",i=null,j=!0,k=!0,l="",m="",n="",o=0,p=0;y(c,"undefined")&&(c=!0),y(d,"undefined")&&(c=!1);for(h in a)if(i=a[h],y(b[h],"undefined")&&"_core"!==h){if(c)return $.unknownProperty(h,b),!1}else switch(l="_core"!==h?b[h].type:"boolean","_id"===h&&(l="string"),!0){case t(l):j=e(i,l);break;case u(l):j=f(i,l);break;default:j=g(i,l)}for(h in b)i=b[h],k=i.mandatory,y(a[h],"undefined")&&k===!0&&($.missingProperty(h),j=!1);return j}function S(a,b){var c="",d=null,e=!0,f="";for(c in b)d=b[c],e=d.mandatory,f=d.default,y(a[c],"undefined")&&(e!==!1||y(f,"undefined")||(a[c]=f))}function T(a){var b=null;return oa.compiledSchemas[a]&&(b=oa.compiledSchemas[a]),b}function U(a){var b=null;return oa.generatedModels[a]&&(b=oa.generatedModels[a]),b}function V(a){var b=null;return oa.type[a]&&oa.type[a]&&(b=JSON.parse(JSON.stringify(oa.type[a]))),b}function W(){var a=oa.metadef.schema;return a}function X(a){var b=[];return b=oa.inheritanceTree[a]?oa.inheritanceTree[a].slice():[]}function Y(a,b){function c(a,b){var d=!1,e=[],f=0,g=0;if(e=X(a),0!==e.length)if(e.indexOf(b)!==-1)d=!0;else for(f=0;f<g&&!(d=c(e[f],b));f++);return d}var d=!1,e=[],f=0,g=0;if(a!==b){if(e=X(a),g=e.length,0!==e.length)if(e.indexOf(b)!==-1)d=!0;else for(f=0;f<g&&!(d=c(e[f],b));f++);}else d=!0;return d}var Z=a("./db.js"),$=a("./log.js"),_=a("./component.js"),aa=(a("./workflow.js"),a("./helper.js")),ba="_id",ca="_name",da="_description",ea="_inherit",fa="_class",ga="_core",ha="method",ia="event",ja="property",ka="link",la="collection",ma=["property","collection","link","method","event"],na=["boolean","string","number","object","function","array","date","any"],oa={metadef:{},inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}};c.init=E,c.clear=F,c.schema=B,c.model=C,c.type=D,c.create=G,c.getSchema=T,c.getModel=U,c.getMetaDef=W,c.getParents=X,c.inheritFrom=Y,c.isValidObject=R,c.prepareObject=S,c.isValidType=O,c.isValidEnum=P,c.isValidState=N,c.isEvent=H,c.isProperty=I,c.isLink=J,c.isCollection=K,c.isMethod=L,c.isStructure=M,c.getType=V},{"./component.js":3,"./db.js":4,"./helper.js":5,"./log.js":6,"./workflow.js":10}],8:[function(a,b,c){(function(c){"use strict";"undefined"==typeof window&&"undefined"!=typeof c&&(c.require=a);var d=a("./db.js"),e=a("./component.js"),f=a("./metamodel.js"),g=a("../build/system/system.js"),h=a("./helper.js"),i="",j="",k=null;h.polyfill(),f.init(),i=d.system(g.system),j=e.get(i),k=e.get("channel"),j.state("installed"),k.$systemInstalled(i),j.state("resolved"),k.$systemResolved(i),j.state("starting"),k.$systemStarted(i),j.main(),j.start(),j.state("active"),b.exports=e.get("runtime")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../build/system/system.js":1,"./component.js":3,"./db.js":4,"./helper.js":5,"./metamodel.js":7}],9:[function(a,b,c){"use strict";function d(a,b,c){h[a]={name:b,parameters:{data:c}},g.store.RuntimeState[a]={name:b,parameters:{data:c}}}function e(a){return h[a]}function f(){h={}}var g=a("./db.js"),h={};c.set=d,c.get=e,c.clear=f},{"./db.js":4}],10:[function(a,b,c){"use strict";function d(a){this.message=a,this.name="RuntimeError"}function e(a,b){var c=null,d=[],e=[],f=0,g=0;if(s.getModel(a)?c=s.getModel(a)[b]:x.unknownModel(a),c){if(d=c.params)for(f=d.length,g=0;g<f;g++)e.push(d[g].name)}else x.unknownMethod(a,b);return e}function f(a,b){var c=null,d=[],e=[],f=0,g=0,h=0,i=0;if(s.getModel(a)?c=s.getModel(a)[b]:x.unknownModel(a),c){if(d=c.params)for(f=d.length,g=0;g<f;g++)"undefined"!=typeof d[g].mandatory&&d[g].mandatory!==!0||(h+=1),i+=1;e.push(h),e.push(i)}else x.unknownMethod(a,b);
return e}function g(a,b,c){var d=null,e=[],f=[],g=0,h=0;if(d=s.getModel(a)[b]){if(e=d.params)for(g=e.length,h=0;h<g;h++)e[h].mandatory===!1&&"undefined"==typeof c[h]?f.push(e[h].default):f.push(c[h])}else x.unknownMethod(a,b);return f}function h(a,b){var c=null,d=null;return s.getModel(a)?c=s.getModel(a)[b].result:x.unknownModel(a),c&&(d=c),d}function i(a,b){var c=null,d=[],e=[],f=0,g=0;if(s.getModel(a)?c=s.getModel(a)[b]:x.unknownModel(a),c){if(d=c.params)for(f=d.length,g=0;g<f;g++)e.push(d[g].type)}else x.unknownMethod(a,b);return e}function j(a){a=a||{};var b=a.component||null,c=a.methodName||"",d=null,e="",f=null,g=!0;if(d="undefined"!=typeof a.methodResult?a.methodResult:void 0,e="Function"===b.constructor.name?b.name:b.constructor.name,f=h(e,c),null!==f)switch(!0){case"any"===f:break;case"array"===f:Array.isArray(d)||(g=!1,x.invalidResultType(b.id(),b.constructor.name,c,f,null));break;default:typeof d!==f&&(g=!1,x.invalidResultType(b.id(),b.constructor.name,c,f,typeof d))}return g}function k(a,b,c){var d=u.getActions(a.id(),b),e=[],f=0,g=0,h=null;if(!d.length||c)if("Function"!==a.constructor.name)d=d.concat(k(t.get(a.constructor.name),b,c));else for(e=s.getParents(a.name),f=e.length,g=0;g<f&&(h=t.get(e[g]),h?d=d.concat(k(h,b,c)):x.unknownComponent(e[g],a.name),!d.length);g++);return d.length&&d.reverse(),d}function l(a,b,e,f,h){var i=null,j=[],k="",l=0,m=0;k="Function"===a.constructor.name?a.name:a.constructor.name,s.isProperty(b,k)||s.isLink(b,k)||s.isCollection(b,k)||(f=g(k,b,f));try{for(m=f.length,l=0;l<m;l++)j.push(f[l]);e.useCoreAPI&&(j.push(t),j.push(y),j.push(s),j.push(c),j.push(u),j.push(v),j.push(x)),h?setTimeout(e.action.bind.apply(e.action,[a].concat(j)),0):i=e.action.apply(a,j)}catch(c){if(c instanceof d)throw c;a&&a.error&&a.error({message:"error when trying to call the method '"+b+"' on component '"+a.id()+"'",error:c}),w.getRuntime()&&w.getRuntime().error({message:"error when trying to call the method '"+b+"' on component '"+a.id()+"'",error:c}),x.actionInvokeError(b,a.id(),a.constructor.name,c.message)}return i}function m(a,b,c){var d="",e=-1,g="",h="",i=[],j=0,k=[],l=!1,m=!1,n=!1,o=!1;switch(d=c.toString(),e=d.indexOf("{"),g=d.substring(0,e),h=g.split("(")[1].replace(")","").trim(),i=h.split(","),""===i[0]&&(i=[]),j=i.length,l=s.isProperty(b,a),m=s.isLink(b,a),n=s.isCollection(b,a),!0){case n:k=[2,2];break;case l:k=[1,1];break;case m:k=[1,1];break;default:k=f(a,b)}return k[0]<=j&&j<=k[1]&&(o=!0),o}function n(a){a=a||{};var b=a.component||null,c=a.methodName||"",d=a.args||"",g=[],h=[],j=[],k="",l=d.length,m=0,n=null,o=!0,p=!1,q=!1,r=!1;switch(k="Function"===b.constructor.name?b.name:b.constructor.name,p=s.isProperty(c,k),q=s.isLink(c,k),r=s.isCollection(c,k),g=e(k,c),!0){case r:h=[s.getModel(k)[c].type[0],"string"],j=[2,2];break;case p:h=[s.getModel(k)[c].type],j=[1,1];break;case q:h=[s.getModel(k)[c].type],j=[1,1];break;default:h=i(k,c),j=f(k,c)}for("undefined"==typeof l&&(l=1),(l<j[0]||j[1]<l)&&(o=!1,x.invalidParamNumber(b.id(),b.constructor.name,c)),m=0;m<l;m++)if(n=d[m],"undefined"==typeof n){if(!(m<j[0]))continue;o=!1,x.invalidParamNumber(b.id(),b.constructor.name,c)}else s.isValidType(n,h[m])||(o=!1,x.invalidParamType(b.id(),b.constructor.name,c,g[m]));return o}function o(a,b){var c=!1,d=!1,e=!1,f=!1,g=[],h=null,i=null,j="",k=null;g=y.RuntimeBehavior.find({_id:a}),k=u.get(a),1===g.length&&(h=g[0],i=t.get(h.component),i&&(j="Function"===i.constructor.name?i.name:i.constructor.name,c=s.isEvent(h.state,j),d=s.isProperty(h.state,j),e=s.isLink(h.state,j),f=s.isCollection(h.state,j),(c||d||f||e)&&l(i,h.state,{useCoreAPI:h.useCoreAPI,action:k},b,!0)))}function p(a){a=a||{},a.component=a.component||"",a.state=a.state||"",a.data=a.data||[];var b=null,c="",d=[],e=null,f=null,g=0,h=0,i=!1,m=!1,o=!1,p=!1,q=!1;if(c=v.get(a.component),"destroy"===c&&x.invalidUseOfComponent(a.component),b=t.get(a.component),b&&(i="Function"===b.constructor.name?b.name:b.constructor.name,q=s.isEvent(a.state,i),m=s.isProperty(a.state,i),o=s.isLink(a.state,i),p=s.isCollection(a.state,i),d=k(b,a.state,q)),d.length){if(n({component:b,methodName:a.state,args:a.data}))if(q||m||o||p){for(h=d.length,g=0;g<h;g++)e=d[g],l(b,a.state,e,a.data,!0);v.set(b.id(),a.state,a.data)}else e=d[0],f=l(b,a.state,e,a.data,!1),j({component:b,methodName:a.state,methodResult:f});return f}b&&(q||m||o||p)&&v.set(b.id(),a.state,a.data)}function q(a){if(a=a||{},"undefined"==typeof a.error&&(a.error=!1),a.message=a.message||"",c.state=function(){},a.error)throw new d(a.message?"runtime has been stopped because "+a.message:"runtime has been stopped because of an unknown error");a.message?console.error("runtime: runtime has been stopped because "+a.message):console.error("runtime: runtime has been stopped")}function r(){c.state=p,x.workflowRestarted()}var s=a("./metamodel.js"),t=a("./component.js"),u=a("./behavior.js"),v=a("./state.js"),w=a("./helper.js"),x=a("./log.js"),y=a("./db.js");d.prototype=new Error,d.prototype.constructor=d,c.state=p,c.stop=q,c.restart=r,c.checkParams=n,c.validParamNumbers=m,c.action=o},{"./behavior.js":2,"./component.js":3,"./db.js":4,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":9}]},{},[8])(8)});