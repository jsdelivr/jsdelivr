/*
* Copyright (c) 2014 Johannes Mittendorfer (http://johannes-mittendorfer.com)
* Licensed under the MIT License (LICENSE.txt).
*
* Version 0.1.0 2014-04-14
*/

"use strict";var EAN13;EAN13=function(){function a(){}return a.prototype.defaults={number:!0,prefix:!0,color:"#000",offsetX:0,offsetY:0,onValid:function(){},onInvalid:function(){},onSuccess:function(){},onError:function(){}},a.prototype.options={},a.prototype.draw=function(a,b,c){var d;return this.parseOptions(c),d=this.getCode(b),this.print(a,d,b)},a.prototype.print=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(k={prefix_offset:.06,font_stretch:.073,border_line_height_number:.9,border_line_height:1,line_height:.9,font_size:.15,font_y:1.03,text_offset:4.5},o=this.options.offsetX,p=this.options.offsetY,r=this.options.width||a.width,r=this.options.prefix?.8*r:r,h=this.options.height||a.height,d=this.options.number?k.border_line_height_number*h:k.border_line_height*h,h=k.line_height*d,j=r/95,a.getContext){for(g=a.getContext("2d"),this.clear(a,g),g.fillStyle=this.options.color,l=this.options.prefix?a.width*k.prefix_offset:0,m=b.split(""),g.fillRect(o+l,p,j,d),l+=2*j,g.fillRect(o+l,p,j,d),l+=j,i=0;42>i;)"1"===m[i]&&g.fillRect(o+l,p,j,h),l+=j,i++;for(l+=j,g.fillRect(o+l,p,j,d),l+=2*j,g.fillRect(o+l,p,j,d),l+=2*j,i=42;84>i;)"1"===m[i]&&g.fillRect(o+l,p,j,h),l+=j,i++;if(g.fillRect(o+l,p,j,d),l+=2*j,g.fillRect(o+l,p,j,d),this.options.number){for(g.font=k.font_size*h+"px monospace",q=c.substr(0,1),this.options.prefix&&g.fillText(q,o+0,p+d*k.font_y),n=j*k.text_offset+(this.options.prefix?k.prefix_offset*a.width:0),f=c.substr(1,6).split(""),s=0,u=f.length;u>s;s++)e=f[s],g.fillText(e,o+n,p+d*k.font_y),n+=k.font_stretch*r;for(n=49*j+(this.options.prefix?k.prefix_offset*a.width:0)+k.text_offset,f=c.substr(7).split(""),t=0,v=f.length;v>t;t++)e=f[t],g.fillText(e,o+n,p+d*k.font_y),n+=k.font_stretch*r}if(this.options.onSuccess)return this.options.onSuccess.call()}else if(this.options.onError)return this.options.onError.call()},a.prototype.clear=function(a,b){return b.clearRect(this.options.offsetX,this.options.offsetY,this.options.width||a.width,this.options.height||a.height)},a.prototype.parseOptions=function(a){this.options=a;for(var b in this.defaults)this.options[b]=a[b]||this.defaults[b];return null},a.prototype.getCode=function(a){var b,c,d,e,f,g,h,i,j;for(this.validate(a)?this.options.onValid&&this.options.onValid.call():this.options.onInvalid&&this.options.onInvalid.call(),h=["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],i=["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],j=["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],d=["xxxxxx","xxyxyy","xxyyxy","xxyyyx","xyxxyy","xyyxxy","xyyyxx","xyxyxy","xyxyyx","xyyxyx"],c="",b=d[parseInt(a.substr(0,1),10)].split(""),g=a.substr(1),f=g.split(""),e=0;6>e;)c+="x"===b[e]?h[f[e]]:i[f[e]],e++;for(e=6;12>e;)c+=j[f[e]],e++;return c},a.prototype.validate=function(a){var b,c,d,e,f,g;for(d=null,b=a.split(""),c=0,f=0,g=b.length;g>f;f++)e=b[f],c+=f%2===0?parseInt(e,10):3*parseInt(e,10);return d=c%10===0?!0:!1},a}(),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=EAN13);
