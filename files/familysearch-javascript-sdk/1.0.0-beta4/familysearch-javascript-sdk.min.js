!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.FamilySearch=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b){m.prototype[b]=function(){return this[a][b].apply(this[a],arguments)}}var e=a("./globals"),f=a("./utils"),g=a("./angularjs-wrappers"),h=a("./jquery-wrappers"),i=a("./nodejs-wrappers"),j=a("./helpers"),k=a("./plumbing"),l=0,m=b.exports=function(a){var b=this;if(b.settings=f.extend(b.settings,e),b.settings.instanceId=++l,b.helpers=new j(b),b.plumbing=new k(b),a=a||{},!a.client_id&&!a.app_key)throw"client_id must be set";if(b.settings.clientId=a.client_id||a.app_key,!a.environment)throw"environment must be set";if(b.settings.environment=a.environment,!a.http_function&&!window.jQuery)throw"http must be set; e.g., jQuery.ajax";var c=a.http_function||window.jQuery.ajax;if(c.pendingRequests?b.settings.httpWrapper=g.httpWrapper(c,b):c.cookie?b.settings.httpWrapper=i.httpWrapper(c,b):b.settings.httpWrapper=h.httpWrapper(c,b),!a.deferred_function&&!window.jQuery)throw"deferred_function must be set; e.g., jQuery.Deferred";var d=a.deferred_function||window.jQuery.Deferred,m=d();m.resolve(),f.isFunction(m.promise)?b.settings.deferredWrapper=h.deferredWrapper(d):f.isFunction(d.nfcall)?b.settings.deferredWrapper=i.deferredWrapper(d):b.settings.deferredWrapper=g.deferredWrapper(d);var n=a.timeout_function;n?(b.settings.setTimeout=function(a,b){return n(a,b)},b.settings.clearTimeout=function(a){n.cancel(a)}):(b.settings.setTimeout=function(a,b){return setTimeout(a,b)},b.settings.clearTimeout=function(a){clearTimeout(a)}),b.settings.redirectUri=a.redirect_uri||a.auth_callback,b.settings.autoSignin=a.auto_signin,b.settings.autoExpire=a.auto_expire,a.save_access_token&&(b.settings.saveAccessToken=!0,b.helpers.readAccessToken()),a.access_token&&(b.settings.accessToken=a.access_token),b.settings.debug=a.debug,b.settings.discoveryPromise=b.plumbing.get(b.settings.discoveryUrl),b.settings.discoveryPromise.then(function(a){b.settings.discoveryResource=a}),b.settings.expireCallback=a.expire_callback};a("./modules/authorities"),a("./modules/authentication"),a("./modules/changeHistory"),a("./modules/discussions"),a("./modules/memories"),a("./modules/notes"),a("./modules/parentsAndChildren"),a("./modules/pedigree"),a("./modules/persons"),a("./modules/places"),a("./modules/redirect"),a("./modules/searchAndMatch"),a("./modules/sourceBox"),a("./modules/sources"),a("./modules/spouses"),a("./modules/users"),a("./classes/base"),a("./classes/agent"),a("./classes/attribution"),a("./classes/change"),a("./classes/childAndParents"),a("./classes/collection"),a("./classes/comment"),a("./classes/couple"),a("./classes/date"),a("./classes/discussion"),a("./classes/discussionRef"),a("./classes/fact"),a("./classes/memoryArtifactRef"),a("./classes/memoryPersona"),a("./classes/memoryPersonaRef"),a("./classes/memory"),a("./classes/name"),a("./classes/note"),a("./classes/person"),a("./classes/placeDescription"),a("./classes/placesSearchResult"),a("./classes/searchResult"),a("./classes/sourceDescription"),a("./classes/sourceRef"),a("./classes/textValue"),a("./classes/user"),a("./classes/vocabularyElement"),a("./classes/vocabularyList"),d("plumbing","del"),d("plumbing","get"),d("plumbing","getTotalProcessingTime"),d("plumbing","getUrl"),d("plumbing","http"),d("plumbing","post"),d("plumbing","put"),d("plumbing","setTotalProcessingTime")},{"./angularjs-wrappers":2,"./classes/agent":3,"./classes/attribution":4,"./classes/base":5,"./classes/change":6,"./classes/childAndParents":7,"./classes/collection":8,"./classes/comment":9,"./classes/couple":10,"./classes/date":11,"./classes/discussion":12,"./classes/discussionRef":13,"./classes/fact":14,"./classes/memory":15,"./classes/memoryArtifactRef":16,"./classes/memoryPersona":17,"./classes/memoryPersonaRef":18,"./classes/name":19,"./classes/note":20,"./classes/person":21,"./classes/placeDescription":22,"./classes/placesSearchResult":23,"./classes/searchResult":24,"./classes/sourceDescription":25,"./classes/sourceRef":26,"./classes/textValue":27,"./classes/user":28,"./classes/vocabularyElement":29,"./classes/vocabularyList":30,"./globals":31,"./helpers":32,"./jquery-wrappers":33,"./modules/authentication":34,"./modules/authorities":35,"./modules/changeHistory":36,"./modules/discussions":37,"./modules/memories":38,"./modules/notes":39,"./modules/parentsAndChildren":40,"./modules/pedigree":41,"./modules/persons":42,"./modules/places":43,"./modules/redirect":44,"./modules/searchAndMatch":45,"./modules/sourceBox":46,"./modules/sources":47,"./modules/spouses":48,"./modules/users":49,"./nodejs-wrappers":50,"./plumbing":51,"./utils":53}],2:[function(a,b,c){var d=a("./utils"),c={};c.httpWrapper=function(a,b){return function(c,e,f,g,h){var i=d.extend({method:c,url:e,responseType:"text/plain"===f.Accept?"text":"json",data:g,transformRequest:function(a){return a}},h);i.headers=d.extend({},f,h.headers),"multipart/form-data"===i.headers["Content-Type"]&&(i.headers["Content-Type"]=void 0);var j=a(i),k=b.settings.deferredWrapper(),l=k.promise,m=null,n=null;return j.then(function(a){m=a.status,n=a.headers,k.resolve(a.data)},function(a){m=a.status,n=a.headers,k.reject(a)}),l.getStatusCode=function(){return m},l.getResponseHeader=function(a){return n(a)},l.getAllResponseHeaders=function(){return n()},l.getRequest=function(){return i},l}},c.deferredWrapper=function(a){return function(){var b=a();return{promise:b.promise,resolve:b.resolve,reject:b.reject}}},b.exports=c},{"./utils":53}],3:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.Agent=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createAgent=function(a){return new g(this,a)},g.prototype={constructor:g,$getName:function(){return f(f(this.names)[0]).value},$getAccountName:function(){return f(f(this.accounts)[0]).accountName},$getEmail:function(){var a=f(f(this.emails)[0]).resource;return a?a.replace(/^mailto:/,""):a},$getPhoneNumber:function(){return f(f(this.phones)[0]).resource},$getAddress:function(){return f(f(this.addresses)[0]).value}}},{"./../FamilySearch":1,"./../utils":53}],4:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.Attribution=function(a,b){d.BaseClass.call(this,a,b),e.isString(b)&&(this.changeMessage=b)};d.prototype.createAttribution=function(a){return new g(this,a)},g.prototype={constructor:g,$getAgentId:function(){return f(this.contributor).resourceId},$getAgentUrl:function(){return this.$client.helpers.removeAccessToken(f(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())}}},{"./../FamilySearch":1,"./../utils":53}],5:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils");d.BaseClass=function(a,b){e.isObject(b)&&e.extend(this,b),this.$client=a,this.$helpers=a.helpers,this.$plumbing=a.plumbing,this.$serialize=function(){return JSON.stringify(this,function(a,b){return 0!==a.indexOf("$")?b:void 0})}}},{"./../FamilySearch":1,"./../utils":53}],6:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.Change=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createChange=function(a){return new g(this,a)},g.prototype={constructor:g,$getAgentName:function(){return f(f(this.contributors)[0]).name},$getChangeReason:function(){return f(f(this.changeInfo)[0]).reason},$getAgentUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links).agent).href)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl())},$restore:function(a){return this.$client.changeHistory.restoreChange(this.id,a)}}},{"./../FamilySearch":1,"./../utils":53}],7:[function(a,b,c){var d=a("../FamilySearch"),e=a("../relationshipHelpers"),f=a("../utils"),g=f.maybe,h=d.ChildAndParents=function(a,b){d.BaseClass.call(this,a,b),b&&(b.$father&&(this.$setFather(b.$father),delete this.$father),b.$mother&&(this.$setMother(b.$mother),delete this.$mother),b.$child&&(this.$setChild(b.$child),delete this.$child),b.fatherFacts&&f.forEach(this.fatherFacts,function(b,c){b instanceof d.Fact||(this.fatherFacts[c]=a.createFact(b))},this),b.motherFacts&&f.forEach(this.motherFacts,function(b,c){b instanceof d.Fact||(this.motherFacts[c]=a.createFact(b))},this))};d.prototype.createChildAndParents=function(a){return new h(this,a)},h.prototype={constructor:h,$getChildAndParentsUrl:function(){return this.$helpers.removeAccessToken(g(g(this.links).relationship).href)},$getFatherFacts:function(){return this.fatherFacts||[]},$getMotherFacts:function(){return this.motherFacts||[]},$getFatherId:function(){return g(this.father).resourceId},$getFatherUrl:function(){return this.$helpers.removeAccessToken(g(this.father).resource)},$getFather:function(){return this.$client.getPerson(this.$getFatherUrl()||this.$getFatherId())},$getMotherId:function(){return g(this.mother).resourceId},$getMotherUrl:function(){return this.$helpers.removeAccessToken(g(this.mother).resource)},$getMother:function(){return this.$client.getPerson(this.$getMotherUrl()||this.$getMotherId())},$getChildId:function(){return g(this.child).resourceId},$getChildUrl:function(){return this.$helpers.removeAccessToken(g(this.child).resource)},$getChild:function(){return this.$client.getPerson(this.$getChildUrl()||this.$getChildId())},$getNotes:function(){return this.$client.getChildAndParentsNotes(this.$helpers.removeAccessToken(g(g(this.links).notes).href))},$getSourceRefs:function(){return this.$client.getChildAndParentsSourceRefs(this.id)},$getSources:function(){return this.$client.getChildAndParentsSourcesQuery(this.id)},$getChanges:function(){return this.$client.getChildAndParentsChanges(this.$helpers.removeAccessToken(g(this.links["change-history"]).href))},$setFather:function(a){return e.setMember.call(this,"father",a),this.$fatherChanged=!0,this},$setMother:function(a){return e.setMember.call(this,"mother",a),this.$motherChanged=!0,this},$setChild:function(a){return e.setMember.call(this,"child",a),this},$deleteFather:function(a){return e.deleteMember.call(this,"father",a),this},$deleteMother:function(a){return e.deleteMember.call(this,"mother",a),this},$setFatherFacts:function(a,b){return e.setFacts.call(this,"fatherFacts",a,b),this},$addFatherFact:function(a){return e.addFact.call(this,"fatherFacts",a),this},$deleteFatherFact:function(a,b){return e.deleteFact.call(this,"fatherFacts",a,b),this},$setMotherFacts:function(a,b){return e.setFacts.call(this,"motherFacts",a,b),this},$addMotherFact:function(a){return e.addFact.call(this,"motherFacts",a),this},$deleteMotherFact:function(a,b){return e.deleteFact.call(this,"motherFacts",a,b),this},$save:function(a,b,c){var d=this.$client.createChildAndParents(),g=!1,h=this.id,i=this;(!this.id||this.$fatherChanged)&&(d.father=this.father,g=!0),(!this.id||this.$motherChanged)&&(d.mother=this.mother,g=!0),this.id||(d.child=this.child,g=!0),a&&(d.attribution=i.$client.createAttribution(a)),f.forEach(["fatherFacts","motherFacts"],function(a){f.forEach(i[a],function(b){h&&b.id&&!b.$changed||(e.addFact.call(d,a,b),g=!0)})});var j=[];g&&j.push(i.$helpers.chainHttpPromises(h?i.$plumbing.getUrl("child-and-parents-relationship-template",null,{caprid:h}):i.$plumbing.getUrl("relationships"),function(a){return f.forEach(["father","mother","child"],function(a){d[a]&&!d[a].resource&&d[a].resourceId&&(d[a].resource=d[a].resourceId)}),i.$plumbing.post(a,{childAndParentsRelationships:[d]},{"Content-Type":"application/x-fs-v1+json"},c,i.$helpers.getResponseEntityId)})),f.forEach(["father","mother"],function(b){if(i.id&&i.$deletedMembers&&i.$deletedMembers.hasOwnProperty(b)&&!i[b]){var d=i.$deletedMembers[b]||a;j.push(i.$helpers.chainHttpPromises(i.$plumbing.getUrl("child-and-parents-relationship-parent-template",null,{caprid:h,role:b}),function(a){var b={"Content-Type":"application/x-fs-v1+json"};return d&&(b["X-Reason"]=d),i.$plumbing.del(a,b,c)}))}}),h&&i.$deletedFacts&&f.forEach(i.$deletedFacts,function(b,d){b=b||a;var e={"Content-Type":"application/x-fs-v1+json"};b&&(e["X-Reason"]=b),j.push(i.$plumbing.del(d,e,c))});var k=i.$helpers.promiseAll(j).then(function(a){var d=h?h:a[0];return i.$helpers.extendHttpPromise(k,j[0]),b?i.$client.getChildAndParents(d,{},c).then(function(a){return f.deletePropertiesPartial(i,f.appFieldRejector),f.extend(i,a.getRelationship()),d}):d});return k},$delete:function(a,b){return this.$client.deleteChildAndParents(this.$getChildAndParentsUrl()||this.id,a,b)},$restore:function(a){return this.$client.restoreChildAndParents(this.$getChildAndParentsUrl()||this.id,a)}}},{"../FamilySearch":1,"../relationshipHelpers":52,"../utils":53}],8:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.Collection=function(a,b){d.BaseClass.call(this,a,b),b&&b.attribution&&(this.attribution=a.createAttribution(b.attribution))};d.prototype.createCollection=function(a){return new g(this,a)},g.prototype={constructor:g,$getCollectionUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links).self).href)},$getSourceDescriptions:function(a){return this.$client.getCollectionSourceDescriptions(this.$helpers.removeAccessToken(this.links["source-descriptions"].href),a)},$save:function(a,b){var c=this,d=c.$helpers.chainHttpPromises(c.id?c.$plumbing.getUrl("user-collection-template",null,{udcid:c.id}):c.$plumbing.getUrl("user-collections"),function(a){return c.$plumbing.post(a,{collections:[c]},{},b,function(a,b){return c.id||b.getResponseHeader("X-ENTITY-ID")})}),f=d.then(function(g){return c.$helpers.extendHttpPromise(f,d),a?c.$client.getCollection(g,{},b).then(function(a){return e.deletePropertiesPartial(c,e.appFieldRejector),e.extend(c,a.getCollection()),g}):g});return f},$delete:function(a){return this.$client.deleteCollection(this.$getCollectionUrl()||this.id,a)}}},{"./../FamilySearch":1,"./../utils":53}],9:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.Comment=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createComment=function(a){return new g(this,a)},g.prototype={constructor:g,$getCommentUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links).comment).href)},$getAgentId:function(){return f(this.contributor).resourceId},$getAgentUrl:function(){return this.$helpers.removeAccessToken(f(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())},$save:function(a,b){var c=this,d=this.$memoryId?"memory-comments-template":"discussion-comments-template";return c.$helpers.chainHttpPromises(c.$plumbing.getUrl(d,null,{did:c.$discussionId,mid:c.$memoryId}),function(a){var d={discussions:[{comments:[c]}]};return c.$plumbing.post(a,d,{"Content-Type":"application/x-fs-v1+json"},b,function(a,b){return c.id||(c.id=b.getResponseHeader("X-ENTITY-ID")),c.$getCommentUrl()||(c.links={comment:{href:b.getResponseHeader("Location")}}),c.id})})},$delete:function(a,b){return this.$discussionId?this.$client.deleteDiscussionComment(this.$getCommentUrl()||this.$discussionId,this.id,a,b):this.$client.deleteMemoryComment(this.$getCommentUrl()||this.$memoryId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":53}],10:[function(a,b,c){var d=a("../FamilySearch"),e=a("../relationshipHelpers"),f=a("../utils"),g=f.maybe,h=d.Couple=function(a,b){d.BaseClass.call(this,a,b),b&&(b.$husband&&this.$setHusband(b.$husband),b.$wife&&this.$setWife(b.$wife),b.facts&&f.forEach(this.facts,function(b,c){b instanceof d.Fact||(this.facts[c]=a.createFact(b))},this))};d.prototype.createCouple=function(a){return new h(this,a)},h.prototype={constructor:h,$getCoupleUrl:function(){return this.$helpers.removeAccessToken(g(g(this.links).relationship).href)},$getFacts:function(){return this.facts||[]},$getMarriageFact:function(){return f.find(this.facts,{type:"http://gedcomx.org/Marriage"})},$getHusbandId:function(){return g(this.person1).resourceId},$getHusbandUrl:function(){return this.$helpers.removeAccessToken(g(this.person1).resource)},$getHusband:function(){return this.$client.getPerson(this.$getHusbandUrl()||this.$getHusbandId())},$getWifeId:function(){return g(this.person2).resourceId},$getWifeUrl:function(){return this.$helpers.removeAccessToken(g(this.person2).resource)},$getWife:function(){return this.$client.getPerson(this.$getWifeUrl()||this.$getWifeId())},$getSpouseId:function(a){return g(this.person1).resourceId===a?g(this.person2).resourceId:g(this.person1).resourceId},$getSpouseUrl:function(a){return g(this.person1).resourceId===a?this.$helpers.removeAccessToken(g(this.person2).resource):this.$helpers.removeAccessToken(g(this.person1).resource)},$getSpouse:function(a){return this.$client.getPerson(this.$getSpouseUrl(a)||this.$getSpouseId(a))},$getNotes:function(){return this.$client.getCoupleNotes(this.$helpers.removeAccessToken(g(g(this.links).notes).href))},$getSourceRefs:function(){return this.$client.getCoupleSourceRefs(this.id)},$getSources:function(){return this.$client.getCoupleSourcesQuery(this.id)},$getChanges:function(){return this.$client.getCoupleChanges(this.$helpers.removeAccessToken(g(this.links["change-history"]).href))},$setHusband:function(a){return e.setMember.call(this,"person1",a),this.$husbandChanged=!0,this},$setWife:function(a){return e.setMember.call(this,"person2",a),this.$wifeChanged=!0,this},$setFacts:function(a,b){return e.setFacts.call(this,"facts",a,b),this},$addFact:function(a){return e.addFact.call(this,"facts",a),this},$deleteFact:function(a,b){return e.deleteFact.call(this,"facts",a,b),this},$save:function(a,b,c){var d=this.$client.createCouple(),g=!1,h=this.id,i=this;(!this.id||this.$husbandChanged||this.$wifeChanged)&&(d.person1=this.person1,d.person2=this.person2,g=!0),a&&(d.attribution=i.$client.createAttribution(a)),f.forEach(this.facts,function(a){h&&a.id&&!a.$changed||(e.addFact.call(d,"facts",a),g=!0)});var j=[];g&&(h||(d.type="http://gedcomx.org/Couple"),j.push(i.$helpers.chainHttpPromises(h?i.$plumbing.getUrl("couple-relationship-template",null,{crid:h}):i.$plumbing.getUrl("relationships"),function(a){return f.forEach(["person1","person2"],function(a){d[a]&&!d[a].resource&&d[a].resourceId&&(d[a].resource=d[a].resourceId)}),i.$plumbing.post(a,{relationships:[d]},{},c,i.$helpers.getResponseEntityId)}))),h&&this.$deletedFacts&&f.forEach(this.$deletedFacts,function(b,d){b=b||a,j.push(i.$plumbing.del(d,b?{"X-Reason":b}:{},c))});var k=this,l=i.$helpers.promiseAll(j).then(function(a){var d=h?h:a[0];return i.$helpers.extendHttpPromise(l,j[0]),b?i.$client.getCouple(d,{},c).then(function(a){return f.deletePropertiesPartial(k,f.appFieldRejector),f.extend(k,a.getRelationship()),d}):d});return l},$delete:function(a,b){return this.$client.deleteCouple(this.$getCoupleUrl()||this.id,a,b)},$restore:function(a){return this.$client.restoreCouple(this.$getCoupleUrl()||this.id,a)}}},{"../FamilySearch":1,"../relationshipHelpers":52,"../utils":53}],11:[function(a,b,c){var d=a("./../FamilySearch"),e=function(a,b){var c,d="",e="",f="",g="",h="+",i=0;"about"===a[i]?(b||(d="A"),i++):"before"===a[i]?(b||(d="A/"),i++):"after"===a[i]&&(b||(d="A",e="/"),i++),a[i].length<=2&&(f=(1===a[i].length?"0":"")+a[i],i++);var j=["january","february","march","april","may","june","july","august","september","october","november","december"].indexOf(a[i])+1;return j>0&&(g=(10>j?"0":"")+j.toString(),i++),c=a[i],i++,i<a.length&&"bc"===a[i]&&(h="-"),d+h+c+(g?"-":"")+g+(f?"-":"")+f+e},f=d.Date=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createDate=function(a){return new f(this,a)},f.prototype={constructor:f,$getFormalDate:function(){var a="";if(this.normalized){var b=this.normalized.trim().toLowerCase().split(" "),c=b.indexOf("/");c>=0&&(b=b.slice(0,c)),"from"===b[0]?(c=b.indexOf("to"),a=e(b.slice(1,c),!0)+"/"+e(b.slice(c+1),!0)):a=e(b,!1)}return a}}},{"./../FamilySearch":1}],12:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.Discussion=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createDiscussion=function(a){return new g(this,a)},g.prototype={constructor:g,$getDiscussionUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links).discussion).href)},$getCommentsUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links).comments).href)},$getComments:function(){return this.$client.getDiscussionComments(this.$getCommentsUrl())},$getAgentId:function(){return f(this.contributor).resourceId},$getAgentUrl:function(){return this.$helpers.removeAccessToken(f(this.contributor).resource)},$getAgent:function(){return this.$client.getAgent(this.$getAgentUrl()||this.$getAgentId())},$save:function(a,b,c){var d=this,f=d.$helpers.chainHttpPromises(d.id?d.$plumbing.getUrl("discussion-template",null,{did:d.id}):d.$plumbing.getUrl("discussions"),function(a){return d.$plumbing.post(a,{discussions:[d]},{"Content-Type":"application/x-fs-v1+json"},c,function(a,b){return d.id||b.getResponseHeader("X-ENTITY-ID")})}),g=f.then(function(a){return d.$helpers.extendHttpPromise(g,f),b?d.$client.getDiscussion(a,{},c).then(function(b){return e.deletePropertiesPartial(d,e.appFieldRejector),e.extend(d,b.getDiscussion()),a}):a});return g},$delete:function(a,b){return this.$client.deleteDiscussion(this.$getDiscussionUrl()||this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":53}],13:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.DiscussionRef=function(a,b){d.BaseClass.call(this,a,b),b&&b.discussion&&this.$setDiscussion(b.discussion)};d.prototype.createDiscussionRef=function(a){return new g(this,a)},g.prototype={constructor:g,$getDiscussionRefUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links)["discussion-reference"]).href)},$getDiscussionUrl:function(){return this.$helpers.removeAccessToken(this.resource)},$getDiscussion:function(){return this.$client.getDiscussion(this.$getDiscussionUrl()||this.resourceId)},$setDiscussion:function(a){return a instanceof d.Discussion?(this.resource=a.$getDiscussionUrl(),this.resourceId=a.id):this.$helpers.isAbsoluteUrl(a)?this.resource=this.$helpers.removeAccessToken(a):this.resourceId=a,this},$save:function(a,b){var c=this;return c.$helpers.chainHttpPromises(c.$plumbing.getUrl("person-discussion-references-template",null,{pid:c.$personId}),function(d){!c.resource&&c.resourceId&&(c.resource=c.resourceId);var e={persons:[{id:c.$personId,"discussion-references":[{resource:c.resource}]}]};a&&(e.persons[0].attribution=c.$client.createAttribution(a));var f={"Content-Type":"application/x-fs-v1+json"};return c.$plumbing.post(d,e,f,b,function(a,b){return c.$getDiscussionRefUrl()||(c.links={"discussion-reference":{href:b.getResponseHeader("Location"),title:"Discussion Reference"}}),c.$getDiscussionRefUrl()})})},$delete:function(a,b){return this.$client.deleteDiscussionRef(this.$getDiscussionRefUrl()||this.$personId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":53}],14:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.Fact=function(a,b){d.BaseClass.call(this,a,b),b&&(b.$date&&(this.$setDate(b.$date),delete this.$date),b.$formalDate&&(this.$setFormalDate(b.$formalDate),delete this.$formalDate),b.$place&&(this.$setPlace(b.$place),delete this.$place),b.$normalizedPlace&&(this.$setNormalizedPlace(b.$normalizedPlace),delete this.$normalizedPlace),b.$changeMessage&&(this.$setChangeMessage(b.$changeMessage),delete this.$changeMessage),!b.attribution||b.attribution instanceof d.Attribution||(this.attribution=a.createAttribution(b.attribution)))};d.prototype.createFact=function(a){return new g(this,a)},g.prototype={constructor:g,$getDate:function(){return f(this.date).original},$getNormalizedDate:function(){return f(f(f(this.date).normalized)[0]).value},$getFormalDate:function(){return f(this.date).formal},$getPlace:function(){return f(this.place).original},$getNormalizedPlace:function(){return f(f(f(this.place).normalized)[0]).value},$getNormalizedPlaceId:function(){var a=f(this.place).description;return a&&"#"===a.charAt(0)?a.substr(1):""},$isCustomNonEvent:function(){if(this.qualifiers){var a=e.find(this.qualifiers,{name:"http://familysearch.org/v1/Event"});return!!a&&"false"===a.value}return!1},$setType:function(a){return this.$changed=!0,this.type=a,this},$setCustomNonEvent:function(a){var b;return a?(this.qualifiers||(this.qualifiers=[]),b=e.findIndex(this.qualifiers,{name:"http://familysearch.org/v1/Event"}),0>b&&(b=this.qualifiers.push({name:"http://familysearch.org/v1/Event"})-1),this.qualifiers[b].value="false"):this.qualifiers&&(b=e.findIndex(this.qualifiers,{name:"http://familysearch.org/v1/Event"}),b>=0&&this.qualifiers.splice(b,1),0===this.qualifiers.length&&delete this.qualifiers),this.$changed=!0,this},$setDate:function(a){this.$changed=!0;var b;return e.isString(a)?b=a:a instanceof d.Date?(b=a.original,this.$setFormalDate(a.$getFormalDate()),this.$setNormalizedDate(a.normalized)):e.isObject(a)&&(b=a.$original,this.$setFormalDate(a.$formal),this.$setNormalizedDate(a.$normalized)),b?(this.date||(this.date={}),this.date.original=b):delete this.date,this},$setFormalDate:function(a){return this.$changed=!0,a?(this.date||(this.date={}),this.date.formal=a):this.date&&delete this.date.formal,this},$setNormalizedDate:function(a){return this.$changed=!0,a?(this.date||(this.date={}),this.date.normalized=[{value:a}]):this.date&&delete this.date.normalized,this},$setPlace:function(a){this.$changed=!0;var b;return e.isString(a)||null==a?b=a:a instanceof d.PlaceDescription?(b=a.$getFullName(),this.$setNormalizedPlace(b)):e.isObject(a)&&(b=a.$original,this.$setNormalizedPlace(a.$normalized)),b?(this.place||(this.place={}),this.place.original=b):delete this.place,this},$setNormalizedPlace:function(a){return this.$changed=!0,a?(this.place||(this.place={}),this.place.normalized=[{value:a}]):this.place&&delete this.place.normalized,this},$setChangeMessage:function(a){return this.attribution=this.$client.createAttribution(a),this}}},{"./../FamilySearch":1,"./../utils":53}],15:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.Memory=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createMemory=function(a){return new g(this,a)},g.prototype={constructor:g,$getTitle:function(){return f(f(this.titles)[0]).value},$getDescription:function(){return f(f(this.description)[0]).value},$getIconUrl:function(){return this.$helpers.appendAccessToken(f(f(this.links)["image-icon"]).href)},$getThumbnailUrl:function(){return this.$helpers.appendAccessToken(f(f(this.links)["image-thumbnail"]).href)},$getImageUrl:function(){return this.$helpers.appendAccessToken(f(f(this.links).image).href)},$getMemoryArtifactUrl:function(){return this.$helpers.appendAccessToken(this.$helpers.removeAccessToken(this.about))},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links).description).href)},$getArtifactFilename:function(){return f(f(this.artifactMetadata)[0]).filename},$getArtifactType:function(){return f(f(this.artifactMetadata)[0]).artifactType},$getArtifactHeight:function(){return f(f(this.artifactMetadata)[0]).height},$getArtifactWidth:function(){return f(f(this.artifactMetadata)[0]).width},$getCommentsUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links).comments).href)},$getComments:function(){return this.$client.getMemoryComments(this.$getCommentsUrl()||this.id)},$setTitle:function(a){return this.titles=[{value:a}],this},$setDescription:function(a){return this.description=[{value:a}],this},$setArtifactFilename:function(a){return e.isArray(this.artifactMetadata)&&this.artifactMetadata.length||(this.artifactMetadata=[{}]),this.artifactMetadata[0].filename=a,this},$save:function(a,b,c){var d=this,f=d.$helpers.chainHttpPromises(d.id?d.$plumbing.getUrl("memory-template",null,{mid:d.id}):d.$plumbing.getUrl("memories"),function(a){if(d.id)return d.$plumbing.post(a,{sourceDescriptions:[d]},{},c,function(){return d.id});var b={};return d.$getTitle()&&(b.title=d.$getTitle()),d.$getDescription()&&(b.description=d.$getDescription()),d.$getArtifactFilename()&&(b.filename=d.$getArtifactFilename()),d.$plumbing.post(d.$helpers.appendQueryParameters(a,b),d.$data,{"Content-Type":e.isString(d.$data)?"text/plain":"multipart/form-data"},c,d.$helpers.getResponseEntityId)}),g=f.then(function(a){return d.$helpers.extendHttpPromise(g,f),b?d.$client.getMemory(a,{},c).then(function(b){return e.deletePropertiesPartial(d,e.appFieldRejector),e.extend(d,b.getMemory()),a}):a});return g},$delete:function(a,b){return this.$client.deleteMemory(this.$getMemoryUrl()||this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":53}],16:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.MemoryArtifactRef=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createMemoryArtifactRef=function(a){return new g(this,a)},g.prototype={constructor:g,$getQualifierName:function(){return f(f(this.qualifiers)[0]).name},$getQualifierValue:function(){return f(f(this.qualifiers)[0]).value},$setQualifierName:function(a){return e.isArray(this.qualifiers)&&this.qualifiers.length||(this.qualifiers=[{}]),this.qualifiers[0].name=a,this},$setQualifierValue:function(a){return e.isArray(this.qualifiers)&&this.qualifiers.length||(this.qualifiers=[{}]),this.qualifiers[0].value=a,this}}},{"./../FamilySearch":1,"./../utils":53}],17:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.MemoryPersona=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createMemoryPersona=function(a){return new g(this,a)},g.prototype={constructor:g,$getMemoryPersonaUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links).persona).href)},$getMemoryArtifactRef:function(){return f(this.media)[0]},$getName:function(){return f(this.names)[0]},$getDisplayName:function(){return f(this.display).name},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(f(this.$getMemoryArtifactRef()).description)},$getMemory:function(){return this.$client.getMemory(this.$getMemoryUrl()||this.$memoryId)},$setName:function(a){return a instanceof d.Name||(a=this.$client.createName(a)),this.names=[a],this},$setMemoryArtifactRef:function(a){return this.media=[a],this},$save:function(a,b,c){var d=this,f=d.$helpers.chainHttpPromises(d.$plumbing.getUrl(d.id?"memory-persona-template":"memory-personas-template",null,{mid:d.$memoryId,pid:d.id}),function(a){if(!d.$getMemoryArtifactRef()){var b=d.$helpers.getUrlFromDiscoveryResource(d.$client.settings.discoveryResource,"memory-template",{mid:d.$memoryId});d.$setMemoryArtifactRef(d.$client.createMemoryArtifactRef({description:b}))}return d.$plumbing.post(a,{persons:[d]},{},c,function(a,b){return d.$getMemoryPersonaUrl()||d.$helpers.removeAccessToken(b.getResponseHeader("Location"))})}),g=f.then(function(a){return d.$helpers.extendHttpPromise(g,f),b?d.$client.getMemoryPersona(a,null,{},c).then(function(b){return e.deletePropertiesPartial(d,e.appFieldRejector),e.extend(d,b.getMemoryPersona()),a}):a});return g},$delete:function(a,b){return this.$client.deleteMemoryPersona(this.$getMemoryPersonaUrl()||this.$memoryId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":53}],18:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.MemoryPersonaRef=function(a,b){d.BaseClass.call(this,a,b),b&&b.$memoryPersona&&this.$setMemoryPersona(b.$memoryPersona)};d.prototype.createMemoryPersonaRef=function(a){return new g(this,a)},g.prototype={constructor:g,$getMemoryPersonaRefUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links)["evidence-reference"]).href);
},$getMemoryPersonaUrl:function(){return this.$helpers.removeAccessToken(this.resource)},$getMemoryPersona:function(){return this.$client.getMemoryPersona(this.$getMemoryPersonaUrl())},$getMemoryUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links).memory).href)},$getMemory:function(){return this.$client.getMemory(this.$getMemoryUrl())},$setMemoryPersona:function(a){return a instanceof d.MemoryPersona&&(a=a.$getMemoryPersonaUrl()),this.resource=this.$helpers.removeAccessToken(a),this},$save:function(a,b){var c=this;return c.$helpers.chainHttpPromises(c.$plumbing.getUrl("person-memory-persona-references-template",null,{pid:c.$personId}),function(a){return c.$plumbing.post(a,{persons:[{evidence:[c]}]},{},b,function(a,b){return c.id||(c.id=b.getResponseHeader("X-ENTITY-ID")),c.$getMemoryPersonaRefUrl()||(c.links={"evidence-reference":{href:b.getResponseHeader("Location")}}),c.$getMemoryPersonaRefUrl()})})},$delete:function(a,b){return this.$client.deleteMemoryPersonaRef(this.$getMemoryPersonaRefUrl()||this.$personId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":53}],19:[function(a,b,c){function d(a,b){var c=b||0;for(f.isArray(a.nameForms)||(a.nameForms=[]);c>=a.nameForms.length;)a.nameForms.push({});return a.nameForms[c]}var e=a("./../FamilySearch"),f=a("./../utils"),g=f.maybe,h=e.Name=function(a,b){e.BaseClass.call(this,a,b),b&&(f.isString(b)?this.$setFullText(b):(b.type&&this.$setType(b.type),b.$givenName&&(this.$setGivenName(b.$givenName),delete this.$givenName),b.$surname&&(this.$setSurname(b.$surname),delete this.$surname),b.$prefix&&(this.$setPrefix(b.$prefix),delete this.$prefix),b.$suffix&&(this.$setSuffix(b.$suffix),delete this.$suffix),b.$fullText&&(this.$setFullText(b.$fullText),delete this.$fullText),this.$setPreferred(!!b.preferred),b.$changeMessage&&(this.$setChangeMessage(b.$changeMessage),delete this.$changeMessage),!b.attribution||b.attribution instanceof e.Attribution||(this.attribution=a.createAttribution(b.attribution))))};e.prototype.createName=function(a){return new h(this,a)},h.prototype={constructor:h,$getNameFormsCount:function(){return this.nameForms?this.nameForms.length:0},$getNameForm:function(a){return g(this.nameForms)[a||0]},$getFullText:function(a){return g(this.$getNameForm(a)).fullText},$getLang:function(a){return g(this.$getNameForm(a)).lang},$getNamePart:function(a,b){return g(f.find(g(this.$getNameForm(b)).parts,{type:a})).value},$getGivenName:function(a){return this.$getNamePart("http://gedcomx.org/Given",a)},$getSurname:function(a){return this.$getNamePart("http://gedcomx.org/Surname",a)},$getPrefix:function(a){return this.$getNamePart("http://gedcomx.org/Prefix",a)},$getSuffix:function(a){return this.$getNamePart("http://gedcomx.org/Suffix",a)},$setType:function(a){return this.$changed=!0,a?this.type=a:delete this.type,this},$setPreferred:function(a){return this.$changed=!0,this.preferred=a,this},$setFullText:function(a,b){this.$changed=!0;var c=d(this,b);return a?c.fullText=a:delete c.fullText,this},$setNamePart:function(a,b,c){this.$changed=!0;var e=d(this,c);f.isArray(e.parts)||(e.parts=[]);var g=f.find(e.parts,{type:b});return a?(g||(g={type:b},e.parts.push(g)),g.value=a):g&&e.parts.splice(e.parts.indexOf(g),1),this},$setGivenName:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Given",b)},$setSurname:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Surname",b)},$setPrefix:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Prefix",b)},$setSuffix:function(a,b){return this.$setNamePart(a,"http://gedcomx.org/Suffix",b)},$setChangeMessage:function(a){return this.attribution=this.$client.createAttribution(a),this}}},{"./../FamilySearch":1,"./../utils":53}],20:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.Note=function(a,b){d.BaseClass.call(this,a,b),!this.attribution||this.attribution instanceof d.Attribution||(this.attribution=a.createAttribution(this.attribution))};d.prototype.createNote=function(a){return new g(this,a)},g.prototype={constructor:g,$getNoteUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links).note).href)},$save:function(a,b,c){var d,f,g=this,h={};g.$personId?(d=g.id?"person-note-template":"person-notes-template",f="persons"):g.$coupleId?(d=g.id?"couple-relationship-note-template":"couple-relationship-notes-template",f="relationships"):g.$childAndParentsId&&(d=g.id?"child-and-parents-relationship-note-template":"child-and-parents-relationship-notes-template",f="childAndParentsRelationships",h["Content-Type"]="application/x-fs-v1+json");var i=g.$helpers.chainHttpPromises(g.$plumbing.getUrl(d,null,{pid:g.$personId,crid:g.$coupleId,caprid:g.$childAndParentsId,nid:g.id}),function(b){var d={};return d[f]=[{notes:[g]}],a&&(d[f][0].attribution=g.$client.createAttribution(a)),g.$plumbing.post(b,d,h,c,function(a,b){return{id:g.id||b.getResponseHeader("X-ENTITY-ID"),location:g.$getNoteUrl()||g.$helpers.removeAccessToken(b.getResponseHeader("Location"))}})}),j=i.then(function(a){return g.$helpers.extendHttpPromise(j,i),b?g.$client.getPersonNote(a.location,null,{},c).then(function(b){return e.deletePropertiesPartial(g,e.appFieldRejector),e.extend(g,b.getNote()),a.id}):a.id});return j},$delete:function(a,b){return this.$personId?this.$client.deletePersonNote(this.$getNoteUrl()||this.$personId,this.id,a,b):this.$coupleId?this.$client.deleteCoupleNote(this.$getNoteUrl()||this.$coupleId,this.id,a,b):this.$client.deleteChildAndParentsNote(this.$getNoteUrl()||this.$childAndParentsId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":53}],21:[function(a,b,c){function d(a){return a?" "+a:""}var e=a("../FamilySearch"),f=a("../utils"),g=f.maybe,h=e.Person=function(a,b){e.BaseClass.call(this,a,b),b&&(b.$gender&&(this.$setGender(b.$gender),delete this.$gender),b.names&&f.forEach(this.names,function(b,c){b instanceof e.Name||(this.names[c]=a.createName(b))},this),b.facts&&f.forEach(this.facts,function(b,c){b instanceof e.Fact||(this.facts[c]=a.createFact(b))},this),!b.attribution||b.attribution instanceof e.Attribution||(this.attribution=a.createAttribution(b.attribution)))};e.prototype.createPerson=function(a){return new h(this,a)},h.prototype={constructor:h,$getFacts:function(a){return(a?f.filter(this.facts,{type:a}):this.facts)||[]},$getFact:function(a){return f.find(this.facts,{type:a})},$getBirth:function(){return this.$getFact("http://gedcomx.org/Birth")},$getBirthDate:function(){var a=this.$getBirth();return a?a.$getDate():""},$getBirthPlace:function(){var a=this.$getBirth();return a?a.$getPlace():""},$getChristening:function(){return this.$getFact("http://gedcomx.org/Christening")},$getChristeningDate:function(){var a=this.$getChristening();return a?a.$getDate():""},$getChristeningPlace:function(){var a=this.$getChristening();return a?a.$getPlace():""},$getDeath:function(){return this.$getFact("http://gedcomx.org/Death")},$getDeathDate:function(){var a=this.$getDeath();return a?a.$getDate():""},$getDeathPlace:function(){var a=this.$getDeath();return a?a.$getPlace():""},$getBurial:function(){return this.$getFact("http://gedcomx.org/Burial")},$getBurialDate:function(){var a=this.$getBurial();return a?a.$getDate():""},$getBurialPlace:function(){var a=this.$getBurial();return a?a.$getPlace():""},$getDisplayBirthDate:function(){return g(this.display).birthDate},$getDisplayBirthPlace:function(){return g(this.display).birthPlace},$getDisplayDeathDate:function(){return g(this.display).deathDate},$getDisplayDeathPlace:function(){return g(this.display).deathPlace},$getDisplayGender:function(){return g(this.display).gender},$getDisplayLifeSpan:function(){return g(this.display).lifespan},$getDisplayName:function(){return g(this.display).name},$getNames:function(a){return(a?f.filter(this.names,{type:a}):this.names)||[]},$getPreferredName:function(){return f.findOrFirst(this.names,{preferred:!0})},$getGivenName:function(){var a=this.$getPreferredName();return a&&(a=a.$getGivenName()),a},$getSurname:function(){var a=this.$getPreferredName();return a&&(a=a.$getSurname()),a},$getPersistentIdentifier:function(){return g(g(this.identifiers)["http://gedcomx.org/Persistent"])[0]},$getPersonUrl:function(){return this.$helpers.removeAccessToken(g(g(this.links).person).href)},$getChanges:function(a){return this.$client.getPersonChanges(this.$helpers.removeAccessToken(this.links["change-history"].href),a)},$getDiscussionRefs:function(){return this.$client.getPersonDiscussionRefs(this.$helpers.removeAccessToken(this.links["discussion-references"].href))},$getMemoryPersonaRefs:function(){return this.$client.getMemoryPersonaRefs(this.$helpers.removeAccessToken(this.links["evidence-references"].href))},$getNotes:function(){return this.$client.getPersonNotes(this.$helpers.removeAccessToken(this.links.notes.href))},$getSourceRefs:function(){return this.$client.getPersonSourceRefs(this.id)},$getSources:function(){return this.$client.getPersonSourcesQuery(this.id)},$getSpouses:function(){return this.$client.getSpouses(this.id)},$getParents:function(){return this.$client.getParents(this.id)},$getChildren:function(){return this.$client.getChildren(this.id)},$getMatches:function(){return this.$client.getPersonMatches(this.id)},$getAncestry:function(a){return this.$client.getAncestry(this.id,a)},$getDescendancy:function(a){return this.$client.getDescendancy(this.id,a)},$getPersonPortraitUrl:function(a){return this.$client.getPersonPortraitUrl(this.id,a)},$setNames:function(a,b){return f.isArray(this.names)&&f.forEach(this.names,function(a){this.$deleteName(a,b)},this),this.names=[],f.forEach(a,function(a){this.$addName(a)},this),this},$addName:function(a){return f.isArray(this.names)||(this.names=[]),a instanceof e.Name||(a=this.$client.createName(a)),this.names.push(a),this},$deleteName:function(a,b){a instanceof e.Name||(a=f.find(this.names,{id:a}));var c=f.indexOf(this.names,a);return c>=0&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[a.id]=b,this.names.splice(c,1)),this},$setFacts:function(a,b){return f.isArray(this.facts)&&f.forEach(this.facts,function(a){this.$deleteFact(a,b)},this),this.facts=[],f.forEach(a,function(a){this.$addFact(a)},this),this},$addFact:function(a){return f.isArray(this.facts)||(this.facts=[]),a instanceof e.Fact||(a=this.$client.createFact(a)),this.facts.push(a),this},$deleteFact:function(a,b){a instanceof e.Fact||(a=f.find(this.facts,{id:a}));var c=f.indexOf(this.facts,a);return c>=0&&(this.$deletedConclusions||(this.$deletedConclusions={}),this.$deletedConclusions[a.id]=b,this.facts.splice(c,1)),this},$setGender:function(a,b){return this.gender||(this.gender={}),this.gender.$changed=!0,this.gender.type=a,b&&(this.gender.attribution=this.$client.createAttribution(b)),this},$save:function(a,b,c){var e=this.$client.createPerson(),g=!1;this.id&&(e.id=this.id),this.id||(this.gender||this.$setGender("http://gedcomx.org/Unknown"),f.isArray(this.names)&&0!==this.names.length||this.$addName({$fullText:"Unknown",$givenName:"Unknown"}),f.find(this.names,{preferred:!0})||this.names[0].$setPreferred(!0),1!==this.names.length||this.names[0].type||this.names[0].$setType("http://gedcomx.org/BirthName"),f.isUndefined(this.living)&&(this.living=!1)),a&&(e.attribution=this.$client.createAttribution(a)),this.id||(e.living=this.living),!this.gender||this.gender.id&&!this.gender.$changed||(e.gender=this.gender,g=!0),f.forEach(this.names,function(a){(!a.id||a.$changed)&&(a.$getFullText()||a.$setFullText((d(a.$getPrefix())+d(a.$getGivenName())+d(a.$getSurname())+d(a.$getSuffix())).trim()),e.$addName(a),g=!0)}),f.forEach(this.facts,function(a){(!a.id||a.$changed)&&(e.$addFact(a),g=!0)});var h=[],i=this;g&&h.push(i.$helpers.chainHttpPromises(e.id?i.$plumbing.getUrl("person-template",null,{pid:e.id}):i.$plumbing.getUrl("persons"),function(a){return i.$plumbing.post(a,{persons:[e]},{},c,i.$helpers.getResponseEntityId)})),this.id&&this.$deletedConclusions&&f.forEach(this.$deletedConclusions,function(b,d){b=b||a,h.push(i.$helpers.chainHttpPromises(i.$plumbing.getUrl("person-conclusion-template",null,{pid:e.id,cid:d}),function(a){return i.$plumbing.del(a,b?{"X-Reason":b}:{},c)}))});var j=this,k=i.$helpers.promiseAll(h).then(function(a){var d=e.id?e.id:a[0];return i.$helpers.extendHttpPromise(k,h[0]),b?i.$client.getPerson(d,{},c).then(function(a){return f.deletePropertiesPartial(j,f.appFieldRejector),f.extend(j,a.getPerson()),d}):d});return k},$delete:function(a,b){return this.$client.deletePerson(this.$getPersonUrl()||this.id,a,b)},$restore:function(a){return this.$client.restorePerson(this.$getPersonUrl()||this.id,a)}}},{"../FamilySearch":1,"../utils":53}],22:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=d.PlaceDescription=function(a,b){d.BaseClass.call(this,a,b),b&&b.names&&e.forEach(this.names,function(b,c){b instanceof d.TextValue||(this.names[c]=a.createTextValue(b)),this.names[c]=a.createTextValue(b)},this)};d.prototype.createPlaceDescription=function(a){return new f(this,a)},f.prototype={constructor:f,$getName:function(){return e.maybe(this.display).name},$getFullName:function(){return e.maybe(this.display).fullName},$getType:function(){return e.maybe(this.display).type},$getJurisdictionSummary:function(){return this.jurisdiction instanceof d.PlaceDescription?this.jurisdiction:void 0},$getJurisdictionDetails:function(){if(this.jurisdiction instanceof d.PlaceDescription)return this.$client.getPlaceDescription(this.jurisdiction.id);var a=this.$client.settings.deferredWrapper(),b=a.promise;return a.reject(new Error("No jurisdiction available")),b},$setJurisdiction:function(a){a instanceof d.PlaceDescription||(a=this.client.createPlaceDescription(a)),this.jurisdiction=a}}},{"./../FamilySearch":1,"./../utils":53}],23:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=d.PlacesSearchResult=function(a,b){if(d.BaseClass.call(this,a,b),b&&b.content&&b.content.gedcomx&&b.content.gedcomx.places){var c=b.content.gedcomx.places,f={};e.forEach(c,function(b,c,d){d[c]=f[b.id]=a.createPlaceDescription(b)}),e.forEach(c,function(a){if(a.jurisdiction&&a.jurisdiction.resource){var b=a.jurisdiction.resource.substring(1);f[b]&&a.$setJurisdiction(f[b])}})}};d.prototype.createPlacesSearchResult=function(a){return new f(this,a)},f.prototype={constructor:f,$getPlace:function(){var a=e.maybe;return a(a(a(this.content).gedcomx).places)[0]}}},{"./../FamilySearch":1,"./../utils":53}],24:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.SearchResult=function(a,b){d.BaseClass.call(this,a,b),e.forEach(f(f(f(b).content).gedcomx).persons,function(b,c,d){d[c]=a.createPerson(b)})};d.prototype.createSearchResult=function(a){return new g(this,a)},g.prototype={constructor:g,$getPerson:function(a){return e.find(f(f(this.content).gedcomx).persons,{id:a})},$getPrimaryPerson:function(){return this.$getPerson(this.id)},$getFullPrimaryPerson:function(){return this.$client.getPerson(this.id)},$getFatherIds:function(){var a=this.id,b=this;return e.uniq(e.map(e.filter(f(f(this.content).gedcomx).relationships,function(c){return"http://gedcomx.org/ParentChild"===c.type&&c.person2.resourceId===a&&c.person1&&"http://gedcomx.org/Male"===f(b.$getPerson(c.person1.resourceId).gender).type}),function(a){return a.person1.resourceId}))},$getFathers:function(){return e.map(this.$getFatherIds(),this.$getPerson,this)},$getMotherIds:function(){var a=this.id,b=this;return e.uniq(e.map(e.filter(f(f(this.content).gedcomx).relationships,function(c){return"http://gedcomx.org/ParentChild"===c.type&&c.person2.resourceId===a&&c.person1&&"http://gedcomx.org/Male"!==f(b.$getPerson(c.person1.resourceId).gender).type}),function(a){return a.person1.resourceId}))},$getMothers:function(){return e.map(this.$getMotherIds(),this.$getPerson,this)},$getSpouseIds:function(){var a=this.id;return e.uniq(e.map(e.filter(f(f(this.content).gedcomx).relationships,function(b){return"http://gedcomx.org/Couple"===b.type&&(b.person1.resourceId===a||b.person2.resourceId===a)}),function(b){return b.person1.resourceId===a?b.person2.resourceId:b.person1.resourceId}))},$getSpouses:function(){return e.map(this.$getSpouseIds(),this.$getPerson,this)},$getChildIds:function(){var a=this.id;return e.uniq(e.map(e.filter(f(f(this.content).gedcomx).relationships,function(b){return"http://gedcomx.org/ParentChild"===b.type&&b.person1.resourceId===a&&b.person2}),function(a){return a.person2.resourceId}))},$getChildren:function(){return e.map(this.$getChildIds(),this.$getPerson,this)}}},{"./../FamilySearch":1,"./../utils":53}],25:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.SourceDescription=function(a,b){d.BaseClass.call(this,a,b),b&&(b.$citation&&this.$setCitation(b.$citation),b.$title&&this.$setTitle(b.$title),b.$text&&this.$setText(b.$text),!b.attribution||b.attribution instanceof d.Attribution||(this.attribution=a.createAttribution(b.attribution)))};d.prototype.createSourceDescription=function(a){return new g(this,a)},g.prototype={constructor:g,$getCitation:function(){return f(f(this.citations)[0]).value},$getTitle:function(){return f(f(this.titles)[0]).value},$getText:function(){return f(f(this.notes)[0]).text},$getSourceDescriptionUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links).description).href)},$getSourceRefsQuery:function(){return this.$client.getSourceRefsQuery(this.id)},$setCitation:function(a){return this.citations=[{value:a}],this},$setTitle:function(a){return this.titles=[{value:a}],this},$setText:function(a){return this.notes=[{text:a}],this},$save:function(a,b,c){var d=this;a&&(d.attribution=d.$client.createAttribution(a));var f=d.$helpers.chainHttpPromises(d.id?d.$plumbing.getUrl("source-description-template",null,{sdid:d.id}):d.$plumbing.getUrl("source-descriptions"),function(a){return d.$plumbing.post(a,{sourceDescriptions:[d]},{},c,function(a,b){return d.id||b.getResponseHeader("X-ENTITY-ID")})}),g=f.then(function(a){return d.$helpers.extendHttpPromise(g,f),b?d.$client.getSourceDescription(a,{},c).then(function(b){return e.deletePropertiesPartial(d,e.appFieldRejector),e.extend(d,b.getSourceDescription()),a}):a});return g},$delete:function(a,b){return this.$client.deleteSourceDescription(this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":53}],26:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe,g=d.SourceRef=function(a,b){d.BaseClass.call(this,a,b),b&&(this.$personId=b.$personId,this.$coupleId=b.$coupleId,this.$childAndParentsId=b.$childAndParentsId,b.$sourceDescription&&this.$setSourceDescription(b.$sourceDescription),b.$tags&&this.$setTags(b.$tags),!b.attribution||b.attribution instanceof d.Attribution||(this.attribution=a.createAttribution(b.attribution)))};d.prototype.createSourceRef=function(a){return new g(this,a)},g.prototype={constructor:g,$getSourceRefUrl:function(){return this.$helpers.removeAccessToken(f(f(this.links)["source-reference"]).href)},$getSourceDescriptionUrl:function(){return this.$helpers.removeAccessToken(this.description)},$getSourceDescription:function(){return this.$client.getSourceDescription(this.$getSourceDescriptionUrl())},$getTags:function(){return e.map(this.tags,function(a){return a.resource})},$setSourceDescription:function(a){return a instanceof d.SourceDescription?(this.$sourceDescriptionId=a.id,this.description=a.$getSourceDescriptionUrl()):this.$helpers.isAbsoluteUrl(a)?(delete this.$sourceDescriptionId,this.description=this.$sourceDescriptionUrl):(this.$sourceDescriptionId=a,delete this.description),this},$setTags:function(a){return this.tags=e.map(a,function(a){return{resource:a}}),this},$addTag:function(a){return e.isArray(this.tags)||(this.tags=[]),this.tags.push({resource:a}),this},$removeTag:function(a){return a=e.find(this.tags,{resource:a}),a&&this.tags.splice(e.indexOf(this.tags,a),1),this},$save:function(a,b){var c=this;a&&(c.attribution=c.$client.createAttribution(a));var d,e,f={};return c.$personId?(d="person-source-references-template",e="persons"):c.$coupleId?(d="couple-relationship-source-references-template",e="relationships"):c.$childAndParentsId&&(d="child-and-parents-relationship-source-references-template",d="child-and-parents-relationship-source-references-template",e="childAndParentsRelationships",f["Content-Type"]="application/x-fs-v1+json"),c.$helpers.chainHttpPromises(c.$plumbing.getUrl(d,null,{pid:c.$personId,crid:c.$coupleId,caprid:c.$childAndParentsId,srid:c.id}),function(a){!c.description&&c.$sourceDescriptionId&&(c.description=c.$helpers.getUrlFromDiscoveryResource(c.$client.settings.discoveryResource,"source-description-template",{sdid:c.$sourceDescriptionId})),c.description=c.$helpers.removeAccessToken(c.description);var d={};return d[e]=[{sources:[c]}],c.$plumbing.post(a,d,f,b,function(a,b){return c.id||(c.id=b.getResponseHeader("X-ENTITY-ID")),c.$getSourceRefUrl()||(c.links={"source-reference":{href:c.$helpers.removeAccessToken(b.getResponseHeader("Location"))}}),c.id})})},$delete:function(a,b){return this.$personId?this.$client.deletePersonSourceRef(this.$getSourceRefUrl()||this.$personID,this.id,a,b):this.$coupleId?this.$client.deleteCoupleSourceRef(this.$getSourceRefUrl()||this.$coupleId,this.id,a,b):this.$client.deleteChildAndParentsSourceRef(this.$getSourceRefUrl()||this.$childAndParentsId,this.id,a,b)}}},{"./../FamilySearch":1,"./../utils":53}],27:[function(a,b,c){var d=a("./../FamilySearch"),e=d.TextValue=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createTextValue=function(a){return new e(this,a)},e.prototype={constructor:e}},{"./../FamilySearch":1}],28:[function(a,b,c){var d=a("../FamilySearch"),e=d.User=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createUser=function(a){return new e(this,a)},e.prototype={constructor:e}},{"../FamilySearch":1}],29:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=d.VocabularyElement=function(a,b){d.BaseClass.call(this,a,b)};d.prototype.createVocabularyElement=function(a){return new f(this,a)},f.prototype={constructor:f,$getLabel:function(){return e.maybe(e.maybe(this.labels)[0])["@value"]},$getDescription:function(){return e.maybe(e.maybe(this.descriptions)[0])["@value"]}}},{"./../FamilySearch":1,"./../utils":53}],30:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=d.VocabularyList=function(a,b){d.BaseClass.call(this,a,b),b&&b.elements&&e.forEach(this.elements,function(b,c,d){d[c]=a.createVocabularyElement(b)})};d.prototype.createVocabularyList=function(a){return new f(this,a)},f.prototype={constructor:f,$getTitle:function(){return e.maybe(this.title)},$getDescription:function(){return e.maybe(this.description)},$getElements:function(){return e.maybe(this.elements)}}},{"./../FamilySearch":1,"./../utils":53}],31:[function(a,b,c){b.exports={clientId:null,environment:null,httpWrapper:null,deferredWrapper:null,setTimeout:null,clearTimeout:null,redirectUri:null,autoSignin:!1,autoExpire:!1,accessToken:null,saveAccessToken:!1,logging:!1,accessTokenCookie:"FS_ACCESS_TOKEN",authCodePollDelay:50,defaultThrottleRetryAfter:500,maxHttpRequestRetries:2,maxAccessTokenInactivityTime:354e4,maxAccessTokenCreationTime:8634e4,apiServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://beta.familysearch.org",production:"https://familysearch.org"},oauthServer:{sandbox:"https://integration.familysearch.org/cis-web/oauth2/v3",staging:"https://identbeta.familysearch.org/cis-web/oauth2/v3",beta:"https://identbeta.familysearch.org/cis-web/oauth2/v3",production:"https://ident.familysearch.org/cis-web/oauth2/v3"},authoritiesServer:{sandbox:"https://sandbox.familysearch.org",staging:"https://stage.familysearch.org",beta:"https://apibeta.familysearch.org",production:"https://api.familysearch.org"},discoveryUrl:"/.well-known/app-meta"}},{}],32:[function(a,b,c){var d=a("./utils"),e=d.forEach,f=function(a){this.settings=a.settings,this.client=a,this.accessTokenInactiveTimer=null,this.accessTokenCreationTimer=null};f.prototype.getAbsoluteUrl=function(a,b){return this.isAbsoluteUrl(b)?b:a+("/"!==b.charAt(0)?"/":"")+b},f.prototype.isOAuthServerUrl=function(a){return 0===a.indexOf(this.settings.oauthServer[this.settings.environment])},f.prototype.getAPIServerUrl=function(a){return this.getAbsoluteUrl(this.settings.apiServer[this.settings.environment],a)},f.prototype.getAuthoritiesServerUrl=function(a){return this.getAbsoluteUrl(this.settings.authoritiesServer[this.settings.environment],a)},f.prototype.appendAccessToken=function(a){if(a){var b=this.decodeQueryString(a);a=this.removeQueryString(a),b.access_token=this.settings.accessToken,a=this.appendQueryParameters(a,b)}return a},f.prototype.log=function(){this.settings.debug&&console.log.apply(null,arguments)},f.prototype.nextTick=function(a){this.settings.setTimeout(function(){a()},0)},f.prototype.refPromise=function(a){if(a&&d.isFunction(a.then))return a;var b=this;return{then:function(c){var d=b.settings.deferredWrapper();return b.nextTick(function(){d.resolve(c(a))}),d.promise}}},f.prototype.promiseAll=function(a){var b=this.settings.deferredWrapper(),c=0,f=d.isArray(a)?[]:{},g=this;return e(a,function(a,d){c++,g.refPromise(a).then(function(a){f.hasOwnProperty(d)||(f[d]=a,--c||b.resolve(f))},function(){f.hasOwnProperty(d)||b.reject.apply(b,arguments)})}),0===c&&b.resolve(f),b.promise},f.prototype.setTimer=function(a,b,c){return c&&this.settings.clearTimeout(c),this.settings.setTimeout(function(){a()},b)},f.prototype.setAccessTokenInactiveTimer=function(a){this.accessTokenInactiveTimer=this.setTimer(this.settings.eraseAccessToken,a,this.accessTokenInactiveTimer)},f.prototype.setAccessTokenCreationTimer=function(a){this.accessTokenCreationTimer=this.setTimer(this.settings.eraseAccessToken,a,this.accessTokenCreationTimer)},f.prototype.clearAccessTokenTimers=function(){this.settings.clearTimeout(this.accessTokenInactiveTimer),this.accessTokenInactiveTimer=null,this.settings.clearTimeout(this.accessTokenCreationTimer),this.accessTokenCreationTimer=null},f.prototype.getAccessTokenCookieName=function(){return this.settings.accessTokenCookie+"_"+this.settings.instanceId},f.prototype.readAccessToken=function(){if("undefined"!=typeof window){var a=(new Date).getTime(),b=this,c=this.readCookie(this.getAccessTokenCookieName());if(c){var d=c.split("|",3);if(3===d.length){var e=a-parseInt(d[0],10),f=a-parseInt(d[1],10);e<this.settings.maxAccessTokenInactivityTime&&f<this.settings.maxAccessTokenCreationTime&&(this.settings.accessToken=d[2],this.settings.autoExpire&&(b.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime-e),b.setAccessTokenCreationTimer(this.settings.maxAccessTokenCreationTime-f)))}}}},f.prototype.setAccessToken=function(a){if(this.settings.accessToken=a,"undefined"!=typeof window&&(this.settings.autoExpire&&(this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime),this.setAccessTokenCreationTimer(this.settings.maxAccessTokenCreationTime)),this.settings.saveAccessToken)){var b=(new Date).getTime(),c=b+"|"+b+"|"+a;this.createCookie(this.getAccessTokenCookieName(),c,0)}},f.prototype.refreshAccessToken=function(){var a=(new Date).getTime();if(this.settings.autoExpire&&this.setAccessTokenInactiveTimer(this.settings.maxAccessTokenInactivityTime),this.settings.saveAccessToken){var b=this.readCookie(this.getAccessTokenCookieName());if(b){var c=b.split("|",3);3===c.length&&(b=a+"|"+c[1]+"|"+c[2],this.createCookie(this.getAccessTokenCookieName(),b,0))}}},f.prototype.eraseAccessToken=function(a){this.settings.accessToken=null,"undefined"!=typeof window&&(this.settings.autoExpire&&this.clearAccessTokenTimers(),this.settings.saveAccessToken&&this.eraseCookie(this.getAccessTokenCookieName()),this.settings.expireCallback&&!a&&this.settings.expireCallback(this.client))},f.prototype.extendHttpPromise=function(a,b){return d.wrapFunctions(a,b,["getResponseHeader","getAllResponseHeaders","getStatusCode","getRequest"])},f.prototype.chainHttpPromises=function(){var a=arguments[0],b={},c=this;return e(Array.prototype.slice.call(arguments,1),function(d){a=a.then(function(){var a=d.apply(null,arguments);return a&&a.then&&c.extendHttpPromise(b,a),a})}),c.extendHttpPromise(a,b),a},f.prototype.getLastUrlSegment=function(a){return a&&(a=a.replace(/^.*\//,"").replace(/\?.*$/,"")),a},f.prototype.getResponseEntityId=function(a,b){return b.getResponseHeader("X-ENTITY-ID")},f.prototype.getResponseLocation=function(a,b){return this.removeAccessToken(b.getResponseHeader("Location"))},f.prototype.isAbsoluteUrl=function(a){return/^https?:\/\//.test(a)},f.prototype.isAuthoritiesServerUrl=function(a){return-1!==a.indexOf("/authorities/v1/")},f.prototype.encodeQueryString=function(a){var b=[];return e(a,function(a,c){c=encodeURIComponent(c);var e;e=d.isArray(a)?d.map(a,function(a){return c+"="+encodeURIComponent(a)}).join("&"):null!=a?c+"="+encodeURIComponent(a):c,b.push(e)}),b.join("&")},f.prototype.appendQueryParameters=function(a,b){var c=this.encodeQueryString(b);return 0===c.length?a:a+(a.indexOf("?")>=0?"&":"?")+c},f.prototype.decodeQueryString=function(a){var b={};if(a){var c=a.indexOf("?");if(-1!==c){var f=a.substring(c+1).split("&");e(f,function(a){var c=a.split("=",2);if(c&&c[0]){var e=decodeURIComponent(c[0]),f=null!=c[1]?decodeURIComponent(c[1]):c[1];null==b[e]||d.isArray(b[e])||(b[e]=[b[e]]),null!=b[e]?b[e].push(f):b[e]=f}})}}return b},f.prototype.removeQueryString=function(a){if(a){var b=a.indexOf("?");-1!==b&&(a=a.substring(0,b))}return a},f.prototype.removeAccessToken=function(a){if(a){var b=this.decodeQueryString(a);a=this.removeQueryString(a),delete b.access_token,a=this.appendQueryParameters(a,b)}return a},f.prototype.populateUriTemplate=function(a,b){for(var c=a.split(/[{}]/),d=!1,e=0,f=c.length;f>e;e++)if(e%2===1){var g=b[c[e]];c[e]=d?encodeURIComponent(g):encodeURI(g)}else-1!==c[e].indexOf("?")&&(d=!0);return c.join("")},f.prototype.getUrlFromDiscoveryResource=function(a,b,c){var d="",e=a.links[b];if(e.href)d=this.removeAccessToken(e.href);else if(e.template){var f=e.template.replace(/{\?[^}]*}/,"");d=this.populateUriTemplate(f,c||{})}return d},f.prototype.attributionNeeded=function(a){return!(a.attribution&&a.attribution.changeMessage&&!a.attribution.contributor)},f.prototype.createCookie=function(a,b,c){var d="",e="https"===document.location.protocol&&"localhost"!==document.location.hostname;if(c){var f=new Date;f.setTime(f.getTime()+86400*c),d="; expires="+f.toUTCString()}document.cookie=a+"="+b+d+"; path=/"+(e?"; secure":"")},f.prototype.readCookie=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},f.prototype.eraseCookie=function(a){this.createCookie(a,"",-1)},b.exports=f},{"./utils":53}],33:[function(a,b,c){var d=a("./utils"),c={};c.httpWrapper=function(a,b){return function(c,e,f,g,h){h=d.extend({url:e,type:c,dataType:"text/plain"===f.Accept?"text":"json",data:g,processData:!1},h),h.headers=d.extend({},f,h.headers),"multipart/form-data"===h.headers["Content-Type"]&&(h.contentType=!1,delete h.headers["Content-Type"]);var i=a(h),j=b.settings.deferredWrapper(),k=j.promise,l=null;return i.then(function(a,b,c){l=c.status,j.resolve(a)},function(a,b,c){l=a.status,l>=200&&299>=l&&!a.responseText?j.resolve(null):j.reject(a,b,c)}),d.wrapFunctions(k,i,["getResponseHeader","getAllResponseHeaders"]),k.getStatusCode=function(){return l},k.getRequest=function(){return h},k}},c.deferredWrapper=function(a){return function(){var b=a();return{promise:b.promise(),resolve:b.resolve,reject:b.reject}}},b.exports=c},{"./utils":53}],34:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils");d.prototype.getAuthCode=function(){var a=this,b=a.settings,c=b.deferredWrapper();return"undefined"==typeof window?(c.reject(),c.promise):b.expireCallback&&!b.autoSignin?(b.expireCallback(this),c.reject(),c.promise):a.plumbing.getUrl("http://oauth.net/core/2.0/endpoint/authorize").then(function(c){var d=a.openPopup(c,{
response_type:"code",client_id:b.clientId,redirect_uri:b.redirectUri});return a._pollForAuthCode(d)})},d.prototype.handleAccessTokenResponse=function(a,b){var c=this;a.then(function(a){var d=a.access_token;d?(c.helpers.setAccessToken(d),b.resolve(d)):b.reject(a.error)},function(){b.reject.apply(b,arguments)})},d.prototype.getAccessToken=function(a){var b=this,c=b.settings,d=c.deferredWrapper(),e=b.plumbing,f=b.helpers;if(c.accessToken)f.nextTick(function(){d.resolve(c.accessToken)});else{var g;g=a?f.refPromise(a):b.getAuthCode(),g.then(function(a){e.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(f){var g=e.post(f,{grant_type:"authorization_code",code:a,client_id:c.clientId},{"Content-Type":"application/x-www-form-urlencoded"});b.handleAccessTokenResponse(g,d)})},function(){d.reject.apply(d,arguments)})}return d.promise},d.prototype.getAccessTokenForMobile=function(a,b){var c=this,d=c.settings.deferredWrapper(),e=c.plumbing,f=c.helpers;return c.settings.accessToken?f.nextTick(function(){d.resolve(c.settings.accessToken)}):e.getUrl("http://oauth.net/core/2.0/endpoint/token").then(function(f){var g=e.post(f,{grant_type:"password",client_id:c.settings.clientId,username:a,password:b},{"Content-Type":"application/x-www-form-urlencoded"});c.handleAccessTokenResponse(g,d)}),d.promise},d.prototype.getOAuth2AuthorizeURL=function(a){var b=this,c=b.settings;return this.plumbing.getUrl("http://oauth.net/core/2.0/endpoint/authorize").then(function(d){var e={response_type:"code",client_id:c.clientId,redirect_uri:c.redirectUri};return a&&(e.state=a),b.helpers.appendQueryParameters(d,e)})},d.prototype.hasAccessToken=function(){return!!this.settings.accessToken},d.prototype.invalidateAccessToken=function(){var a=this;return a.helpers.eraseAccessToken(!0),a.helpers.chainHttpPromises(a.plumbing.getUrl("http://oauth.net/core/2.0/endpoint/token"),function(b){return a.plumbing.del(b)})},d.prototype.openPopup=function(a,b){var c=e.isUndefined(window.screenX)?window.screenLeft:window.screenX,d=e.isUndefined(window.screenY)?window.screenTop:window.screenY,f=e.isUndefined(window.outerWidth)?document.documentElement.clientWidth:window.outerWidth,g=e.isUndefined(window.outerHeight)?document.documentElement.clientHeight-22:window.outerHeight,h=b.width||780,i=b.height||500,j=parseInt(c+(f-h)/2,10),k=parseInt(d+(g-i)/2.5,10),l="width="+h+",height="+i+",left="+j+",top="+k;return window.open(this.helpers.appendQueryParameters(a,b),"",l)},d.prototype.getCode=function(a,b){var c=this.helpers.decodeQueryString(a);c.code?b.resolve(c.code):b.reject(c.error)},d.prototype._pollForAuthCode=function(a){var b=this,c=b.settings.deferredWrapper();if(a){var d=setInterval(function(){try{a.location.hostname===window.location.hostname&&(b.getCode(a.location.href,c),clearInterval(d),a.close())}catch(e){}},b.settings.authCodePollDelay);window.FamilySearchOauthReceiver=function(a){b.getCode(a,c),clearInterval(d)}}else c.reject("Popup blocked");return c.promise}},{"./../FamilySearch":1,"./../utils":53}],35:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils");d.prototype.getDate=function(a,b){var c=this,d={date:a};return c.plumbing.get(c.helpers.getAPIServerUrl("/platform/dates"),d,{Accept:"text/plain"},b,e.compose(e.objectExtender({getDate:function(){return e.maybe(this.date)}}),function(a){var b={};return a&&(b.date=c.createDate({normalized:a})),b}))}},{"./../FamilySearch":1,"./../utils":53}],36:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils");d.prototype._changeHistoryResponseMapper=function(){var a=this;return e.compose(e.objectExtender({getChanges:function(){return this.entries||[]}}),function(b){for(var c=0;c<b.entries.length;c++)b.entries[c]=a.createChange(b.entries[c]);return b})},d.prototype.getPersonChanges=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-changes-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-gedcomx-atom+json"},c,d._changeHistoryResponseMapper())})},d.prototype.getChildAndParentsChanges=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-changes-template",a,{caprid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-gedcomx-atom+json"},c,d._changeHistoryResponseMapper())})},d.prototype.getCoupleChanges=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-changes-template",a,{crid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-gedcomx-atom+json"},c,d._changeHistoryResponseMapper())})},d.prototype.restoreChange=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("change-restore-template",a,{chid:a}),function(d){return c.plumbing.post(d,null,{"Content-Type":void 0},b,function(){return a})})}},{"./../FamilySearch":1,"./../utils":53}],37:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe;d.prototype.getDiscussion=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("discussion-template",a,{did:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,e.compose(e.objectExtender({getDiscussion:function(){return f(f(this).discussions)[0]}}),function(a){for(var b=0;b<a.discussions.length;b++)a.discussions[b]=d.createDiscussion(a.discussions[b]);return a}))})},d.prototype.getMultiDiscussion=function(a,b,c){var f=this,g={};return e.forEach(a,function(a){var e,h;a instanceof d.DiscussionRef?(h=a.$getDiscussionUrl(),e=a.resourceId):(h=a,e=a),g[e]=f.getDiscussion(h,b,c)}),f.helpers.promiseAll(g)},d.prototype.getPersonDiscussionRefs=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-discussion-references-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,e.compose(e.objectExtender({getDiscussionRefs:function(){return f(f(f(this).persons)[0])["discussion-references"]||[]}}),function(a){if(a&&a.persons&&a.persons[0]&&e.isArray(a.persons[0]["discussion-references"]))for(var b=a.persons[0]["discussion-references"],c=0;c<b.length;c++)b[c]=d.createDiscussionRef(b[c]);return a},e.objectExtender(function(a){return{$personId:f(f(f(a).persons)[0]).id}},function(a){return f(f(f(a).persons)[0])["discussion-references"]})))})},d.prototype._commentsResponseMapper=function(){var a=this;return e.compose(e.objectExtender({getComments:function(){return f(f(f(this).discussions)[0]).comments||[]}}),function(b){if(b&&b.discussions&&b.discussions[0]&&e.isArray(b.discussions[0].comments))for(var c=b.discussions[0].comments,d=0;d<c.length;d++)c[d]=a.createComment(c[d]);return b})},d.prototype.getDiscussionComments=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("discussion-comments-template",a,{did:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,e.compose(d._commentsResponseMapper(),e.objectExtender(function(a){return{$discussionId:f(f(f(a).discussions)[0]).id}},function(a){return f(f(f(a).discussions)[0]).comments})))})},d.prototype.deleteDiscussion=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("discussion-template",a,{did:a}),function(b){return d.plumbing.del(b,{"Content-Type":"application/x-fs-v1+json"},c,function(){return a})})},d.prototype.deleteDiscussionRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-discussion-reference-template",a,{pid:a,drid:b}),function(b){var f={"Content-Type":"application/x-fs-v1+json"};return c&&(f["X-Reason"]=c),e.plumbing.del(b,f,d,function(){return a})})},d.prototype.deleteDiscussionComment=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("discussion-comment-template",a,{did:a,cmid:b}),function(b){return e.plumbing.del(b,{"Content-Type":"application/x-fs-v1+json"},d,function(){return a})})},d.prototype.deleteMemoryComment=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("memory-comment-template",a,{mid:a,cmid:b}),function(b){return e.plumbing.del(b,{},d,function(){return a})})}},{"./../FamilySearch":1,"./../utils":53}],38:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe;d.prototype._memoriesResponseMapper=function(){var a=this;return function(b){if(b&&e.isArray(b.sourceDescriptions))for(var c=0;c<b.sourceDescriptions.length;c++)b.sourceDescriptions[c].attribution&&(b.sourceDescriptions[c].attribution=a.createAttribution(b.sourceDescriptions[c].attribution)),b.sourceDescriptions[c]=a.createMemory(b.sourceDescriptions[c]);return b}},d.prototype.getPersonMemoriesQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-memories-query",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,e.compose(e.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),d._memoriesResponseMapper()))})},d.prototype.getUserMemoriesQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("user-memories-query",a,{cisUserId:a}),function(a){return d.plumbing.get(a,b,{},c,e.compose(e.objectExtender({getMemories:function(){return this.sourceDescriptions||[]}}),d._memoriesResponseMapper()))})},d.prototype.getMemory=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("memory-template",a,{mid:a}),function(a){return d.plumbing.get(a,b,{},c,e.compose(e.objectExtender({getMemory:function(){return f(this.sourceDescriptions)[0]}}),d._memoriesResponseMapper()))})},d.prototype.getMemoryComments=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("memory-comments-template",a,{mid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,e.compose(d._commentsResponseMapper(),e.objectExtender(function(a){return{$memoryId:f(f(f(a).sourceDescriptions)[0]).id}},function(a){return f(f(f(a).discussions)[0]).comments})))})},d.prototype._memoryPersonasMapper=function(){var a=this;return e.compose(function(b){if(b&&e.isArray(b.persons))for(var c=0;c<b.persons.length;c++)b.persons[c]=a.createMemoryPersona(b.persons[c]);return b},function(b){if(b&&e.isArray(b.persons))for(var c=0;c<b.persons.length;c++)if(e.isArray(b.persons[c].names))for(var d=0;d<b.persons[c].names.length;d++)b.persons[c].names[d]=a.createName(b.persons[c].names[d]);return b},function(b){if(b&&e.isArray(b.persons))for(var c=0;c<b.persons.length;c++)b.persons[c].media&&(b.persons[c].media=a.createMemoryArtifactRef(b.persons[c].media));return b},e.objectExtender(function(a){return{$memoryId:f(f(a.sourceDescriptions)[0]).id}},function(a){return f(a).persons}))},d.prototype.getMemoryPersonas=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("memory-personas-template",a,{mid:a}),function(a){return d.plumbing.get(a,b,{},c,e.compose(e.objectExtender({getMemoryPersonas:function(){return this&&this.persons?this.persons:[]}}),d._memoryPersonasMapper()))})},d.prototype.getMemoryPersona=function(a,b,c,d){var g=this;return g.helpers.chainHttpPromises(g.plumbing.getUrl("memory-persona-template",a,{mid:a,pid:b}),function(a){return g.plumbing.get(a,c,{},d,e.compose(e.objectExtender({getMemoryPersona:function(){return f(this.persons)[0]}}),g._memoryPersonasMapper()))})},d.prototype.getMemoryPersonaRefs=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-memory-persona-references-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,e.compose(e.objectExtender({getMemoryPersonaRefs:function(){return f(f(this.persons)[0]).evidence||[]}}),function(a){try{if(a&&e.isArray(a.persons)&&a.persons[0]){var b=a.persons[0];if(b.evidence&&e.isArray(b.evidence))for(var c=0;c<b.evidence.length;c++)b.evidence[c]=d.createMemoryPersonaRef(b.evidence[c])}}catch(f){console.error(f.stack)}return a},e.objectExtender(function(a){return{$personId:f(f(f(a).persons)[0]).id}},function(a){return f(f(f(a).persons)[0]).evidence})))})},d.prototype.getPersonPortraitUrl=function(a,b,c){var d=this;return d.plumbing.getUrl("person-portrait-template",a,{pid:a}).then(function(a){if(b&&b.followRedirect){b=e.extend({},b),delete b.followRedirect;var f=d.plumbing.get(a,b,{"X-Expect-Override":"200-ok"},c);return f.then(function(){return 204===f.getStatusCode()?"":d.helpers.appendAccessToken(f.getResponseHeader("Location"))})}return d.helpers.appendAccessToken(a)})},d.prototype.deleteMemory=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("memory-template",a,{mid:a}),function(b){return d.plumbing.del(b,{},c,function(){return a})})},d.prototype.deleteMemoryPersona=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("memory-persona-template",a,{mid:a,pid:b}),function(b){return e.plumbing.del(b,{},d,function(){return a})})},d.prototype.deleteMemoryPersonaRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-memory-persona-reference-template",a,{pid:a,erid:b}),function(b){return e.plumbing.del(b,{},d,function(){return a})})}},{"./../FamilySearch":1,"./../utils":53}],39:[function(a,b,c){function d(a){if(a){if(a.persons)return a.persons;if(a.childAndParentsRelationships)return a.childAndParentsRelationships;if(a.relationships)return a.relationships}return{}}var e=a("./../FamilySearch"),f=a("./../utils"),g=f.maybe;e.prototype._getNote=function(a,b,c){var e=this;return e.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,f.compose(f.objectExtender({getNote:function(){return g(g(d(this)[0]).notes)[0]}}),function(a){var b=g(d(a)[0]).notes;return f.forEach(b,function(a,c){b[c]=e.createNote(a)}),a},f.objectExtender(function(a){var b=a.persons?"$personId":a.childAndParentsRelationships?"$childAndParentsId":"$coupleId",c={};return c[b]=g(d(a)[0]).id,c},function(a){return g(d(a)[0]).notes})))},e.prototype._getMultiNote=function(a,b,c,d,e){var g=this,h={};return f.isArray(a)?f.forEach(a,function(a){h[a]=e.call(g,a,null,c,d)}):f.forEach(b,function(b){h[b]=e.call(g,a,b,c,d)}),h},e.prototype.getPersonNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-note-template",a,{pid:a,nid:b}),function(a){return e._getNote(a,c,d)})},e.prototype.getMultiPersonNote=function(a,b,c,d){var e=this._getMultiNote(a,b,c,d,this.getPersonNote);return this.helpers.promiseAll(e)},e.prototype.getCoupleNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("couple-relationship-note-template",a,{crid:a,nid:b}),function(a){return e._getNote(a,c,d)})},e.prototype.getMultiCoupleNote=function(a,b,c,d){var e=this._getMultiNote(a,b,c,d,this.getCoupleNote);return this.helpers.promiseAll(e)},e.prototype.getChildAndParentsNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-note-template",a,{caprid:a,nid:b}),function(a){return e._getNote(a,c,d)})},e.prototype.getMultiChildAndParentsNote=function(a,b,c,d){var e=this._getMultiNote(a,b,c,d,this.getChildAndParentsNote);return this.helpers.promiseAll(e)},e.prototype.getPersonNotes=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-notes-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,f.compose(f.objectExtender({getNotes:function(){return g(g(g(this).persons)[0]).notes||[]}}),function(a){var b=g(g(g(a).persons)[0]).notes;return f.forEach(b,function(a,c){b[c]=d.createNote(a)}),a},f.objectExtender(function(a){return{$personId:g(g(g(a).persons)[0]).id}},function(a){return g(g(g(a).persons)[0]).notes})))})},e.prototype.getCoupleNotes=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-notes-template",a,{crid:a}),function(a){return d.plumbing.get(a,b,{},c,f.compose(f.objectExtender({getNotes:function(){return g(g(this.relationships)[0]).notes||[]}}),function(a){var b=g(g(g(a).relationships)[0]).notes;return f.forEach(b,function(a,c){b[c]=d.createNote(a)}),a},f.objectExtender(function(a){return{$coupleId:g(g(g(a).relationships)[0]).id}},function(a){return g(g(g(a).relationships)[0]).notes})))})},e.prototype.getChildAndParentsNotes=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-notes-template",a,{caprid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,f.compose(f.objectExtender({getNotes:function(){return g(g(this.childAndParentsRelationships)[0]).notes||[]}}),function(a){var b=g(g(g(a).childAndParentsRelationships)[0]).notes;return f.forEach(b,function(a,c){b[c]=d.createNote(a)}),a},f.objectExtender(function(a){return{$childAndParentsId:g(g(g(a).childAndParentsRelationships)[0]).id}},function(a){return g(g(g(a).childAndParentsRelationships)[0]).notes})))})},e.prototype.deletePersonNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-note-template",a,{pid:a,nid:b}),function(b){var f={"Content-Type":"application/x-fs-v1+json"};return c&&(f["X-Reason"]=c),e.plumbing.del(b,f,d,function(){return a})})},e.prototype.deleteCoupleNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("couple-relationship-note-template",a,{crid:a,nid:b}),function(b){var f={};return c&&(f["X-Reason"]=c),e.plumbing.del(b,f,d,function(){return a})})},e.prototype.deleteChildAndParentsNote=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-note-template",a,{caprid:a,nid:b}),function(b){var f={"Content-Type":"application/x-fs-v1+json"};return c&&(f["X-Reason"]=c),e.plumbing.del(b,f,d,function(){return a})})}},{"./../FamilySearch":1,"./../utils":53}],40:[function(a,b,c){var d=a("../FamilySearch"),e=a("../utils"),f=e.maybe,g={getRelationship:function(){return f(this.childAndParentsRelationships)[0]},getPerson:function(a){return e.find(this.persons,{id:a})}};d.prototype.getChildAndParents=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-template",a,{caprid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,e.compose(e.objectExtender(g),function(a){return e.forEach(a.persons,function(a,b,c){c[b]=d.createPerson(a)}),e.forEach(a.childAndParentsRelationships,function(a,b,c){c[b]=d.createChildAndParents(a)}),a}))})},d.prototype.deleteChildAndParents=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-template",a,{caprid:a}),function(e){var f={"Content-Type":"application/x-fs-v1+json"};return b&&(f["X-Reason"]=b),d.plumbing.del(e,f,c,function(){return a})})},d.prototype.restoreChildAndParents=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("child-and-parents-relationship-restore-template",a,{caprid:a}),function(d){return c.plumbing.post(d,null,{"Content-Type":"application/x-fs-v1+json"},b,function(){return a})})}},{"../FamilySearch":1,"../utils":53}],41:[function(a,b,c){function d(a){return{getPersons:function(){return this.persons},exists:function(b){return!!h(g.find(this.persons,e(a,b))).id},getPerson:function(b){return g.find(this.persons,e(a,b))}}}function e(a,b){return function(c){return c.display[a]==b}}var f=a("./../FamilySearch"),g=a("./../utils"),h=g.maybe;f.prototype.getAncestry=function(a,b,c){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("ancestry-query"),function(i){return f.plumbing.get(i,g.extend({person:a},b),{},c,g.compose(g.objectExtender(d("ascendancyNumber")),b&&b.descendants?g.objectExtender({getDescendant:function(a){return g.find(this.persons,e("descendancyNumber",a))},existsDescendant:function(a){return!!h(g.find(this.persons,e("descendancyNumber",a))).id}}):null,function(a){return g.forEach(a.persons,function(a,b,c){c[b]=f.createPerson(a)}),a},g.objectExtender({$getAscendancyNumber:function(){return this.display.ascendancyNumber}},function(a){return h(a).persons}),b&&b.descendants?g.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},function(a){return h(a).persons}):null))})},f.prototype.getDescendancy=function(a,b,c){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("descendancy-query"),function(f){return e.plumbing.get(f,g.extend({person:a},b),{},c,g.compose(g.objectExtender(d("descendancyNumber")),function(a){return g.forEach(a.persons,function(a,b,c){c[b]=e.createPerson(a)}),a},g.objectExtender({$getDescendancyNumber:function(){return this.display.descendancyNumber}},function(a){return h(a).persons})))})}},{"./../FamilySearch":1,"./../utils":53}],42:[function(a,b,c){var d=a("../FamilySearch"),e=a("../utils"),f=e.maybe,g={getPrimaryId:function(){var a=this.description.substring(1),b=e.find(this.sourceDescriptions,function(b){return b.id===a});return b?b.about.substring(1):void 0},getPerson:function(a){return e.find(this.persons,{id:a})},getPrimaryPerson:function(){return this.getPerson(this.getPrimaryId())},getParentRelationships:function(){var a=this.getPrimaryId();return e.filter(this.childAndParentsRelationships,function(b){return f(b.child).resourceId===a})},getSpouseRelationships:function(){return e.filter(this.relationships,function(a){return"http://gedcomx.org/Couple"===a.type})},getSpouseRelationship:function(a){var b=this.getPrimaryId();return e.find(this.relationships,function(c){return"http://gedcomx.org/Couple"===c.type&&(b===c.$getHusbandId()?c.$getWifeId():c.$getHusbandId())===a})},getChildRelationships:function(){var a=this.getPrimaryId();return e.filter(this.childAndParentsRelationships,function(b){return f(b.father).resourceId===a||f(b.mother).resourceId===a})},getChildRelationshipsOf:function(a){var b=this.getPrimaryId();return e.filter(this.childAndParentsRelationships,function(c){return!(f(c.father).resourceId!==b&&f(c.mother).resourceId!==b||f(c.father).resourceId!=a&&f(c.mother).resourceId!=a)})},getFatherIds:function(){return e.uniq(e.map(e.filter(this.getParentRelationships(),function(a){return!!a.$getFatherId()}),function(a){return a.$getFatherId()},this))},getFathers:function(){return e.map(this.getFatherIds(),this.getPerson,this)},getMotherIds:function(){return e.uniq(e.map(e.filter(this.getParentRelationships(),function(a){return!!a.$getMotherId()}),function(a){return a.$getMotherId()},this))},getMothers:function(){return e.map(this.getMotherIds(),this.getPerson,this)},getSpouseIds:function(){return e.uniq(e.map(e.filter(this.getSpouseRelationships(),function(a){return a.$getHusbandId()&&a.$getWifeId()}),function(a){return this.getPrimaryId()===a.$getHusbandId()?a.$getWifeId():a.$getHusbandId()},this))},getSpouses:function(){return e.map(this.getSpouseIds(),this.getPerson,this)},getChildIds:function(){return e.uniq(e.map(this.getChildRelationships(),function(a){return a.$getChildId()},this))},getChildren:function(){return e.map(this.getChildIds(),this.getPerson,this)},getChildIdsOf:function(a){return e.uniq(e.map(this.getChildRelationshipsOf(a),function(a){return a.$getChildId()},this))},getChildrenOf:function(a){return e.map(this.getChildIdsOf(a),this.getPerson,this)},wasRedirected:function(){return this.getPrimaryId()!==this.getRequestedId()}};d.prototype.getPerson=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,e.compose(e.objectExtender({getPerson:function(){return this.persons[0]}}),function(a){return e.forEach(a.persons,function(a,b,c){c[b]=d.createPerson(a)}),a},function(a,b){return a.persons[0].$isReadOnly=function(){var a=b.getResponseHeader("Allow");return!!a&&a.indexOf("POST")<0},a}))})},d.prototype.getMultiPerson=function(a,b,c){var d={},f=this;return e.forEach(a,function(a){d[a]=f.getPerson(a,b,c)}),f.helpers.promiseAll(d)},d.prototype._personsAndRelationshipsMapper=function(){var a=this;return e.compose(e.objectExtender({getCoupleRelationships:function(){return e.filter(f(this).relationships,{type:"http://gedcomx.org/Couple"})||[]},getChildAndParentsRelationships:function(){return f(this).childAndParentsRelationships||[]},getPerson:function(a){return e.find(this.persons,{id:a})}}),function(b){return e.forEach(b.persons,function(b,c,d){d[c]=a.createPerson(b)}),e.forEach(b.relationships,function(b,c,d){d[c]=a.createCouple(b)}),e.forEach(b.childAndParentsRelationships,function(b,c,d){d[c]=a.createChildAndParents(b)}),b})},d.prototype.getPersonWithRelationships=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-with-relationships-query"),function(f){return d.plumbing.get(f,e.extend({person:a},b),{},c,e.compose(e.objectExtender({getRequestedId:function(){return a}}),d._personsAndRelationshipsMapper(),e.objectExtender(g),function(a,b){return a.persons[0].$isReadOnly=function(){var a=b.getResponseHeader("Allow");return!!a&&a.indexOf("POST")<0},a}))})},d.prototype.getSpouses=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("spouses-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._personsAndRelationshipsMapper())})},d.prototype.getParents=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("parents-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._personsAndRelationshipsMapper())})},d.prototype.getChildren=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("children-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._personsAndRelationshipsMapper())})},d.prototype.deletePerson=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-template",a,{pid:a}),function(e){return d.plumbing.del(e,b?{"X-Reason":b}:{},c,function(){return a})})},d.prototype.restorePerson=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("person-restore-template",a,{pid:a}),function(d){return c.plumbing.post(d,null,{"Content-Type":"application/x-fs-v1+json"},b,function(){return a})})},d.prototype.getPreferredSpouse=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.getCurrentUser(),function(b){var c=b.getUser().treeUserId;return d.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:c,pid:a})},function(a){var e=d.plumbing.get(a+".json",b,{"X-Expect-Override":"200-ok"},c);return e.then(function(){if(200===e.getStatusCode()){var a=e.getResponseHeader("Location");return a.indexOf("child-and-parents-relationships")>=0?null:d.helpers.getLastUrlSegment(a)}return void 0})})},d.prototype.setPreferredSpouse=function(a,b,c){var d,f=[],g=this;return null===b?f.push(g.getChildren(a),function(a){var b=e.find(a.getChildAndParentsRelationships(),function(a){return!a.$getFatherId()||!a.$getMotherId()});return g.plumbing.getUrl("child-and-parents-relationship-template",null,{caprid:b.id})}):f.push(g.plumbing.getUrl("couple-relationship-template",b,{crid:b})),f.push(function(a){return d=a,g.getCurrentUser()},function(b){var c=b.getUser().treeUserId;return g.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:c,pid:a})},function(b){return g.plumbing.put(b,null,{Location:d},c,function(){return a})}),g.helpers.chainHttpPromises.apply(g.helpers,f)},d.prototype.deletePreferredSpouse=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.getCurrentUser(),function(b){var d=b.getUser().treeUserId;return c.plumbing.getUrl("preferred-spouse-relationship-template",null,{uid:d,pid:a})},function(d){return c.plumbing.del(d,{},b,function(){return a})})},d.prototype.getPreferredParents=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.getCurrentUser(),function(b){var c=b.getUser().treeUserId;return d.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:c,pid:a})},function(a){var e=d.plumbing.get(a+".json",b,{Accept:"application/x-fs-v1+json","X-Expect-Override":"200-ok"},c);return e.then(function(){return 200===e.getStatusCode()?d.helpers.getLastUrlSegment(e.getResponseHeader("Location")):void 0})})},d.prototype.setPreferredParents=function(a,b,c){var d,e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-template",b,{caprid:b}),function(a){return d=a,e.getCurrentUser()},function(b){var c=b.getUser().treeUserId;return e.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:c,pid:a})},function(b){return e.plumbing.put(b,null,{Location:d},c,function(){return a})})},d.prototype.deletePreferredParents=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.getCurrentUser(),function(b){var d=b.getUser().treeUserId;return c.plumbing.getUrl("preferred-parent-relationship-template",null,{uid:d,pid:a})},function(d){return c.plumbing.del(d,{},b,function(){return a})})}},{"../FamilySearch":1,"../utils":53}],43:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils");d.prototype.getPlace=function(a,b){var c=this,d=c.helpers.getAPIServerUrl(c.helpers.populateUriTemplate("/platform/places/{id}",{id:a}));return c.plumbing.get(d,{},{},b,e.compose(e.objectExtender({getPlace:function(){return e.maybe(this.places)[0]}}),function(a){return e.forEach(a.places,function(a,b,d){d[b]=c.createPlaceDescription(a)}),a}))},d.prototype.getPlaceDescription=function(a,b){var c=this,d=c.helpers.getAPIServerUrl(c.helpers.populateUriTemplate("/platform/places/description/{id}",{id:a}));return c.plumbing.get(d,{},{},b,e.compose(e.objectExtender({getPlaceDescription:function(){return e.maybe(this.places)[0]}}),function(a){var b={};return e.forEach(a.places,function(a,d,e){e[d]=b[a.id]=c.createPlaceDescription(a)}),e.forEach(a.places,function(a){if(a.jurisdiction&&a.jurisdiction.resource){var c=a.jurisdiction.resource.substring(1);b[c]&&a.$setJurisdiction(b[c])}}),a}))},d.prototype.getPlacesSearch=function(a,b){var c=this,d=c.helpers.getAPIServerUrl("/platform/places/search");return c.plumbing.get(d,e.removeEmptyProperties({q:e.searchParamsFilter(e.removeEmptyProperties(e.extend({},a))),start:a.start,count:a.count}),{Accept:"application/x-gedcomx-atom+json"},b,e.compose(e.objectExtender({getSearchResults:function(){return e.maybe(this.entries)}}),function(a){return e.forEach(a.entries,function(a,b,d){d[b]=c.createPlacesSearchResult(a)}),a}))},d.prototype.getPlaceDescriptionChildren=function(a,b){var c=this,d=c.helpers.getAPIServerUrl(c.helpers.populateUriTemplate("/platform/places/description/{id}/children",{id:a}));return c.plumbing.get(d,{},{},b,e.compose(e.objectExtender({getChildren:function(){return e.maybe(this.places)}}),function(a){return e.forEach(a.places,function(a,b,d){d[b]=c.createPlaceDescription(a)}),a}))},d.prototype.getPlaceType=function(a,b){var c=this,d=c.helpers.getAPIServerUrl(c.helpers.populateUriTemplate("/platform/places/types/{id}",{id:a}));return c.plumbing.get(d,{},{Accept:"application/ld+json"},b,e.compose(e.objectExtender({getPlaceType:function(){return c.createVocabularyElement(this)}})))},d.prototype.getPlaceTypes=function(a){var b=this,c=b.helpers.getAPIServerUrl("/platform/places/types");return b.plumbing.get(c,{},{Accept:"application/ld+json"},a,e.compose(e.objectExtender({getList:function(){return b.createVocabularyList(this)},getPlaceTypes:function(){return this.getList().$getElements()}})))},d.prototype.getPlaceTypeGroup=function(a,b){var c=this,d=c.helpers.getAPIServerUrl(c.helpers.populateUriTemplate("/platform/places/type-groups/{id}",{id:a}));return c.plumbing.get(d,{},{Accept:"application/ld+json"},b,e.compose(e.objectExtender({getList:function(){return c.createVocabularyList(this)},getPlaceTypes:function(){return this.getList().$getElements()}})))},d.prototype.getPlaceTypeGroups=function(a){var b=this,c=b.helpers.getAPIServerUrl("/platform/places/type-groups");return b.plumbing.get(c,{},{Accept:"application/ld+json"},a,e.compose(e.objectExtender({getList:function(){return b.createVocabularyList(this)},getPlaceTypeGroups:function(){return this.getList().$getElements()}})))}},{"./../FamilySearch":1,"./../utils":53}],44:[function(a,b,c){
var d=a("./../FamilySearch");d.prototype.getRedirectUrl=function(a){return this.helpers.appendAccessToken(this.helpers.appendQueryParameters(this.helpers.getAPIServerUrl("/platform/redirect"),a))}},{"./../FamilySearch":1}],45:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f={getSearchResults:function(){return this.entries||[]},getResultsCount:function(){return this.results||0},getIndex:function(){return this.index||0}};d.prototype._getSearchMatchResponseMapper=function(){var a=this;return e.compose(e.objectExtender(f),function(b){return e.forEach(b.entries,function(b,c,d){d[c]=a.createSearchResult(b)}),b})},d.prototype.getPersonSearch=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("person-search"),function(d){return c.plumbing.get(d,e.removeEmptyProperties({q:e.searchParamsFilter(e.removeEmptyProperties(e.extend({},a))),start:a.start,count:a.count,context:a.context}),{Accept:"application/x-gedcomx-atom+json"},b,e.compose(c._getSearchMatchResponseMapper(),function(a,b){return a.getContext=function(){return b.getResponseHeader("X-FS-Page-Context")},a}))})},d.prototype.getPersonMatches=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-matches-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-gedcomx-atom+json"},c,d._getSearchMatchResponseMapper())})},d.prototype.getPersonMatchesQuery=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("person-matches-query"),function(d){return c.plumbing.get(d,e.removeEmptyProperties({q:e.searchParamsFilter(e.removeEmptyProperties(e.extend({},a))),start:a.start,count:a.count}),{Accept:"application/x-gedcomx-atom+json"},b,c._getSearchMatchResponseMapper())})}},{"./../FamilySearch":1,"./../utils":53}],46:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe;d.prototype.getCollectionsForUser=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("user-collections-for-user-template",a,{uid:a}),function(a){return d.plumbing.get(a,{},{Accept:"application/x-fs-v1+json"},c,e.compose(e.objectExtender({getCollections:function(){return this.collections||[]}}),function(a){return e.forEach(a.collections,function(a,b,c){c[b]=d.createCollection(a)}),a}))})},d.prototype.getCollection=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("user-collection-template",a,{udcid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,e.compose(e.objectExtender({getCollection:function(){return f(this.collections)[0]}}),function(a){return e.forEach(a.collections,function(a,b,c){c[b]=d.createCollection(a)}),a}))})},d.prototype.getCollectionSourceDescriptions=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("user-collection-source-descriptions-template",a,{udcid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,e.compose(e.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),function(a){return e.forEach(a.sourceDescriptions,function(a,b,c){c[b]=d.createSourceDescription(a)}),a}))})},d.prototype.getCollectionSourceDescriptionsForUser=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("user-collections-source-descriptions-for-user-template",a,{uid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,e.compose(e.objectExtender({getSourceDescriptions:function(){return this.sourceDescriptions||[]}}),function(a){return e.forEach(a.sourceDescriptions,function(a,b,c){c[b]=d.createSourceDescription(a)}),a}))})},d.prototype.moveSourceDescriptionsToCollection=function(a,b,c){var f=this;return f.helpers.chainHttpPromises(f.plumbing.getUrl("user-collection-source-descriptions-template",a,{udcid:a}),function(g){var h=e.map(b,function(a){return{id:a instanceof d.SourceDescription?a.id:a}});return f.plumbing.post(g,{sourceDescriptions:h},{},c,function(){return a})})},d.prototype.removeSourceDescriptionsFromCollections=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.getCurrentUser(),function(a){var b=a.getUser().treeUserId;return c.plumbing.getUrl("user-collections-source-descriptions-for-user-template",null,{uid:b})},function(f){var g=e.map(a,function(a){return a instanceof d.SourceDescription?a.id:a});return c.plumbing.del(c.helpers.appendQueryParameters(f,{id:g}),{},b,function(){return a})})},d.prototype.deleteCollection=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("user-collection-template",a,{udcid:a}),function(d){return c.plumbing.del(d,{},b,function(){return a})})}},{"./../FamilySearch":1,"./../utils":53}],47:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe;d.prototype.getSourceDescription=function(a,b,c){a instanceof d.SourceRef&&(a=a.$getSourceDescriptionUrl()||a.$sourceDescriptionId);var g=this;return g.helpers.chainHttpPromises(g.plumbing.getUrl("source-description-template",a,{sdid:a}),function(a){return g.plumbing.get(a,b,{},c,e.compose(e.objectExtender({getSourceDescription:function(){return f(this.sourceDescriptions)[0]}}),function(a){for(var b=f(f(a).sourceDescriptions),c=0;c<b.length;c++)b[c]=g.createSourceDescription(b[c]);return a}))})},d.prototype.getMultiSourceDescription=function(a,b,c){var f={},g=this;return e.forEach(a,function(a){var e,h;a instanceof d.SourceRef?(e=a.$sourceDescriptionId||a.$getSourceDescriptionUrl(),h=a.$getSourceDescriptionUrl()||a.$sourceDescriptionId):(e=a,h=a),f[e]=g.getSourceDescription(h,b,c)}),g.helpers.promiseAll(f)},d.prototype.getSourceRefsQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("source-references-query"),function(g){return g=d.helpers.appendQueryParameters(g,{source:a}),d.plumbing.get(g,b,{Accept:"application/x-fs-v1+json"},c,e.compose(e.objectExtender({getPersonSourceRefs:function(){return e.flatMap(f(this.persons),function(a){return a.sources})}}),e.objectExtender({getCoupleSourceRefs:function(){return e.flatMap(f(this.relationships),function(a){return a.sources})}}),e.objectExtender({getChildAndParentsSourceRefs:function(){return e.flatMap(f(this.childAndParentsRelationships),function(a){return a.sources})}}),function(a){return e.forEach(["persons","relationships","childAndParentsRelationships"],function(b){f(a)[b]=e.map(f(a)[b],function(a){return a.sources=e.map(a.sources,function(a){return d.createSourceRef(a)}),a})}),a},e.objectExtender(function(b,c){var d=e.find(f(b).persons,function(a){return!!e.find(f(a).sources,{id:c.id})});return{$personId:d.id,$sourceDescriptionId:a}},function(a){return e.flatMap(f(a).persons,function(a){return a.sources})}),e.objectExtender(function(b,c){var d=e.find(f(b).relationships,function(a){return!!e.find(f(a).sources,{id:c.id})});return{$coupleId:d.id,$sourceDescriptionId:a}},function(a){return e.flatMap(f(a).relationships,function(a){return a.sources})}),e.objectExtender(function(b,c){var d=e.find(f(b).childAndParentsRelationships,function(a){return!!e.find(f(a).sources,{id:c.id})});return{$childAndParentsId:d.id,$sourceDescriptionId:a}},function(a){return e.flatMap(f(a).childAndParentsRelationships,function(a){return a.sources})})))})},d.prototype._getSourcesResponseMapper=function(a,b,c){var d=this;return e.compose(e.objectExtender(e.removeEmptyProperties({getSourceRefs:function(){return f(f(this[a])[0]).sources||[]},getSourceDescriptions:c?function(){return this.sourceDescriptions||[]}:null,getSourceDescription:c?function(a){return e.find(this.sourceDescriptions,{id:a})}:null})),function(b){return e.forEach(f(f(f(b)[a])[0]).sources,function(a,b,c){c[b]=d.createSourceRef(a)}),b},e.objectExtender(function(c,e){var g;if(d.helpers.isAbsoluteUrl(e.description))g={$sourceDescriptionId:d.helpers.getLastUrlSegment(e.description)};else{var h="#"===e.description.charAt(0)?e.description.substr(1):e.description;g={$sourceDescriptionId:h,description:d.helpers.getUrlFromDiscoveryResource(d.settings.discoveryResource,"source-description-template",{sdid:h})}}return g[b]=f(f(f(c)[a])[0]).id,g},function(b){return f(f(f(b)[a])[0]).sources}),c?function(a){return e.forEach(a.sourceDescriptions,function(a,b,c){c[b]=d.createSourceDescription(a)}),a}:null)},d.prototype.getPersonSourceRefs=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-source-references-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._getSourcesResponseMapper("persons","$personId",!1))})},d.prototype.getPersonSourcesQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("person-sources-query-template",a,{pid:a}),function(a){return d.plumbing.get(a,b,{},c,d._getSourcesResponseMapper("persons","$personId",!0))})},d.prototype.getCoupleSourceRefs=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-source-references-template",a,{crid:a}),function(a){return d.plumbing.get(a,b,{},c,d._getSourcesResponseMapper("relationships","$coupleId",!1))})},d.prototype.getCoupleSourcesQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-sources-query-template",a,{crid:a}),function(a){return d.plumbing.get(a,b,{},c,d._getSourcesResponseMapper("relationships","$coupleId",!0))})},d.prototype.getChildAndParentsSourceRefs=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-source-references-template",a,{caprid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,d._getSourcesResponseMapper("childAndParentsRelationships","$childAndParentsId",!1))})},d.prototype.getChildAndParentsSourcesQuery=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("child-and-parents-relationship-sources-template",a,{caprid:a}),function(a){return d.plumbing.get(a,b,{Accept:"application/x-fs-v1+json"},c,d._getSourcesResponseMapper("childAndParentsRelationships","$childAndParentsId",!0))})},d.prototype.deleteSourceDescription=function(a,b,c){var d=this,f=d.getSourceRefsQuery(a,{},c).then(function(g){var h=e.union(e.map(g.getPersonSourceRefs(),function(a){return d.deletePersonSourceRef(a.$getSourceRefUrl(),null,b,c)}),e.map(g.getCoupleSourceRefs(),function(a){return d.deleteCoupleSourceRef(a.$getSourceRefUrl(),null,b,c)}),e.map(g.getChildAndParentsSourceRefs(),function(a){return d.deleteChildAndParentsSourceRef(a.$getSourceRefUrl(),null,b,c)}));return d.helpers.promiseAll(h).then(function(){var e=d.helpers.chainHttpPromises(d.plumbing.getUrl("source-description-template",null,{sdid:a}),function(e){return d.plumbing.del(e,b?{"X-Reason":b}:{},c,function(){return a})});return d.helpers.extendHttpPromise(f,e),e})});return f},d.prototype.deletePersonSourceRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("person-source-reference-template",a,{pid:a,srid:b}),function(b){return e.plumbing.del(b,c?{"X-Reason":c}:{},d,function(){return a})})},d.prototype.deleteCoupleSourceRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("couple-relationship-source-reference-template",a,{crid:a,srid:b}),function(b){return e.plumbing.del(b,c?{"X-Reason":c}:{},d,function(){return a})})},d.prototype.deleteChildAndParentsSourceRef=function(a,b,c,d){var e=this;return e.helpers.chainHttpPromises(e.plumbing.getUrl("child-and-parents-relationship-source-reference-template",a,{caprid:a,srid:b}),function(b){var f={"Content-Type":"application/x-fs-v1+json"};return c&&(f["X-Reason"]=c),e.plumbing.del(b,f,d,function(){return a})})}},{"./../FamilySearch":1,"./../utils":53}],48:[function(a,b,c){var d=a("../FamilySearch"),e=a("../utils"),f=e.maybe,g={getRelationship:function(){return f(this.relationships)[0]},getPerson:function(a){return e.find(this.persons,{id:a})}};d.prototype.getCouple=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-template",a,{crid:a}),function(a){return d.plumbing.get(a,b,{},c,e.compose(e.objectExtender(g),function(a){return e.forEach(a.persons,function(a,b,c){c[b]=d.createPerson(a)}),e.forEach(a.relationships,function(a,b,c){c[b]=d.createCouple(a)}),a}))})},d.prototype.deleteCouple=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("couple-relationship-template",a,{crid:a}),function(e){return d.plumbing.del(e,b?{"X-Reason":b}:{},c,function(){return a})})},d.prototype.restoreCouple=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("couple-relationship-restore-template",a,{crid:a}),function(d){return c.plumbing.post(d,null,{"Content-Type":"application/x-fs-v1+json"},b,function(){return a})})}},{"../FamilySearch":1,"../utils":53}],49:[function(a,b,c){var d=a("./../FamilySearch"),e=a("./../utils"),f=e.maybe;d.prototype.getCurrentUser=function(a,b){var c=this;return c.helpers.chainHttpPromises(c.plumbing.getUrl("current-user"),function(d){return c.plumbing.get(d,a,{},b,e.compose(e.objectExtender({getUser:function(){return f(this.users)[0]}}),function(a){return e.forEach(a.users,function(a,b,d){d[b]=c.createUser(a)}),a}))})},d.prototype.getAgent=function(a,b,c){var d=this;return d.helpers.chainHttpPromises(d.plumbing.getUrl("agent-template",a,{uid:a}),function(a){return d.plumbing.get(a,b,{},c,e.compose(e.objectExtender({getAgent:function(){return f(this.agents)[0]}}),function(a){return e.forEach(a.agents,function(a,b,c){c[b]=d.createAgent(a)}),a}))})},d.prototype.getMultiAgent=function(a,b,c){var d=this,f={};return e.forEach(a,function(a){f[a]=d.getAgent(a,b,c)}),d.helpers.promiseAll(f)}},{"./../FamilySearch":1,"./../utils":53}],50:[function(a,b,c){var d=a("./utils"),c={};c.httpWrapper=function(a,b){return function(c,e,f,g,h){h=d.extend({url:e,method:c,json:!0,body:g},h),h.headers=d.extend({},f,h.headers),"multipart/form-data"===h.headers["Content-Type"]&&(h.formData=h.body,delete h.body,delete h.headers["Content-Type"],delete h.json),"text/plain"===h.headers.Accept&&delete h.json;var i=b.settings.deferredWrapper(),j=i.promise,k=null,l={};return a(h,function(a,b,c){b&&(b.headers&&(l=b.headers),k=b.statusCode),a?i.reject(a):k>=400?(a=c.errors?c.errors[0]:new Error("server responded with a "+k),i.reject(a)):i.resolve(c)}),j.getStatusCode=function(){return k},j.getResponseHeader=function(a){return l[a]},j.getAllResponseHeaders=function(){return l},j.getRequest=function(){return h},j}},c.deferredWrapper=function(a){return function(){var b=a();return{promise:b.promise,resolve:b.resolve,reject:b.reject}}},b.exports=c},{"./utils":53}],51:[function(a,b,c){function d(a){var b,c,e,f,g,h,i,j="";for(b in a)if(a.hasOwnProperty(b))if(c=a[b],c instanceof Array)for(i=0;i<c.length;++i)g=c[i],e=b+"["+i+"]",h={},h[e]=g,j+=d(h)+"&";else if(c instanceof Object)for(f in c)c.hasOwnProperty(f)&&(g=c[f],e=b+"["+f+"]",h={},h[e]=g,j+=d(h)+"&");else void 0!==c&&null!==c&&(j+=encodeURIComponent(b)+"="+encodeURIComponent(c)+"&");return j.length?j.substr(0,j.length-1):j}var e=a("./utils"),f=function(a){this.client=a,this.helpers=a.helpers,this.settings=a.settings,this.totalProcessingTime=0};f.prototype.getTotalProcessingTime=function(){return this.totalProcessingTime},f.prototype.setTotalProcessingTime=function(a){this.totalProcessingTime=a},f.prototype.getUrl=function(a,b,c){var d=this;return this.settings.discoveryPromise.then(function(e){var f="";return f=d.helpers.isAbsoluteUrl(b)?b:d.helpers.getUrlFromDiscoveryResource(e,a,c)})},f.prototype.get=function(a,b,c,d,f){return this.http("GET",this.helpers.appendQueryParameters(a,b),e.extend({Accept:"application/x-gedcomx-v1+json"},c),null,d,f)},f.prototype.post=function(a,b,c,d,f){return this.http("POST",a,e.extend({"Content-Type":"application/x-gedcomx-v1+json"},c),b,d,f)},f.prototype.put=function(a,b,c,d,f){return this.http("PUT",a,e.extend({"Content-Type":"application/x-gedcomx-v1+json"},c),b,d,f)},f.prototype.del=function(a,b,c,d){return this.http("DELETE",a,e.extend({"Content-Type":"application/x-gedcomx-v1+json"},b),null,c,d)},f.prototype.transformData=function(a,b){if(a&&e.isObject(a)&&"[object FormData]"!==String(a)){if(a=e.clonePartial(a,function(a){return!(e.isString(a)&&("$"===a.charAt(0)||"_"===a.charAt(0)))}),"application/x-www-form-urlencoded"===b)return d(a);if(b&&-1!==b.indexOf("json"))return JSON.stringify(a)}return a},f.prototype.http=function(a,b,c,d,e,f,g){var h=this.settings.deferredWrapper(),i=h.promise,j=this,k=this.helpers.getAPIServerUrl(b);c=c||{};var l;return l=this.settings.accessToken||!this.settings.autoSignin||this.helpers.isOAuthServerUrl(k)||b===this.settings.discoveryUrl?this.helpers.refPromise(this.settings.accessToken):this.client.getAccessToken(),l.then(function(){var l=j.helpers.isAuthoritiesServerUrl(k)?"sessionId":"access_token";if(j.settings.accessToken&&-1===k.indexOf(l+"=")){var m={};m[l]=j.settings.accessToken,k=j.helpers.appendQueryParameters(k,m)}null==g&&(g=j.settings.maxHttpRequestRetries);var n=j.settings.httpWrapper(a,k,c,j.transformData(d,c["Content-Type"]),e||{});j.helpers.extendHttpPromise(i,n),n.then(function(b){"GET"===a&&204===n.getStatusCode()&&(b={}),j.helpers.refreshAccessToken();var c=n.getResponseHeader("X-PROCESSING-TIME");c&&(j.totalProcessingTime+=parseInt(c,10)),f&&(b=f(b,n)),h.resolve(b)},function(){var k=n.getStatusCode();if(j.helpers.log("http failure",k,g,n.getAllResponseHeaders()),401===k&&j.helpers.eraseAccessToken(),"GET"===a&&k>=500&&g>0||429===k){var l=n.getResponseHeader("Retry-After"),m=l?parseInt(l,10):j.settings.defaultThrottleRetryAfter;j.settings.setTimeout(function(){n=j.http(a,b,c,d,e,f,g-1),j.helpers.extendHttpPromise(i,n),n.then(function(a){h.resolve(a)},function(){h.reject.apply(h,arguments)})},m)}else h.reject.apply(h,arguments)})},function(){h.reject.apply(h,arguments)}),i},b.exports=f},{"./utils":53}],52:[function(a,b,c){var d=a("./FamilySearch"),e=a("./utils"),f=e.maybe,c={};c.setMember=function(a,b){this[a]||(this[a]={}),b instanceof d.Person?(this[a].resource=b.$getPersonUrl(),delete this[a].resourceId):this.$helpers.isAbsoluteUrl(b)?(this[a].resource=b,delete this[a].resourceId):e.isString(b)?(this[a].resourceId=b,delete this[a].resource):this[a]=b},c.deleteMember=function(a,b){this.$deletedMembers||(this.$deletedMembers={}),this.$deletedMembers[a]=b,delete this[a]},c.setFacts=function(a,b,d){e.isArray(this[a])&&e.forEach(this[a],function(b){c.deleteFact.call(this,a,b,d)},this),this[a]=[],e.forEach(b,function(b){c.addFact.call(this,a,b)},this)},c.addFact=function(a,b){e.isArray(this[a])||(this[a]=[]),b instanceof d.Fact||(b=this.$client.createFact(b)),this[a].push(b)},c.deleteFact=function(a,b,c){b instanceof d.Fact||(b=e.find(this[a],{id:b}));var g=e.indexOf(this[a],b);if(g>=0){var h=this.$helpers.removeAccessToken(f(f(f(b).links).conclusion).href);h&&(this.$deletedFacts||(this.$deletedFacts={}),this.$deletedFacts[h]=c),this[a].splice(g,1)}},b.exports=c},{"./FamilySearch":1,"./utils":53}],53:[function(a,b,c){function d(a,b){for(var c in a)if(a.hasOwnProperty(c)&&b[c]!==a[c])return!1;return!0}function e(a){return c.isString(a)?(a=a.replace(/[:"]/g,"").trim(),a.indexOf(" ")>=0?'"'+a+'"':a):a}var c=b.exports;Object.create||(Object.create=function(){function a(){}return function(b){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return a.prototype=b,new a}}()),"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"==typeof"".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype}),c.isArray=function(a){return Array.isArray?Array.isArray(a):"[object Array]"==Object.prototype.toString.call(a)},c.isString=function(a){return"[object String]"==Object.prototype.toString.call(a)},c.isFunction=function(a){return"function"!=typeof/./?"function"==typeof a:"[object Function]"==Object.prototype.toString.call(a)},c.isObject=function(a){return a===Object(a)},c.isUndefined=function(a){return void 0===a};var f=c.forEach=function(a,b,c){if(null!=a)if(Array.prototype.forEach&&a.forEach===Array.prototype.forEach)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)==={})return}else for(var f in a)if(a.hasOwnProperty(f)&&b.call(c,a[f],f,a)==={})return};c.removeEmptyProperties=function(a){return f(a,function(b,c){(null==b||""===b)&&delete a[c]}),a},c.keys=Object.keys||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},c.filter=function(a,b,e){var g=[],h=c.isFunction(b);return f(a,function(a){(h?b.call(e,a):d(b,a))&&g.push(a)}),g},c.map=function(a,b,c){var d=[];return f(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d},c.contains=function(a,b){if(null==a)return!1;if(a.indexOf&&a.indexOf===Array.prototype.indexOf)return-1!==a.indexOf(b);var c=!1;return f(a,function(a){a===b&&(c=!0)}),c},c.indexOf=function(a,b){if(Array.prototype.indexOf===a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},c.uniq=function(a){var b=[];return f(a,function(a){c.contains(b,a)||b.push(a)}),b},c.find=function(a,b,e){var f,g=c.isFunction(b);if(a)for(var h=0,i=a.length;i>h;h++){var j=a[h];if(g?b.call(e,j):d(b,j)){f=j;break}}return f},c.findIndex=function(a,b,e){var f=-1,g=c.isFunction(b);if(a)for(var h=0,i=a.length;i>h;h++){var j=a[h];if(g?b.call(e,j):d(b,j)){f=h;break}}return f},c.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)a[c]&&(b=[a[c].apply(this,b)]);return b[0]}},c.flatten=function(a){var b=[];return f(a,function(a){c.isArray(a)&&Array.prototype.push.apply(b,a)}),b},c.flatMap=c.compose(c.flatten,c.map),c.union=function(){return c.uniq(c.flatten(arguments))},c.findOrFirst=function(a,b){if(!c.isUndefined(a)){var d=c.find(a,b);return c.isUndefined(d)?a[0]:d}return void 0},c.extend=function(a){return a=a||{},f(Array.prototype.slice.call(arguments,1),function(b){b&&f(b,function(b,c){a[c]=b})}),a},c.partialRight=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(this,Array.prototype.slice.call(arguments).concat(b))}},c.partial=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(this,b.concat(Array.prototype.slice.call(arguments)))}},c.maybe=function(a){return null!=a?a:{}},c.clonePartial=function(a,b){var d;if(null==a||"object"!=typeof a)return a;if(a instanceof Date)return d=new Date,d.setTime(a.getTime()),d;if(a instanceof Array){d=[];for(var e=0,f=a.length;f>e;e++)(!b||b(e))&&d.push(c.clonePartial(a[e],b));return d}if(a instanceof Object){d=Object.create(Object.getPrototypeOf(a));for(var g in a)!a.hasOwnProperty(g)||b&&!b(g)||(d[g]=c.clonePartial(a[g],b));return d}throw new Error("Unable to copy obj")},c.objectExtender=function(a,b){return function(d){return d&&(b?f(b(d),function(b){c.extend(b,c.isFunction(a)?a(d,b):a)}):c.extend(d,c.isFunction(a)?a(d,d):a)),d}},c.appFieldRejector=function(a){return!(c.isString(a)&&"_"===a.charAt(0))},c.deletePropertiesPartial=function(a,b){for(var c in a)!a.hasOwnProperty(c)||b&&!b(c)||delete a[c]},c.wrapFunctions=function(a,b,c){return f(c,function(c){a[c]=function(){return b[c].apply(b,arguments)}}),a};var g={start:!0,count:!0,context:!0};c.searchParamsFilter=function(a){return c.map(c.filter(c.keys(a),function(a){return!g[a]}),function(b){return b+":"+e(a[b])}).join(" ")}},{}]},{},[1])(1)});