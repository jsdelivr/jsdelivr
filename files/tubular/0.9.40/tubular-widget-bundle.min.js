(function(){"use strict";angular.module("tubular-widget.directives",["tubular.services"]).directive("tbWidgetContainer",[function(){return{template:'<div class="container-fluid"><ng-transclude><\/ng-transclude><\/div>',restrict:"E",replace:!0,transclude:!0,scope:{name:"@?containerName",fixedWidgets:"=?fixedWidgets"},controller:["$scope","$element","localStorageService",function(n,t,i){n.name=n.name||"tbcontainer";n.fixedWidgets=n.fixedWidgets||!1;n.widgets=[];n.settings=i.get(n.name+"_data");n.redraw=function(){var i=t.children("div.row");angular.forEach(n.widgetsAsRows,function(n){if(!n[0].isHidden){var i=$('<div class="row"><\/div>');t.append(i);angular.forEach(n,function(n){i.append(n.content)})}});i.remove()};n.divideIntoRows=function(){for(var t=n.widgets.slice(0),i=[];t.length;)t[0].fullWidth||t[0].isHidden?(t[0].row=i.length,i.push(t.splice(0,1))):t[1]&&t[1].fullWidth?(t[1].row=i.length,i.push(t.splice(1,1))):(t[0].row=i.length,t[1]&&(t[1].row=i.length),i.push(t.splice(0,2)));return n.widgetsAsRows=i};n.setWidgetsCapabilities=function(){angular.forEach(n.widgets,function(n){n.canUp=n.canDown=n.canLeft=n.canRight=!0});angular.forEach(n.widgetsAsRows[0],function(n){n.canUp=!1});angular.forEach(n.widgetsAsRows[n.widgetsAsRows.length-1],function(n){n.canDown=!1});angular.forEach(n.widgetsAsRows,function(n){n.length==1?(n[0].canRight=!1,n[0].canLeft=!1):(n[0].canRight=!0,n[0].canLeft=!1,n[1].canRight=!1,n[1].canLeft=!0)})};n.move=function(t,i){var r=t.row,u=i=="up"?r-1:i=="down"?r+1:r,e=n.widgetsAsRows[r],s=n.widgetsAsRows[u],o,f;switch(i){case"up":case"down":e[0].fullWidth||s[0].fullWidth?(f=n.widgetsAsRows[r],n.widgetsAsRows[r]=n.widgetsAsRows[u],n.widgetsAsRows[u]=f):t.canLeft?(o=n.widgetsAsRows[u].length==2?1:0,f=n.widgetsAsRows[r][1],n.widgetsAsRows[r][1]=n.widgetsAsRows[u][o],n.widgetsAsRows[u][o]=f):(f=n.widgetsAsRows[r][0],n.widgetsAsRows[r][0]=n.widgetsAsRows[u][0],n.widgetsAsRows[u][0]=f);break;case"left":case"right":f=e[0];e[0]=e[1];e[1]=f}n.widgets=[].concat.apply([],n.widgetsAsRows);angular.forEach(n.widgets,function(n,t){n.position=t});n.recalculate()};n.recalculate=function(){n.divideIntoRows();n.setWidgetsCapabilities();n.saveSettings()};n.saveSettings=function(){var t={};angular.forEach(n.widgets,function(n){t[n.name]={position:n.position,fullWidth:n.fullWidth,collapsed:n.collapsed}});i.set(n.name+"_data",t)}}],compile:function(){return{post:function(n){n.settings&&(angular.forEach(n.widgets,function(t,i){var r=n.settings[t.name];(t.position=i,r)&&(t.fullWidth=r.fullWidth,t.collapsed=r.collapsed,t.position=r.position)}),n.widgets.sort(function(n,t){return n.position>t.position}));n.recalculate();n.redraw()}}}}}]).directive("tbWidget",[function(){return{template:'<div class="widget-panel" ng-hide="isHidden"><div class="tubular-overlay maximized" ng-show="maximized"><\/div><div ng-class="{ \'col-md-6\': !fullWidth, \'col-md-12\': fullWidth, \'maximized\': maximized}"><div class="panel panel-default"><div class="panel-heading"><span>{{title}}<\/span> <div class="pull-right"><button ng-hide="container.fixedWidgets || maximized" ng-disabled="!canUp" ng-click="move(\'up\')" class="btn btn-default btn-xs"  title="{{\'UI_MOVEUP\'| translate}}"><span><i class="glyphicon glyphicon-arrow-up"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || maximized" ng-disabled="!canDown" ng-click="move(\'down\')" class="btn btn-default btn-xs"  title="{{\'UI_MOVEDOWN\'| translate}}"><span><i class="glyphicon glyphicon-arrow-down"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || maximized" ng-disabled="!canRight" ng-click="move(\'left\')" class="btn btn-default btn-xs"  title="{{\'UI_MOVERIGHT\'| translate}}"><span><i class="glyphicon glyphicon-arrow-right"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || maximized" ng-disabled="!canLeft" ng-click="move(\'right\')" class="btn btn-default btn-xs"  title="{{\'UI_MOVELEFT\'| translate}}"><span><i class="glyphicon glyphicon-arrow-left"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || fullWidth || maximized" ng-click="setWidth(2)" class="btn btn-default btn-xs" title="{{\'UI_TWOCOLS\'| translate}}"><span><i class="glyphicon glyphicon-resize-horizontal"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || !fullWidth || maximized" ng-click="setWidth(1)" class="btn btn-default btn-xs" title="{{\'UI_ONECOL\'| translate}}"><span><i class="glyphicon glyphicon-resize-horizontal"><\/i><\/span><\/button><button ng-hide="collapsed || maximized" ng-click="collapsed = true" class="btn btn-default btn-xs" title="{{\'UI_COLLAPSE\'| translate}}"><span><i class="glyphicon glyphicon-menu-up"><\/i><\/span><\/button><button ng-hide="!collapsed || maximized" ng-click="collapsed = false" class="btn btn-default btn-xs" title="{{\'UI_EXPAND\'| translate}}"><span><i class="glyphicon glyphicon-menu-down"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || maximized" ng-click="maximized = true;" class="btn btn-default btn-xs" title="{{\'UI_MAXIMIZE\'| translate}}"><span><i class="glyphicon glyphicon-resize-full"><\/i><\/span><\/button><button ng-hide="container.fixedWidgets || !maximized" ng-click="maximized = false" class="btn btn-default btn-xs" title="{{\'UI_RESTORE\'| translate}}"><span><i class="glyphicon glyphicon-resize-small"><\/i><\/span><\/button><\/div><\/div><div class="panel-body" ng-hide="collapsed && !maximized"><ng-transclude><\/ng-transclude><\/div><div class="panel-body" ng-show="collapsed && !maximized">{{summary}}<\/div><\/div>',restrict:"E",replace:!0,transclude:!0,scope:{title:"@",name:"@?widgetName",summary:"=?widgetSummary",isHidden:"=?isHidden",fullWidth:"=?fullWidth"},controller:function(n,t){n.name=n.name||"tbwidget";n.fullWidth=n.fullWidth||!1;n.isHidden=n.isHidden||!1;n.collapsed=!1;n.maximized=!1;n.position=0;n.content=t;n.container=n.$parent.$parent;n.canUp=!1;n.canDown=!1;n.canLeft=!1;n.canRight=!1;n.container.widgets.push(n);n.setWidth=function(t){n.fullWidth=t==2;n.container.recalculate();n.container.redraw()};n.$watch("collapsed",function(){n.container.saveSettings()});n.move=function(t){n.container.move(this,t);n.container.redraw()}}}}]).directive("tbWidgetActions",["$compile",function(){return{template:'<div class="pull-right"><ng-transclude><\/ng-transclude><\/div>',restrict:"E",replace:!0,transclude:!0,require:"^tbWidget",controller:function(){},link:function(n,t){var i=t.parents(".panel").find(".panel-heading");i.append(t)}}}])})();