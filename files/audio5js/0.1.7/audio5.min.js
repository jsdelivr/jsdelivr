/*! audio5 2013-03-14 */
(function(i,t,e){"use strict";"undefined"!=typeof module&&module.exports?module.exports=e(t,i):"function"==typeof define&&define.amd?define(function(){return e(t,i)}):i[t]=e(t,i)})(window,"Audio5js",function(i,t){"use strict";function e(i){this.message=i}function s(i){var t,e={};for(t in i)e[t]="object"==typeof i[t]?s(i[t]):i[t];return e}var n=t.ActiveXObject;e.prototype=Error();var a=function(i,t){var e,n=s(t);for(e in n)n.hasOwnProperty(e)&&(i[e]=n[e]);return i},o=function(i,t){return a(i.prototype,t)},r={on:function(i,t,e){void 0===this.channels&&(this.channels={}),this.channels[i]=this.channels[i]||[],this.channels[i].push({fn:t,ctx:e})},off:function(i,t){if(void 0!==this.channels[i]){var e,s;for(e=0,s=this.channels[i].length;s>e;e++){var n=this.channels[i][e].fn;if(n===t){this.channels[i].splice(e,1);break}}}},trigger:function(i){if(this.channels&&this.channels.hasOwnProperty(i)){var t,e,s=Array.prototype.slice.call(arguments,1);for(t=0,e=this.channels[i].length;e>t;t++){var n=this.channels[i][t];"function"==typeof n.fn&&n.fn.apply(n.ctx,s)}}}},h={flash_embed_code:function(){var t,e='<param name="movie" value="$2?playerInstance=window.'+i+"_flash.instances['$1']&datetime=$3\"/>"+'<param name="wmode" value="transparent"/>'+'<param name="allowscriptaccess" value="always" />'+"</object>";return t=n?'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" id="$1">':'<object type="application/x-shockwave-flash" data="$2?playerInstance=window.'+i+'_flash.instances[\'$1\']&datetime=$3" width="1" height="1" id="$1" >',t+e}(),can_play:function(i){var t,e=document.createElement("audio");switch(i){case"mp3":t='audio/mpeg; codecs="mp3"';break;case"vorbis":t='audio/ogg; codecs="vorbis"';break;case"opus":t='audio/ogg; codecs="opus"';break;case"webm":t='audio/webm; codecs="vorbis"';break;case"mp4":t='audio/mp4; codecs="mp4a.40.5"';break;case"wav":t='audio/wav; codecs="1"'}if(void 0===t)throw Error("Unspecified Audio Mime Type");return!!e.canPlayType&&""!==e.canPlayType(t)},has_flash:function(){var i=!1;if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"])i=!0;else if(navigator.mimeTypes&&navigator.mimeTypes.length){var t=navigator.mimeTypes["application/x-shockwave-flash"];i=t&&t.enabledPlugin}else try{var e=new n("ShockwaveFlash.ShockwaveFlash");i="object"==typeof e}catch(s){}return i}(),embedFlash:function(e,s){var n=document.createElement("div");if(n.style.position="absolute",n.style.width="1px",n.style.height="1px",n.style.top="1px",document.body.appendChild(n),"object"==typeof t.swfobject){var a={playerInstance:"window."+i+'_flash.instances["'+s+'"]'},o={allowscriptaccess:"always",wmode:"transparent"};n.innerHTML='<div id="'+s+'"></div>',swfobject.embedSWF(e+"?ts="+((new Date).getTime()+Math.random()),s,"1","1","9.0.0",null,a,o)}else{var r=this.flash_embed_code.replace(/\$1/g,s);r=r.replace(/\$2/g,e),r=r.replace(/\$3/g,(new Date).getTime()+Math.random()),n.innerHTML=r}return document.getElementById(s)},formatTime:function(i){var t,e=parseInt(i/3600,10)%24,s=parseInt(i/60,10)%60,n=parseInt(i%60,10),a=(10>s?"0"+s:s)+":"+(10>n?"0"+n:n);return t=e>0?(10>e?"0"+e:e)+":"+a:a}};h.use_flash=h.can_play("mp3");var d,u,l,c={playing:!1,vol:1,duration:0,position:0,load_percent:0,seekable:null,ready:null},p=t[i+"_flash"]=t[i+"_flash"]||{instances:{},count:0};u=function(){if(h.use_flash&&!h.has_flash)throw Error("Flash Plugin Missing")},u.prototype={init:function(t){p.count+=1,this.id=i+p.count,p.instances[this.id]=this,this.embed(t)},embed:function(i){h.embedFlash(i,this.id)},eiReady:function(){this.audio=document.getElementById(this.id),this.trigger("ready")},eiTimeUpdate:function(i,t,e){this.position=i,this.duration=t,this.seekable=e,this.trigger("timeupdate",i,this.seekable?t:null)},eiProgress:function(i){this.load_percent=i,this.trigger("progress",i)},eiLoadError:function(i){this.trigger("error",i)},eiPlay:function(){this.playing=!0,this.trigger("play")},eiPause:function(){this.playing=!1,this.trigger("pause")},eiEnded:function(){this.playing=!1,this.trigger("ended")},eiCanPlay:function(){this.trigger("canplay")},reset:function(){this.seekable=!1,this.duration=0,this.position=0,this.load_percent=0},load:function(i){this.reset(),this.audio.load(i)},play:function(){this.audio.pplay()},pause:function(){this.audio.ppause()},volume:function(i){return void 0===i||isNaN(parseInt(i,10))?this.vol:(this.audio.setVolume(i),this.vol=i,void 0)},seek:function(i){try{this.audio.seekTo(i),this.position=i}catch(t){}}},o(u,r),o(u,c),l=function(){},l.prototype={init:function(){this.trigger("ready")},createAudio:function(){this.audio=new Audio,this.audio.autoplay=!1,this.audio.preload="auto",this.audio.autobuffer=!0,this.bindEvents()},destroyAudio:function(){this.audio&&(this.unbindEvents(),delete this.audio)},bindEvents:function(){this.audio.addEventListener("timeupdate",this.onTimeUpdate.bind(this)),this.audio.addEventListener("play",this.onPlay.bind(this)),this.audio.addEventListener("pause",this.onPause.bind(this)),this.audio.addEventListener("ended",this.onEnded.bind(this)),this.audio.addEventListener("canplay",this.onLoad.bind(this)),this.audio.addEventListener("error",this.onError.bind(this))},unbindEvents:function(){this.audio.removeEventListener("timeupdate",this.onTimeUpdate.bind(this)),this.audio.removeEventListener("play",this.onPlay.bind(this)),this.audio.removeEventListener("pause",this.onPause.bind(this)),this.audio.removeEventListener("ended",this.onEnded.bind(this)),this.audio.removeEventListener("canplay",this.onLoad.bind(this)),this.audio.removeEventListener("error",this.onError.bind(this))},onPlay:function(){this.playing=!0,this.trigger("play")},onPause:function(){this.playing=!1,this.trigger("pause")},onEnded:function(){this.playing=!1,this.trigger("ended")},onTimeUpdate:function(){null!==this.audio.buffered&&this.audio.buffered.length&&this.playing&&(this.position=this.audio.currentTime,this.duration=1/0===this.audio.duration?null:this.audio.duration,this.trigger("timeupdate",this.position,this.duration))},onLoad:function(){this.seekable=this.audio.seekable&&this.audio.seekable.length>0,this.seekable&&(this.timer=setInterval(this.onProgress.bind(this),250)),this.trigger("canplay")},onProgress:function(){null!==this.audio.buffered&&this.audio.buffered.length&&(this.load_percent=parseInt(100*(this.audio.buffered.end(this.audio.buffered.length-1)/this.audio.duration),10),this.trigger("progress",this.load_percent),this.load_percent>=100&&this.clearLoadProgress())},onError:function(i){this.trigger("error",i)},clearLoadProgress:function(){void 0!==this.timer&&(clearInterval(this.timer),delete this.timer)},reset:function(){this.clearLoadProgress(),this.seekable=!1,this.duration=0,this.position=0,this.load_percent=0},load:function(i){this.reset(),this.destroyAudio(),this.createAudio(),this.audio.setAttribute("src",i),this.audio.load()},play:function(){this.audio.play()},pause:function(){this.audio.pause()},volume:function(i){if(void 0===i||isNaN(parseInt(i,10)))return this.vol;var t=0>i?0:Math.min(1,i);this.audio.volume=t,this.vol=t},seek:function(i){var t=this.playing;this.position=i,this.audio.currentTime=i,t?this.play():null!==this.audio.buffered&&this.audio.buffered.length&&this.trigger("timeupdate",this.position,this.duration)}},o(l,r),o(l,c);var f={swf_path:"/swf/audiojs.swf",throw_errors:!0,format_time:!0,codecs:["mp3"]};return d=function(i){i=i||{};var t;for(t in f)f.hasOwnProperty(t)&&!i.hasOwnProperty(t)&&(i[t]=f[t]);this.init(i)},d.can_play=function(i){return h.can_play(i)},d.prototype={init:function(i){this.ready=!1,this.settings=i,this.audio=this.getPlayer(),this.bindAudioEvents(),this.settings.use_flash?this.audio.init(i.swf_path):this.audio.init()},getPlayer:function(){var i,t,e;for(i=0,t=this.settings.codecs.length;t>i;i++){var s=this.settings.codecs[i];if(d.can_play(s)){e=new l,this.settings.use_flash=!1,this.settings.player={engine:"html",codec:s};break}}return void 0===e&&(this.settings.use_flash=!d.can_play("mp3"),e=this.settings.use_flash?new u:new l,this.settings.player={engine:this.settings.use_flash?"flash":"html",codec:"mp3"}),e},bindAudioEvents:function(){this.audio.on("ready",this.onReady,this),this.audio.on("play",this.onPlay,this),this.audio.on("pause",this.onPause,this),this.audio.on("ended",this.onEnded,this),this.audio.on("canplay",this.onCanPlay,this),this.audio.on("timeupdate",this.onTimeUpdate,this),this.audio.on("progress",this.onProgress,this),this.audio.on("error",this.onError,this)},load:function(i){var t=function(i){this.audio.load(i),this.trigger("load")}.bind(this,i);this.ready?t():this.on("ready",t)},play:function(){this.playing||this.audio.play()},pause:function(){this.playing&&this.audio.pause()},playPause:function(){this[this.playing?"pause":"play"]()},volume:function(i){return void 0===i||isNaN(parseInt(i,10))?this.vol:(this.audio.volume(i),this.vol=i,void 0)},seek:function(i){this.audio.seek(i),this.position=i},onReady:function(){this.ready=!0,"function"==typeof this.settings.ready&&this.settings.ready.call(this,this.settings.player),this.trigger("ready")},onPlay:function(){this.playing=!0,this.trigger("play")},onPause:function(){this.playing=!1,this.trigger("pause")},onEnded:function(){this.playing=!1,this.trigger("ended")},onError:function(){var i=new e("Audio Error. Failed to Load Audio");if(this.settings.throw_errors)throw i;this.trigger("error",i)},onCanPlay:function(){this.trigger("canplay")},onTimeUpdate:function(i,t){this.position=this.settings.format_time?h.formatTime(i):i,this.duration!==t&&(this.duration=this.settings.format_time&&null!==t?h.formatTime(t):t),this.trigger("timeupdate",this.position,this.duration)},onProgress:function(i){this.load_percent=i,this.trigger("progress",i)}},o(d,r),o(d,c),d});