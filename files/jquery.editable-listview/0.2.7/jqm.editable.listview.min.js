/*!
 * jQuery Mobile Editable Listview Plugin
 * https://github.com/baig/jquerymobile-editablelistview
 *
 * Copyright 2014 (c) Wasif Hasan Baig
 *
 * Released under the MIT license
 * https://github.com/baig/jquerymobile-editablelistview/blob/master/LICENSE.txt
 */
!function(e){"use strict";e.widget("mobile.listview",e.mobile.listview,{_created:!1,_origDom:null,_editMode:!1,_counter:1,_dataItemName:"item",_itemNames:[],_evt:null,_clickHandler:null,options:{editable:!1,editableType:"simple",editableForm:"",title:"View list items",emptyTitle:"No items to view",editLabel:"Edit",addLabel:"Add",doneLabel:"Done",addIcon:"plus",editIcon:"edit",doneIcon:"check",buttonTheme:"a",buttonCorner:!0,buttonShadow:!0,itemIcon:!1,collapsed:!1,expandedIcon:"carat-d",collapsedIcon:"carat-r"},_beforeListviewRefresh:function(){if(this.options.editable){var t,i,n,l=this.element,a=this.options,o=this._origDom,s=this._dataItemName,d=this._counter,c=this._evt,r=l.find("li"),h=this._$markup;if(this._created||l.find("li").not("li.ui-editable-temp").length!==(null===o?-1:o.find("li").length)&&(o=l.clone(),e.each(o.children("li"),function(t,i){e(i).attr("data-"+s,d),d++}),this._counter=d,o.removeClass("ui-listview ui-shadow ui-corner-all ui-listview-inset ui-group-theme-"+this.options.theme).find("li").removeClass("ui-li-static ui-body-inherit ui-first-child ui-last-child ui-li-has-alt").end().find("a").removeClass("ui-link").end(),this._origDom=o),!this._created){var p=this._wrapCollapsible();if(t={wrapper:p,header:p.find("h1"),button:p.find("h1 + a, h1 + button"),content:p.find("div.ui-collapsible-content")},"complex"===this.options.editableType){var u=t.content.find("li:first-child").find("[data-item-name]"),m=this._itemNames;e.each(u,function(t,i){m.push(e(i).data("item-name"))})}e.extend(this,{_ui:t}),t.header.addClass("ui-btn-icon-left"),c=this._evt=e._data(t.header.parent()[0],"events"),this._clickHandler=c.click[0].handler,this._attachEditEventButtons(),this._created=!0}this._editMode?(t=this._ui,i=o.clone(),n=i.find("li"),0===i.find("li.ui-editable-temp").length&&(0===i.find("a").length&&n.wrapInner("<a></a>"),n.append('<a class="ui-editable-btn-del">Delete</a>'),this.option("splitIcon","minus"),"complex"===a.editableType&&i.prepend(e("<li>"+t.form[0].innerHTML+"</li>")),"simple"===a.editableType&&i.prepend(h.listTextInput)),r.remove(),l.append(i.find("li")),c.click[0].handler=e.noop):(c.click[0].handler=this._clickHandler,r.remove(),l.append(a.itemIcon?o.clone().find("li"):o.clone().find("li").attr("data-icon","false"))),this._updateHeader()}},_afterListviewRefresh:function(){this.options.editable&&this._attachDetachEventHandlers()},_init:function(){if(this.options.editable){var e=this.element,t=this.options,i=this._ui;if(!i.form&&"complex"===this.options.editableType){if(0===t.editableForm.length)throw new Error("Form not specified for the Complex Editable Listview type.");var n=e.closest(':jqmData(role="page")').find("#"+t.editableForm);if(!n.is("form, div")||!n.attr("data-editable-form"))throw new Error('Reference Error: the form\'s id should match the "data-editable-form" attribute on ul and the form element itself should have data-editable-form="true" attribute.');i.form=n.detach()}}},_wrapCollapsible:function(){{var t=this.element,i=this.options;this._isListEmpty()}return t.wrap('<div data-role="collapsible"></div>'),t.parent().prepend(this._$markup.header(i)),t.parents(e.mobile.collapsible.initSelector).not(e.mobile.page.prototype.keepNativeSelector()).collapsible({collapsed:i.collapsed,expandedIcon:i.expandedIcon,collapsedIcon:i.collapsedIcon}),t.parent().parent()},_attachEditEventButtons:function(){this._isListEmpty()&&this._ui.header.off("click"),this._on(this.element.parent().parent().find(".ui-collapsible-heading a, .ui-collapsible-heading button"),{click:"_onEditButtonTapped"})},_onEditButtonTapped:function(e){var t=this._editMode=!this._editMode,i=this.element.parents(":jqmData(role='collapsible')");i.collapsible(t?"expand":"collapse"),this.refresh(),e.preventDefault(),e.stopPropagation(),t||this._triggerListChange(e)},_updateHeader:function(){var e=this._ui,t=this.options,i=this._isListEmpty();e.header.text(i?t.emptyTitle:t.title),e.button.removeClass("ui-icon-minus ui-icon-"+t.doneIcon+" ui-icon-"+t.addIcon+" ui-icon-"+t.editIcon).addClass("ui-icon-"+(this._editMode?t.doneIcon:i?t.addIcon:t.editIcon)).text(this._editMode?t.doneLabel:i?t.addLabel:t.editLabel)},_triggerListChange:function(e){var t=this.items(),i=this.length();this._trigger("change",e,{items:t,length:i})},_attachDetachEventHandlers:function(){this._enableInsertListItemEvent(),this._enableListItemDeleteEvent()},_enableInsertListItemEvent:function(){var e,t,i,n=this.options,l=n.editableType,a=this._ui.content;this._editMode&&(e=a.find("simple"===l?"li.ui-editable-temp a#item-add":"li:first-child [data-add-button='true']"),t="complex"===l?a.find("li:first-child [data-clear-button='true']"):null,i="simple"===l?a.find("input[type=text]"):null,this._on(e,{tap:"_insertListItem"}),null!==t&&this._on(t,{tap:"_clearTextFields"}),null!==i&&this._on(i,{keyup:"_insertListItem"}))},_clearTextFields:function(t){var i=e(t.target).parents("li").find("[data-item-name]");e.each(i,function(t,i){e(i).val("")})},_enableListItemDeleteEvent:function(){this._editMode?this._on(this._ui.content.find("a.ui-editable-btn-del"),{click:"_deleteListItem"}):this._off(this._ui.content.find("a.ui-editable-btn-del"),"click")},_insertListItem:function(t){if(t.preventDefault(),"tap"===t.type||t.keyCode===e.mobile.keyCode.ENTER){if("complex"===this.options.editableType){var i="",n=!0,l=e(t.target).parents("li").find("[data-item-name]");if(e.each(l,function(t,l){var a=e(l),o=a.data("item-template"),s=a.val();s||(n=!1),i+=o.replace(/%%/,s)}),!n)return;i=e("<li><a>"+i+"</a></li>"),i.attr("data-"+this._dataItemName,this._counter),this._counter++,this._origDom.prepend(i),this.refresh()}if("simple"===this.options.editableType){var a=e(t.target),o="keyup"===t.type?a:a.prev().find("input"),s=o.val();if(s){o.val("");var i=this._isListEmpty()?e("<li></li>"):this._origDom.find("li").first().clone();i.attr("data-"+this._dataItemName,this._counter),this._counter++,0===i.children().length?i.text(s):i.children("a").text(s),this._origDom.prepend(i),this.refresh()}}}},_deleteListItem:function(t){var i=e(t.currentTarget).parent(),n=i.data(this._dataItemName);this._origDom.find("li[data-"+this._dataItemName+'="'+n+'"]').remove(),i.remove(),this._updateHeader(),t.preventDefault(),t.stopPropagation()},_isListEmpty:function(){return 0===this.element.find("li").not("li.ui-editable-temp").length?!0:!1},_$markup:{listTextInput:"<li class='ui-editable-temp ui-btn' style='padding: 0.3em 0.8em;'><div class='ui-editable-flex'><div style='background-color: white; padding: 0;' class='ui-editable-flex-item-left ui-editable-border-left ui-input-text ui-btn ui-shadow-inset'><input type='text'></div><a id='item-add' style='height: auto' class='ui-editable-flex-item-right ui-editable-border-right ui-btn ui-shadow ui-btn-icon-notext ui-icon-plus'>Add</a></div></li>",header:function(e){return"<div data-role='header'><h1>List Items</h1><button class='ui-btn ui-mini ui-btn-inline ui-btn-right ui-btn-icon-right ui-icon-edit ui-btn-"+e.buttonTheme+" "+(e.buttonCorner?"ui-corner-all ":"")+(e.buttonShadow?"ui-shadow ":"")+"'>Edit</button></div>"}},length:function(){return this.element.find("li").length},items:function(){var t=[],i=this._itemNames;return"simple"===this.options.editableType&&this.element.find("li").each(function(e,i){t.push(i.textContent)}),"complex"===this.options.editableType&&this.element.find("a").each(function(n,l){var a={};e(l).children().each(function(t,n){a[i[t]]=e(n).text()}),t.push(a)}),t},widget:function(){return this._ui.wrapper}})}(jQuery),function(e,t){var i=/([A-Z])/g,n=function(e){return"ui-btn-icon-"+(null===e?"left":e)};e.widget("mobile.collapsible",{options:{enhanced:!1,expandCueText:null,collapseCueText:null,collapsed:!0,heading:"h1,h2,h3,h4,h5,h6,legend,:jqmData(role='header')",collapsedIcon:null,expandedIcon:null,iconpos:null,theme:null,contentTheme:null,inset:null,corners:null,mini:null},_create:function(){var t=this.element,i={accordion:t.closest(":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')"+(e.mobile.collapsibleset?", :mobile-collapsibleset":"")).addClass("ui-collapsible-set")};this._ui=i,this._renderedOptions=this._getOptions(this.options),e.each(this._childWidgets,e.proxy(function(t,i){e.mobile[i]&&this.element.find(e.mobile[i].initSelector).not(e.mobile.page.prototype.keepNativeSelector())[i]()},this)),this.options.enhanced?(i.heading=e(".ui-collapsible-heading",this.element[0]),i.content=i.heading.next(),i.anchor=e("a",i.heading[0]).first(),i.status=i.anchor.children(".ui-collapsible-heading-status")):this._enhance(t,i),this._on(i.heading,{tap:function(){i.heading.find("a").first().addClass(e.mobile.activeBtnClass)},click:function(t){var n=e(t.target);(n.hasClass("ui-collapsible-heading")||n.hasClass("ui-collapsible-heading-toggle"))&&this._handleExpandCollapse(!i.heading.hasClass("ui-collapsible-heading-collapsed")),t.preventDefault(),t.stopPropagation()}})},_childWidgets:["toolbar"],_getOptions:function(t){var n,l=this._ui.accordion,a=this._ui.accordionWidget;t=e.extend({},t),l.length&&!a&&(this._ui.accordionWidget=a=l.data("mobile-collapsibleset"));for(n in t)t[n]=null!=t[n]?t[n]:a?a.options[n]:l.length?e.mobile.getAttribute(l[0],n.replace(i,"-$1").toLowerCase()):null,null==t[n]&&(t[n]=e.mobile.collapsible.defaults[n]);return t},_themeClassFromOption:function(e,t){return t?"none"===t?"":e+t:""},_enhance:function(t,i){var l,a=this._renderedOptions,o=this._themeClassFromOption("ui-body-",a.contentTheme);return t.addClass("ui-collapsible "+(a.inset?"ui-collapsible-inset ":"")+(a.inset&&a.corners?"ui-corner-all ":"")+(o?"ui-collapsible-themed-content ":"")),i.originalHeading=t.children(this.options.heading).first(),i.content=t.wrapInner("<div class='ui-collapsible-content "+o+"'></div>").children(".ui-collapsible-content"),i.heading=i.originalHeading,i.heading.is("legend")&&(i.heading=e("<div role='heading'>"+i.heading.html()+"</div>"),i.placeholder=e("<div><!-- placeholder for legend --></div>").insertBefore(i.originalHeading),i.originalHeading.remove()),l=a.collapsed?a.collapsedIcon?"ui-icon-"+a.collapsedIcon:"":a.expandedIcon?"ui-icon-"+a.expandedIcon:"",i.status=e("<span class='ui-collapsible-heading-status'></span>"),i.anchor=i.heading.detach().addClass("ui-collapsible-heading").append(i.status).wrapInner(i.heading.is(":jqmData(role='header')")?"":"<a href='#'></a>").find(i.heading.is(":jqmData(role='header')")?"h1,h2,h3,h4,h5,h6":"a").first().addClass("ui-collapsible-heading-toggle"+(i.heading.is(":jqmData(role='header')")?"":" ui-btn "+(l?l+" ":"")+(l?n(a.iconpos)+" ":"")+this._themeClassFromOption("ui-btn-",a.theme)+" "+(a.mini?"ui-mini ":""))),i.heading.insertBefore(i.content),this._handleExpandCollapse(this.options.collapsed),i},refresh:function(){this._applyOptions(this.options),this._renderedOptions=this._getOptions(this.options)},_applyOptions:function(e){var i,l,a,o,s,d=this.element,c=this._renderedOptions,r=this._ui,h=r.anchor,p=r.status,u=this._getOptions(e);e.collapsed!==t&&this._handleExpandCollapse(e.collapsed),i=d.hasClass("ui-collapsible-collapsed"),i?u.expandCueText!==t&&p.text(u.expandCueText):u.collapseCueText!==t&&p.text(u.collapseCueText),s=u.collapsedIcon!==t?u.collapsedIcon!==!1:c.collapsedIcon!==!1,(u.iconpos!==t||u.collapsedIcon!==t||u.expandedIcon!==t)&&(h.removeClass([n(c.iconpos)].concat(c.expandedIcon?["ui-icon-"+c.expandedIcon]:[]).concat(c.collapsedIcon?["ui-icon-"+c.collapsedIcon]:[]).join(" ")),s&&h.addClass([n(u.iconpos!==t?u.iconpos:c.iconpos)].concat(i?["ui-icon-"+(u.collapsedIcon!==t?u.collapsedIcon:c.collapsedIcon)]:["ui-icon-"+(u.expandedIcon!==t?u.expandedIcon:c.expandedIcon)]).join(" "))),u.theme!==t&&(a=this._themeClassFromOption("ui-btn-",c.theme),l=this._themeClassFromOption("ui-btn-",u.theme),h.removeClass(a).addClass(l)),u.contentTheme!==t&&(a=this._themeClassFromOption("ui-body-",c.contentTheme),l=this._themeClassFromOption("ui-body-",u.contentTheme),r.content.removeClass(a).addClass(l)),u.inset!==t&&(d.toggleClass("ui-collapsible-inset",u.inset),o=!(!u.inset||!u.corners&&!c.corners)),u.corners!==t&&(o=!(!u.corners||!u.inset&&!c.inset)),o!==t&&d.toggleClass("ui-corner-all",o),u.mini!==t&&h.toggleClass("ui-mini",u.mini)},_setOptions:function(e){this._applyOptions(e),this._super(e),this._renderedOptions=this._getOptions(this.options)},_handleExpandCollapse:function(t){var i=this._renderedOptions,n=this._ui;n.status.text(t?i.expandCueText:i.collapseCueText),n.heading.toggleClass("ui-collapsible-heading-collapsed",t).find(".ui-collapsible-heading-toggle").toggleClass("ui-icon-"+i.expandedIcon,!t).toggleClass("ui-icon-"+i.collapsedIcon,t||i.expandedIcon===i.collapsedIcon).removeClass(e.mobile.activeBtnClass),this.element.toggleClass("ui-collapsible-collapsed",t),n.content.toggleClass("ui-collapsible-content-collapsed",t).attr("aria-hidden",t).trigger("updatelayout"),this.options.collapsed=t,this._trigger(t?"collapse":"expand")},expand:function(){this._handleExpandCollapse(!1)},collapse:function(){this._handleExpandCollapse(!0)},_destroy:function(){var e=this._ui,t=this.options;t.enhanced||(e.placeholder?(e.originalHeading.insertBefore(e.placeholder),e.placeholder.remove(),e.heading.remove()):(e.status.remove(),e.heading.removeClass("ui-collapsible-heading ui-collapsible-heading-collapsed").children().contents().unwrap()),e.anchor.contents().unwrap(),e.content.contents().unwrap(),this.element.removeClass("ui-collapsible ui-collapsible-collapsed ui-collapsible-themed-content ui-collapsible-inset ui-corner-all"))}}),e.mobile.collapsible.defaults={expandCueText:" click to expand contents",collapseCueText:" click to collapse contents",collapsedIcon:"plus",contentTheme:"inherit",expandedIcon:"minus",iconpos:"left",inset:!0,corners:!0,theme:"inherit",mini:!1}}(jQuery);