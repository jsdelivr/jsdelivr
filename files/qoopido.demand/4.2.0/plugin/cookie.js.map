{"version":3,"sources":["plugin/cookie.js"],"names":["document","definition","path","iterate","isObject","isTypeOf","setCookie","dependency","value","expiration","enabled","isEnabled","cookie","type","encodeURIComponent","pointer","match","i","pattern","indexOf","weight","state","past","future","demand","on","options","length","key","push","JSON","stringify","provide"],"mappings":";CAAC,SAASA,GACT,YAEA,SAASC,GAAWC,EAAMC,EAASC,EAAUC,GA4B5C,QAASC,GAAUC,EAAYC,EAAOC,IAClCC,GAAWC,EAAUJ,EAAWL,SAClCF,EAASY,OAAS,UAAYL,EAAWM,KAAO,KAAON,EAAWL,KAAO,KAAOY,mBAAmBN,GAAS,aAAeC,EAAa,YAI1I,QAASE,GAAUT,GAGlB,IAFA,GAAWa,GAASC,EAAhBC,EAAI,EAEDF,EAAUG,EAAQD,GAAKA,IACQ,IAAlCf,EAAKiB,QAAQJ,EAAQG,YAAoBF,GAASD,EAAQK,OAASJ,EAAMI,UAC3EJ,EAAQD,EAIV,SAAOC,GAAQA,EAAMK,MA1CtB,GAGCX,GAHGY,EAAU,gCACbC,EAAU,gCACVL,IA2CD,OAxCAM,QACCC,GAAG,iBAAmBvB,EAAM,SAASwB,GACjCtB,EAASsB,IACXR,EAAQS,OAAS,EAEjBxB,EAAQuB,EAAS,SAASE,EAAKpB,GAC9BU,EAAQW,MAAOX,QAASU,EAAKR,OAAQQ,EAAID,OAAQN,MAAOb,OAEhDH,EAASqB,EAAS,aAC3BhB,EAAUgB,KAGXD,GAAG,YAAa,SAASlB,GACzBD,EAAUC,EAAY,GAAIe,KAE1BG,GAAG,aAAc,SAASlB,GAC1BD,EAAUC,EAAY,GAAIe,KAE1BG,GAAG,YAAa,SAASlB,EAAYc,GACrCf,EAAUC,EAAYuB,KAAKC,UAAUV,GAAQE,MAqBxC,EAGRS,SAAU,OAAQ,2BAA4B,6BAA8B,8BAAgC/B,IAC3GD","file":"cookie.js","sourcesContent":["(function(document) {\n\t'use strict';\n\n\tfunction definition(path, iterate, isObject, isTypeOf) {\n\t\tvar past    = 'Thu, 01 Jan 1970 00:00:00 GMT',\n\t\t\tfuture  = 'Fri, 31 Dec 9999 23:59:59 GMT',\n\t\t\tpattern = [],\n\t\t\tenabled;\n\t\t\n\t\tdemand.\n\t\t\ton('postConfigure:' + path, function(options) {\n\t\t\t\tif(isObject(options)) {\n\t\t\t\t\tpattern.length = 0;\n\n\t\t\t\t\titerate(options, function(key, value) {\n\t\t\t\t\t\tpattern.push({ pattern: key, weight: key.length, state: value });\n\t\t\t\t\t});\n\t\t\t\t} else if(isTypeOf(options, 'boolean')) {\n\t\t\t\t\tenabled = options;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on('cacheMiss', function(dependency) {\n\t\t\t\tsetCookie(dependency, '', past);\n\t\t\t})\n\t\t\t.on('cacheClear', function(dependency) {\n\t\t\t\tsetCookie(dependency, '', past);\n\t\t\t})\n\t\t\t.on('postCache', function(dependency, state) {\n\t\t\t\tsetCookie(dependency, JSON.stringify(state), future);\n\t\t\t});\n\n\t\tfunction setCookie(dependency, value, expiration) {\n\t\t\tif(enabled || isEnabled(dependency.path)) {\n\t\t\t\tdocument.cookie = 'demand[' + dependency.type + '][' + dependency.path + ']=' + encodeURIComponent(value) + '; expires=' + expiration + '; path=/';\n\t\t\t}\n\t\t}\n\n\t\tfunction isEnabled(path) {\n\t\t\tvar i = 0, pointer, match;\n\n\t\t\tfor(; (pointer = pattern[i]); i++) {\n\t\t\t\tif(path.indexOf(pointer.pattern) === 0 && (!match || pointer.weight > match.weight)) {\n\t\t\t\t\tmatch = pointer;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn match ? match.state : false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprovide([ 'path', '/demand/function/iterate', '/demand/validator/isObject', '/demand/validator/isTypeOf' ], definition);\n}(document));"]}