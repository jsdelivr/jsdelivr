/**
 * session.js 0.4.1
 * (c) 2012 Iain, CodeJoust
 * session.js is freely distributable under the MIT license.
 * Portions of session.js are inspired or borrowed from Underscore.js, and quirksmode.org demo javascript.
 * This version uses google's jsapi library for location services.
 * For details, see: https://github.com/codejoust/session.js
 */var session_fetch=function(e,t,n){var r=.4,i={use_html5_location:!1,ipinfodb_key:!1,gapi_location:!0,location_cookie:"location",location_cookie_timeout:5,session_timeout:32,session_cookie:"first_session"},s=function(){e.session=e.session||{},e.session.contains=function(e){if(typeof e=="string")return this.indexOf(e)!==-1;for(var t=0;t<e.length;t++)if(this.indexOf(e[t])!==-1)return!0;return!1};if(e.session&&e.session.options)for(option in e.session.options)i[option]=e.session.options[option];var t={api_version:r,locale:u.locale(),current_session:u.session(),original_session:u.session(i.session_cookie,i.session_timeout*24*60*60*1e3),browser:u.browser(),plugins:u.plugins(),time:u.time(),device:u.device()};i.use_html5_location?t.location=u.html5_location():i.ipinfodb_key?t.location=u.ipinfodb_location(i.ipinfodb_key):i.gapi_location&&(t.location=u.gapi_location());if(e.session&&e.session.start)var n=e.session.start;var s=0,o,a,f=function(t){t&&s--,s===0&&n&&n(e.session)};e.session={};for(var l in t){o=t[l];if(typeof o=="function")try{o(function(t){e.session[l]=t,f(!0)}),s++}catch(c){e.console&&typeof console.log=="function"&&(console.log(c),f(!0))}else e.session[l]=o}f()},o={detect:function(){return{browser:this.search(this.data.browser),version:this.search(n.userAgent)||this.search(n.appVersion),os:this.search(this.data.os)}},search:function(e){if(typeof e!="object"){var i=e.indexOf(this.version_string);if(i==-1)return;return parseFloat(e.substr(i+this.version_string.length+1))}for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;this.version_string=e[t].versionSearch||e[t].identity;if(n){if(n.indexOf(e[t].subString)!=-1)return e[t].identity}else if(r)return e[t].identity}},data:{browser:[{string:n.userAgent,subString:"Chrome",identity:"Chrome"},{string:n.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:n.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:e.opera,identity:"Opera",versionSearch:"Version"},{string:n.vendor,subString:"iCab",identity:"iCab"},{string:n.vendor,subString:"KDE",identity:"Konqueror"},{string:n.userAgent,subString:"Firefox",identity:"Firefox"},{string:n.vendor,subString:"Camino",identity:"Camino"},{string:n.userAgent,subString:"Netscape",identity:"Netscape"},{string:n.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:n.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:n.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:n.platform,subString:"Win",identity:"Windows"},{string:n.platform,subString:"Mac",identity:"Mac"},{string:n.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:n.userAgent,subString:"iPad",identity:"iPad"},{string:n.userAgent,subString:"Android",identity:"Android"},{string:n.platform,subString:"Linux",identity:"Linux"}]}},u={browser:function(){return o.detect()},time:function(){var e=new Date,t=new Date;return e.setMonth(0),e.setDate(1),t.setMonth(6),t.setDate(1),{tz_offset:-(new Date).getTimezoneOffset()/60,observes_dst:e.getTimezoneOffset()!==t.getTimezoneOffset()}},locale:function(){var e=(n.language||n.browserLanguage||n.systemLanguage||n.userLanguage||"").split("-");return e.length==2?{country:e[1].toLowerCase(),lang:e[0].toLowerCase()}:e?{lang:e[0].toLowerCase(),country:null}:{lang:null,country:null}},device:function(){var r={screen:{width:e.screen.width,height:e.screen.height}};return r.viewport={width:e.innerWidth||t.documentElement.clientWidth||t.body.clientWidth,height:e.innerHeight||t.documentElement.clientHeight||t.body.clientHeight},r.is_tablet=!!n.userAgent.match(/(iPad|SCH-I800|xoom|kindle)/i),r.is_phone=!r.is_tablet&&!!n.userAgent.match(/(iPhone|iPod|blackberry|android 0.5|htc|lg|midp|mmp|mobile|nokia|opera mini|palm|pocket|psp|sgh|smartphone|symbian|treo mini|Playstation Portable|SonyEricsson|Samsung|MobileExplorer|PalmSource|Benq|Windows Phone|Windows Mobile|IEMobile|Windows CE|Nintendo Wii)/i),r.is_mobile=r.is_tablet||r.is_phone,r},plugins:function(){var e=function(e){if(n.plugins){var t,r=0,i=n.plugins.length;for(;r<i;r++){t=n.plugins[r];if(t&&t.name&&t.name.toLowerCase().indexOf(e)!==-1)return!0}return!1}return!1};return{flash:e("flash"),silverlight:e("silverlight"),java:e("java"),quicktime:e("quicktime")}},session:function(n,r){var i=a.get_obj(n);if(i==null){i={visits:1,start:(new Date).getTime(),last_visit:(new Date).getTime(),url:e.location.href,path:e.location.pathname,referrer:t.referrer,referrer_info:a.parse_url(t.referrer),search:{engine:null,query:null}};var s=[{name:"Google",host:"google",query:"q"},{name:"Bing",host:"bing.com",query:"q"},{name:"Yahoo",host:"search.yahoo",query:"p"},{name:"AOL",host:"search.aol",query:"q"},{name:"Ask",host:"ask.com",query:"q"},{name:"Baidu",host:"baidu.com",query:"wd"}],o=s.length,u,f,l=0,c="q query term p wd query text".split(" ");for(l=0;l<o;l++){u=s[l];if(i.referrer_info.host.indexOf(u.host)!==-1){i.search.engine=u.name,i.search.query=i.referrer_info.query[u.query],i.search.terms=i.search.query?i.search.query.split(" "):null;break}}if(i.search.engine===null&&i.referrer_info.search.length>1)for(l=0;l<c.length;l++){var h=i.referrer_info.query[c[l]];if(h){i.search.engine="Unknown",i.search.query=h,i.search.terms=h.split(" ");break}}}else i.prev_visit=i.last_visit,i.last_visit=(new Date).getTime(),i.visits++,i.time_since_last_visit=i.last_visit-i.prev_visit;return a.set_cookie(n,a.package_obj(i),r),i},html5_location:function(){return function(e){n.geolocation.getCurrentPosition(function(t){t.source="html5",e(t)},function(t){i.gapi_location?u.gapi_location()(e):e({error:!0,source:"html5"})})}},gapi_location:function(){return function(t){var n=a.get_obj(i.location_cookie);!n||n.source!=="google"?(e.gloader_ready=function(){"google"in e&&(e.google.loader.ClientLocation?(e.google.loader.ClientLocation.source="google",t(e.google.loader.ClientLocation)):t({error:!0,source:"google"}),a.set_cookie(i.location_cookie,a.package_obj(e.google.loader.ClientLocation),i.location_cookie_timeout*60*60*1e3))},a.embed_script("https://www.google.com/jsapi?callback=gloader_ready")):t(n)}},ipinfodb_location:function(t){return function(n){var r=a.get_obj(i.location_cookie);r&&r.source==="ipinfodb"&&n(r),e.ipinfocb=function(e){if(e.statusCode==="OK")e.source="ipinfodb",a.set_cookie(i.location_cookie,a.package_obj(e),i.location_cookie*60*60*1e3),n(e);else{if(i.gapi_location)return u.gapi_location()(n);n({error:!0,source:"ipinfodb",message:e.statusMessage})}},a.embed_script("http://api.ipinfodb.com/v3/ip-city/?key="+t+"&format=json&callback=ipinfocb")}}},a={parse_url:function(e){var n=t.createElement("a"),r={};n.href=e,query_str=n.search.substr(1);if(query_str!=""){var i=query_str.split("&"),s=0,o=i.length,u;for(;s<o;s++)u=i[s].split("="),u.length===2&&(r[u[0]]=decodeURI(u[1]))}return{host:n.host,path:n.pathname,protocol:n.protocol,port:n.port===""?80:n.port,search:n.search,query:r}},set_cookie:function(n,r,i,s){if(!n)return null;if(!s)var s={};if(r===null||r===undefined)i=-1;return i&&(s.expires=(new Date).getTime()+i),t.cookie=[encodeURIComponent(n),"=",encodeURIComponent(String(r)),s.expires?"; expires="+(new Date(s.expires)).toUTCString():"","; path="+(s.path?s.path:"/"),s.domain?"; domain="+s.domain:"",e.location&&e.location.protocol==="https:"?"; secure":""].join("")},get_cookie:function(e,n){return(n=(new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)")).exec(t.cookie))?decodeURIComponent(n[1]):null},embed_script:function(e){var n=t.createElement("script");n.type="text/javascript",n.src=e,t.getElementsByTagName("body")[0].appendChild(n)},package_obj:function(e){if(e){e.version=r;var t=f.stringify(e);return delete e.version,t}},get_obj:function(e){var t;try{t=f.parse(a.get_cookie(e))}catch(n){}if(t&&t.version==r)return delete t.version,t}},f={parse:e.JSON&&e.JSON.parse||function(e){return typeof e!="string"||!e?null:(new Function("return "+e))()},stringify:e.JSON&&e.JSON.stringify||function(e){var t=typeof e;if(t==="object"&&e!==null){var n,r,i=[],s=e&&e.constructor===Array;for(n in e)r=e[n],t=typeof r,t==="string"?r='"'+r+'"':t==="object"&&r!==null&&(r=this.stringify(r)),i.push((s?"":'"'+n+'":')+r);return(s?"[":"{")+i.join(",")+(s?"]":"}")}if(t==="string")return'"'+e+'"'}};s()};typeof window.exports=="undefined"?session_fetch(window,document,navigator):window.exports.session=session_fetch;