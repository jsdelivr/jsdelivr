/*!
*  filename: ej.pivotanalysis.base.min.js
*  version : 14.3.0.49
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min"],n):n()})(function(){(function($,ej,undefined){ej.PivotAnalysis={_initProperties:function(){this._colKeysCalcValues=[];this._rowKeysCalcValues=[];this._tableKeysCalcValues=[];this._gridMatrix=null;this._rowTotCalc=[];this._colTotCalc=[];this._transposeEngine=[];this._tRowCnt=0;this._tColCnt=0;this._cellType="";this._fieldMembers={};this._summaryTypes=[];this._editCellsInfo=[];this._locale="en-US"},setFieldCaptions:function(n){$.each(n.rows,function(n,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)});$.each(n.columns,function(n,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)});$.each(n.filters,function(n,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)});$.each(n.values,function(n,t){ej.isNullOrUndefined(t.fieldCaption)&&(t.fieldCaption=t.fieldName)})},getTreeViewData:function(n){var t=[],o=[],s,e,i,u,f,r,h;if(n.data!=null)for(i=0;i<n.data.length;i++)jQuery.each(n.data[i],function(n){jQuery.inArray(n,t)==-1&&t.push(n)});for(jQuery.each(n.values,function(n,i){i.isCalculatedField==!0&&jQuery.inArray(i.fieldName,t)==-1&&t.push(i.fieldName)}),s=[n.rows,n.columns,n.filters,n.values],e=[].concat.apply([],s),i=0;i<t.length;i++){for(u=0;u<e.length;u++)(t[i].caption==undefined||t[i].caption=="")&&e[u].fieldName==t[i].name&&(t[i].caption=e[u].fieldCaption);for(f=0;f<t.length;f++)(t[i].caption==undefined||t[i].caption=="")&&t[f].name==t[i].name&&(t[i].caption=t[f].caption);(t[i].caption==undefined||t[i].caption=="")&&(t[i].caption=t[i].name)}for(r=0;r<t.length;r++)h=$.grep(n.rows,function(n){return n.fieldName==t[r]}).length>0||$.grep(n.columns,function(n){return n.fieldName==t[r]}).length>0||$.grep(n.values,function(n){return n.fieldName==t[r]}).length>0||$.grep(n.filters,function(n){return n.fieldName==t[r]}).length>0,o.push({id:t[r],name:t[r],caption:t[r],isSelected:h,spriteCssClass:""});return o},pivotEnginePopulate:function(model){var dataSource=model.dataSource,currentObj=this,fields,vC,cnt,nC,outputString,rC,cC,i,temp,value,val,j,k,formula,oldValue,newValue,isColumnEmpty,rCnt,emptyCellColSpan,tcnt,cCnt;this._initProperties();this._locale=model.locale;var colAxis=dataSource.columns,rowAxis=dataSource.rows,filters=dataSource.filters,calcValues=dataSource.values,colLen,jsonObj=[],pivotFieldList=[],rowLen;if(this._editCellsInfo=[],!ej.isNullOrUndefined(model.editCellsInfo)){var rowHeaders=model.editCellsInfo.rowHeader,colHeaders=model.editCellsInfo.columnHeader,values=model.editCellsInfo.JSONRecords;if(!ej.isNullOrUndefined(values)){for(uV=0;uV<values.length;uV++)fields={},rowAxis.length>0&&(fields.row=rowHeaders[uV].toString().split("#").splice(0,rowAxis.length).join(".")),colAxis.length>0&&(fields.column=colHeaders[uV].toString().split("#").splice(0,colAxis.length).join(".")),fields.value=colHeaders[uV].toString().split("#")[colHeaders[uV].toString().split("#").length-1]+"#"+values[uV].Value,this._editCellsInfo.push(fields);for(vC=0;vC<calcValues.length;vC++)$.each(this._editCellsInfo,function(n,t){calcValues[vC].fieldName==t.value.split("#")[0]&&(ej.PivotAnalysis._editCellsInfo[n].value=vC+"#"+t.value.split("#")[1])})}}for(i=0;i<calcValues.length;i++)this._summaryTypes.push(calcValues[i].summaryType!=null&&calcValues[i].summaryType!=undefined?calcValues[i].summaryType:ej.PivotAnalysis.SummaryType.Sum);if(dataSource.data!=null)for(cnt=0;cnt<dataSource.data.length;cnt++){list=jQuery.extend(!0,{},dataSource.data[cnt]);var table={keys:[],uniqueName:"",value:null},row={keys:[],uniqueName:"",value:null},col={keys:[],uniqueName:"",value:null},values={keys:[],uniqueName:"",value:null},isExcluded=!1;for(i=0;i<filters.length;i++)if(val=this._getReflectedValue(list,filters[i].fieldName,null,null),this._fieldMembers[filters[i].fieldName]==undefined||this._fieldMembers[filters[i].fieldName]==null?this._fieldMembers[filters[i].fieldName]=[val]:$.inArray(val,this._fieldMembers[filters[i].fieldName])==-1&&this._fieldMembers[filters[i].fieldName].push(val),filters[i].filterItems!=null&&filters[i].filterItems!=undefined&&((filters[i].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||filters[i].filterItems.filterType==null)&&$.inArray(val!=null?val.toString():val,filters[i].filterItems.values)>=0||filters[i].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val!=null?val.toString():val,rowAxis[rC].filterItems.values)<0)){isExcluded=!0;break}for(nC=0;nC<calcValues.length;nC++)val="",calcValues[nC]!=undefined&&calcValues[nC]!=null&&(list[calcValues[nC].fieldName]=this._getNumber($(list).prop(calcValues[nC].fieldName),calcValues[nC].formatString),val=this._getReflectedValue(list,calcValues[nC].fieldName,calcValues[nC].format,calcValues[nC].formatString),this._fieldMembers[calcValues[nC].fieldName]==undefined||this._fieldMembers[calcValues[nC].fieldName]==null?this._fieldMembers[calcValues[nC].fieldName]=[val]:$.inArray(val,this._fieldMembers[calcValues[nC].fieldName])==-1&&this._fieldMembers[calcValues[nC].fieldName].push(val)),outputString=val!=null?val.toString().replace(/([AMPME~!@#$%^&*()_+=`{}\[\]\|\\:;'<>,-.\/? ])+/g,""):"0",outputString=outputString.replace(ej.globalize.preferredCulture(this._locale).numberFormat.currency.symbol,""),$.isNumeric(outputString)||calcValues[nC].format=="date"?values.keys.push(val!=null?val:0):values.keys.push(1);for(rC=0;rC<rowAxis.length;rC++){if(val="",rowAxis[rC]!=undefined&&rowAxis[rC]!=null&&(val=this._getReflectedValue(list,rowAxis[rC].fieldName,null,null),this._fieldMembers[rowAxis[rC].fieldName]==undefined||this._fieldMembers[rowAxis[rC].fieldName]==null?this._fieldMembers[rowAxis[rC].fieldName]=[val]:$.inArray(val,this._fieldMembers[rowAxis[rC].fieldName])==-1&&this._fieldMembers[rowAxis[rC].fieldName].push(val),rowAxis[rC].filterItems!=null&&rowAxis[rC].filterItems!=undefined&&((rowAxis[rC].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||rowAxis[rC].filterItems.filterType==null)&&$.inArray(val!=null?val.toString():val,rowAxis[rC].filterItems.values)>=0||rowAxis[rC].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val!=null?val.toString():val,rowAxis[rC].filterItems.values)<0))){isExcluded=!0;break}val!=null&&val.toString().replace(/^\s+|\s+$/gm,"")||(val="(blank)");row.keys.push(val);row.uniqueName+=row.uniqueName==""?val:"."+val;table.keys.push(val);table.uniqueName+=table.uniqueName==""?val:"."+val}for(cC=0;cC<colAxis.length;cC++){if(val="",colAxis[cC]!=undefined&&colAxis[cC]!=null&&(val=this._getReflectedValue(list,colAxis[cC].fieldName,null,null),this._fieldMembers[colAxis[cC].fieldName]==undefined||this._fieldMembers[colAxis[cC].fieldName]==null?this._fieldMembers[colAxis[cC].fieldName]=[val]:$.inArray(val,this._fieldMembers[colAxis[cC].fieldName])==-1&&this._fieldMembers[colAxis[cC].fieldName].push(val),colAxis[cC].filterItems!=null&&colAxis[cC].filterItems!=undefined&&((colAxis[cC].filterItems.filterType==ej.PivotAnalysis.FilterType.Exclude||colAxis[cC].filterItems.filterType==null)&&$.inArray(val!=null?val.toString():val,colAxis[cC].filterItems.values)>=0||colAxis[cC].filterItems.filterType==ej.PivotAnalysis.FilterType.Include&&$.inArray(val!=null?val.toString():val,colAxis[cC].filterItems.values)<0))){isExcluded=!0;break}val!=null&&val.toString().replace(/^\s+|\s+$/gm,"")||(val="(blank)");col.keys.push(val);col.uniqueName+=col.uniqueName==""?val:"."+val;table.keys.push(val);table.uniqueName+=table.uniqueName==""?val:"."+val}isExcluded||(this._isMemberExist("row",row,$.extend(!0,{},values),dataSource),this._isMemberExist("column",col,$.extend(!0,{},values),dataSource),this._isMemberExist("calc",table,$.extend(!0,{},values),dataSource))}for(i=0;i<calcValues.length;i++)if(temp=$.grep(calcValues,function(n){return n.isCalculatedField==!0}),calcValues[i].isCalculatedField&&temp.length!=calcValues.length)for(j=0;j<this._tableKeysCalcValues.length;j++){for(formula=calcValues[i].formula.replace(/\s/g,""),k=0;k<calcValues.length;k++)calcValues[k].isCalculatedField!=!0&&(value=ej.globalize.parseFloat(this._tableKeysCalcValues[j].value.keys[k]==null?"0":calcValues[k].format=="date"?this._dateToInt(this._tableKeysCalcValues[j].value.keys[k].toString()).toString():calcValues[k].format=="time"?this._dateToInt(new Date("1900",this._tableKeysCalcValues[j].value.keys[k].toString().split(":")[0],this._tableKeysCalcValues[j].value.keys[k].toString().split(":")[1],this._tableKeysCalcValues[j].value.keys[k].toString().split(":")[2].split(" ")[0]).toString()).toString():this._tableKeysCalcValues[j].value.keys[k].toString()),formula=formula.replace(new RegExp(calcValues[k].fieldName,"g"),calcValues[k].format=="percentage"&&value!=0?value/100:value));formula.indexOf("^")>-1&&(formula=this._powerFunction(formula));oldValue=!isNaN(eval(formula))&&isFinite(eval(formula))?this._getReflectedValue({calcField:eval(formula)},"calcField",calcValues[i].format,calcValues[i].formatString):dataSource.values[i].format==null?0:"0";newValue=dataSource.values[i].format==null?0:"0";this._tableKeysCalcValues[j].value.keys[i]=this._getSummaryValue(oldValue,newValue,1,this._summaryTypes[i],dataSource.values[i].format,dataSource.values[i].formatString)}else if(calcValues[i].isCalculatedField)for(val={keys:[],uniqueName:"",value:null},j=0;j<this._tableKeysCalcValues.length;j++){for(k=0;k<calcValues.length&&calcValues[k].isCalculatedField;k++)formula=calcValues[k].formula.replace(/\s/g,""),formula.indexOf("^")>-1&&(formula=this._powerFunction(formula)),oldValue=!isNaN(eval(formula))&&isFinite(eval(formula))?this._getReflectedValue({calcField:eval(formula)},"calcField",calcValues[k].format,calcValues[k].formatString):dataSource.values[k].format==null?0:"0",newValue=dataSource.values[k].format==null?0:"0",val.keys.push(this._getSummaryValue(oldValue,newValue,1,"sum",dataSource.values[k].format,dataSource.values[k].formatString));this._tableKeysCalcValues[j].value=val;val={keys:[],uniqueName:"",value:null}}for(rowAxis.length>0&&(this._rowKeysCalcValues=this._sortHeaders(this._rowKeysCalcValues,rowAxis,0)),colAxis.length>0&&(this._colKeysCalcValues=this._sortHeaders(this._colKeysCalcValues,colAxis,0)),colAxis.length>0&&this._insertTotalHeader(colAxis,this._colKeysCalcValues),rowAxis.length>0?this._insertTotalHeader(rowAxis,this._rowKeysCalcValues):calcValues.length>0&&(this._rowKeysCalcValues[0].keys[0]="Grand Total"),this._tRowCnt=0,this._tColCnt=0,this._calculateValues(dataSource),isColumnEmpty=this._colKeysCalcValues.length==1&&this._colKeysCalcValues[0].cellType=="RGTot",this._colTotCalc=[],this._rowTotCalc=[],this._colKeysCalcValues=[],this._rowKeysCalcValues=[],this._tableKeysCalcValues=[],rCnt=0;rCnt<this._tRowCnt-1;rCnt++)for(cCnt=0;cCnt<this._tColCnt-1;cCnt++)this._transposeEngine[cCnt]==undefined&&(this._transposeEngine[cCnt]=[]),this._gridMatrix[rCnt]!=undefined&&this._gridMatrix[rCnt][cCnt]!=undefined?this._transposeEngine[cCnt][rCnt]={Index:cCnt+","+rCnt,CSS:this._gridMatrix[rCnt][cCnt].CSS,Value:typeof this._gridMatrix[rCnt][cCnt]=="string"||typeof this._gridMatrix[rCnt][cCnt]=="number"||typeof this._gridMatrix[rCnt][cCnt]=="object"?this._gridMatrix[rCnt][cCnt].Value==0?"":this._gridMatrix[rCnt][cCnt].Value==undefined?"":this._gridMatrix[rCnt][cCnt].Value:"",State:this._gridMatrix[rCnt][cCnt].State,RowSpan:this._gridMatrix[rCnt][cCnt].RowSpan!=undefined?this._gridMatrix[rCnt][cCnt].RowSpan:1,ColSpan:this._gridMatrix[rCnt][cCnt].ColSpan!=undefined?this._gridMatrix[rCnt][cCnt].ColSpan:1,Info:"",Span:"None",Expander:this._gridMatrix[rCnt][cCnt].Expander}:this._gridMatrix[rCnt]!=undefined&&(this._transposeEngine[cCnt][rCnt]={Index:cCnt+","+rCnt,CSS:"none",Value:"",State:0,RowSpan:1,ColSpan:1,Info:"",Span:"None",Expander:0});for(rCnt=0;rCnt<this._tColCnt-1;rCnt++){if(rowAxis.length=rowAxis.length==0?1:rowAxis.length,rCnt<rowAxis.length)for(emptyCellColSpan=(isColumnEmpty?1:colAxis.length)+(dataSource.values.length>0?1:0),emptyCellColSpan==0&&rowAxis.length>0&&(emptyCellColSpan=1),tcnt=0;tcnt<emptyCellColSpan;tcnt++)this._gridMatrix.length>0&&jsonObj.push({Index:rCnt+","+tcnt,CSS:"none",Value:"",State:0,ColSpan:rCnt==0&&tcnt==0?rowAxis.length:1,RowSpan:rCnt==0&&tcnt==0?(isColumnEmpty?1:colAxis.length)+(dataSource.values.length>0?1:0):1,Info:"",Span:"None",Expander:0});for(cCnt=0;cCnt<this._tRowCnt-1;cCnt++)this._transposeEngine[rCnt]==undefined||this._transposeEngine[rCnt][cCnt]==undefined||cCnt<(isColumnEmpty?1:colAxis.length)+(dataSource.values.length>0?1:0)&&rCnt<rowAxis.length||jsonObj.push(this._transposeEngine[rCnt][cCnt])}return this._gridMatrix=[],dataSource.rows[0]==undefined&&(dataSource.rows.length=0),{json:jsonObj,pivotEngine:this._transposeEngine}},getMembers:function(n){return this._fieldMembers[n]},_powerFunction:function(n){if(n.indexOf("^")>-1){for(var t=[];n.indexOf("(")>-1;)n=n.replace(/(\([^\(\)]*\))/g,function(n,i){return t.push(i),"~"+(t.length-1)});for(t.push(n),n="~"+(t.length-1);n.indexOf("~")>-1;)n=n.replace(new RegExp("~(\\d+)","g"),function(n,i){return t[i].replace(/(\w*)\^(\w*)/g,"Math.pow($1,$2)")})}return n},_calculatedFieldSummaryValue:function(index,calValue,dataSource){var formula,i,value,oldValue,newValue;if(dataSource.values[index].isCalculatedField==!0){for(formula=dataSource.values[index].formula.replace(/\s/g,""),i=0;i<dataSource.values.length;i++)dataSource.values[i].isCalculatedField!=!0&&(value=ej.globalize.parseFloat(calValue[i]==null?"0":dataSource.values[i].format=="date"?this._dateToInt(calValue[i].toString()).toString():dataSource.values[i].format=="time"?this._dateToInt(new Date("1900",calValue[i].toString().split(":")[0],calValue[i].toString().split(":")[1],calValue[i].toString().split(":")[2].split(" ")[0]).toString()).toString():calValue[i].toString()),formula=formula.replace(new RegExp(dataSource.values[i].fieldName,"g"),dataSource.values[i].format=="percentage"&&value!=0?value/100:value));return formula.indexOf("^")>-1&&(formula=this._powerFunction(formula)),oldValue=!isNaN(eval(formula))&&isFinite(eval(formula))?this._getReflectedValue({calcField:eval(formula)},"calcField",dataSource.values[index].format,dataSource.values[index].formatString):dataSource.values[index].format==null?0:"0",newValue=dataSource.values[index].format==null?0:"0",this._getSummaryValue(oldValue,newValue,1,this._summaryTypes[index]=="count"?"sum":this._summaryTypes[index],dataSource.values[index].format,dataSource.values[index].formatString)}},_sortHeaders:function(n,t,i){for(var r=[],e=[],f=0,o,u=t[i].sortOrder!=ej.PivotAnalysis.SortOrder.None?ej.DataManager(n).executeLocal(ej.Query().sortBy("keys."+i,t[i].sortOrder!=null&&t[i].sortOrder==ej.PivotAnalysis.SortOrder.Descending?ej.sortOrder.Descending:ej.sortOrder.Ascending,!1)):n;f<u.length;)o=u[f].keys[i],r=$.grep(u,function(n){return n.keys[i]==o}),r.length>1&&i+1<u[f].keys.length&&(r=this._sortHeaders(r,t,i+1)),e=e.concat(r),f+=r.length;return e},_isValidTime:function(n){var t=n.indexOf(":")>-1?n.split(":"):[];return t.length==3?(t[3]=t[2].indexOf(" ")>-1?t[2].split(" ")[1]:"AM",t[2]=t[2].indexOf(" ")>-1?t[2].split(" ")[0]:t[2],Number(t[0])>-1&&Number(t[0])<13&&Number(t[1])>-1&&Number(t[1])<61&&jQuery.isNumeric(t[2])&&(t[3]=="AM"||t[3]=="PM")?!0:!1):!1},_getNumber:function(n,t){return typeof n=="string"&&(n=jQuery.isNumeric(n.replace(",",""))?Number(n.replace(",","")):this._isValidTime(n)?this._formatToInt(n,"time",t):ej.isNullOrUndefined(ej.parseDate(n,t==undefined?"MM/dd/yyyy":t))?n.indexOf("/")!=-1&&n.split("/")==2?this._formatToInt(n,"fraction",undefined):n.trim().indexOf("%")==n.trim().length-1?Number(n.replace(/[^\d.-]/g,""))/100:/[a-zA-Z]/.test(n)?1:Number(n.replace(/[^\d.-]/g,"")):this._formatToInt(n,"date",t)),n},_setFormat:function(n,t,i){switch(t){case"percentage":var r=jQuery.isNumeric(n)?1:100;n=n.toString().split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",",".").replace(ej.preferredCulture(this._locale).numberFormat.percent.symbol,"").trim();n=jQuery.isNumeric(n)?n:0;n=ej.widgetBase.formatting("{0:P}",n==""?0:n/r,this._locale);break;case"decimal":case"number":n=n.toString().split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",",".");n=jQuery.isNumeric(n)?n:0;n=ej.widgetBase.formatting("{0:N}",n,this._locale);break;case"currency":n=n.toString().split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",",".").replace(ej.preferredCulture(this._locale).numberFormat.currency.symbol,"").trim();n=jQuery.isNumeric(n)?n:0;n=ej.widgetBase.formatting("{0:C2}",n==""?0:n,this._locale);break;case"date":jQuery.isNumeric(n)?(n=new Date((Number(n)-2)*864e5+new Date("01/01/1900").getTime()),this._isDateTime(n)&&(n=ej.widgetBase.formatting("{0:"+(i==undefined?"MM/dd/yyyy":i)+"}",n,this._locale))):new Date(n)!="Invalid Date"?n=ej.widgetBase.formatting("{0:"+(i==undefined?"MM/dd/yyyy":i)+"}",n,this._locale):(n=new Date((Number(0)-2)*864e5+new Date("01/01/1900").getTime()),n=ej.widgetBase.formatting("{0:"+(i==undefined?"MM/dd/yyyy":i)+"}",n,this._locale));break;case"scientific":n=typeof n=="string"?n.split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",","."):n;n=jQuery.isNumeric(n)?n:0;n=Number(n).toExponential(2).replace("e","E");break;case"accounting":n=this._toAccounting(n,"{0:C2}",this._locale);break;case"time":jQuery.isNumeric(n)?(n=new Date((Number(n)-2)*864e5+new Date("01/01/1900").getTime()),this._isDateTime(n)&&(n=ej.widgetBase.formatting("{0:h:mm:ss tt}",n,this._locale))):this._isValidTime(n)?n=ej.widgetBase.formatting("{0:h:mm:ss tt}",n,this._locale):(n=new Date((Number(0)-2)*864e5+new Date("01/01/1900").getTime()),n=ej.widgetBase.formatting("{0:h:mm:ss tt}",n,this._locale));break;case"fraction":n=typeof n=="string"?n.split(ej.preferredCulture(this._locale).numberFormat[","]).join("").replace(",","."):n;n=jQuery.isNumeric(n)?this._toFraction(n):this._toFraction(0);n="numerator"in n?n.integer+" "+n.numerator+"/"+n.denominator:n.integer;break;default:n}return n},_getReflectedValue:function(n,t,i,r){var u=$(n).prop(t);return u==null?u:this._setFormat(u,i,r)},_formatToInt:function(value,format,formatString){var time;switch(format){case"date":value=ej.parseDate(value.toString(),formatString==undefined?"MM/dd/yyyy":formatString,this._locale)!=null?this._dateToInt(ej.parseDate(value,formatString==undefined?"MM/dd/yyyy":formatString,this._locale)):value;break;case"percentage":value=value!=0?ej.globalize.parseFloat(value.toString(),this._locale)/100:value;break;case"currency":case"accounting":value=value!=0?ej.globalize.parseFloat(ej.globalize.format(value.toString(),"c",this._locale),this._locale):value;break;case"decimal":case"number":value=value!=0?ej.globalize.parseFloat(value.toString(),this._locale):value;break;case"scientific":value=value!=0||value==0?parseFloat(value):value;break;case"time":this._isNumber(value)||(time=value.toString().split(":"),time=new Date("1900",time[0],time[1],time[2].split(" ")[0]).toString(),value=this._dateToInt(time));break;case"fraction":var temp1=parseFloat(value.toString().split(" ")[0]),temp2=eval(value.toString().split(" ")[1])!=undefined?parseFloat(eval(value.toString().split(" ")[1])):parseFloat(0),value=value!=0?temp1+temp2:value}return value},_isDateTime:function(n){return Object.prototype.toString.call(n)==="[object Date]"&&!isNaN(n.valueOf())},_toAccounting:function(n,t,i){var s=ej.preferredCulture(i).numberFormat,f,e,u=s.currency.symbol,r,o;return val=ej.widgetBase.formatting(t,n),val=val.indexOf(" ")>-1?val.split(" ").join(""):val,r=val.replace(u,""),o=jQuery.isNumeric(r.toString().split(s[","]).join("").replace(",","."))?val.indexOf(u):0,r=jQuery.isNumeric(r.toString().split(",").join(""))?r:"0.00",!o||Number(r)<0&&o===1?(f=u,e=r):(f=r,e=u),f+"   "+e},_toFraction:function(n){if(this._isNumber(n)){var r=n.toString(),e=r.split(".")[0],t=r.split(".")[1];if(!t)return{integer:n};var i=(+t).toString(),u=this._getPlaceValue(t,i),f=this._getGCD(i,u);return{integer:e,numerator:Number(i)/f,denominator:Number(u)/f}}return null},_isNumber:function(n){return n-parseFloat(n)>=0},_getGCD:function(n,t){return(n=Number(n),t=Number(t),!t)?n:this._getGCD(t,n%t)},_getPlaceValue:function(n,t){var i=n.indexOf(t)+t.length;return"1"+Array(i+1).join("0")},_cellEdit:function(n,t,i,r){return $.each(this._editCellsInfo,function(u,f){if(n==(ej.isNullOrUndefined(f.row)&&ej.isNullOrUndefined(f.column)?"":ej.isNullOrUndefined(f.row)?f.column:ej.isNullOrUndefined(f.column)?f.row:f.row+"."+f.column)&&i==parseInt(f.value.split("#")[0]))return t=ej.PivotAnalysis._setFormat(ej.isNullOrUndefined(r.format)?jQuery.isNumeric(f.value.split("#")[1].toString().split(",").join(""))?parseFloat(f.value.split("#")[1].toString().split(",").join("")):0:f.value.split("#")[1],r.format,r.formatString),!1}),t},_isMemberExist:function(n,t,i,r){var h=this,f,s,e,u,o;switch(n){case"row":for(s=!1,this._rowKeysCalcValues.length==0&&this._rowKeysCalcValues.push(t),e=0;e<this._rowKeysCalcValues.length;e++)if(t.uniqueName==this._rowKeysCalcValues[e].uniqueName){s=!0;f=e;break}if(s)for(u=0;u<i.keys.length;u++)if(this._rowKeysCalcValues[f].value==null){this._rowKeysCalcValues[f].value=i;break}else this._rowKeysCalcValues[f].value.keys[u]+=i.keys[u];else this._rowKeysCalcValues.push(t);break;case"column":for(s=!1,this._colKeysCalcValues.length==0&&(r.columns.length>0||r.values.length>0)&&this._colKeysCalcValues.push(t),e=0;e<this._colKeysCalcValues.length;e++)if(t.uniqueName==this._colKeysCalcValues[e].uniqueName){s=!0;f=e;break}if(s)for(u=0;u<i.keys.length;u++)if(this._colKeysCalcValues[f].value==null){this._colKeysCalcValues[f].value=i;break}else this._colKeysCalcValues[f].value.keys[u]+=i.keys[u];else(r.columns.length>0||r.values.length>0)&&this._colKeysCalcValues.push(t);break;case"calc":for(s=!1,this._tableKeysCalcValues.length==0&&this._tableKeysCalcValues.push(t),e=0;e<this._tableKeysCalcValues.length;e++)if(t.uniqueName==this._tableKeysCalcValues[e].uniqueName){s=!0;f=e;break}if(s)for(u=0;u<i.keys.length;u++)if(this._tableKeysCalcValues[f].value==null){for(this._tableKeysCalcValues[f].value=i,this._tableKeysCalcValues[f].value.count=1,o=0;o<i.keys.length;o++)this._summaryTypes[o]==ej.PivotAnalysis.SummaryType.Count&&(this._tableKeysCalcValues[f].value.keys[o]=this._tableKeysCalcValues[f].value.count);break}else this._tableKeysCalcValues[f].value.count++,r.values[u].isCalculatedField!=!0&&(this._tableKeysCalcValues[f].value.keys[u]=this._getSummaryValue(this._tableKeysCalcValues[f].value.keys[u],i.keys[u],this._tableKeysCalcValues[f].value.count,this._summaryTypes[u],r.values[u].format,r.values[u].formatString));else for(this._tableKeysCalcValues.push(t),this._tableKeysCalcValues[this._tableKeysCalcValues.length-1].value=i,o=0;o<i.keys.length;o++)this._summaryTypes[o]==ej.PivotAnalysis.SummaryType.Count&&(this._tableKeysCalcValues[this._tableKeysCalcValues.length-1].value.keys[o]=1),this._tableKeysCalcValues[this._tableKeysCalcValues.length-1].value.count=1}},_getSummaryValue:function(n,t,i,r,u,f){n=this._formatToInt(n,u,f);t=this._formatToInt(t,u,f);switch(r){case ej.PivotAnalysis.SummaryType.Sum:n+=t;break;case ej.PivotAnalysis.SummaryType.Average:n=(n*(i-1)+t)/i;Math.floor(n)!=n&&(n=Number(n.toFixed(2)));break;case ej.PivotAnalysis.SummaryType.Min:n=i==1?t:Math.min(n,t);break;case ej.PivotAnalysis.SummaryType.Max:n=i==1?t:Math.max(n,t);break;case ej.PivotAnalysis.SummaryType.Count:n=i}switch(u){case"percentage":n=ej.widgetBase.formatting("{0:P}",n,this._locale);break;case"decimal":case"number":n=ej.widgetBase.formatting("{0:N}",n,this._locale);break;case"date":n=new Date((Number(n)-2)*864e5+new Date("01/01/1900").getTime());this._isDateTime(n)&&(n=ej.widgetBase.formatting("{0:"+(f==undefined?"MM/dd/yyyy":f)+"}",n,this._locale));break;case"currency":n=ej.widgetBase.formatting("{0:C2}",n,this._locale);break;case"scientific":n=n.toExponential(2).replace("e","E");break;case"accounting":n=this._toAccounting(n,"{0:C2}",this._locale);break;case"time":n=new Date((Number(n)-2)*864e5+new Date("01/01/1900").getTime());this._isDateTime(n)&&(n=ej.widgetBase.formatting("{0:h:mm:ss tt}",n,this._locale));break;case"fraction":n=this._toFraction(n);n="numerator"in n?n.integer+" "+n.numerator+"/"+n.denominator:n.integer;break;default:n}return n},_dateToInt:function(n){var t=new Date("01/01/1900"),i=this._isDateTime(n)?n:new Date(n),r=i.getTime()-t.getTime();return r/864e5+2},_insertTotalHeader:function(n,t){var s,r,o,u,h,i;if(n.length<=1){t.push({cellType:"RGTot",keys:["Grand Total"],tot:"sub"});return}for(s=-1,r=n.length-2;r>=0;r--)if(s++,o=t.length,o>0){u=t[0].uniqueName.split(".");h=t[0].keys[s];u=u.slice(0,r+1).join(".");var e="",f=0,c="";for(i=1;i<=o;i++)t[i]!=undefined?(e=t[i].uniqueName.split("."),e=e.slice(0,r+1).join("."),c=t[i].keys[r+1]):e=undefined,e!=undefined&&e.indexOf("Total")==-1?u!=undefined&&e!=u&&(t.splice(i,0,{keys:[u.split(".")[r]+" Total"],cellType:"SubTot",uniqueName:u,level:r}),t[f].span==undefined&&(t[f].span=[]),t[f].span[r]=i-f,i++,o++,u=e,f=i,h=c):u!=undefined&&(t.splice(i,0,{keys:[u.split(".")[r]+" Total"],cellType:"SubTot:",uniqueName:u,level:r}),t[f].span==undefined&&(t[f].span=[]),t[f].span[r]=i-f,i++,o++,u=e,f=i,h=c)}t.push({cellType:"RGTot",keys:["Grand Total"]})},_isPreviousLevelEqual:function(n,t,i,r){for(var u=r-1;u>=0;u--)return n[t].keys[u]!=n[i].keys[u]?!0:!1},_calculateValues:function(n){var t=this._rowKeysCalcValues.length+(n.values.length>0?1:0),u=this._colKeysCalcValues.length==0?1:this._colKeysCalcValues.length*(n.values.length==0?1:n.values.length)+1,i,r;this._gridMatrix=new Array(t+n.rows.length+1);this._populateRowHeaders(n,t+n.rows.length+1,n.rows.length==0?1:n.rows.length);i=n.columns.length+1;r=u+(n.rows.length==0?1:n.rows.length);this._populateColumnHeaders(n,i,r);n.values.length>0&&this._populateCalcTable(n);this._tRowCnt=t+i;this._tColCnt=r},_populateRowHeaders:function(n,t,i){var u,c,r,h;if(this._rowKeysCalcValues.length!=0){for(u=this._colKeysCalcValues.length==1&&this._colKeysCalcValues[0].cellType=="RGTot"?1+(n.values.length>0?1:0):n.columns.length+(n.values.length>0?1:0),this._gridMatrix=[],c="",r=0;r<this._rowKeysCalcValues.length;r++){c=this._rowKeysCalcValues[r];var e=0,f=0,o=0,s=0;if(this._rowKeysCalcValues[r].keys!=undefined&&this._rowKeysCalcValues[r].keys.length!=0)for(this._gridMatrix[u]=new Array(i),s=this._rowKeysCalcValues[r].keys.length,kCnt=0;kCnt<s;kCnt++)this._rowKeysCalcValues[r].cellType!=undefined?this._rowKeysCalcValues[r].cellType.indexOf("SubTot")>-1?(f=this._rowKeysCalcValues[r].level+e,o=i-this._rowKeysCalcValues[r].level,this._cellType="summary rstot"):(this._cellType="summary rgtot",f=e,o=n.rows.length):(this._cellType="rowheader",f=e,o=1),h=s>1?s-kCnt>1?1:0:0,this._gridMatrix[u][f]={Index:f+","+u,CSS:this._cellType,Value:this._rowKeysCalcValues[r].keys[kCnt],State:h,RowSpan:this._rowKeysCalcValues[r].span!=undefined?this._rowKeysCalcValues[r].span[kCnt]:1,ColSpan:o,Info:"",Span:"None",Expander:h},e++;u++}this._cellType=""}},_populateColumnHeaders:function(n,t){var i,e,u;if(this._colKeysCalcValues.length!=0){var o=tempCnt=n.rows.length==0?1:n.rows.length,f=n.values.length==0?1:n.values.length,s="",r=colKLen=0,h=this._colKeysCalcValues.length==1&&this._colKeysCalcValues[0].cellType=="RGTot"?1:n.columns.length;for(i=0;i<this._colKeysCalcValues.length;i++){for(r=0,tempRIndx=0,tempRSpan=0,tempCSpan=0,s=this._colKeysCalcValues[i].keys,this._gridMatrix[r]==undefined&&(this._gridMatrix[r]=[]),colKLen=this._colKeysCalcValues[i].keys.length,kCnt=0;kCnt<colKLen;kCnt++){for(this._gridMatrix[r]==undefined&&(this._gridMatrix[r]=[]),this._colKeysCalcValues[i].cellType!=undefined?this._colKeysCalcValues[i].cellType.indexOf("SubTot")>-1?(tempRIndx=this._colKeysCalcValues[i].level+r,tempRSpan=t-this._colKeysCalcValues[i].level-1,this._cellType="summary cstot"):(tempRIndx=r,tempRSpan=this._colKeysCalcValues.length==1&&this._colKeysCalcValues[0].cellType=="RGTot"?1:n.columns.length,this._cellType="summary cgtot"):(tempRIndx=r,tempRSpan=1,this._cellType="colheader"),e=colKLen>1?colKLen-kCnt>1?1:0:0,u=0;u<f;u++)this._gridMatrix[tempRIndx][f*i+u+tempCnt]={Index:o+","+tempRIndx,CSS:this._cellType,Value:this._colKeysCalcValues[i].keys[kCnt],State:e,ColSpan:(this._colKeysCalcValues[i].span!=undefined?this._colKeysCalcValues[i].span[kCnt]==undefined?1:this._colKeysCalcValues[i].span[kCnt]:1)*f,RowSpan:tempRSpan,Info:"",Span:"None",Expander:e};r++}if(n.values.length>0)for(u=0;u<f;u++)this._gridMatrix[r]==undefined&&(this._gridMatrix[r]=[]),this._gridMatrix[h][f*i+u+tempCnt]={Index:f*i+u+tempCnt+","+r,CSS:this._cellType+" calc",Value:n.values[u].fieldName,State:0,ColSpan:1,RowSpan:1,Info:"",Span:"None",Expander:0};o++}this._cellType=""}},_populateCalcTable:function(n){var t=[],o=n.values.length,u=this,g,y,s,c,b,i,l,r,f;this._rowTotCalc=[];this._rowTotCalc=[];var e=n.rows.length==0?1:n.rows.length,k=0,p=!1,v=0,h=this._colKeysCalcValues.length==1&&this._colKeysCalcValues[0].cellType=="RGTot"?2:n.columns.length+1,d=h,a,w=!1;for(r=0;r<this._rowKeysCalcValues.length;r++){for(this._colTotCalc=[],a=e,p=!0,this._gridMatrix[r+h]==undefined&&(this._gridMatrix[r+h]=[]),this._rowTotCalc[v]=[],cCnt=0;cCnt<this._colKeysCalcValues.length;cCnt++){if(t=[],this._cellType="value",n.columns.length>0&&n.rows.length>0?$.grep(u._tableKeysCalcValues,function(n){if(n.uniqueName==u._rowKeysCalcValues[r].uniqueName+"."+u._colKeysCalcValues[cCnt].uniqueName)for(i=0;i<n.value.keys.length;i++)t.push(n.value.keys[i]);return}):n.rows.length==0?$.grep(u._tableKeysCalcValues,function(n){if(n.uniqueName==u._colKeysCalcValues[cCnt].uniqueName)for(i=0;i<n.value.keys.length;i++)t.push(n.value.keys[i]);return}):$.grep(u._tableKeysCalcValues,function(n){if(n.uniqueName==u._rowKeysCalcValues[r].uniqueName)for(i=0;i<n.value.keys.length;i++)t.push(n.value.keys[i]);return}),this._editCellsInfo.length>0)for(f=0;f<n.values.length;f++)t[f]=ej.PivotAnalysis._cellEdit(n.columns.length>0&&n.rows.length>0?this._rowKeysCalcValues[r].uniqueName+"."+this._colKeysCalcValues[cCnt].uniqueName:n.rows.length==0?this._colKeysCalcValues[cCnt].uniqueName:this._rowKeysCalcValues[r].uniqueName,t[f],f,n.values[f]);if(this._colKeysCalcValues[cCnt].cellType!=undefined&&(this._colKeysCalcValues[cCnt].cellType.indexOf("SubTot")>-1||this._colKeysCalcValues[cCnt].cellType.indexOf("RGTot")>-1)){for(t=[],i=0;i<o;i++)for(l=0,s=0,c=a;c<=cCnt*o+e;c++)this._gridMatrix[r+h]!=undefined&&this._gridMatrix[r+h][a+l*o+i]!=undefined&&this._gridMatrix[r+h][a+l*o+i].Value!=undefined&&(t[i]==undefined&&(t[i]=0),s++,t[i]=n.values[i].isCalculatedField?this._calculatedFieldSummaryValue(i,t,n):this._getSummaryValue(t[i],this._gridMatrix[r+h][a+l*o+i].Value,s,this._summaryTypes[i]=="count"?"sum":this._summaryTypes[i],n.values[i].format,n.values[i].formatString)),l++;k=0;a=(cCnt+1)*o+e;t!=0&&this._colTotCalc.push({uniqueName:this._colKeysCalcValues[cCnt].uniqueName,level:this._colKeysCalcValues[cCnt].level,value:t});this._colKeysCalcValues[cCnt-1]!=undefined&&this._colKeysCalcValues[cCnt-1].cellType!=undefined&&this._colKeysCalcValues[cCnt-1].cellType.indexOf("SubTot")>-1&&this._colKeysCalcValues[cCnt-1].cellType.indexOf("RGTot")==-1&&(y=$(this._colTotCalc).filter(function(n,t){return t!=undefined&&t.uniqueName!=undefined&&u._colKeysCalcValues[cCnt].uniqueName!=undefined&&t.level!=undefined&&u._colKeysCalcValues[cCnt].level!=undefined&&t.uniqueName.indexOf(u._colKeysCalcValues[cCnt].uniqueName)===0&&u._colKeysCalcValues[cCnt].level+1==t.level}).map(function(i,r){for(var u=0;u<r.value.length;u++)t[u]==undefined&&(t[u]=0),n.values[u].isCalculatedField?t[u]=ej.PivotAnalysis._calculatedFieldSummaryValue(u,t,n):t[u]+=r.value[u];return t}),t!=0&&this._colTotCalc.push({uniqueName:this._colKeysCalcValues[cCnt].uniqueName,level:this._colKeysCalcValues[cCnt].level,value:t}));this._cellType="summary value"}if(this._colKeysCalcValues[cCnt].cellType!=undefined&&this._colKeysCalcValues[cCnt].cellType.indexOf("RGTot")>-1&&t==0&&(t=[],s=0,y=$(this._colTotCalc).filter(function(n,t){return t!=undefined&&t!=undefined&&t.level!=undefined&&t.level==0}).map(function(i,r){for(var f=0;f<r.value.length;f++)t[f]==undefined&&(t[f]=0),s++,t[f]=n.values[f].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(f,t,n):ej.PivotAnalysis._getSummaryValue(t[f],r.value[f],s,u._summaryTypes[f]=="count"?"sum":u._summaryTypes[f],n.values[f].format,n.values[f].formatString);return t}),this._cellType="summary value"),this._rowKeysCalcValues[r].cellType!=undefined&&(this._rowKeysCalcValues[r].cellType.indexOf("SubTot")>-1||this._rowKeysCalcValues[r].cellType.indexOf("RGTot")>-1)){for(t=[],g=this._rowKeysCalcValues[r].uniqueName,this._rowKeysCalcValues[r-1]!=undefined&&this._rowKeysCalcValues[r-1].cellType!=undefined&&this._rowKeysCalcValues[r-1].cellType.indexOf("SubTot")>-1&&this._rowKeysCalcValues[r].cellType.indexOf("RGTot")==-1&&(s=0,y=$(this._rowTotCalc).filter(function(n,t){return t[0]!=undefined&&t[0].uniqueName!=undefined&&u._rowKeysCalcValues[r].uniqueName!=undefined&&t[0].level!=undefined&&u._rowKeysCalcValues[r].level!=undefined&&t[0].uniqueName.indexOf(u._rowKeysCalcValues[r].uniqueName)===0&&u._rowKeysCalcValues[r].level+1==t[0].level}).map(function(i,r){if(r[e+cCnt].length>0){s++;for(var f=0;f<r[e+cCnt].length;f++)t[f]==undefined&&(t[f]=0),t[f]=n.values[f].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(f,t,n):ej.PivotAnalysis._getSummaryValue(t[f],r[e+cCnt][f],s,u._summaryTypes[f]=="count"?"sum":u._summaryTypes[f],n.values[f].format)}return t})),this._rowKeysCalcValues[r].cellType!=undefined&&this._rowKeysCalcValues[r].cellType.indexOf("RGTot")>-1&&(s=0,y=$(this._rowTotCalc).filter(function(n,t){return t!=undefined&&t[0]!=undefined&&t[0].level!=undefined&&t[0].level==0}).map(function(i,r){if(r[e+cCnt].length>0){s++;for(var f=0;f<r[e+cCnt].length;f++)t[f]==undefined&&(t[f]=0),t[f]=n.values[f].isCalculatedField?ej.PivotAnalysis._calculatedFieldSummaryValue(f,t,n):ej.PivotAnalysis._getSummaryValue(t[f],r[e+cCnt][f],s,u._summaryTypes[f]=="count"?"sum":u._summaryTypes[f],n.values[f].format,n.values[f].formatString)}return t})),s=1,c=d;c<=r+h;c++){for(b=!1,i=0;i<o;i++)l=0,this._gridMatrix[c]!=undefined&&this._gridMatrix[c][e+cCnt*o+i]!=undefined&&this._gridMatrix[c][e+cCnt*o+i].Value!=undefined&&(t[i]==undefined&&(t[i]=0),b=!0,t[i]=n.values[i].isCalculatedField?this._calculatedFieldSummaryValue(i,t,n):this._getSummaryValue(t[i],this._gridMatrix[c][e+cCnt*o+i].Value,s,this._summaryTypes[i]=="count"?"sum":this._summaryTypes[i],n.values[i].format,n.values[i].formatString)),l++;b&&s++}k=0;w=!0;p&&(this._rowTotCalc[v][0]={uniqueName:this._rowKeysCalcValues[r].uniqueName,level:this._rowKeysCalcValues[r].level},p=!1);this._rowTotCalc[v][e+cCnt]=t;this._cellType="summary value"}for(f=0;f<o;f++)this._gridMatrix[h+r][o*cCnt+f+e]=t!=undefined&&t.length!=undefined?{Index:o*cCnt+f+e+","+h+r,CSS:this._cellType,Value:t[f],State:0,ColSpan:1,RowSpan:1,Info:"",Span:"None",Expander:0}:0}w&&(v++,d=r+h+1,w=!1)}for(r=0;r<this._rowKeysCalcValues.length;r++)for(cCnt=0;cCnt<this._colKeysCalcValues.length;cCnt++)for(f=0;f<o;f++)n.values[f].isCalculatedField&&this._gridMatrix[h+r][o*cCnt+f+e].Value==null&&(this._gridMatrix[h+r][o*cCnt+f+e].Value=this._calculatedFieldSummaryValue(f,[],n));return this._gridMatrix}};ej.PivotAnalysis.SortOrder={Ascending:"ascending",Descending:"descending",None:"none"};ej.PivotAnalysis.FilterType={Exclude:"exclude",Include:"include"};ej.PivotAnalysis.SummaryType={Sum:"sum",Average:"average",Count:"count",Min:"min",Max:"max"}})(jQuery,Syncfusion)});
