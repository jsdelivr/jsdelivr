/*!
*  filename: ej.diagram.min.js
*  version : 14.2.0.26
*  Copyright Syncfusion Inc. 2001 - 2016. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","jquery-easing","jsrender","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scroller.min","./../web/ej.menu.min"],n):n()})(function(){(function($,ej,undefined){"use strict";ej.widget("ejDiagram","ej.datavisualization.Diagram",{element:null,model:null,_requiresID:!0,validTags:["div"],defaults:{width:"",height:"",nodes:[],connectors:[],defaultSettings:{connector:null,node:null,group:null},nodeTemplate:null,connectorTemplate:null,dataSourceSettings:{dataSource:null,query:null,tableName:null,id:"",parent:"",nodes:null,connectors:null,root:"",crudAction:{create:"",update:"",destroy:"",read:""},customFields:[],connectionDataSource:{dataSource:null,id:"",sourceNode:"",targetNode:"",sourcePointX:"",sourcePointY:"",targetPointX:"",targetPointY:"",crudAction:{create:"",update:"",destroy:"",read:""},customFields:[]}},snapSettings:{horizontalGridLines:{linesInterval:[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],snapInterval:[20],lineDashArray:"",lineColor:"lightgray"},verticalGridLines:{linesInterval:[1.25,18.75,.25,19.75,.25,19.75,.25,19.75,.25,19.75],snapInterval:[20],lineDashArray:"",lineColor:"lightgray"},snapConstraints:15,enableSnapToObject:!0,snapAngle:5,snapObjectDistance:5},scrollSettings:{horizontalOffset:0,verticalOffset:0,currentZoom:1,viewPortHeight:0,viewPortWidth:0,zoomFactor:.2,padding:{left:0,right:0,top:0,bottom:0}},pageSettings:{pageWidth:null,pageHeight:null,multiplePage:!1,pageBorderWidth:0,pageBackgroundColor:"#ffffff",pageBorderColor:"#565656",pageMargin:24,showPageBreak:!1,pageOrientation:"portrait",scrollLimit:"infinity",scrollableArea:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},autoScrollBorder:{left:15,top:15,right:15,bottom:15},boundaryConstraints:"infinity"},locale:"en-US",contextMenu:{items:[],showCustomMenuItemsOnly:!1},enableContextMenu:!0,enableAutoScroll:!0,tooltip:{templateId:"",relativeMode:"object",alignment:{horizontal:"center",vertical:"bottom"},margin:{left:5,right:5,top:5,bottom:5}},showTooltip:!0,layout:{bounds:null,type:"none",horizontalAlignment:"center",verticalAlignment:"top",orientation:"toptobottom",horizontalSpacing:30,verticalSpacing:30,margin:{left:0,right:0,top:0,bottom:0},marginX:0,marginY:0,fixedNode:"",getLayoutInfo:null,getConnectorSegments:null},drawingTools:{},backgroundImage:{source:"",scale:"meet",alignment:"xmidymid"},backgroundColor:"transparent",bridgeDirection:"top",version:"13.1",constraints:502,tool:6,drawType:{},selectedItems:{offsetX:0,offsetY:0,width:0,height:0,rotateAngle:0,children:[],constraints:30,userHandles:[],tooltip:{templateId:"",alignment:{horizontal:"center",vertical:"bottom"},margin:{top:10}},getConstraints:null},commandManager:{commands:{}},historyManager:{push:null,pop:null,canPop:null,canLog:null,undo:null,redo:null,startGroupAction:null,closeGroupAction:null},nodeCollectionChange:null,historyChange:null,autoScrollChange:null,itemClick:null,connectorCollectionChange:null,selectionChange:null,mouseLeave:null,mouseEnter:null,mouseOver:null,click:null,doubleClick:null,dragEnter:null,dragOver:null,dragLeave:null,drop:null,drag:null,textChange:null,sizeChange:null,connectionChange:null,rotationChange:null,contextMenuClick:null,contextMenuBeforeOpen:null,connectorSourceChange:null,connectorTargetChange:null,scrollChange:null,segmentChange:null,propertyChange:null,groupChange:null,create:null,destroy:null},observables:["nodes","connectors","locale","enableContextMenu","backgroundColor","backgroundImage","enableAutoScroll","showTooltip","bridgeDirection","tool","pageSettings.pageHeight","pageSettings.pageWidth","pageSettings.multiplePage","pageSettings.pageBorderWidth","pageSettings.pageBackgroundColor","pageSettings.pageBorderColor","pageSettings.pageMargin","pageSettings.showPageBreak","pageSettings.pageOrientation","pageSettings.scrollLimit","snapSettings.enableSnapToObject","snapSettings.snapAngle","snapSettings.snapObjectDistance","snapSettings.snapConstraints","dataSourceSettings.id","dataSourceSettings.parent","dataSourceSettings.root","dataSourceSettings.dataSource","dataSourceSettings.tableName","dataSourceSettings.query","layout.type","layout.orientation","layout.horizontalSpacing","layout.verticalSpacing","layout.marginX","layout.marginY","layout.fixedNode","selectedItems.offsetX","selectedItems.offsetY","selectedItems.width","selectedItems.height","selectedItems.rotateAngle","scrollSettings.horizontalOffset","scrollSettings.verticalOffset","scrollSettings.zoomFactor","tooltip.templateId","tooltip.relativeMode","tooltip.alignment.horizontal","tooltip.alignment.vertical","contextMenu.items","contextMenu.showCustomMenuItemsOnly"],nodes:ej.util.valueFunction("nodes"),connectors:ej.util.valueFunction("connectors"),locale:ej.util.valueFunction("locale"),enableContextMenu:ej.util.valueFunction("enableContextMenu"),enableAutoScroll:ej.util.valueFunction("enableAutoScroll"),showTooltip:ej.util.valueFunction("showTooltip"),bridgeDirection:ej.util.valueFunction("bridgeDirection"),tool:ej.util.valueFunction("tool"),_backgroundColor:ej.util.valueFunction("backgroundColor"),_backgroundImage:ej.util.valueFunction("backgroundImage"),_pageHeight:ej.util.valueFunction("pageSettings.pageHeight"),_pageWidth:ej.util.valueFunction("pageSettings.pageWidth"),_multiplePage:ej.util.valueFunction("pageSettings.multiplePage"),_pageBorderWidth:ej.util.valueFunction("pageSettings.pageBorderWidth"),_pageBackgroundColor:ej.util.valueFunction("pageSettings.pageBackgroundColor"),_pageBorderColor:ej.util.valueFunction("pageSettings.pageBorderColor"),_pageMargin:ej.util.valueFunction("pageSettings.pageMargin"),_showPageBreak:ej.util.valueFunction("pageSettings.showPageBreak"),_pageOrientation:ej.util.valueFunction("pageSettings.pageOrientation"),_scrollLimit:ej.util.valueFunction("pageSettings.scrollLimit"),_enableSnapToObject:ej.util.valueFunction("snapSettings.enableSnapToObject"),_snapConstraints:ej.util.valueFunction("snapSettings.snapConstraints"),_snapAngle:ej.util.valueFunction("snapSettings.snapAngle"),_snapObjectDistance:ej.util.valueFunction("snapSettings.snapObjectDistance"),_selectorOffsetX:ej.util.valueFunction("selectedItems.offsetX"),_selectorOffsetY:ej.util.valueFunction("selectedItems.offsetY"),_selectorWidth:ej.util.valueFunction("selectedItems.width"),_selectorHeight:ej.util.valueFunction("selectedItems.height"),_selectorRotateAngle:ej.util.valueFunction("selectedItems.rotateAngle"),_horizontalOffset:ej.util.valueFunction("scrollSettings.horizontalOffset"),_verticalOffset:ej.util.valueFunction("scrollSettings.verticalOffset"),zoomFactor:ej.util.valueFunction("scrollSettings.zoomFactor"),_layoutType:ej.util.valueFunction("layout.type"),_layoutOrientation:ej.util.valueFunction("layout.orientation"),_horizontalSpacing:ej.util.valueFunction("layout.horizontalSpacing"),_verticalSpacing:ej.util.valueFunction("layout.verticalSpacing"),_layoutMarginX:ej.util.valueFunction("layout.marginX"),_layoutMarginY:ej.util.valueFunction("layout.marginY"),_fixedNode:ej.util.valueFunction("layout.fixedNode"),_dataSourceUniqueId:ej.util.valueFunction("dataSourceSettings.id"),_dataSourceParentId:ej.util.valueFunction("dataSourceSettings.parent"),_dataSource:ej.util.valueFunction("dataSourceSettings.dataSource"),_dataSourceTableName:ej.util.valueFunction("dataSourceSettings.tableName"),_dataSourceQueryString:ej.util.valueFunction("dataSourceSettings.query"),_dataSourceRoot:ej.util.valueFunction("dataSourceSettings.root"),_tooltipTemplateId:ej.util.valueFunction("tooltip.templateId"),_horizontalTooltipAlignment:ej.util.valueFunction("tooltip.alignment.horizontal"),_verticalTooltipAlignment:ej.util.valueFunction("tooltip.alignment.vertical"),_tooltipMode:ej.util.valueFunction("tooltip.relativeMode"),_showCustomContextMenuItems:ej.util.valueFunction("contextMenu.showCustomMenuItemsOnly"),_contextMenuItems:ej.util.valueFunction("contextMenu.items"),dataTypes:{nodes:"data",connectors:"data",contextMenu:{items:"array"},dataSourceSettings:{dataSource:"data"},defaultSettings:{connector:{segments:"data",labels:"data"},node:{children:"data",gradient:{stops:"data"},labels:"data",lanes:"data",phases:"data",points:"data",ports:"data"},group:{children:"data",gradient:{stops:"data"},labels:"data",lanes:"data",phases:"data",points:"data",ports:"data"}},snapSettings:{horizontalGridLines:{linesInterval:"data",snapInterval:"data"},verticalGridLines:{linesInterval:"data",snapInterval:"data"}},selectedItems:{children:"data",userHandles:"data"}},_doubleClickEvent:!1,_nodes:[],_connectors:[],_canvas:null,_svg:null,_toolToActivate:null,_inAction:!1,_isPinching:!1,_isEditing:!1,_nodeToHit:null,_enableAPIMethods:!0,_currentCursor:null,_pasteIndex:null,_page:null,_view:null,_currentLabel:null,_zOrder:0,_clipboardData:null,_currZoom:1,_UndoRedo:!0,_mouseEventTriggered:!1,_selectedItem:"",_historyList:{currentEntry:{next:null,previous:null},canUndo:!1,canRedo:!1},_defaultContextMenuItems:[{name:"cut",text:"Cut"},{name:"copy",text:"Copy"},{name:"paste",text:"Paste"},{name:"undo",text:"Undo"},{name:"redo",text:"Redo"},{name:"selectAll",text:"Select All"},{name:"grouping",text:"Grouping",subItems:[{name:"group",text:"Group"},{name:"ungroup",text:"Ungroup"}]},{name:"order",text:"Order",subItems:[{name:"bringToFront",text:"Bring To Front"},{name:"moveForward",text:"Move Forward"},{name:"sendToBack",text:"Send To Back"},{name:"sendBackward",text:"Send Backward"}]}],_hScrollOffset:0,_vScrollOffset:0,_hScrollbar:null,_vScrollbar:null,_scrollPixel:30,_previousSelectedItems:[],_eventCause:{},_crudDeleteNodes:[],_isMobile:!1,activeTool:null,selectionList:[],tools:null,nameTable:{},boundaryTable:{},_init:function(){var i,r,u,n,f,t;this.boundaryTable={};this.nameTable={};this._isInit=!0;this.nameTable={};this.boundaryTable={};i=window.SVGSVGElement?!0:!1;i&&(ej.widget.unobtrusive!==undefined&&(this.model.snapSettings.horizontalGridLines&&this.model.snapSettings.horizontalGridLines.linesInterval&&typeof this.model.snapSettings.horizontalGridLines.linesInterval=="string"&&(this.model.snapSettings.horizontalGridLines.linesInterval=JSON.parse(this.model.snapSettings.horizontalGridLines.linesInterval)),this.model.snapSettings.verticalGridLines&&this.model.snapSettings.verticalGridLines.linesInterval&&typeof this.model.snapSettings.verticalGridLines.linesInterval=="string"&&(this.model.snapSettings.verticalGridLines.linesInterval=JSON.parse(this.model.snapSettings.verticalGridLines.linesInterval)),this.model.defaultSettings.connector&&(r=ej.datavisualization.Diagram.Connector({}),this.model.defaultSettings.connector=this._equivalentPropMap(r,this.model.defaultSettings.connector)),this.model.defaultSettings.node&&(u=ej.datavisualization.Diagram.Node({}),this.model.defaultSettings.node=this._equivalentPropMap(u,this.model.defaultSettings.node))),n=this,n.model.dataSourceSettings.crudAction.read&&(f=$.ajax({type:"GET",url:n.model.dataSourceSettings.crudAction.read,async:!1,success:function(t){n.model.dataSourceSettings.dataSource=t},error:function(){}}),this._isWebAPI=!0),n.model.dataSourceSettings.connectionDataSource.crudAction.read&&(f=$.ajax({type:"GET",url:n.model.dataSourceSettings.connectionDataSource.crudAction.read,async:!1,success:function(t){n.model.dataSourceSettings.connectionDataSource.dataSource=t},error:function(){}}),this._isWebAPI=!0),this.model.backgroundImage&&(typeof this.model.backgroundImage=="string"&&(t=this.model.backgroundImage),typeof this.model.backgroundImage=="function"&&(t=this.model.backgroundImage()),t&&(this.model.backgroundImage=ej.datavisualization.Diagram.BackgroundImage({source:t}))),this._layoutMarginX()&&(this.model.layout.margin.left=this.model.layout.margin.right=this._layoutMarginX()),this._layoutMarginY()&&(this.model.layout.margin.top=this.model.layout.margin.bottom=this._layoutMarginY()),this._cloneGlobalVariables(),this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(),this._initDefaults(),this._initViews(),this._initData(),this._doLayout(),this._initCanvas(),this._initDiagramTool(),this._initVisualGuide(),this._wireEvents(),this._initHandles(),this._initContextMenu(),this._drawingTool=!1,this._isDropped=!1,this._initCommands(),this._initHistoryManager(),this.model.zoomFactor&&this.model.zoomFactor!==.2&&(this.model.scrollSettings.zoomFactor=this.model.zoomFactor),this._updateScrollSettings(this.model.scrollSettings),delete this._viewPort,this._cloneModel=$.extend(!0,{},this.model));delete this._isInit},_equivalentPropMap:function(n,t){var u={},i;for(var r in n)i=r.toLowerCase(),ej.isPlainObject(t[i])?u[r]=this._equivalentPropMap(n[r],t[i]):t[i]&&(u[r]=t[i]);return u},refresh:function(){this._unWireEvents();this._destroy();this._historyList=null;this._diagramLayer=null;this._currZoom=1;this._hScrollOffset=0;this._vScrollOffset=0;this._hScrollbar=null;this._vScrollbar=null;this._pageBackgroundLayer=null;this._updateGroupChildren(this.model);this._checkForNullValues(this.model);$(this.element).addClass("e-datavisualization-diagram");var n=window.SVGSVGElement?!0:!1;n&&(this._cloneGlobalVariables(),this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch(),this._initDefaults(),this._initViews(),this._initData(),this._doLayout(),this._initCanvas(),this._initDiagramTool(),this._initVisualGuide(),this._wireEvents(),this._initHandles(),this._initContextMenu(),this._drawingTool=!1,this._isDropped=!1,this._initCommands(),this._initHistoryManager(),this.model.zoomFactor&&this.model.zoomFactor!==.2&&(this.model.scrollSettings.zoomFactor=this.model.zoomFactor),this._updateScrollSettings(this.model.scrollSettings));this._vScrollOffset=0;this._hScrollOffset=0;this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset)},_initCommands:function(n){var u=ej.datavisualization.Diagram.KeyModifiers,t=ej.datavisualization.Diagram.Keys,r,i,f;n?r=this.model.commandManager.commands:(n=this.model.commandManager.commands,r={copy:{execute:$.proxy(this.copy,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:t.C,keyModifiers:u.Control}},paste:{execute:$.proxy(this._commandPaste,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:t.V,keyModifiers:u.Control}},cut:{execute:$.proxy(this.cut,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:t.X,keyModifiers:u.Control}},"delete":{execute:$.proxy(this.remove,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:t.Delete}},undo:{execute:$.proxy(this.undo,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:t.Z,keyModifiers:u.Control}},redo:{execute:$.proxy(this.redo,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:t.Y,keyModifiers:u.Control}},selectAll:{execute:$.proxy(this._selectCommand,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:t.A,keyModifiers:u.Control}},nudgeUp:{execute:$.proxy(this._nudgeCommand,this),canExecute:$.proxy(this._canExecute,this),parameter:"up",gesture:{key:t.Up}},nudgeRight:{execute:$.proxy(this._nudgeCommand,this),canExecute:$.proxy(this._canExecute,this),parameter:"right",gesture:{key:t.Right}},nudgeDown:{execute:$.proxy(this._nudgeCommand,this),canExecute:$.proxy(this._canExecute,this),parameter:"down",gesture:{key:t.Down}},nudgeLeft:{execute:$.proxy(this._nudgeCommand,this),canExecute:$.proxy(this._canExecute,this),parameter:"left",gesture:{key:t.Left}},startEdit:{execute:$.proxy(this._startEditCommand,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:113}},endEdit:{execute:$.proxy(this._endEdit,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:t.Escape}},focusToNextItem:{execute:$.proxy(this._focusToItem,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:t.Tab}},focusToPreviousItem:{execute:$.proxy(this._focusToItem,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:t.Tab,keyModifiers:u.Control}},selectFocusedItem:{execute:$.proxy(this._selectFocusedItem,this),canExecute:$.proxy(this._canExecute,this),gesture:{key:t.Enter}}});for(i in n)r[i]?n[i]?(n[i]&&r[i].gesture&&n[i].gesture&&(n[i].gesture=ej.datavisualization.Diagram.Gesture($.extend({},!0,r[i].gesture,n[i].gesture))),$.extend(r[i],!0,n[i])):r[i]=null:n[i]&&(f=ej.datavisualization.Diagram.Command(n[i]),r[i]=f);this.model.commandManager.commands=r},_initViews:function(n){n||(this._views=[],this._views.push(this._id));this._views[this._id]={type:"mainview",context:ej.datavisualization.Diagram.SvgContext,style:"position:relative; height:"+this.model.height+"; width:"+this.model.width+";"}},_initDefaults:function(){ej.isMobile()&&(this.tool(ej.datavisualization.Diagram.Tool.ZoomPan),this._isMobile=!0);this._initTools()},_initCanvas:function(n){this._renderCanvas(n)},_initVisualGuide:function(){this.model.tooltip&&(this.model.tooltip=ej.datavisualization.Diagram.Tooltip(this.model.tooltip));this.model.selectedItems&&(this.model.selectorConstraints&&(this.model.selectedItems.constraints=this.model.selectorConstraints),this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Util.canEnableTooltip(this)&&this.showTooltip()?this.model.selectedItems.tooltip?ej.datavisualization.Diagram.Tooltip(this.model.selectedItems.tooltip):ej.datavisualization.Diagram.Tooltip({margin:{top:10}}):null,this.model.selectedItems.tooltip&&this.model.tooltipTemplateId&&(this.model.selectedItems.tooltip.templateId=this.model.selectedItems.tooltip.templateId||this.model.tooltipTemplateId))},_initTools:function(){this.tools={select:new ej.datavisualization.Diagram.SelectTool(this),move:new ej.datavisualization.Diagram.MoveTool(this),resize:new ej.datavisualization.Diagram.ResizeTool(this),rotate:new ej.datavisualization.Diagram.RotateTool(this),endPoint:new ej.datavisualization.Diagram.ConnectionEditTool(this),panTool:new ej.datavisualization.Diagram.PanTool(this),straightLine:new ej.datavisualization.Diagram.StraightLineTool(this),orthogonalLine:new ej.datavisualization.Diagram.OrthogonalLineTool(this),bezierLine:new ej.datavisualization.Diagram.BezierLineTool(this),phase:new ej.datavisualization.Diagram.PhaseTool(this),shapeTool:new ej.datavisualization.Diagram.ShapeTool(this),text:new ej.datavisualization.Diagram.TextTool(this)};this._toolToActivate="select";this.activeTool=this.tools[this._toolToActivate];this._registerDrawingTools()},_initDiagramTool:function(){var n=this.tool(),t;n&ej.datavisualization.Diagram.Tool.ContinuesDraw?this.model.drawType&&(t=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(t,!1)):n&ej.datavisualization.Diagram.Tool.DrawOnce?this.model.drawType&&(t=this.model.drawType.shape?this.model.drawType.shape:this.model.drawType.type,this._drawToolShape(t,!0)):n&ej.datavisualization.Diagram.Tool.ZoomPan?ej.datavisualization.Diagram.Util.canPanning(this)&&(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._isMouseDown=!1,this._currentCursor="pointer"):n&ej.datavisualization.Diagram.Tool.MultipleSelect&&(this.activateTool("select"),this.activeTool.singleAction=!1)},_initHandles:function(){var t=this.model.selectedItems.userHandles,n;if(t)for(n=0;n<t.length;n++)t[n]=ej.datavisualization.Diagram.UserHandle(t[n]),t[n].tool&&(t[n].tool.diagram=this,this.tools[t[n].name]=t[n].tool)},_initHistoryManager:function(){this.model.historyManager.push=$.proxy(this.addHistoryEntry,this);this.model.historyManager.pop=$.proxy(this.removeHistoryEntry,this);this.model.historyManager.canPop=$.proxy(this.canRemoveHistoryEntry,this);this.model.historyManager.startGroupAction=$.proxy(this._startGroupAction,this);this.model.historyManager.closeGroupAction=$.proxy(this._closeGroupAction,this)},_cloneGlobalVariables:function(){this._historyList=$.extend(!0,{},this._historyList)},_setNodesConnectors:function(n,t){var r=[],u=!1,f=!1,e=n.nodes?typeof n.nodes=="function"?n.nodes().length:n.nodes.length:0,o=n.connectors?n.connectors&&typeof n.connectors=="function"?n.connectors().length:n.connectors.length:0,i;if(n.nodes&&e!=this._nodes.length){for(i=0;i<this.nodes().length;i++)this._removeElementFromCollection(this.nameTable[this.nodes()[i].name]);this.nodes(typeof n.nodes=="function"?n.nodes():n.nodes);this._initNodeCollection(t);u=!0}if(n.connectors&&o!=this._connectors.length){for(i=0;i<this.connectors().length;i++)this._removeElementFromCollection(this.nameTable[this.connectors()[i].name]);this.connectors(typeof n.connectors=="function"?n.connectors():n.connectors);this._initConnectorCollection();f=!0}return r=this.nodes(),r=r.length>0?this.nodes().concat(this.connectors()):this.connectors(),(r.length>0||n.nodes.length==0||n.connectors.length==0)&&this._resetObjectCollection(r,t,u,f),!0},_removeElementFromCollection:function(n){if(n){if(n.children)for(var t=0;t<n.children.length;t++)this._removeElementFromCollection(this.nameTable[n.children[t]]);n.segments?this._removeEdges(n):(this._disConnect(n,{}),n.inEdges=n.outEdges=[]);ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[n.name],n);ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,n);this._removeElement(n);delete this.nameTable[n.name]}},_updateCloneModel:function(n){n&&(this._cloneModel[n]=typeof this.model[n]=="string"?this.model[n]:$.extend(!0,{},this.model[n]))},_compareModelProperty:function(n,t,i){if(n&&this._cloneModel[n]!==this.model[n]){var r={};r[n]=this.model[n];this._comparePropertyValues(this._cloneModel,n,r,t,i);this._updateCloneModel(n)}},_setModel:function(n){var o=!1,i,r,t,f,u,e,s;for(t in n){switch(t){case"height":case"width":this._initViews(!0);this._initCanvas(!0);break;case"nodes":case"connectors":o||(o=this._setNodesConnectors(n,this._isLoad));break;case"enableContextMenu":this.model.enableContextMenu=n[t];this._initContextMenu(this._isLoad);break;case"contextMenu":this.model.contextMenu=$.extend({},this.model.contextMenu,n[t]);this._initContextMenu(this._isLoad);break;case"snapSettings":r=n[t];r&&Object.keys(r).length>0&&(this._updateSnapSettings(n[t]),ej.datavisualization.Diagram.SvgContext._renderGrid(this._canvas,this._svg,this._page,this));break;case"selectorConstraints":this._setSelectorConstraints(n[t]);break;case"constraints":if(this.model.constraints=n[t],this._hasSelection()&&this._clearSelection(),f=this._getConnectors(),f.length>0)for(u=0;u<f.length;u++)ej.datavisualization.Diagram.Util.updateBridging(this.model.connectors[u],this),ej.datavisualization.Diagram.DiagramContext.update(this.model.connectors[u],this);break;case"drawingTools":this.model.drawingTools=n[t];this._registerDrawingTools();break;case"backgroundImage":this.model.backgroundImage=this.model.backgroundImage&&typeof this.model.backgroundImage=="string"?ej.datavisualization.Diagram.BackgroundImage({source:this.model.backgroundImage}):$.extend(!0,{},this.model.backgroundImage,n[t]);ej.datavisualization.Diagram.SvgContext._renderBackground(this,this._canvas,this._svg,this._page,this.model);break;case"backgroundColor":this.model.backgroundColor=n[t];ej.datavisualization.Diagram.SvgContext._renderBackground(this,this._canvas,this._svg,this._page,this.model);break;case"enableAutoScroll":this.enableAutoScroll(n[t]);break;case"autoScrollMargin":this.model.autoScrollMargin=n[t];break;case"layout":n[t].marginX&&(this.model.layout.margin.left=this.model.layout.margin.right=Number(typeof n[t].marginX=="function"?this._layoutMarginX():n[t].marginX));n[t].marginY&&(this.model.layout.margin.top=this.model.layout.margin.bottom=Number(typeof n[t].marginY=="function"?this._layoutMarginY():n[t].marginY));this.model.layout=$.extend(!0,{},this.model.layout,n[t]);this._setLayout(n[t]);break;case"selectedItems":this.updateSelector(n[t]);break;case"pageSettings":this.updatePageSettings(n[t]);break;case"scrollSettings":this._updateScrollSettings(n[t]);break;case"locale":this.locale(n[t]);e=document.getElementById(this.element[0].id+"_contextMenu");e.parentNode.removeChild(e);this.model.contextMenu&&this.model.contextMenu.items&&this.model.contextMenu.items.length>0&&(this.model.contextMenu.items=[]);this._renderContextMenu();break;case"nodeTemplate":this.clear();this._initData();i=this;this._views.forEach(function(n){var t=i._views[n],r=i._setNodeZOrder(t);i._renderDiagramObjects(r,t)});this.layout();break;case"bridgeDirection":case"tool":this.update(n);break;case"connectorTemplate":this._updateConnectors();break;case"commandManager":s=n[t]&&n[t].commands?n[t].commands:undefined;this._initCommands(s);break;case"historyManager":this.model.historyManager=$.extend(!0,this.model.historyManager,{},n[t]);this._initHistoryManager();break;case"showTooltip":this.model.showTooltip=n[t];this.model.selectedItems.tooltip=this.showTooltip()?ej.datavisualization.Diagram.Tooltip({margin:{top:10}}):null;break;case"toolTipTemplateId":this.model.selectedItems.tooltip||(this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Tooltip({margin:{top:10}}));this.model.selectedItems.tooltip.templateId=n[t];break;case"tooltip":this.model.tooltip=n[t]===null?null:ej.datavisualization.Diagram.Tooltip($.extend(!0,this.model.tooltip,{},n[t]));break;case"dataSourceSettings":r=n[t];r&&Object.keys(r).length>0&&(this.clear(),$.extend(this.model.dataSourceSettings,n[t]),this._initData(),i=this,this._views.forEach(function(n){var t=i._views[n],r=i._setNodeZOrder(t);i._renderDiagramObjects(r,t)}),this.layout())}t==="nodes"||t==="connectors"||t==="selectorConstraints"||t==="selectedItems"||t==="bridgeDirection"||t==="tool"||this._compareModelProperty(t)}},_resetObjectCollection:function(n,t,i,r){var f,u,o,e;if(i&&($(this.element).find(".ej-d-node").remove(),$(this.element).find(".ej-d-group").remove()),r)for(f=$(this.element).find(".ej-d-connector"),u=f.length-1;u>=0;u--)o=this.nameTable[f[u].id],o&&o.parent==""&&$(f[u]).remove();this._hasSelection()&&this._clearSelection();e=this;this._views.forEach(function(n){var t=e._views[n],i=e._setNodeZOrder(t);e._renderDiagramObjects(i,t)})},_getConnectors:function(){var t=[],i,n;for(i in this.nameTable)n=this.nameTable[i],(n._type==="connector"||n.segments)&&t.push(n);return t},_generateNodes:function(n){for(var u,t,i=[],r=0;r<n.length;r++)u=n[r],t=this._makeNode(u),t!=null&&t.name&&!this._findNodeByName(i,t.name)&&i.push(t);return i},_generateConnectors:function(n){for(var u,t,i=[],r=0;r<n.length;r++)u=n[r],t=this._makeLine(u),t&&t.name&&!this._findNodeByName(i,t.name)&&i.push(t);return i},_findNodeByName:function(n,t){for(var i=0;i<n.length;i++)if(n[i].name===t)return!0;return!1},_makeNode:function(n){var t=this.model.dataSourceSettings,r={},u=n[t.id],i;if(u){if(r.name=u,t.customFields&&t.customFields.length>0)for(i=0;i<t.customFields.length;i++)r[t.customFields[i]]=n[t.customFields[i]];return r}return null},_makeLine:function(n){var t=this.model.dataSourceSettings.connectionDataSource,i={},r;if(i.name=n[t.id]?n[t.id]:"connector_"+ej.datavisualization.Diagram.Util.randomId(),i.sourceNode=n[t.sourceNode],i.targetNode=n[t.targetNode],n[t.sourcePointX]&&n[t.sourcePointY]&&(i.sourcePoint={x:Number(n[t.sourcePointX]),y:Number(n[t.sourcePointY])}),n[t.targetPointX]&&n[t.targetPointY]&&(i.targetPoint={x:Number(n[t.targetPointX]),y:Number(n[t.targetPointY])}),t.customFields&&t.customFields.length>0)for(r=0;r<t.customFields.length;r++)i[t.customFields[r]]=n[t.customFields[r]];return i},insertData:function(n){var u,r,f,t,i;if(n)t=this._parameterMap(n),u=n.type==="connector"?this.model.dataSourceSettings.connectionDataSource.crudAction.create:this.model.dataSourceSettings.crudAction.create,t&&this._raiseAjaxPost(JSON.stringify({data:[t]}),u);else{if(r=this._getNewNodes(),r.nodes){for(t=[],i=0;i<r.nodes.length;i++)t.push(this._parameterMap(r.nodes[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.crudAction.create)}if(r.connectors){for(t=[],i=0;i<r.connectors.length;i++)t.push(this._parameterMap(r.connectors[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.connectionDataSource.crudAction.create)}}},updateData:function(n){var u,r,f,t,i;if(n)t=this._parameterMap(n),u=n.type==="connector"?this.model.dataSourceSettings.connectionDataSource.crudAction.update:this.model.dataSourceSettings.crudAction.update,t&&this._raiseAjaxPost(JSON.stringify({data:[t]}),u);else{if(r=this._getUpdatedNodes(),r.nodes){for(t=[],i=0;i<r.nodes.length;i++)t.push(this._parameterMap(r.nodes[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.crudAction.update)}if(r.connectors){for(t=[],i=0;i<r.connectors.length;i++)t.push(this._parameterMap(r.connectors[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.connectionDataSource.crudAction.update)}}},removeData:function(n){var u,r,f,t,i;if(n)t=this._parameterMap(n),u=n.type==="connector"?this.model.dataSourceSettings.connectionDataSource.crudAction.destroy:this.model.dataSourceSettings.crudAction.destroy,t&&this._raiseAjaxPost(JSON.stringify({data:[t]}),u);else{if(r=this._getDeletedNodes(),r.nodes){for(t=[],i=0;i<r.nodes.length;i++)t.push(this._parameterMap(r.nodes[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.crudAction.destroy)}if(r.connectors){for(t=[],i=0;i<r.connectors.length;i++)t.push(this._parameterMap(r.connectors[i]));t&&t.length>0&&this._raiseAjaxPost(JSON.stringify({data:t}),this.model.dataSourceSettings.connectionDataSource.crudAction.destroy)}}},_parameterMap:function(n){var i={},t,r;if(n.type==="connector"){if(t=this.model.dataSourceSettings.connectionDataSource,t.id&&(i[t.id]=n.name),t.sourcePointX&&t.sourcePointY&&(i[t.sourcePointX]=n.sourcePoint.X,i[t.sourcePointY]=n.sourcePoint.Y),t.targetPointX&&t.targetPointY&&(i[t.targetPointX]=n.targetPoint.X,i[t.targetPointY]=n.targetPoint.Y),t.sourceNode&&(i[t.sourceNode]=n.sourceNode),t.targetNode&&(i[t.targetNode]=n.targetNode),t.customFields&&t.customFields.length>0)for(r=0;r<t.customFields.length;r++)i[t.customFields[r]]=n[t.customFields[r]]}else if(t=this.model.dataSourceSettings,t.id&&(i[t.id]=n.name),t.width&&(i[t.width]=n.width),t.height&&(i[t.height]=n.height),t.offsetX&&(i[t.offsetX]=n.offsetX),t.offsetY&&(i[t.offsetY]=n.offsetY),t.customFields&&t.customFields.length>0)for(r=0;r<t.customFields.length;r++)i[t.customFields[r]]=n[t.customFields[r]];return i},_raiseAjaxPost:function(n,t){var i=this,r=$.ajax({contentType:"application/json",type:"POST",url:t,data:this._isWebAPI?JSON.stringify(JSON.parse(n).data):JSON.stringify(JSON.parse(n)),dataType:"json",error:function(n){n.status===404&&console.log("Method not found")}})},_initData:function(){var dataSourceSettings,dataSource,nodes,connectors,dataSourceApplied,tempNodes,tempconnectors,i,collapsedNodes;if(this.model.dataSourceSettings&&(dataSourceSettings={},this.model.dataSourceSettings.dataSource&&this.model.dataSourceSettings.connectionDataSource.dataSource?(dataSourceSettings.dataSource=this.model.dataSourceSettings.dataSource,dataSourceSettings.isBinding=!0,dataSourceSettings.nodes=this._generateNodes(this.model.dataSourceSettings.dataSource),dataSourceSettings.connectors=this._generateConnectors(this.model.dataSourceSettings.connectionDataSource.dataSource)):this.model.dataSourceSettings.dataSource&&(dataSourceSettings.id=this._dataSourceUniqueId(),dataSourceSettings.parent=this._dataSourceParentId(),dataSourceSettings.root=this._dataSourceRoot(),dataSourceSettings.dataSource=this._dataSource(),dataSourceSettings.tableName=this._dataSourceTableName(),dataSourceSettings.query=this._dataSourceQueryString()),dataSource=dataSourceSettings.dataSource||this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors),dataSource){if(nodes=[],connectors=[],dataSourceSettings&&dataSourceSettings.isBinding)dataSourceSettings.nodes&&dataSourceSettings.nodes.length>0&&this._applyTemplate(this.model.dataSourceSettings,dataSourceSettings.nodes,nodes,"nodes"),dataSourceSettings.connectors&&dataSourceSettings.connectors.length>0&&this._applyTemplate(this.model.dataSourceSettings,dataSourceSettings.connectors,connectors,"connectors");else if(this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.connectors){if(this.model.dataSourceSettings.nodes){if(dataSource=this.model.dataSourceSettings.nodes||this.model.dataSourceSettings.dataSource,dataSource)if(dataSource instanceof ej.DataManager){$.ajaxSetup({async:!1});var query=this._findQuery(this.model.dataSourceSettings.nodes,this.model.dataSourceSettings.nodeBinding),queryPromise=dataSource.executeQuery(eval(query)),diagram=this;queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyTemplate(diagram.model.dataSourceSettings,n.result,nodes,"nodes")})}else this._applyTemplate(this.model.dataSourceSettings,dataSource,nodes,"nodes");this.model.dataSourceSettings.connectors&&(dataSource=this.model.dataSourceSettings.connectors||this.model.dataSourceSettings.dataSource,dataSource&&(dataSource instanceof ej.DataManager?($.ajaxSetup({async:!1}),query=this._findQuery(this.model.dataSourceSettings.connectors,this.model.dataSourceSettings.connectorBinding),queryPromise=dataSource.executeQuery(eval(query)),queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyTemplate(diagram.model.dataSourceSettings,n.result,connectors,"connectors")})):this._applyTemplate(this.model.dataSourceSettings,dataSource,connectors,"connectors")))}}else dataSource instanceof ej.DataManager?(this._initDataSource(dataSourceSettings,nodes,connectors),dataSourceSettings.parent&&(dataSourceApplied=!0)):dataSource.length&&(this._applyDataSource(dataSourceSettings,dataSource,nodes,connectors),this.model.dataSourceSettings.parent&&(dataSourceApplied=!0));for(tempNodes=[],tempconnectors=[],this.nodes().length>0&&(tempNodes=this.nodes()),this.connectors().length>0&&(tempconnectors=this.connectors()),this.nodes(nodes),this.connectors(connectors),i=0;i<tempNodes.length;i++)this.nodes().push(tempNodes[i]),this._nodes=$.extend(!0,[],this.nodes());for(i=0;i<tempconnectors.length;i++)this.connectors().push(tempconnectors[i]),this._connectors=$.extend(!0,[],this.connectors())}collapsedNodes=this._initNodeCollection(!1,dataSourceApplied);this._initConnectorCollection(dataSourceApplied);collapsedNodes.length>0&&this._collapseNodes(collapsedNodes);this._cloneModel=$.extend(!0,{},this.model)},_initNodeCollection:function(n,t){var f=[],r=this.nodes(),e=this.nodes().length,u,i;for(this._isNodeInitializing=!0,this.model.nodeTemplate&&!this.model.dataSourceSettings.dataSource&&(typeof this.model.nodeTemplate=="string"&&(this.model.nodeTemplate=ej.util.getObject(this.model.nodeTemplate,window)),$.isFunction(this.model.nodeTemplate)&&(u=this.model.nodeTemplate)),i=0;i<e;i++)r[i].container||r[i].isSwimlane||r[i].type==="swimlane"?r[i]=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,r[i]):typeof r[i].shape!="object"&&(r[i]=ej.datavisualization.Diagram.NodeType(r[i],this)),r[i].name==""&&(r[i].name="node_"+ej.datavisualization.Diagram.Util.randomId()),r[i].type==="swimlane"||r[i].isSwimlane?this.nameTable[r[i].name]=ej.datavisualization.Diagram.Group(r[i]):r[i]._type==="group"||r[i].children&&r[i].children.length>0?(r[i]=this._getNewGroup(r[i]),r[i]._type="group",this.nameTable[r[i].name]=r[i],this._initGroupNode(r[i]),n||this._udpateChildRotateAngle(r[i])):t?r[i].shape&&typeof r[i].shape=="object"&&ej.datavisualization.Diagram.Util._updateShapeProperties(r[i]):(r[i]=this._getNewNode(r[i]),this.nameTable[r[i].name]=r[i]),!t&&u&&u(this,r[i]),r[i]._type==="node"&&r[i].labels.length&&(r[i].width==0||r[i].height==0)&&this._getNodeDimension(r[i]),this.nameTable[r[i].name]=r[i],this._updateQuad(r[i]),r[i].isExpanded||f.push(r[i]);return delete this._isNodeInitializing,this._nodes=$.extend(!0,[],r),f},_initConnectorCollection:function(n){var r=this.connectors(),t,u,i,f;for(this.model.connectorTemplate&&(typeof this.model.connectorTemplate=="string"&&(this.model.connectorTemplate=ej.util.getObject(this.model.connectorTemplate,window)),$.isFunction(this.model.connectorTemplate)&&(u=this.model.connectorTemplate)),i=0,f=r.length;i<f;i++)t=n?r[i]:this._getNewConnector(r[i]),this.nameTable[t.name]=t,n||this._dock(t,this.nameTable),this._updateEdges(t),u&&!n&&u(this,t),r[i]=t;this._connectors=$.extend(!0,[],r)},_initDataSource:function(dataSourceSettings,nodes,connectors){var dataSource=dataSourceSettings.dataSource,diagram=this,mapper,query,queryPromise;dataSource.dataSource.json&&dataSource.dataSource.json.length>0?diagram._applyDataSource(dataSourceSettings,dataSource.dataSource.json,nodes,connectors):dataSource.dataSource.table||(mapper=dataSourceSettings,dataSource instanceof ej.DataManager&&($.ajaxSetup({async:!1}),query=this._findQuery(mapper,dataSourceSettings.nodeBinding),queryPromise=dataSourceSettings.dataSource.executeQuery(eval(query)),queryPromise.done(function(n){diagram.retriveData=n.result;diagram._applyDataSource(dataSourceSettings,n.result,nodes,connectors)})))},_findQuery:function(n,t){var u=[],e=ej.Query(),h=n.query||this.model.dataSourceSettings.query,c,o,r,i,s,f;if(ej.isNullOrUndefined(h)){c=n.dataSource||this.model.dataSourceSettings.dataSource;o=n.tableName||this.model.dataSourceSettings.tableName;for(r in n)r==="tableName"||r==="dataSource"||r==="designTemplate"||r.match("Binding")||n[r]&&u.push(n[r]);for(i in t)if(i==="labels")for(s=t[i],f=0;f<s.length;f++)s[f].text&&u.push(s[f].text);else i=="shape"||i=="line"?t[i][type]&&r.push(t[i][type]):t[i]&&u.push(t[i]);u.length>0&&e.select(u);c.dataSource.url.match(o+"$")||ej.isNullOrUndefined(o)||e.from(o)}else e=h;return e},_updateMultipleRootNodes:function(n,t,i){var r=n[i.parent],u,f;if(r&&r.length>0)for(f=0;f<r.length;f++)u=r[f],t[u]?t[u].items.push(n):t[u]={items:[n]};return t},_applyDataSource:function(n,t,i,r){for(var u=[],v,s,c,p,l,e,f,o,a,y,w,h=0;h<t.length;h++)f=t[h],$.isArray(f[n.parent])?u=this._updateMultipleRootNodes(f,u,n,t):u[f[n.parent]]?u[f[n.parent]].items.push(f):u[f[n.parent]]={items:[f]},n.root===f[n.id]&&(v={items:[f]});if(o=[],n.parent)if(v)o.push(v);else for(e in u)(e||e===0)&&e!="undefined"&&e!='""'&&e!="null"||o.push(u[e]);else o.push(u[undefined]);for(this.model.nodeTemplate&&(typeof this.model.nodeTemplate=="string"&&(this.model.nodeTemplate=ej.util.getObject(this.model.nodeTemplate,window)),$.isFunction(this.model.nodeTemplate)&&(y=this.model.nodeTemplate)),this.model.connectorTemplate&&(typeof this.model.connectorTemplate=="string"&&(this.model.connectorTemplate=ej.util.getObject(this.model.connectorTemplate,window)),$.isFunction(this.model.connectorTemplate)&&(w=this.model.connectorTemplate)),s=0;s<o.length;s++)for(c=0;c<o[s].items.length;c++)p=o[s].items[c],l=this._applyNodeTemplate(n,p,y),i.push(l),n.parent&&(a=u[l[n.id]],a&&a.items&&this._renderChildNodes(n,a,l.name,i,r,u,y,w))},_getNewNodes:function(){var t=[],i=[],r,n;for(r in this.nameTable)n=this.nameTable[r],n&&n.type==="connector"&&n._status==="new"?(n._status="",i.push(n)):n&&n._status==="new"&&(n._status="",t.push(n));return{nodes:t,connectors:i}},_getUpdatedNodes:function(){var t=[],i=[],r,n;for(r in this.nameTable)n=this.nameTable[r],n&&n.type==="connector"&&n._status==="update"?(n._status="",i.push(n)):n&&n._status==="update"&&(n._status="",t.push(n));return{nodes:t,connectors:i}},_getDeletedNodes:function(){for(var n,i=[],r=[],t=0;t<this._crudDeleteNodes.length;t++)n=this._crudDeleteNodes[t],n&&n.type==="connector"?r.push(n):n&&i.push(n);return this._crudDeleteNodes=[],{nodes:i,connectors:r}},_isContainsSameConnector:function(n,t,i){var r,u;if(t&&i)for(r=0;r<n.length;r++)if(u=n[r],u&&u.sourceNode===t&&u.targetNode===i)return!0;return!1},_renderChildNodes:function(n,t,i,r,u,f,e,o){for(var c,s,l,h=0;h<t.items.length;h++)c=t.items[h],s=this._applyNodeTemplate(n,c,e),this._collectionContains(s.name,r)||r.push(s),this._isContainsSameConnector(u,i,s.name)||u.push(this._applyConnectorTemplate(n,null,i,s.name,o)),l=f[c[n.id]],l&&this._renderChildNodes(n,l,s.name,r,u,f,e,o)},_applyTemplate:function(n,t,i,r){var f,u,e,o,s;if(this.model.nodeTemplate&&(typeof this.model.nodeTemplate=="string"&&(this.model.nodeTemplate=ej.util.getObject(this.model.nodeTemplate,window)),$.isFunction(this.model.nodeTemplate)&&(f=this.model.nodeTemplate)),this.model.connectorTemplate&&(typeof this.model.connectorTemplate=="string"&&(this.model.connectorTemplate=ej.util.getObject(this.model.connectorTemplate,window)),$.isFunction(this.model.connectorTemplate)&&(s=this.model.connectorTemplate)),r=="nodes")for(u=0;u<t.length;u++)e=this._applyNodeTemplate(n,t[u],f),i.push(e);if(r=="connectors")for(u=0;u<t.length;u++)o=this._applyConnectorTemplate(n,t[u],t[u].sourceNode,t[u].targetNode,s),i.push(o)},_applyNodeTemplate:function(n,t,i){var r=t;return r.name!==""&&r.name||(r.name=ej.datavisualization.Diagram.Util.randomId()),r=r.type!="group"?this._getNewNode(r):this._getNewGroup(r),i&&i(this,r),r._type==="group"&&this._initGroupNode(r),r},_applyConnectorTemplate:function(n,t,i,r,u){var f={};return f.name=t&&t.name?t.name:ej.datavisualization.Diagram.Util.randomId(),f.sourceNode=i,f.targetNode=r,f=this._getNewConnector(f),u&&u(this,f),f},_collapseNodes:function(n){for(var i,t=0;t<n.length;t++)i=n[t],this._collapseChildren(i)},_getNewNode:function(n){return n.shape&&typeof n.shape=="object"&&ej.datavisualization.Diagram.Util._updateShapeProperties(n),ej.datavisualization.Diagram.Node($.extend(!0,{},this.model.defaultSettings.node,n))},_getNewGroup:function(n){var t=null,i=0,r;if(n.type=="bpmn"&&(n=ej.datavisualization.Diagram.Util._updateBpmnChild(ej.datavisualization.Diagram.Node(n),this)),n.children&&n.children.length>0)for(r in n.children)t=this.nameTable[this._getChild(n.children[r])],t&&(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t.name],t),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,t),t.segments?(i=this.connectors().indexOf(t),delete this.nameTable[t.name],this.nameTable[t.name]=this._getNewConnector(t),i>=0&&(this.connectors()[i]=this.nameTable[t.name]),this._dock(this.nameTable[t.name],this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(this.nameTable[t.name],this)):t._type==="node"?(i=this.nodes().indexOf(t),delete this.nameTable[t.name],this.nameTable[t.name]=this._getNewNode(t),i>=0&&(this.nodes()[i]=this.nameTable[t.name])):t._type==="group"&&(i=this.nodes().indexOf(t),delete this.nameTable[t.name],this.nameTable[t.name]=this._getNewGroup(t),i>=0&&(this.nodes()[i]=this.nameTable[t.name])));return ej.datavisualization.Diagram.Group($.extend(!0,{},this.model.defaultSettings.group,n))},_getNewConnector:function(n){var t=$.extend(!0,{},this.model.defaultSettings.connector,n);return this.model.layout&&this.model.layout.type=="organizationalchart"&&(t=$.extend(!0,{},{segments:[{type:"orthogonal"}]},t)),this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments&&this.model.defaultSettings.connector.segments[0]&&(t.defaultType=this.model.defaultSettings.connector.segments[0].type),t.shape&&(t.shape=$.extend(!0,{},ej.datavisualization.Diagram.ConnectorShapeDefaults,t.shape),t.shape.flow=="sequence"&&(t.shape.sequence=="normal"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},t)),t.shape.sequence=="conditional"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},t),t.sourceDecorator={shape:"diamond",fillColor:"white",width:20,height:10}),t.shape.sequence=="default"&&(t=$.extend(!0,{segments:[{type:"straight"}],targetDecorator:{shape:"arrow"},lineWidth:2},t))),t.shape.flow=="association"&&(t.shape.association=="directional"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"openarrow",width:5,height:10}},t)),t.shape.association=="nondirectional"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"none"}},t)),t.shape.association=="bidirectional"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],lineWidth:2,lineDashArray:"2 2",targetDecorator:{shape:"openarrow",width:5,height:10}},t),t.sourceDecorator={shape:"openarrow",width:5,height:10})),t.shape.flow=="message"&&(t=$.extend(!0,{},{segments:[{type:"straight"}],sourceDecorator:{shape:"circle",fillColor:"white"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"},t))),t.shape&&t.shape.type=="umlclassifier"&&(t=ej.datavisualization.Diagram.UMLConnectorShape(t)),ej.datavisualization.Diagram.Util._initConnectionEnds(t,this),ej.datavisualization.Diagram.Connector(t)},_setOverview:function(n,t){var i,r,u;n?(this._overview=n,this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),this._views[n._id]||(this._views.push(n._id),this._views[n._id]={context:ej.datavisualization.Diagram.SvgContext,type:"overview"},n._renderDocument(this._views[n._id]),i=this._views[n._id],r=this._setNodeZOrder(i),this._renderDiagramObjects(r,i,null,!0),n._updateOverview(i)),delete this._viewPort):(n=$("#"+t).ejOverview("instance"),n._removeDocument(this._views[t]),this._views[t]=undefined,u=this._views.indexOf(t),this._views.splice(u,1))},_updateScrollOffset:function(n,t,i){this._hScrollOffset=Number(n);this._vScrollOffset=Number(t);this._verticalOffset(Number(t));this._horizontalOffset(Number(n));this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);ej.datavisualization.Diagram.ScrollUtil._transform(this,n,t,i);var r=this;this._views.forEach(function(i){var f=r._views[i],u;f.type=="overview"&&(u=$("#"+i).ejOverview("instance"),u&&u._scrollOverviewRect(n,t,r._currZoom))});this.model.scrollSettings.viewPortHeight=this._viewPort.height;this.model.scrollSettings.viewPortWidth=this._viewPort.width;this.model.scrollSettings.currentZoom=this._currZoom},_getChild:function(n){return ej.datavisualization.Diagram.Util.getChild(n)},_getChildren:function(n){var i,r,t;if(n){for(i=[],r=0;r<n.length;r++)t=n[r],t&&(typeof t=="object"?i.push(t.name):i.push(t));return i}},_initGroupNode:function(n,t){for(var i=null,r,u=0;n.children&&u<n.children.length;u++)r=t?$.extend(!0,{},t[this._getChild(n.children[u])]):n.children[u],i=typeof r=="string"?this.nameTable[r]:r,i._type||i.type!="umlclassifier"||(i._type="group"),i.container&&(i._type="group",i.labels=[]),r&&typeof r=="object"&&(typeof i.shape!="object"&&n.type!="bpmn"&&(i=ej.datavisualization.Diagram.NodeType(i,this)),i._type=="group"||i.children||i.segments||i.type=="connector"?i.segments||i.type=="connector"?(i=this._getNewConnector(i),i.name==""&&(i.name=ej.datavisualization.Diagram.Util.randomId())):(i=this._getNewGroup(i),i.name==""&&(i.name=ej.datavisualization.Diagram.Util.randomId()),this._initGroupNode(i)):(n.type!="bpmn"&&n.type!="umlclassifier"&&(i=this._getNewNode(i)),i.name==""&&(i.name=ej.datavisualization.Diagram.Util.randomId()),i._type=="node"&&i.labels.length&&(i.width==0||i.height==0)&&this._getNodeDimension(i)),n.children[u]=i,i.parent=n.name,this.nameTable[i.name]=i,i.segments&&this._dock(i,this.nameTable)),this._updateQuad(this.nameTable[this._getChild(n.children[u])]);this._isLoad||ej.datavisualization.Diagram.Util._updateGroupBounds(n,this)},_udpateChildRotateAngle:function(n){var f,t,i,r,u,e;if(n.rotateAngle)for(i=ej.Matrix.identity(),ej.Matrix.rotate(i,n.rotateAngle,n.offsetX,n.offsetY),r=0;r<n.children.length;r++)t=this.nameTable[this._getChild(n.children[r])],t.rotateAngle=t.rotateAngle?t.rotateAngle+n.rotateAngle:n.rotateAngle,t.rotateAngle%=360,t.rotateAngle<0&&(t.rotateAngle+=360),t.segments?(t.sourceNode||this._setEndPoint(t,ej.Matrix.transform(i,t.sourcePoint),!1),t.targetNode||this._setEndPoint(t,ej.Matrix.transform(i,t.targetPoint),!0)):(t.type=="group"&&this._udpateChildRotateAngle(t),u=t.offsetX,f=t.offsetY,e=ej.Matrix.transform(i,ej.datavisualization.Diagram.Point(u,f)),this._translate(t,e.x-u,e.y-f,this.nameTable),this._updateAssociatedConnectorEnds(t,this.nameTable))},_getNodeDimension:function(n){var f=n._width,e=n._height,o=n.width?n.width:n.maxWidth?n.maxWidth:n.minWidth,i=document.createElement("span"),s=0,h=0,t,r,u,c;if(n.labels.length){for(ej.datavisualization.Diagram.Util.attr(i,{id:n.name+"_label","class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal;"}),this.element[0].appendChild(i),r=0;r<n.labels.length;r++)t=n.labels[r],t.bold&&(i.style.fontWeight="bold"),t.italic&&(i.style.fontStyle="italic"),i.style.textDecoration=t.textDecoration,i.style.fontFamily=t.fontFamily,i.style.fontSize=t.fontSize+"px",i.style.color=t.fontColor,i.style.backgroundColor=t.fillColor,i.style.borderColor=t.borderColor,i.style.borderWidth=t.borderWidth+"px",i.textContent=t.text,t.wrapping=="nowrap"?(i.style.whiteSpace="nowrap",i.style.wordWrap="normal"):(t.wrapping=="wrap"&&(i.style.wordBreak="break-all"),i.style.wordWrap="break-word",i.style.whiteSpace="pre"),n.maxWidth&&(i.style.maxWidth=o-(t.margin.left+t.margin.right)-t.fontSize+"px"),n.minWidth&&(i.style.minWidth=o-(t.margin.left+t.margin.right)-t.fontSize+"px"),s+=i.offsetWidth+t.margin.left+t.margin.right+5,h+=i.offsetHeight+t.margin.top+t.margin.bottom;u=n.name.match("_attribute")?"attribute":n.name.match("_method")?"method":n.name.match("_member")?"member":"header";n._width=Math.max(n.minWidth||0,s||0);n.maxWidth&&(n._width=Math.min(n.maxWidth,n._width));n._height=Math.max(n.minHeight||0,h||0);n.maxHeight&&(n._height=Math.min(n.maxHeight,n._height));n.width||n.labels[0].horizontalAlignment!="left"||u=="attribute"||u=="method"||u=="member"||(n.offsetX+=(n._width-f)/2);n.width||n.labels[0].horizontalAlignment!="right"||(n.offsetX-=(n._width-f)/2);n.height||n.labels[0].verticalAlignment!="top"||(n.offsetY+=(n._height-e)/2);n.height||n.labels[0].verticalAlignment!="bottom"||(n.offsetY-=(n._height-e)/2);n.parent&&(c=this.nameTable[n.parent]);this.element[0].removeChild(i)}},_getMinMaxSize:function(n,t,i,r,u){var s=null,h=null,l,f,e,c,a,o;return t>=n.minWidth&&t<=n.maxWidth?s=t:n.horizontalAlign!="stretch"||!n.parent||r||u?u?(f=this.nameTable[n.parent],f&&(e=ej.datavisualization.Diagram.Util.bounds(f),o=this._getMinMaxSize(f,e.width,e.height),s=o.width?o.width:t)):s=t<n.minWidth&&n.minWidth!=0?n.minWidth:t>n.maxWidth&&n.maxWidth!=0&&!n.isSwimlane?n.maxWidth:t:(f=this.nameTable[n.parent],f&&(e=ej.datavisualization.Diagram.Util.bounds(f),e.width==0&&e.height==0&&(e.width=t,e.height=i),o=this._getMinMaxSize(f,e.width,e.height),f.isSwimlane&&f.orientation=="vertical"&&(l=this.nameTable[f.children[0]],l&&(o.height-=l.height)),o.width-=f.paddingLeft+f.paddingRight+f.marginLeft+f.marginRight,o.height-=f.paddingTop+f.paddingBottom+f.marginTop+f.marginBottom,s=o.width?o.width:t)),i>=n.minHeight&&i<=n.maxHeight?h=i:(f=this.nameTable[n.parent],n.verticalAlign!="stretch"||!n.parent||r||n.isLane?h=i<n.minHeight&&n.minHeight!=0?n.minHeight:i>n.maxHeight&&n.maxHeight!=0?n.maxHeight:i:(e=ej.datavisualization.Diagram.Util.bounds(f),e.width==0&&e.height==0&&(c=null,a=!1,e.width=n.minWidth,e.height=n.minHeight,(n.minWidth==0||n.minHeight==0)&&(e.width=t,e.height=i,c=!1,a=!0),a||(c=!0)),o=this._getMinMaxSize(f,e.width,e.height),o.width-=f.paddingLeft+f.paddingRight+f.marginLeft+f.marginRight,o.height-=f.paddingTop+f.paddingBottom+f.marginTop+f.marginBottom,c&&(o.height-=n.marginTop),h=o.height?o.height:i)),{width:s,height:h}},_updateConnectorBridging:function(n){var r=[],i,t;for(this.boundaryTable[n.name]=ej.datavisualization.Diagram.Util.bounds(n),n._intersects&&n._intersects.length&&(r=n._intersects),i=0;i<r.length;i++)t=this.nameTable[r[i]],t&&t.visible&&t.segments&&t!=n&&ej.datavisualization.Diagram.Util.canBridge(t,this)&&(ej.datavisualization.Diagram.Util.updateBridging(t,this,[n]),this._disableSegmentChange||ej.datavisualization.Diagram.DiagramContext._refreshOnlySegments(t,this))},_drawToolShape:function(n,t){n=="image"||n=="native"||n=="html"||n==="text"||n==="basic"||n==="flow"||n==="arrow"||n==="bpmn"?this.activateTool("shapeTool",t):n=="straightLine"?this.activateTool("straightLine",t):n=="orthogonalLine"?this.activateTool("orthogonalLine",t):n=="bezierLine"&&this.activateTool("bezierLine",t)},_destroy:function(){this.element.empty().removeClass("e-datavisualization-diagram");var n=$("#"+this.element[0].id+"_contextMenu").data("ejMenu");n.destroy();$("#"+this.element[0].id+"_contextMenu").remove()},_updateScrollSettings:function(n){var u=this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Limited?!0:!1,r=this.model.pageSettings.scrollableArea,f=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),e,t,i,o;(n.horizontalOffset!==undefined||n.verticalOffset!==undefined)&&(e={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:f},n.horizontalOffset&&(t=Number(typeof n.horizontalOffset=="function"?n.horizontalOffset():n.horizontalOffset),(!u||t>=r.x&&t<=r.x+r.width)&&(this._scrollLimit()=="diagram"&&(t=Math.max(this._hScrollbar.model.minimum,t),t=Math.min(this._hScrollbar.model.maximum,t)),this._updateScrollOffset(t,this._verticalOffset()))),n.verticalOffset&&(i=Number(typeof n.verticalOffset=="function"?n.verticalOffset():n.verticalOffset),(!u||i>=r.y&&i<=r.y+r.height)&&(this._scrollLimit()=="diagram"&&(i=Math.max(this._vScrollbar.model.minimum,i),i=Math.min(this._vScrollbar.model.maximum,i)),this._updateScrollOffset(this._horizontalOffset(),i))),o={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:f},this._raiseEvent("scrollChange",{newValues:o,oldValues:e}));n.zoomFactor&&this.zoomFactor(typeof n.zoomFactor=="function"?n.zoomFactor():n.zoomFactor);n.padding&&($.extend(this.model.scrollSettings.padding,n.padding),this._updateScrollOffset(this._horizontalOffset(),this._verticalOffset()))},updatePageSettings:function(n){n&&(n.pageHeight&&this._pageHeight(Number(typeof n.pageHeight=="function"?n.pageHeight():n.pageHeight)),n.pageWidth&&this._pageWidth(Number(typeof n.pageWidth=="function"?n.pageWidth():n.pageWidth)),(typeof n.multiplePage=="function"||typeof n.multiplePage=="boolean")&&this._multiplePage(typeof n.multiplePage=="function"?n.multiplePage():n.multiplePage),(typeof n.showPageBreak=="function"||typeof n.showPageBreak=="boolean")&&this._showPageBreak(typeof n.showPageBreak=="function"?n.showPageBreak():n.showPageBreak),(n.pageBorderColor||n.pageBorderColor==="")&&this._pageOrientation(typeof n.pageOrientation=="function"?n.pageOrientation():n.pageOrientation),(n.pageBorderWidth||n.pageBorderWidth===0)&&this._pageBorderWidth(Number(typeof n.pageBorderWidth=="function"?n.pageBorderWidth():n.pageBorderWidth)),(n.pageMargin||n.pageMargin===0)&&this._pageMargin(Number(typeof n.pageMargin=="function"?n.pageMargin():n.pageMargin)),(n.pageBackgroundColor||n.pageBackgroundColor==="")&&this._pageBackgroundColor(typeof n.pageBackgroundColor=="function"?n.pageBackgroundColor():n.pageBackgroundColor),n.scrollLimit&&this._scrollLimit(typeof n.scrollLimit=="function"?n.scrollLimit():n.scrollLimit),n.scrollableArea&&(this.model.pageSettings.scrollableArea=n.scrollableArea),(n.pageBorderColor||n.pageBorderColor==="")&&this._pageBorderColor(typeof n.pageBorderColor=="function"?n.pageBorderColor():n.pageBorderColor),this._compareModelProperty("pageSettings"),ej.datavisualization.Diagram.PageUtil._updatePageSize(this),ej.datavisualization.Diagram.SvgContext._updateBackground(this._hScrollOffset,this._vScrollOffset,this._currZoom,this),ej.datavisualization.Diagram.SvgContext._updateGrid(this._hScrollOffset,this._vScrollOffset,this._currZoom,this))},_updateSnapSettings:function(n){n&&(n.horizontalGridLines&&n.horizontalGridLines.linesInterval&&(this.model.snapSettings.horizontalGridLines.linesInterval=n.horizontalGridLines.linesInterval),n.verticalGridLines&&n.verticalGridLines.linesInterval&&(this.model.snapSettings.verticalGridLines.linesInterval=n.verticalGridLines.linesInterval),n.snapAngle&&this._snapAngle(Number(typeof n.snapAngle=="function"?n.snapAngle():n.snapAngle)),n.snapObjectDistance&&this._snapObjectDistance(Number(typeof n.snapObjectDistance=="function"?n.snapObjectDistance():n.snapObjectDistance)))},_cloneObject:function(n){var t,i;if((this.getObjectType(n)==="node"||this.getObjectType(n)==="connector")&&n.type!="bpmn")return $.extend(!0,{},n);if(this.getObjectType(n)!=="group"&&n.type!=="bpmn"||n.isSwimlane){if(this.getObjectType(n)==="group"&&n.isSwimlane)return this.getNode(n)}else{for(t=$.extend(!0,{},n),i=0;t.children&&t.children.length>0&&i<t.children.length;i++)t.children[i]=this._cloneObject(this.nameTable[this._getChild(t.children[i])]),t.children[i].parent=t.name;return t}},_cloneSelectionList:function(){for(var n,i,r=[],t=0&&this.selectionList&&this.selectionList.length>0;t<this.selectionList.length;t++)if(this.getObjectType(this.selectionList[t])==="pseudoGroup")for(n=this.selectionList[0],i=0;n.children&&n.children.length>0&&i<n.children.length;i++)r.push(this._cloneObject(this.nameTable[this._getChild(n.children[i])]));else r.push(this._cloneObject(this.selectionList[t]));return r},getNode:function(n,t){if(n)return this._getNode(n,t)},addPhase:function(n,t){this._addPhase(n,t)},stopEvents:function(n){this.activeTool.inAction&&!n.originalEvent.target&&n.target&&(n.originalEvent.target=n.target,this._mouseup(n))},_updateSwimlanePhase:function(n,t){var i,r;n&&t&&(t.label&&(i=this.nameTable[n.name],i&&(this._comparePropertyValues(n,"label",t),t.label=$.extend(!0,{},t.label),t.label.rotateAngle=t.orientation==="vertical"?270:0,t.label.name=i.labels[0].name,t.label.mode=ej.datavisualization.Diagram.LabelEditMode.View,n.label=t.label,this.updateLabel(i.name,i.labels[0],n.label))),(t.lineColor||t.lineDashArray||t.lineWidth)&&(r={},t.lineColor&&(this._comparePropertyValues(n,"lineColor",t),n.lineColor=t.lineColor,r.stroke=t.lineColor),t.lineDashArray&&(this._comparePropertyValues(n,"lineDashArray",t),n.lineDashArray=t.lineDashArray,r["stroke-dasharray"]=t.lineDashArray),t.lineWidth&&(this._comparePropertyValues(n,"lineWidth",t),n.lineWidth=t.lineWidth,r["stroke-width"]=t.lineWidth),ej.datavisualization.Diagram.SvgContext._updatePhaseStyle(n,r,this)),t.fillColor&&(this._comparePropertyValues(n,"fillColor",t),n.fillColor=t.fillColor,ej.datavisualization.Diagram.DiagramContext.updateNodeStyle(n,this)))},_updateNodeVisibility:function(n,t){var u,r,i,f;if(n){if(n.type==="group")for(i=0;i<n.children.length;i++)u=this.nameTable[n.children[i]],u&&this._updateNodeVisibility(u,t);if(n.isSwimlane&&(r=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,n),r))for(i=0;i<r.length;i++)f=this.nameTable[r[i]],f.visible=t.visible,ej.datavisualization.Diagram.SvgContext._updatePhaseStyle(f,t,this);n.visible=t.visible}},_compareInnerProperties:function(n,t){var r=!0,i;if(n&&t)for(i in t)if(typeof n[i]=="object"){if(r=this._compareInnerProperties(n[i],t[i]),!r)return!1}else if(n[i]!==t[i])return!1;return!0},_comparePropertyValues:function(n,t,i,r,u){var e,c;if(n){var f=null,s=n,h=i,o=t.split("."),l=o.length;if(l>1)for(e=0;l>e;)if(s=s[o[e]],h=h[o[e]],e++,s&&h)e==l-1&&s[o[e]]!=h[o[e]]&&(f={element:n,cause:u?u:r?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:o[0],oldValue:s,newValue:h},this._raisePropertyChange(f));else break;else f={cause:u?u:r?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:t,oldValue:n[t],newValue:i[t]},t==="labels"||t==="ports"||t==="segments"||(typeof n[t]!="object"||this._compareInnerProperties(n[t],i[t]))&&n[t]&&(typeof n[t]=="object"||n[t]==i[t])?t==="segments"?n[t]!=i[t]&&(f.element=n):(t==="labels"||t==="ports")&&n[t].length>0&&(c=t==="ports"?this._findPort(n,i.name):this._findLabel(n,i.name),this._compareInnerProperties(c,i)||(f.element=c,f.oldValue=c,f.newValue=i)):f.element=n,f.element&&this._raisePropertyChange(f)}},updateNode:function(n,t){var r,y,p,o,s,w,c,i,l;if(n){var i=this._findNode(n),a=ej.Matrix.identity(),b,f,e,h,u=ej.datavisualization.Diagram.NodeConstraints,v=i&&(i.isSwimlane||i.isLane||i.isPhase||i.type==="phase");(v||!v)&&(this._needUpdate=!1,r=null,i&&(this._isUndo||this._isSizingCommand||this._recordPropertiesChanged(i,t,"node"),t.pivot!=undefined&&(b=ej.datavisualization.Diagram.Util.bounds(i,!0),ej.Matrix.rotate(a,i.rotateAngle,i.offsetX,i.offsetY),t.pivot.x!==undefined&&(this._comparePropertyValues(i,"pivot.x",t),y=t.pivot.x-i.pivot.x,i.pivot.x=t.pivot.x,i.offsetX+=y*(i.width||i._width||0)),t.pivot.y!==undefined&&(this._comparePropertyValues(i,"pivot.y",t),p=t.pivot.y-i.pivot.y,i.pivot.y=t.pivot.y,i.offsetY+=p*(i.height||i._height||0)),h=ej.Matrix.transform(a,{x:i.offsetX,y:i.offsetY}),i.offsetX=h.x,i.offsetY=h.y),t.offsetX!=undefined&&(f=t.offsetX-i.offsetX,r={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"offsetX",oldValue:i.offsetX,newValue:i.offsetX+f},this._raisePropertyChange(r),this._translate(i,f,0,this.nameTable),i.marginLeft!=0&&(i.marginLeft+=f)),t.offsetY!=undefined&&(e=t.offsetY-i.offsetY,r={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"offsetY",oldValue:i.offsetY,newValue:i.offsetY+e},this._raisePropertyChange(r),this._translate(i,0,e,this.nameTable),i.marginTop!=0&&(i.marginTop+=e)),t.rotateAngle!=undefined&&(this._comparePropertyValues(i,"rotateAngle",t),this._rotate(i,t.rotateAngle-i.rotateAngle,this.nameTable)),i.isSwimlane||i.isLane?this._updateSwimlaneSize(i,t):(t.width!=undefined&&(i.width=i.width?i.width:1,r={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"width",oldValue:i.width,newValue:t.width},this._raisePropertyChange(r),o=!1,s=i.isLane?!0:!1,this.scale(i,t.width/i.width,1,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable,o,s),i.type==="bpmn"&&i._type==="group"&&ej.datavisualization.Diagram.Util._updateGroupBounds(i,this)),t.height!=undefined&&(i.height=i.height?i.height:1,r={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"height",oldValue:i.height,newValue:t.height},this._raisePropertyChange(r),o=!1,s=i.isLane?!0:!1,this.scale(i,1,t.height/i.height,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable,o,s),i.type==="bpmn"&&i._type==="group"&&ej.datavisualization.Diagram.Util._updateGroupBounds(i,this))),t.connectorPadding!=undefined&&(this._comparePropertyValues(i,"connectorPadding",t),i.connectorPadding=t.connectorPadding,this.scale(i,1,1,new ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable)),t.visible!=undefined&&(this._comparePropertyValues(i,"visible",t),this._updateNodeVisibility(i,t),t.visible||this._clearSelection()),t.constraints!=undefined&&(this._comparePropertyValues(i,"constraints",t),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(i._type!="group"&&(i.constraints&u.Shadow||t.constraints&u.Shadow)&&(!(i.constraints&u.Shadow)&&t.constraints&u.Shadow?(i.constraints=t.constraints,ej.datavisualization.Diagram.DiagramContext.renderShadow(i,this)):i.constraints&u.Shadow&&!(t.constraints&u.Shadow)&&(i.constraints=t.constraints,ej.datavisualization.Diagram.DiagramContext.removeShadow(i,this))),i.constraints=t.constraints,this.selectionList[0]&&this.selectionList[0].name===i.name&&(ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._adornerSvg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,this.selectionList[0].type==="pseudoGroup",this._currZoom,this._adornerLayer,this)))),t.fillColor!=undefined&&(this._comparePropertyValues(i,"fillColor",t),i.fillColor=t.fillColor),t.cssClass!=undefined&&(this._comparePropertyValues(i,"cssClass",t),i.cssClass=t.cssClass),t.opacity!=undefined&&(this._comparePropertyValues(i,"opacity",t),i.opacity=t.opacity),t.borderColor!=undefined&&(this._comparePropertyValues(i,"borderColor",t),i.borderColor=t.borderColor),t.borderWidth!=undefined&&(this._comparePropertyValues(i,"borderWidth",t),i.borderWidth=t.borderWidth),t.borderDashArray!=undefined&&(this._comparePropertyValues(i,"borderDashArray",t),i.borderDashArray=t.borderDashArray),t.shadow!=undefined&&(this._comparePropertyValues(i,"shadow",t),i.shadow=ej.datavisualization.Diagram.Shadow($.extend(!0,i.shadow,{},t.shadow)),ej.datavisualization.Diagram.DiagramContext.updateShadow(i,this)),t.gradient!==undefined&&(this._comparePropertyValues(i,"gradient",t),i.gradient=t.gradient===null?t.gradient:t.gradient&&t.gradient.type==="radial"?ej.datavisualization.Diagram.RadialGradient(t.gradient):ej.datavisualization.Diagram.LinearGradient(t.gradient)),t.isExpanded!==undefined&&(this._comparePropertyValues(i,"isExpanded",t),i._updateExpander=!0,t.isExpanded?(i.isExpanded=!0,this._expandChildren(i)):(i.isExpanded=!1,this._collapseChildren(i)),this._selectionContains(i)&&(w=!0,this._clearSelection(!0)),this.layout(),w&&this._addSelection(i,!0)),t.tooltip!==undefined&&(this._comparePropertyValues(i,"tooltip",t),i.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,i.tooltip,{},t.tooltip))),t.excludeFromLayout!=undefined&&(this._comparePropertyValues(i,"excludeFromLayout",t),i.excludeFromLayout=t.excludeFromLayout,this.layout()),t.addInfo!=undefined&&(this._comparePropertyValues(i,"addInfo",t),i.addInfo=t.addInfo),t.maxWidth!=undefined&&(this._comparePropertyValues(i,"maxWidth",t),i.maxWidth=t.maxWidth),t.maxHeight!=undefined&&(this._comparePropertyValues(i,"maxHeight",t),i.maxHeight=t.maxHeight),i=this._findNode(n),t.shape&&typeof t.shape=="object"&&(this._comparePropertyValues(i,"shape",t),ej.datavisualization.Diagram.Util._updateShapeProperties(t),i.type=="html"&&(c=document.getElementById(i.name+"_parentdiv"),c.parentNode.removeChild(c)),ej.datavisualization.Diagram.DiagramContext.setNodeShape(i,this)),this.getObjectType(i)=="node"&&(i=this._updateShape(i,t)),i&&i.type!="phase"&&(ej.datavisualization.Diagram.DiagramContext.update(i,this),i.type=="bpmn"?ej.datavisualization.Diagram.DiagramContext.updateBPMNNodeStyle(i,this):ej.datavisualization.Diagram.DiagramContext.updateNodeStyle(i,this)),this.selectionList[0]&&this.selectionList[0].name===i.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)));n&&(i=this._findNode(n),i&&i._type==="node"&&t&&t.type==="group"&&t.children&&t.children.length>0&&(l=!1,this._svg.document.getElementById(i.name)&&(l=!0),this.remove(i),i.borderColor="transparent",i.borderDashArray="",i.borderWidth=1,i.fillColor="#1BA0E2",i.labels=[],i.fillColor="",i.type=t.type,i.children=t.children,i=ej.datavisualization.Diagram.Group(i),this._initGroupNode(i),l&&(ej.datavisualization.Diagram.Util._updateGroupBounds(i,this),this.add(i))));i&&(i.isLane||i.isSwimlane||i.type==="phase"||i.isPhase)&&(this._needUpdate=!0,i.isLane?this._updateLane(i,t):i.isSwimlane?(this._needUpdate=!1,this._updateSwimlane(i,t,!0)):(i.type==="phase"||i.phase)&&(this._needUpdate=!1,this._updateSwimlanePhase(i,t)))}},_updateSwimlaneSize:function(n,t){var o,f,e,r,i,u;if(n)if(t.height&&(this._comparePropertyValues(n,"height",t),o=t.height-n.height,this._comparePropertyValues(n,"offsetY",{offsetY:n.offsetY+o/2})),t.width&&(this._comparePropertyValues(n,"width",t),o=t.width-n.width,this._comparePropertyValues(n,"offsetX",{offsetX:n.offsetX+o/2})),n.isSwimlane&&(t.height||t.width)){if(r=ej.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(this,n),r.length>0&&(f=this.nameTable[r[r.length-1]],f)){if(n.orientation==="vertical"){if(t.width&&t.width>n.width&&(f.minWidth=f.width+t.width-n.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,f,!0)),t.height)for(i=0;i<r.length;i++)u=this.nameTable[r[i]],t.height>=n.height&&(u.minHeight=t.height)}else{if(t.width)for(i=0;i<r.length;i++)u=this.nameTable[r[i]],t.width>=n.width&&(u.minWidth=t.width);t.height&&t.height>n.height&&(f.minHeight=f.height+t.height-n.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,f,!0))}ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this);ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,n,!0);ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,n)}}else if(n.isLane&&(t.height||t.width)){if(e=this.nameTable[n.parent.split("laneStack")[0]],r=ej.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(this,e),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),e&&e.orientation==="vertical"){if(t.width&&(t.minWidth=t.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,n,!0)),t.height)for(i=0;i<r.length;i++)u=this.nameTable[r[i]],t.height>=u.height&&(u.minHeight=t.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,u,!0))}else{if(t.width)for(i=0;i<r.length;i++)u=this.nameTable[r[i]],t.width>=u.width&&(u.minWidth=t.width,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,u,!0));t.height&&(t.minHeight=t.height,ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,n,!0))}ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,e,!0);ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,e)}},_updateShape:function(n,t){var i=!1,u,r,f;return t.type&&(this._comparePropertyValues(n,"type",t),n.type=n._shape=t.type,i=!0),t.shape&&(this._comparePropertyValues(n,"shape",t),n.shape=n._shape=t.shape,i=!0),n.type!="bpmn"?(t.cornerRadius!=undefined&&(this._comparePropertyValues(n,"cornerRadius",t),n.cornerRadius=t.cornerRadius,i=!0),t.pathData&&(this._comparePropertyValues(n,"pathData",t),n.pathData=t.pathData,i=!0),t.templateId!==undefined&&(n.templateId=t.templateId,i=!0),t.html!==undefined&&(this._comparePropertyValues(n,"html",t),n.html=t.html,i=!0),t.contentId!==undefined&&(this._comparePropertyValues(n,"contentId",t),n.contentId=t.contentId,i=!0),t.source&&(this._comparePropertyValues(n,"source",t),n.source=t.source,i=!0),t.textBlock&&(this._comparePropertyValues(n,"textBlock",t),n.textBlock=t.textBlock,i=!0),t.points&&(this._comparePropertyValues(n,"points",t),n.points=t.points,i=!0),i&&(n.children&&delete n.children,n=ej.datavisualization.Diagram.NodeType(n,this),u=document.getElementById(n.name+"_parentdiv"),u&&u.parentNode.removeChild(u),ej.datavisualization.Diagram.DiagramContext.setNodeShape(n,this),this._clearSelection(!0),this._addSelection(n,!0))):(r=$.extend(!0,{},this.nameTable[n.name]),t.event&&(this._comparePropertyValues(n,"event",t),r.event=t.event,i=!0),t.trigger&&(this._comparePropertyValues(n,"trigger",t),r.trigger=t.trigger,i=!0),t.gateway&&(this._comparePropertyValues(n,"gateway",t),r.gateway=t.gateway,i=!0),t.data&&(this._comparePropertyValues(n,"data",t),r.data=$.extend(r.data,t.data),i=!0),t.activity&&(this._comparePropertyValues(n,"activity",t),r.activity=t.activity,i=!0),t.task!==undefined&&(this._comparePropertyValues(n,"task",t),r.task=$.extend(r.task,t.task),i=!0),t.annotation!==undefined&&(this._comparePropertyValues(n,"annotation",t),r.annotation=$.extend(r.annotation,t.annotation),i=!0),t.subProcess!==undefined&&(this._comparePropertyValues(n,"subProcess",t),r.subProcess=$.extend(r.subProcess,t.subProcess),i=!0),t.direction&&(this._comparePropertyValues(n,"direction",t),r.direction=t.direction,i=!0),i&&(f=this._svg.getElementById(n.name).nextSibling,this._removeElement(n),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[n.name],n),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[n.name]),this._nodes=$.extend(!0,[],this.nodes()),n=ej.datavisualization.Diagram.NodeType(r,this),n=this._getNewGroup(n),this._initGroupNode(n),this.nameTable[n.name]=n,this.nodes().push(n),this._nodes=$.extend(!0,[],this.nodes()),this._updateQuad(n),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this),f&&this._svg.getElementById(n.name).parentNode.insertBefore(this._svg.getElementById(n.name),this._svg.getElementById(f.id)),this._clearSelection(!0),this._addSelection(n,!0))),n},_updateObject:function(n){var r,i,t,u;if(n)if(n.type=="pseudoGroup")for(i=this._getChildren(n.children),t=0,u=i.length;t<u;t++)r=this.nameTable[i[t]],ej.datavisualization.Diagram.DiagramContext.update(r,this);else n.parent&&ej.datavisualization.Diagram.Util._updateGroupBounds(this.nameTable[n.parent],this),ej.datavisualization.Diagram.DiagramContext.update(n,this)},_udatePhaseSize:function(n,t){var i=this.nameTable[this._getChild(n.children[1])],s,o,h,f,u,r,e;if(n.orientation==="vertical"){if(i.minWidth!=t.phaseSize){if(i.width=i.maxWidth,i.minWidth=t.phaseSize,s=i.maxWidth-t.phaseSize,o=t.phaseSize/i.maxWidth,i.maxWidth=t.phaseSize,this.scale(i,o,.0001,ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable),i.children&&i.children.length>0)for(u=0;u<i.children.length;u++)r=this.nameTable[this._getChild(i.children[u])],r&&this.scale(r,o,.0001,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable);e=this.nameTable[this._getChild(n.children[2])];e.marginLeft-=s}}else if(n.orientation==="horizontal"&&i.minHeight!=t.phaseSize){if(i.height=i.maxHeight,i.minHeight=t.phaseSize,h=i.maxHeight-t.phaseSize,f=t.phaseSize/i.maxHeight,f=f===Infinity?0:f,i.maxHeight=t.phaseSize,this.scale(i,.0001,f,ej.datavisualization.Diagram.Point(i.offsetX,i.offsetY),this.nameTable),i.children&&i.children.length>0)for(u=0;u<i.children.length;u++)r=this.nameTable[this._getChild(i.children[u])],r&&this.scale(r,.0001,f,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable);e=this.nameTable[this._getChild(n.children[2])];e.marginTop-=h}},_updateLane:function(n,t){var u,i,e,f,r;n&&t&&(t.header&&(this._comparePropertyValues(this.getNode(n.name),"header",t),n.children&&n.children.length>0&&(u=this._getChild(n.children[0]),u&&(i=this.nameTable[u]),i&&(e=this._isUndo,this._isUndo=!0,this.updateLabel(i.name,i.labels[0],t.header),this._isUndo=e,t.header.fillColor&&t.header.fillColor!=i.fillColor&&this.updateNode(i.name,{fillColor:t.header.fillColor})))),t.fillColor&&t.fillColor!=n.fillColor&&(this._comparePropertyValues(n,"fillColor",t),this.updateNode(n.name,{fillColor:t.fillColor})),(t.minHeight&&t.minHeight!=n.minHeight||t.minWidth&&t.minWidth!=n.minWidth)&&(t.minHeight&&(this._comparePropertyValues(n,"minHeight",t),n.minHeight=t.minHeight),t.minWidth&&(this._comparePropertyValues(n,"minWidth",t),n.minWidth=t.minWidth),f=this.nameTable[n.parent],f&&(r=this.nameTable[f.parent],r&&ej.datavisualization.Diagram.SwimLaneContainerHelper._updateSwimlane(this,r)),ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,r),ej.datavisualization.Diagram.SvgContext.updateSelector(r,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)),t.constraints&&t.constraints!=n.constraints&&(this._comparePropertyValues(n,"constraints",t),n.constraints=t.constraints))},_updateLastPhase:function(n,t,i){var r,u,e,f;n.isSwimlane&&n.phases&&n.phases.length==1&&(r=0,u=this.nameTable[n.phases[0]],n.orientation==="horizontal"?(u.offset=n.minWidth-r,this.updateNode(this.nameTable["phaseStack"+n.phases[0]].name,{width:n.minWidth-r}),i&&(f=ej.datavisualization.Diagram.Util.bounds(n),this.updateNode(this.nameTable["phaseStack"+n.phases[0]].name,{offsetX:f.x+n.width/2}))):n.orientation==="vertical"&&(u.offset=n.minHeight-r,e=u.offset-r,e=e-(t.header?t.header.height:50),this.updateNode(this.nameTable["phaseStack"+n.phases[0]].name,{height:e}),i&&(f=ej.datavisualization.Diagram.Util.bounds(n),this.updateNode(this.nameTable["phaseStack"+n.phases[0]].name,{offsetY:(t.header?t.header.height:50)/2+f.y+n.height/2}))))},_updateSwimlane:function(n,t,i){var o,f,l,a,v,u,p,c,r,e;if(t.header&&n.children&&n.children.length>0&&(o=this._getChild(n.children[0]),o&&(f=this.nameTable[o]),f&&(l=this._isUndo,this._isUndo=!0,this._comparePropertyValues(this.getNode(n.name),"header",t),this.updateLabel(f.name,f.labels[0],$.extend({},t.header,{width:50})),t.header.fillColor&&t.header.fillColor!=f.fillColor&&this.updateNode(f.name,{fillColor:t.header.fillColor}),this._isUndo=l)),t.offsetX&&t.offsetX!=n.offsetX&&(this._comparePropertyValues(this.getNode(n.name),"offsetX",t),a=t.offsetX-n.offsetX,this._translate(n,a,0,this.nameTable)),t.offsetY&&t.offsetY!=n.offsetY&&(this._comparePropertyValues(this.getNode(n.name),"offsetY",t),v=t.offsetY-n.offsetY,this._translate(n,0,v,this.nameTable)),t.phases&&t.phases.length>0)for(r=0;r<t.phases.length;r++)u=this.nameTable[this._getChild(t.phases[r])],u&&this._updateSwimlanePhase(u,t.phases[r],!0);if(i&&(t.phaseSize||t.phaseSize===0)&&t.phaseSize!==n.phaseSize){this._comparePropertyValues(this.getNode(n.name),"phaseSize",t);t.phaseSize!=n.phaseSize&&(p=!0);var s=this.nameTable[n.name+"phaseStack"],y=this.nameTable[n.name+"laneStack"],u,h=t.phaseSize-n.phaseSize;for(r=0;r<s.children.length;r++)u=this.nameTable[this._getChild(s.children[r])],u&&(t.phaseSize=t.phaseSize===0?.0001:t.phaseSize,n.orientation==="horizontal"?u.height=t.phaseSize:u.width=t.phaseSize);n.phaseSize+=h;n.orientation==="horizontal"?y.marginTop+=h:y.marginLeft+=h;ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,s,null,n)}if(t.lanes&&t.lanes.length>0)for(r=0;r<t.lanes.length;r++)c=this.nameTable[this._getChild(t.lanes[r])],c&&this._updateLane(c,t.lanes[r]);i||(t&&t.phaseSize&&(e=!1),t.minHeight&&t.minHeight!=n.minHeight&&(this._comparePropertyValues(this.getNode(n.name),"minHeight",t),n.minHeight=t.minHeight,e=!0),t.minWidth&&t.minWidth!=n.minWidth&&(this._comparePropertyValues(this.getNode(n.name),"minWidth",t),n.minWidth=t.minWidth,e=!0),t.maxHeight&&t.maxHeight!=n.maxHeight&&(this._comparePropertyValues(this.getNode(n.name),"maxHeight",t),n.minHeight=t.maxHeight,e=!0),t.maxWidth&&t.maxWidth!=n.maxWidth&&(this._comparePropertyValues(this.getNode(n.name),"maxWidth",t),n.minWidth=t.maxWidth,e=!0),e&&!this._isUndo&&this._updateLastPhase(n,t),(t.phaseSize||t.phaseSize===0)&&t.phaseSize!=n.phaseSize&&(this._comparePropertyValues(this.getNode(n.name),"phaseSize",t),this._udatePhaseSize(n,t),t.phaseSize===0&&(n.phaseSize=0)));ej.datavisualization.Diagram.DiagramContext.update(n,this);this.selectionList[0]&&this.selectionList[0].name===n.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(n,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)},updateConnector:function(n,t){var i,f,e,u,r;n&&(i=this._findConnector(n),i&&(this._isUndo||this._recordPropertiesChanged(i,t,"connector"),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&t.constraints!==undefined&&(this._comparePropertyValues(i,"constraints",t),i.constraints=t.constraints),t.lineColor&&(this._comparePropertyValues(i,"lineColor",t),i.lineColor=t.lineColor),(t.cssClass||t.cssClass==="")&&(this._comparePropertyValues(i,"cssClass",t),i.cssClass=t.cssClass),(t.lineWidth||t.lineWidth===0)&&(this._comparePropertyValues(i,"lineWidth",t),i.lineWidth=t.lineWidth),t.lineDashArray!==undefined&&(this._comparePropertyValues(i,"lineDashArray",t),i.lineDashArray=t.lineDashArray),t.opacity!==undefined&&(this._comparePropertyValues(i,"opacity",t),i.opacity=t.opacity),t.cornerRadius!==undefined&&(this._comparePropertyValues(i,"cornerRadius",t),i.cornerRadius=t.cornerRadius),t.lineHitPadding!==undefined&&(this._comparePropertyValues(i,"lineHitPadding",t),i.lineHitPadding=t.lineHitPadding),t.sourcePadding!=undefined&&(this._comparePropertyValues(i,"sourcePadding",t),i.sourcePadding=t.sourcePadding,this._dock(i,this.nameTable)),t.targetPadding!=undefined&&(this._comparePropertyValues(i,"targetPadding",t),i.targetPadding=t.targetPadding,this._dock(i,this.nameTable)),t.visible!=undefined&&(this._comparePropertyValues(i,"visible",t),i.visible=t.visible,t.visible||this._clearSelection()),t.bridgeSpace!=undefined&&(this._comparePropertyValues(i,"bridgeSpace",t),i.bridgeSpace=t.bridgeSpace),t.tooltip!==undefined&&(this._comparePropertyValues(i,"tooltip",t),i.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,i.tooltip,{},t.tooltip))),t.segments&&(this._comparePropertyValues(i,"segments",t),t.segments.length>1?(f=$.extend(!0,[],t.segments),i.segments=f):i.segments=t.segments,ej.datavisualization.Diagram.Util._initConnectionEnds(i,this),this.model.defaultSettings.connector&&this.model.defaultSettings.connector.segments&&this.model.defaultSettings.connector.segments.length&&(e=this.model.defaultSettings.connector.segments[0].type),ej.datavisualization.Diagram.Util._initializeSegments(i,e),this._dock(i,this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(i,this),i==this.selectionList[0]&&(this._clearSelection(!0),this._addSelection(i))),t.targetDecorator&&(this._comparePropertyValues(i,"targetDecorator",t),u=i.targetDecorator?$.extend(!0,{},i.targetDecorator,t.targetDecorator):ej.datavisualization.Diagram.Decorator(t.targetDecorator),i.targetDecorator=u),t.sourceDecorator&&(this._comparePropertyValues(i,"sourceDecorator",t),u=i.sourceDecorator?$.extend(!0,{},i.sourceDecorator,t.sourceDecorator):ej.datavisualization.Diagram.Decorator(t.sourceDecorator),i.sourceDecorator=u),(t.sourceDecorator||t.targetDecorator)&&(ej.datavisualization.Diagram.DiagramContext.clearDecorators(i,this),ej.datavisualization.Diagram.DiagramContext.renderDecorators(i,this)),(t.hasOwnProperty("sourceNode")||t.hasOwnProperty("targetNode")||t.hasOwnProperty("targetPort")||t.hasOwnProperty("sourcePort")||t.hasOwnProperty("targetPoint")||t.hasOwnProperty("sourcePoint"))&&(t.sourceNode!==undefined&&(this._comparePropertyValues(i,"sourceNode",t),r=this.nameTable[i.sourceNode],r&&r.outEdges.indexOf(i.name)!=-1&&ej.datavisualization.Diagram.Util.removeItem(r.outEdges,i.name),i.sourceNode=t.sourceNode),t.targetNode!==undefined&&(this._comparePropertyValues(i,"targetNode",t),r=this.nameTable[i.targetNode],r&&r.inEdges.indexOf(i.name)!=-1&&ej.datavisualization.Diagram.Util.removeItem(r.inEdges,i.name),i.targetNode=t.targetNode),t.targetPort!==undefined&&(this._comparePropertyValues(i,"targetPort",t),i.targetPort=t.targetPort),t.sourcePort!==undefined&&(this._comparePropertyValues(i,"sourcePort",t),i.sourcePort=t.sourcePort),t.targetPoint!==undefined&&(this._comparePropertyValues(i,"targetPoint",t),ej.datavisualization.Diagram.Util._setLineEndPoint(i,t.targetPoint,!0)),t.sourcePoint!==undefined&&(this._comparePropertyValues(i,"sourcePoint",t),ej.datavisualization.Diagram.Util._setLineEndPoint(i,t.sourcePoint,!1)),this._updateEdges(i),this._dock(i,this.nameTable)),ej.datavisualization.Diagram.Util.updateBridging(i,this),this._svg&&(this._updateConnectorBridging(i),ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.DiagramContext.updateConnectorStyle(i,this)),this.selectionList[0]&&this.selectionList[0].name===i.name&&ej.datavisualization.Diagram.SvgContext.updateSelector(i,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)))},_updateDrawType:function(n){var u,i=!1,r,e=n.tool,t,s;if(e&ej.datavisualization.Diagram.Tool.ContinuesDraw?i=!1:e&ej.datavisualization.Diagram.Tool.DrawOnce&&(i=!0),t=n.drawType?n.drawType:this.model.drawType,t)if(t.type==="connector"){var f=this.model.defaultSettings.connector,h=f&&f.segments&&f.segments.length?f.segments[0].type:"",o=t.segments&&t.segments.length&&t.segments[0].type?t.segments[0].type:h;o==="bezier"?this.activateTool("bezierLine",i):o==="orthogonal"?this.activateTool("orthogonalLine",i):this.activateTool("straightLine",i)}else if(t.type==="text")this.activateTool("text",i);else if(t.type||t.shape){u=t.shape?t.shape:t.type;t.type=="basic"?r=ej.datavisualization.Diagram.BasicShapes:t.type=="flow"?r=ej.datavisualization.Diagram.FlowShapes:t.type=="arrow"?r=ej.datavisualization.Diagram.ArrowShapes:t.type=="bpmn"&&(r=ej.datavisualization.Diagram.BPMNShapes);for(s in r)if(r[s]==t.shape){u=t.type;break}u&&this._drawToolShape(u,i)}},update:function(n){var t,u,r,f,i;if(n.scrollSettings&&(this._eventCause.scrollChange=ej.datavisualization.Diagram.ScrollChangeCause.Unknown,this._setModel({scrollSettings:n.scrollSettings})),n.backgroundColor&&this._setModel({backgroundColor:n.backgroundColor}),n.tool&&(this.activeTool._showAllPorts(!0),t=n.tool,this.tool(t),this._compareModelProperty("tool"),t&ej.datavisualization.Diagram.Tool.ContinuesDraw||t&ej.datavisualization.Diagram.Tool.DrawOnce?this._updateDrawType(n):t&ej.datavisualization.Diagram.Tool.ZoomPan?ej.datavisualization.Diagram.Util.canPanning(this)&&(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._isMouseDown=!1,this._currentCursor="pointer"):t&ej.datavisualization.Diagram.Tool.MultipleSelect&&this.activateTool("select",!1)),n.bridgeDirection)for(this.bridgeDirection(n.bridgeDirection),this._compareModelProperty("bridgeDirection"),u=this.connectors(),r=0,f=u.length;r<f;r++)i=u[r],i&&ej.datavisualization.Diagram.Util.canBridge(i,this)&&(ej.datavisualization.Diagram.Util.updateBridging(i,this),ej.datavisualization.Diagram.DiagramContext.update(i,this))},bringToCenter:function(n){var t=this._currZoom,r=this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),i={x:n.x*t,y:n.y*t,width:n.width*t,height:n.height*t},u=i.x+i.width/2-r.width/2,f=i.y+i.height/2-r.height/2;ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1,this._hScrollOffset-u,this._vScrollOffset-f,null,!1)},bringIntoView:function(n){var r=0,u=0,t=this._currZoom,o;n.right=n.right?n.right:n.x+n.width;n.bottom=n.bottom?n.bottom:n.y+n.height;var f=this._hScrollOffset,e=this._vScrollOffset,i=this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);n={x:n.x*t,y:n.y*t,width:n.width*t,height:n.height*t,right:n.right*t,bottom:n.bottom*t};o={x:this._hScrollOffset,y:this._vScrollOffset,width:i.width,height:i.height};ej.datavisualization.Diagram.Geometry.containsRect(o,n)||(n.right>-f+i.width&&(r=n.right-i.width),n.x<-f&&(r=n.x),n.bottom>-e+i.height&&(u=n.bottom-i.height),n.y<-e&&(u=n.y),ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1,this._hScrollOffset-r,this._vScrollOffset-u,null,!1))},getBridgeSegment:function(n,t,i,r,u){return"A "+r/2+" "+r/2+"  "+i+" , 1 "+u+" "+t.x+","+t.y},fitToPage:function(n,t,i){var r,f,s={},u,o=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0),c,a,l,e,h,v;if(i=i||{},i={top:isNaN(i.top)?25:i.top,bottom:isNaN(i.bottom)?25:i.bottom,left:isNaN(i.left)?25:i.left,right:isNaN(i.right)?25:i.right},t=t?t:"pageSettings",t=="pageSettings"&&this.model.pageSettings.pageWidth&&this.model.pageSettings.pageHeight||this.nodes().length>0||this.connectors().length>0){n=n?n:"page";t!="custom"&&(u=this._getDigramBounds(t));c=u.width;a=u.height;s.x=(o.width-(i.left+i.right))/c;s.y=(o.height-(i.top+i.bottom))/a;l=this._hScrollOffset;e=this._vScrollOffset;switch(n){case"width":r=s.x;f=r/this._getCurrentZoom();h=(o.width-(t!="content"?u.width:c)*r)/2-u.x*r;l+=h+(i.left-i.right)/2*r;e-=this._vScrollOffset*f;e=t!="custom"?e:e+this._vScrollOffset*f;break;case"height":r=s.y;f=r/this._getCurrentZoom();h=(o.width-(t!="content"?u.width:c)*r)/2-u.x*r;v=(o.height-(t!="content"?u.height:a)*r)/2-u.y*r;l+=h+(i.left-i.right)/2*r;e+=v+(i.top-i.bottom)/2*r;break;case"page":r=Math.min(s.x,s.y);f=r/this._getCurrentZoom();h=(o.width-(t!="content"?u.width:c)*r)/2-u.x*r;v=(o.height-(t!="content"?u.height:a)*r)/2-u.y*r;l+=h+(i.left-i.right)/2*r;e+=v+(i.top-i.bottom)/2*r}ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,f,l,e,new ej.datavisualization.Diagram.Point(0,0),!0)}else f=1/this._getCurrentZoom(),ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,f,this._hScrollOffset,this._vScrollOffset,new ej.datavisualization.Diagram.Point(0,0),!0)},exportDiagram:function(n){var o,g,e,i,l,a,v,s,tt,y,p,it,h,r,rt,u,ut,k,f,ft,d;n||(n={});var nt=n&&n.region?n.region:"content",c=n&&n.mode?n.mode:"download",t=n.margin||{};for(t={top:isNaN(t.top)?25:t.top,bottom:isNaN(t.bottom)?25:t.bottom,left:isNaN(t.left)?25:t.left,right:isNaN(t.right)?25:t.right},i=this._getDigramBounds(nt),n.bounds&&(g=!0,i={x:isNaN(n.bounds.x)?i.x:n.bounds.x,y:isNaN(n.bounds.y)?i.y:n.bounds.y,width:n.bounds.width||i.width,height:n.bounds.height||i.height}),l=this.nodes(),r=0;r<l.length;r++)for(a=l[r],v=a.labels,s=0;s<v.length;s++)tt=v[s],y=ej.datavisualization.Diagram.Util.getLabelbounds(this,a,tt),y&&(i=this._union(y,i));if(i.x-=t.left,i.y-=t.top,i.width+=t.left+t.right,i.height+=t.top+t.bottom,p=n.fileName||"diagram",n.format!="svg"){if(it=this._diagramAsCanvas({bounds:i,margin:t,region:nt},g),o=n.format||"jpg",h=e=it.toDataURL(),c=="data")return e;if(!(ej.browserInfo().name==="msie"&&parseFloat(ej.browserInfo().version)<10)){h=h.replace(/^data:[a-z]*;,/,"");var et=h.split(","),w=atob(et[1]),b=new ArrayBuffer(w.length),ot=new Uint8Array(b);for(r=0;r<w.length;r++)ot[r]=w.charCodeAt(r)}}else{if(o=n.format||"svg",rt=e=this._diagramAsSvg({bounds:i,margin:t}),c=="data")return e;ej.browserInfo().name==="msie"&&parseFloat(ej.browserInfo().version)<10||(b=(new XMLSerializer).serializeToString(rt))}if(c=="download"){if(u=ej.browserInfo(),u.name==="msie"&&parseFloat(u.version)<10||u.name=="webkit")return ut=u.name=="webkit"?"Safari":"IE-9",alert("Downloading option is not supported in "+ut+", Please use the returned data"),e;k=new Blob([b],{type:"application/octet-stream"});u.name==="msie"?window.navigator.msSaveOrOpenBlob(k,p+"."+o):(f=document.createElement("a"),ft=URL.createObjectURL(k),f.href=ft,f.setAttribute("download",p+"."+o),document.createEvent?(d=document.createEvent("MouseEvents"),d.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),f.dispatchEvent(d)):f.fireEvent&&f.fireEvent("onclick"))}},_diagramAsSvg:function(n){var i=new ej.datavisualization.Diagram.Svg({id:"diagram_svg",width:n.bounds.width,height:n.bounds.height}),t,e,u,f,s,o,r,h;for(document.body.appendChild(i.document),t=this._svg.document.getElementById(this._canvas.id+"_pageBackground"),t=$(t).find("#pageback")[0],t=t.cloneNode(!0),i.appendChild(t),t.setAttribute("transform","translate("+-n.bounds.x+", "+-n.bounds.y+")"),t=this._svg.document.getElementById(this._canvas.id+"_diagramLayer"),t=t.cloneNode(!0),i.appendChild(t),t.setAttribute("transform","translate("+-n.bounds.x+", "+-n.bounds.y+")"),e=this.nodes(),r=0;r<e.length;r++)if(u=e[r],ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(u,i,this),u.annotation&&u._annotation&&u._annotation.length)for(f=0;f<u._annotation.length;f++)diagram.nameTable[u._annotation[f]]&&(s=diagram.nameTable[u._annotation[f]],ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(s,i,this));for(o=this.connectors(),r=0;r<o.length;r++)h=o[r],ej.datavisualization.Diagram.SvgContext._renderLabelsAsSvg(h,i,this);return document.body.removeChild(i.document),i.appendChild(this._svg.document.getElementById(this._canvas.id+"patterndefinition").cloneNode(!0)),i.document},_diagramAsCanvas:function(n){var s,u,e=n.bounds,nt=n.margin,t=this._getDigramBounds(),g=this._pageBackgroundColor(),o=new ej.datavisualization.Diagram.Canvas({id:"mycanvas",width:e.width,height:e.height}),i,r,f,l,p,w,a;if(o._diagram=this,i=o.document.getContext("2d"),i.fillStyle=this._backgroundColor(),i.translate(-e.x,-e.y),i.fillRect(e.x,e.y,e.width,e.height),r=this._backgroundImage(),r&&r.source){t=this._getDigramBounds();f=new Image;f.src=r.source;var b=t.width/f.width,k=t.height/f.height,h=t.x,c=t.y,v=t.width,y=t.height,d=ej.datavisualization.Diagram.CanvasContext._isImageExportable(r);r.scale!="none"&&r.alignment!="none"?(l=r.scale=="meet"?Math.min(b,k):Math.max(b,k),v=l*f.width,y=l*f.height,r.alignment.indexOf("xmid")>-1?h+=(t.width-v)/2:r.alignment.indexOf("xmax")>-1&&(h=h+t.width-v),r.alignment.indexOf("ymid")>-1?c+=(t.height-y)/2:r.alignment.indexOf("ymax")>-1&&(c=c+t.height-y),(this._backgroundColor()=="none"||this._backgroundColor()=="transparent")&&(i.fillStyle="white",i.fillRect(t.x,t.y,t.width,t.height)),d&&i.drawImage(f,h,c,l*f.width,l*f.height)):d&&i.drawImage(f,h,c,t.width,t.height)}else i.fillStyle=g,i.fillRect(t.x,t.y,t.width,t.height);for(p=this._pageBorderColor(),w=this._pageBorderWidth(),w&&(i.strokeStyle=p=="none"?"transparent":p,i.lineWidth=w,i.strokeRect(t.x,t.y,t.width,t.height)),s=this.nodes().concat(this.connectors()),s=this._sortByZIndex(s,!0),this._sortByGroupChildrenZIndex(!0),a=0;a<s.length;a++)u=s[a],u.segments?ej.datavisualization.Diagram.CanvasContext.renderConnector(u,o):u._type!=="group"||u.parent?u._type!=="node"||u.isPhase||u.parent||ej.datavisualization.Diagram.CanvasContext.renderNode(u,o):ej.datavisualization.Diagram.CanvasContext.renderGroup(u,o,this);return o.document},_renderCanvasPhase:function(n,t){var s=0,f=0,v=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,n),e,h,c,y,o,r,l,a;if(v)for(h=0;h<v.length;h++){if(e=this.nameTable[v[h]],c=this.nameTable[n.name],c){y=this._getChildren(c.children);y.length>1&&(o=this.nameTable[y[0]]);var u=ej.datavisualization.Diagram.Util.bounds(c),i=[],p,w=u.top+50,b=u.left+50;if(e.orientation=="vertical")for(i.push({x:0,y:0}),i.push({x:u.width,y:0}),p=ej.datavisualization.Diagram.SvgContext._convertToSVGPoints(i),s=u.x,f=u.y+e.offset,o&&(f+=o.height),r=0,l=i.length;r<l;++r)a=ej.datavisualization.Diagram.Geometry.translate(i[r],s,f),i[r]=a;else for(i.push({x:0,y:o.height?o.height:0}),i.push({x:0,y:u.height}),s=u.x+e.offset,f=u.y,r=0,l=i.length;r<l;++r)a=ej.datavisualization.Diagram.Geometry.translate(i[r],s,f),i[r]=a}ej.datavisualization.Diagram.CanvasContext.renderPhases(e,t,i)}},_getPrintCanvasStyle:function(n,t){var i=0,r=0,u;return n&&(i=n.width,r=n.height),t&&((t.pageHeight||t.pageWidth)&&(r=t.pageHeight?t.pageHeight:r,i=t.pageWidth?t.pageWidth:i),t.pageOrientation&&(t.pageOrientation==="landscape"&&r>i?u=i:t.pageOrientation==="portrait"&&i>r&&(u=i),u&&(i=r,r=u))),{height:r,width:i}},_getMultipleImage:function(n,t){var l=document.createElement("div"),i=this._getPrintCanvasStyle(n,t),a,v,y=t.margin,f=y.left,e=y.top,p=y.right,w=y.bottom,b=0,tt=0,r,u,o,s;if(a=i.width+b,v=i.height+tt,r=0,u=0,t&&t.multiplePage){if(l.style.height="auto",l.style.width="auto",o=n.height,s=n.width,n){var k=0,it=0,d,h,c,g=0,nt=0;do{do g=i.width,nt=i.height,r+i.width>=s&&(g=s-r),u+i.height>=o&&(nt=o-u),c=new ej.datavisualization.Diagram.Canvas({id:"multiplePrint"+k+""+it,width:i.width,height:i.height}),h=c.document.getContext("2d"),h.drawImage(n,b+r+f,tt+u+e,g-p-f,nt-w-e,0+f,0+e,g-p-f,nt-w-e),r+i.width>=s&&(r-=r-s),d=c.document.toDataURL(),h.restore(),r+=a,this._printImage(l,d,k+""+it),k++;while(r<s);it++;k=b=r=0;u+i.height>=o&&(u-=u-o);u+=v}while(u<o)}}else{var b=0,tt=0,i=this._getPrintCanvasStyle(n,t),a,v;a=i.width;v=i.height;c=new ej.datavisualization.Diagram.Canvas({id:"multiplePrint0",width:a,height:v});h=c.document.getContext("2d");h.drawImage(n,b+f,tt+e,n.width-(p+f),n.height-(e+w),0+f,0+e,a-(p+f),v-(e+w));d=c.document.toDataURL();h.restore();this._printImage(l,d,0)}return l},_printImage:function(n,t,i){var f,r,u;f=document.createElement("img");r=document.createElement("div");u={"class":"e-diagram-print-page"};ej.datavisualization.Diagram.Util.attr(r,u);u={id:this.element[0].id+"_multiplePrint_img"+i,style:"float:left",src:t};ej.datavisualization.Diagram.Util.attr(f,u);r.appendChild(f);n.appendChild(r)},print:function(n){var r,t;n=ej.datavisualization.Diagram.PrintSettings(n);var u=this.exportDiagram({mode:"data",region:n.region,margin:{top:0,bottom:0,left:0,right:0}}),i=document.createElement("img"),f={id:this.element[0].id+"_printImage",src:u};ej.datavisualization.Diagram.Util.attr(i,f);r=this._getMultipleImage(i,n);t=window.open("");t!=null&&(t.document.write("<html><head><style> body{margin:0px;}  @media print { .e-diagram-print-page {page-break-after: left; }.e-diagram-print-page:last-child {page-break-after: avoid;}}  <\/style><title><\/title><\/head>"),t.document.write('<BODY onload="setTimeout(function(){window.print();}, 100)">'),t.document.write("<center>"+r.innerHTML+"<\/center>"),t.document.close())},save:function(){var t=this.model.drawingTools,i=this.model.selectedItems.userHandles,n;return this.model.drawingTools=null,this.model.selectedItems.userHandles=null,this.nameTable.multipleSelection&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable.multipleSelection),this._nodes=$.extend(!0,[],this.nodes())),this._updateTableNodes(),n=jQuery.extend(!0,{},this.model),ej.version&&(n.version=ej.version),this._updateGroupChildren(n),this.model.drawingTools=t,this.model.selectedItems.userHandles=i,this._checkForNullValues(n),n},_checkForNullValues:function(n){this._checkTargetNull(n.pageSettings)},_checkTargetNull:function(n){for(var t in n)n[t]==null||n[t]==Infinity?n[t]=0:typeof n[t]=="object"&&n[t]&&this._checkTargetNull(n[t])},_updateGroupChildren:function(n){var i=[],r,t;if(n&&n.nodes&&n.nodes.length>0)for(t=0;t<n.nodes.length;t++)n.nodes[t].parent!==""||n.nodes[t].isSwimlane?n.nodes[t].isSwimlane&&(r=this._getNode(n.nodes[t].name),r&&i.push(jQuery.extend(!0,{},r))):(this._updateChildren(n.nodes[t]),i.push(jQuery.extend(!0,{},n.nodes[t])));n.nodes=i},_updateChildren:function(n){var u=[],i,r,t;if(n&&n.children&&n.children.length>0)for(t=0;t<n.children.length;t++)r=this._getChild(n.children[t]),r&&(i=this.nameTable[r]),i&&u.push(jQuery.extend(!0,{},i));n.children=u},_containsNode:function(n){var t,i;for(n=this._getChild(n),t=null,i=0;i<this.nodes().length;i++)if(t=this.nodes()[i],t&&t.name===n)return!0;return null},_updateTableNodes:function(){var n=0,t,i;for(n;n<this.nodes().length;n++)t=this.nameTable[this.nodes()[n].name],t&&(this.nodes()[n]=t,t._type==="group"&&this._updateTableGroup(t));for(n;n<this.connectors().length;n++)i=this.nameTable[this.connectors()[n].name],i&&(this.connectors()[n]=i)},_updateTableGroup:function(n){for(var i=n.children,t=0;t<n.children.length;t++)n.children[t]=this.nameTable[this._getChild(n.children[t])],n.children[t]&&n.children[t]._type==="group"&&this._updateTableGroup(n.children[t])},upgrade:function(n){var r=Number(n.version),t,i;if(n.version)if(r<14.1){if(n.nodes)for(t=0;t<n.nodes.length;t++)n.nodes[t].constraints|=ej.datavisualization.Diagram.NodeConstraints.PointerEvents;else if(n.connectors)for(i=0;i<n.connectors.length;i++)n.connectors[i].constraints|=ej.datavisualization.Diagram.ConnectorConstraints.PointerEvents}else n.version=="13.1";else if(this.commonAPIChanges(n),n.nodes)for(t=0;t<n.nodes.length;t++)n.nodes[t].inEdges||(n.nodes[t].inEdges=[],n.nodes[t].outEdges=[]),n.nodes[t].constraints=ej.datavisualization.Diagram.NodeConstraints.Default},commonAPIChanges:function(n){var t,i;if(n.defaultSettings={node:n.nodeDefaults,connectors:n.connectorDefaults},n.connectors)for(t=0;t<n.connectors.length;t++)n.connectors[t].constraints=ej.datavisualization.Diagram.ConnectorConstraints.Default,n.connectors[t].line&&(n.connectors[t].line.type=="straight"?(i=[{type:"straight",startPoint:n.connectors[t].line.startPoint,endPoint:n.connectors[t].line.endPoint}],this.commonSourceTargetChanges(n.connectors[t])):n.connectors[t].line.type=="orthogonal"?(i=[{type:"orthogonal",startPoint:n.connectors[t].line.startPoint,endPoint:n.connectors[t].line.endPoint}],this.commonSourceTargetChanges(n.connectors[t])):n.connectors[t].line.type=="bezier"&&(i=[{type:"bezier",startPoint:n.connectors[t].line.startPoint,endPoint:n.connectors[t].line.endPoint,point1:n.connectors[t].line.point1,point2:n.connectors[t].line.point2}],this.commonSourceTargetChanges(n.connectors[t])),n.connectors[t].sourcePoint=n.connectors[t].line.startPoint,n.connectors[t].targetPoint=n.connectors[t].line.endPoint,n.connectors[t].segments=i)},commonSourceTargetChanges:function(n){n.sourceNodeName&&(n.sourceNode=n.sourceNodeName);n.sourceNodePort&&(n.sourcePort=n.sourceNodePort);n.targetNodeName&&(n.targetNode=n.targetNodeName);n.targetPortName&&(n.targetPort=n.targetPortName)},load:function(n){var i,t;this._isLoad=!0;this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch();this.clear();this._zOrder=0;this.enableContextMenu()&&(i=$("#"+this.element[0].id+"_contextMenu").data("ejMenu"),i.destroy(),$("#"+this.element[0].id+"_contextMenu").remove());t={nodes:n.nodes?n.nodes:[],connectors:n.connectors?n.connectors:[],commandManager:n.commandManager?n.commandManager:{},contextMenu:n.contextMenu?n.contextMenu:{},snapSettings:n.snapSettings?n.snapSettings:{},historyManager:n.historyManager?n.historyManager:this._initHistoryManager(),backgroundImage:n.backgroundImage?n.backgroundImage:ej.datavisualization.Diagram.BackgroundImage({source:""}),enableAutoScroll:n.enableAutoScroll?n.enableAutoScroll:!0,autoScrollMargin:n.autoScrollMargin?n.autoScrollMargin:20,layout:n.layout?n.layout:{},pageSettings:n.pageSettings?n.pageSettings:{},click:n.click?n.click:null,connectionChange:n.connectionChange?n.connectionChange:null,defaultSettings:n.defaultSettings?n.defaultSettings:{node:null,connector:null},dataSource:n.dataSource?n.dataSource:null,dataSourceSchema:n.dataSourceSettings?n.dataSourceSettings:{},doubleClick:n.doubleClick?n.doubleClick:null,enableContextMenu:n.enableContextMenu?n.enableContextMenu:!0,tooltip:n.tooltip?n.tooltip:null,height:n.height?n.height:null,mouseEnter:n.mouseEnter?n.mouseEnter:null,mouseOver:n.mouseOver?n.mouseOver:null,mouseLeave:n.mouseLeave?n.mouseLeave:null,nodeTemplate:n.nodeTemplate?n.nodeTemplate:null,rotationChange:n.rotationChange?n.rotationChange:null,selectorConstraints:n.selectorConstraints?n.selectorConstraints:ej.datavisualization.Diagram.SelectorConstraints.All,width:n.width?n.width:null,constraints:n.constraints,phases:n.phases?n.phases:[],scrollSettings:n.scrollSettings?n.scrollSettings:{horizontalOffset:0,verticalOffset:0,currentZoom:1,viewPortHeight:0,viewPortWidth:0,zoomFactor:n.zoomFactor?n.zoomFactor:.2,padding:n.scrollSettings.padding||{left:0,right:0,top:0,bottom:0}}};n.showTooltip!==undefined&&(t.showTooltip=n.showTooltip);n.tooltipTemplateId!==undefined&&(t.tooltipTemplateId=n.tooltipTemplateId);$("#"+this._id).ejDiagram(t);this._isLoad=!1},layout:function(){this._setLayout()},_setLayout:function(){this._doLayout();ej.datavisualization.Diagram.PageUtil._updatePageSize(this);this._clearSelection()},addSelection:function(n,t){var r,i;n&&!this._selectionContains(n)&&(this.model.selectedItems.children.length>0&&!t?(i=this.nameTable.multipleSelection,i||(i=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),this.nodes().push(i),this.nameTable[i.name]=i),this.model.selectedItems.children.length>1?i.children=this.selectionList[0].children:i.children.push(this.selectionList[0].name),i.children.push(n.name),ej.datavisualization.Diagram.Util._updateGroupBounds(i,this,null,!0),r=i):r=n,this._hasSelection()&&this._clearSelection(!0),i&&this.nameTable.multipleSelection===undefined&&t===!1&&(this.nodes().push(i),this.nameTable[i.name]=i),this._addSelection(r))},clearSelection:function(){this._clearSelection()},removeSelection:function(n){var n,t;(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&n&&(n=this.nameTable[n.name],this.selectionList[0]==n||this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children.length==1?this._clearSelection():this.selectionList[0].type=="pseudoGroup"&&this._collectionContains(n.name,this.selectionList[0].children)&&(t=this.selectionList[0].children.indexOf(n.name),t!=-1?ej.datavisualization.Diagram.Util.removeItem(this.selectionList[0].children,n.name):ej.datavisualization.Diagram.Util.removeItem(this.selectionList[0].children,n),ej.datavisualization.Diagram.Util.removeItem(this.model.selectedItems.children,n),ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this),this._updateSelectionHandle()))},updateSelectedObject:function(n,t){var i=this.nameTable[n];i&&(ej.datavisualization.Diagram.Util.canSelect(i)||i._isHeader)&&(this.activeTool.selectedObject=i);t&&t.isSwimlane&&(this.activeTool.selectedObject=t)},updateSelection:function(n){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&this._updateSelectionHandle(n)},activateTool:function(n,t){this.tools[n]&&(this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0),this._toolToActivate=n,this.activeTool=this.tools[this._toolToActivate],this.activeTool.singleAction=!0,(t===!1||n==="panTool")&&(this.activeTool.singleAction=!1));this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(this._currentCursor="pointer",this.activeTool.startPoint=ej.datavisualization.Diagram.Point(0,0),this.activeTool._isMouseDown=!1);this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&(this.activeTool.singleAction?this.tool(this.tool()|ej.datavisualization.Diagram.Tool.DrawOnce):this.tool(this.tool()|ej.datavisualization.Diagram.Tool.ContinuesDraw),this.activeTool._showAllPorts());this._drawingTool=!0},deactivateTool:function(){this.activeTool instanceof ej.datavisualization.Diagram.LineTool&&this.activeTool._showAllPorts(!0);this.tool()&ej.datavisualization.Diagram.Tool.DrawOnce&&this.tool(this.tool()^ej.datavisualization.Diagram.Tool.DrawOnce);this.tool()&ej.datavisualization.Diagram.Tool.ContinuesDraw&&this.tool(this.tool()^ej.datavisualization.Diagram.Tool.ContinuesDraw);this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?(this._toolToActivate="panTool",this.activeTool=this.tools[this._toolToActivate],this.activeTool._mousedown=!1,this._currentCursor="pointer"):(this._toolToActivate="select",this.activeTool=this.tools[this._toolToActivate],this.tool(ej.datavisualization.Diagram.Tool.SingleSelect|ej.datavisualization.Diagram.Tool.MultipleSelect))},updateLabel:function(n,t,i){var r,u;if(n&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(r=this._findNode(n),r||(r=this._findConnector(n)),i&&t&&!i.name||t.name==i.name)){if(r){this._isUndo||this._recordPropertiesChanged(r,i,"label",t);r.type!=="text"&&(t=this._findLabel(r,t.name));i.name=t.name;this._comparePropertyValues(r,"labels",i);for(u in i)t.hasOwnProperty(u)&&(t[u]=typeof i[u]=="object"?$.extend(!0,{},t[u],i[u]):i[u]);i.wrapText!==undefined&&(t.wrapping=i.wrapText?"wrapwithoverflow":"nowrap");r.segments||r.type!=="text"?(ej.datavisualization.Diagram.DiagramContext.updateLabelStyle(r,t,this),ej.datavisualization.Diagram.DiagramContext.updateLabel(r,t,this)):r.type==="text"&&ej.datavisualization.Diagram.DiagramContext.updateTextBlock(r,t,this)}i.mode===ej.datavisualization.Diagram.LabelEditMode.Edit&&this.startLabelEdit(r,t)}return t},startLabelEdit:function(n,t){var r,i,u;if(n){for(r=0;r<this.selectionList.length;r++)if(i=this.selectionList[r],i!==n&&typeof i.labels.length!="undefined")for(u=0;u<i.labels.length;u++)i.labels[u].mode=ej.datavisualization.Diagram.LabelEditMode.View;t||n.type!=="text"||(t=n.textBlock);this._setLabelEditing(t)?this._startEdit(n):this._endEdit()}},_setSelectorConstraints:function(n){this.model.selectedItems.constraints=n;this.selectionList[0]&&(ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer),ej.datavisualization.Diagram.SvgContext.renderSelector(this.selectionList[0],this._adornerSvg,this._adornerLayer,this._currZoom,n),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,this.selectionList[0].type=="pseudoGroup",this._currZoom,this._adornerLayer,this))},_raiseGroupChangeEvent:function(n,t,i,r){var u={};u.element=n?n:null;u.oldParent=t?t:null;u.newParent=i?i:null;u.cause=r?r:null;t!=i&&this._raiseEvent("groupChange",u)},group:function(){var t,n,i,u,r,f,e;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"){for(t=[],n=0;n<this.selectionList[0].children.length;n++)t.push(this.nameTable[this.selectionList[0].children[n]]);for(this._sortByZIndex(t,!0),u=ej.datavisualization.Diagram.Util.randomId(),r=new ej.datavisualization.Diagram.Group({name:u,rotateAngle:this.selectionList[0].rotateAngle}),this._clearSelection(!0),n=0;n<t.length;n++)this._isUndo=!0,r.children.push(t[n].name),t[n].parent&&(f=this.nameTable[t[n].parent]),t[n].parent=u,ej.datavisualization.Diagram.Util.removeItem(this.selectionList,t[n].name),t[n].segments?(ej.datavisualization.Diagram.Util.removeItem(this.connectors(),this.nameTable[t[n].name]),this._connectors=$.extend(!0,[],this.connectors())):(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[t[n].name]),this._nodes=$.extend(!0,[],this.nodes())),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t[n].name],t[n]),t[n].type=="html"?(i=document.getElementById(t[n].name+"_parentdiv"),i.parentNode.removeChild(i)):t[n]._type==="group"&&this._checkForHtmlNode(t[n]),i=this._svg.document.getElementById(t[n].name),i&&i.parentNode.removeChild(i),this._removeElement(t[n]),this._raiseGroupChangeEvent(t[n],f,r,"group");ej.datavisualization.Diagram.Util.clear(this.selectionList);r=this._getNewGroup(r);this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.Unknown;this.add(r);e={type:"groupchanged",object:r,actionType:"group",category:"internal"};this.addHistoryEntry(e);this._isUndo=!1}},_checkForHtmlNode:function(n){for(var t,r,u=this._getChildren(n.children),i=0;i<u.length;i++)t=this.nameTable[u[i]],t&&(t._type==="group"?this._checkForHtmlNode(t):t.type=="html"&&(r=document.getElementById(t.name+"_parentdiv"),r.parentNode.removeChild(r)))},_removeChildren:function(n,t){for(var i,u=this._getChildren(n.children),r=0;r<u.length;r++)i=this.nameTable[u[r]],i&&(n.isLane?(this._disConnect(i,t),this._removeConnector(i,t)):i.segments?(this._removeEdges(i),i.sourceNode=i.sourcePort=i.targetNode=i.targetPort=null):this._disConnect(i,t,!0),ej.datavisualization.Diagram.Util.removeItem(this.nodes(),i),this._nodes=$.extend(!0,[],this.nodes()),i._type==="group"?(this._removeChildren(i,t),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),delete this.nameTable[i.name]):(ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),delete this.nameTable[i.name]),this._removeElement(i))},ungroup:function(){var f,r,i,u,n,e,o,t,s;if(this.selectionList[0]&&this.selectionList[0]._type==="group"&&this.selectionList[0].canUngroup&&!(this.selectionList[0].isSwimlane||this.selectionList[0].isLane)){for(this._isUndo=!0,f=this.selectionList[0].children,u=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],i=this.selectionList[0],$("#"+this.selectionList[0].name)[0].parentNode.removeChild($("#"+this.selectionList[0].name)[0]),this._removeElement(this.selectionList[0]),this._checkForHtmlNode(this.selectionList[0]),this._clearSelection(),ej.datavisualization.Diagram.Util.clear(this.selectionList),r=0;r<f.length;r++)t=this.nameTable[this._getChild(f[r])],t.parent&&(o=this.nameTable[t.parent]),$(u).children("#"+t.name)[0]&&u.removeChild($(u).children("#"+t.name)[0]),t&&(t.parent&&(t.parent=null),t.segments?(n=t,n.parent="",this._updateEdges(n),this._dock(n,this.nameTable),ej.datavisualization.Diagram.DiagramContext.renderConnector(n,this),this.connectors().indexOf(n)===-1&&(this.connectors().push(n),this._connectors=$.extend(!0,[],this.connectors()))):(n=t,n.parent="",n._type==="group"?(this._updateChildrenEdges(n),(n.isLane||n.isSwimlane)&&(n.width=0,n.height=0),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this)):ej.datavisualization.Diagram.DiagramContext.renderNode(n,this),this.nodes().indexOf(n)===-1&&(this.nodes().push(n),this._nodes=$.extend(!0,[],this.nodes()))),t.parent&&(e=this.nameTable[t.parent]),this._raiseGroupChangeEvent(t,o,e,"unGroup"));ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this._findNode(i.name));ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i);ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i);s={type:"groupchanged",object:i,actionType:"ungroup",category:"internal"};this.addHistoryEntry(s);this._isUndo=!1}},nudge:function(n,t){t=t?t:1;var u={up:{x:0,y:-t},down:{x:0,y:t},left:{x:-t,y:0},right:{x:t,y:0}},r=u[n],i;n==="up"?i="down":n==="down"?i="up":n==="left"?i="right":n==="right"&&(i="left");r&&this.selectionList[0]&&(this._isUndo||this.addHistoryEntry({type:"nudge",object:this.selectionList[0],undoDirection:i,redoDirection:n,values:t,category:"internal"}),this._nudge(this.selectionList[0],r.x,r.y,n))},selectAll:function(){var t,u,n,f,i=null,r;for(this._clearSelection(!0),t=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),u=this.nodes(),n=0,f=u.length;n<f;n++)ej.datavisualization.Diagram.Util.canSelect(u[n])&&(i=this.nameTable[u[n].name],i&&i.parent==""&&i.type!="pseudoGroup"&&i.visible&&t.children.push(i.name));for(r=this.connectors(),n=0,f=r.length;n<f;n++)ej.datavisualization.Diagram.Util.canSelect(r[n])&&r[n].parent==""&&r[n].visible&&t.children.push(r[n].name);ej.datavisualization.Diagram.Util._updateGroupBounds(t,this);this.nodes().push(t);this._nodes=$.extend(!0,[],this.nodes());this.nameTable[t.name]=t;t.children.length>0&&this._addSelection(t)},align:function(n){var t,s,i,e,u,f;if(this.selectionList[0]&&(this.selectionList[0].type==="group"||this.selectionList[0].type=="pseudoGroup")&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var h=this.nameTable[this.selectionList[0].name].children,c=[],r,o=this._findCornerNodes();if(n==="left"?r=o.left:n==="right"?r=o.right:n==="top"?r=o.top:n==="bottom"&&(r=o.bottom),r?t=ej.datavisualization.Diagram.Util.bounds(r):(n==="center"||n==="middle")&&(t=ej.datavisualization.Diagram.Util.bounds(this.selectionList[0])),t){for(u=0,f=0,s=0;s<h.length;s++)e=this.nameTable[h[s]],i=ej.datavisualization.Diagram.Util.bounds(e),n==="left"?u=-(i.x-t.x):n==="right"?u=-(i.x+i.width-(t.x+t.width)):n==="top"?f=-(i.y-t.y):n==="bottom"?f=-(i.y+i.height-(t.y+t.height)):n==="center"?u=-(i.x+i.width/2-(t.x+t.width/2)):n==="middle"&&(f=-(i.y+i.height/2-(t.y+t.height/2))),this._moveNode(u,f,e),this._updateContainerOnNudge(e),c.push({object:e,delta:{x:u,y:f}});ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}this.addHistoryEntry({type:"alignCommand",values:c,category:"internal",object:this.selectionList[0]})}},sameSize:function(){var t,n;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,f=this.nameTable[this.selectionList[0].children[0]],r=ej.datavisualization.Diagram.Util.bounds(f),u=[];for(this._isSizingCommand=!0,t=0;t<i.length;t++)n=this.nameTable[i[t]],n.segments||(u.push({object:n,values:{width:n.width||n._width||0,height:n.height||n._height||0}}),this.updateNode(n.name,{width:r.width,height:r.height}));delete this._isSizingCommand;this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:u});ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},sameHeight:function(){var t,n;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,u=this.nameTable[this.selectionList[0].children[0]],r=[],f=ej.datavisualization.Diagram.Util.bounds(u);for(this._isSizingCommand=!0,t=0;t<i.length;t++)n=this.nameTable[i[t]],n.segments||(r.push({object:n,values:{width:n.width||n._width||0,height:n.height||n._height||0}}),this.updateNode(n.name,{height:f.height}));delete this._isSizingCommand;this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:r});ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},sameWidth:function(){var t,n;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&this.selectionList[0].children&&this.selectionList[0].children.length>0){var i=this.nameTable[this.selectionList[0].name].children,u=this.nameTable[this.selectionList[0].children[0]],f=ej.datavisualization.Diagram.Util.bounds(u),r=[];for(this._isSizingCommand=!0,t=0;t<i.length;t++)n=this.nameTable[i[t]],n.segments||(r.push({object:n,values:{width:n.width||n._width||0,height:n.height||n._height||0}}),this.updateNode(n.name,{width:f.width}));delete this._isSizingCommand;this.addHistoryEntry({type:"sizeCommand",category:"internal",object:this.selectionList[0],values:r});ej.datavisualization.Diagram.Util._updateGroupBounds(this.selectionList[0],this);ej.datavisualization.Diagram.SvgContext.updateSelector(this.selectionList[0],this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}},spaceDown:function(){var t,o,s,i,n,e,u,r,f;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&(t=this.selectionList[0].children,this._sliceDockLines(t),this._sortByYvalue(this.selectionList[0].children),o=t.length,s=[],t&&o>2)){var c=this._findCornerNodes(),l=c.top,h=0,i=null,n=null;for(u in t)i=null,n=null,i=this.nameTable[this._getChild(t[u])],n=this.nameTable[this._getChild(t[Number(u)+1])],i&&n&&(r=ej.datavisualization.Diagram.Util.bounds(i),f=ej.datavisualization.Diagram.Util.bounds(n),h+=f.y-(r.y+r.height));e=h/(o-1);for(u in t)i=this.nameTable[this._getChild(t[u])],n=this.nameTable[this._getChild(t[Number(u)+1])],i&&n&&(r=ej.datavisualization.Diagram.Util.bounds(i),f=ej.datavisualization.Diagram.Util.bounds(n),this._comparePropertyOnAlign(n,0,r.bottom-f.top+e),this._translate(n,0,r.bottom-f.top+e,this.nameTable),s.push({object:n,delta:{x:0,y:r.bottom-f.top+e}}),this._updateQuad(this,n),this._updateNodeMargin(n),ej.datavisualization.Diagram.DiagramContext.update(n,this));this.addHistoryEntry({type:"spacingCommand",values:s,category:"internal",object:this.selectionList[0]})}},spaceAcross:function(){var t,o,s,i,n,e,l,u,r,f;if(this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&(t=this.selectionList[0].children,this._sliceDockLines(t),this._sortByXvalue(this.selectionList[0].children),o=t.length,s=[],t&&o>2)){var c=this._findCornerNodes(),a=c.left,h=0,i=null,n=null;for(u in t)i=null,n=null,i=this.nameTable[this._getChild(t[u])],n=this.nameTable[this._getChild(t[Number(u)+1])],i&&n&&(r=ej.datavisualization.Diagram.Util.bounds(i),f=ej.datavisualization.Diagram.Util.bounds(n),h+=f.x-(r.x+r.width));e=h/(o-1);l=0;for(u in t)i=this.nameTable[this._getChild(t[u])],n=this.nameTable[this._getChild(t[Number(u)+1])],i&&n&&(r=ej.datavisualization.Diagram.Util.bounds(i),f=ej.datavisualization.Diagram.Util.bounds(n),this._comparePropertyOnAlign(n,r.right-f.left+e,0),this._translate(n,r.right-f.left+e,0,this.nameTable),s.push({object:n,delta:{x:r.right-f.left+e,y:0}}),this._updateQuad(this,n),this._updateNodeMargin(n),ej.datavisualization.Diagram.DiagramContext.update(n,this));this.addHistoryEntry({type:"spacingCommand",values:s,category:"internal",object:this.selectionList[0]})}},sendBackward:function(){var t,i,n,r,f,u;if(this.selectionList[0]&&this.selectionList[0].type!="pseudoGroup"&&(n=this.selectionList[0],n)){for(t=this._findOverlapNode(n),this._sortByZIndex(t),r=0;r<t.length;r++)if(n.zOrder>t[r].zOrder){i=t[r];break}f=n.zOrder;i&&(u=i.zOrder,this._comparePropertyValues(n,"zOrder",{zOrder:u},null,ej.datavisualization.Diagram.ActionType.Order),this._sendElementsToBack(f,u,n,i),this.addHistoryEntry({type:"zOrder",command:"back",start:u,end:f,nearestNode:i,object:n,category:"internal"}))}},_sendElementsToBack:function(n,t,i,r){for(var f,u=t;u<n;u++)i.parent!=""?this._findObjectByIndex(u,!0).zOrder+=1:this._findObjectByIndex(u).zOrder+=1;i.parent!=""?i.parent&&(f=this.nameTable[i.parent],this._findChildren(f,i.name).zOrder=t):this._findObjectByName(i.name).zOrder=t;this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(i.name),this._svg.getElementById(r.name));this._updateSelectionHandle()},_bringElementsToFront:function(n,t,i,r){for(var f,u=n+1;u<=t;u++)i.parent!=""?this._findObjectByIndex(u,!0)&&(this._findObjectByIndex(u,!0).zOrder-=1):this._findObjectByIndex(u)&&(this._findObjectByIndex(u).zOrder-=1);i.parent?(f=this.nameTable[i.parent],this._findChildren(f,i.name).zOrder=t):this._findObjectByName(i.name).zOrder=t;this._svg.getElementById(r.name).parentNode.insertBefore(this._svg.getElementById(i.name),this._svg.getElementById(r.name).nextSibling);this._updateSelectionHandle()},moveForward:function(){var t,i,n,r,f,u;if(this.selectionList[0]&&this.selectionList[0].type!="pseudoGroup"&&(n=this.selectionList[0],n)){for(t=this._findOverlapNode(n),this._sortByZIndex(t),r=t.length-1;r>=0;r--)if(n.zOrder<t[r].zOrder){i=t[r];break}f=n.zOrder;i&&(u=i.zOrder,this._comparePropertyValues(n,"zOrder",{zOrder:u},null,ej.datavisualization.Diagram.ActionType.Order),this._bringElementsToFront(f,u,n,i),this.addHistoryEntry({type:"zOrder",command:"front",start:u,end:f,nearestNode:i,object:n,category:"internal"}))}},sendToBack:function(){var n=this.selectionList[0],u,t;if(n&&n.type!="pseudoGroup"){var o=this._findOverlapNode(n),i=this._sortByZIndex(o),f=n.zOrder,r=n.zOrder,e;for(t=0;t<i.length;t++)i[t].zOrder<r&&(t==0&&(e=i[t]),r=i[t].zOrder,u=i[t]);u&&(this._comparePropertyValues(n,"zOrder",{zOrder:r},null,ej.datavisualization.Diagram.ActionType.Order),this._sendElementsToBack(f,r,n,u),this.addHistoryEntry({type:"zOrder",command:"back",start:r,end:f,nearestNode:e,object:n,category:"internal"}))}},bringToFront:function(){var n=this.selectionList[0],u,t;if(n&&n.type!="pseudoGroup"){var e=this._findOverlapNode(n),i=this._sortByZIndex(e),f=n.zOrder,r=n.zOrder;for(t=0;t<i.length;t++)i[t].zOrder>r&&(r=i[t].zOrder,u=i[t]);u&&(this._comparePropertyValues(n,"zOrder",{zOrder:r},null,ej.datavisualization.Diagram.ActionType.Order),this._bringElementsToFront(f,r,n,u),this.addHistoryEntry({type:"zOrder",command:"front",start:r,end:f,nearestNode:i[t-1],object:n,category:"internal"}))}},_getChildFromCollection:function(n,t){if(n&&n.length>0&&t)for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i]},_updateNameTable:function(n){var i,t;if(n.children&&n.children.length>0)for(i=0;i<n.children.length;i++)t=typeof n.children[i]=="object"?n.children[i]:null,t&&(this.nameTable[t.name]=t,t.children&&t.children.length>0&&this._updateNameTable(t))},_recordMultiRotationChanged:function(n){ej.datavisualization.Diagram.canvasHelper._undoMultiRotateNode(this,n)},_recordMultiPinPointChanged:function(n){ej.datavisualization.Diagram.canvasHelper._undoMultiDragNode(this,n)},_recordMultiSizeChanged:function(n){ej.datavisualization.Diagram.canvasHelper._undoMultiResizeNode(this,n)},undo:function(){var n;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&ej.datavisualization.Diagram.Util.canUndo(this)){if(this._isUndo=!0,n=this.getUndoEntry(),n&&(n.type=="closeGroup"?this._groupUndo=!0:this._undo(n),this._groupUndo)){for(n=this.getUndoEntry();n&&n.type!="startGroup";)this._undo(n),n=this.getUndoEntry();delete this._groupUndo}this._isUndo=!1}},redo:function(){this._isUndo=!0;var n=this.getRedoEntry();if(n&&(n.type=="startGroup"?this._groupRedo=!0:this._redo(n),this._groupRedo)){for(n=this.getRedoEntry();n&&n.type!="closeGroup";)this._isUndo=!0,this._redo(n),n=this.getRedoEntry();delete this._groupRedo}this._isUndo=!1},_ComparehistoryChangeEvent:function(n,t){var i,r={source:[],changes:[]},s,u,f,h,o,e;switch(t.type){case"positionchanged":case"rotationchanged":case"sizechanged":r=this._getPseudoGroupElements(n,t);break;case"endpointchanged":this._UndoRedo?(s=this._historyChangeEvent(t.undoObject,t.redoObject,t),i={type:t.type,oldValues:s.oldValues,newValues:s.newValues,cancel:!1},r.source.push(t.undoObject)):(s=this._historyChangeEvent(t.redoObject,t.undoObject,t),i={type:t.type,oldValues:s.oldValues,newValues:s.newValues,cancel:!1},r.source.push(t.redoObject));r.changes.push(i);break;case"collectionchanged":t.changeType=="remove"&&(i={type:t.type,addedItems:[],deletedItems:[n]});t.changeType=="insert"&&(i={type:t.type,addedItems:[n],deletedItems:[]});r.changes.push(i);r.source.push(n);break;case"labelchanged":i=this._UndoRedo?{type:t.type,newValues:{text:t.previousLabelValue},oldValues:{text:t.updatedLabelValue}}:{type:t.type,newValues:{text:t.updatedLabelValue},oldValues:{text:t.previousLabelValue}};r.changes.push(i);r.source.push(t.shape);break;case"labelcollectionchanged":i={type:t.type,source:t.shape,addedItems:[t.label],deletedItems:[]};r.changes.push(i);r.source.push(t.shape);case"groupchanged":i=t.actionType=="group"?{type:t.type,source:t.object,addedItems:[t.object],deletedItems:[]}:{type:t.type,source:t.object,addedItems:[],deletedItems:[t.object]};r.changes.push(i);r.source.push(t.object);break;case"phasepositionchanged":this._UndoRedo?(i={type:t.type,newValues:{offset:t.undoObject.offset},oldValues:{offset:t.redoObject.offset}},r.source.push(t.undoObject)):(i={type:t.type,newValues:{offset:t.redoObject.offset},oldValues:{offset:t.undoObject.offset}},r.source.push(t.redoObject));r.changes.push(i);break;case"phasecollectionchanged":i=t.isAdded?{type:t.type,addedItems:[t.phase],deletedItems:[]}:{type:t.type,addedItems:[],deletedItems:[t.phase]};r.source.push(t.phase);r.changes.push(i);break;case"propertiesChanged":i=this._propertyChangeEventValues(t);r.source.push(i.source);r.changes.push(i.changes);break;case"portscollectionchanged":t.changeType=="insert"&&(i={type:t.type,addedItems:[t.collection],deletedItems:[]});t.changeType=="remove"&&(i={type:t.type,addedItems:[],deletedItems:[t.collection]});r.source.push(t.object);r.changes.push(i);break;case"nudge":u={};f={};this._UndoRedo?(t.undoDirection=="left"&&(u.offsetX=t.object.offsetX-t.values,f.offsetX=t.object.offsetX),t.undoDirection=="right"&&(u.offsetX=t.object.offsetX+t.values,f.offsetX=t.object.offsetX),t.undoDirection=="up"&&(u.offsetY=t.object.offsetY-t.values,f.offsetY=t.object.offsetY),t.undoDirection=="down"&&(u.offsetY=t.object.offsetY+t.values,f.offsetY=t.object.offsetY),i={type:t.type,newValues:u,oldValues:f}):(t.redoDirection=="left"&&(u.offsetX=t.object.offsetX-t.values,f.offsetX=t.object.offsetX),t.redoDirection=="right"&&(u.offsetX=t.object.offsetX+t.values,f.offsetX=t.object.offsetX),t.redoDirection=="up"&&(u.offsetY=t.object.offsetY-t.values,f.offsetY=t.object.offsetY),t.redoDirection=="down"&&(u.offsetY=t.object.offsetY+t.values,f.offsetY=t.object.offsetY),i={type:t.type,newValues:u,oldValues:f});r.source.push(t.object);r.changes.push(i);break;case"spacingCommand":case"alignCommand":var u={},f={},c=[],l=[];for(o=0;o<t.values.length;o++)e=t.values[o],e.object.segments?(h=$.extend(!0,{},e.object),f={sourcePoint:h.sourcePoint,targetPoint:h.targetPoint},l.push(f),ej.datavisualization.Diagram.Util._translateLine(h,e.delta.x,e.delta.y),u={sourcePoint:h.sourcePoint,targetPoint:h.targetPoint},c.push(u)):(u={offsetX:e.object.offsetX-e.delta.x,offsetY:e.object.offsetY-e.delta.y},c.push(u),f={offsetX:e.object.offsetX,offsetY:e.object.offsetY},l.push(f));i={type:t.type,newValues:c,oldValues:l};r.source.push(t.object);r.changes.push(i);break;case"sizeCommand":var u={},f={},c=[],l=[];for(o=0;o<t.values.length;o++)e=t.values[o],u={width:e.values.width,height:e.values.height},c.push(u),f={width:e.object.width,height:e.object.height},l.push(f);i={type:t.type,newValues:c,oldValues:l};r.source.push(t.object);r.changes.push(i);break;case"zOrder":i={type:t.type,source:t.object,newValues:{zOrder:t.end},oldValues:{zOrder:t.object.zOrder}};r.source.push(t.object);r.changes.push(i)}return r},_getPseudoGroupElements:function(n,t){var e,r,u,i,s=this._UndoRedo?this.nameTable[t.undoObject.node.name]:t.redoObject.node,f,o;if(u={source:[],changes:[]},n&&n.type=="pseudoGroup")for(f=this._getChildren(n.children),r=0;r<f.length;r++)e=this.nameTable[f[r]],o=this._UndoRedo?t.undoObject.childTable[f[r]]:t.redoObject.childTable[f[r]],i=this._historyChangeEvent(o,e,t),i.source&&u.source.push(i.source),i.changes&&u.changes.push(i.changes);else i=this._UndoRedo?this._historyChangeEvent(n,s,t):this._historyChangeEvent(s,n,t),i.source&&u.source.push(i.source),i.changes&&u.changes.push(i.changes);return u},_propertyChangeEventValues:function(n){var f,e=[],i,r,u,t;i=n.elementType=="label"?n.label:n.elementType=="port"?n.port:n.object;r={};u={};for(t in n.values)i[t]!=n.values[t]&&(r[t]=i[t],u[t]=n.values[t]);return f={type:n.type,newValues:u,oldValues:r,deletedItems:[],addedItems:[]},e.push(f),{changes:e,source:i}},_historyChangeEvent:function(n,t,i){var r={type:i.type,deletedItems:[],addedItems:[],oldValues:{},newValues:{}};return n.offsetX!=t.offsetX&&(r.oldValues.offsetX=t.offsetX,r.newValues.offsetX=n.offsetX),n.offsetY!=t.offsetY&&(r.oldValues.offsetY=t.offsetY,r.newValues.offsetY=n.offsetY),n.width!=t.width&&(r.oldValues.width=t.width,r.newValues.width=n.width),n.height!=t.height&&(r.oldValues.height=t.height,r.newValues.height=n.height),n.rotateAngle!=t.rotateAngle&&(r.oldValues.rotateAngle=t.rotateAngle,r.newValues.rotateAngle=n.rotateAngle),n.sourcePoint!=t.sourcePoint&&(r.oldValues.sourcePoint=t.sourcePoint,r.newValues.sourcePoint=n.sourcePoint),n.targetPoint!=t.targetPoint&&(r.oldValues.targetPoint=t.targetPoint,r.newValues.targetPoint=n.targetPoint),{changes:r,source:t}},_undo:function(n){var o=[],t,f,i,s,h,c,r,l,u,e;if(this._UndoRedo=!0,n)if(n.category=="internal"){if(t=n.object||(n.undoObject?n.undoObject.node||n.undoObject:undefined)||n.shape,!t&&n.phase&&(t=n.phase),t&&n.undoObject&&n.undoObject.node&&(t=this.nameTable[t.name]||t),!t){this.undo();return}if(o=this._ComparehistoryChangeEvent(t,n),this._raiseEvent("historyChange",o),t&&t.parent&&(f=typeof t.parent=="object"?t.parent.name:t.parent),f&&!t.isLane&&!this.nameTable[f]){this._isUndo=!1;this.undo();return}switch(n.type){case"positionchanged":n.swimlaneMultiSelection?(n.undo=!0,this._recordMultiPinPointChanged(n)):(i={object:n.undoObject,isMultipleNode:n.isMultipleNode},this._recordPinPointChanged(i));break;case"rotationchanged":n.swimlaneMultiSelection?(n.undo=!0,this._recordMultiRotationChanged(n)):(i={object:n.undoObject,isMultipleNode:n.isMultipleNode},this._recordRotationChanged(i));break;case"sizechanged":n.undo=!0;n.swimlaneMultiSelection?this._recordMultiSizeChanged(n):(i={object:n.undoObject,isMultipleNode:n.isMultipleNode},this._recordSizeChanged(i,n));break;case"endpointchanged":i={undoObject:n.undoObject,redoObject:n.redoObject,isMultipleNode:n.isMultipleNode,_isUndo:!0};this._recordEndPointChanged(i);break;case"collectionchanged":if(n.changeType=="insert"&&!this.nameTable[n.object.name]){if(this._groupUndo)return;this._isUndo=!1;this.undo()}i={changeType:n.changeType,childTable:n.childTable,edgeTable:n.edgeTable,isUndo:!0,sourcePorts:n.sourcePorts,targetPorts:n.targetPorts,index:n.index};i.object=jQuery.extend(!0,{},n.object);s=this._recordCollectionChanged(i,n);s&&(n.sourcePorts=i.sourcePorts,n.targetPorts=i.targetPorts,n.edgeTable=i.edgeTable,n.childTable=i.childTable);break;case"labelchanged":i={object:n.shape,label:n.previousLabelValue,index:n.index?n.index:0};this._recordLabelChanged(i);break;case"labelcollectionchanged":n.isUndo=!0;this.labelcollectionchanged(n);break;case"groupchanged":i={object:n.object,isUndo:!0,actionType:n.actionType};this._recordGroupChanged(i);break;case"phasepositionchanged":n.undo=!0;this._recordPhasesizeChanged(n);break;case"phasecollectionchanged":n=$.extend(!0,{},{phase:n.phase,group:n.group,isAdded:n.isAdded,phaseObject:n.phaseObject,islastPhase:n.islastPhase});n.undo=!0;this._recordPhaseCollectionChanged(n);break;case"propertiesChanged":r=this.nameTable[n.object.name];r&&(h=this._getModifiedProperties(r,n.values,n[n.elementType]),n.elementType=="node"?this.updateNode(r.name,n.values):n.elementType=="connector"?this.updateConnector(r.name,n.values):n.elementType=="label"?n.label=this.updateLabel(r.name,n.label,n.values):n.elementType=="port"&&this.updatePort(r.name,n.port,n.values),n.values=h);break;case"portscollectionchanged":n.isUndo=!0;this._recordPortsCollectionChanged(n);break;case"nudge":this._recordNudgingChanges(t,n);break;case"spacingCommand":case"alignCommand":this._recordAlignCommandChanges(n);break;case"sizeCommand":this._recordSizeCommandChanges(n);break;case"swapLane":n=jQuery.extend(!0,{},{undoObject:n.undoObject,redoObject:n.redoObject,moveIndex:n.moveIndex,insertIndex:n.currentIndex});n.undo=!0;ej.datavisualization.Diagram.canvasHelper._undoSwap(this,n);break;case"zOrder":c=n.start;r=this.nameTable[n.object.name];this._comparePropertyValues(r,"zOrder",{zOrder:n.end});n.command=="back"?(this._bringElementsToFront(n.start,n.end,n.object,n.nearestNode),n.command="front"):(this._sendElementsToBack(n.start,n.end,n.object,n.nearestNode),n.command="back");n.nearestNode=this._findObjectByIndex(c);l=n.start;n.start=n.end;n.end=l}this.selectionList.length&&t&&this.selectionList[0].name!=t.name&&(this._clearSelection(!0),this._addSelection(this.nameTable[t.name],!0))}else this.model.historyManager.undo&&(u=this.model.historyManager.undo,typeof u=="string"&&(u=ej.util.getObject(u,window)),$.isFunction(u)&&(e=u(n.data),e&&(n.data=e)))},_redo:function(n){var o=[],t,f,i,s,h,r,c,u,e;if(this._UndoRedo=!1,n)if(n.category=="internal"){if(t=n.object||(n.undoObject?n.undoObject.node||n.undoObject:undefined)||n.shape,!t&&n.phase&&(t=n.phase),t&&n.undoObject&&n.undoObject.node&&(t=this.nameTable[t.name]||t),!t){this.redo();return}if(o=this._ComparehistoryChangeEvent(t,n),this._raiseEvent("historyChange",o),t&&t.parent&&(f=typeof t.parent=="object"?t.parent.name:t.parent),f&&!this.nameTable[f]){this._isUndo=!1;this.redo();return}switch(n.type){case"positionchanged":n.swimlaneMultiSelection?(n.undo=!1,this._recordMultiPinPointChanged(n)):(i={object:n.redoObject,isMultipleNode:n.isMultipleNode},this._recordPinPointChanged(i));break;case"rotationchanged":n.swimlaneMultiSelection?(n.undo=!1,this._recordMultiRotationChanged(n)):(i={object:n.redoObject,isMultipleNode:n.isMultipleNode},this._recordRotationChanged(i));break;case"sizechanged":n.undo=!1;n.swimlaneMultiSelection?this._recordMultiSizeChanged(n):(i={object:n.redoObject,isMultipleNode:n.isMultipleNode},this._recordSizeChanged(i));break;case"endpointchanged":i={undoObject:n.undoObject,redoObject:n.redoObject,isMultipleNode:n.isMultipleNode,_isUndo:!1};this._recordEndPointChanged(i);break;case"collectionchanged":i={changeType:n.changeType,childTable:n.childTable,edgeTable:n.edgeTable,isUndo:!1,sourcePorts:n.sourcePorts,targetPorts:n.targetPorts,index:n.index};i.object=jQuery.extend(!0,{},n.object);this._recordCollectionChanged(i,n.object);break;case"labelchanged":i={object:n.shape,label:n.updatedLabelValue,index:n.index?n.index:0};this._recordLabelChanged(i);break;case"labelcollectionchanged":n.isUndo=!1;this.labelcollectionchanged(n);break;case"groupchanged":i={object:n.object,actionType:n.actionType,isUndo:!1};this._recordGroupChanged(i);break;case"phasepositionchanged":n.undo=!1;this._recordPhasesizeChanged(n);break;case"phasecollectionchanged":n=$.extend(!0,{},{phase:n.phase,group:n.group,phaseObject:n.phaseObject,islastPhase:n.islastPhase,isAdded:n.isAdded});n.undo=!1;this._recordPhaseCollectionChanged(n);break;case"propertiesChanged":r=this.nameTable[n.object.name];r&&(s=this._getModifiedProperties(r,n.values,n[n.elementType]),n.elementType=="node"?this.updateNode(r.name,n.values):n.elementType=="connector"?this.updateConnector(r.name,n.values):n.elementType=="label"?n.label=this.updateLabel(r.name,n.label,n.values):n.elementType=="port"&&this.updatePort(r.name,n.port,n.values),n.values=s);break;case"portscollectionchanged":n.isUndo=!1;this._recordPortsCollectionChanged(n);break;case"nudge":this._recordNudgingChanges(t,n,!0);break;case"spacingCommand":case"alignCommand":this._recordAlignCommandChanges(n);break;case"sizeCommand":this._recordSizeCommandChanges(n);break;case"swapLane":n=jQuery.extend(!0,{},{undoObject:n.undoObject,redoObject:n.redoObject,moveIndex:n.moveIndex,insertIndex:n.currentIndex});n.undo=!1;ej.datavisualization.Diagram.canvasHelper._undoSwap(this,n);break;case"zOrder":h=n.start;r=this.nameTable[n.object.name];this._comparePropertyValues(r,"zOrder",{zOrder:n.end});n.command=="back"?(this._bringElementsToFront(n.start,n.end,n.object,n.nearestNode),n.command="front"):(this._sendElementsToBack(n.start,n.end,n.object,n.nearestNode),n.command="back");n.nearestNode=this._findObjectByIndex(h);c=n.start;n.start=n.end;n.end=c}this.selectionList.length&&t&&this.selectionList[0].name!=t.name&&(this._clearSelection(!0),this._addSelection(this.nameTable[t.name],!0))}else this.model.historyManager.redo&&(u=this.model.historyManager.redo,typeof u=="string"&&(u=ej.util.getObject(u,window)),$.isFunction(u)&&(e=u(n.data),e&&(n.data=e)))},_startGroupAction:function(){this.addHistoryEntry({type:"startGroup",category:"internal"})},_closeGroupAction:function(){this.addHistoryEntry({type:"closeGroup",category:"internal"})},addHistoryEntry:function(n){var i,u,r,f,t,e;if(!this.model.historyManager.suspend){if(this.model.historyManager.canLog&&(i=this.model.historyManager.canLog,typeof i=="string"&&(i=ej.util.getObject(i,window)),$.isFunction(i)&&(u=n.object||n.undoObject&&n.undoObject.node||n.shape,r=this._ComparehistoryChangeEvent(u,n),f={changes:r.changes.length?r.changes[0]:null,source:r.source.length?r.source[0]:null},i(f)==!1)))return;n.category!="internal"&&(n={data:n});this._historyList.canUndo&&this._historyList.currentEntry&&(this._historyList.currentEntry.data||this._historyList.currentEntry.category=="internal")&&(t=this._historyList.currentEntry,t.next?t.previous&&(e=t.next,e.previous=null,t.next=n,n.previous=t):(t.next=n,n.previous=t));this._historyList.currentEntry=n;this._historyList.canUndo=!0;this._historyList.canRedo=!1}},removeHistoryEntry:function(n){var r,t,i,u,f;if(this._historyList.currentEntry!=null){if(r=this._historyList.currentEntry,r)if(r==n)t=r.previous,i=r.next,this._historyList.currentEntry=i||t;else{for(u=r.next;u;)if(u==n){t=u.previous;i=u.next;break}else u=u.next;for(f=r.previous;f;)if(f==n){t=f.previous;i=f.next;break}else f=f.previous}t&&i?(t.next=i,i.previous=t):t?t.next=null:i&&(i.previous=null)}},canRemoveHistoryEntry:function(n){return n.category!="internal"},clearHistory:function(){var n=this._historyList;n.currentEntry=null;n.canUndo=!1;n.canRedo=!1;this._hScrollbar._scrollData=null;this._vScrollbar._scrollData=null},getUndoEntry:function(){var i=null,t,n=this._historyList;return n.canUndo&&(i=n.currentEntry,t=n.currentEntry.previous,t?(n.currentEntry=t,n.canRedo||(n.canRedo=!0)):(n.canRedo=!0,n.canUndo=!1)),i},getRedoEntry:function(){var i=null,t,n=this._historyList;return n.canRedo&&(t=n.currentEntry.previous||n.canUndo?n.currentEntry.next:n.currentEntry,t&&(n.currentEntry=t,n.canUndo||(n.canUndo=!0),t.next||(n.canRedo=!1,n.canUndo=!0)),i=n.currentEntry),i},cut:function(){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(this._pasteIndex=0,this._setClipboard(),this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard,this._multipleAction=!0,this._delete(),delete this._multipleAction)},insertLabel:function(n,t,i){var r,u,f,e;ej.datavisualization.Diagram.Util.isPageEditable(this)&&(r=this.nameTable[n],r&&t&&(u=this.getObjectType(r)=="node"?this.model.defaultSettings.node:this.model.defaultSettings.connector,u&&u.labels&&r.labels&&u.labels[i!==undefined?i:r.labels.length]&&(t=$.extend(!0,{},u.labels[i!==undefined?i:r.labels.length],t)),t=ej.datavisualization.Diagram.Label(t),f=u.labels,f.splice(),r.labels.push(t),e={element:r,index:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:f,newValue:r.labels},this._raisePropertyChange(e),ej.datavisualization.Diagram.DiagramContext.addLabel(r,t,this,i),this.addHistoryEntry({type:"labelcollectionchanged",shape:r,label:t,isUndo:!0,category:"internal",index:i})))},addLabel:function(n,t){var i,r,u,f;ej.datavisualization.Diagram.Util.isPageEditable(this)&&(i=this.nameTable[n],i&&t&&(r=this.getObjectType(i)=="node"?this.model.defaultSettings.node:this.model.defaultSettings.connector,r&&r.labels&&i.labels&&r.labels[i.labels.length]&&(t=$.extend(!0,{},r.labels[i.labels.length],t)),t=ej.datavisualization.Diagram.Label(t),i.labels.push(t),u=r.labels,u.splice(),i.labels.push(t),f={element:i,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:u,newValue:i.labels},this._raisePropertyChange(f),ej.datavisualization.Diagram.DiagramContext.addLabel(i,t,this),this.addHistoryEntry({type:"labelcollectionchanged",shape:i,label:t,isUndo:!0,category:"internal"})))},addPorts:function(n,t){var r,i;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(r=this.nameTable[n],r&&t)){for(i=0;i<t.length;i++)t[i]=ej.datavisualization.Diagram.Port(t[i]),r.ports.push(t[i]),this._raisePropertyChange({element:r,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"ports",oldValue:null,newValue:t[i]}),ej.datavisualization.Diagram.DiagramContext.renderPort(r,t[i],this);this.addHistoryEntry({type:"portscollectionchanged",object:r,collection:t,changeType:"insert",isUndo:!0,category:"internal"})}},updatePort:function(n,t,i){var u,r;if(n&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(u=this._findNode(n),i&&t&&(!i.name||t.name==i.name)&&u)){t=this._findPort(u,t.name);this._isUndo||this._recordPropertiesChanged(u,i,"port",t);i.name=t.name;this._comparePropertyValues(u,"ports",i);for(r in i)t.hasOwnProperty(r)&&(t[r]=typeof i[r]=="object"?$.extend(!0,{},t[r],i[r]):i[r]);ej.datavisualization.Diagram.DiagramContext.updatePort(u,t,this)}},copy:function(){return(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(this._pasteIndex=1,this.selectionList&&this.selectionList.length>0&&this._setClipboard()),this._cloneSelectionList()},paste:function(n,t){(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard,this._paste(n,t!==undefined?t:!0))},_commandPaste:function(){this.paste()},_setClipboard:function(){var i,t,f,s,r,u,n,e,o;if(this.selectionList.length>0){if(t=this.selectionList[0],f={},t._type==="group"||t.type==="pseudoGroup"){for(n=this._getChildren(t.children),r=0;r<n.length;r++)for(u=r+1;u<n.length;u++)e=this.nameTable[n[r]],o=this.nameTable[n[u]],o&&e&&o.zOrder<e.zOrder&&(s=n[r],n[r]=n[u],n[u]=s);f=this._getChildTable(t,f)}f[t.name]=t;i=$.extend(!0,{},{childTable:f,node:t});i.node.segments&&(i.node.targetNode=null,i.node.targetPort=null,i.node.sourceNode=null,i.node.sourcePort=null);this._clipboardData=i}},_getChildTable:function(n,t){var u,f,o,e,i,s,h,r;if(f=this._getChildren(n.children),f)for(e=0;e<f.length;e++)if(o=f[e],u=this.nameTable[o],u&&(u.parent===n.name||n.type=="pseudoGroup")){if(i=t[u.name]=$.extend(!0,{},u),(i._type==="group"||i.type==="pseudoGroup")&&(t=this._getChildTable(i,t)),i.inEdges&&i.inEdges.length>0)for(s in i.inEdges)r=this.nameTable[i.inEdges[s]],r&&(t[r.name]&&delete t[r.name],t[r.name]=r);if(i.outEdges&&i.outEdges.length>0)for(h in i.outEdges)r=this.nameTable[i.outEdges[h]],r&&(t[r.name]&&delete t[r.name],t[r.name]=r)}return t},_paste:function(n,t){var f,e,u,i,p,o,s,l,v,w,b,c,a,y,r;if(n){var s="",h=[],o=ej.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup"});for(t&&(s=ej.datavisualization.Diagram.Util.randomId()),r=0;r<n.length;r++)n[r].name+=s,n[r].type!="connector"?(n[r].type!=="group"&&n[r].type!=="bpmn"||n[r].isSwimlane||this._clonePasteGroup(n[r],s),n[r].isSwimlane&&this._clonePasteSwimlaneObj(n[r],s),n[r].outEdges&&(n[r].outEdges=[]),n[r].inEdges&&(n[r].inEdges=[]),n.length>1&&o.children.push(n[r].name),this.add($.extend({},n[r]))):h.push(n[r]);for(r=0;r<h.length;r++)h[r].sourceNode&&this.nameTable[h[r].sourceNode+s]?h[r].sourceNode+=s:(h[r].sourceNode="",h[r].sourcePort=""),h[r].targetNode&&this.nameTable[h[r].targetNode+s]?h[r].targetNode+=s:(h[r].targetNode="",h[r].targetPort=""),n.length>1&&o.children.push(h[r].name),this.add($.extend({},h[r]));n.length>1&&(this.nodes().push(o),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[o.name]=o,this._clearSelection(!0),ej.datavisualization.Diagram.Util._updateGroupBounds(o,this),this.addSelection(o,!0))}else if(this._clipboardData&&(f=this._clipboardData,f=$.extend(!0,{},{childTable:f.childTable,node:f.node}),i=f.node,i.zOrder=-1,i&&i.type!="phase")){if(i.container)i.isSwimlane?this._pasteSwimlaneObj(i,f):(i.isLane?(i=this._cloneLaneObj(i,ej.datavisualization.Diagram.Util.randomId(),f.childTable),i.orientation==="vertical"&&(i.height=i.height),y=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(i,this,this._clipboardData,!0),y&&(this._pasteObj=!0,this.add(y),this._pasteObj=!1),i=y):!i.container||i.isLane||i.isSwimlane||(i=this._cloneContainer(i,ej.datavisualization.Diagram.Util.randomId(),f.childTable),this.add(i)),e=this._pasteIndex*10,this._translate(i,e,e,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(i,this)),this._selectionContains(i)&&(this._clearSelection(!0),this._addSelection(i));else if(i.type=="pseudoGroup"){for(p=i.children,o=ej.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),this._isUndo=!0,this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.ClipBoard,this._multipleAction=!0,r=0;r<p.length;r++)s=p[r],u=f.childTable[s],u.zOrder=-1,u._annotation&&delete u._annotation,u&&(u.isLane||u.isSwimlane)?(l=this._pasteSwimlane(u,f,!0,this._pasteIndex*10),l&&o.children.push(l.name),e=this._pasteIndex*10,this._translate(l,e,e,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(l,this)):u&&(s=s+ej.datavisualization.Diagram.Util.randomId(),delete f.childTable[u.name],u.name=s,u.parent="",f.childTable[u.name]=u,this._preserveConnection(f.childTable,u),o.children.push(s),u._type==="group"&&u.type!="bpmn"?this._pasteChildren(f.childTable,u):u.children=[],e=this._pasteIndex*10,this._translate(u,e,e,this.nameTable),!u.segments||u.segments.length!=1||u.segments[0].type!="orthogonal"||u.sourceNode||u.targetNode||(c=u.segments[0].points),a=!1,a=this.add(u),c&&a&&(u=this.nameTable[u.name],u.segments[0].points=c,ej.datavisualization.Diagram.DiagramContext.update(u,this),ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom)));delete this._multipleAction;this._clearSelection();this.nodes().push(o);this._nodes=$.extend(!0,[],this.nodes());this.nameTable[o.name]=o;ej.datavisualization.Diagram.Util._updateGroupBounds(o,this);this._addSelection(o);v={};v=this._getChildTable(this.selectionList[0],v);w={type:"collectionchanged",object:this._updatePsedoGroupChildren(this.selectionList[0]),childTable:jQuery.extend(!0,{},v),changeType:"insert",category:"internal"};this.addHistoryEntry(w);this._isUndo=!1}else i.type=="bpmn"?(b=ej.datavisualization.Diagram.Util.randomId(),i.parent="",i.name=i.name+b,i.inEdges=[],i.outEdges=[],i.children=[],i._annotation&&delete i._annotation,e=this._pasteIndex*10,this._translate(i,e,e,this.nameTable),this.add(i)):(i.name=i.name+ej.datavisualization.Diagram.Util.randomId(),i.parent="",i._type==="group"?this._pasteChildren(f.childTable,i):i.segments||i.segments||(i.inEdges=[],i.outEdges=[]),e=this._pasteIndex*10,this._translate(i,e,e,this.nameTable),!i.segments||i.segments.length!=1||i.segments[0].type!="orthogonal"||i.sourceNode||i.targetNode||(c=i.segments[0].points),a=this.add(i),a&&c&&(i=this.nameTable[i.name],i.segments[0].points=c,ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom)),this._updateSelectionHandle());this._pasteIndex++}},_cloneContainer:function(n,t,i){var u,f,r;for(n.name=n.name+t,u=0;u<n.children.length;u++)f=i?i:this.nameTable,r=f[this._getChild(n.children[u])],r.name+=t,r.parent=n.name,r.children&&r.children.length>0&&(r=this._cloneContainer(r)),n.children[u]=r;return n},_clonePasteGroup:function(n,t){for(var i=0;i<n.children.length;i++)n.children[i].name+=t,n.children[i].parent=n.name},_clonePasteSwimlaneObj:function(n,t){var f,r,u,i;if(n.name+=t,n.lanes&&n.lanes.length>0)for(i=0;i<n.lanes.length;i++)if(n.lanes[i]&&(n.lanes[i].name+=t,n.lanes[i].children&&n.lanes[i].children.length>0))for(f=n.lanes[i].children,r=0;r<f.length;r++)u=jQuery.extend(!0,{},f[r]),u.name+=t,u.parent=n.lanes[i].name,n.lanes[i].children[r]=u;if(n.phases&&n.phases.length>0)for(i=0;i<n.phases.length;i++)n.phases[i]&&(n.phases[i].name+=t,n.phases[i].parent=n.name)},_cloneLaneObj:function(n,t,i){var n=ej.datavisualization.Diagram.SwimLaneContainerHelper._cloneLaneObj(this,n,t,i);return n},_cloneSwimlaneObj:function(n,t,i){n=$.extend(!0,{},n);var n=ej.datavisualization.Diagram.SwimLaneContainerHelper._cloneSwimlaneObj(this,n,t,i);return n},_pasteSwimlaneObj:function(n,t){return ej.datavisualization.Diagram.SwimLaneContainerHelper._pasteSwimlaneObj(this,n,t)},_pasteSwimlane:function(n,t,i,r){if(n&&n.isSwimlane)return ej.datavisualization.Diagram.SwimLaneContainerHelper._pasteSwimlane(this,n,t,i,r)},_cloneNode:function(n,t,i,r){var f=!1,e=null,n,u;if(n){if(n=typeof n=="string"?n:n.name,n=jQuery.extend(!0,{},t.childTable[n]),n.isPhaseStack&&(n.name=n.name.split("phaseStack")[0]+i+"phaseStack",f=!0,e=n.name),n.children&&n.children.length>0)for(u in n.children)this._cloneNode(n.children[u],t,i,e),n.children[u]&&(typeof n.children[u]=="string"?n.children[u]+=i:n.children[u].name+=i);r?n.parent=typeof r=="string"?r:r.name:n.parent!=""&&(n.parent+=i);f||(n.name+=i);this._preserveConnection(t.childTable,n);this.nameTable[n.name]=n}},_cloneSwimlane:function(n,t,i){var f=n.name,u,r;if(n.name+=i,n.children&&n.children.length>0)for(r in n.children)this._cloneNode(n.children[r],t,i,n),typeof n.children[r]=="string"?n.children[r]+=i:n.children[r]=n.children[r].isPhaseStack?f+i+"phaseStack":n.children[r].name+i;if(n.phases&&n.phases.length>0)for(r in n.phases)u=jQuery.extend(!0,{},this.nameTable[n.phases[r]]),u.name+=i,u.parent+=i,this.nameTable[u.name]=u,n.phases[r]=u.name;this.nameTable[n.name]=n},_pasteChild:function(n,t,i,r){var u=n.name+ej.datavisualization.Diagram.Util.randomId();delete t[n.name];n.name=u;t[n.name]=n;this._preserveConnection(t,n);n.parent=i.name;r.push(u);n._type==="group"&&this._pasteChildren(t,n);this.add(n)},_pasteChildren:function(n,t){for(var i,f,e=[],u=t.children,r=0;r<u.length;r++)f=this._getChild(u[r]),i=n[f],i.zOrder=-1,i&&this._pasteChild(i,n,t,e);t.children=e;this._preserveConnection(n,t)},_preserveConnections:function(n,t){for(var i,u=this._getChildren(t.children),r=0;r<u.length;r++)i=n[u[r]],i&&(this._preserveConnection(n,i),i._type==="group"&&this._preserveConnections(n,t))},_preserveConnection:function(n,t){var i,r,f,u;if(t.segments)t.targetNode&&(u=n[t.targetNode],u&&u.inEdges.push(t.name)),t.sourceNode&&(u=n[t.sourceNode],u&&u.outEdges.push(t.name));else{if(f=t.inEdges.length,f>0){for(i=0;i<f;i++)r=n[t.inEdges[i]],r&&(r.targetNode=t.name);t.inEdges=[]}if(f=t.outEdges.length,f>0){for(i=0;i<t.outEdges.length;i++)r=n[t.outEdges[i]],r&&(r.sourceNode=t.name);t.outEdges=[]}}},_expandChildren:function(n){for(var i,t,r=0;r<n.outEdges.length;r++)i=this.nameTable[n.outEdges[r]],t=this.nameTable[i.targetNode],t.excludeFromLayout||(i.visible=!0,ej.datavisualization.Diagram.DiagramContext.update(i,this),this._updateQuad(i),t.isExpanded&&this._expandChildren(t),t.visible=!0,ej.datavisualization.Diagram.DiagramContext.update(t,this),this._updateQuad(t))},_collapseChildren:function(n){for(var i,t,r=0;r<n.outEdges.length;r++)i=this.nameTable[n.outEdges[r]],t=this.nameTable[i.targetNode],t.excludeFromLayout||(i.visible=!1,ej.datavisualization.Diagram.DiagramContext.update(i,this),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[i.name],i),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,i),t.isExpanded&&this._collapseChildren(t),t.visible=!1,ej.datavisualization.Diagram.DiagramContext.update(t,this),ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t.name],t),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,t))},zoomTo:function(n){n||(n=new ej.datavisualization.Diagram.Zoom);n.zoomCommand&ej.datavisualization.Diagram.ZoomCommand.ZoomIn?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+n.zoomFactor,0,0,n.focusPoint,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+n.zoomFactor),0,0,n.focusPoint,!0)},remove:function(n){n&&this.nameTable[n.name]&&(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))?this._delete(n):this._delete()},clear:function(){if(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this)){this._clearSelection();this._updateScrollOffset(0,0);var n=this;this._views.forEach(function(t){var i=n._views[t];$(i.diagramLayer).empty();$(n._expander).empty();$(i.svg.document.parentNode.getElementsByClassName("htmlLayer")[0]).empty()});this.nodes([]);this.connectors([]);this._nodes=[];this._connectors=[];this.nameTable={};this.clearHistory();$("#"+this._canvas.id+"_hScrollbar").ejScrollBar({width:0});$("#"+this._canvas.id+"_vScrollbar").ejScrollBar({height:0});this._spatialSearch=ej.datavisualization.Diagram.SpatialSearch()}},_updateChildOnGroup:function(n){var i=null,t;return n&&n.parent&&(i=this._svg.document.getElementById(n.parent),t=this.nameTable[n.parent],t&&(t.container?ej.datavisualization.Diagram.ContainerHelper._add(this,n):(t.children.push(n.name),n._type=="group"&&this._initGroupNode(n),ej.datavisualization.Diagram.Util._refreshParentGroup(n,this)))),i},_raiseChildrenPropertyChange:function(n,t){var i,r,s;if(n&&n.parent){var r=this._findNode(n.parent),e,o,u=[],f=[];r&&(r.isLaneStack?(i=this._getNode(r.parent),f=i.lanes,f=f.slice(),t?i.lanes.push(n):i.lanes.splice(u.indexOf(this.getNode(n.name)),1),u=i.lanes,e=i,o="lanes"):r.isPhaseStack?(i=this._getNode(r.parent),f=i.phases,f=f.slice(),t?i.phases.push(n):i.phases.splice(u.indexOf(this.getNode(n.name)),1),u=i.phases,e=i,o="phases"):(r=this._getNode(n.parent),f=r.children.slice(),u=r.children.slice(),t?u.push(n.name):u.splice(u.indexOf(n.name),1),e=r,o="children"),s={element:e,cause:this._isDragg||this.activeTool.inAction?ej.datavisualization.Diagram.ActionType.Mouse:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:o,oldValue:f,newValue:u},this._raisePropertyChange(s))}},_add:function(n,t,i,r){var e,f,u,s,v,h,c,l,o,y,a,p;if(this._raiseChildrenPropertyChange(n,!0),e=!1,n.isSwimlane&&n.lanes&&n.lanes.length>0&&!this._pasteObj&&(n=ej.datavisualization.Diagram.SwimLaneHelper._initSwimLane(ej.datavisualization.Diagram.SwimLane(n),this)),n.length>0)for(o=0;o<n.length;o++)this.add(n[o]);else if(n=ej.datavisualization.Diagram.NodeType(n,this),n.addInfo&&(n.addInfo.height&&(n.height=n.addInfo.height),n.addInfo.width&&(n.width=n.addInfo.width)),f=n.type=="connector"?"connector":"node",u={changeType:"insert",element:this.getNode(n)},n.isLane?(u=this._raiseCollectionChangeEvent(n,f),this._updateLane(n,u.element)):n.isSwimlane?(u=this._raiseCollectionChangeEvent(n,f),this._updateSwimlane(n,u.element,!0)):n.container&&(n=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,n)),n.isLane||n.isSwimlane){if(!u.cancel&&(e=n.isLane&&(this._selectedSymbol&&this._selectedSymbol.isLane||this._isUndo)?!0:this.nodes().push(n),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[n.name]=n,e)){if(n._type==="group"&&t){if(this._paletteItemClick&&(n.offsetX=n.minWidth/2+50,n.offsetY=n.minHeight/2+50),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this),n.phases&&n.phases.length>0)for(l=null,o=0,y=n.phases.length;o<y;o++)l=this.nameTable[n.phases[o]],l.type=="phase"&&ej.datavisualization.Diagram.SvgContext.renderphase(l,this._svg,this._diagramLayer,this);this._clearSelection(!0);this._addSelection(n)}this._updateQuad(n)}}else n.type!="connector"?(c=this._eventCause[f+"CollectionChange"],c||(this._eventCause[f+"CollectionChange"]=this._isUndo?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Unknown),n._type==="group"||n.children&&n.children.length>0?(n=ej.datavisualization.Diagram.Group(n),this.nameTable[n.name]=n,u=this._raiseCollectionChangeEvent(n,f),n._type="group",n.type=="bpmn"&&(n=ej.datavisualization.Diagram.Util._updateBpmnChild(n,this)),this._initGroupNode(n)):n.isPhase||(n=this._getNewNode(n),this.nameTable[n.name]=n,u=this._raiseCollectionChangeEvent(n,f),this._getNodeDimension(n)),u.cancel||(n._status="new",e=this.nodes().push(n),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[n.name]=n,e&&(n._type==="group"||n.children&&n.children.length>0?(this._updateParent(n),n.offsetX==0&&n.offsetY==0&&ej.datavisualization.Diagram.Util._updateGroupBounds(n,this,!0),this._updateChildrenEdges(n),s=null,s=this._updateChildOnGroup(n),t&&!n.parent&&(ej.datavisualization.Diagram.Util._updateGroupBounds(n,this,!0),ej.datavisualization.Diagram.DiagramContext.renderGroup(n,this))):t&&(s=null,s=this._updateChildOnGroup(n),(n.parent===""||n.isPhase||this._isInsert)&&ej.datavisualization.Diagram.DiagramContext.renderNode(n,this,s),this._selectedSymbol&&n.textBlock&&(v=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],v&&(h=$(v).find("#"+n.name)[0],h&&h.childNodes&&h.childNodes.length>0&&(h.childNodes[0].style.display="none")))),this._updateQuad(n),this.nameTable[n.name]=n,t&&!r&&(this._clearSelection(!0),this._addSelection(n))))):(n=this._getNewConnector(n),this.nameTable[n.name]=n,c=this._eventCause[f+"CollectionChange"],c||(this._eventCause[f+"CollectionChange"]=this._isUndo?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Unknown),u=this._raiseCollectionChangeEvent(n,f),u.cancel||(e=n.parent?!0:this.model.connectors.push(n),n._status="new",e&&(this._updateEdges(n),this._dock(n,this.nameTable),ej.datavisualization.Diagram.Util.updateBridging(n,this),n.parent||t&&ej.datavisualization.Diagram.DiagramContext.renderConnector(n,this),this.nameTable[n.name]=n,this._updateQuad(n),this._updateChildOnGroup(n),t&&!r&&(this._clearSelection(!0),this._addSelection(n,!0)))));return this._setZorder(n),!this._isUndo&&(!this._selectedSymbol||this._endEditing)&&e&&(a={},this.selectionList&&this.selectionList.length>0&&(a=this._getChildTable(this.selectionList[0],a)),i&&(!i||i.entryHistory)||n.isPhase||(p={type:"collectionchanged",object:jQuery.extend(!0,{},n),childTable:jQuery.extend(!0,{},a),changeType:"insert",category:"internal"},this.addHistoryEntry(p))),this._trigger("refresh"),e},_raiseCollectionChangeEvent:function(n,t){var i={changeType:"insert",element:this.getNode(n)};return n.isPhase||this._selectedSymbol&&!this._endEditing||(this._raiseEvent(t+"CollectionChange",i),n._absolutePath=null),i},add:function(n,t){if(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))return this._add(n,!0,t)},updateUserHandles:function(n){n=this.nameTable[n.name];ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,n,this._adornerSvg,!1,!1,this._currZoom,this)},scrollToNode:function(n){var u,f,i=this._currZoom,r=this.element[0].getBoundingClientRect(),t=ej.datavisualization.Diagram.Util.bounds(n),e,o;u=(t.x+t.width/2)*i;f=(t.y+t.height/2)*i;e=this._hScrollOffset;o=this._vScrollOffset;r.width+this._hScrollOffset<u+t.width/2&&(e=u+(t.width/2+20)*i-r.width);r.height+this._vScrollOffset<f+t.height/2&&(o=f+(t.height/2+20)*i-r.height);this._updateScrollOffset(e,o)},findNode:function(n){return this._findNode(n)},getObjectType:function(n){return ej.datavisualization.Diagram.Util.getObjectType(n)},_registerDrawingTools:function(){var t,n;for(t in this.model.drawingTools)n=this.model.drawingTools[t],n.diagram=this,this.tools[n.name]=n},_sortByXvalue:function(n){for(var f,i,r,u,e,o,t=0;t<n.length;t++)for(i=t+1;i<n.length;i++)e=this.nameTable[n[t]],o=this.nameTable[n[i]],r=ej.datavisualization.Diagram.Util.bounds(e),u=ej.datavisualization.Diagram.Util.bounds(o),(r.x>u.x||r.right>u.right)&&(f=n[t],n[t]=n[i],n[i]=f);return n},_sortByYvalue:function(n){for(var f,i,r,u,e,o,t=0;t<n.length;t++)for(i=t+1;i<n.length;i++)e=this.nameTable[n[t]],o=this.nameTable[n[i]],r=ej.datavisualization.Diagram.Util.bounds(e),u=ej.datavisualization.Diagram.Util.bounds(o),(r.y>u.y||r.bottom>u.bottom)&&(f=n[t],n[t]=n[i],n[i]=f);return n},_sortByZIndex:function(n,t){var u,i,r;if(t)for(i=0;i<n.length;i++)for(r=i+1;r<n.length;r++)n[i].zOrder>n[r].zOrder&&(u=n[i],n[i]=n[r],n[r]=u);else for(i=0;i<n.length;i++)for(r=i+1;r<n.length;r++)n[i].zOrder<n[r].zOrder&&(u=n[i],n[i]=n[r],n[r]=u);return n},_updateBPMNIndex:function(n,t){var s,r,u,o,i,f,e;if(n.type==="bpmn"&&n.parent&&(o=this.nameTable[n.parent],o&&o.isLane))for(i=o.children,r=0;r<i.length;r++)for(u=r+1;u<i.length;u++)f=this.nameTable[i[r]],e=this.nameTable[i[u]],!(t?f.zOrder>e.zOrder:f.zOrder<e.zOrder)||f.isPhase||e.isPhase||f.isLane||e.isLane||(s=i[r],i[r]=i[u],i[u]=s)},_sortByGroupChildrenZIndex:function(n){for(var s=this.nodes(),h,i,u,r,t,f,e,o=0;o<s.length;o++)if(r=s[o],this._updateBPMNIndex(r,n),r._type==="group"&&r.type!=="bpmn"&&!r.isSwimlane){for(t=this._getChildren(r.children),i=0;i<t.length;i++)for(u=i+1;u<t.length;u++)f=this.nameTable[t[i]],e=this.nameTable[t[u]],!(n?f.zOrder>e.zOrder:f.zOrder<e.zOrder)||f.isPhase||e.isPhase||f.isLane||e.isLane||(h=t[i],t[i]=t[u],t[u]=h);r.children=t}},_findCornerNodes:function(){var i,r,u,f,e,n,s=this.selectionList[0].children,o=this.nameTable[this.selectionList[0].children[0]],t,h,c,l,a;if(i=o,r=o,u=o,f=o,s.length>1)for(e=0;e<s.length;e++)t=this.nameTable[s[e]],n=ej.datavisualization.Diagram.Util.bounds(t),h=ej.datavisualization.Diagram.Util.bounds(r),n.x+n.width>h.x+h.width&&(r=t),c=ej.datavisualization.Diagram.Util.bounds(f),n.y+n.height>c.y+c.height&&(f=t),l=ej.datavisualization.Diagram.Util.bounds(i),n.x<l.x&&(i=t),a=ej.datavisualization.Diagram.Util.bounds(u),n.y<a.y&&(u=t);return{left:i,right:r,top:u,bottom:f}},_comparePropertyOnAlign:function(n,t,i,r){n&&(n.segments?(this._comparePropertyValues(n,"sourcePoint",{sourcePoint:{x:n.sourcePoint.x+t,y:n.sourcePoint.y+i}},r),this._comparePropertyValues(n,"targetPoint",{targetPoint:{x:n.targetPoint.x+t,y:n.targetPoint.y+i}},r)):(n.offsetX!=n.offsetX+t&&this._comparePropertyValues(n,"offsetX",{offsetX:n.offsetX+t},null,r),n.offsetY!=n.offsetY+i&&this._comparePropertyValues(n,"offsetY",{offsetX:n.offsetY+i},null,r)))},_moveNode:function(n,t,i){this._comparePropertyOnAlign(i,n,t,ej.datavisualization.Diagram.ActionType.Align);this._translate(i,n,t,this.nameTable);this._updateNodeMargin(i);ej.datavisualization.Diagram.DiagramContext.update(i,this)},_updateContainerOnNudge:function(n){var t=this.nameTable[n.parent];t&&t.container&&(ej.datavisualization.Diagram.canvasHelper._updateNodeMargin(this,n,t),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,t,!0))},_outOfBoundsOnNudge:function(n,t,i){var r=this.nameTable[this._getChild(n.parent)],u,e,h;if(r&&r.isLane&&r.parent&&(u=this.nameTable[this._getChild(r.parent)],u&&u.isLaneStack&&u.parent&&(e=this.nameTable[this._getChild(u.parent)],e&&this.model.pageSettings.boundaryConstraints!="infinity"))){var c=ej.datavisualization.Diagram.Util.bounds(r),l=ej.datavisualization.Diagram.Util.bounds(n),f=ej.datavisualization.Diagram.Util.bounds(e),o=f.right,s=f.bottom;if(l.bottom+i+20>=c.bottom&&(s+=i),l.right+t+20>=c.right&&(o+=t),h=this.activeTool._getPageBounds(),i>0&&f.bottom!=s&&s>h.height||t>0&&f.right!=o&&o>h.width)return!1}return!0},_nudge:function(n,t,i,r,u,f){var c,v,l,e,y,h,o;if(!n||!n.segments||!n.sourceNode||!n.targetNode){var a,k=this.nameTable[n.parent],s;if(this._outOfBoundsOnNudge(n,t,i)){if(!u)if(n.segments)s={element:n,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:r,propertyName:"sourcePoint",oldValue:{sourcePoint:n.sourcePoint},newValue:{sourcePoint:{x:n.sourcePoint.x+t,y:n.sourcePoint.y+i}}},this._raisePropertyChange(s),s={element:n,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:r,propertyName:"targetPoint",oldValue:{targetPoint:n.targetPoint},newValue:{targetPoint:{x:n.targetPoint.x+t,y:n.targetPoint.y+i}}},this._raisePropertyChange(s);else{var p=r==="right"||r==="left"?n.offsetX:n.offsetY,w=r==="right"||r==="left"?n.offsetX+t:n.offsetY+i,b=r==="right"||r==="left"?"offsetX":"offsetY";s={element:n,cause:ej.datavisualization.Diagram.ActionType.Nudge,keyCode:r,propertyName:b,oldValue:p,newValue:w};this._raisePropertyChange(s)}if(e=this.nameTable[n.parent],e&&e.isLane&&(c=this._moveOnLane(n,e,t,i)),!0&&(!c||c.proceedY)||(i=0),!0&&(!c||c.proceedX)||(t=0),n.type=="pseudoGroup"){for(v=this._removeContainerConnector(this._getChildren(n.children)),l=0;l<v.length;l++)a=this.nameTable[this._getChild(v[l])],a&&(this._nudge(a,t,i,r,!0,l===v.length-1),this._updateContainerOnNudge(a));ej.datavisualization.Diagram.Util._updateGroupBounds(n,this)}else this._translate(n,t,i,this.nameTable),this._updateContainerOnNudge(n);if(this._updateNodeMargin(n),n.parent){if(e=this.nameTable[n.parent],e&&e.container&&(ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._disablePhaseUpdate=!0,this._disableSwimlaneUptate=!0,e.container.type==="canvas"&&ej.datavisualization.Diagram.canvasHelper._updateCollectionChange(this,e),delete this._disablePhaseUpdate,!u,y=this.nameTable[e.parent],y&&(h=this.nameTable[y.parent],ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,h),!u,this._updateSwimlanes||(this._updateSwimlanes=[]),this._collectionContains(h.name,this._updateSwimlanes)||this._updateSwimlanes.push(h.name),u||(delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.DiagramContext.update(h,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,h,!0)))),f&&this._updateSwimlanes){for(delete this._disableSwimlaneUptate,o=0;o<this._updateSwimlanes.length;o++)ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[this._updateSwimlanes[o]],this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[this._updateSwimlanes[o]]);delete this._updateSwimlanes}}else if(f&&this._updateSwimlanes){for(o=0;o<this._updateSwimlanes.length;o++)ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[this._updateSwimlanes[o]],this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[this._updateSwimlanes[o]]);delete this._updateSwimlanes}else ej.datavisualization.Diagram.DiagramContext.update(n,this);this._updateSelectionHandle(!0)}}},_removeContainerConnector:function(n){var r=[],t,i;if(n&&n.length>0)for(t=0;t<n.length;t++)i=this.nameTable[this._getChild(n[t])],i&&!i.segments?r.push(n[t]):!i.segments||i.sourceNode||i.targetNode||r.push(n[t]);return r},_moveOnLane:function(n,t,i,r){var h=!1,o=0,c=!1,s=0,u,f,e;return i=i?i:0,r=r?r:0,t.children&&t.children.length>0&&(u=this.nameTable[this._getChild(t.children[0])],u&&u.name.indexOf("_Headerr")!=-1&&(t.orientation==="horizontal"?o=u.width:t.orientation==="vertical"&&(s=u.height))),n&&t?(f=ej.datavisualization.Diagram.Util.bounds(n),e=ej.datavisualization.Diagram.Util.bounds(t),f.y+r>=e.y+t.paddingTop+s&&(h=!0),f.x+i>=e.x+t.paddingLeft+o&&(c=!0),{proceedY:h,proceedX:c,x:e.x+t.paddingLeft+o-f.x+i,y:e.y+t.paddingTop+s-f.y+r}):void 0},_selectCommand:function(n){this._isEditing&&(this._endEdit(),document.getElementById(this._id).focus());n.keyDownEventArgs.preventDefault();this.selectAll()},_nudgeCommand:function(n){!this._currentState&&this.selectionList[0]&&(this._currentState={x:this.selectionList[0].offsetX,y:this.selectionList[0].offsetY});this.nudge(n.parameter,n.keyDownEventArgs.shiftKey?5:1);n.keyDownEventArgs.preventDefault()},_startEditCommand:function(){var n,t,i;this.selectionList.length>0&&(n=this.selectionList[0],n.type=="pseudoGroup"||(n.type==="text"&&this._setLabelEditing(n.textBlock)&&this._startEdit(n),n.isSwimlane?(t=this.nameTable[n.name+"_header_swimlane"],t&&this._startEdit(t)):n.isLane?n.children&&n.children.length>0&&(t=this.nameTable[this._getChild(n.children[0])],t&&this._startEdit(t)):n.type&&n.type==="phase"?(i=this.nameTable["phaseStack"+n.name],i&&this._startEdit(i)):n.labels.length>0&&this._setLabelEditing(n.labels[0])&&this._startEdit(n)))},_findObjectByName:function(n){var t=null;return this._findNode(n)&&(t=this._findNode(n)),this._findConnector(n)&&(t=this._findConnector(n)),t},_findObjectByIndex:function(n,t){var e,u=null,i,r,f,o;if(t){if(o=this.nameTable[this.selectionList[0].parent],o)for(e=this._getChildren(o.children),f=0;f<e.length;f++)i=this.nameTable[e[f]],i.zOrder===n&&(u=e[f])}else{for(r=0;r<this.nodes().length;r++)i=this.nodes()[r],i.zOrder===n&&(u=i);for(r=0;r<this.connectors().length;r++)i=this.connectors()[r],i.zOrder===n&&(u=i)}return typeof u=="string"?this.nameTable[u]:u},_findOverlapNode:function(n){var i=[],t,r,s=[],u,h,e,o,f;if(n.parent){if(u=ej.datavisualization.Diagram.Util.bounds(n),h=this.nameTable[n.parent],h)for(o=this._getChildren(h.children),t=0;t<o.length;t++)o[t]!==n.name&&(e=this.nameTable[o[t]],f=ej.datavisualization.Diagram.Util.bounds(e),e&&this._intersect(u,f)&&s.push(e))}else{for(t=0;t<this.nodes().length;t++)i.push(this.nodes()[t]);for(t=0;t<this.connectors().length;t++)i.push(this.connectors()[t]);if(u=ej.datavisualization.Diagram.Util.bounds(n),n)for(r=0;r<i.length;r++)f=ej.datavisualization.Diagram.Util.bounds(i[r]),n.name===i[r].name||n.children&&this._collectionContains(i[r].name,n.children)||this._intersect(u,f)&&s.push(i[r])}return s},_intersect:function(n,t){return n.x<=t.x+t.width&&t.x<=n.x+n.width&&n.y<=t.y+t.height&&t.y<=n.y+n.height},_focusToItem:function(n){var u=this.nodes(),f=this.connectors(),i=0,r=[],t,e=this;if(u.length||f.length){this._diagramElements||(r=this.nodes().concat(this.connectors()),r=this._sortByZIndex(r,!0),r=r.map(function(n){return n.name}),this._diagramElements=r);i=this._focusedElement||this.selectionList.length||!this._diagramElements.length?this._focusedElement?this._diagramElements.indexOf(this._focusedElement):this.selectionList[0].type!="pseudoGroup"?this._diagramElements.indexOf(this.selectionList[0].name):Math.min.apply(Math,this.selectionList[0].children.map(function(n){return e._diagramElements.indexOf(n.name||n)})):n.keyDownEventArgs.shiftKey?0:this._diagramElements.length-1;do(i=n.keyDownEventArgs.shiftKey?i!=0?--i:this._diagramElements.length-1:i!=this._diagramElements.length-1?++i:0,this.nameTable[this._diagramElements[i]].type!="pseudoGroup")&&(this._focusedElement=this._diagramElements[i]);while(!ej.datavisualization.Diagram.Util.canSelect(this.nameTable[this._focusedElement]));t=ej.datavisualization.Diagram.Util.bounds(this.nameTable[this._focusedElement]);t={x:t.x-8,y:t.y-8,width:t.width+16,height:t.height+16};this.bringIntoView({x:t.x-25,y:t.y-25,width:t.width+50,height:t.height+50});ej.datavisualization.Diagram.SvgContext._drawNavigationHighlighter(t,this._adornerSvg,this._adornerLayer,this._currZoom);n.keyDownEventArgs.preventDefault()}},_selectFocusedItem:function(n){ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer);var t=this.nameTable[this._focusedElement];this._eventCause.selectionChange=ej.datavisualization.Diagram.SelectionChangeCause.Keydown;t&&this.addSelection(t,!0);this._diagramElements=null;this._focusedElement=null;n.keyDownEventArgs.preventDefault()},_createDefaultTooltip:function(){var n=document.createElement("div"),t={id:this.element[0].id+"_DefaulttooltipDiv","class":"e-diagram-tooltip-default",style:"padding-top:3px; height: 24px;pointer-events:none;"},i;return ej.datavisualization.Diagram.Util.attr(n,t),this._tooltipLayer.appendChild(n),this.model.tooltipTemplateId||(i=document.createElement("span"),t={"class":"e-diagram-tooltipLabel-default",id:"e-diagram-tooltipLabel-default"},ej.datavisualization.Diagram.Util.attr(i,t),n.appendChild(i)),n},_createMouseOverTooltip:function(){var n=document.createElement("div"),t={id:this.element[0].id+"_mouseovertooltipDiv","class":"e-diagram-tooltip-mouseover",style:"pointer-events:none;"};return ej.datavisualization.Diagram.Util.attr(n,t),this._tooltipLayer.appendChild(n),n},_renderTooltip:function(n,t){var r,e,u,o,s,f,h,i;n.parent&&this.nameTable[n.parent]&&this.nameTable[n.parent].container||this.model.selectedItems.tooltip&&(r=document.getElementById(this.element[0].id+"_DefaulttooltipDiv"),r||(r=this._createDefaultTooltip()),f=this._currZoom,this.model.selectedItems.tooltip.templateId?$.templates&&this.model.selectedItems.tooltip&&(n.segments||(i=this._getTooltipPosition(n,this.model.selectedItems.tooltip),i.x=-this._hScrollOffset+i.x*f,i.y=-this._vScrollOffset+i.y*f,r.style.top=i.y+"px",r.style.left=i.x+"px",r.style.transform="translate("+i.tx+" ,"+i.ty+")",e=$.templates("#"+this.model.selectedItems.tooltip.templateId),o=e.render(n),$(r).html(o))):(t&&(r.style.width="150px"),s=150,h=r.childNodes[0],this.activeTool instanceof ej.datavisualization.Diagram.MoveTool?n.segments||(u="X : "+Math.round(n.offsetX-n.width*n.pivot.x)+"px  Y : "+Math.round(n.offsetY-n.height*n.pivot.y)+"px"):this.activeTool instanceof ej.datavisualization.Diagram.ResizeTool?u="W : "+Math.round(n.width)+"px  H : "+Math.round(n.height)+"px":this.activeTool instanceof ej.datavisualization.Diagram.RotateTool&&(t&&(r.style.width="50px"),s=50,u=Math.round(n.rotateAngle)+"°"),u?(i=this._getTooltipPosition(n,this.model.selectedItems.tooltip),i.x=-this._hScrollOffset+i.x*f,i.y=-this._vScrollOffset+i.y*f,r.style.top=i.y+"px",r.style.left=i.x+"px",r.style.transform="translate("+i.tx+" ,"+i.ty+")",h.textContent=u):this._removeTooltip()))},_removeTooltip:function(){var n=document.getElementById(this.element[0].id+"_DefaulttooltipDiv");n&&n.parentNode.removeChild(n)},_removeMouseOverTooltip:function(){var n=document.getElementById(this.element[0].id+"_mouseovertooltipDiv");n&&n.parentNode.removeChild(n)},_renderCanvas:function(n){this._browserInfo=ej.browserInfo();this._canvas=document.getElementById(this.element[0].id+"_canvas");this._canvas||(this._canvas=document.createElement("div"),this.element.append(this._canvas));this._canvas.setAttribute("id",this.element[0].id+"_canvas");(this._canvas.getAttribute("class")===null||this._canvas.getAttribute("class")==="")&&this._canvas.setAttribute("class","drawing");this._canvas.setAttribute("style","position:relative; height:"+this.model.height+"; width:"+this.model.width+";");this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width});this._views[this._id].canvas=this._canvas;this.element[0].setAttribute("tabindex",0);this._renderDiagram(n);ej.datavisualization.Diagram.Util.canFloatElements(this)&&this._setItemDraggable(this._canvas)},_getDigramBounds:function(n){var t,i,u,f,r;return t=this._spatialSearch.pageLeft||0,i=this._spatialSearch.pageTop||0,u=this._spatialSearch.pageRight-this._spatialSearch.pageLeft||0,f=this._spatialSearch.pageBottom-this._spatialSearch.pageTop||0,n!="content"&&(this.model.pageSettings&&this._multiplePage()?(t=this._spatialSearch.pageLeft,i=this._spatialSearch.pageTop,this._pageWidth()&&(t=Math.floor(t/this._pageWidth())*this._pageWidth(),u=Math.ceil(this._spatialSearch.pageRight/this._pageWidth())*this._pageWidth()-t),this._pageHeight()&&(i=Math.floor(i/this._pageHeight())*this._pageHeight(),f=Math.ceil(this._spatialSearch.pageBottom/this._pageHeight())*this._pageHeight()-i),this._spatialSearch.pageRight===null&&this._pageWidth()!==0&&(u=this._pageWidth()),this._spatialSearch.pageBottom===null&&this._pageHeight()!==0&&(f=this._pageHeight())):(this._pageWidth()&&(t=0,u=this._pageWidth()),this._pageHeight()&&(i=0,f=this._pageHeight()))),r=new ej.datavisualization.Diagram.Rectangle,r.x=t,r.y=i,r.width=u,r.height=f,r},_initContextMenu:function(n){this.enableContextMenu()?this._renderContextMenu(n):$("#"+this.element[0].id+"_contextMenu").remove()},_renderContextMenuItem:function(n){var r=document.createElement("li"),f=document.createElement("a"),o=ej.datavisualization.Diagram.Locale[this.locale()],t,u,i,e;if(f.innerHTML=o[n.name]||n.text,r.setAttribute("id",this.element[0].id+"_contextMenu_"+n.name),t=document.createElement("span"),t.setAttribute("id",n.text+"_image"),t.setAttribute("style","display:table-cell; vertical-align:middle; text-align:center"),t.setAttribute("class","sf-d-menuitem "+n.name),f.appendChild(t),n.subItems&&n.subItems.length>0){for(u=document.createElement("ul"),i=0,i;i<n.subItems.length;i++)e=this._renderContextMenuItem(n.subItems[i],u),e.setAttribute("style","display:block;"),u.appendChild(e);r.appendChild(u)}return r.appendChild(f),r},_renderContextMenu:function(){var f=$.extend(!0,[],this.model.contextMenu.items),t,e,i,n,u,o,r;if(!this.model.contextMenu.showCustomMenuItemsOnly){for(t=[],n=0;n<this._defaultContextMenuItems.length;n++)if(e=!1,this.model.contextMenu.items.length)for(i=0;i<this.model.contextMenu.items.length;i++){if(this.model.contextMenu.items[i].name===this._defaultContextMenuItems[n].name){e=!0;break}i!==this.model.contextMenu.items.length-1||e||t.push(this._defaultContextMenuItems[n])}else t.push(this._defaultContextMenuItems[n]);for(n=0;n<t.length;n++)f.push(t[n])}for(n=0,r=document.createElement("ul"),r.setAttribute("id",this.element[0].id+"_contextMenu"),n=0;n<f.length;n++)u=f[n],u&&u.name&&(o=this._renderContextMenuItem(u,r),r.appendChild(o));this._canvas.appendChild(r);$("#"+this.element[0].id+"_contextMenu").ejMenu({menuType:ej.MenuType.ContextMenu,contextMenuTarget:"#"+this.element[0].id+"_canvas",click:$.proxy(this._onMenuItemClick,this),beforeOpen:$.proxy(this._onContextMenuOpen,this),mouseover:$.proxy(this._onMenuItemMouseOver,this),mouseout:$.proxy(this._onMenuItemMouseOut,this),close:$.proxy(this._onContextMenuClose,this)});$("#"+this.element[0].id+"_contextMenu")[0].style.display="none"},_onContextMenuClose:function(){this.element[0].focus()},_onContextMenuOpen:function(n){var t,i,r,u;if(this._disableDefaultContextMenu)return delete this._disableDefaultContextMenu,!1;t=this.element[0].id;i=this._findNodeUnderMouse(n);i===null&&n.target&&$(n.target).attr("class")==="segmentEnd"&&this.selectionList[0]&&(i=this.selectionList[0]);r=!1;$(n.target).parents(".e-scrollbar").length&&(n.cancel=!0,$("#"+this.element[0].id+"_contextMenu").ejMenu("instance").hideContextMenu());this.selectionList[0]&&(this.selectionList[0].type==="pseudoGroup"||this.selectionList[0]._type==="group")&&(r=!0);!i&&this.selectionList.length>0&&!r&&this._clearSelection();this.enableContextMenu()&&($("#"+t+"_contextMenu_cut")[0]&&($("#"+t+"_contextMenu_cut")[0].style.display=this.selectionList.length?"block":"none"),$("#"+t+"_contextMenu_copy")[0]&&($("#"+t+"_contextMenu_copy")[0].style.display=this.selectionList.length?"block":"none"),$("#"+t+"_contextMenu_paste")[0]&&($("#"+t+"_contextMenu_paste")[0].style.display=this._clipboardData?"block":"none"),$("#"+t+"_contextMenu_undo")[0]&&($("#"+t+"_contextMenu_undo")[0].style.display=this._historyList&&this._historyList.canUndo?"block":"none"),$("#"+t+"_contextMenu_redo")[0]&&($("#"+t+"_contextMenu_redo")[0].style.display=this._historyList&&this._historyList.canRedo?"block":"none"),$("#"+t+"_contextMenu_selectAll")[0]&&($("#"+t+"_contextMenu_selectAll")[0].style.display=this.nodes().length+this.connectors().length?"block":"none"),$("#"+t+"_contextMenu_grouping")[0]&&($("#"+t+"_contextMenu_grouping")[0].style.display=this.selectionList[0]&&(this.selectionList[0].type=="group"||this.selectionList[0].type=="pseudoGroup")?"block":"none"),$("#"+t+"_contextMenu_order")[0]&&($("#"+t+"_contextMenu_order")[0].style.display=this.selectionList.length?"block":"none"));u={diagram:this,contextmenu:n};u.target=this.selectionList.length?this.selectionList[0]:this.activeTool.prevSelectObject?this.activeTool.prevSelectObject:this;this._trigger("contextMenuBeforeOpen",u);this.enableContextMenu()&&($("#"+t+"_contextMenu")[0].style.display="block",$("#"+t+"_contextMenu")[0].clientHeight<=2&&(n.cancel=!0),$("#"+t+"_contextMenu")[0].style.display="none");n.events.originalEvent=n.events;this.activeTool.mouseup(n.events,!0)},_onMenuItemClick:function(n){var t=n.events.ID.replace(this._id+"_contextMenu_","");if(n.canExecute=!0,n.target=this.selectionList.length?this.selectionList[0]:this.activeTool.prevSelectObject?this.activeTool.prevSelectObject:this,this._trigger("contextMenuClick",n),n.canExecute)switch(t){case"cut":this.cut();break;case"copy":this.copy();break;case"paste":this.paste();break;case"undo":this.undo();break;case"redo":this.redo();break;case"selectAll":this.selectAll();break;case"group":this.group();break;case"ungroup":this.ungroup();break;case"bringToFront":this.bringToFront();break;case"sendToBack":this.sendToBack();break;case"moveForward":this.moveForward();break;case"sendBackward":this.sendBackward()}},_onMenuItemMouseOver:function(n){var t=n.events.element.lastChild.childNodes[1];$(t).addClass("hover")},_onMenuItemMouseOut:function(n){var t=n.events.element.lastChild.childNodes[1];$(t).removeClass("hover")},_renderDiagram:function(n){var t=this;this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);this._views.forEach(function(i){var r=t._views[i],u;r.type=="mainview"&&r.context==ej.datavisualization.Diagram.SvgContext&&(r.context._renderDocument(r,t,n),t._createScrollbar(t._canvas),ej.datavisualization.Diagram.ScrollUtil._initScrollbar(t),ej.datavisualization.Diagram.PageUtil._updatePageSize(t));n||(u=t._setNodeZOrder(r),t._renderDiagramObjects(u,r))});$(this._svg.document).pinchDiagram(this._view,this)},_createScrollbar:function(n){var i=document.createElement("div"),t;i.setAttribute("id",n.id+"_hScrollbar");document.getElementById(n.id+"_hScrollbar")||n.appendChild(i);t=document.createElement("div");t.setAttribute("id",n.id+"_vScrollbar");document.getElementById(n.id+"_vScrollbar")||n.appendChild(t)},_disableScrollbar:function(){this._isMobile&&($("#"+this._hScrollbar._id).addClass("e-disable").attr({"aria-disabled":!0,style:"display: none;"}),$("#"+this._vScrollbar._id).addClass("e-disable").attr({"aria-disabled":!0,style:"display: none;"}))},_doLayout:function(){this.model.layout&&this._layoutType()!==ej.datavisualization.Diagram.LayoutTypes.None&&(this._updateEdgeCollection(),ej.datavisualization.Diagram.Layout.doLayout(this))},_updateNodes:function(){for(var t=this.nodes(),n=0;n<t.length;n++)ej.datavisualization.Diagram.DiagramContext.update(t[n],this)},_updateConnectors:function(){for(var t=this.connectors(),n=0;n<t.length;n++)ej.datavisualization.Diagram.DiagramContext.update(t[n],this)},_updateEdgeCollection:function(){for(var n=0;n<this.connectors().length;n++)this._updateEdges(this.connectors()[n])},updateViewPort:function(){this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);ej.datavisualization.Diagram.DiagramContext.updateViewPort(this);this.model.scrollSettings.viewPortHeight=this._viewPort.height;this.model.scrollSettings.viewPortWidth=this._viewPort.width;var n=this;this._views.forEach(function(t){var r=n._views[t],i;r.type=="overview"&&(i=$("#"+t).ejOverview("instance"),i&&i._scrollOverviewRect(n._hScrollOffset,n._vScrollOffset,n._currZoom))})},_containsSameIndex:function(n,t){var u,f,e,o,s,r,i;if(t){for(s=t.children,i=0;i<s.length;i++)if(r=this.nameTable[this._getChild(s[i])],r&&r.zOrder&&r.zOrder===n)return!0}else{for(u=this.nodes(),i=0;i<u.length>0;i++)if(f=u[i],f&&f.zOrder===n)return!0;for(e=this.connectors(),i=0;i<e.length>0;i++)if(o=e[i],o&&o.zOrder===n)return!0}return!1},_setZorder:function(n){var r,t,i;if(n&&n.zOrder){if(n.zOrder==-1)if(this._containsSameIndex(this._zOrder)){do this._zOrder++;while(this._containsSameIndex(this._zOrder));n.zOrder=this._zOrder}else n.zOrder=this._zOrder,this._zOrder++;if(n._type==="group")for(r=n.children,i=0;i<r.length;i++)t=this.nameTable[this._getChild(r[i])],t&&t.zOrder&&t.zOrder===-1&&this._setZorder(t)}},_union:function(n,t){var i=Math.min(n.x,t.x),r=Math.min(n.y,t.y),u=Math.max(n.x+n.width,t.x+t.width),f=Math.max(n.y+n.height,t.y+t.height);return new ej.datavisualization.Diagram.Rectangle(i,r,u-i,f-r)},_getSeperetor:function(n){return this.nameTable[n]},_updateNextPhase:function(n,t,i){ej.datavisualization.Diagram.SwimLaneContainerHelper._updateNextPhase(this,n,t,i)},_getOuterNodes:function(n,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getOuterNodes(this,n,t,i)},_getInnerNodes:function(n,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getInnerNodes(this,n,t,i)},_moveOuterNodes:function(n,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._moveOuterNodes(this,n,t,i)},_moveOnPhaseChange:function(n,t,i){ej.datavisualization.Diagram.SwimLaneContainerHelper._moveOnPhaseChange(this,n,t,i)},_getPhaseDifferece:function(n,t,i){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseDifferece(this,n,t,i)},_updatePhaseOffset:function(n){var t=this.nameTable[n.name],o,i,e=this.nameTable[t.parent],f=this._getChildren(e.children),u=f.indexOf(t.name),r;f&&f.length>0&&u>-1&&n.offset!=undefined&&(o=this.nameTable[f[u]],i=n.offset-t.offset,r=this.nameTable[e.parent],i=this._getPhaseDifferece(r,u,i),this._moveOuterNodes(r,i,u),u===0?t.orientation==="horizontal"?(t.width+=i,t.offset=t.width,this._comparePropertyValues(r,"offsetX",{offsetX:r.offsetX+i/2},this.activeTool.inAction)):(t.height+=i,t.offset=t.height,this._comparePropertyValues(r,"offsetY",{offsetY:r.offsetY+i/2},this.activeTool.inAction)):t.orientation==="horizontal"?(t.width+=i,t.offset+=i,this._comparePropertyValues(r,"offsetX",{offsetX:r.offsetX+i/2},this.activeTool.inAction)):(t.height+=i,t.offset+=i,this._comparePropertyValues(r,"offsetY",{offsetY:r.offsetY+i/2},this.activeTool.inAction)),this._disablePhaseUpdate=!0,this._disableSwimlaneUptate=!0,ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._moveOnPhaseChange(t,i,u),this._updateNextPhase(r,i,u),delete this._disablePhaseUpdate,delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.DiagramContext.update(r,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,r))},_updatePhase:function(n){var t=this.nameTable[n.name];t&&(t.offset!=undefined&&n.offset!=undefined&&n.offset!=t.offset&&(this._comparePropertyValues(t,"offset",{offset:n.offset},this.activeTool.inAction),this._updatePhaseOffset(n),this._hasSelection()&&this._clearSelection(!0)),this._updateSwimlanePhase(t,n))},_setNodeZOrder:function(){for(var o=null,n=this.nodes(),i,f,t,r,u,s,h,n=n.concat(this.connectors()),e=0;e<n.length;e++)n[e].parent===""&&this._setZorder(n[e]);for(i=0;i<n.length;i++){for(f=i+1;f<n.length;f++)n[i].zOrder>n[f].zOrder&&n[i].parent===""&&n[f].parent===""&&(o=n[i],n[i]=n[f],n[f]=o);if(n[i]._type==="group"&&(t=n[i].children,!n[i].isSwimlane))for(r=0;r<t.length;r++)for(u=r+1;u<t.length;u++)s=typeof t[r]=="object"?t[r]:this.nameTable[t[r]],h=typeof t[u]=="object"?t[u]:this.nameTable[t[u]],!(s.zOrder>h.zOrder)||s.isPhase||h.isPhase||s.isLane||h.isLane||(o=t[r],t[r]=t[u],t[u]=o)}return n},_renderDiagramObjects:function(n,t,i,r){for(var e,u=0,f=n.length;u<f;++u)this.getObjectType(n[u])==="node"||this.getObjectType(n[u])==="group"?(e=this.nameTable[n[u].name],this._disableSegmentChange=!0,ej.datavisualization.Diagram.DiagramContext._renderNodeObject(e,t,i,r,this),delete this._disableSegmentChange):ej.datavisualization.Diagram.DiagramContext._renderConnectorObject(n[u],t,this)},_unWireEvents:function(){var n=$(this._canvas);this._off(n,ej.eventType.mouseDown,this._mousedown);this._off(n,ej.eventType.mouseMove,this._mousemove);this._off(n,ej.eventType.mouseUp,this._mouseup);this._off(n,ej.eventType.mouseLeave,this._documentmouseup);this._off(n,"doubletap",this._doubleclick);this._off(this.element,"keydown",this._keydown);this._off(this.element,"keyup",this._keyup);this._off(n,"pinchin",this._pinchin);this._off(n,"pinchout",this._pinchout);this._off(this.element,"touchstart",this._handleTouchStart);ej.browserInfo().name==="mozilla"?this._off(this.element,"DOMMouseScroll",this._handleMouseWheel):this._off(this.element,"mousewheel",this._handleMouseWheel);this._off($(document),"mouseup",this._documentmouseup);window&&this.model.constraints&ej.datavisualization.Diagram.DiagramConstraints.Resizable&&this._off($(window),"resize",this.updateViewPort)},_wireEvents:function(){var t=$(this._canvas),n;this._on(t,ej.eventType.mouseDown,this._mousedown);this._on(t,ej.eventType.mouseMove,this._mousemove);this._on(t,ej.eventType.mouseUp,this._mouseup);this._on(t,ej.eventType.mouseLeave,this._documentmouseup);this._on(t,"doubletap",this._doubleclick);this._on(this.element,"keydown",this._keydown);this._on(this.element,"keyup",this._keyup);this._on(this.element,"contextmenu",this._preventDefaultContextMenu);this._on(t,"pinchin",this._pinchin);this._on(t,"pinchout",this._pinchout);this._on(this.element,"touchstart",this._handleTouchStart);ej.browserInfo().name==="mozilla"?this._on(this.element,"DOMMouseScroll",this._handleMouseWheel):this._on(this.element,"mousewheel",this._handleMouseWheel);this._on($(document),"mouseup",this._documentmouseup);window&&this.model.constraints&ej.datavisualization.Diagram.DiagramConstraints.Resizable&&this._on($(window),"resize",this.updateViewPort);n=this;$(t).ejDroppable({drop:function(t,i){n._svgdrop(t,i);n._isDropped=!0},over:function(t){n.activeTool.inAction===!1&&n._selectedSymbol&&(n._viewPort||(n._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(n,!0)),n._addSymbolToDiagram(t),n._isSvgDropover=!0)}})},_preventDefaultContextMenu:function(n){if(this._disableDefaultContextMenu)return n.preventDefault(),n.stopPropagation(),delete this._disableDefaultContextMenu,!1},_mousePosition:function(n,t){var u=this._isTouchEvent(n),e=this._scrollLeft!==undefined?this._scrollLeft:this._canvas.scrollLeft,o=this._scrollTop!==undefined?this._scrollTop:this._canvas.scrollTop,f=this._controlBBox?this._controlBBox:this._canvas.getBoundingClientRect(),i=u.clientX+e-f.left,r=o+u.clientY-f.top;return t||(i=(i+this._hScrollOffset)/this._currZoom,r=(r+this._vScrollOffset)/this._currZoom),new ej.datavisualization.Diagram.Point(Math.round(i*100)/100,Math.round(r*100)/100)},_contextmenu:function(n){n.preventDefault();n.stopPropagation()},_pinchin:function(n){this._getTouchEvent(n);n.preventDefault()},_pinchout:function(n){this._getTouchEvent(n);n.preventDefault()},_handleTouchStart:function(n){this._getTouchEvent(n);n.preventDefault()},_getTouchEvent:function(n){this._isTouchedEvent=n.type=="touchmove"||n.type=="touchstart"||n.type=="touchend"?!0:!1},_mousedown:function(n){var r,t,u,i;this._getTouchEvent(n);this._isPinching=!1;this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0);this._diagramElements=null;ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer);this._invoke(n)&&(this._scrollLeft=this._canvas.scrollLeft,this._scrollTop=this._canvas.scrollTop,this._controlBBox=this._canvas.getBoundingClientRect(),r=this._mousePosition(n),this._isForeignObject(n.originalEvent.target)||n.preventDefault(),this.model.contextMenu&&$("#"+this.element[0].id+"_contextMenu").css("display")!=="none"&&(n.cancel=!0),this._isEditing&&(this._endEdit(),this.activeTool.name==="textTool"&&this.activeTool.singleAction&&this.activeTool.diagram.deactivateTool()),(n.which===1||n.which===3||n.which===0&&n.originalEvent.changedTouches)&&(this._removeMouseOverTooltip(),n.which===0&&n.originalEvent.changedTouches&&(t=null,u=this._isUserHandle(n),this._isInternalTool(this.activeTool)&&!this.activeTool.inAction&&(u||(t=this._findNodeUnderMouse(n),this._raiseMouseEvents(t,r)),!t&&this.selectionList[0]&&(t=this.selectionList[0]),ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._checkToolToActivate(n,t))),(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&n.shiftKey&&(t=this._findNodeUnderMouse(n),!t&&this.selectionList[0]&&(t=this.selectionList[0]),this._checkToolToActivate(n,t)),this._toolToActivate==="panTool"?this.activeTool=this.tools[this._toolToActivate]:(this._toolToActivate==="move"&&(t=this._findNodeUnderMouse(n),t&&t.isLane&&ej.datavisualization.Diagram.Util.canMultiSelectOnLane(t)&&(this._toolToActivate="select",this._currentCursor="default",this._updateCursor())),i=this.tools[this._toolToActivate]||this.activeTool,this.activateTool(this._toolToActivate,i?i.singleAction:null)),this.activeTool.mousedown(n),this._focusedElement=this.activeTool._findNodeUnderMouse(n,!0)))},_mousemove:function(n){var f,i,t,r,u;if(this._getTouchEvent(n),this._mouseEventTriggered=!0,this._viewPort||(this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0)),n.type=="touchmove"&&n.originalEvent.touches.length>1)this._isPinching=!0;else if(this._isPinching=!1,i=null,f=this._isUserHandle(n),this.activeTool.inAction===!1&&this._selectedSymbol)this._addSymbolToDiagram(n);else{if(this._isInternalTool(this.activeTool)&&!this.activeTool.inAction?(f||(i=ej.datavisualization.Diagram.Util.isClassifier(n)?ej.datavisualization.Diagram.ClassifierHelper.getSelectableElementUnderMouse(n,this):this._findNodeUnderMouse(n),i&&(this._nodeUnderMouse&&this._nodeUnderMouse!=i&&!this._nodeUnderMouse.segments&&this.activeTool._showPort(this._nodeUnderMouse,!0),i.segments||this.activeTool._showPort(i))),!i&&this.selectionList[0]&&(i=this.selectionList[0]),ej.datavisualization.Diagram.Util.isPageEditable(this)&&this._checkToolToActivate(n,i),n.which==1&&n.buttons==1&&(this._focusedElement=this.activeTool._findNodeUnderMouse(n,!0))):(this.activeTool.inAction||(this._toolToActivate=this.activeTool.name,this._currentCursor=this.activeTool.cursor),t=ej.datavisualization.Diagram.Util.isClassifier(n)?ej.datavisualization.Diagram.ClassifierHelper.getDropableElementUnderMouse(n,this):this._findNodeUnderMouse(n),i),this._updateCursor(),t=t||this._findNodeUnderMouse(n),this.activeTool.mousemove(n),this._raiseMouseEvents(t,n),r=!1,this.activeTool.inAction){do if(t&&!ej.datavisualization.Diagram.Util.canAllowDrop(t))if(t.parent)t=this.nameTable[t.parent];else if(t.segments){r=!0;break}else if(t.container)break;else t=null;else break;while(t);this._nodeUnderMouse&&this._nodeUnderMouse.segments&&this._nodeUnderMouse!=t&&ej.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this._adornerLayer,this._adornerSvg);t&&t!=this._focusedElement&&t!=this.nodeUnderMouse&&(r||ej.datavisualization.Diagram.Util.canAllowDrop(t))?(u=this.getObjectType(t),this._focusedElement&&(this._focusedElement.isLane||this._focusedElement.isSwimlane||this._focusedElement.isPhase)&&u=="node"&&u=="connector"?this._nodeUnderMouse=null:this._nodeUnderMouse&&(this._nodeUnderMouse.isLane||this._nodeUnderMouse.isSwimlane||this._nodeUnderMouse.isPhase)&&t.segments||(this._nodeUnderMouse=t)):t&&t.container||(this._nodeUnderMouse=null)}else this._focusedElement||(this._nodeUnderMouse=t);this._initiateAutoScroll(n)}},_mouseup:function(n){var e,r,f,o,c,t,s,i,u,h;this._getTouchEvent(n);!this._isPinching&&n.originalEvent&&n.originalEvent.target&&this._invoke(n)&&(e=this._isForeignObject(n.originalEvent.target),e||n.preventDefault(),this.activeTool instanceof ej.datavisualization.Diagram.PanTool?(document.onmousemove=null,document.onmouseup=null,(!ej.datavisualization.Diagram.Util.isPageEditable(this)||this.activeTool instanceof ej.datavisualization.Diagram.PanTool)&&!this.activeTool.inAction&&(t=this.activeTool._findNodeUnderMouse(n),t&&this._raiseEvent("itemClick",{actualObject:t,selectedObject:t,model:this.model,cancel:!1,event:n}),r=this._mousePosition(n.originalEvent),this._raiseEvent("click",{element:t,actualObject:this.getNode(this.activeTool.actualObject),count:this._getEventDetail(n),offsetX:r.x,offsetY:r.y,event:n}),this.activeTool instanceof ej.datavisualization.Diagram.PanTool&&(document.onmousemove=null,document.onmouseup=null))):n.target.id!==this._id+"_canvas_svg"||!this.activeTool.name!="panTool"&&this.activeTool.inAction||(r=this._mousePosition(n.originalEvent),this._raiseEvent("click",{element:this,actualObject:this.getNode(this.activeTool.actualObject),count:this._getEventDetail(n),offsetX:r.x,offsetY:r.y,event:n})),n.target&&!this._isAnimating&&(f=$(n.target).parents(".ej-d-icon-template"),f&&f.length&&(o=f[0],o.id.endsWith("_expander")&&(c=o.id.replace("_expander",""),t=this.nameTable[c],t&&(s=this.getObjectType(t),(s=="node"||s=="group")&&(this.clearSelection(),ej.datavisualization.Diagram.LayoutUtil.expandSubTree(this,t,t.name,!0,ej.datavisualization.Diagram.Util.canSelect(t))))))),!this._selectedSymbol||this._selectedSymbol.isLane||this._isNodeEnters?this._selectedSymbol&&this._isNodeEnters&&(i=this.findNode(this.selectionList[0].name),this.edgeTable?delete this.edgeTable:(u={},u=this._getChildTable(this.selectionList[0],u),this._selectedSymbol.type=="pseudoGroup"?h={type:"collectionchanged",object:this._updatePsedoGroupChildren(this._selectedSymbol),childTable:jQuery.extend(!0,{},u),changeType:"insert",category:"internal"}:this._selectedSymbol.isPhase||(h={type:"collectionchanged",object:jQuery.extend(!0,{},this._selectedSymbol),childTable:jQuery.extend(!0,{},u),changeType:"insert",category:"internal"}),this.addHistoryEntry(h),this._isDragg=!0),this._clearSelection(!0),this._selectedSymbol=null,delete this._isNodeEnters,i.type=="pseudoGroup"&&(this.nodes().push(i),this._nodes=$.extend(!0,[],this.nodes()),this.nameTable[i.name]=i,ej.datavisualization.Diagram.Util._updateGroupBounds(i,this)),this._addSelection(i)):(this._findLabelEditing=!0,this._dropSymbol(null,n),delete this._findLabelEditing,this._isDragg=!0),ej.browserInfo().name==="msie"&&this._doubleClickEvent&&(this.activeTool._isMouseDown=!0),this.activeTool.mouseup(n),this.activeTool instanceof ej.datavisualization.Diagram.TextTool||!document.activeElement||document.activeElement.id===this.element[0].id||this._isEditing||e||this.element[0].focus(),this._currentCursor=this.activeTool.cursor,this.activeTool.name==="move"&&this._focusedElement&&!ej.datavisualization.Diagram.Util.canSelect(this._focusedElement)?(this._currentCursor="default",this._updateCursor()):this._updateCursor());this._isSvgDropover&&($("#"+this.element[0].id+"_canvas").ejDroppable("instance")._mouseOver=!1);delete this._isSvgDropover;this._focusedElement=null;this._nodeUnderMouse=this._findNodeUnderMouse(n);delete this._scrollLeft;delete this._scrollTop;delete this._controlBBox;this._mouseEventTriggered=!1;this._isDragg=!1;delete this._viewPort;this._timeStamp=n.timeStamp},_doubleclick:function(n){var f,o,e,t,i,r,u;if(this._getTouchEvent(n),this._doubleClickEvent=!this._doubleClickEvent,t=this._nodeUnderMouse||this,f={element:this.getNode(t),cancel:!1,actualObject:this.getNode(this.activeTool.actualObject)},this._isEditing||this._raiseEvent("doubleClick",f),o=this.activeTool._drawingPolygon,this.activeTool.name!="panTool"&&(this._nodeUnderMouse&&this.activeTool._doubleClick(this._nodeUnderMouse),ej.datavisualization.Diagram.Util.isClassifier(n)&&(e=ej.datavisualization.Diagram.ClassifierHelper.getEditableElementUnderMouse(n,this)),ej.datavisualization.Diagram.Util.isPageEditable(this)&&!this.activeTool.inAction&&(this.selectionList.length>0||e||this.activeTool.selectedObject)&&!f.cancel&&!o)){if(t=this.activeTool.selectedObject?this.activeTool.selectedObject:this.selectionList[0]?this.selectionList[0]:e,t.type=="umlclassifier")for(i=0;i<t.children.length;i++)t.children[i]=typeof t.children[i]=="string"?this.nameTable[t.children[i]]:t.children[i],i!=t.children.length-t.children.length&&i==t.children.length-1&&(t.children[i].labels[0].text="\n---\n"+t.children[i].labels[0].text),i!=t.children.length-t.children.length&&i==t.children.length-2&&(t.children[i].labels[0].text="\n---\n"+t.children[i].labels[0].text),t.labels[0].text+=t.children[i].labels[0].text;if(t.shape&&t.shape.type=="umlclassifier")for(r=0;r<t.labels.length;r++)r!=0&&(t.labels[0].text+="....."+t.labels[r].text);this._isEditing||t.type=="pseudoGroup"||f.cancel||(this.activeTool._findLabelUnderMouse(n,!1,this._mousePosition(n.originalEvent)),t.labels&&t.labels.length>0&&(u=this.activeTool.getLabelUnderMouse(),u||(u=t.labels[0])),!this._isEditing&&t.type==="text"&&this._setLabelEditing(t.textBlock)?(this.scrollToNode(t),this._startEdit(t)):this._isEditing||t.isLane||t.isSwimlane||!(t.labels&&(t.labels.length===0||typeof t.labels.length=="undefined")||t.labels&&t.labels.length>0&&this._setLabelEditing(u))?t.isLane&&t.labels&&t.labels.length>0&&this._setLabelEditing(u)?t.labels&&t.labels.length>0?(this.scrollToNode(t),this._startEdit(t)):this.activeTool.selectedObject=null:t.isLane&&(this.activeTool.selectedObject=null):(this.scrollToNode(t),this._startEdit(t)))}this.activeTool._isMouseDown=!1},_documentmouseup:function(n){var i,t;this._getTouchEvent(n);i=this._selectedSymbol;this._removeMouseOverTooltip();this._viewPort||(this._viewPort=ej.datavisualization.Diagram.ScrollUtil._viewPort(this,!0));!this.activeTool||!this.activeTool.inAction||this.activeTool instanceof ej.datavisualization.Diagram.TextTool||this.activeTool instanceof ej.datavisualization.Diagram.ShapeTool&&this.activeTool._drawingPolygon||this.activeTool.mouseup(n,!0);i&&(n.keyCode!=27&&n.keyCode!=46&&(t=document.getElementsByClassName("e-paletteItem dragClone")[0],t!=null&&(t.style.display="block"),this._selectedSymbol=i),this._raiseEvent("dragLeave",{element:this.selectionList[0]}),this._mouseEventTriggered&&this._delete(this.selectionList[0]));this._isNodeEnters&&(delete this._isNodeEnters,this._selectedSymbol=null,t=document.getElementsByClassName("dragClone")[0],t!=null&&(t.style.display="block"));delete this._viewPort;this._mouseEventTriggered=!1;this._isDragg=!1},_invoke:function(n){if(n.originalEvent.target){var t=n.originalEvent.target.className;if(t&&typeof t=="string"&&(t=="edit"||t=="editBox"||t.indexOf("e-hhandle")>-1||t.indexOf("e-hhandlespace")>-1||t.indexOf("e-vhandle")>-1||t.indexOf("e-vhandlespace")>-1))return!1}return!0},_handleMouseWheel:function(n){var r,t,o,i,f,u,e,s,h;n.originalEvent.preventDefault&&n.originalEvent.preventDefault();r=new ej.datavisualization.Diagram.Point(0,0);this._isEditing&&this._endEdit();(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)?(r=this._mousePosition(n.originalEvent),n.originalEvent.wheelDelta>0||-40*n.originalEvent.detail>0?ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1+Number(this.zoomFactor()),0,0,r,!0):ej.datavisualization.Diagram.ZoomUtil.zoomPan(this,1/(1+Number(this.zoomFactor())),0,0,r,!0)):(t=0,o={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:this._viewPort},n.originalEvent.wheelDelta>0||-40*n.originalEvent.detail>0?(f=this._vScrollbar.model.minimum,u=this._scrollLimit()==="limited"&&this._vScrollOffset-this._scrollPixel>=this.model.pageSettings.scrollableArea.y*this._currZoom,this._vScrollOffset-this._scrollPixel>=f||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity||u?(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset-this._scrollPixel),i=!0,t=-this._scrollPixel):(this._updateScrollOffset(this._hScrollOffset,f),i=!0,t=0)):(e=this._vScrollbar.model.maximum,s=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),u=this._scrollLimit()==="limited"&&(this.model.pageSettings.scrollableArea.y+this.model.pageSettings.scrollableArea.height)*this._currZoom>=this._vScrollOffset+this._scrollPixel+s.height,e>=this._vScrollOffset+this._scrollPixel||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity||u?(this._updateScrollOffset(this._hScrollOffset,this._vScrollOffset+this._scrollPixel),i=!0,t=this._scrollPixel):(this._updateScrollOffset(this._hScrollOffset,e),i=!0,t=0)),i&&(h={zoom:this._getCurrentZoom(),horizontalOffset:this._hScrollOffset,verticalOffset:this._vScrollOffset,viewPort:this._viewPort},this._eventCause.scrollChange=ej.datavisualization.Diagram.ScrollChangeCause.Pan,this._raiseEvent("scrollChange",{newValues:h,oldValues:o})),this._updateEditBox(0,t))},_setActiveTool:function(n){var u=this._mousePosition(n),t,i,r;this.activeTool.inAction||!this._isUserHandleActive(this.activeTool.name)&&this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length||(this._isInternalTool(this.activeTool)||this.activeTool.singleAction)&&(i=!1,this.selectionList[0]&&(t=this.selectionList[0],i=this._checkToolToActivate(n,t)),i||(t=this._findNodeUnderMouse(n),this._isUserHandle(n)?(r=$(n.target).parents("g").first().context.id.split("_")[0],this._checkToolToActivate(n,t),this.activeTool=this.tools[this._toolToActivate]):(this._checkToolToActivate(n,t),this._raiseMouseEvents(t),this._isUserHandleActive(this.activateTool.name)&&!this._drawingTool&&(this.activeTool=this.tools[this._toolToActivate]))))},_beginAutoScroll:function(n,t){var f=100,e=this,r=0,u=0,i=ej.datavisualization.Diagram.ScrollUtil._viewPort(this),o=this._hScrollbar.model.maximum+i.width,s=this._vScrollbar.model.maximum+i.height;if(this._canAutoScroll){switch(n){case"right":(this._hScrollOffset+i.width+10<o||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(r=10);break;case"left":(this._hScrollOffset-10>this._hScrollbar.model.minimum||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(r=-10);break;case"bottom":(this._vScrollOffset+i.height+10<s||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(u=10);break;case"top":(this._vScrollOffset-10>this._vScrollbar.model.minimum||this._scrollLimit()===ej.datavisualization.Diagram.ScrollLimit.Infinity)&&(u=-10)}setTimeout(function(){e._raiseEvent("autoScrollChange",{delay:f});e._updateScrollBar(r,u,n,t)},f)}},_updateScrollBar:function(n,t,i,r){if(n===0&&t===0)this._canAutoScroll=!1;else if(this.activeTool.inAction){var u=this._hScrollOffset+n*this._currZoom,f=this._vScrollOffset+t*this._currZoom,e=this._updateSelectionOnScroll(n,t);e?(this._updateScrollOffset(u,f),this._beginAutoScroll(i,r)):this._canAutoScroll=!1}},_updateSelectionOnScroll:function(n,t){var i=this.activeTool,r,f,e,u;if(i.name==="select")i.currentPoint=new ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t),i._updateHelper();else if(i.name==="orthogonalLine"||i.name==="straightLine")i.currentPoint=new ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t),i._targetPossibleConnection=i._currentPossibleConnection,i._targetPort=i._possibleConnectionPort,i._updateHelper();else if(this.selectionList.length>0){if(r=this.selectionList[0],r.isLane||(i.currentPoint=ej.datavisualization.Diagram.Point(i.currentPoint.x+n,i.currentPoint.y+t)),i.name==="move")if(!r.isLane&&i._outOfBoundsDrag(r,n,t))i._canMoveLabel?this._translateLabel(r,i.activeLabel,n,t):this._translate(r,n,t,this.nameTable);else return!1;else i.name==="resize"?(ej.datavisualization.Diagram.SnapUtil._removeGuidelines(this),i._updateSize(r,i.previousPoint,i.currentPoint)):i.name==="endPoint"&&(i.selectedSegment&&i._endPoint=="segmentEnd"?(f=i.currentPoint.x-i.previousPoint.x,e=i.currentPoint.y-i.previousPoint.y,i._updateAdjacentSegments(f,e)):(u=i._updatePoints(r),u.cancel||(i._disconnect(r),i._updateConnection(r,u.updateSelection))));i.previousPoint=ej.datavisualization.Diagram.Point(i.currentPoint.x,i.currentPoint.y);i._canMoveLabel||r.type=="phase"||(ej.datavisualization.Diagram.DiagramContext.update(r,this),this._updateSelectionHandle(!0),this._renderTooltip(r))}return!0},_isUserHandle:function(n){return n.target.parentNode.className.animVal==="userHandle"?!0:!1},_isUserHandleActive:function(n){var i=!1,t,r;if(this.model.selectedItems.userHandles&&this.model.selectedItems.userHandles.length>0)for(t=0,r=this.model.selectedItems.userHandles.length,t;t<r;t++)if(this.model.selectedItems.userHandles[t].name===n){i=!0;break}else i=!0;return i},_getEventDetail:function(n){return ej.browserInfo().name==="msie"?this._timeStamp?n.timeStamp-this._timeStamp>=300?1:2:1:n.originalEvent.detail},_raiseMouseEvents:function(n,t){var i,r;this._isEditing||(this._nodeUnderMouse&&(!n||this._nodeUnderMouse!=n)&&(i=document.getElementById(this.element[0].id+"_mouseovertooltipDiv"),i&&i.parentNode.removeChild(i),this._raiseEvent("mouseLeave",{element:this.getNode(this._nodeUnderMouse)}),this._nodeUnderMouse==null||this._nodeUnderMouse.segments||this.activeTool instanceof ej.datavisualization.Diagram.LineTool||this.activeTool._showPort(this._nodeUnderMouse,!0)),n&&this._nodeUnderMouse!==n&&this._raiseEvent("mouseEnter",{element:this.getNode(n)}),n&&(r={element:this.getNode(n)},this._raiseEvent("mouseOver",r),r.element&&!this.activeTool.inAction?this._renderMouseOverTooltip(n,t):this._removeMouseOverTooltip()))},_renderMouseOverTooltip:function(n,t){var v,i,w,h,c,l,y,p,a,g,f,b,k;if(ej.datavisualization.Diagram.Util.canShowTooltip(n,this)&&(v=this.getObjectType(n),w=v=="node"||v=="group"?ej.datavisualization.Diagram.NodeConstraints:ej.datavisualization.Diagram.ConnectorConstraints,n.constraints&w.InheritTooltip?(i=this.model.tooltip,h=!0):i=n.tooltip,i&&(!h||this._tooltipTemplateId()))){a=this._getTooltipPosition(n,i,t,h);c=a.x;l=a.y;y=a.tx;p=a.ty;c=-this._hScrollOffset+c*this._currZoom;l=-this._vScrollOffset+l*this._currZoom;g="left:"+c+"px; top:"+l+"px; display: block; position: absolute; pointer-events: none; transform:translate("+y+","+p+")";f=document.getElementById(this.element[0].id+"_mouseovertooltipDiv");f||(f=this._createMouseOverTooltip());f.style.left=c+"px";f.style.top=l+"px";f.style.transform="translate("+y+" ,"+p+")";f.style.display="block";f.style.position="absolute";$.templates&&(b=h?this._tooltipTemplateId():i.templateId,k=$.templates("#"+b).render(n));$(f).html(k);f.style.marginLeft=f.style.marginTop="0px";var u=this.element[0].getBoundingClientRect(),r=f.getBoundingClientRect(),d=ej.datavisualization.Diagram.Util.bounds(n,this.activeTool.name=="rotatetool"?!0:!1);if(u.left>r.left||u.right<r.right){if((h?this._tooltipMode():i.relativeMode)=="mouse")var s=u.left>r.left?"left":"right",o=s=="right"?r.right-u.right:u.left-r.left,e=s=="right"?-o-i.margin.right:i.margin.left+o;else(i.alignment.horizontal=="left"||i.alignment.horizontal=="right")&&i.alignment.vertical=="center"?(e=d.width+r.width+i.margin.left+i.margin.right,e=i.alignment.horizontal=="left"?e*1:e*-1):(s=i.alignment.horizontal,s=="center"&&(s=u.left>r.left?"left":"right"),o=s=="right"?r.right-u.right:u.left-r.left,e=s=="right"?-o-i.margin.right:i.margin.left+o);f.style.marginLeft=e+"px"}(u.bottom<r.bottom||u.top>r.top)&&((h?this._tooltipMode():i.relativeMode)=="mouse"?(s=u.top>r.top?"top":"bottom",o=s=="top"?r.top-u.top:r.bottom-u.bottom,e=s=="top"?i.margin.top+o:-o-i.margin.bottom):i.alignment.horizontal=="center"&&(i.alignment.vertical=="bottom"||i.alignment.vertical=="top")?(e=d.height+r.height+i.margin.bottom+i.margin.top,e=i.alignment.vertical=="bottom"?e*-1:e*1):(o=i.alignment.vertical=="top"?u.top-r.top:u.bottom-r.bottom,e=i.alignment.vertical=="top"?i.margin.top+o:o-i.margin.bottom),f.style.marginTop=e+"px")}},_getTooltipPosition:function(n,t,i,r){var e=ej.datavisualization.Diagram.Util.bounds(n,!1),u,f,o,s,h;if((r?this._tooltipMode():t.relativeMode)=="object"){switch(r?this._horizontalTooltipAlignment():t.alignment.horizontal){case"left":u=e.x;u-=t.margin.left;o="-100%";break;case"right":u=e.right;u+=t.margin.right;o="0%";break;case"center":u=e.center.x;o="-50%"}switch(r?this._verticalTooltipAlignment():t.alignment.vertical){case"top":f=e.y;f-=t.margin.top;s="-100%";break;case"bottom":f=e.bottom;f+=t.margin.bottom;s="0%";break;case"center":f=e.center.y;s="-50%"}}else i&&(h=this._mousePosition(i),u=h.x+t.margin.left,f=h.y+t.margin.top);return{x:u,y:f,tx:o,ty:s}},_isHandle:function(n){var t=$(n.target).parent("g.handle");return t.length>0?!0:!1},_findNodeUnderMouse:function(n){var t=null,i;if(n.target){var r=$(n.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),f=n.target.className,u=n.target.id.split("_");if(u[u.length-1]=="lblbg")return;r&&(i=r.attr("class"),i&&(i==="ej-d-node"||i==="ej-d-group"||ej.datavisualization.Diagram.Util.isClassifier(n))?(t=this._findNode(r.attr("id")),t||(t=this._findNode(r.attr("id").split("_parentdiv")[0])),t&&t.parent&&this.nameTable[t.parent]&&this.nameTable[t.parent].type=="bpmn"&&(t=this.nameTable[t.parent])):i==="ej-d-connector"&&(t=this._findConnector(r.attr("id"))))}return t},_findConnectableNodeUnderMouse:function(n){var i=null,t,f,e,r,c;if(n&&n.type==="touchmove"){var o=this._mousePosition(n),s=ej.datavisualization.Diagram.Rectangle(o.x,o.y,0,0),h=ej.datavisualization.Diagram.SpatialUtil.findQuads(this._spatialSearch,s);for(t=0;t<h.length;t++)if(f=h[t],f.objects.length>0)for(e=0;e<f.objects.length;e++)if(r=f.objects[e],c=ej.datavisualization.Diagram.Util.bounds(r),ej.datavisualization.Diagram.Geometry.intersectsRect(s,c)&&!r.segments&&r.visible)return r}else for(var a,l=$(n.target).parents(".ej-d-node,.ej-d-group"),u=l[0],t=1;u;)a=u.getAttribute("class"),i=this._findNode(u.getAttribute("id")),i&&(ej.datavisualization.Diagram.Util.canConnect(i)||!i.parent)?u=null:(u=l[t],t++);return i},_isForeignObject:function(n){var t=n;if(t)while(t.parentNode!=null){if(t.tagName==="foreignObject"||typeof t.className=="string"&&t.className.split(" ").indexOf("foreignObject")!==-1)return t;t=t.parentNode}return null},_altKeyPressed:function(n){return n&ej.datavisualization.Diagram.KeyModifiers.Alt},_ctrlKeyPressed:function(n){return n&ej.datavisualization.Diagram.KeyModifiers.Control},_shiftKeyPressed:function(n){return n&ej.datavisualization.Diagram.KeyModifiers.Shift},_keydown:function(n){var u,t,i,r;this._isKeyDown=!0;this._removeMouseOverTooltip();var e=n.keyCode?n.keyCode:n.which,f=navigator.platform.match("Mac")?n.metaKey:n.ctrlKey,o=n.key;for(u in this.model.commandManager.commands)t=this.model.commandManager.commands[u],t&&t.gesture&&(t.gesture.keyModifiers||t.gesture.key)&&(t.gesture.key&&e!=t.gesture.key&&o!=t.gesture.key||t.gesture.keyModifiers&&(!(f||n.altKey||n.shiftKey)||this._altKeyPressed(t.gesture.keyModifiers)&&!n.altKey||this._shiftKeyPressed(t.gesture.keyModifiers)&&!n.shiftKey||this._ctrlKeyPressed(t.gesture.keyModifiers)&&!f)||(this._currentCommand=u,this._currentCommand!=="focusToNextItem"&&this._currentCommand!=="focusToPreviousItem"&&this._currentCommand!=="selectFocusedItem"&&(this._diagramElements=null,this._focusedElement=null,ej.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this._adornerSvg,this._adornerLayer)),t.execute&&t.canExecute&&(i=t.canExecute,typeof t.canExecute=="string"&&(i=ej.util.getObject(t.canExecute,window)),$.isFunction(i)&&i({model:this.model})&&(r=t.execute,typeof t.execute=="string"&&(r=ej.util.getObject(t.execute,window)),$.isFunction(r)&&r({keyDownEventArgs:n,parameter:t.parameter,model:this.model})))));this.activeTool.keydown(n);this._isKeyDown=!1},_keyup:function(n){var t=n.keyCode?n.keyCode:n.which;this._isEditing||t!==37&&t!==38&&t!==39&&t!==40||(this._currentState,delete this._currentState,n.preventDefault(),this.activeTool.inAction=!1,this._updateSelectionHandle())},_registerHistoryEvents:function(){this.historyManager.addEventHandler("collectionchanged",$.proxy(this._recordCollectionChanged,this));this.historyManager.addEventHandler("positionchanged",$.proxy(this._recordPinPointChanged,this));this.historyManager.addEventHandler("sizechanged",$.proxy(this._recordResizeChanged,this));this.historyManager.addEventHandler("rotationchanged",$.proxy(this._recordRotationChanged,this));this.historyManager.addEventHandler("endpointchanged",$.proxy(this._recordEndPointChanged,this));this.historyManager.addEventHandler("labelchanged",$.proxy(this._recordLabelChanged,this));this.historyManager.addEventHandler("groupingchanged",$.proxy(this._recordGroupChanged,this))},_svgdrop:function(n,t){var u,e,w,s,f,r,h,c;if(this._selectedSymbol&&ej.datavisualization.Diagram.Util.isPageEditable(this)){u={};e=n.originalEvent;e.preventDefault?e.preventDefault():e.returnValue=!1;var l=this._currZoom,a=$("#"+this.element[0].id).offset(),o=this._isTouchEvent(n),v=(o?o.pageX:n.pageX)+this._hScrollOffset-a.left,y=(o?o.pageY:n.pageY)+this._vScrollOffset-a.top,i=$.extend(!0,{},this._selectedSymbol),p=t.helper[0].getAttribute("paletteId"),b=$("#"+p).ejSymbolPalette("instance");if(p){if(this._selectedSymbol=null,i.name+=ej.datavisualization.Diagram.Util.randomId(),!i.isPhase&&i.segments)i.segments&&ej.datavisualization.Diagram.Util._translateLine(i,v,y),i=this.getNode(i);else if(!i.isPhase){if(w=$.extend(!0,{},b.nameTable),i.offsetX=v/l,i.offsetY=y/l,i._type==="group"){for(s=this._getChildren(i.children),f=0;f<s.length;f++)r=$.extend(!0,{},w[s[f]]),r.parent=i.name,r.name=i.name+r.name,s[f]=r.name,this.nameTable[r.name]=r,this.nodes().push(r),this._nodes=$.extend(!0,[],this.nodes()),this._updateQuad(this.nameTable[r.name]);i.height=i.width=0;this._updateChildBounds(i,this.nameTable)}i._type==="group"?i=this._getNewGroup(i):i.segments?i=this._getNewConnector(i):i.isPhase||i.type==="phase"||(i=this._getNewNode(i))}i&&i.isLane&&(this._cloneGroupNode(i,ej.datavisualization.Diagram.Util.randomId()),i=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(i,this.nameTable));u={element:i,cancel:!1};this._raiseDropEvent(u);i&&i.isLane&&(h=ej.datavisualization.Diagram.SwimLaneHelper._createSwimlane(i,this),h&&h.isSwimlane&&(i=h));i.isPhase||(u.cancel||this.add(i),i=this.selectionList[0],this.scrollToNode(i),i.labels.length>0&&i.labels[0].mode==="edit"?(this._isEditing=!0,this.startLabelEdit(i,i.labels[0])):this.element[0].focus())}}else c=null,c=this._findNodeUnderMouse(n),u={element:t.helper,e:n,draggable:t.draggable,targetNode:c},c&&this._raiseDropEvent(u)},_isTouchEvent:function(n){return n.type=="touchmove"||n.type=="touchstart"||n.type=="touchend"?n.originalEvent?n.originalEvent.changedTouches[0]:n.changedTouches[0]:n},_raiseDropEvent:function(n){n.source=this._symbolPalette?this._symbolPalette:null;n.objectType=n.source?ej.datavisualization.Diagram.ObjectTypes.Palette:ej.datavisualization.Diagram.ObjectTypes.Diagram;this._raiseEvent("drop",n);this._symbolPalette=null},_recordCollectionChanged:function(n,t){var s,o,y,r,e,l,h,u,f,i,c,a,v,p;if(this._isUndo=!0,this._isInsert=!0,s=n.changeType,n.isUndo&&(s=n.changeType=="insert"?"remove":"insert"),this._clearSelection(s=="insert"?!1:!0),s=="insert")if(n.object.container){for(i in n.childTable)f=n.childTable[i],this.nameTable[i]=f;r=n.object;r.isSwimlane?(this.nameTable[r.name]=r,r.width=0,r.height=0,this._swimlanePaste=!0,this._multipleAction=!0,this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this._pasteSwimlaneObj(r),delete this._swimlanePaste,this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange,this._addAssiciatedChildConnectors(r),delete this._multipleAction,this._clearSelection(!0)):r.isLane?(n.object&&n.object.parent&&(c=this.nameTable[n.object.parent]),c&&c&&(a=this.nameTable[c.parent]),a&&(this.activeTool.selectedObject=n.object,ej.datavisualization.Diagram.canvasHelper._addNewLane(this,r,a,!0,n.index),this._addAssiciatedChildConnectors(r),this._clearSelection(!0))):(this.add(r),this._addConnector(r,n))}else if(n.object.type!="pseudoGroup"){if(!n.object.segments){if(o=null,n.object.inEdges&&n.object.inEdges.length>0)for(i=0;i<n.object.inEdges.length;i++)this.nameTable[n.object.inEdges[i]]&&(this.nameTable[n.object.inEdges[i]].targetNode=n.object.name),n.targetPorts&&(o=n.targetPorts[n.object.inEdges[i]]),o&&this.nameTable[n.object.inEdges[i]]&&(this.nameTable[n.object.inEdges[i]].targetPort=o);if(n.object.outEdges&&n.object.outEdges.length>0)for(i=0;i<n.object.outEdges.length;i++)this.nameTable[n.object.outEdges[i]]&&(this.nameTable[n.object.outEdges[i]].sourceNode=n.object.name),n.sourcePorts&&(o=n.sourcePorts[n.object.outEdges[i]]),o&&this.nameTable[n.object.outEdges[i]]&&(this.nameTable[n.object.outEdges[i]].sourcePort=o)}n.object._type==="group"&&this._addChildren(n.object,n.childTable);n.object.isSwimlane&&(n.object=ej.datavisualization.Diagram.SwimLaneHelper._initSwimLane(n.object,this));this.add(n.object,n);n.object.parent&&(y=this.nameTable[n.object.parent]);n.object._type==="group"?(this._addConnector(n.object,n),this._addGroupConnector(n.object,n)):this._addConnector(n.object,n)}else{for(delete this.nameTable.multipleSelection,h=[],u=ej.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup"}),i=0;i<n.object.children.length;i++)f=typeof n.object.children[i]=="object"?n.object.children[i]:n.childTable[n.object.children[i]],l=this.getObjectType(f),l!=="group"||f.isSwimlane||this._addChildren(f,n.childTable),f.isSwimlane?(this._swimlanePaste=!0,this._isUndo=!0,f=this._pasteSwimlaneObj(f,n),delete this._swimlanePaste):l!="connector"?this.add(f,n):h.push(f),u.children.push(f.name);for(i=0;i<h.length;i++)this.add(h[i],n);for(this._addGroupConnector(n.object,n),i=0;i<u.children.length;i++)if(r=this.nameTable[u.children[i]],!r.segments){if(r.inEdges.length>0)for(e=0;e<r.inEdges.length;e++)this._isUndo?n.childTable[r.inEdges[e]].targetNode=r.name:this.nameTable[r.inEdges[e]].targetNode=r.name;if(r.outEdges.length>0)for(e=0;e<r.outEdges.length;e++)this._isUndo?n.childTable[r.outEdges[e]].sourceNode=r.name:this.nameTable[r.outEdges[e]].sourceNode=r.name}this._clearSelection();this.nodes().push(u);this._nodes=$.extend(!0,[],this.nodes());u.offsetX=n.object.offsetX;u.offsetY=n.object.offsetY;u.height=n.object.height;u.width=n.object.width;u.rotateAngle=n.object.rotateAngle;this.nameTable[u.name]=u;this.addSelection(u,!0)}else if(s=="remove")if(n.object.type=="pseudoGroup"||n.object.isLane)if(n.object.isLane)v=n.object,n.index||n.index==0||(p=null,n.object.isLane&&t&&(t.index=this._getRemoveIndex(n.object,!0))),this._remove(v);else for(i=0;i<n.object.children.length;i++)this._remove(this.nameTable[this._getChild(n.object.children[i])]);else return this._removeAdjacentConnections(n.object,n),n.object.isSwimlane||n.object.annotation?this._remove(this.nameTable[n.object.name]):this._remove(n.object),!0;this._isUndo=!1;this._isInsert=!1;this.tools.move._isLane=!1},_addAssiciatedChildConnectors:function(n){var i=this._getChildren(n.children),r,u,t;if(i&&i.length>0)for(r=0,u=i.length;r<u;r++)t=this.nameTable[i[r]],t&&(this._addConnector(t),t.type==="group"&&this._addAssiciatedChildConnectors(t))},_updateRecordPinPoint:function(n,t,i){var r,o,u,s,h,c,l,e,v,a,f;if(n.type=="pseudoGroup"){for(h=n,c=this._getChildren(n.children),o=0;o<c.length;o++)u=this.nameTable[c[o]],s=t[c[o]],s&&(u.segments?(l=t[u.name],u.sourcePoint=l.sourcePoint,u.targetPoint=l.targetPoint,u.segments=jQuery.extend(!0,u.segments,l.segments)):(this._propertyChangeValues(u,s),this._translate(u,s.offsetX-u.offsetX,s.offsetY-u.offsetY,this.nameTable)),ej.datavisualization.Diagram.DiagramContext.update(u,this));this.selectionList[0]&&this.selectionList[0].name===h.name&&(this.selectionList[0].offsetX=h.offsetX,this.selectionList[0].offsetY=h.offsetY);ej.datavisualization.Diagram.SvgContext.updateSelector(h,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)}else n.segments?i?(r=t[n.name],n.sourcePoint=r.sourcePoint,n.targetPoint=r.targetPoint,n.segments=$.extend(!0,[],r.segments),ej.datavisualization.Diagram.DiagramContext.update(n,this)):(this._clearSelection(!0),r=this._findConnector(n.name),n.targetNode&&(e=this.nameTable[n.targetNode],ej.datavisualization.Diagram.Util.removeItem(e.inEdges,n)),n.sourceNode&&(e=this.nameTable[n.sourceNode],ej.datavisualization.Diagram.Util.removeItem(e.outEdges,n)),n.targetNode&&(e=this.nameTable[n.targetNode],e.inEdges.push(n.name)),n.sourceNode&&(e=this.nameTable[n.sourceNode],e.outEdges.push(n.name)),this._propertyChangeConnectorValues(r,n),r.targetNode=n.targetNode,r.sourceNode=n.sourceNode,r.targetPort=n.targetPort,r.sourcePort=n.sourcePort,r.sourcePoint=n.sourcePoint,r.targetPoint=n.targetPoint,r.segments=$.extend(!0,[],n.segments),ej.datavisualization.Diagram.DiagramContext.update(r,this),ej.datavisualization.Diagram.SvgContext.updateSelector(n,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints),this.addSelection(n,!0)):i?(r=t[n.name],this._translate(n,r.offsetX-n.offsetX,r.offsetY-n.offsetY,t),ej.datavisualization.Diagram.DiagramContext.update(r,this)):(r=this._findNode(n.name),this._clearSelection(!0),this._propertyChangeValues(r,n),n.parent&&(f=this.nameTable[n.parent]),f||(f=this.nameTable[r.parent],v=!0),f&&f.container?(ej.datavisualization.Diagram.canvasHelper._undoDragNode(this,this.nameTable[n.name],n),v&&(a=this.nameTable[f.parent.split("laneStack")[0]],a&&ej.datavisualization.Diagram.DiagramContext.update(a,this))):(this._translate(r,n.offsetX-r.offsetX,n.offsetY-r.offsetY,this.nameTable),n.parent&&ej.datavisualization.Diagram.Util._updateGroupBounds(this.nameTable[r.parent],this),r.parent&&(f=this.nameTable[r.parent],f&&r.parent&&n.parent==""&&(ej.datavisualization.Diagram.Util.removeChildFromGroup(f.children,r.name),this._delete(r),(n.type==="group"||n.type==="bpmn")&&this._initGroupNode(n,t),this.add(n))),n.parent&&(f=this.nameTable[n.parent],n.parent&&r.parent==""&&(this._delete(r),n=$.extend(!0,{},n),(n.type==="group"||n.type==="bpmn")&&this._initGroupNode(n,t),this.add(n)))),ej.datavisualization.Diagram.DiagramContext.update(r,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,r),this.addSelection(r,!0))},_propertyChangeValues:function(n,t){var r=n.offsetX===t.offsetX?"":"offsetX",u=n.offsetY===t.offsetY?"":"offsetY",i;r==="offsetX"&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:r,oldValue:n.offsetX,newValue:t.offsetX},this._raisePropertyChange(i));u==="offsetY"&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:u,oldValue:n.offsetY,newValue:t.offsetY},this._raisePropertyChange(i))},_propertyChangeResizeValues:function(n,t){var r=t.width===n.width?"":"width",u=t.height===n.height?"":"height",i;r==="width"&&(i={element:n,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:r,oldValue:n.width,newValue:t.width},this._raisePropertyChange(i));u==="height"&&(i={element:n,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:u,oldValue:n.height,newValue:t.height},this._raisePropertyChange(i))},_propertyChangeConnectorValues:function(n,t){var r=n.sourcePoint.x===t.sourcePoint.x||n.sourcePoint.y===t.sourcePoint.y?"":"sourcePoint",u=n.targetPoint.x===t.targetPoint.x||n.targetPoint.y===t.targetPoint.y?"":"targetPoint",i;r==="sourcePoint"&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:r,oldValue:n.sourcePoint,newValue:t.sourcePoint},this._raisePropertyChange(i));u==="targetPoint"&&(i={element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:u,oldValue:n.targetPoint,newValue:t.targetPoint},this._raisePropertyChange(i))},_renderNodeOnLane:function(n,t){var i,u,r=this;r._views.forEach(function(f){var e;i=r._views[f];u=i.svg||i._canvas;t=i.svg.getElementById(n.parent);i.type=="overview"&&(e=!0);n._type==="group"?i.context.renderGroup(n,u,t||i.diagramLayer,r.nameTable,r,null,!0):r.getObjectType(n)==="node"&&i.context.renderNode(n,u,t||i.diagramLayer)})},_updateUndoObject:function(n,t){var i,u,r;t.parent&&(r=this.nameTable[t.parent]);r&&this._collectionContains(t.name,r.children)?(ej.datavisualization.Diagram.Util.removeChildFromGroup(r.children,t.name),n.parent&&(i=this.nameTable[n.parent]),i&&i.children&&!this._collectionContains(t.name,i.children)&&(i.children.push(n.name),this.nameTable[n.name].parent=i.name,i.isLane&&(u=this.tools.move,u._updateMargin(t,i)))):n.parent&&(r=this.nameTable[n.parent])},_collectionContains:function(n,t){for(var i=0;i<t.length;i++)if(typeof t[i]=="string"&&t[i]===n||t[i].name===n)return!0},_recordPinPointChanged:function(n){var t=n.object.node,i=n.object.childTable;(t||t.isSwimlane)&&this._updateRecordPinPoint(t,i)},_updateRecordRotation:function(n,t){var f,r,u,e,s,h,o,i;if(n.type=="pseudoGroup"){for(this._clearSelection(!0),this.nameTable[n.name]=n,i=this.nameTable[n.name],e=n.children,f=0;f<e.length;f++)r=this.nameTable[e[f]],u=t[e[f]],r&&(r.segments?(s=t[r.name],r.sourcePoint=s.sourcePoint,r.targetPoint=s.targetPoint):u&&(this._translate(r,u.offsetX-r.offsetX,u.offsetY-r.offsetY,this.nameTable),this._comparePropertyValues(r,"rotateAngle",{rotateAngle:u.rotateAngle}),this._rotate(r,u.rotateAngle-r.rotateAngle,this.nameTable)),ej.datavisualization.Diagram.DiagramContext.update(r,this));i&&(h=n.rotateAngle-i.rotateAngle,i.rotateAngle+=h,this.selectionList[0]&&(this.selectionList[0].rotateAngle=i.rotateAngle));this.nameTable[n.name]=n;this.addSelection(n,!0)}else o=null,n.parent&&(o=this.nameTable[n.parent]),o&&o.container?(i=this._findNode(n.name),ej.datavisualization.Diagram.canvasHelper._undoRotateNode(this,i,n)):n&&(this._clearSelection(!0),i=this._findNode(n.name),this._comparePropertyValues(i,"rotateAngle",{rotateAngle:n.rotateAngle}),this._rotate(i,n.rotateAngle-i.rotateAngle,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(i,this),this.addSelection(i,!0))},_recordSizeChanged:function(n,t){var i=n.object.node,r=n.object.childTable;this._updateRecordSize(i,r,t)},_updateRecordSize:function(n,t,i){var r,o,e,h,c,u,s,f;if(this._clearSelection(!0),n._type!=="group"&&n.type!=="pseudoGroup"||n.isLane||n.isSwimlane||n.type==="bpmn")n.isLane||n.isSwimlane?(r=this._findNode(n.name),ej.datavisualization.Diagram.canvasHelper._undoResizeLane(this,n,i)):(f=null,n.parent&&(f=this.nameTable[n.parent]),f&&f.container?(r=this._findNode(n.name),ej.datavisualization.Diagram.canvasHelper._undoResizeNode(this,r,n)):n.segments||(r=this._findNode(n.name),this._propertyChangeResizeValues(r,n),this._translate(r,n.offsetX-r.offsetX,n.offsetY-r.offsetY,this.nameTable),this.scale(r,n.width/r.width,n.height/r.height,ej.datavisualization.Diagram.Point(r.offsetX,r.offsetY),this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this),this.addSelection(r,!0)));else{for(n.type=="pseudoGroup"&&(this.nameTable[n.name]=n),r=this._findNode(n.name),h=this._getChildren(r.children),c=this._getChildren(n.children),o=0;h&&o<h.length;o++)u=this.nameTable[c[o]],e=t[c[o]],e&&(u.segments?(s=t[u.name],u.sourcePoint=s.sourcePoint,u.targetPoint=s.targetPoint,u.segments=$.extend(!0,[],s.segments)):(this._propertyChangeResizeValues(u,e),this._translate(u,e.offsetX-u.offsetX,e.offsetY-u.offsetY,this.nameTable),this.scale(u,e.width/u.width,e.height/u.height,ej.datavisualization.Diagram.Point(u.offsetX,u.offsetY),this.nameTable)));f=null;n.parent&&(f=this.nameTable[n.parent]);f&&f.container?(r=this._findNode(n.name),ej.datavisualization.Diagram.canvasHelper._undoResizeNode(this,r,n)):(r.offsetX=n.offsetX,r.offsetY=n.offsetY,r.width=n.width,r.height=n.height,this.activeTool.name=="resize"&&this.activeTool.inAction&&this.selectionList[0].type!="pseudoGroup"&&this.selectionList[0].type!="group"||this._updateAssociatedConnectorEnds(r,this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(r,this),this.addSelection(r,!0))}},_recordRotationChanged:function(n){var t=n.object.node,i=n.object.childTable;this._updateRecordRotation(t,i)},_recordEndPointChanged:function(n){this.clearSelection(!0);var t,i,r,u;n._isUndo?(t=i=n.undoObject,r=n.redoObject):(t=i=n.redoObject,r=n.undoObject);t=t.parent?this._findChildren(this.nameTable[t.parent],t.name):this._findConnector(t.name);r.targetNode&&(u=this.nameTable[r.targetNode],ej.datavisualization.Diagram.Util.removeItem(u.inEdges,r.name));r.sourceNode&&(u=this.nameTable[r.sourceNode],ej.datavisualization.Diagram.Util.removeItem(u.outEdges,r.name));i.targetNode&&(u=this.nameTable[i.targetNode],u.inEdges.push(i.name));i.sourceNode&&(u=this.nameTable[i.sourceNode],u.outEdges.push(i.name));this._propertyChangeConnectorValues(t,i);this._comparePropertyValues(t,"targetNode",{targetNode:i.targetNode});t.targetNode=i.targetNode;this._comparePropertyValues(t,"sourceNode",{sourceNode:i.sourceNode});t.sourceNode=i.sourceNode;this._comparePropertyValues(t,"targetPort",{targetPort:i.targetPort});t.targetPort=i.targetPort;this._comparePropertyValues(t,"sourcePort",{sourcePort:i.sourcePort});t.sourcePort=i.sourcePort;this._comparePropertyValues(t,"sourcePoint",{sourcePoint:i.sourcePoint});t.sourcePoint=i.sourcePoint;this._comparePropertyValues(t,"targetPoint",{targetPoint:i.targetPoint});t.targetPoint=i.targetPoint;t.segments=$.extend(!0,[],i.segments);this._updateEdges(t);this._dock(t,this.nameTable);ej.datavisualization.Diagram.Util._updateConnectorSegments(t,t.sourcePort,t.targetPort,this);ej.datavisualization.Diagram.DiagramContext._refreshSegments(t,this);ej.datavisualization.Diagram.Util.updateBridging(t,this);ej.datavisualization.Diagram.DiagramContext.update(t,this);this._updateConnectorBridging(t);this._addSelection(t,this._selectionContains(t)?!0:!1);this.selectionList[0]&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom);ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints)},_recordLabelChanged:function(n){var t=this.nameTable[n.object.name];this._comparePropertyValues(t.labels[n.index?n.index:0],"text",{text:n.label});n.object.type==="text"?(t.textBlock.text=n.label,ej.datavisualization.Diagram.DiagramContext.updateTextBlock(t,t.textBlock,this)):t.type=="umlclassifier"?(this._clearSelection(!0),n.label=ej.datavisualization.Diagram.ClassifierHelper.getEditboxValue(n.label,t,this),t=ej.datavisualization.Diagram.ClassifierHelper.getClassifierNodeDimension(t,this),t.labels[n.index].text="",ej.datavisualization.Diagram.DiagramContext.update(t,this),this.addSelection(t,!0)):t.shape&&t.shape.type=="umlclassifier"?(t=ej.datavisualization.Diagram.ClassifierHelper.getUMLConnectorValue(t,n.label),ej.datavisualization.Diagram.DiagramContext.update(t,this)):t.labels[n.index]?(t.labels[n.index].text=n.label,ej.datavisualization.Diagram.DiagramContext.updateLabel(t,t.labels[n.index],this)):(t.labels[n.index]=ej.datavisualization.Diagram.Label({text:n.label}),ej.datavisualization.Diagram.DiagramContext.addNodeLabel(t,t.labels[n.index],null,this))},labelcollectionchanged:function(n){var t=this.nameTable[n.shape.name],i=t.labels;i.slice(0);n.isUndo?(ej.datavisualization.Diagram.Util.removeItem(t.labels,n.label),diagram._views.forEach(function(i){var u=diagram._views[i],f=u.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],r=$(f).find("#"+t.name+"_"+n.label.name+"_lblbg")[0];r&&r.parentNode.removeChild(r)})):ej.datavisualization.Diagram.DiagramContext.addLabel(t,n.label,this,n.index);this._raisePropertyChange({element:t,cause:ej.datavisualization.Diagram.ActionType.Unknown,propertyName:"labels",oldValue:i,newValue:t.labels})},_recordGroupChanged:function(n){var o=n.actionType,f,u,i,e,s,h,r,c,t;if(n.isUndo&&(n.actionType==="group"&&(o="ungroup"),n.actionType==="ungroup"&&(o="group")),this._clearSelection(o=="group"?!0:!1),f=this._getChildren(n.object.children),o==="group"){for(u=new ej.datavisualization.Diagram.Group(n.object),u.children=[],i=0;i<f.length;i++)u.children.push(f[i]),t=this.nameTable[f[i]],t.parent&&(s=this.nameTable[t.parent]),t.parent=u.name,r=this._svg.document.getElementById(f[i]),r&&r.parentNode.removeChild(r),t.parent&&(h=this.nameTable[t.parent]),this._raiseGroupChangeEvent(t,s,h,"group");this._eventCause.nodeCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange;this.add(u);this._addSelection(u)}else{for(e=n.object,r=this._svg.document.getElementById(e.name),r&&r.parentNode.removeChild(r),c=this._getChildren(e.children),i=0;i<c.length;i++)t=this.nameTable[c[i]],t.parent&&(s=this.nameTable[t.parent]),t.parent="",this._isUndo=!0,t.segments||(t._type=="group"?ej.datavisualization.Diagram.DiagramContext.renderGroup(t,this):ej.datavisualization.Diagram.DiagramContext.renderNode(t,this),this.nodes().indexOf(t)===-1&&(this.nodes().push(t),this._nodes=$.extend(!0,[],this.nodes()))),t.segments&&(ej.datavisualization.Diagram.DiagramContext.renderConnector(t,this),this.connectors().indexOf(t)===-1&&(this.connectors().push(t),this._connectors=$.extend(!0,[],this.connectors()))),this._isUndo=!1,this._nodes=$.extend(!0,[],this.nodes()),t.parent&&(h=this.nameTable[t.parent]),this._raiseGroupChangeEvent(t,s,h,"ungroup");this._removeElement(e);ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this._findNode(e.name));this._nodes=$.extend(!0,[],this.nodes())}},_recordNudgingChanges:function(n,t,i){var r,u;this._isUndo=!0;r=t.undoDirection;i&&(r=t.redoDirection);this._clearSelection(!0);n.type==="pseudoGroup"&&(u=ej.datavisualization.Diagram.Group(n),delete this.nameTable[u.name],this.nameTable[u.name]=n);this._addSelection(this.nameTable[n.name],!0);this.nudge(r,t.values);this._isUndo=!1},_recordPropertiesChanged:function(n,t,i,r){var u=this._getModifiedProperties(i=="port"||i=="label"?r:n,t),f;u&&Object.keys(u).length&&(i=="connector"&&((t.sourcePoint||t.sourceNode)&&(u.sourcePoint=n.sourcePoint,u.sourceNode=n.sourceNode,u.sourcePort=n.sourcePort),(t.targetPoint||t.targetNode)&&(u.targetNode=n.targetNode,u.targetPort=n.targetPort,u.targetPoint=n.targetPoint)),f={type:"propertiesChanged",values:u,category:"internal",object:n,elementType:i},f[i]=r,this.addHistoryEntry(f))},_recordAlignCommandChanges:function(n){var r,t,u,i;if(n&&n.values.length){for(r=0;r<n.values.length;r++)t=n.values[r],t.object&&t.delta&&(u={x:-t.delta.x,y:-t.delta.y},i=this.nameTable[this._getChild(t.object)],this._comparePropertyOnAlign(i,-t.delta.x,-t.delta.y),this._translate(i,-t.delta.x,-t.delta.y,this.nameTable),this._updateContainerOnNudge(i),t.delta=u,this._updateObject(i));this.nameTable[n.object.name]||(this.nameTable[n.object.name]=n.object);ej.datavisualization.Diagram.Util._updateGroupBounds(n.object,this);this._hasSelection()?ej.datavisualization.Diagram.SvgContext.updateSelector(n.object,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints):this.addSelection(n.object,!0)}},_recordPhaseCollectionChanged:function(n){n.undo?n.isAdded?n.phase&&this._removePhase(n.phase.name):n.phase&&this._addPhase(n.group,n.phase,n):n.isAdded?n.phase&&this._addPhase(n.group,n.phase,n):n.phase&&this._removePhase(n.phase.name);this._clearSelection(!0)},_recordSizeCommandChanges:function(n){var r,t,u,i;if(n&&n.values.length){for(r=0;r<n.values.length;r++)t=n.values[r],t.object&&t.values&&(u={width:t.object.width||t.object._width||0,height:t.object.height||t.object._height||0},i=this.nameTable[this._getChild(t.object)],this._comparePropertyValues(i,"height",{height:t.values.height}),this._comparePropertyValues(i,"width",{width:t.values.width}),this.scale(i,t.values.width/(i.width||i._width||0),t.values.height/(i.height||i.height||0),{x:i.offsetX,y:i.offsetY},this.nameTable),t.values=u,this._updateObject(i));this.nameTable[n.object.name]||n.object.type!="pseudoGroup"||(this.nameTable[n.object.name]=n.object);ej.datavisualization.Diagram.Util._updateGroupBounds(n.object,this);this._hasSelection()?ej.datavisualization.Diagram.SvgContext.updateSelector(n.object,this._adornerSvg,this._currZoom,this,this.model.selectedItems.constraints):this.addSelection(n.object,!0)}},_getModifiedProperties:function(n,t,i){var u,r;if(i=i||n,t&&Object.keys(t).length&&i){u={};for(r in t)(t[r]!=i[r]||typeof i[r]=="object")&&(u[r]=i[r]&&i[r]instanceof Array?i[r]:i[r]&&typeof i[r]=="object"?$.extend(!0,{},i[r]):i[r]);return u}},_addCollectionChangeToHistory:function(n){var t,i;n.parent==""&&(t={},this.selectionList&&this.selectionList.length>0&&(t=this._getChildTable(this.selectionList[0],t)),i={type:"collectionchanged",object:jQuery.extend(!0,{},n),childTable:jQuery.extend(!0,{},t),changeType:"insert",category:"internal"},this.addHistoryEntry(i))},_recordPhasesizeChanged:function(n){var t=$.extend(!0,{},n.undoObject),i=$.extend(!0,{},n.redoObject);n.undo?this._updatePhase({name:t.name,offset:t.offset}):this._updatePhase({name:i.name,offset:i.offset})},_recordPortsCollectionChanged:function(n){var u=n.changeType,i,f,r,t;if(n.isUndo&&(u=n.changeType=="insert"?"remove":"insert"),i=this.nameTable[n.object.name],u=="remove")for(t=0;t<n.collection.length;t++)for(ej.datavisualization.Diagram.Util.removeItem(i.ports,n.collection[t]),t=0;t<this._views.length;t++)f=this._views[t],r=this._views[f].svg.document.getElementById(i.name+"_"+n.collection[t].name),r&&r.parentNode.removeChild(r);else for(t=0;t<n.collection.length;t++)i.ports.push(n.collection[t]),ej.datavisualization.Diagram.DiagramContext.renderPort(i,n.collection[t],this)},_addSymbolToDiagram:function(n){var e,h,a,o,r,f,v;if(ej.datavisualization.Diagram.Util.isPageEditable(this)){var u=this._currZoom,y=$("#"+this.element[0].id).offset(),s=this._isTouchEvent(n),c=(s?s.pageX:n.pageX)+this._hScrollOffset-y.left,l=(s?s.pageY:n.pageY)+this._vScrollOffset-y.top,i=$.extend(!0,{},this._selectedSymbol),t;if(this._selectedSymbol&&(t=i,this._isNodeEnters?t.isSwimlane&&(this.nameTable[t.name]=t,t=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,t,{childTable:this.childTable,object:t}),this._addAssiciatedChildConnectors(t)):(t&&t.type!="pseudoGroup"&&(i.name+=ej.datavisualization.Diagram.Util.randomId()),i.segments?ej.datavisualization.Diagram.Util._translateLine(i,c/u,l/u):(this._cloneGroupNode(i,ej.datavisualization.Diagram.Util.randomId()),i._type==="group"?(e=ej.datavisualization.Diagram.Util._getChildrenBounds(i,this),ej.datavisualization.Diagram.Util._translate(i,c/u-e.x-e.height/2,l/u-e.y-e.width/2,this.nameTable,null,this)):(i.offsetX=c/u,i.offsetY=l/u),i.isLane&&(h=ej.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(i,this.nameTable),h.isLane=i.isLane,h.orientation=i.orientation,t=h),i.type=="bpmn"&&delete t.children)),t&&(a={element:t,cancel:!1},this._raiseEvent("dragEnter",a),!a.cancel))){if(this._isEditing&&(this._endEditing=!0,this._endEdit(),delete this._endEditing),t&&!this._isNodeEnters){if(t.isLane&&(t=ej.datavisualization.Diagram.ContainerHelper._initContainer(this,t),o=this.nameTable[this._getChild(t.children[0])],o&&t.labels&&o.labels.length>0))for(r=0;r<o.labels.length;r++)o.labels[r].visible=!1;if(t.labels&&t.labels.length>0)for(r=0;r<t.labels.length;r++)t.labels[r].visible=!1}if(t.type!="pseudoGroup")this.add(t);else{for(f=0;f<t.children.length;f++)this.add(t.children[f]),t.children[f]=t.children[f].name;for(v in this.edgeTable)this.nameTable[v]||this.add(this.edgeTable[v]);this._hasSelection()&&this._clearSelection(!0);this.nodes().push(t);this._nodes=$.extend(!0,[],this.nodes());this.nameTable[t.name]=t;ej.datavisualization.Diagram.Util._updateGroupBounds(t,this);this.addSelection(t,!0)}this._focusedElement=t;t.isLane&&ej.datavisualization.Diagram.SvgContext._hideNode(t,this._svg);this.element[0].focus();this._toolToActivate="move";document.getElementsByClassName("e-paletteItem dragClone")[0]&&$(".e-paletteItem.dragClone").css("display","none");this.activateTool("move",!1);this.activeTool.mousedown(n);this.activeTool.mousemove(n)}}},_removeSymbolFromDiagram:function(){if(this._selectedSymbol){var n=document.getElementsByClassName("e-paletteItem dragClone")[0];n!=null&&(n.style.display="block");this._remove(this.selectionList[0]);this._selectedSymbol=null}},_updateGroupChild:function(n){for(var i=n.children,t=0;t<n.children.length;t++)n.children[t]=this.nameTable[this._getChild(n.children[t])],n.children[t]&&n.children[t]._type==="group"&&this.updateGroupChild(n.children[t])},_dropSymbol:function(n,t){var f,i,o,r,e,s,u,h;if(ej.datavisualization.Diagram.Util.isPageEditable(this)){if(f=n||this.selectionList[0]||this.activeTool.selectedObject,i={element:this.getNode(f)},this._nodeUnderMouse&&(this._nodeUnderMouse.isLane||this._nodeUnderMouse.isSwimlane||this._nodeUnderMouse.segments)&&(i.target=this._nodeUnderMouse),o=!1,i.target||(i.target=this.model),f._type==="group"&&this._updateGroupChild(f),this._remove(f),this.nameTable[i.element.name]=i.element,this._selectedSymbol=null,r=n||i.element,this.activeTool._outOfBoundsDrag(r)){if(this._raiseDropEvent(i),i.cancel)delete this.nameTable[i.element.name],this.activeTool.selectedObject=null;else{if(this._isInsert=!0,r&&r.labels&&r.labels.length>0)for(e=0;e<r.labels.length;e++)r.labels[e].visible=!0;s=!0;u=this.activeTool._getMouseOverElement(t);u&&u.container&&ej.datavisualization.Diagram.Util.canAllowDrop(u)&&!u.isSwimlane&&(ej.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this,this.activeTool.selectedObject,u)?(ej.datavisualization.Diagram.canvasHelper._addNodeToContainer(this,this.activeTool.selectedObject,u),this._raiseGroupChangeEvent(this.selectedObject,null,u,"group")):(s=!1,this.activeTool.selectedObject=null));s&&(this._eventCause.nodeCollectionChange=this._eventCause.connectorCollectionChange=ej.datavisualization.Diagram.CollectionChangeCause.Drop,o=this.add(r),this.activeTool.selectedObject=this.selectionList[0],this._isInsert=!1)}o&&(h=this.nameTable[i.element.name],this._updateDroppedSymbol(h))}else this.activeTool.selectedObject=null,this._clearSelection(!0);ej.datavisualization.Diagram.Util.canDoSingleSelection(this)||(this._clearSelection(!0),this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan&&this.activateTool("panTool"))}},_updateDroppedSymbol:function(n){n&&this.selectionList.length>0&&(this.scrollToNode(n),n.labels.length>0&&n.labels[0].mode==="edit"&&!n.labels[0].readOnly?n.isPhase||n.isSwimlane||n.isLane||(this._isEditing=!0,this.startLabelEdit(n,n.labels[0])):this.element[0].focus(),this._nodeUnderMouse&&this._nodeUnderMouse.segments&&ej.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this._adornerLayer,this._adornerSvg))},_initiateAutoScroll:function(n){if(this.activeTool.inAction&&this.enableAutoScroll()&&!(this.activeTool instanceof ej.datavisualization.Diagram.RotateTool)){var r=this._viewPort,t=this._mousePosition(n,!0),i=this.model.pageSettings.autoScrollBorder;t.x+i.right>=r.width-18?(this._beginAutoScroll("right",n),this._canAutoScroll=!0):t.x<=i.left?(this._beginAutoScroll("left",n),this._canAutoScroll=!0):t.y+i.bottom>=r.height-18?(this._beginAutoScroll("bottom",n),this._canAutoScroll=!0):t.y<=i.top?(this._beginAutoScroll("top",n),this._canAutoScroll=!0):this._canAutoScroll=!1}},_updatePoints:function(n,t,i,r){var u=new ej.datavisualization.Diagram.Point(i.x-t.x,i.y-t.y);ej.datavisualization.Diagram.Geometry.isEmptyPoint(u)||n._updateEndPoint(u.x,u.y,r)},_cloneGroupNode:function(n,t,i){var r=null,u,e=n.children=this._getChildren(n.children),f;if(n._type==="group")for(f=0;f<e.length;f++)i?r=i[e[f]]:this._paletteTable&&(r=this._paletteTable[e[f]]),r&&(r=$.extend(!0,{},r),r._type==="group"&&this._cloneGroupNode(r,t),u=$.extend(!0,{},r),u.name+=t,u.parent=n.name,e[f]=u.name,this.nameTable[u.name]=u)},_addGroupConnector:function(n,t){var r,u,e,i,o,s,f;if(!n.segments)for(s=this._getChildren(n.children),e=0;e<s.length;e++){if(f=this.nameTable[s[e]],f.inEdges&&f.inEdges.length>0)for(r=f.inEdges,i=0,o=r.length;i<o;i++)u=t.edgeTable?t.edgeTable[r[i]]:t.childTable[r[i]],u&&!this.nameTable[u.name]&&this.add(u);if(f.outEdges&&f.outEdges.length>0)for(r=f.outEdges,i=0,o=r.length;i<o;i++)u=t.edgeTable?t.edgeTable[r[i]]:t.childTable[r[i]],u&&!this.nameTable[u.name]&&this.add(u)}},_addConnector:function(n,t){var r,u,i,f;if(!n.segments){if(n.inEdges&&n.inEdges.length>0)for(r=n.inEdges,i=0,f=r.length;i<f;i++)u=t?t.edgeTable[r[i]]:this.nameTable[r[i]],u.zOrder=-1,this.add(u);if(n.outEdges&&n.outEdges.length>0)for(r=n.outEdges,i=0,f=r.length;i<f;i++)u=t?t.edgeTable[r[i]]:this.nameTable[r[i]],u.zOrder=-1,this.add(u)}},_addChildren:function(n,t){for(var r,u=this._getChildren(n.children),i=0;i<u.length;i++)r=t[u[i]],r._type==="group"&&this._addChildren(r,t),this.nameTable[u[i]]=r,n.children[i]=r.name},_updateLabels:function(n,t){n.labels=t;for(var i=0;i<n.labels.length;i++)ej.datavisualization.Diagram.DiagramContext.updateLabel(n,n.labels[i],this)},_getNode:function(n,t){var i;return(i=t?typeof n=="object"?t[n.name]:t[n]:typeof n=="object"?this.nameTable[n.name]:this.nameTable[n],i||typeof n!="object"?i&&typeof n=="string"&&(i=t?t[n]:this.nameTable[n]):i=n,i)?i.isLane?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"lane"):i.isPhase||i.type==="phase"?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"phase"):i.isSwimlane?ej.datavisualization.Diagram.SwimLaneHelper._mapObject(this,i,"swimlane",t):i._type==="node"||i._type==="group"||i._type==="pseudoGroup"||this.getObjectType(i)=="node"?i:i:null},_updateEdges:function(n){var t;ej.datavisualization.Diagram.Util.isTargetConnected(n)&&(t=this.nameTable[n.targetNode],t&&t.inEdges.indexOf(n.name)==-1&&t.inEdges.push(n.name));ej.datavisualization.Diagram.Util.isSourceConnected(n)&&(t=this.nameTable[n.sourceNode],t&&t.outEdges.indexOf(n.name)==-1&&t.outEdges.push(n.name))},_updateChildrenEdges:function(n){for(var t,r=this._getChildren(n.children),i=0;i<r.length;i++)t=r[i],t.segments?(this._updateEdges(t),this._dock(t,this.nameTable)):t._type==="group"&&this._updateChildrenEdges(t)},_updateParent:function(n){for(var u,t,r=this._getChildren(n.children),i=0;i<r.length;i++)u=this.nodes().indexOf(this.nameTable[r[i]]),t=n.type!="bpmn"?this._getNewNode(this.nameTable[r[i]]):this.nameTable[r[i]],t&&t._type==="group"?this._updateParent(t):t&&(t.parent=n.name,ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[t.name],this.nameTable[t.name]),ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,this.nameTable[t.name]),this.nameTable[t.name]=t,u!=-1&&(this.nodes()[u]=t)),this._updateQuad(this.nameTable[t.name])},_findPortAtPoint:function(n,t){var f,i,s,e,r,h,c,l,o,u,a;if(t)for(l=ej.datavisualization.Diagram.Util.bounds(t,!0),f=t.ports,u=0,a=f.length;u<a;++u)if(i=f[u],e=ej.datavisualization.Diagram.Size(i.size,i.size),r=ej.datavisualization.Diagram.Util._getPortPosition(i,l),o=ej.Matrix.identity(),ej.Matrix.rotate(o,t.rotateAngle,t.offsetX,t.offsetY),r=ej.Matrix.transform(o,r),h=r.x-i.size/2,c=r.y-i.size/2,s=ej.datavisualization.Diagram.Rectangle(h,c,e.width,e.height),ej.datavisualization.Diagram.Geometry.containsPoint(s,n))return ej.datavisualization.Diagram.Util.canConnect(i,!0)?i:null;return null},_findLabelAtPoint:function(n,t){var o,r=null,y,u,i,p,w,c,l,a,f,s,e,k=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],v=[],h,b;if(t&&(f=ej.datavisualization.Diagram.Util.bounds(t,!0),o=t.labels,o.length>0))for(r=o[0],h=0,b=o.length;h<b;h++)if(r=o[h],s=$(k).find("#"+t.name+"_"+r.name)[0],c=s?s.offsetWidth:0,l=s?s.offsetHeight:0,c||(c=f.width),l||(l=r.fontSize),u=ej.datavisualization.Diagram.Size(c,l),i=ej.datavisualization.Diagram.Util._getLabelPosition(r,f),i.x=f.x+i.x,i.y=f.y+i.y,e=ej.Matrix.identity(),t.segments?ej.Matrix.rotate(e,0,f.x+f.width/2,f.y+f.height/2):ej.Matrix.rotate(e,-t.rotateAngle,t.offsetX,t.offsetY),a=ej.Matrix.transform(e,n),e=ej.Matrix.identity(),ej.Matrix.rotate(e,-r.rotateAngle,i.x,i.y),a=ej.Matrix.transform(e,a),r.verticalAlignment==ej.datavisualization.Diagram.VerticalAlignment.Top?i.y+=u.height/2:r.verticalAlignment==ej.datavisualization.Diagram.VerticalAlignment.Bottom&&(i.y-=u.height/2),r.horizontalAlignment==ej.datavisualization.Diagram.HorizontalAlignment.Left?i.x+=u.width/2:r.horizontalAlignment==ej.datavisualization.Diagram.HorizontalAlignment.Right&&(i.x-=u.width/2),p=i.x-u.width/2,w=i.y-u.height/2,y=ej.datavisualization.Diagram.Rectangle(p,w,u.width,u.height),ej.datavisualization.Diagram.Geometry.containsPoint(y,a)&&v.push(r),h==o.length-1)return v.length?v[v.length-1]:null;return r},_getCurrentZoom:function(){return this._currZoom},_findNode:function(n){return this.nameTable[n]},_findPort:function(n,t){for(var r=n.ports,i=0,u=r.length;i<u;i++)if(r[i].name===t)return r[i];return null},_findLabel:function(n,t){for(var r=n.labels,i=0,u=r.length;i<u;i++)if(r[i].name===t)return r[i];return null},_findConnector:function(n){return this.nameTable[n]},_findChildren:function(n,t){for(var i,r,f=this._getChildren(n.children),u=0;u<f.length;u++)if(i=this.nameTable[f[u]],i){if(t==i.name)return i;if(i._type==="group"&&(r=this._findChildren(i,t),r))return r}return null},_removeLaneParent:function(n){var t,i;return n.isLane&&n.parent&&(t=this.nameTable[n.parent],t.children&&t.children.length===1&&t&&t.parent&&(i=this.nameTable[t.parent],i))?{remove:!0,node:i}:{remove:!1}},_delete:function(n){var u=!1,f,t,e,r,i,o,s;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(n=n||this.selectionList[0],n))if(!n.isPhase&&(n.type&&n.type!="phase"||n.segments||n._type=="node"||n._type=="pseudoGroup")||this._dropPhase){if(f=this._removeLaneParent(n),f.remove&&(n=f.node),this._selectedSymbol||this._removeAdjacentConnections(n),t=n,t.type=="pseudoGroup"){for(e=this._getChildren(t.children),this._multipleAction=!0,r=e.length-1;r>=0;r--)this._remove(this.nameTable[e[r]])&&(u=!0),this._isUndo=!0;delete this._multipleAction;this._isUndo=!1}else this._nodeUnderMouse===t&&(this._nodeUnderMouse=null),u=this._remove(t),t.container&&t.parent&&(i=this.nameTable[t.parent],i&&i.container&&i.container.type=="stack"&&(this._getChild(i.children[0])?(o=this._getSwimlane(t),o&&this._updateChildAdjacentConnectors(o,!0),ej.datavisualization.Diagram.DiagramContext.update(i,this)):(s=this.nameTable[i.parent],s&&this._remove(s))));u&&this._clearSelection()}else n.type&&n.type=="phase"&&(this._removePhase(n.name),this._clearSelection())},_removeAdjacentConnections:function(n,t){var u={},f={},e,o,i,s,r,h,t;if(u=this._getChildTable(n,u),f=this._getEdgeTable(n,f),!this._isUndo||t){if(e={},o={},!n.segments){if(n.outEdges&&n.outEdges.length>0)for(s=n.outEdges.length,r=0;r<s;r++)i=this.nameTable[n.outEdges[r]],i&&i.sourcePort&&(e[i.name]=i.sourcePort);if(n.inEdges&&n.inEdges.length>0)for(s=n.inEdges.length,r=0;r<s;r++)i=this.nameTable[n.inEdges[r]],i&&i.targetPort&&(o[i.name]=i.targetPort)}this._isUndo?(t.targetPorts=o,t.sourcePorts=e,t.edgeTable=f,t.childTable=u):(h=null,n.isLane&&(h=this._getRemoveIndex(n)),t={type:"collectionchanged",object:this._updatePsedoGroupChildren(n),index:h,childTable:jQuery.extend(!0,{},u),edgeTable:jQuery.extend(!0,{},f),sourcePorts:e,targetPorts:o,changeType:"remove",category:"internal"},n.isPhase||ej.datavisualization.Diagram.Util.canDelete(n)&&this.addHistoryEntry(t))}},_updatePsedoGroupChildren:function(n){var i=jQuery.extend(!0,{},n),r,t;if(n&&n.type=="pseudoGroup")for(t=0;t<i.children.length;t++)r=this.nameTable[this._getChild(i.children[t])],r&&r.isSwimlane&&(i.children[t]=this.getNode(r));return i},_getRemoveIndex:function(n){var t,r,i;if(n.parent&&(t=this.nameTable[n.parent],t&&t.children&&t.children.length>0))for(i in t.children)if(r=this._getChild(t.children[i]),r===this._getChild(n))return Number(i);return 0},_getSwimlaneHeader:function(n){var t;return n&&n.isSwimlane&&n.children&&n.children.length>0&&(t=this.nameTable[n.children[0]]),t},_addPhase:function(n,t,i){var r=this.nameTable[n],h=!1,f,o,e,a,u,l;if(r&&r.isSwimlane&&t&&(r&&r.orientation&&t.offset&&(r.orientation=="horizontal"?(f=r.offsetX-r.width/2,e=this._getFirstLane(r),e&&(f+=e.width),h=t.offset>r.width||r.offsetX-r.width/2+t.offset<f?!0:!1):r.orientation=="vertical"&&(f=r.offsetY-r.height/2,o=this._getSwimlaneHeader(r),o&&(f+=o.height),e=this._getFirstLane(r),e&&(f+=e.height),h=t.offset>r.height||r.offsetY-r.height/2+t.offset<f?!0:!1)),t.offset&&!h)){if(i&&i.islastPhase&&(a=i.phase,r.orientation==="horizontal"?r.width>t.offset&&(t.width+=r.width-t.offset,t.offset=r.width):r.height-o.height>t.offset&&(t.height+=r.height-o.height-t.offset,t.offset=r.height-o.height)),u=ej.datavisualization.Diagram.Phase(t),u.orientation=r.orientation,u.label=ej.datavisualization.Diagram.Label(t.label?t.label:{text:"Phase"}),u.parent=r.name,this.nameTable[u.name]&&(ej.datavisualization.Diagram.Util.removeItem(this.model.phases,this.nameTable[u.name]),delete this.nameTable[u.name]),i&&i.islastPhase){var s=this._getInsertIndex(u)+1,c=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,r),v=$.extend(!0,{},i.phaseObject.prevPhase);this._updateInsertPhase(u,v.name,r,s,i);ej.datavisualization.Diagram.SvgContext.renderphase(u,this._svg,this._diagramLayer,this,r);ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this);ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,this.nameTable[this._getChild(r.children[1])],!0);ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,u)}else{var s=this._getInsertIndex(u)+1,c=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,r),v=$.extend(!0,{},this.nameTable[this._getChild(c[s-1])]);this._updateInsertPhase(u,c[s],r,s);ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this);ej.datavisualization.Diagram.SvgContext.renderphase(u,this._svg,this._diagramLayer,this,r);ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,this.nameTable[this._getChild(r.children[1])],!0);ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,u)}this._isUndo||(l={type:"phasecollectionchanged",phase:u,category:"internal",group:r.name,isAdded:!0},this.addHistoryEntry(l))}this._clearSelection(!0)},_removePhase:function(n){var t=this.nameTable[n],s=!1,h=null,f,r,c,i,u,o,e,l;t&&(this._raiseChildrenPropertyChange(t),f=this.nameTable[t.parent.split("phaseStack")[0]],r=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,f),f&&r&&r.length>1&&(e=this,c=r.indexOf(t.name),this._views.forEach(function(t){var r=e._views[t],i=r.svg.getElementById(n+"_phase_g");i&&i.parentNode.removeChild(i)}),i=ej.datavisualization.Diagram.SwimLaneContainerHelper._getNextPhase(this,t),c===r.length-1&&(i=ej.datavisualization.Diagram.SwimLaneContainerHelper._getPrevPhase(this,t),h=$.extend(!0,{},{prevPhase:i,currPhase:t}),i.offset=t.offset,s=!0),f.orientation==="horizontal"?i.width+=t.width:i.height+=t.height,u=this.nameTable[n],ej.datavisualization.Diagram.Util.removeItem(this.nodes(),u),this._nodes=$.extend(!0,[],this.nodes()),o=this.nameTable[u.parent],delete this.nameTable[n],ej.datavisualization.Diagram.SvgContext._updatephase(i,this),ej.datavisualization.Diagram.Util.removeItem(r,t.name),ej.datavisualization.Diagram.Util.removeItem(o.children,u.name),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,o,!0),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdatePhase(this,t),e=this,this._views.forEach(function(t){var r=e._views[t],f=r.svg.getElementById(n);f&&f.parentNode.removeChild(f);var o=r.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s=$(o).find("#"+u.name)[0],i=r.svg.getElementById(u.name);i&&i.parentNode&&i.parentNode.removeChild(i);s&&o.removeChild(s)}),this._isUndo||(l={type:"phasecollectionchanged",phase:t,group:f.name,category:"internal",phaseObject:h,islastPhase:s,isAdded:!1},this.addHistoryEntry(l))))},_getEdgeTable:function(n,t){var u,e,o,i,r,h,f,s;if(!n.segments){if(n._type==="group"||n._type==="pseudoGroup")for(h=this._getChildren(n.children),o=0;o<h.length;o++){if(f=this.nameTable[h[o]],f&&f.inEdges&&f.inEdges.length>0)for(u=f.inEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r));if(f&&f.outEdges&&f.outEdges.length>0)for(u=f.outEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r))}if(n.inEdges&&n.inEdges.length>0)for(u=n.inEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r));if(n.outEdges&&n.outEdges.length>0)for(u=n.outEdges,i=0,e=u.length;i<e;i++)r=this.nameTable[u[i]],r&&(s=t[r.name]=$.extend(!0,{},r))}return t},_remove:function(n,t,i){var l=!1,f,t,u,a,v,h,s,c,e,r,o;if(this._raiseChildrenPropertyChange(n),(ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&n&&(ej.datavisualization.Diagram.Util.canDelete(n)||i)){if(f=n.segments?"connector":"node",t=t?ej.datavisualization.Diagram.dependentconnector.dependent:ej.datavisualization.Diagram.dependentconnector.independent,u={changeType:"remove",element:this.getNode(n),cancel:!1,dependent:t},n.segments||(u.adjustDependent=!0,u.deleteDependent=!0),a=this._eventCause[f+"CollectionChange"],a||this._isKeyDown&&(this._eventCause[f+"CollectionChange"]=this._isUndo&&!this._multipleAction?ej.datavisualization.Diagram.CollectionChangeCause.HistoryChange:ej.datavisualization.Diagram.CollectionChangeCause.Keydown),n.isPhase||this._selectedSymbol||this._raiseEvent(f+"CollectionChange",u),!u.cancel){if(l=!0,v=n.name,n.type=="group"&&n.type!="pseudoGroup")for(h=this._getChildren(n.children),s=0;s<h.length;s++)if(c=this.nameTable[h[s]],c&&!ej.datavisualization.Diagram.Util.canDelete(c))return;n.isSwimlane&&ej.datavisualization.Diagram.SvgContext._removephases(n,this)}if(n.segments)this._removeEdges(n),n.sourceNode=n.sourcePort=n.targetNode=n.targetPort=null,this._crudDeleteNodes&&!this._selectedSymbol&&this._crudDeleteNodes.push(this.nameTable[n.name]),ej.datavisualization.Diagram.Util.removeItem(this.connectors(),this.nameTable[n.name]),this._connectors=$.extend(!0,[],this.connectors());else{if(n.annotation&&n._annotation)for(e=0;e<n._annotation.length;e++)this.nameTable[n._annotation[e]]&&this._remove(this.nameTable[n._annotation[e]]);this._disConnect(n,u);this._removeConnector(n,u);this._crudDeleteNodes&&!this._selectedSymbol&&this._crudDeleteNodes.push(this.nameTable[n.name]);ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.nameTable[n.name]);this._nodes=$.extend(!0,[],this.nodes())}f=this.getObjectType(n);ej.datavisualization.Diagram.SpatialUtil._removeFromaQuad(this._spatialSearch,this._spatialSearch.quadTable[n.name],n);ej.datavisualization.Diagram.SpatialUtil._updateBounds(this,this._spatialSearch,n,!1);n.parent&&(r=this.nameTable[n.parent],(r&&r.type=="group"||r.type=="umlclassifier")&&(ej.datavisualization.Diagram.Util.removeChildFromGroup(r.children,n.name),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),ej.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this,r,!0),r.parent&&ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,this.nameTable[r.parent]),ej.datavisualization.Diagram.Util._refreshParentGroup(n,this),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,this.nameTable[r.parent]),this._updateQuad(r)));delete this.nameTable[v];n.segments&&this._updateConnectorBridging(n);o=this._svg.getElementById(n.name);n._type=="group"&&n.type!="pseudoGroup"&&this._removeChildren(n,u);this._removeElement(n);o&&o.parentNode&&o.parentNode.removeChild(o);ej.datavisualization.Diagram.SvgContext._removeContainerHelper(this.activeTool.selectedObject,this._adornerSvg,this._adornerLayer);this._clearSelection(this._selectedSymbol||this._dropPhase?!0:!1)}return l},_removeConnector:function(n,t){var r,i,u;if(!n.segments){if(t.deleteDependent&&!t.adjustDependent){if(n.inEdges&&n.inEdges.length>0)for(r=n.inEdges,i=r.length-1;i>=0;i--)this._updateConnection(this.nameTable[r[i]],!0);if(n.outEdges&&n.outEdges.length>0)for(r=n.outEdges,i=0,u=r.length;i<u;i++)this._updateConnection(this.nameTable[r[i]],!0)}if(t.deleteDependent&&t.adjustDependent)if(n.inEdges&&n.inEdges.length>0&&n.outEdges&&n.outEdges.length>0){for(r=n.outEdges,i=r.length-1;i>=0;i--)this._updateConnection(this.nameTable[r[i]],!0);for(r=n.inEdges,i=r.length-1;i>=0;i--)this.nameTable[r[i]]&&this._updateConnection(this.nameTable[r[i]],!0)}else if(n.inEdges&&n.inEdges.length==0&&n.outEdges.length>0)for(r=n.outEdges,i=r.length-1;i>=0;i--)this._updateConnection(this.nameTable[r[i]],!0);else if(n.outEdges&&n.outEdges.length==0&&n.inEdges.length>0)for(r=n.inEdges,i=r.length-1;i>=0;i--)this.nameTable[r[i]]&&this._updateConnection(this.nameTable[r[i]],!0);else if((n.inEdges&&n.inEdges.length==1||n.inEdges.length>1)&&n.outEdges.length==1)for(r=n.outEdges,i=0,u=r.length;i<u;i++)this._updateConnection(this.nameTable[r[i]],!0);else if(!(n.inEdges&&n.inEdges.length>1&&n.outEdges.length>1))for(r=n.inEdges,i=0,u=r.length;i<u;i++)this._updateConnection(this.nameTable[r[i]],!0)}},_updateConnection:function(n,t){n&&ej.datavisualization.Diagram.Util.canDelete(n)&&(this._remove(n,t),this.updateConnector(n.name))},_removeElement:function(n){for(var i,t=0;t<this._views.length;t++)i=this._views[t],this._views[i].context.removeChild(n,this._views[i])},_disConnect:function(n,t,i){var u,f,s,c,h,l,r,o,e,v,a;if(n.inEdges&&n.inEdges.length>0)for(u=n.inEdges,r=0,e=u.length;r<e;r++)ej.datavisualization.Diagram.Util.canDelete(this.nameTable[u[r]])&&(a=!0);if(n.outEdges&&n.outEdges.length>0)for(f=n.outEdges,r=0,e=f.length;r<e;r++)ej.datavisualization.Diagram.Util.canDelete(this.nameTable[f[r]])&&(a=!0);if(t.deleteDependent&&t.adjustDependent&&!i&&a){if(n.inEdges&&n.inEdges.length>0&&n.outEdges.length>0)if(u=n.inEdges,f=n.outEdges,(n.inEdges.length>1||n.inEdges.length==1)&&n.outEdges.length==1){for(r=0,e=u.length;r<e;r++)this.nameTable[u[r]]&&this.nameTable[f[0]]&&this.nameTable[u[r]].targetNode==this.nameTable[f[0]].sourceNode&&(h=this.nameTable[this.nameTable[f[0]].targetNode],h&&(l=$.extend(!0,{},h),this.nameTable[u[r]].sourceNode!=this.nameTable[f[0]].targetNode&&(this.nameTable[u[r]].targetNode=this.nameTable[f[0]].targetNode,this.nameTable[u[r]].targetPort=this.nameTable[f[0]].targetPort,h.inEdges.push(this.nameTable[u[r]].name))),ej.datavisualization.Diagram.Util.dock(this.nameTable[u[r]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[u[r]],this));this.nameTable[f[0]]&&(this.nameTable[f[0]].sourceNode=null,this.nameTable[f[0]].sourcePort=null)}else if(!(n.inEdges.length>1&&n.outEdges.length>1))for(r=0,e=u.length;r<e;r++)if(n.outEdges.length>0&&this.nameTable[u[r]]){for(c=this.nameTable[this.nameTable[u[r]].sourceNode],l=$.extend(!0,{},c),o=0,v=f.length;o<v;o++)this.nameTable[u[r]].targetNode==this.nameTable[f[o]].sourceNode&&(this.nameTable[f[o]].sourceNode=this.nameTable[u[r]].sourceNode,this.nameTable[f[o]].sourcePort=this.nameTable[u[r]].sourcePort,c.outEdges[l.outEdges.length+o]=this.nameTable[f[o]].name,ej.datavisualization.Diagram.Util.dock(this.nameTable[f[o]],this.nameTable),ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[f[o]],this));this.nameTable[u[r]].targetNode=null;this.nameTable[u[r]].targetPort=null}return}if(n.inEdges&&n.inEdges.length>0)for(u=n.inEdges,r=0,e=u.length;r<e;r++)s=this.nameTable[u[r]],s&&(s.targetNode=null,s.targetPort=null);if(n.outEdges&&n.outEdges.length>0)for(f=n.outEdges,r=0,e=f.length;r<e;r++)s=this.nameTable[f[r]],s&&(s.sourceNode=null,s.sourcePort=null)},_removeEdges:function(n){n.targetNode&&this.nameTable[n.targetNode]&&this.nameTable[n.targetNode].inEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[n.targetNode].inEdges,n.name);n.sourceNode&&this.nameTable[n.sourceNode]&&this.nameTable[n.sourceNode].outEdges&&ej.datavisualization.Diagram.Util.removeItem(this.nameTable[n.sourceNode].outEdges,n.name)},_selectionContains:function(n){if(this._hasSelection()&&n)for(var t=0;t<this.selectionList.length;t++)if(n.name===this.selectionList[t].name)return!0;return!1},_getPhaseIndex:function(n){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseIndex(this,n)},_getPhaseBounds:function(n){return ej.datavisualization.Diagram.SwimLaneContainerHelper._getPhaseBounds(this,n)},_addSelection:function(n,t){var s,u,i,c,a,f,l,h;if((ej.datavisualization.Diagram.Util.isPageEditable(this)||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&(ej.datavisualization.Diagram.Util.canDoSingleSelection(this)||n&&n._type==="pseudoGroup"||this._selectedSymbol||ej.datavisualization.Diagram.Util.canEnableAPIMethods(this))&&n&&(ej.datavisualization.Diagram.Util.canSelect(n)||n.type=="phase")&&!this._selectionContains(n)){var e=[],r=[],o=[];if(this._previousSelectedItems&&(r=this._previousSelectedItems),n.type=="pseudoGroup")for(s=this._getChildren(n.children),u=0;u<s.length;u++)i=this.nameTable[s[u]],r.indexOf(i)==-1?e.push(i):ej.datavisualization.Diagram.Util.removeItem(r,i),o.push(i);else e.push(n),o.push(n);c=this._eventCause.selectionChange;c||(this._eventCause.selectionChange=ej.datavisualization.Diagram.SelectionChangeCause.Unknown);a=this.getNode(n);f={changeType:"insert",element:this.getNode(n),selectedItems:o,oldItems:r,newItems:e,cancel:!1};this._selectedSymbol&&!this._endEditing||t||(this._raiseEvent("selectionChange",f),this._previousSelectedItems=f.newItems);f.cancel||(this.selectionList.push(n),this._updateSelectorObject(n),n.isPhase&&(l=this._getPhaseBounds(n)),ej.datavisualization.Diagram.SvgContext.renderSelector(n,this._adornerSvg,this._adornerLayer,this._currZoom,this.model.selectedItems.constraints,l),this.model.selectedItems.userHandles!=null&&this.model.selectedItems.userHandles.length>0&&(h=!1,n.type=="pseudoGroup"&&(h=!0),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.renderUserHandles(this.model.selectedItems.userHandles,n,this._adornerSvg,h,this._currZoom,this._adornerLayer,this)))}},_getInsertIndex:function(n){var f=-1,u,i,e=this.nameTable[n.parent],t=ej.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this,e),r;if(t&&t.length>0&&this.nameTable[t[0]])for(u=this.nameTable[t[0]].offset,r=0;r<t.length;r++)i=this.nameTable[t[r]],i&&i.offset<=n.offset&&i.offset>=u&&(u=i.offset,f=r);return f},_updateInsertPhase:function(n,t,i,r,u){var c=this.nameTable[t],o=this.nameTable[this._getChild(i.children[1])],e,f,s,l,h,a;o&&o.children&&o.children.length>0&&(e=this.nameTable[t],f=ej.datavisualization.Diagram.Node(n),i.isSwimlane&&i.orientation&&i.orientation=="vertical"?(u?(s=n.height,e.height=u.phaseObject.prevPhase.height,e.offset=u.phaseObject.prevPhase.offset):(s=e.height,e.height=c.offset-n.offset,l=s-e.height,f.height=l),f.parent=o.name,f.name=n.name,f.width=e.width,f.isPhase=!0):(u?(h=n.width,e.width=u.phaseObject.prevPhase.width,e.offset=u.phaseObject.prevPhase.offset):(h=e.width,e.width=c.offset-n.offset,a=h-e.width,f.width=a),f.parent=o.name,f.name=n.name,f.height=e.height,f.isPhase=!0),f.x=0,f.y=0,this._isUndo&&f.labels.length!==0||(f.labels=[n.label?n.label:ej.datavisualization.Diagram.Label()]),f.labels[0].rotateAngle=n.orientation=="horizontal"?0:270,f.constraints=ej.datavisualization.Diagram.NodeConstraints.Default&~(ej.datavisualization.Diagram.NodeConstraints.Select|ej.datavisualization.Diagram.NodeConstraints.Connect),f.isPhase=!0,f._type="node",this.add(f,{entryHistory:!0}),o.children.pop(f.name),o.children.splice(r,0,f.name))},_getFirstLane:function(n){var t,i,r;return(n.children[2]&&(t=this.nameTable[this._getChild(n.children[2])]),t&&t.children&&t.children.length>0&&(i=this.nameTable[this._getChild(t.children[0])],i&&i.children&&i.children.length>0&&(r=this.nameTable[this._getChild(i.children[0])],r)))?r:null},updateSelector:function(n){if(this._selectedItem!=""){var t={};n.offsetX&&(t.offsetX=Number(typeof n.offsetX=="function"?n.offsetX():n.offsetX));n.offsetY&&(t.offsetY=Number(typeof n.offsetY=="function"?n.offsetY():n.offsetY));n.width&&(t.width=Number(typeof n.width=="function"?n.width():n.width));n.height&&(t.height=Number(typeof n.height=="function"?n.height():n.height));n.rotateAngle&&(t.rotateAngle=Number(typeof n.rotateAngle=="function"?n.rotateAngle():n.rotateAngle));this.updateNode(this._selectedItem,t)}n.userHandles&&(this.model.selectedItems.userHandles=n.userHandles,this._initHandles(),this.selectionList[0]&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,this.selectionList[0],this._adornerSvg,this.selectionList[0].type=="pseudoGroup",!1,this._currZoom,this));n.tooltip&&(this.model.selectedItems.tooltip=ej.datavisualization.Diagram.Tooltip($.extend(!0,this.model.selectedItems.tooltip,{},n.tooltip)))},_updateSelectorObject:function(n){var i,t;if(n.segments||(this._selectorOffsetX(n.offsetX),this._selectorOffsetY(n.offsetY),this._selectorWidth(n.width),this._selectorHeight(n.height),this._selectorRotateAngle(n.rotateAngle),this._selectedItem=n.name),n.type=="pseudoGroup")for(i=0;i<n.children.length;i++)t=n.children[i],typeof t=="object"?this.model.selectedItems.children.indexOf(t)<0&&this.model.selectedItems.children.push(t):typeof t=="string"&&this.model.selectedItems.children.indexOf(this.nameTable[t])<0&&this.model.selectedItems.children.push(this.nameTable[t]);else this.model.selectedItems.children.indexOf(n)<0&&this.model.selectedItems.children.push(n)},_clearSelectorObject:function(){this._selectorOffsetX(0);this._selectorOffsetY(0);this._selectorWidth(0);this._selectorHeight(0);this._selectorRotateAngle(0);this._selectedItem="";this.model.selectedItems.children=[]},_raiseEvent:function(n,t){if(this.model[n])return t.elementType=this.getObjectType(t.element),(n==="nodeCollectionChange"||n==="connectorCollectionChange"||n==="selectionChange"||n==="scrollChange")&&(t.cause=this._eventCause[n]?this._eventCause[n]:"unknown"),this._multipleAction||(this._eventCause={}),this._trigger(n,t)},_clearSelection:function(n){if(this._hasSelection()){this._isEditing&&this.selectionList.length>0&&!this._isDragg&&this._endEdit();var t={changeType:"remove",element:null,selectedItems:[],oldItems:this.model.selectedItems.children,newItems:[],cancel:!1};this._selectedSymbol||n||(this._raiseEvent("selectionChange",t),this._previousSelectedItems=[]);t.cancel||(this._clearSelectorObject(),this.selectionList[0]&&this.selectionList[0].type=="pseudoGroup"&&(ej.datavisualization.Diagram.Util.removeItem(this.nodes(),this.selectionList[0]),this._nodes=$.extend(!0,[],this.nodes()),delete this.nameTable[this.selectionList[0].name]),ej.datavisualization.Diagram.Util.clear(this.selectionList),ej.datavisualization.Diagram.SvgContext.clearSelector(this._adornerSvg,this._adornerLayer))}},_updateSelectionHandle:function(n){var t,i,u,r;this.selectionList.length>0&&(t=this.nameTable[this.selectionList[0].name],i=this.model.selectedItems.constraints,n&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&(i=i&~ej.datavisualization.Diagram.SelectorConstraints.UserHandles),this._updateSelectorObject(t),u=ej.datavisualization.Diagram.SvgContext.updateSelector(t,this._adornerSvg,this._currZoom,this,i),u||this.model.selectedItems.userHandles!=null&&this.model.selectedItems.userHandles.length>0&&(r=!1,t.type=="pseudoGroup"&&(r=!0),this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.UserHandles&&ej.datavisualization.Diagram.SvgContext.updateUserHandles(this.model.selectedItems.userHandles,t,this._adornerSvg,r,n,this._currZoom,this)))},_hasSelection:function(){return this.selectionList.length>0},_checkToolToActivate:function(n,t){var i=!1,r,u;return r=ej.datavisualization.Diagram.Util._getPseudoGroupConstraints(this,t,this.selectionList[0]),t?((t.segments&&(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&n.shiftKey||(navigator.platform.match("Mac")?n.metaKey:n.ctrlKey)&&n.altKey)&&(this._toolToActivate="endPoint",this._currentCursor="move",i=!0),i||(this._selectionContains(t)?(t.segments?i=this._canActivateEndPointTool(n,t):((!r||r&ej.datavisualization.Diagram.NodeConstraints.Resize)&&(i=this._canActivateResizeTool(n,t)),i||(!r||r&ej.datavisualization.Diagram.NodeConstraints.Rotate)&&(i=this._canActivateRotateTool(n,t))),i||(i=this._canActivateUserHandle(n,t)),i||(!r||r&ej.datavisualization.Diagram.NodeConstraints.Drag)&&(t&&t.isLane&&ej.datavisualization.Diagram.Util.canMultiSelectOnLane(t)?(this._toolToActivate="select",this._currentCursor="default"):i=this._canActivateMoveTool(n,t)),i||(i=this._canActivatephaseTool(n))):(!r||r&ej.datavisualization.Diagram.NodeConstraints.Drag)&&(i=this._canActivateMoveTool(n,t)))):i=this._canActivatephaseTool(n),i||(this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?(this.tool()&ej.datavisualization.Diagram.Tool.SingleSelect&&(u=this._findNodeUnderMouse(n),u&&(this._toolToActivate="select",this._currentCursor="default",i=!0)),i||(this._toolToActivate="panTool",this._currentCursor="pointer")):(this._toolToActivate="select",this._currentCursor="default")),this._toolToActivate!="rotate"&&this._adornerSvg.document.removeAttribute("class"),i},_canActivatephaseTool:function(n){if($(n.target).parents(".ej-d-seperator").first()[0]){var r=$(n.target).parents("g").first()[0].id,t=this._getSeperetor(r.split("_phase_g")[0]),i=this.nameTable[t.parent.split("phaseStack")[0]];if(i&&ej.datavisualization.Diagram.Util.canResize(i))return this._currentCursor=t?t.orientation=="horizontal"?"e-resize":"n-resize":"default",this._toolToActivate="phase",!0}},_canActivateUserHandle:function(n){if(this._isUserHandle(n)&&n.target){var t=n.target.id.split("_")[0];return this._toolToActivate=t,this._currentCursor=this.tools[this._toolToActivate].cursor,!0}return!1},_canActivateEndPointTool:function(n,t){if(t){var i=n.target.getAttribute("class");if(i&&(i==="targetEndPoint"&&ej.datavisualization.Diagram.Util.canDragTargetEnd(t)||i==="sourceEndPoint"&&ej.datavisualization.Diagram.Util.canDragSourceEnd(t)||(i.match("bezierpoint")||i=="segmentEnd")&&ej.datavisualization.Diagram.Util.canDragSegmentThumbs(t)))return this._toolToActivate="endPoint",this._currentCursor="move",!0}return!1},_canActivateResizeTool:function(n,t){var i=n.target.getAttribute("class");return ej.datavisualization.Diagram.Util.canResize(t,i)&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.Resizer&&(i==="nw-resize"||i==="n-resize"||i==="ne-resize"||i==="w-resize"||i==="e-resize"||i==="sw-resize"||i==="s-resize"||i==="se-resize")?(this._toolToActivate="resize",t.rotateAngle>=0&&t.rotateAngle<25||t.rotateAngle>=160&&t.rotateAngle<=205||t.rotateAngle>=340&&t.rotateAngle<=360?this._currentCursor=i:t.rotateAngle>=25&&t.rotateAngle<=70||t.rotateAngle>=205&&t.rotateAngle<=250?this._currentCursor=i==="n-resize"||i==="s-resize"?"ne-resize":i==="nw-resize"||i==="se-resize"?"n-resize":i==="e-resize"||i==="w-resize"?"nw-resize":"e-resize":t.rotateAngle>=70&&t.rotateAngle<=115||t.rotateAngle>=250&&t.rotateAngle<=295?this._currentCursor=i==="n-resize"||i==="s-resize"?"e-resize":i==="nw-resize"||i==="se-resize"?"ne-resize":i==="e-resize"||i==="w-resize"?"n-resize":"nw-resize":(t.rotateAngle>=115&&t.rotateAngle<=155||t.rotateAngle>=295&&t.rotateAngle<=340)&&(this._currentCursor=i==="n-resize"||i==="s-resize"?"nw-resize":i==="nw-resize"||i==="se-resize"?"e-resize":i==="e-resize"||i==="w-resize"?"ne-resize":"n-resize"),!0):!1},_canActivateMoveTool:function(n,t){var o,r,u,f,e,i;if(n.target&&(o=n.target.className),r=o&&ej.datavisualization.Diagram.Util.isClassifier(n)?ej.datavisualization.Diagram.ClassifierHelper.getMovableElementUnderMouse(n,this):this._findNodeUnderMouse(n),r&&r.name===t.name){if(u=!0,t.parent&&(u=this.selectionList.length>0&&this._selectionContains(t)?!0:!1),u&&ej.datavisualization.Diagram.Util.canMoveLabel(t)&&(f=n.target.parentNode.id.split("_"),f[f.length-1]=="lblbg"))return this._toolToActivate="move",this._currentCursor="pointer",!0;if(e=!1,t.parent&&(i=this.nameTable[t.parent],(i&&(i.isSwimlane||i.isLane)&&ej.datavisualization.Diagram.Util.canMove(i)||i.isPhaseStack)&&(e=!0)),ej.datavisualization.Diagram.Util.canMove(t)||e)return this._toolToActivate="move",this._currentCursor=this.selectionList.length>0&&(this._selectionContains(t)||this.selectionList[0].children&&this._findChildren(this.selectionList[0],t.name))?"move":"default",!0}return!1},_canActivateRotateTool:function(n,t){if(ej.datavisualization.Diagram.Util.canRotate(t)&&this.model.selectedItems.constraints&ej.datavisualization.Diagram.SelectorConstraints.Rotator){var i=n.target.getAttribute("class");if(i==="rotateHandle")return this._toolToActivate="rotate",ej.browserInfo().name==="msie"?(this._currentcursor="default",this._adornerSvg.document.setAttribute("class","svg-rotate-ie"),this._currentCursor=""):(this._adornerSvg.document.setAttribute("class","svg-rotate"),this._currentCursor=""),!0}return!1},_canActivatePivotTool:function(n){var t=n.target.getAttribute("class");return t==="pivot"?(this._toolToActivate="pivot",this._currentCursor="default",!0):!1},_updateCursor:function(){this.element[0].style.cursor=this._currentCursor;this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0].style.cursor=this._currentCursor},_getResizeCursor:function(n){var t="default";switch(n){case"topleft":t="nw-resize";break;case"topcenter":t="n-resize";break;case"topright":t="ne-resize";break;case"middleleft":t="w-resize";break;case"middleright":t="e-resize";break;case"bottomleft":t="sw-resize";break;case"bottomcenter":t="s-resize";break;case"bottomright":t="se-resize"}return t},_startEdit:function(n){var i,f,e,r,o,t,u,v=ej.Matrix.identity(),l=n.width?n.width:n._width,a=n.height?n.height:n._height,y,w,s,c,p,h;ej.Matrix.rotate(v,n.rotateAngle,l/2,a/2);n.type==="text"?(r=this._svg.getElementById(n.name+"_shape")!==null?this._svg.getElementById(n.name+"_shape").getBBox():{x:n.offsetX-l*n.pivot.x,y:n.offsetY-a*n.pivot.y,width:l,height:a},i=n.textBlock,i&&!i.readOnly&&(o=ej.datavisualization.Diagram.Util.bounds(n),t=new ej.datavisualization.Diagram.Rectangle(r.x-i.fontSize,r.y-i.fontSize,r.width+i.fontSize/2,r.height+i.fontSize/2),u=this._currZoom,h=ej.Matrix.transform(v,ej.datavisualization.Diagram.Util._getLabelPosition(i,o)),f=n.offsetX-l*n.pivot.x+h.x,e=n.offsetY-a*n.pivot.y+h.y,i.horizontalAlignment=="left"?f+=r.width/2:i.horizontalAlignment=="right"&&(f-=r.width/2),i.verticalAlignment=="top"?e+=r.height/2:i.verticalAlignment=="bottom"&&(e-=r.height/2),r.width===0||r.height===0?(r=ej.datavisualization.Diagram.Util.bounds(n),t.width=r.width==0?50:o.width*u,t.x=f*u-t.width/2*u-this._hScrollOffset,t.height=i.fontSize,t.y=e*u-t.height/2*u-this._vScrollOffset):(t.width=50,t.height=i.fontSize,t.x=f*u-t.width/2*u-this._hScrollOffset,t.y=e*u-t.height/2*u-this._vScrollOffset),this._boundingBox=t,this._createEditBox(i,t.x,t.y,t.width,t.height,n),this._isEditing=!0)):(n.labels.length>0?(i=this.activeTool.getLabelUnderMouse(),i||(i=n.labels[0])):(y=this._findNode(n.name),i=new ej.datavisualization.Diagram.Label({name:"label"+ej.datavisualization.Diagram.Util.randomId()}),n.labels.push(i),w=y!==n?y:null,ej.datavisualization.Diagram.DiagramContext.addNodeLabel(n,i,w,this),this.activeTool.name==="textTool"&&(this.activateTool.activeLabel=i)),i&&!i.readOnly&&(s=document.getElementById(n.name+"_"+i.name),s?(o=ej.datavisualization.Diagram.Util.bounds(n),t=new ej.datavisualization.Diagram.Rectangle(s.offsetLeft,s.offsetTop,s.offsetWidth,s.offsetHeight),r=t,u=this._currZoom,c=ej.datavisualization.Diagram.Util._getLabelPosition(i,o),n.segments||i.relativeMode=="segmentpath"?(t=s.getBoundingClientRect(),t={x:t.left,y:t.top,width:t.width,height:t.height},p=this._controlBBox?this._controlBBox:this._canvas.getBoundingClientRect(),f=(t.x+t.width/2-p.left+this._hScrollOffset)/this._currZoom,e=(t.y+t.height/2-p.top+this._vScrollOffset)/this._currZoom):(i.horizontalAlignment=="left"?c.x+=r.width/2:i.horizontalAlignment=="right"&&(c.x-=r.width/2),i.verticalAlignment=="top"?c.y+=r.height/2:i.verticalAlignment=="bottom"&&(c.y-=r.height/2),h=ej.Matrix.transform(v,c),f=n.offsetX-l*n.pivot.x+h.x,e=n.offsetY-a*n.pivot.y+h.y),r.width===0||r.height===0?(r=ej.datavisualization.Diagram.Util.bounds(n),n.segments?(t.width=r.width<50?50:o.width,t.x=f*u-t.width/2-this._hScrollOffset):(t.width=r.width<50?50:o.width,t.x=f*u-t.width/2-this._hScrollOffset),t.height=n.type=="umlclassifier"?n.height:i.fontSize,t.y=e*u-t.height/2*u-this._vScrollOffset):(t.x=f*u-t.width/2*u-this._hScrollOffset,t.y=e*u-t.height/2*u-this._vScrollOffset),this._boundingBox=t,this._createEditBox(i,t.x,t.y,t.width,t.height,n),this._isEditing=!0):this.activeTool.selectedObject=null))},_createEditBox:function(n,t,i,r,u,f){var s,l,e,o;this._svg&&(s=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s&&(l=f.type==="text"?$(s).find("#"+f.name+"_shape_lblbg")[0]:$(s).find("#"+f.name+"_"+n.name+"_lblbg")[0],l&&(l.style.display="none")));var a=ej.datavisualization.Diagram.Util.bounds(f),h=document.createElement("div"),c={id:this.element[0].id+"_editBoxDiv","class":"edit",style:"top:"+i+"px;left:"+t+"px;width:"+r+"px;font-family:"+n.fontFamily+";font-size:"+n.fontSize+"px;min-width: 50px;min-height:"+n.fontSize+"px;"};ej.datavisualization.Diagram.Util.canZoomTextEditor(this)&&(c.style+="transform: scale("+this._currZoom+");");ej.datavisualization.Diagram.Util.attr(h,c);e=document.createElement("textarea");o=n.fontColor?n.fontColor.toLowerCase():"black";o=o!="white"&&o!="ffffff"&&o!="rgb(255,255,255)"?o:"black";c={id:this.element[0].id+"_editBox","class":"editBox",style:"font-size:"+n.fontSize+"px;font-family:"+n.fontFamily+";min-height:"+n.fontSize+"px; height: "+u+"px; line-height: normal; color:"+o+";font-weight:"+(n.bold?"bold":"normal")+";font-style:"+(n.italic?"italic":"normal")+";text-decoration:"+n.textDecoration,nodeWidth:a.width,nodeHeight:a.height,fontSize:n.fontSize,nodeOffsetX:f.offsetX,nodeOffsetY:f.offsetY,containerName:f.name};ej.datavisualization.Diagram.Util.attr(e,c);e.value=n.text;h.appendChild(e);$(this._canvas).append(h);n.text!==""&&this._updateEditor(null,h,e,a.width,n.fontSize,n,f);this._on($(e),"focusout",this._editboxfocusout);this._on($(e),"keyup",this._editBoxKeyUp);this._on($(e),"input",this._editBoxTextChange);e.focus();e.select()},_editBoxKeyUp:function(n){this._updateLabelPosition(n)},_editBoxTextChange:function(n){this._updateLabelPosition(n)},_updateEditBox:function(n,t){var i=document.getElementById(this.element[0].id+"_editBoxDiv");i&&(i.style.left=i.offsetLeft-n+"px",i.style.top=i.offsetTop-t+"px")},_editboxfocusout:function(){this._endEditing=!0;this._endEdit();delete this._endEditing},_updateLabelPosition:function(n){var t=50,o=this._currZoom,r=this._boundingBox,e=Number(n.target.getAttribute("fontSize")),f=Number(n.target.getAttribute("nodeWidth")),s=r.x+r.width/2,l=r.y+r.height/2,i=this._textLength(n),u,h,c;i.width===0?(u=r.width<t?t:r.width,n.target.parentNode.style.width=u+"px",n.target.parentNode.style.left=s-u/2-e/4+"px"):(u=i.width<=f*o?i.width<t?t:i.width:i.width>=f*o?i.width>t?i.width:t:f<t?t:f*o,n.target.parentNode.style.width=u+"px",n.target.parentNode.style.left=s-u/2+"px");i.height===0?(n.target.style.height=e+"px",n.target.parentNode.style.top=l-e/2+"px"):(this._selectedItem&&(h=this.nameTable[this._selectedItem],h.type==="text"&&(c=this._currentLabel)),this._updateEditor(n,n.target.parentNode,n.target,f,e,c))},_updateEditor:function(n,t,i,r,u,f,e){var w,a,o,s=this._textLength(n,f),v=this._currZoom,b=50,k=this._boundingBox.x,d=this._boundingBox.y,g=this._boundingBox.width,nt=this._boundingBox.height,rt=i.value,ut=rt.split("\n"),y,p,h,l;this._nodeUnderMouse&&(this.old=this._nodeUnderMouse,y=this._nodeUnderMouse.name.match("_attribute")?"attribute":this._nodeUnderMouse.name.match("_method")?"method":this._nodeUnderMouse.name.match("_member")?"member":this._nodeUnderMouse.name.match("_header_classifier")?"header":"null");this.old&&(y=this.old.name.match("_attribute")?"attribute":this.old.name.match("_method")?"method":this.old.name.match("_member")?"member":this.old.name.match("_header_classifier")?"header":"null");p=y&&y!="null"?s.width>r?s.width:r:r<s.width?r:s.width;this._browserInfo.name==="mozilla"&&(p+=2);h=p<b?b:p;t.style.width=h+"px";w=n?(h-g)/2:(h-g*v)/2;e&&e.shape&&e.shape.type=="umlclassifier"?(s=ej.datavisualization.Diagram.Util.bounds(e),t.style.left=s.center.x+"px"):t.style.left=k-w-u/4+"px";ut.length>1||s.width!=r?(e&&e.type!="umlclassifier"&&(i.style.height="0"),o=this._browserInfo.name==="mozilla"?i.scrollHeight:i.scrollHeight-4):o=u;var tt=$(i).offset(),it=$(this._canvas).offset(),c=$(this._canvas).height();c||(c=this._getCanvasHeight(this._canvas,c));tt.top-it.top+Number(o)>c&&(o=o-(tt.top-it.top+Number(o)-c),o=this._browserInfo.name==="mozilla"?o-7:o-6);i.style.height=o+"px";l=0;n?(a=(o-nt)/2,l=d-a*v):(a=(o-nt*v)/2,l=d-a-3*v);e&&e.shape&&e.shape.type=="umlclassifier"?(s=ej.datavisualization.Diagram.Util.bounds(e),t.style.top=s.center.y+"px"):t.style.top=l+"px";this._boundingBox=new ej.datavisualization.Diagram.Rectangle(k-w,l,h,o)},_getCanvasHeight:function(n,t){for(var r=t,i=n;r<=0;)i=i.parentNode,i&&(r=$(i).height());return r},_textLength:function(n,t){var i=document.createElement("div"),r=document.getElementById(this.element[0].id+"_editBox"),u={id:this.element[0].id+"_editBoxHiddenDiv",style:"position : absolute; width : auto; height : auto;font-size:"+r.style.fontSize+"px;font-family:"+r.style.fontFamily+";word-wrap: break-word;white-space:pre-wrap;"},f;return t&&(u.style="position : absolute; width : auto; height : auto;font-weight:"+(t.bold?"bold":"normal")+";font-style:"+(t.italic?"italic":"normal")+";text-decoration:"+t.textDecoration+";font-size:"+t.fontSize+"px;font-family:"+t.fontFamily+";word-wrap: break-word;white-space:pre-wrap;"),ej.datavisualization.Diagram.Util.attr(i,u),n?i.appendChild(document.createTextNode(n.target.value)):i.appendChild(document.createTextNode(r.value)),document.body.appendChild(i),f=i.getBoundingClientRect(),document.body.removeChild(i),f},_endEdit:function(n){var k,h,w,b,r=document.getElementById(this.element[0].id+"_editBox"),t,e,c,i,u,d,g,l,f,o,s,a,v,y,p;if(r){if(t=this._findNode(r.getAttribute("containerName")),this.activeTool.name==="textTool")t=this.activeTool.selectedObject;else if(!t)for(e=0;e<this.selectionList.length;e++)c=this.selectionList[e],typeof c.labels.length!="undefined"&&c.labels.length>0&&c.labels[0].mode===ej.datavisualization.Diagram.LabelEditMode.Edit&&(t=this.selectionList[e]);t&&(this._isEditing=!1,t.type=="text"?i=t.textBlock:(i=this.activeTool.getLabelUnderMouse(),i||(i=t.labels[0])),t.type=="umlclassifier"&&(r.value=ej.datavisualization.Diagram.ClassifierHelper.getEditboxValue(r.value,t,this)),i&&(u=i.text),t._type!="node"||t.width&&t.height||!this.nameTable[t.name]||(w=t._width,b=t._height,t.labels[0].text=r.value,this._getNodeDimension(t)),t.type=="umlclassifier"&&(t=ej.datavisualization.Diagram.ClassifierHelper.getClassifierNodeDimension(t,this)),n&&(d=n.keyDownEventArgs.keyCode===27?"ESC":String.fromCharCode(n.keyDownEventArgs.keyCode)),r.value!=u&&(k=this._raiseEvent("textChange",{element:this.getNode(t),value:r.value,keyCode:d})),k?(t._width&&w&&(t._width=w),t._height&&b&&(t._height=b),t&&t.type==="text"?ej.datavisualization.Diagram.DiagramContext.update(t,this):(i=this.activeTool.activeLabel?this.activeTool.activeLabel:t.labels.length>0?t.labels[0]:null,i!=undefined&&(i.mode=ej.datavisualization.Diagram.LabelEditMode.View,ej.datavisualization.Diagram.DiagramContext.updateLabel(t,i,this))),this.activeTool&&(this.activeTool.activeLabel=null,this.activeTool.selectedObject=null)):(t&&t.type!==undefined&&t.type==="text"?(g=u,t.textBlock.text=r.value,t.textBlock.mode=ej.datavisualization.Diagram.LabelEditMode.View,this._findNode(t.name)?(ej.datavisualization.Diagram.DiagramContext.update(t,this),h={type:"labelchanged",shape:t,previousLabelValue:g,updatedLabelValue:r.value,category:"internal"},this.addHistoryEntry(h)):(r.value!==""&&(l=Number(r.style.height.substring(0,r.style.height.length-2)),t.height<l&&(t.offsetY=t.offsetY-t.height/2+l/2,t.height=l),this.selectionList.length>0&&this._clearSelection(!0),this.add(t),f=this.nameTable[t.parent],f&&f.isLane&&(o=this._moveOnLane(t,f),o.proceedX||this.updateNode(t.name,{offsetX:t.offsetX+o.x}),o.proceedY||this.updateNode(t.name,{offsetY:t.offsetY+o.y}),this._updateNodeMargin(t),ej.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this),this._disableSwimlaneUptate=!0,ej.datavisualization.Diagram.canvasHelper._updateCollectionChange(this,f),f.isLane&&(s=this._getSwimlane(f),s&&(this._updateChildAdjacentConnectors(s,!0),delete this._disableSwimlaneUptate,ej.datavisualization.Diagram.canvasHelper._updateLastPhase(this,s),ej.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this,s))))),this.activeTool.selectedObject=null)):t==undefined||t.type=="pseudoGroup"||(i!=undefined?(this._comparePropertyValues(i,"text",{text:r.value}),u=u?u:i.text,u!=r.value&&(h={type:"labelchanged",shape:t,previousLabelValue:i.text,updatedLabelValue:r.value,index:t.labels.indexOf(i),category:"internal"},this.addHistoryEntry(h)),i.text=r.value,i.mode=ej.datavisualization.Diagram.LabelEditMode.View,ej.datavisualization.Diagram.DiagramContext.updateLabel(t,i,this),t.isPhase&&(t.name.split("phaseStack")[1]&&(a=this.nameTable[t.name.split("phaseStack")[1]]),a&&a.label&&(a.label.text=r.value)),this.activeTool.selectedObject=null):t.labels.length==0&&(i=ej.datavisualization.Diagram.Label(),i.text=r.value,i.mode=ej.datavisualization.Diagram.LabelEditMode.View,t.labels.push(i),ej.datavisualization.Diagram.DiagramContext.addNodeLabel(t,i,null,this)),this.activeTool.activeLabel&&(this.activeTool.activeLabel=null)),t.shape&&t.shape.type=="umlclassifier"&&(t=ej.datavisualization.Diagram.ClassifierHelper.getUMLConnectorValue(t,r.value)),t._type!="node"||t.width&&t.height||!this.nameTable[t.name]||(ej.datavisualization.Diagram.DiagramContext.update(t,this),t.parent&&ej.datavisualization.Diagram.DiagramContext.update(this.nameTable[t.parent],this)),t.type=="umlclassifier"&&(t.labels[0].text="",ej.datavisualization.Diagram.DiagramContext.update(t,this)),t.shape&&t.shape.type=="umlclassifier"&&ej.datavisualization.Diagram.DiagramContext.update(t,this)));this._off($(r),"focusout",this._editboxfocusout);this._off($(r),"keyup",this._editBoxKeyUp);this._off($(r),"input",this._editBoxTextChange);v=$("#"+this.element[0].id+"_editBoxDiv")[0];v&&v.parentNode.removeChild(v);this._svg&&(y=this._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],y&&(t.type==="text"?p=$(y).find("#"+t.name+"_shape_lblbg")[0]:i&&(p=$(y).find("#"+t.name+"_"+i.name+"_lblbg")[0]),p&&(p.style.display="block")))}n&&n.keyDownEventArgs&&n.keyDownEventArgs.keyCode===27&&this.element[0].focus()},_getSwimlane:function(n){var i,t;return n=typeof n=="string"?this.nameTable[n]:n,t=this.nameTable[n.parent],t&&(i=this.nameTable[t.parent]),i},_setLabelEditing:function(n){var t;if(n)return n.readOnly?(n.mode=ej.datavisualization.Diagram.LabelEditMode.View,t=!1):(this._currentLabel&&(this._currentLabel.mode=ej.datavisualization.Diagram.LabelEditMode.View),n.mode=ej.datavisualization.Diagram.LabelEditMode.Edit,this._currentLabel=n,t=!0),t},_isInternalTool:function(n){return n instanceof ej.datavisualization.Diagram.SelectTool||n instanceof ej.datavisualization.Diagram.ConnectionEditTool||n instanceof ej.datavisualization.Diagram.MoveTool||n instanceof ej.datavisualization.Diagram.ResizeTool||n instanceof ej.datavisualization.Diagram.PhaseTool||n instanceof ej.datavisualization.Diagram.RotateTool||n instanceof ej.datavisualization.Diagram.PanTool&&this.tool()&ej.datavisualization.Diagram.Tool.SingleSelect&&this.tool()&ej.datavisualization.Diagram.Tool.ZoomPan?!0:!1},_updateNodeMargin:function(n){var t,s,h,r,u,c,o;if(n.parent!=""&&(t=this.nameTable[n.parent],t&&t.container&&t.container.type=="canvas")){var f=ej.datavisualization.Diagram.Util.bounds(t),e=ej.datavisualization.Diagram.Util.bounds(n),i=ej.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);n.marginLeft=i.x-(f.x+t.paddingLeft);s=f.x+t.width-(i.x+i.width)-t.paddingRight;n.marginRight=s<0?0:s;n.marginTop=i.y-(f.y+t.paddingTop);h=f.y+t.height-(i.y+i.height)-t.paddingBottom;n.marginBottom=h<0?0:h;t.isLane&&(r=0,u=0,t.orientation==="horizontal"?(r=50,u=0):(r=0,u=50),n.marginLeft=n.marginLeft>=r?n.marginLeft:r,n.marginTop=n.marginTop>=u?n.marginTop:u)}if((n.type=="pseudoGroup"||n.name=="multipleSelection")&&n.children.length>0)for(o=0;o<n.children.length;o++)c=this.nameTable[this._getChild(n.children[o])],c&&this._updateNodeMargin(c)},_raisePropertyChange:function(n){n&&(this._isSizingCommand?n.cause=ej.datavisualization.Diagram.ActionType.Size:this._isUndo?n.cause=ej.datavisualization.Diagram.ActionType.HistoryChange:this._isTouchedEvent&&(n.cause=ej.datavisualization.Diagram.ActionType.Touch),this._raiseEvent("propertyChange",n))},_updateAdjacentEdges:function(n,t){var i,r;if(n.inEdges&&n.inEdges.length>0)for(i=0,r=n.inEdges.length;i<r;i++)t[n.inEdges[i]]=this.nameTable[n.inEdges[i]];if(n.outEdges&&n.outEdges.length>0)for(i=0,r=n.outEdges.length;i<r;i++)t[n.outEdges[i]]=this.nameTable[n.outEdges[i]]},_translate:function(n,t,i,r,u,f){var h,f,s,o,e;if(t||i)if(n.segments)ej.datavisualization.Diagram.Util._translateLine(n,t,i,n),this._dock(n,r),ej.datavisualization.Diagram.Util.updateBridging(n,this),this._updateConnectorBridging(n);else{if(f||(h=!0),f=f||{},this._updateAdjacentEdges(n,f),n.offsetX+=t,n.offsetY+=i,this._parentNode||this.activeTool.name=="phase"||(this._parentNode=n),(n._type==="group"||n.type==="pseudoGroup")&&!u){for(s=this._getChildren(n.children),o=0;o<s.length;o++)e=r[s[o]],e&&(this._translate(e,t,i,r,undefined,f),e.parent&&e.parent!=n.name&&n.type!="pseudoGroup"&&ej.datavisualization.Diagram.Util._updateGroupBounds(r[e.parent],this));n.type!="group"&&n.container&&ej.datavisualization.Diagram.Util._updateGroupBounds(n,this)}if(n!=this.activeTool.helper&&(this.nameTable[n.name]&&this._updateQuad(n),ej.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(n,t,i,null,this)),this._parentNode==n&&delete this._parentNode,h&&!this._preventDocking&&n!=this.activeTool.helper&&!this._disableSegmentChange)for(o in f)e=this.nameTable[o],e&&((n.isSwimlane||(n.type=="pseudoGroup"||n.type=="group")&&!this._containsChild(n,e))&&ej.datavisualization.Diagram.Util._translateLine(e,t,i,e),this._dock(e,this.nameTable),e.annotation&&ej.datavisualization.Diagram.DefautShapes.updateAnnotationProperties(e,this))}else return!1},_containsChild:function(n,t){for(var f,i,r=this._getChildren(n.children),u=0;u<r.length;u++){if(f=this._collectionContains(t.name,r),f)return!0;i=this._getChild(r[u]);i&&i.children&&this._containsChild(i,t)}},_translateLabel:function(n,t,i,r){var u=$.extend(!0,{},t);t.margin.left+=i;t.margin.top+=r;t.margin.right-=i;t.margin.bottom-=r;t.horizontalAlignment=="center"&&(t.margin.right=0);t.verticalAlignment=="center"&&(t.margin.bottom=0);ej.datavisualization.Diagram.DiagramContext.updateLabel(n,t,this);this._comparePropertyValues(n,"labels",u)},_rotate:function(n,t,i){var u,e,o,s,r,f,h;if(!n.segments&&t){if(n.rotateAngle+=t,n.rotateAngle%=360,n.rotateAngle<0&&(n.rotateAngle+=360),n._type==="group"||n.type==="pseudoGroup"){for(u=ej.Matrix.identity(),ej.Matrix.rotate(u,t,n.offsetX,n.offsetY),s=this._getChildren(n.children),f=0;f<s.length;f++)r=i[s[f]],r&&(r.segments?(r.sourceNode||this._setEndPoint(r,ej.Matrix.transform(u,r.sourcePoint),!1),r.targetNode||this._setEndPoint(r,ej.Matrix.transform(u,r.targetPoint),!0)):(this._rotate(r,t,i),e=r.offsetX,o=r.offsetY,h=ej.Matrix.transform(u,ej.datavisualization.Diagram.Point(e,o)),this._translate(r,h.x-e,h.y-o,i),this._updateAssociatedConnectorEnds(r,i)),r.parent&&r.parent!=n.name&&n.type!="pseudoGroup"&&ej.datavisualization.Diagram.Util._updateGroupBounds(i[r.parent],this));ej.datavisualization.Diagram.Util._updateGroupBounds(n,this)}n.parent&&this._updateParentBounds(n.parent);n!=this.activeTool.helper&&this._updateQuad(n);this._updateAssociatedConnectorEnds(n,i)}},_raiseOffsetPropertyChange:function(n,t,i,r){n&&!n.segments?(t=t?t:0,i=i?i:0,t!=n.offsetX&&this._comparePropertyValues(n,"offsetX",{offsetX:t},r),i!=n.offsetY&&this._comparePropertyValues(n,"offsetY",{offsetY:i},r)):(t=t?t:0,i=i?i:0,this._comparePropertyValues(n,"sourcePoint",{sourcePoint:{x:n.sourcePoint.x+t,y:n.sourcePoint.y+i}},r),this._comparePropertyValues(n,"targetPoint",{targetPoint:{x:n.targetPoint.x+t,y:n.targetPoint.y+i}},r))},_raiseSizePropertyChange:function(n,t,i,r){if(n&&i&&t){var u=n.height*i,f=n.width*t;u!=n.height&&(this._comparePropertyValues(n,"height",{height:u},r),this._comparePropertyValues(n,"offsetY",{offsetY:n.offsetY+(u-n.height)},r));f!=n.width&&(this._comparePropertyValues(n,"width",{width:f},r),this._comparePropertyValues(n,"offsetX",{offsetX:n.offsetX+(f-n.width)/2},r))}},scale:function(n,t,i,r,u,f,e){var w,y,l,o,p,a,d,g,s,b,k;if(t&&t!=1||i&&i!=1||n.isPhase)if(n.container)switch(n.container.type){case"canvas":a={};s=ej.Matrix.identity();ej.Matrix.rotate(s,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(s,t,i,r.x,r.y);ej.Matrix.rotate(s,n.rotateAngle,r.x,r.y);v=ej.Matrix.transform(s,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY));c=n.width*t;h=n.height*i;e&&(n.minHeight=h,n.minWidth=c);a.width=c;a.height=h;a&&a.width>1&&(d=n.offsetX-n.width/2,n.width!=a.width&&(n._scaled=!0),n.width=a.width,n.offsetX=d+n.width/2);a&&a.height>1&&(g=n.offsetY-n.height/2,n.height!=a.height&&(n._scaled=!0),n.height=a.height,n.offsetY=g+n.height/2);break;case"stack":s=ej.Matrix.identity();ej.Matrix.rotate(s,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(s,t,i,r.x,r.y);ej.Matrix.rotate(s,n.rotateAngle,r.x,r.y);v=ej.Matrix.transform(s,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY));b=0;k=0;t!=0&&(b=n.marginLeft,k=n.marginRight);c=n.width*t-(b+k);h=n.height*i-(n.marginTop+n.marginBottom);a={height:n.height,width:n.width};this._resizeStack&&(n.width=c,n.height=h,n.offsetX=v.x,n.offsetY=v.y)}else if(s=ej.Matrix.identity(),n.segments){for(ej.Matrix.scale(s,t,i,r.x,r.y),l=0;l<n.segments.length;l++){for(o=n.segments[l],p=0;p<o.points.length;p++)o.points[p]=ej.Matrix.transform(s,o.points[p]),l!=0||p!=0||n.sourceNode||(o._startPoint=o.points[0],o._endPoint=o.points[o.points.length-1],ej.datavisualization.Diagram.Util._setLineEndPoint(n,ej.Matrix.transform(s,n.sourcePoint),!1)),l!=n.segments.length-1||p!=o.points.length-1||n.targetNode||(o._startPoint=o.points[0],o._endPoint=o.points[o.points.length-1],n.targetPoint=o._endPoint);o._startPoint=o.points[0];o._endPoint=o.points[o.points.length-1];o.type=="orthogonal"?o.length||o.length===0?o.length=o._length=ej.datavisualization.Diagram.Geometry.distance(o._startPoint,o._endPoint):ej.datavisualization.Diagram.Util._addOrthogonalPoints(o,n.segments[l-1],n.segments[l+1],n.sourcePoint,n.targetPoint):(o.point&&(o.point=o._endPoint),o._point=o._endPoint)}(n.sourceNode||n.targetNode)&&this._dock(n,u)}else{if(n._type==="group"||n.type==="pseudoGroup"){if(n.type!="bpmn"||n.width*t>=20&&n.height*i>=20){for(w=this._getChildren(n.children),l=0;l<w.length;l++)y=u[w[l]],y&&(n.type!="bpmn"||ej.datavisualization.Diagram.Util.canResize(y))&&(this.scale(y,t,i,r,u),y.parent&&y.parent!=n.name&&n.type!="pseudoGroup"&&ej.datavisualization.Diagram.Util._updateGroupBounds(u[y.parent],this));if(n.type=="bpmn"&&ej.datavisualization.Diagram.Util._updateBPMNProperties(n,diagram,u,!0),n.children.length<=0){ej.Matrix.rotate(s,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(s,t,i,r.x,r.y);ej.Matrix.rotate(s,n.rotateAngle,r.x,r.y);var v=ej.Matrix.transform(s,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),c=n.width?n.width*t:n._width*t,h=n.height?n.height*i:n._height*i;c>1&&(n.width?(c!=n.width&&(n._scaled=!0),n.width=c,n.offsetX=v.x):(c!=n._width&&(n._scaled=!0),n.maxWidth=n.parent&&u[n.parent].width!=n.maxWidth?u[n.parent].width:c,n.offsetX=v.x-(n._width*t-n._width)/2));h>1&&(n.height?(h!=n.height&&(n._scaled=!0),n.height=h,n.offsetY=v.y):(h!=n._height&&(n._scaled=!0),n.maxHeight=n.parent&&u[n.parent].height>h?u[n.parent].height:h,n.offsetY=v.y-(n._height*i-n._height)/2))}ej.datavisualization.Diagram.Util._updateGroupBounds(n,this);n!=this.activeTool.helper&&ej.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(n,1/t,1/i,r,this)}}else{ej.Matrix.rotate(s,-n.rotateAngle,r.x,r.y);ej.Matrix.scale(s,t,i,r.x,r.y);ej.Matrix.rotate(s,n.rotateAngle,r.x,r.y);var v=ej.Matrix.transform(s,ej.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),c=n.width*t,h=n.height*i;n.maxWidth!=0&&(c=Math.min(n.maxWidth,c));n.minWidth!=0&&(c=Math.max(n.minWidth,c));n.maxHeight!=0&&(h=Math.min(n.maxHeight,h));n.minHeight!=0&&(h=Math.max(n.minHeight,h));c>1&&(c!=n.width&&(n._scaled=!0),c!=n.maxWidth&&c!=n.minWidth&&(n.width=c,n.offsetX=v.x));h>1&&(h!=n.height&&(n._scaled=!0),h!=n.maxHeight&&h!=n.minHeight&&(n.height=h,n.offsetY=v.y))}n.parent&&this._updateParentBounds(n.parent);ej.datavisualization.Diagram.Util._updateBPMNProperties(n,this,u,!0);this.activeTool.name=="resize"&&this.activeTool.inAction&&this.selectionList[0]&&this.selectionList[0].type!="pseudoGroup"&&this.selectionList[0].type!="group"||this._updateAssociatedConnectorEnds(n,u);n!=this.activeTool.helper&&this._updateQuad(n)}},_updateParentBounds:function(n){n=this.nameTable[this._getChild(n)];n&&n.type!="bpmn"&&!n.container&&(ej.datavisualization.Diagram.Util._updateGroupBounds(n,this),ej.datavisualization.Diagram.DiagramContext.update(n,this),n.parent&&this._updateParentBounds(n.parent))},_dock:function(n,t,i){if(!this._preventDocking&&!this._disableSegmentChange&&(!this._layoutInAction||!this._isAnimating)){var r=n.segments.length,u=n.segments[0].points.length,f=n.segments[n.segments.length-1].points.length;this._preventSegmentAdjusting&&(n._preventSegmentAdjusting=!0);ej.datavisualization.Diagram.Util.dock(n,t);delete n._preventSegmentAdjusting;r!=n.segments.length&&this._svg&&(ej.datavisualization.Diagram.Util._updateConnectorSegments(n,n.sourcePort,n.targetPort,this),ej.datavisualization.Diagram.DiagramContext._refreshSegments(n,this));this.selectionList[0]==n&&(i||u!=n.segments[0].points.length||f!=n.segments[n.segments.length-1].points.length)&&ej.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.selectionList[0],this._adornerSvg,this._currZoom);this._updateQuad(n)}},_updateChildAdjacentConnectors:function(n,t){var u=this._getChildTable(n,{}),r,i;for(r in u)i=this.nameTable[r],i&&i.segments&&n.children.indexOf(r)==-1&&(t||(i._staticLength=!0),this._dock(i,this.nameTable),delete i._staticLength,ej.datavisualization.Diagram.DiagramContext.update(i,this))},_setEndPoint:function(n,t,i){ej.datavisualization.Diagram.Util._setLineEndPoint(n,t,i);this._updateQuad(n)},_updateAssociatedConnectorEnds:function(n,t){var r,f,i,s,u,o,e;if(n.inEdges.length||n.outEdges.length){for(s=this._isNodeToNodeConnection(n),u=n,n.type=="bpmn"&&n._type=="group"&&(u=typeof n.children[0]=="object"?n.children[0]:this.nameTable[n.children[0]]),s&&(o=ej.datavisualization.Diagram.Util._findSegmentPoints(u)),e={},this._parentNode&&(e=this._getChildTable(this._parentNode,{})),r=0,f=n.inEdges.length;r<f;r++)i=t[n.inEdges[r]],!i||this._parentNode&&e[i.sourceNode]||(i.targetPadding?delete u._segmentPoints:u._segmentPoints=o,this._dock(i,t));for(r=0,f=n.outEdges.length;r<f;r++)i=t[n.outEdges[r]],!i||this._parentNode&&e[i.targetNode]||(i.sourcePadding?delete u._segmentPoints:u._segmentPoints=o,this._dock(i,t));delete u._segmentPoints}},_isNodeToNodeConnection:function(n){var t,i;if(n.inEdges.length)for(t=0,i=n.inEdges.length;t<i;t++)if(this.nameTable[n.inEdges[t]]&&!this.nameTable[n.inEdges[t]].targetPort&&(n.type!="bpmn"||this.nameTable[n.inEdges[t]].segments[0].type!="orthogonal"))return!0;if(n.outEdges.length)for(t=0,i=n.outEdges.length;t<i;t++)if(this.nameTable[n.outEdges[t]]&&!this.nameTable[n.outEdges[t]].sourcePort&&(n.type!="bpmn"||this.nameTable[n.outEdges[t]].segments[this.nameTable[n.outEdges[t]].segments.length-1].type!="orthogonal"))return!0},_updateChildBounds:function(n,t){var r,u,i,f,e,o,s;n.width==0&&n.height==0?(r=n.offsetX,u=n.offsetY,ej.datavisualization.Diagram.Util._updateGroupBounds(n,this),this._translate(n,r-n.offsetX,u-n.offsetY,t)):(r=n.offsetX,u=n.offsetY,i=ej.datavisualization.Diagram.Util._getChildrenBounds(n,this),n.offsetX=i.x+i.width*n.pivot.x,n.offsetY=i.y+i.height*n.pivot.y,f=r-n.offsetX,e=r-n.offsetY,this._translate(n,f,e,t),o=n.width/i.width,s=n.height/i.height,this._scale(n,o,s,n.pivot,t),this._translate(n,r-n.offsetX,u-n.offsetY,t))},_updateQuad:function(n){var r,t,i;this._spatialSearch&&this.nameTable[n.name]&&(r=this.getObjectType(n),t=!1,(n.isPhase||n.isLane||n._isHeader||n.isLaneStack||n.isPhaseStack||n.type=="pseudoGroup")&&(t=!0),n.parent&&this.nameTable[n.parent]&&(i=this.nameTable[n.parent],(i.type=="bpmn"||i.isPhaseStack||i.isSwimlane)&&(t=!0),i.type!="bpmn"&&this._updateQuad(i)),this._selectedSymbol!=null&&this._selectedSymbol.isLane&&n.isLane&&!n.parent&&(t=!1),this._disableUpdateQuad&&(t=!0),t||n._connectorType||ej.datavisualization.Diagram.SpatialUtil._updateQuad(this,this._spatialSearch,n))},_sliceDockLines:function(n){var i=$.extend({},n),t=null;for(var r in i)t=this.nameTable[this._getChild(i[r])],t&&t.segments&&(t.sourceNode||t.targetNode)&&n.pop(t.name)},_canExecute:function(){return this._isEditing&&(this._currentCommand=="delete"||this._currentCommand=="cut"||this._currentCommand=="focusToPreviousItem"||this._currentCommand=="undo"||this._currentCommand=="redo"||this._currentCommand=="focusToNextItem"||this._currentCommand=="selectFocusedItem"||this._currentCommand=="selectAll"||this._currentCommand=="copy"||this._currentCommand=="paste"||this._currentCommand.match("nudge"))?!1:this._currentCommand=="endEdit"&&!this._isEditing?!1:!0},_setItemDraggable:function(n){var t=this,i=!1;this._canDragGlobally=!0;$(n).ejDraggable({clone:!0,helper:function(){var u,n,f,i,r;return this._selectedSymbol=null,this._isDragged=!1,u=t._renderItemContainer("diagram_clone",document.body),u.document.setAttribute("drag","true"),t.activeTool&&t.activeTool.selectedObject&&!t.activeTool.helper&&(n=$.extend(!0,{},t.activeTool.selectedObject),t._updateChildren(n),t.edgeTable={},t.edgeTable=t._getEdgeTable(n,t.edgeTable),this._updateSelectedItem(n,n.isSwimlane),this._selectedSymbol=n,this._isDragged=!1,this._targetId=t._id,f=ej.datavisualization.Diagram.Util.bounds(n),this.cursorAt={top:105,left:105},i=ej.datavisualization.Diagram.NodeType({offsetX:n.offsetX,offsetY:n.offsetY,width:100,height:100,shape:"path",opacity:.5,pathData:"M49.955,50.7915L1.74601,99L98.164,99zM1,1.83699L1,98.332L49.2477,50.0843zM99,1.74699L50.662,50.0845L99,98.422zM1.57701,1L49.9548,49.3773L98.332,1zM0,0L100,0L100,100L0,100z "},t),i=t._getNewNode(i),ej.datavisualization.Diagram.SvgContext.renderNode(i,u,null,!0,t)),r=document.getElementById("diagram_clone_paletteItem"),$(r).addClass("dragClone"),$(r).css("display","none"),$(r)},drag:function(n){var l=$(n.target).parents(".e-datavisualization-diagram"),s,e,h,t,f,r;if(l.length){if(t=$("#"+l.attr("id")).ejDiagram("instance"),(this.model._isDragged||this.model._targetId!=t._id)&&this.model._selectedSymbol){this.model._isDragged||this.model._targetId==t._id?this.model._targetId!=t._id&&(t.edgeTable&&delete t.edgeTable,i=!1):(s=$("#"+this.model._targetId).ejDiagram("instance"),s._delete(s.nameTable[this.model._selectedSymbol.name]),i=!1,f=s._historyList.currentEntry,r=f.previous,f.object=r.undoObject.node,r.undoObject.childTable&&(f.childTable=r.undoObject.childTable),r.undoObject.edgeTable&&(f.edgeTable=r.undoObject.edgeTable),s.removeHistoryEntry(r));this.model._isDragged=!0;t._selectedSymbol=this.model._selectedSymbol;t._isNodeEnters=!0;var u=t._selectedSymbol,o=t._currZoom,a=$("#"+t.element[0].id).offset(),c=t._isTouchEvent(n.event),v=((c?c.pageX:n.event.pageX)+t._hScrollOffset-a.left)/o,y=((c?c.pageY:n.event.pageY)+t._vScrollOffset-a.top)/o;if(u.segments?this.model._translate(u,v-(u.sourcePoint.x+u.targetPoint.x)/2*o,y-(u.sourcePoint.y+u.targetPoint.y)/2*o):this.model._translate(u,v-u.offsetX/o,y-u.offsetY/o),this.model._isDragged&&t.edgeTable&&t.nameTable[u.name]&&!i&&u.type!="pseudoGroup"){for(e in t.edgeTable)t.nameTable[e]?(h=t.nameTable[e],h.sourceNode=t.edgeTable[e].sourceNode,h.sourcePort=t.edgeTable[e].sourcePort,h.targetNode=t.edgeTable[e].targetNode,h.targetPort=t.edgeTable[e].targetPort):t.add(t.edgeTable[e]);t._clearSelection(!0);t._addSelection(t.nameTable[u.name],!0);i=!0}}this.helper.css("display","none")}else this.model._selectedSymbol&&(t=$("#"+this.model._targetId).ejDiagram("instance"),t._delete(t.nameTable[this.model._selectedSymbol.name]),i=!1,this.model._isDragged||(f=t._historyList.currentEntry,r=f.previous,f.object=r.undoObject.node,r.undoObject.childTable&&(f.childTable=r.undoObject.childTable),r.undoObject.edgeTable&&(f.edgeTable=r.undoObject.edgeTable),t.removeHistoryEntry(r)),this.helper.css("display","block"),this.model._isDragged=!0);$("html,body").css("cursor","no-drop")},dragStop:function(n){var u=$(n.target).parents(".e-datavisualization-diagram"),i,r,t;u&&(i=$("#"+u.attr("id")).ejDiagram("instance"),this.model._isDragged&&this.model._targetId==i._id&&(r=i._historyList.currentEntry,t=r.previous,r.undoObject.node=t.object,t.childTable&&(r.undoObject.childTable=t.childTable),t.edgeTable&&(r.undoObject.edgeTable=t.edgeTable),i.removeHistoryEntry(t)),i._selectedSymbol=null,delete i._isNodeEnters);$(this.helper).remove();$("html,body").css("cursor","default")},_translate:function(n,t,i){if(n.segments)ej.datavisualization.Diagram.Util._translateLine(n,t,i,n);else if(n.offsetX+=t,n.offsetY+=i,n.type=="pseudoGroup"||n.type=="group")for(var r=0;r<n.children.length;r++)this._translate(n.children[r],t,i)},_updateSelectedItem:function(n,i){var r,u;if(n.type=="pseudoGroup"||n.type=="group")for(r=0;r<n.children.length;r++)typeof n.children[r]=="string"&&(n.children[r]=t.nameTable[n.children[r]]),this._updateSelectedItem(n.children[r],i);if(!i)if(n.segments)n.sourceNode=n.targetNode=n.sourcePort=n.targetPort="";else{for(r=0;r<n.inEdges.length;r++)u=t.findNode(n.inEdges[r]),t.model.selectedItems.children.indexOf(u)==-1&&n.inEdges.splice(r,1);for(r=0;r<n.outEdges.length;r++)u=t.findNode(n.outEdges[r]),t.model.selectedItems.children.indexOf(u)==-1&&n.outEdges.splice(r,1)}}})},_renderItemContainer:function(n,t){var r=document.createElement("div"),i={width:100,height:100},u={id:n+"_paletteItem",draggable:"true",height:i.height+"px",width:i.width+"px",style:"padding: 4; height:"+(i.height+1)+"px;width:"+(i.width+1)+"px;-ms-touch-action: none;touch-action: none;"};return ej.datavisualization.Diagram.Util.attr(r,u),t.appendChild(r),this._setItemDraggable(r),this._renderAnchor(r,n,i)},_renderAnchor:function(n,t,i){var r=document.createElement("div"),u={id:t+"_anchor",height:i.height+"px","class":"e-anchor"};return ej.datavisualization.Diagram.Util.attr(r,u),n.appendChild(r),this._renderSvg(r,t,i)},_renderSvg:function(n,t,i){var r=document.createElement("div"),u={id:t+"_svgWrapper","class":"e-svg-container",style:"width:"+i.width+"px;height:"+i.height+"px;"},f;return ej.datavisualization.Diagram.Util.attr(r,u),u={id:t+"_svg",width:i.width,height:i.height,version:"1.1",xlink:"http://www.w3.org/1999/xlink"},f=new ej.datavisualization.Diagram.Svg(u),r.appendChild(f.document),n.appendChild(r),f}});ej.datavisualization.Diagram.Locale={};ej.datavisualization.Diagram.Locale["default"]={cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"Select All",grouping:"Grouping",group:"Group",ungroup:"Ungroup",order:"Order",bringToFront:"Bring To Front",moveForward:"Move Forward",sendBackward:"Send Backward",sendToBack:"Send To Back"};ej.datavisualization.Diagram.Locale["en-US"]={cut:"Cut",copy:"Copy",paste:"Paste",undo:"Undo",redo:"Redo",selectAll:"Select All",grouping:"Grouping",group:"Group",ungroup:"Ungroup",order:"Order",bringToFront:"Bring To Front",moveForward:"Move Forward",sendBackward:"Send Backward",sendToBack:"Send To Back"};$.fn.pinchDiagram=function(n,t){var i=[],f=function(n){var u=n.touches,t,f,e,r,o,s;if(u.length>=2)for(t=0;t<u.length;t++){for(f=u[t],e=!1,r=0;r<i.length;r++)if(o=i[r],f.identifier===o.identifier){e=!0;break}e||(s=$.extend({},f),i.push(s))}n.preventDefault()},r=function(n,t){var i=t.pageX-n.pageX,r=t.pageY-n.pageY;return Math.sqrt(i*i+r*r)},e=function(n){for(var e,t,u,o,f=n.changedTouches,r=0;r<f.length;r++)for(e=f[r],t=0;t<i.length;t++)u=i[t],u.identifier===e.identifier&&(o=i.indexOf(u),i.splice(o,1));n.preventDefault()},u=function(n,t){n.pageX=t.pageX;n.pageY=t.pageY},o=function(n){var f,e,l;if(n.preventDefault(),f=n.touches,f.length>=2){var o=f[0],s=f[1],h=i[0],c=i[1];e=r(o,s)/r(h,c);l=t._mousePosition(n,!1);ej.datavisualization.Diagram.ZoomUtil.zoomPan(t,e,0,0,l,!0,!0);u(h,o);u(c,s)}};this[0].addEventListener("touchstart",f,!1);this[0].addEventListener("touchend",e,!1);this[0].addEventListener("touchmove",o,!1)}})(jQuery,Syncfusion),function(n,t){"use strict";t.MatrixTypes={Identity:0,Translation:1,Scaling:2,Unknown:4};t.MatrixDefaults={m11:1,m12:0,m21:0,m22:1,offsetX:0,offsetY:0,type:t.MatrixTypes.Identity};t.Matrix={identity:function(){return n.extend(!0,{},t.MatrixDefaults)},multiply:function(n,i){var u=n.type,f=i.type,e,r,o,s;if(f!=t.MatrixTypes.Identity){if(u==t.MatrixTypes.Identity){n.m11=i.m11;n.m12=i.m12;n.m21=i.m21;n.m22=i.m22;n.offsetX=i.offsetX;n.offsetY=i.offsetY;n.type=i.type;return}if(f==t.MatrixTypes.Translation){n.offsetX+=i.offsetX;n.offsetY+=i.offsetY;u!=t.MatrixTypes.Unknown&&(n.type|=t.MatrixTypes.Translation);return}if(u!=t.MatrixTypes.Translation){e=u<<4|f;switch(e){case 34:n.m11*=i.m11;n.m22*=i.m22;return;case 35:n.m11*=i.m11;n.m22*=i.m22;n.offsetX=i.offsetX;n.offsetY=i.offsetY;n.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling;return;case 36:break;default:switch(e){case 50:n.m11*=i.m11;n.m22*=i.m22;n.offsetX*=i.m11;n.offsetY*=i.m22;return;case 51:n.m11*=i.m11;n.m22*=i.m22;n.offsetX=i.m11*n.offsetX+i.offsetX;n.offsetY=i.m22*n.offsetY+i.offsetY;return;case 52:break;default:switch(e){case 66:case 67:case 68:break;default:return}}}r=this.identity();this._setMatrix(r,n.m11*i.m11+n.m12*i.m21,n.m11*i.m12+n.m12*i.m22,n.m21*i.m11+n.m22*i.m21,n.m21*i.m12+n.m22*i.m22,n.offsetX*i.m11+n.offsetY*i.m21+i.offsetX,n.offsetX*i.m12+n.offsetY*i.m22+i.offsetY);r.m21||r.m12?r.type=t.MatrixTypes.Unknown:((r.m11&&r.m11!=1||r.m22&&r.m22!=1)&&(r.type=t.MatrixTypes.Scaling),(r.offsetX||r.offsetY)&&(r.type|=t.MatrixTypes.Translation),(r.type&(t.MatrixTypes.Translation|t.MatrixTypes.Scaling))==t.MatrixTypes.Identity&&(r.type=t.MatrixTypes.Identity));n.m11=r.m11;n.m12=r.m12;n.m21=r.m21;n.m22=r.m22;n.offsetX=r.offsetX;n.offsetY=r.offsetY;n.type=r.type;return}if(o=n.offsetX,s=n.offsetY,n.m11=i.m11,n.m12=i.m12,n.m21=i.m21,n.m22=i.m22,n.offsetX=i.offsetX,n.offsetY=i.offsetY,n.type=i.type,n.offsetX=o*i.m11+s*i.m21+i.offsetX,n.offsetY=o*i.m12+s*i.m22+i.offsetY,f==t.MatrixTypes.Unknown){n.type=t.MatrixTypes.Unknown;return}n.type=t.MatrixTypes.Translation|t.MatrixTypes.Scaling}},transform:function(n,t){var i=this._multiplyPoint(n,t.x,t.y);return{x:Math.round(i.x*100)/100,y:Math.round(i.y*100)/100}},rotate:function(n,t,i,r){t%=360;this.multiply(n,this._createRotationRadians(t*.017453292519943295,i?i:0,r?r:0))},scale:function(n,t,i,r,u){this.multiply(n,this._createScaling(t,i,r?r:0,u?u:0))},translate:function(n,i,r){if(n.type&t.MatrixTypes.Identity){this._setMatrix(n,1,0,0,1,i,r,t.MatrixTypes.Translation);return}if(n.type&t.MatrixTypes.Unknown){n.offsetX+=i;n.offsetY+=r;return}n.offsetX+=i;n.offsetY+=r;n.type|=t.MatrixTypes.Translation},_createScaling:function(n,i,r,u){var f=this.identity();return this._setMatrix(f,n,0,0,i,r-n*r,u-i*u,(r||u)?t.MatrixTypes.Scaling|t.MatrixTypes.Translation:t.MatrixTypes.Scaling),f},_createRotationRadians:function(n,i,r){var e=this.identity(),u=Math.sin(n),f=Math.cos(n),o=i*(1-f)+r*u,s=r*(1-f)-i*u;return this._setMatrix(e,f,u,-u,f,o,s,t.MatrixTypes.Unknown),e},_multiplyPoint:function(n,i,r){switch(n.type){case t.MatrixTypes.Identity:break;case t.MatrixTypes.Translation:i+=n.offsetX;r+=n.offsetY;break;case t.MatrixTypes.Scaling:i*=n.m11;r*=n.m22;break;case t.MatrixTypes.Translation|t.MatrixTypes.Scaling:i*=n.m11;i+=n.offsetX;r*=n.m22;r+=n.offsetY;break;default:var u=r*n.m21+n.offsetX,f=i*n.m12+n.offsetY;i*=n.m11;i+=u;r*=n.m22;r+=f}return{x:i,y:r}},_setMatrix:function(n,i,r,u,f,e,o,s){n.m11=i;n.m12=r;n.m21=u;n.m22=f;n.offsetX=e;n.offsetY=o;n.type=s||t.MatrixTypes.Identity}}}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.HitTesting={_getResizeHandleCenter:function(n,i,r){var f,u;r||(r=1);f=this.bounds(n);u=t.datavisualization.Diagram.Point(0,0);switch(i){case"topleft":u=f.topLeft;break;case"topcenter":u=f.top;break;case"topright":u=f.topRight;break;case"middleleft":u=f.left;break;case"middleright":u=f.right;break;case"bottomleft":u=f.bottomLeft;break;case"bottomcenter":u=f.bottom;break;case"bottomright":u=f.bottomRight;break;case"pivot":u=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY);break;case"rotate":var o=20/r,s=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY-n.height*n.pivot.y-10-o),e=t.Matrix.identity();t.Matrix.rotate(e,n.rotateAngle,n.offsetX,n.offsetY);u=t.Matrix.transform(e,s)}return u},findResizeHandleAtPoint:function(n,i){var e=null,u,o,f,r,s;if(n)for(f=["topleft","topcenter","topright","middleleft","middleright","bottomleft","bottomcenter","bottomright"],r=0,s=f.length;r<s;r++)if(u=this._getResizeHandleCenter(n,f[r]),u!==t.datavisualization.Diagram.Point(0,0)&&(o=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),o)){e=f[r];break}return e},findRotationHandleAtPoint:function(n,i,r){var u=this._getResizeHandleCenter(n,"rotate",r),f=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),10);return f?!0:!1},findPivotHandleAtPoint:function(n,i){var r=this._getResizeHandleCenter(n,"pivot"),u=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(r.x,r.y),7);return u?!0:!1},findEndPointHandleAtPoint:function(n,i){var f=null,r,e,u,o;return n&&(e=n.line.points,u=e[e.length-1],r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="targetEndPoint"),r||(u=e[0],r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="sourceEndPoint")),r||n.line.type!=="bezier"||(u=n.line._point1,r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(u.x,u.y),7),r&&(f="bezierpoint1"),r||(o=n.line._point2,r=t.datavisualization.Diagram.Geometry.checkPointOnCircle(i,t.datavisualization.Diagram.Point(o.x,o.y),7),r&&(f="bezierpoint2")))),f}};t.datavisualization.Diagram.LayoutUtil={expandSubTree:function(n,i,r,u,f,e,o){var h,s,c;n._isAnimating||(h=i.offsetX-n.model.scrollSettings.viewPortWidth/2-n.model.scrollSettings.horizontalOffset,(i.offsetY<n.model.scrollSettings.verticalOffset||i.offsetY>n.model.scrollSettings.verticalOffset+n.model.scrollSettings.viewPortHeight-3*i.height)&&n.update({scrollSettings:{verticalOffset:i.offsetY-n.model.scrollSettings.viewPortHeight/2}}),s=0,h!=0&&e?(n._preventScrollerUpdate=!0,c=setInterval(function(){s<4&&n.update({scrollSettings:{horizontalOffset:n.model.scrollSettings.horizontalOffset+h/4}});s++;s==5&&(clearInterval(c),delete n._preventScrollerUpdate,(o!==!1||!i.isExpanded)&&i.outEdges.length?t.datavisualization.Diagram.LayoutUtil.expand(n,i,r,u,f):t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(n))},25)):(delete n._preventScrollerUpdate,(o!==!1||!i.isExpanded)&&i.outEdges.length?this.expand(n,i,r,u,f):t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(n)))},_updateVisiblity:function(n,i,r){for(var u,f,e=0;e<i.outEdges.length;e++)u=i.outEdges[e],u=n.findNode(u),f=n.findNode(u.targetNode),u.opacity=f.opacity=r/100,t.datavisualization.Diagram.DiagramContext.updateNodeStyle(f,n),t.datavisualization.Diagram.DiagramContext.updateConnectorStyle(u,n),f.isExpanded&&f.outEdges.length&&this._updateVisiblity(n,f,r)},expand:function(i,r,u,f,e){var v,s,h,o,y,l,c,a,p;if(u===undefined&&(u=r.name),v=i.model.layout.fixedNode,i.model.layout.fixedNode=u,s=i.selectionList[0]?i.selectionList[0].name:"",s&&i._clearSelection(!0),f){if(!i._isAnimating){if(r._updateExpander=!0,i._updateEdgeCollection(),r.isExpanded?(i._collapseChildren(r),r.isExpanded=!1):(i._expandChildren(r),r.isExpanded=!0),i._isAnimating=!0,h=t.datavisualization.Diagram.Layout.doLayout(i,!1),o=0,h.length)n(".ej-d-connector").attr("opacity",0),n(".ej-d-icon-template").attr("opacity",0),i._layoutInAction=!0,y=setInterval(function(){var r,f,c;if(o++,o<5)for(r=0;r<h.length;r++)f=i.nameTable[h[r].object],i._disableSegmentChange=!0,i.updateNode(f.name,{offsetX:f.offsetX+h[r].diff/4,offsetY:f.offsetY+h[r].diffy/4}),i._disableSegmentChange=!1;if(o==5){for(clearInterval(y),delete i._layoutInAction,c=i._internalLayout,o=0;o<c._firstLevelNodes.length;o++)t.datavisualization.Diagram.HierarchicalLayout._updateConnectors(c,c._firstLevelNodes[o],1);delete i._internalLayout;n(".ej-d-connector").attr("opacity",1);n(".ej-d-icon-template").attr("opacity",1);(s||e)&&i._addSelection(i.findNode(s||u),!e);i._isAnimating=!1;delete i._preventScrollerUpdate;t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(i)}},50);else{for(l=i._internalLayout,o=0;o<l._firstLevelNodes.length;o++)t.datavisualization.Diagram.HierarchicalLayout._updateConnectors(l,l._firstLevelNodes[o],1);(s||e)&&i._addSelection(i.findNode(s||u),!e);i._isAnimating=!1;delete i._internalLayout}c=0;a=this;r.isExpanded&&(a._updateVisiblity(i,r,0),p=setInterval(function(){r.isExpanded&&(c<=100&&a._updateVisiblity(i,r,c),c==120&&clearInterval(p),c+=5)},25));t.datavisualization.Diagram.PageUtil._updatePageSize(i)}}else i.layout();i.model.layout.fixedNode=v}};t.datavisualization.Diagram.Util={convertPathToArray:function(n){var u=[],e=this.parsePathData(n),f,i,r,t;if(e.length>0)for(f=0;f<e.length;f++){i=e[f];r=i[0];switch(r.toLowerCase()){case"m":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x:i[t],y:i[t+1]}),t=t+1,r==="m"?r="l":r==="M"&&(r="L");break;case"l":case"t":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x:i[t],y:i[t+1]}),t=t+1;break;case"h":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x:i[t]});break;case"v":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,y:i[t]});break;case"z":u.push({pathSegTypeAsLetter:r});break;case"c":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x1:i[t],y1:i[t+1],x2:i[t+2],y2:i[t+3],x:i[t+4],y:i[t+5]}),t=t+5;break;case"s":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x2:i[t],y2:i[t+1],x:i[t+2],y:i[t+3]}),t=t+3;break;case"q":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,x1:i[t],y1:i[t+1],x:i[t+2],y:i[t+3]}),t=t+3;break;case"a":for(t=1;t<i.length;t++)u.push({pathSegTypeAsLetter:r,r1:i[t],r2:i[t+1],angle:i[t+2],largeArcFlag:this.parseArcFlag(i[t+3]),sweepFlag:this.parseArcFlag(i[t+4]),x:i[t+5],y:i[t+6]}),t=t+6}}return u},_getImageAlignment:function(n){if(n)switch(n.toLowerCase()){case"xminymin":return"xMinYMin";case"xminymid":return"xMinYMid";case"xminymax":return"xMinYMax";case"xmidymin":return"xMidYMin";case"xmidymid":return"xMidYMid";case"xmidymax":return"xMidYMax";case"xmaxymin":return"xMaxYMin";case"xmaxymid":return"xMaxYMid";case"xmaxymax":return"xMaxYMax";case"none":return"none"}return"none"},parseArcFlag:function(n){var t;return n==="0"||n===0?t=!1:(n==="1"||n===1)&&(t=!0),t},parsePathData:function(n){var f=/([a-z]+)|([+-]?(?:\d+\.?\d*|\.\d+))/gi,i,t,r=[],u,e;for(f.lastIndex=0,u=!1;i=f.exec(n);)i[1]==="e"?(e="",u=!0):i[1]?(i[1].toLowerCase()==="zm"?(t&&r.push(t),r.push(["Z"]),t=[i[1].substring(1,2)]):(t&&r.push(t),t=[i[1]]),u=!1):(t||(t=[]),u||t.push(Number(i[2])),u=!1);return t&&r.push(t),r},pathSegArrayAsString:function(n){for(var i,r="",t=0;t<n.length;t++)i=n[t],r+=t===0?this.pathToString(i):" "+this.pathToString(i);return r},canEnablePointerEvents:function(n,i){var r=n,u;if(i)while(r){if(u=r.segments?r.constraints&t.datavisualization.Diagram.ConnectorConstraints.PointerEvents:r.constraints&t.datavisualization.Diagram.NodeConstraints.PointerEvents,!u)return u;r=typeof r.parent=="string"?i.nameTable[r.parent]:r}return!0},isClassifier:function(t){var i=typeof t.target.className=="string"?t.target.className:t.target.className.baseVal;return n(t.target).hasClass("ej-d-classifier")||i.indexOf("ej-d-classifier")>-1?!0:!1},pathToString:function(n){var t;switch(n.pathSegTypeAsLetter){case"Z":case"z":t=n.pathSegTypeAsLetter;break;case"M":case"m":case"L":case"l":t=n.pathSegTypeAsLetter+" "+n.x+" "+n.y;break;case"C":case"c":t=n.pathSegTypeAsLetter+" "+n.x1+" "+n.y1+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;break;case"Q":case"q":t=n.pathSegTypeAsLetter+" "+n.x1+" "+n.y1+" "+n.x+" "+n.y;break;case"A":case"a":t=n.pathSegTypeAsLetter+" "+n.r1+" "+n.r2+" "+n.angle+" "+(n.largeArcFlag?"1":"0")+" "+(n.sweepFlag?"1":"0")+" "+n.x+" "+n.y;break;case"H":case"h":t=n.pathSegTypeAsLetter+" "+n.x;break;case"V":case"v":t=n.pathSegTypeAsLetter+" "+n.y;break;case"S":case"s":t=n.pathSegTypeAsLetter+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;break;case"T":case"t":t=n.pathSegTypeAsLetter+" "+n.x+" "+n.y}return t},findPortByName:function(n,t){var r,i,u;if(n&&n.ports)for(i=0,u=n.ports.length;i<u;i++)if(r=n.ports[i],r.name===t)return r;return null},attr:function(n,t){for(var i in t)n.setAttribute(i.toString(),t[i])},removeChildFromGroup:function(n,t){var i=n.indexOf(t),r;if(i<0)for(r in n)if(typeof n[r]=="object"&&typeof t=="string"&&n[r].name===t){i=r;break}i>=0&&n.splice(i,1)},removeItem:function(n,t){var i=n.indexOf(t);i>=0&&n.splice(i,1)},clear:function(n){while(n.length>0)n.pop()},getChild:function(n){if(n)return typeof n=="object"?n.name:n},randomId:function(){for(var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",r="",u=0;u<4;u++)n=t.getRandomValue(0,i.length-1),r+=i.substring(n,n+1);return r},htmlEncode:function(n){return n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},canMove:function(n){if(this.canSelect(n))return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Drag:n.constraints&t.datavisualization.Diagram.NodeConstraints.Drag},canMoveLabel:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragLabel:n.constraints&t.datavisualization.Diagram.NodeConstraints.DragLabel},canRotate:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Rotate:n.constraints&t.datavisualization.Diagram.NodeConstraints.Rotate},canShowTooltip:function(n,i){var r;return(r=n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.InheritTooltip:n.constraints&t.datavisualization.Diagram.NodeConstraints.InheritTooltip,r)?i.model.tooltip:n.tooltip},canSelect:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Select:n.constraints&t.datavisualization.Diagram.NodeConstraints.Select},canBridge:function(n,i){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Bridging?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Bridging:n.constraints&t.datavisualization.Diagram.ConnectorConstraints.InheritBridging?i.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Bridging:void 0},canAllowPan:function(n){return n.constraints&t.datavisualization.Diagram.NodeConstraints.AllowPan},canAllowDrop:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.AllowDrop:n.constraints&t.datavisualization.Diagram.NodeConstraints.AllowDrop},canDelete:function(n){return n.segments?n.constraints&t.datavisualization.Diagram.ConnectorConstraints.Delete:n.constraints&t.datavisualization.Diagram.NodeConstraints.Delete},isPageEditable:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.UserInteraction},canFloatElements:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.FloatElements},canEnableAPIMethods:function(n){if(n&&n._enableAPIMethods)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.APIUpdate},canDoMultipleSelection:function(n){if(n&&this.isPageEditable(n))return n.tool()&t.datavisualization.Diagram.Tool.MultipleSelect},canDoSingleSelection:function(n){if(n&&this.isPageEditable(n))return n.tool()&t.datavisualization.Diagram.Tool.SingleSelect},canMoveOutofBoundary:function(n){return n.model.pageSettings.boundaryConstraints!="infinity"?!0:!1},_getPseudoGroupConstraints:function(i,r,u){var f,e,o,h,s;if(u&&u.type==="pseudoGroup")if((u.children.indexOf(r.name)>=0||r.name===u.name)&&i.model.selectedItems.getConstraints&&(e=i.model.selectedItems.getConstraints,typeof e=="string"&&(e=t.util.getObject(e,window))),e&&n.isFunction(e))f=e();else if(u.children)for(f=t.datavisualization.Diagram.NodeConstraints.Default,o=0;o<u.children.length;o++)h=i.nameTable[i._getChild(u.children[o])],s=h.constraints,s&t.datavisualization.Diagram.NodeConstraints.Resize||(f=f&~t.datavisualization.Diagram.NodeConstraints.Resize),s&t.datavisualization.Diagram.NodeConstraints.Rotate||(f=f&~t.datavisualization.Diagram.NodeConstraints.Rotate),s&t.datavisualization.Diagram.NodeConstraints.Drag||(f=f&~t.datavisualization.Diagram.NodeConstraints.Drag);return f},canPanning:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableX||n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableY},canZooming:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Zoomable},canUndo:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.Undoable},canZoomTextEditor:function(n){if(n)return n.model.constraints&t.datavisualization.Diagram.DiagramConstraints.ZoomTextEditor},canMultiSelectOnLane:function(n){return n.constraints&t.datavisualization.Diagram.NodeConstraints.MultiSelect},canMultiSelectOnNode:function(n){return n.constraints&t.datavisualization.Diagram.NodeConstraints.PointerEvents},canEnableTooltip:function(n){return n.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.Tooltip?!0:!1},canDragSourceEnd:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragSourceEnd},canDragTargetEnd:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragTargetEnd},canDragSegmentThumbs:function(n){return n.constraints&t.datavisualization.Diagram.ConnectorConstraints.DragSegmentThumb},isTargetConnected:function(n){return n.targetNode?!0:!1},isSourceConnected:function(n){return n.sourceNode?!0:!1},bounds:function(n,i){var r={},o,s,h,c,u,e,f;if(n)if(n.segments)for(o=0;o<n.segments.length;o++)s=n.segments[o],o==0?s.points&&(r=t.datavisualization.Diagram.Geometry.rect(s.points)):r=t.datavisualization.Diagram.Geometry.union(r,t.datavisualization.Diagram.Geometry.rect(s.points)),r.width==0&&(r.width=n.lineWidth,r.x-=n.lineWidth/2),r.height==0&&(r.height=n.lineWidth,r.y-=n.lineWidth/2);else n._type=="node"||n._type==="group"||n.type=="umlclassifier"||n._type=="pseudoGroup"?(h=n.width?n.width:n._width||0,c=n.height?n.height:n._height||0,r={x:n.offsetX-h*n.pivot.x,y:n.offsetY-c*n.pivot.y,width:h,height:c}):r=n;else r=t.datavisualization.Diagram.Rectangle();return r?(u={},r.x=Math.round(r.x*100)/100,r.y=Math.round(r.y*100)/100,r.width=Math.round(r.width*100)/100,r.height=Math.round(r.height*100)/100,u.width=r.width,u.height=r.height,u.x=u.left=r.x,u.right=r.x+r.width,u.y=u.top=r.y,u.bottom=r.y+r.height,u.center={x:r.x+r.width/2,y:r.y+r.height/2},u.topLeft={x:r.x,y:r.y},u.topCenter={x:r.x+r.width/2,y:r.y},u.topRight={x:r.x+r.width,y:r.y},u.middleLeft={x:r.x,y:r.y+r.height/2},u.middleRight={x:r.x+r.width,y:r.y+r.height/2},u.bottomLeft={x:r.x,y:r.y+r.height},u.bottomCenter={x:r.x+r.width/2,y:r.y+r.height},u.bottomRight={x:r.x+r.width,y:r.y+r.height},n&&n.rotateAngle&&!i&&(e=t.Matrix.identity(),t.Matrix.rotate(e,n.rotateAngle,n.offsetX,n.offsetY),u.topLeft=t.Matrix.transform(e,u.topLeft),u.topCenter=t.Matrix.transform(e,u.topCenter),u.topRight=t.Matrix.transform(e,u.topRight),u.middleLeft=t.Matrix.transform(e,u.middleLeft),u.middleRight=t.Matrix.transform(e,u.middleRight),u.bottomLeft=t.Matrix.transform(e,u.bottomLeft),u.bottomCenter=t.Matrix.transform(e,u.bottomCenter),u.bottomRight=t.Matrix.transform(e,u.bottomRight),f=t.datavisualization.Diagram.Geometry.rect([u.topLeft,u.topRight,u.bottomRight,u.bottomLeft]),u.x=u.left=f.x,u.y=u.top=f.y,u.right=f.x+f.width,u.bottom=f.y+f.height,u.center=t.datavisualization.Diagram.Point(f.x+f.width/2,f.y+f.height/2)),u.points=[u.topLeft,u.topRight,u.bottomRight,u.bottomLeft],u):r},_swapBounds:function(n,i){var n,i,u,r;return i=i,n.rotateAngle?(n.rotateAngle<45||(n.rotateAngle<=135?(u=t.Matrix.identity(),t.Matrix.rotate(u,n.rotateAngle,n.offsetX,n.offsetY),r=i.topCenter,i.topCenter=i.middleLeft,i.middleLeft=i.bottomCenter,i.bottomCenter=i.middleRight,i.middleRight=r,r=i.topLeft,i.topLeft=i.bottomLeft,i.bottomLeft=i.bottomRight,i.bottomRight=i.topRight,i.topRight=r):n.rotateAngle<=225?(u=t.Matrix.identity(),t.Matrix.rotate(u,n.rotateAngle,n.offsetX,n.offsetY),r=i.topCenter,i.topCenter=i.bottomCenter,i.bottomCenter=r,r=i.middleLeft,i.middleLeft=i.middleRight,i.middleRight=r,r=i.bottomLeft,i.bottomLeft=i.topLeft,i.topLeft=r,r=i.bottomRight,i.bottomRight=i.topRight,i.topRight=r):n.rotateAngle<=315&&(u=t.Matrix.identity(),t.Matrix.rotate(u,n.rotateAngle,n.offsetX,n.offsetY),r=i.topCenter,i.topCenter=i.middleRight,i.middleRight=i.bottomCenter,i.bottomCenter=i.middleLeft,i.middleLeft=r,r=i.topRight,i.topRight=i.bottomRight,i.bottomRight=i.bottomLeft,i.bottomLeft=i.topLeft,i.topLeft=r)),i.points=[i.topLeft,i.topRight,i.bottomRight,i.bottomLeft],i):void 0},canResize:function(n,i){if(i)switch(i){case"n-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorth;case"s-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouth;case"e-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeEast;case"w-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeWest;case"se-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast;case"ne-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast;case"sw-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest;case"nw-resize":return n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest}else return n.constraints&t.datavisualization.Diagram.NodeConstraints.Resize},canConnect:function(n,i){var r=null;return n&&(i?r=n.constraints&t.datavisualization.Diagram.PortConstraints.Connect:n.segments||(r=n.constraints&t.datavisualization.Diagram.NodeConstraints.Connect)),r},_initializeSegments:function(n,i){var u,f,r;if(n.segments&&n.segments.length<=1){n.segments.length||n.segments.push(t.datavisualization.Diagram.Segment({type:i||"straight"}));u=n.segments[0];switch(u.type){case"straight":u.point?(u.point.x!=n.targetPoint.x||u.point.y!=n.targetPoint.y)&&n.segments.push({type:u.type||"straight"}):u._point=n.targetPoint;break;case"orthogonal":u.length&&u.direction?(t.datavisualization.Diagram.Util._addOrthogonalPoints(u,null,null,n.sourcePoint,n.targetPoint),(u._endPoint.x!=n.targetPoint.x||u._endPoint.y!=n.targetPoint.y)&&n.segments.push({type:u.type||"straight"})):(u._length=u.length||20,u._direction=u.direction||"auto");break;case"bezier":u.point?(u.point.x!=n.targetPoint.x||u.point.y!=n.targetPoint.y)&&n.segments.push({type:u.type||"straight"}):u._point=n.targetPoint}}var e=n.sourcePoint,o=null,h=null,s;for(f=0;f<n.segments.length;f++){if(r=n.segments[f],r._startPoint=e,h=n.segments[f+1],r=n.segments[f]=t.datavisualization.Diagram.Segment(n.segments[f]),r.type=="orthogonal"){if(r._direction=r.direction||"auto",r._length=r.length||20,s=t.datavisualization.Diagram.Util._addOrthogonalPoints(n.segments[f],o,h,n.sourcePoint,n.targetPoint,s),e=n.segments[f]._endPoint,!r.length||!r.direction)break}else if(r.type=="straight"){if(r.points.push(e),r.points.push(n.segments[f].point||n.targetPoint),r._point=r._endPoint=n.segments[f].point||n.targetPoint,s=t.datavisualization.Diagram.Geometry.findAngle(e,r._endPoint),e=n.segments[f]._endPoint,!r.point)break}else if(r.type=="bezier"){if(r._point=r._endPoint=n.segments[f].point||n.targetPoint,r.points.push(e),r.points.push(n.segments[f].point||n.targetPoint),s=t.datavisualization.Diagram.Geometry.findAngle(e,r._endPoint),t.datavisualization.Diagram.Util._updateBezierPoints(r),e=n.segments[f]._endPoint,!r.point)break}else{r=t.datavisualization.Diagram.Segment({type:"orthogonal"});r._direction="auto";r._length=20;r._startPoint=e;r._endPoint=n.targetPoint;n.segments.push(r);t.datavisualization.Diagram.Util._addOrthogonalPoints(r,o,null,n.sourcePoint,n.targetPoint,s);break}o=n.segments[f]}(e.x!=n.targetPoint.x||e.y!=n.targetPoint.y)&&(r=t.datavisualization.Diagram.Segment({type:(o?o.type:i)||"straight"}),r._startPoint=e,r._endPoint=n.targetPoint,r.type=="orthogonal"?t.datavisualization.Diagram.Util._addOrthogonalPoints(r,o,null,n.sourcePoint,n.targetPoint,s):(r._point=n.targetPoint,r.points.push(e),r.points.push(n.targetPoint),r.type=="bezier"&&this._updateBezierPoints(r)),n.segments.push(r))},_getDockableBPMNNode:function(n,t,i,r){var u=r?t.segments[t.segments.length-1]:t.segments[0];if(n&&n.type=="bpmn"){if(u.type=="orthogonal")return n;n._type=="group"&&(n=typeof n.children[0]=="object"?n.children[0]:i[n.children[0]])}return n},dock:function(n,t){var i,e=null,r,o=null,s=n._srcDecoratorSize,h=n._tarDecoratorSize,u,f;n.sourcePadding&&(n._srcDecoratorSize+=n.sourcePadding);n.targetPadding&&(n._tarDecoratorSize+=n.targetPadding);i=t[n.targetNode];i&&(e=this.findPortByName(i,n.targetPort));r=t[n.sourceNode];r&&(o=this.findPortByName(r,n.sourcePort));u=this.isSourceConnected(n);f=this.isTargetConnected(n);o?o.connectorPadding&&(n._srcDecoratorSize+=o.connectorPadding):(r=this._getDockableBPMNNode(r,n,t,!1),r&&r.connectorPadding&&(n._srcDecoratorSize+=r.connectorPadding));e?e.connectorPadding&&(n._tarDecoratorSize+=e.connectorPadding):(i=this._getDockableBPMNNode(i,n,t,!0),i&&i.connectorPadding&&(n._tarDecoratorSize+=i.connectorPadding));f&&u&&e&&o?this._dockPortToPort(n,i,e,r,o):f&&e?u?n.segments.length==1?(this._dockNode(n,r,null,f,u),this._dockPortToNode(n,i,e,r,o,!0)):(this._dockNode(n,r,null,f,u),this._updateIntermediateSegments(n),this._dockPortToPoint(n,i,e,!0),this._updatePreviousSegment(n)):(this._dockPortToPoint(n,i,e,!0),this._updatePreviousSegment(n)):u&&o?f?n.segments.length==1?(this._dockNode(n,i,null,f,u),this._dockPortToNode(n,r,o,i,e,!1)):(this._dockPortToPoint(n,r,o,!1),this._updateIntermediateSegments(n),this._dockNode(n,i,null,f,u),this._updatePreviousSegment(n)):(this._dockPortToPoint(n,r,o,!1),this._updateIntermediateSegments(n)):f&&u?i&&r&&this._dockNode(n,i,r,f,u):f?this._dockNode(n,i,null,f,u):u&&this._dockNode(n,r,null,f,u);this._adjustEndPoint(n,r,o,i,e);n._srcDecoratorSize=s;n._tarDecoratorSize=h},_dockPortToPort:function(n,i,r,u,f){var o,s,h;if(n.segments.length==1){i&&(s=this.bounds(i,!0));u&&(h=this.bounds(u,!0));var e,c=n.segments[0],w=n.segments[n.segments.length-1],v=n.segments[0];if(v.type!=="orthogonal")r&&(o=this._getPortPosition(r,s),i.rotateAngle&&(e=t.Matrix.identity(),t.Matrix.rotate(e,i.rotateAngle,i.offsetX,i.offsetY),o=t.Matrix.transform(e,o)),this._setLineEndPoint(n,o,!0)),f&&(o=this._getPortPosition(f,h),u.rotateAngle&&(e=t.Matrix.identity(),t.Matrix.rotate(e,u.rotateAngle,u.offsetX,u.offsetY),o=t.Matrix.transform(e,o)),this._setLineEndPoint(n,o,!1)),v.type==="bezier"&&this._updateBezierPoints(v,i,r,s,u,f,h);else{var l=this._getPortPosition(r,s),a=this._getPortPosition(f,h),y=this._swapDirection(i.rotateAngle,this._getDirection(s,l)),p=this._swapDirection(u.rotateAngle,this._getDirection(h,a));u.rotateAngle&&(e=t.Matrix.identity(),t.Matrix.rotate(e,u.rotateAngle,u.offsetX,u.offsetY),a=t.Matrix.transform(e,a));i.rotateAngle&&(e=t.Matrix.identity(),t.Matrix.rotate(e,i.rotateAngle,i.offsetX,i.offsetY),l=t.Matrix.transform(e,l));this._constructSegements(n,c,s,l,y,h,a,p);this._setLineEndPoint(n,c.points[0],!1);this._setLineEndPoint(n,c.points[c.points.length-1],!0)}}else this._dockPortToPoint(n,u,f,!1),this._updateIntermediateSegments(n),this._dockPortToPoint(n,i,r,!0),this._updatePreviousSegment(n)},_dockPortToNode:function(n,i,r,u,f,e){var p=n.segments[0],w=n.segments[n.segments.length-1],h,l,c,b,a,o,y,s,v;i&&(h=this.bounds(i,!0));u&&(l=this.bounds(u,!0));b=e?w:p;b.type!=="orthogonal"?(a=this._getPortPosition(r,h),c=t.Matrix.identity(),t.Matrix.rotate(c,i.rotateAngle,i.offsetX,i.offsetY),a=t.Matrix.transform(c,a),this._setLineEndPoint(n,a,e)):(o=this._getPortPosition(r,h),y=this._swapDirection(i.rotateAngle,this._getDirection(h,o)),c=t.Matrix.identity(),t.Matrix.rotate(c,i.rotateAngle,i.offsetX,i.offsetY),o=t.Matrix.transform(c,o),s=e?n.sourcePoint:n.targetPoint,v=u?this._getDirection(l,s):"top",v&&(h=this.bounds(i),l=u?this.bounds(u):{left:s.x,right:s.x,top:s.y,bottom:s.y},e?(this._setLineEndPoint(n,o,!0),this._constructSegements(n,w,h,o,y,l,s,v)):(this._setLineEndPoint(n,o,!1),this._constructSegements(n,p,l,s,v,h,o,y))))},_dockPortToPoint:function(n,i,r,u){var s=n.segments[0],h=n.segments[n.segments.length-1],a=u?h:s,o,v,y;if(a.type!=="orthogonal")this._dockPortToNode(n,i,r,null,null,u);else{var e=this.bounds(i,!0),f=this._getPortPosition(r,e),c=this._swapDirection(i.rotateAngle,this._getDirection(e,f)),l=t.Matrix.identity();t.Matrix.rotate(l,i.rotateAngle,i.offsetX,i.offsetY);f=t.Matrix.transform(l,f);o=u?h._startPoint:s._endPoint;v=this.bounds(t.datavisualization.Diagram.Rectangle(o.x,o.y,0,0));e=this.bounds(i);y="top";u?(this._setLineEndPoint(n,f,!0),this._pointsFromNodeToPoint(n,h,c,e,i.rotateAngle,f,o,!0)):(this._setLineEndPoint(n,f,!1),this._pointsFromNodeToPoint(n,s,c,e,i.rotateAngle,f,o,!1))}},_dockNode:function(n,t,i,r,u){var a,v,l=n._srcDecoratorSize+n._tarDecoratorSize,e,f,o,s,h,c,y;n.segments.length==1?a=v=n.segments[0]:(a=n.segments[0],v=n.segments[n.segments.length-1]);r&&u&&!n.targetPort&&!n.sourcePort?n.segments.length==1?n.segments[0].type=="orthogonal"?(e=this.bounds(i),f=this.bounds(t),this._swapBounds(i,e),this._swapBounds(t,f),e.y-l>=f.bottom?(o=e.topCenter,h="top",s=f.bottomCenter,c="bottom"):e.bottom+l<=f.y&&(s=f.topCenter,c="top",o=e.bottomCenter,h="bottom"),e.bottom+l>f.y&&e.y<f.bottom+l&&(e.right+l<f.x||f.right>=e.x-l&&e.x>f.x?(o=e.middleRight,h="right",s=f.middleLeft,c="left"):f.right+l<e.x||e.right>=f.x-l&&e.x<f.x?(o=e.middleLeft,h="left",s=f.middleRight,c="right"):e.x<=f.x?(o=e.middleLeft,h="left",s=f.middleLeft,c="left"):e.x<=f.right?(o=e.middleRight,h="right",s=f.middleRight,c="right"):(o=e.middleLeft,h="left",s=f.middleRight,c="right")),y=this._findEndPoint(h,o,i)||e.center,o=this._findIntersection(i,e,n,o,y,!1)||o,y=this._findEndPoint(c,s,t)||f.center,s=this._findIntersection(t,f,n,s,y,!0)||s,this._setLineEndPoint(n,o,!1),this._setLineEndPoint(n,s,!0),n.segments[0].type=="orthogonal"&&(this._constructSegements(n,n.segments[0],f,n.targetPoint,c,e,n.sourcePoint,h),n.segments[0]._direction=h)):(t&&(f=this.bounds(t),this._swapBounds(t,f),i&&(e=this.bounds(i),this._swapBounds(i,e),this._setLineEndPoint(n,e.center,!1),this._setLineEndPoint(n,f.center,!0),this._dockBounds(n,i,e,!1)),this._setLineEndPoint(n,f.center,!0),this._dockBounds(n,t,f,!0)),n.segments[0].type=="bezier"&&this._updateBezierPoints(n.segments[0])):(this._dock(n,a,i,null,!1),this._updateIntermediateSegments(n),n.segments.length==1?(this._dock(n,a,i,t,!1),this._dock(n,v,t,i,!0)):(this._dock(n,v,t,null,!0),this._updatePreviousSegment(n))):r&&!n.targetPort?(this._dock(n,v,t,i,!0),this._updatePreviousSegment(n)):u&&!n.sourcePort&&(this._dock(n,a,t,i,!1),this._updateIntermediateSegments(n))},_adjustEndPoint:function(n,t,i,r,u){var h,c,l,f,a;if(n.sourcePadding||n.targetPadding||i&&i.connectorPadding||u&&u.connectorPadding){var e=0,o=r?this.bounds(r):null,s=t?this.bounds(t):null;t&&(f=n.segments[0],h=f.type!=="orthogonal"?f.type!=="bezier"?f._endPoint:f._point1:f.points[1],i&&(e=n.sourcePadding+i.connectorPadding),c=this._adjustPoint(f._startPoint,h,!0,e),this._setLineEndPoint(n,c,!1),f.type=="bezier"&&this._updateBezierPoints(f,r,u,o,t,i,s));r&&(f=n.segments[n.segments.length-1],l=f.type!=="orthogonal"?f.type!=="bezier"?f._startPoint:f._point2:f.points[f.points.length-2],u&&(e=n.targetPadding+u.connectorPadding),a=this._adjustPoint(l,f._endPoint,!1,e),this._setLineEndPoint(n,a,!0),f.type=="bezier"&&this._updateBezierPoints(f,r,u,o,t,i,s))}},_findEndPoint:function(n,t,i){var r;switch(n){case"top":r={x:t.x,y:t.y+Math.max(i.width,i.height)};break;case"bottom":r={x:t.x,y:t.y-Math.max(i.width,i.height)};break;case"left":r={y:t.y,x:t.x+Math.max(i.width,i.height)};break;case"right":r={y:t.y,x:t.x-Math.max(i.width,i.height)}}return r},_dock:function(n,i,r,u,f){var o,a,c,s,h,v,e,l,y;if(r)if(a=r,c=f?i._startPoint:i._endPoint,o=this.bounds(r),this._swapBounds(r,o),f)if(i.type=="orthogonal")if(e=n.segments[n.segments.length-2],e&&e.type=="orthogonal")if(i.points.length>2&&t.datavisualization.Diagram.Geometry.containsPoint(o,i.points[i.points.length-2])){if(l=!1,e.direction=="top"||e.direction=="bottom"){if(e._endPoint.x>=o.left&&e._endPoint.x<=o.right){this._removeLastSegment(n,i,e,r,u,f);return}e._length=e.length=Math.abs(e._startPoint.y-o.middleLeft.y);e.length==0?l=!0:(e.length<0&&(e._length=e.length*=-1,e._direction=e.direction=e.direction=="top"?"bottom":"top"),n.targetPoint=e._endPoint.x>o.right?o.middleRight:o.middleLeft)}else{if(e._endPoint.y>=o.top&&e._endPoint.y<=o.bottom){this._removeLastSegment(n,i,e,r,u,f);return}e._length=e.length=Math.abs(e._startPoint.x-o.topCenter.x);e.length==0?l=!0:(e.length<0&&(e._length=e.length*=-1,e._direction=e.direction=e.direction=="left"?"right":"left"),n.targetPoint=e._endPoint.y>o.bottom?o.bottomCenter:o.topCenter)}if(l){n.segments.splice(n.segments.length-2,1);this._dock(n,i,r,u,f);return}n.targetPoint=this._findIntersection(r,o,n,n.targetPoint,o.center,f)||n.targetPoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,e);this._setLineEndPoint(n,n.targetPoint,f)}else if(t.datavisualization.Diagram.Geometry.containsPoint(o,i._startPoint)){if(y=e.direction=="left"||e.direction=="right"?a.width/2:a.height/2,e._length=e.length-=y+30,e.length==0){n.segments.splice(n.segments.length-2,1);this._dock(n,i,r,u,f);return}n.targetPoint=e.direction=="left"||e.direction=="right"?e.direction=="right"?o.middleLeft:o.middleRight:e.direction=="bottom"?o.topCenter:o.bottomCenter;n.targetPoint=this._findIntersection(r,o,n,n.targetPoint,o.center,f)||n.targetPoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);i._direction=this._getOrthoDirection(i._startPoint,i._endPoint,e);this._setLineEndPoint(n,n.targetPoint,f)}else this._dockNodeToPoint(n,c,r,f);else this._dockNodeToPoint(n,c,r,f);else this._dockNodeToPoint(n,c,r,f);else if(i.type=="orthogonal"&&n.segments[1]&&n.segments[1].type=="orthogonal")if(n.segments[0]._isInternal&&t.datavisualization.Diagram.Geometry.containsPoint(o,i._endPoint))this._insertSegmentAtSourceEnd(n,i,o,r,f);else if(t.datavisualization.Diagram.Geometry.containsPoint(o,i._endPoint))this._removeFirstSegment(n,i,o,r,f);else{switch(i.direction){case"left":h="left";s=o.middleLeft;break;case"right":h="right";s=o.middleRight;break;case"top":h="top";s=o.topCenter;break;case"bottom":h="bottom";s=o.bottomCenter}i.points=[];v=this._findEndPoint(h,s,r)||o.center;s=this._findIntersection(r,o,n,s,v,f)||s;i.points.push(s);i.points.push(i._endPoint);this._setLineEndPoint(n,s,f)}else this._dockNodeToPoint(n,i._endPoint,r,f)},_removeLastSegment:function(n,t,i,r,u,f){n.segments.splice(n.segments.length-1,1);i.length=i._length=null;i.direction=null;i._direction=t._direction;this._dock(n,i,r,u,f)},_insertSegmentAtSourceEnd:function(n,t,i,r,u){var f=n.segments[1],e=n.segments[2],s,o;n.segments[0].direction=="left"||n.segments[0].direction=="right"?(s="horizontal",n.sourcePoint=f.direction=="top"?i.topCenter:i.bottomCenter,f&&(f.length||f.length===0)&&(f._length=f.length=Math.max(Math.abs(n.sourcePoint.y-f._endPoint.y),25)),e&&(e.length||e.length===0)&&(e.length=e._length=Math.abs(i.topCenter.x-e._endPoint.x))):(s="vertical",n.sourcePoint=f.direction=="left"?i.middleLeft:i.middleRight,f&&(f.length||f.length===0)&&(f._length=f.length=Math.max(Math.abs(n.sourcePoint.x-f._endPoint.x),25)),e&&(e.length||e.length===0)&&(e.length=e._length=Math.abs(i.middleRight.y-e._endPoint.y)));n.segments[3]&&(n.segments[3].length||n.segments[3].length==0)&&(o=f.direction=="bottom"||f.direction=="right"?f.length:-f.length,n.segments[3].length=n.segments[3]._length=s=="vertical"?Math.abs(n.sourcePoint.x+o-n.segments[3]._endPoint.x):Math.abs(n.sourcePoint.y+o-n.segments[3]._endPoint.y),n.segments[3].length<0&&(o=f.direction=="bottom"||f.direction=="right"?f.length:-f.length,n.segments[3].length=n.segments[3]._length=s=="vertical"?Math.abs(n.sourcePoint.x+o-n.segments[3]._endPoint.x):Math.abs(n.sourcePoint.y+o-n.segments[3]._endPoint.y)));n.segments.splice(0,1);n.sourcePoint=this._findIntersection(r,i,n,n.sourcePoint,i.center,u)||n.sourcePoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);this._setLineEndPoint(n,n.sourcePoint,u)},_removeFirstSegment:function(n,i,r,u,f){var h,c,e=n.segments[1].direction||this._getBezierDirection(n.segments[1].points[0],n.segments[1].points[1]),o,l,s,a;e=="left"||e=="right"?(o=i._endPoint.y-r.middleRight.y,n.segments[0].direction=n.segments[0]._direction=o>=0?"bottom":"top",n.segments[0].length=n.segments[0]._length=Math.abs(o),l=e=="right"?n.segments[1]._endPoint.x-r.right:r.left-n.segments[1]._endPoint.x,n.sourcePoint=e=="left"?r.middleLeft:r.middleRight,h=Math.abs(n.sourcePoint.x-n.segments[0]._startPoint.x),c=Math.abs(n.sourcePoint.y-n.segments[0]._endPoint.y)):((n.segments[0].length||n.segments[0].length==0)&&(o=i._endPoint.x-r.bottomCenter.x,n.segments[0].direction=n.segments[0]._direction=o>=0?"right":"left",n.segments[0].length=n.segments[0]._length=Math.abs(o)),l=e=="bottom"?n.segments[1]._endPoint.y-r.bottom:r.top-n.segments[1]._endPoint.y,n.sourcePoint=e=="top"?r.topCenter:r.bottomCenter,h=Math.abs(n.sourcePoint.y-n.segments[0]._startPoint.y),c=Math.abs(n.sourcePoint.x-n.segments[0]._endPoint.x));n.segments[1]&&(n.segments[1].length||n.segments[1].length===0)&&(n.segments[1]._length=n.segments[1].length=l-25,n.segments[1]._length<0&&(n.segments.splice(0,2),(n.segments[0].length||n.segments[0].length===0)&&(n.segments[0].length=n.segments[0]._length=h),s=t.datavisualization.Diagram.Segment({type:"orthogonal",length:c,direction:e})));s||(s=t.datavisualization.Diagram.Segment({type:"orthogonal",length:25,direction:e}));a=[s];s._isInternal=!0;n.segments=a.concat(n.segments);n.sourcePoint=this._findIntersection(u,r,n,n.sourcePoint,r.center,f)||n.sourcePoint;this._updateConnectorSegments(n,n.sourcePort,n.targetPort);this._setLineEndPoint(n,n.sourcePoint,f)},_dockNodeToPoint:function(n,t,i,r){var l,u,a,f,o,e,s,v,y,k,h;if(l=r?n.segments[n.segments.length-1]:n.segments[0],l.type!="orthogonal")u=this.bounds(i),this._swapBounds(i,u),this._setLineEndPoint(n,u.center,r),this._dockBounds(n,i,u,r);else{if(u=this.bounds(i),this._swapBounds(i,u),s=t,n.segments.length>1){var c=n.segments[n.segments.length-2],d=Math.abs(s.x-u.left),p=Math.abs(s.x-u.right),w=Math.abs(s.y-u.top),b=Math.abs(s.y-u.bottom);c&&r&&(v=c.direction=="left"||c.direction=="right",y=c.direction=="top"||c.direction=="bottom");l=r?n.segments[n.segments.length-1]:n.segments[0];l.points.length!=2&&c||l.type!="orthogonal"||(v=y=!1);u.bottom<s.y&&!v?(o="bottom",e="top",f=u.bottomCenter):u.y>s.y&&!v?(o="top",e="bottom",f=u.topCenter):u.right<s.x&&!y?(o="right",e="left",f=u.middleRight):u.x>s.x&&!y?(o="left",e="right",f=u.middleLeft):(h=d,f=u.middleLeft,o="left",e="right",h>=p&&p!=0&&(f=u.middleRight,o="right",e="left",h=p),h>w&&w!=0&&(f=u.topCenter,o="top",e="bottom",h=w),h>b&&b!=0&&(f=u.bottomCenter,o="bottom",e="top",h=b))}else{f=u.center;o=this._getBezierDirection(t,f);switch(o){case"left":e="right";break;case"right":e="left";break;case"top":e="bottom";break;case"bottom":e="top"}}f&&(r||n.segments.length==1?(a=n.segments[n.segments.length-1],a.type=="orthogonal"&&(a._direction=r?o:e)):a=n.segments[0],k=this._findEndPoint(o,f,i)||u.center,f=this._findIntersection(i,u,n,f,k,r)||f,r?n.targetPoint=f:n.sourcePoint=f,n.segments.length!=1&&this._addOrthogonalPoints(a,r?n.segments[n.segments.length-2]:null,r?null:n.segments[1],n.sourcePoint,n.targetPoint),this._setLineEndPoint(n,f,r))}},_getDockSegment:function(n,i,r,u,f,e){var o=this._getEdges(r,u),e="",s,h,c=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint);return(h=f?t.datavisualization.Diagram.LineSegment(i.points[i.points.length-2],i.points[i.points.length-1]):c>5?t.datavisualization.Diagram.LineSegment(i._startPoint,i._endPoint):t.datavisualization.Diagram.LineSegment(i._startPoint,n.segments[1]?n.segments[1]._endPoint:n.targetPoint),t.datavisualization.Diagram.Geometry.intersectSegment(h,o.left)?(s=o.left,e="left"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.top)?(s=o.top,e="top"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.right)?(s=o.right,e="right"):t.datavisualization.Diagram.Geometry.intersectSegment(h,o.bottom)&&(s=o.bottom,e="bottom"),e=this._swapDirection(r,e),s)?{dockPoint:t.datavisualization.Diagram.Geometry.midPoint(s),direction:e}:null},_dockBounds:function(n,t,i,r){var u,f,e,o;u=r?n.segments[n.segments.length-1]:n.segments[0];f=u._startPoint;e=u._endPoint||u.point;u.type=="bezier"&&(u.point1||u.point2)&&(r?f=u._point2:e=u._point1);o=this._findIntersection(t,i,n,f,e,r);o&&(this._setLineEndPoint(n,o,r),u.type==="bezier"&&this._updateBezierPoints(u))},_findIntersection:function(n,i,r,u,f,e){var o,v,l=e?r.segments[r.segments.length-1]:r.segments[0],s=n.connectorPadding,y,w,b,c,h,k,d,a,g,p,nt;if(s+=e?r.targetPadding:r.sourcePadding,l.type=="orthogonal"&&(u={x:u.x,y:u.y},u.x==f.x&&(u.y<f.y?u.y-=s+5:u.y+=s+5),u.y==f.y&&(u.x<f.x?u.x-=s+5:u.x+=s+5)),w=e||l.type=="orthogonal"?u:f,l.type!="orthogonal"&&(e?(y=t.datavisualization.Diagram.Geometry.findAngle(u,f),f=t.datavisualization.Diagram.Geometry.transform({x:f.x,y:f.y},y,Math.max(n.width/2,n.height/2))):(y=t.datavisualization.Diagram.Geometry.findAngle(f,u),u=t.datavisualization.Diagram.Geometry.transform({x:u.x,y:u.y},y,Math.max(n.width/2,n.height/2)))),n._shape==="ellipse")return p=t.datavisualization.Diagram.LineSegment(u,f),this._getEllipseIntersectCoords(n,p,r,w,e);if(n._shape!=="polygon"||n.type=="bpmn"&&l.type=="orthogonal")n._shape!=="path"||n.type=="bpmn"&&l.type=="orthogonal"?((n.connectorPadding||r.sourcePadding||r.targetPadding)&&(g=t.datavisualization.Diagram.Rectangle(i.x-s,i.y-s,n.width+2*s,n.height+2*s),i=this.bounds(g)),o=i.points,o[o.length]=o[0],v=i.points.length):(n._segmentPoints||(a=this._findSegmentPoints(n,r,e)),o=a||n._segmentPoints,n.pathData.split("m").length-1+(n.pathData.split("M").length-1)==1&&(o[o.length]=o[0]),v=o.length);else{for(o=[],o=n._segmentPoints?n._segmentPoints:this._findSegmentPoints(n,r,e),n.rotateAngle&&(b=t.Matrix.identity(),t.Matrix.rotate(b,n.rotateAngle,n.offsetX,n.offsetY)),v=o.length,a=[],c=0;c<v;c++)h=t.datavisualization.Diagram.Point(o[c].x+(n.offsetX-n.width*n.pivot.x),o[c].y+(n.offsetY-n.height*n.pivot.y)),n.rotateAngle!=0&&(h=t.Matrix.transform(b,h)),(n.connectorPadding||r.sourcePadding||r.targetPadding)&&(k=n.offsetX==h.x?0:n.offsetX<h.x?1:-1,d=n.offsetY==h.y?0:n.offsetY<h.y?1:-1,h=s?t.datavisualization.Diagram.Geometry.translate(h,k*s,d*s):h),a[c]=h;o=a}return p=t.datavisualization.Diagram.LineSegment(u,f),nt=this._getIntersectionPoints(p,o,!0,w),nt},_getIntersectionPoints:function(n,i,r,u){var e,l=i.length,h=t.datavisualization.Diagram.LineSegment(i[0],i[1]),o=t.datavisualization.Diagram.Geometry.intersectSegment(n,h),f,s,c;if(o){if(!r)return o;f=t.datavisualization.Diagram.Geometry.distance(o,u)}if(isNaN(f)||f>0)for(e=1;e<l-1;e++)if(h=t.datavisualization.Diagram.LineSegment(i[e],i[e+1]),s=t.datavisualization.Diagram.Geometry.intersectSegment(n,h),s){if(!r)return s;if(c=t.datavisualization.Diagram.Geometry.distance(s,u),(isNaN(f)||f>c)&&(f=c,o=s),f>=0&&f<=1)break}return o},_findSegmentPoints:function(n,i,r){var e=[],o,f,y,u,l,a,p,v,h,c,w,s;if(n._shape=="path"){for(o=document.createElementNS("http://www.w3.org/2000/svg","svg"),o.setAttribute("xlink","http://www.w3.org/1999/xlink"),document.body.appendChild(o),f=document.createElementNS("http://www.w3.org/2000/svg","path"),f.setAttributeNS(null,"d",n._absolutePath||n.pathData),o.appendChild(f),y=!n._absoluteBounds||n._scaled||n._absolutePath?f.getBBox():n._absoluteBounds,u=n.connectorPadding,i&&(u+=r?i.targetPadding:i.sourcePadding),u||!n._absolutePath||n._scaled?(l=t.datavisualization.Diagram.Geometry.updatePath(-u,-u,n.width+2*u,n.height+2*u,n._absolutePath||n.pathData,null,y,u?null:n),f.setAttributeNS(null,"d",l),(!n._scaled||u)&&n._absolutePath||(n._absolutePath=l,n._scaled=!1)):f.setAttributeNS(null,"d",n._absolutePath),a=t.Matrix.identity(),t.Matrix.rotate(a,n.rotateAngle,n.offsetX,n.offsetY),p=f.getTotalLength(),h=0;h<=p;h+=10)v=f.getPointAtLength(h),c={x:n.offsetX-n.width*n.pivot.x+v.x,y:n.offsetY-n.height*n.pivot.y+v.y},n.rotateAngle!=0&&(c=t.Matrix.transform(a,c)),e.push(c);document.body.removeChild(o)}else if(n._shape=="polygon"){for(w=n.points.length,s=0;s<w;s++)e[s]=n.points[s];t.datavisualization.Diagram.Geometry.updatePolygonPoints(n,e);e[e.length]=e[0]}else return null;return e},_getEdges:function(n,i){var u=i.points,r={},e=n%360,f;return r.left=t.datavisualization.Diagram.LineSegment(u[3],u[0]),r.top=t.datavisualization.Diagram.LineSegment(u[0],u[1]),r.right=t.datavisualization.Diagram.LineSegment(u[1],u[2]),r.bottom=t.datavisualization.Diagram.LineSegment(u[2],u[3]),e<0&&(e+=360),e>315||e<45||(e<135?(f=r.top,r.top=r.left,r.left=r.bottom,r.bottom=r.right,r.right=f):e<225?(f=r.top,r.top=r.bottom,r.bottom=f,f=r.left,r.left=r.right,r.right=f):(f=r.bottom,r.bottom=r.left,r.left=r.top,r.top=r.right,r.right=f)),r},_pointsFromNodeToPoint:function(n,t,i,r,u,f,e,o){var h=o?n._tarDecoratorSize:n._srcDecoratorSize,s=[],a,c,l;s.push(f);a=f.y==e.y&&(i=="left"&&e.x<f.x||i=="right"&&e.x>f.x)||f.x==e.x&&(i=="top"&&e.y<f.y||i=="bottom"&&e.y>f.y);a||(i=="top"||i=="bottom"?i=="top"&&e.y<f.y&&e.y>f.y-h||i=="bottom"&&e.y>f.y&&e.y<f.y+h?(c=i=="top"?r.top-h:r.bottom+h,s.push({x:f.x,y:c}),s.push({x:f.x+(e.x-f.x)/2,y:c}),s.push({x:f.x+(e.x-f.x)/2,y:e.y})):Math.abs(f.x-e.x)>h&&(i=="top"&&e.y<f.y||i=="bottom"&&e.y>f.y)?s.push({x:f.x,y:e.y}):Math.abs(f.x-e.x)<=h||(e.x<r.left||e.x>r.right)&&e.y!=f.y?(c=i=="top"?r.top-h:r.bottom+h,s.push({x:f.x,y:c}),s.push({x:e.x,y:c})):(c=i=="top"?r.top-h:r.bottom+h,l=e.x<f.x?r.left-h:r.right+h,s.push({x:f.x,y:c}),s.push({x:l,y:c}),s.push({x:l,y:e.y})):i=="left"&&e.x<f.x&&e.x>f.x-h||i=="right"&&e.x>f.x&&e.x<f.x+h?(l=i=="left"?r.left-h:r.right+h,s.push({x:l,y:f.y}),s.push({x:l,y:f.y+(e.y-f.y)/2}),s.push({x:e.x,y:f.y+(e.y-f.y)/2})):Math.abs(f.y-e.y)>h&&(i=="left"&&e.x<f.x||i=="right"&&e.x>f.x)?s.push({x:e.x,y:f.y}):Math.abs(f.y-e.y)<=h||(e.y<r.top||e.y>r.bottom)&&e.x!=f.x?(l=i=="left"?r.left-h:r.right+h,s.push({x:l,y:f.y}),s.push({x:l,y:e.y})):(c=e.y<f.y?r.top-h:r.bottom+h,l=i=="left"?r.left-h:r.right+h,s.push({x:l,y:f.y}),s.push({x:l,y:c}),s.push({x:e.x,y:c})));s.push(e);o&&s.reverse();t._startPoint=s[0];t._endPoint=s[s.length-1];t.points=s;t.direction&&(t.direction=="left"||t.direction=="right"?(t.length=t._length=Math.abs(t._startPoint.x-t._endPoint.x),t._direction=t._startPoint.x<t._endPoint.x?t.direction="right":t.direction="left"):(t.length=t._length=Math.abs(t._startPoint.y-t._endPoint.y),t._direction=t._startPoint.y<t._endPoint.y?t.direction="bottom":t.direction="top"))},_constructSegements:function(n,t,i,r,u,f,e,o){var s,l,h,c;for(o==="right"&&(u==="left"?s=this._rightToLeft(n,t,i,r,f,e,!1):u==="right"?s=this._rightToRight(n,i,r,f,e):u==="top"?s=this._rightToTop(n,i,r,f,e,!1):u==="bottom"&&(s=this._rightToBottom(n,i,r,f,e,!1))),o==="left"&&(u==="right"&&(s=this._rightToLeft(n,t,f,e,i,r,!0),l=!0),u==="left"&&(s=this._leftToLeft(n,i,r,f,e)),u==="top"&&(s=this._leftToTop(n,i,r,f,e,!1)),u==="bottom"&&(s=this._leftToBottom(n,i,r,f,e,!1))),o==="top"&&(u==="left"&&(s=this._leftToTop(n,f,e,i,r,!0),l=!0),u==="right"&&(s=this._rightToTop(n,f,e,i,r,!0),l=!0),u==="top"&&(s=this._topToTop(n,i,r,f,e)),u==="bottom"&&(s=this._topToBottom(n,t,i,r,f,e,!1))),o==="bottom"&&(u==="left"&&(s=this._leftToBottom(n,f,e,i,r,!0),l=!0),u==="right"&&(s=this._rightToBottom(n,f,e,i,r,!0),l=!0),u==="top"&&(s=this._topToBottom(n,t,f,e,i,r,!0),l=!0),u==="bottom"&&(s=this._bottomToBottom(n,i,r,f,e))),l&&s.reverse(),h=s[s.length-1],c=s[s.length-2];s.length>2&&h.x==c.x&&h.y==c.y;)s.splice(s.length-1,1),h=s[s.length-1],c=s[s.length-2];for(h=s[0],c=s[1];s.length>2&&h.x==c.x&&h.y==c.y;)s.splice(0,1),h=s[0],c=s[1];t._startPoint=s[0];t._endPoint=s[s.length-1];t.points=s},_updateIntermediateSegments:function(n){var u=n.segments[0]._endPoint,r=n.segments[0],f=r.points.length,i;n.segments[1]&&(i=n.segments[1],i._startPoint=u,i.type=="orthogonal"&&(i.length||i.length===0)?(i.direction=="left"||i.direction=="right"?(n.segments[2]&&(n.segments[2].length||n.segments[2].length===0)&&(n.segments[2].direction=="top"?n.segments[2].length+=i._startPoint.y-i._endPoint.y:n.segments[2].length-=i._startPoint.y-i._endPoint.y,n.segments[2].length<0&&(n.segments[2].length*=-1,n.segments[2].direction=n.segments[2]._direction=n.segments[2]._direction=="bottom"?"top":"bottom"),n.segments[2]._length=n.segments[2].length),i._endPoint.y=i._startPoint.y):(n.segments[2]&&(n.segments[2].length||n.segments[2].length===0)&&(n.segments[2].direction=="left"?n.segments[2].length+=i._startPoint.x-i._endPoint.x:n.segments[2].length-=i._startPoint.x-i._endPoint.x,n.segments[2].length<0&&(n.segments[2].length*=-1,n.segments[2].direction=n.segments[2]._direction=n.segments[2]._direction=="right"?"left":"right"),n.segments[2]._length=n.segments[2].length),i._endPoint.x=i._startPoint.x),n.sourcePort&&r.points.length>2&&(i.direction=="left"||i.direction=="right"?r.points[r.points.length-1].y==r.points[r.points.length-2].y&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1],i.points.length==2&&(i._endPoint.y=i._startPoint.y)):r.points[r.points.length-1].x==r.points[r.points.length-2].x&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1],i.points.length==2&&(i._endPoint.x=i._startPoint.x))),(i.length||i.length===0)&&(i.length=i._length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i.points[1])),i.length>0&&(i.direction=i._direction=this._getBezierDirection(i._startPoint,i._endPoint)||i._direction),this._addOrthogonalPoints(i,r,n.segments[2],n.sourcePoint,n.targetPoint),n.segments[2]&&this._addOrthogonalPoints(n.segments[2],n.segments[1],n.segments[3],n.sourcePoint,n.targetPoint)):i.type=="orthogonal"&&i.length===null?(n.sourcePort&&r.points.length>2&&(i._direction=="left"||i._direction=="right"?r.points[r.points.length-1].y==r.points[r.points.length-2].y&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1]):r.points[r.points.length-1].x==r.points[r.points.length-2].x&&(i._startPoint=i.points[0]=r.points[r.points.length-2],r.points.splice(r.points.length-1,1),r._endPoint=r.points[r.points.length-1])),i._startPoint=i.points[0]=n.segments[0]._endPoint,this._addOrthogonalPoints(n.segments[1],n.segments[0],null,n.sourcePoint,n.targetPoint)):(i._startPoint=i.points[0]=n.segments[0]._endPoint,i.type=="bezier"&&this._updateBezierPoints(i)))},_updatePreviousSegment:function(n){var i=n.segments[n.segments.length-2],r=n.segments[n.segments.length-1],u,f,e;i&&(i.type=="orthogonal"&&r.points.length>2&&(u=!1,f=i.points.length==2?i.direction:t.datavisualization.Diagram.Util._getBezierDirection(i.points[i.points.length-2],i.points[i.points.length-1]),f=="left"||f=="right"?r.points[0].y==r.points[1].y&&(u=!0,e=r.points[1].x-r.points[0].x,r.points.splice(0,1),r._startPoint=r.points[0],i._endPoint=r.points[0]):r.points[0].x==r.points[1].x&&(u=!0,r.points.splice(0,1),r._startPoint=r.points[0],i._endPoint=r.points[0])),i._endPoint=r._startPoint,i.points[i.points.length-1]=r._startPoint,i.type=="orthogonal"&&u?(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i._length>0&&(i._direction=i.direction=this._getBezierDirection(i._startPoint,i._endPoint)),(n.segments.length>2||!n.sourcePort)&&this._addOrthogonalPoints(i,n.segments[n.segments.length-3],r,n.sourcePoint,n.targetPoint)):i.point=r._startPoint)},_initConnectionEnds:function(n,i){var u,r,e,o,f;if(n.segments&&n.segments[0]&&n.segments[0].type=="orthogonal"&&n.segments[0].length){if(n.sourceNode&&(e=i.nameTable[n.sourceNode],e))if(r=t.datavisualization.Diagram.Util.bounds(e,!0),n.sourcePort)u=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[n.sourceNode],n.sourcePort),n.sourcePoint=t.datavisualization.Diagram.Util._getPortPosition(u,r);else{f=n.segments[0];switch(f.direction){case"left":n.sourcePoint=r.middleLeft;break;case"right":n.sourcePoint=r.middleRight;break;case"top":n.sourcePoint=r.topCenter;break;case"bottom":n.sourcePoint=r.bottomCenter}}if(n.targetNode&&(o=i.nameTable[n.targetNode],o))if(r=t.datavisualization.Diagram.Util.bounds(o,!0),n.targetPort)u=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[n.targetNode],n.targetPort),n.targetPoint=t.datavisualization.Diagram.Util._getPortPosition(u,r);else{f=n.segments[0];switch(f.direction){case"left":n.targetPoint=r.middleLeft;break;case"right":n.targetPoint=r.middleRight;break;case"top":n.targetPoint=r.topCenter;break;case"bottom":n.targetPoint=r.bottomCenter}}}else n.sourceNode&&(r=t.datavisualization.Diagram.Util.bounds(i.nameTable[n.sourceNode],!0),n.sourcePort?(u=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[n.sourceNode],n.sourcePort),n.sourcePoint=t.datavisualization.Diagram.Util._getPortPosition(u,r)):n.sourcePoint=r.center),n.targetNode&&(r=t.datavisualization.Diagram.Util.bounds(i.nameTable[n.targetNode],!0),n.targetPort?(u=t.datavisualization.Diagram.Util.findPortByName(i.nameTable[n.targetNode],n.targetPort),n.targetPoint=t.datavisualization.Diagram.Util._getPortPosition(u,r)):n.targetPoint=r.center)},_swapDirection:function(n,t){var u,i=n%360,r;return i<0&&(i+=360),i>315||i<45?u=t:i<135?(r={left:"top",top:"right",right:"bottom",bottom:"left"},u=r[t]):i<225?(r={left:"right",top:"bottom",right:"left",bottom:"top"},u=r[t]):(r={left:"bottom",top:"left",right:"top",bottom:"right"},u=r[t]),u},_getEllipseIntersectCoords:function(n,i,r,u,f){var a=[],o=n.connectorPadding,w,s,c,e,h,l;r&&(o+=f?r.targetPadding:r.sourcePadding);o||(o=0);var v=n.width/2,y=n.height/2,p=t.Matrix.identity();for(t.Matrix.rotate(p,n.rotateAngle,n.offsetX,n.offsetY),w="M "+(n.offsetX-n.width*n.pivot.x-o)+", "+n.offsetY+" A "+v+" "+y+" 0 0 1 "+(n.offsetX+n.width*(1-n.pivot.x)+o)+", "+n.offsetY+" A "+v+" "+y+" 0 0 1 "+(n.offsetX-n.width*n.pivot.x-o)+", "+n.offsetY+"z",s=document.createElementNS("http://www.w3.org/2000/svg","path"),s.setAttributeNS(null,"d",w),c=s.getTotalLength(),e=[],h=0;h<c;h=h+3)l=s.getPointAtLength(h),n.rotateAngle!=0&&(l=t.Matrix.transform(p,l)),e[e.length]=l;return e[e.length-1]!=s.getPointAtLength(c)&&(e[e.length]=s.getPointAtLength(c)),a=e,this._getIntersectionPoints(i,a,!0,u)},_rightToLeft:function(n,i,r,u,f,e,o){var c=[],h,s,a,l,v;return c.push(e),a=n._srcDecoratorSize,l=n._tarDecoratorSize,o&&(l=n._srcDecoratorSize,a=n._tarDecoratorSize),f.width==0&&(a=0),r.width==0&&(l=0),v=a+l,u.x>e.x?e.y!=u.y&&(e.x>r.left?(h=f.right+a,s=e.y,c.push(t.datavisualization.Diagram.Point(h,s)),s=u.y>f.top?u.y:r.bottom+l,c.push(t.datavisualization.Diagram.Point(h,s)),u.y<=f.top&&(h=r.right+l,c.push(t.datavisualization.Diagram.Point(h,s)),s=r.top-l,c.push(t.datavisualization.Diagram.Point(h,s)),h=r.left-l,c.push(t.datavisualization.Diagram.Point(h,s)),s=u.y,c.push(t.datavisualization.Diagram.Point(h,s)))):(h=i.direction||i.length==undefined?r.left-f.right>0?f.right+(r.left-f.right)/2:f.right+a:f.right+i.length,s=e.y,c.push(t.datavisualization.Diagram.Point(h,s)),s=u.y,c.push(t.datavisualization.Diagram.Point(h,s)))):(Math.abs(r.top-f.bottom)<v||Math.abs(r.bottom-f.top)<v?e.x>r.right?(h=e.x+a,s=e.y):(h=r.right+l,s=e.y):(h=f.right+a,s=e.y),c.push(t.datavisualization.Diagram.Point(h,s)),r.top-f.bottom>=v?(s=r.top-l,c.push(t.datavisualization.Diagram.Point(h,s))):e.y>u.y?(s=f.top-r.bottom<v?r.left>f.right?r.bottom+(f.top-r.bottom)/2:Math.min(r.top-l,f.top-a):r.bottom+l,c.push(t.datavisualization.Diagram.Point(h,s))):(s=r.left>f.right?r.bottom+(f.top-r.bottom)/2:Math.max(r.bottom+l,f.bottom+a),c.push(t.datavisualization.Diagram.Point(h,s))),h=r.left-l,c.push(t.datavisualization.Diagram.Point(h,s)),s=u.y,c.push(t.datavisualization.Diagram.Point(h,s))),c.push(u),c},_rightToRight:function(n,i,r,u,f){var s=[],e,o,c,h;return s.push(f),o=f.y,c=n._srcDecoratorSize,h=n._tarDecoratorSize,u.width==0&&(c=0),i.width==0&&(h=0),i.right>=u.left?f.y>=i.top-h&&f.y<=i.bottom+h?(e=f.x+c,s.push(t.datavisualization.Diagram.Point(e,o)),f.y>=i.center.y?(o=f.x>i.left?f.y>r.y?i.bottom+h:i.top-h:i.top-h,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.right+h,s.push(t.datavisualization.Diagram.Point(e,o))):(o=i.bottom+h,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.right+h,s.push(t.datavisualization.Diagram.Point(e,o)))):i.right<u.right?(e=u.right+c,s.push(t.datavisualization.Diagram.Point(e,o))):(e=r.x+h,s.push(t.datavisualization.Diagram.Point(e,o))):(e=f.x+c,s.push(t.datavisualization.Diagram.Point(e,o)),r.y>=u.top-c&&r.y<=u.bottom+c&&(r.y<=u.center.y?(o=u.top-c,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.right+h,s.push(t.datavisualization.Diagram.Point(e,o))):(o=u.bottom+c,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.right+h,s.push(t.datavisualization.Diagram.Point(e,o))))),s.push(t.datavisualization.Diagram.Point(e,r.y)),s.push(r),s},_rightToTop:function(n,i,r,u,f,e){var h=[],c,o,s,l,a;return h.push(f),o=f.y,s=n._srcDecoratorSize,l=n._tarDecoratorSize,e&&(l=n._srcDecoratorSize,s=n._tarDecoratorSize),u.width==0&&(s=0),i.width==0&&(l=0),a=s+l,r.x>=f.x+s?f.y+s>=r.y&&i.height!==0&&(c=i.left<=u.right?i.right+l:i.left-u.right>a?u.right+s:u.right+(i.left-u.right)/2,h.push(t.datavisualization.Diagram.Point(c,o)),o=i.top-l,h.push(t.datavisualization.Diagram.Point(c,o))):u.bottom+s>i.top-l?(c=f.x+s<=i.right?i.right+l:u.right+s,h.push(t.datavisualization.Diagram.Point(c,o)),o=u.top>=i.top?i.height!==0?i.top-l:r.y:u.top>=i.top-l?i.top-l-s:u.top-s,h.push(t.datavisualization.Diagram.Point(c,o))):(c=f.x+s,h.push(t.datavisualization.Diagram.Point(c,o)),i.top-u.bottom<a&&i.height!==0?u.left-i.right>=a?(o=u.bottom+s,h.push(t.datavisualization.Diagram.Point(c,o)),c=u.left-s,h.push(t.datavisualization.Diagram.Point(c,o)),o=i.top-l,h.push(t.datavisualization.Diagram.Point(c,o))):(o=i.top-(i.top-u.bottom)/2,h.push(t.datavisualization.Diagram.Point(c,o))):(o=i.height!==0?i.top-l:r.y,h.push(t.datavisualization.Diagram.Point(c,o)))),h.push(t.datavisualization.Diagram.Point(r.x,o)),h.push(r),h},_rightToBottom:function(n,i,r,u,f,e){var h=[],s,o,c,l,a;return h.push(f),o=f.y,c=n._srcDecoratorSize,l=n._tarDecoratorSize,e&&(l=n._srcDecoratorSize,c=n._tarDecoratorSize),u.width==0&&(c=0),i.width==0&&(l=0),a=c+l,r.x>=f.x?f.y<=i.bottom+l?i.left>u.right+c?(s=f.x+c,h.push(t.datavisualization.Diagram.Point(s,o)),o=i.bottom+l,h.push(t.datavisualization.Diagram.Point(s,o))):(s=i.right+l,h.push(t.datavisualization.Diagram.Point(s,o)),o=i.bottom+l,h.push(t.datavisualization.Diagram.Point(s,o))):u.right+c>r.x?(s=f.x+c,h.push(t.datavisualization.Diagram.Point(s,o)),o=u.top-i.bottom>a?i.bottom+l:i.bottom+(u.top-i.bottom)/2,h.push(t.datavisualization.Diagram.Point(s,o))):o=f.y:f.y<=i.bottom?(s=u.right+c>i.right?u.right+c:i.right+l,h.push(t.datavisualization.Diagram.Point(s,o)),o=i.bottom+l,o<=u.bottom+c&&(o=u.bottom+c),h.push(t.datavisualization.Diagram.Point(s,o))):i.bottom+l<u.top-c?(s=u.right+c,h.push(t.datavisualization.Diagram.Point(s,o)),o=u.top-i.bottom<a?i.bottom+(u.top-i.bottom)/2:i.bottom+l,h.push(t.datavisualization.Diagram.Point(s,o))):(s=u.right+c,h.push(t.datavisualization.Diagram.Point(s,o)),o=u.bottom+c,h.push(t.datavisualization.Diagram.Point(s,o))),h.push(t.datavisualization.Diagram.Point(r.x,o)),h.push(r),h},_leftToLeft:function(n,i,r,u,f){var s=[],e,o,c,h,l;return s.push(f),o=f.y,c=n._srcDecoratorSize,h=n._tarDecoratorSize,u.width==0&&(c=0),i.width==0&&(h=0),l=c+h,r.x-h>=f.x-c?(e=u.left-c,s.push(t.datavisualization.Diagram.Point(e,o)),f.y>r.y?r.y+h>=u.top?(o=u.top-c,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.left-u.right>l?i.left-h:u.right+(i.left-u.right)/2,s.push(t.datavisualization.Diagram.Point(e,o))):(o=r.y,s.push(t.datavisualization.Diagram.Point(e,o)),e=r.x):u.bottom+c<r.y?(o=r.y,s.push(t.datavisualization.Diagram.Point(e,o)),e=r.x):(o=u.bottom+c,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.left-u.right>l?i.left-h:u.right+(i.left-u.right)/2,s.push(t.datavisualization.Diagram.Point(e,o)))):(r.y>f.y?f.y>i.top-h&&(e=u.left-i.right<l?i.right+(u.left-i.right)/2:u.left-c,s.push(t.datavisualization.Diagram.Point(e,o)),o=i.top-h,s.push(t.datavisualization.Diagram.Point(e,o))):i.bottom+h>=f.y&&(e=u.left-i.right<l?i.right+(u.left-i.right)/2:u.left-c,s.push(t.datavisualization.Diagram.Point(e,o)),o=i.bottom+h,s.push(t.datavisualization.Diagram.Point(e,o)),e=i.left-h,s.push(t.datavisualization.Diagram.Point(e,o))),e=i.left-h,s.push(t.datavisualization.Diagram.Point(e,o))),s.push(t.datavisualization.Diagram.Point(e,r.y)),s.push(r),s},_leftToTop:function(n,i,r,u,f,e){var h=[],l,c,o,s;return h.push(f),c=f.y,o=n._srcDecoratorSize,s=n._tarDecoratorSize,e&&(s=n._srcDecoratorSize,o=n._tarDecoratorSize),u.width==0&&(o=0),i.width==0&&(s=0),f.x<=r.x?(l=f.y>r.y&&i.left<=u.left?i.left-s:u.left-o,h.push(t.datavisualization.Diagram.Point(l,c)),c=u.bottom<=i.top?u.bottom+o<i.top-s?i.height!==0?i.top-s:r.y:r.x<u.right?u.bottom+(i.top-u.bottom)/2:u.top-o:u.top-o>=i.top-s?i.height!==0?i.top-s:r.y:u.top-o,h.push(t.datavisualization.Diagram.Point(l,c))):r.y<=f.y+o&&(l=u.left-o>i.right+s?u.left-o:i.right+s>=u.left-o?i.left-s:i.right+(u.left-i.right)/2,h.push(t.datavisualization.Diagram.Point(l,c)),c=i.top-s,h.push(t.datavisualization.Diagram.Point(l,c))),h.push(t.datavisualization.Diagram.Point(r.x,c)),h.push(r),h},_leftToBottom:function(n,i,r,u,f,e){var c=[],l,o,s,h,a;return c.push(f),o=f.y,s=n._srcDecoratorSize,h=n._tarDecoratorSize,e&&(h=n._srcDecoratorSize,s=n._tarDecoratorSize),u.width==0&&(s=0),i.width==0&&(h=0),a=s+h,f.x-s<=r.x?(l=i.left<=f.x&&f.y<=i.top?i.left-h:u.left-s,c.push(t.datavisualization.Diagram.Point(l,o)),i.bottom+h<u.top-s?(o=u.top-i.bottom<a?i.bottom+(u.top-i.bottom)/2:i.bottom+h,c.push(t.datavisualization.Diagram.Point(l,o))):(o=i.bottom<u.bottom?u.bottom+s:i.bottom+h,c.push(t.datavisualization.Diagram.Point(l,o)))):f.y-s>r.y||(l=i.right>=u.left?i.left-h:u.left-i.right<a?u.left-(u.left-i.right)/2:u.left-s,c.push(t.datavisualization.Diagram.Point(l,o)),o=i.bottom+h,c.push(t.datavisualization.Diagram.Point(l,o))),c.push(t.datavisualization.Diagram.Point(r.x,o)),c.push(r),c},_topToTop:function(n,i,r,u,f){var s=[],o,e,c,h,l;return s.push(f),o=f.x,c=n._srcDecoratorSize,h=n._tarDecoratorSize,u.width==0&&(c=0),i.width==0&&(h=0),l=c+h,r.x>=f.x?r.y-h>=f.y-c?(e=u.top-c,s.push(t.datavisualization.Diagram.Point(o,e)),r.x<=u.right&&(o=u.right+c,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.height!==0?i.top-u.bottom>l?i.top-h:u.bottom+(i.top-u.bottom)/2:r.y,s.push(t.datavisualization.Diagram.Point(o,e)))):i.left<=f.x?(e=u.top-i.bottom>l?u.top-c:i.bottom+(u.top-i.bottom)/2,s.push(t.datavisualization.Diagram.Point(o,e)),o=i.left-h,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.top-h,s.push(t.datavisualization.Diagram.Point(o,e))):(e=i.height!==0?i.top-h:r.y,s.push(t.datavisualization.Diagram.Point(o,e))):r.y-h>=f.y-c?(e=u.top-c,s.push(t.datavisualization.Diagram.Point(o,e)),r.x>=u.left&&(o=u.left-c,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.height!==0?i.top-u.bottom>l?i.top-h:u.bottom+(i.top-u.bottom)/2:r.y,s.push(t.datavisualization.Diagram.Point(o,e)))):i.right>=f.x?(e=u.top-i.bottom>l?u.top-c:i.bottom+(u.top-i.bottom)/2,s.push(t.datavisualization.Diagram.Point(o,e)),o=i.right+h,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.top-h,s.push(t.datavisualization.Diagram.Point(o,e))):(e=i.height!==0?i.top-h:r.y,s.push(t.datavisualization.Diagram.Point(o,e))),o=r.x,s.push(t.datavisualization.Diagram.Point(o,e)),s.push(r),s},_topToBottom:function(n,i,r,u,f,e,o){var h=[],c,s,l,a,v;return h.push(e),c=e.x,l=n._srcDecoratorSize,a=n._tarDecoratorSize,o&&(a=n._srcDecoratorSize,l=n._tarDecoratorSize),f.width==0&&(l=0),r.width==0&&(a=0),v=l+a,u.x>e.x?(f.top>=r.bottom?f.top-r.bottom>0?(s=i.length==undefined||i.direction?f.top-r.bottom>0?r.bottom+(f.top-r.bottom)/2:r.bottom+a:r.bottom+i.length,h.push(t.datavisualization.Diagram.Point(c,s))):(s=f.top-l,h.push(t.datavisualization.Diagram.Point(c,s)),c=r.left-f.right>=v?f.right+l:f.right+(r.left-f.right)/2,h.push(t.datavisualization.Diagram.Point(c,s)),s=r.bottom+a,h.push(t.datavisualization.Diagram.Point(c,s))):(s=r.top<f.top?r.left>=f.right+l?f.top-l:r.top-a:f.top-l,h.push(t.datavisualization.Diagram.Point(c,s)),c=r.left>=f.right+l?f.right+l:r.right+a,h.push(t.datavisualization.Diagram.Point(c,s)),s=r.bottom+a,h.push(t.datavisualization.Diagram.Point(c,s))),h.push(t.datavisualization.Diagram.Point(u.x,s))):u.x<e.x&&(f.top>=r.bottom?f.top-r.bottom>0?(s=i.length==undefined||i.direction?f.top-r.bottom>0?r.bottom+(f.top-r.bottom)/2:r.bottom+a:r.bottom+i.length,h.push(t.datavisualization.Diagram.Point(c,s))):(s=f.top-l,h.push(t.datavisualization.Diagram.Point(c,s)),c=f.left-r.right>=v?f.left-l:r.right+(f.left-r.right)/2,h.push(t.datavisualization.Diagram.Point(c,s)),s=r.bottom+a,h.push(t.datavisualization.Diagram.Point(c,s))):(s=f.left-l>=r.right+a?f.top-l:f.top-l,h.push(t.datavisualization.Diagram.Point(c,s)),c=f.left>=r.right+a||f.right+l<r.right+a?r.right+a:f.right+l,h.push(t.datavisualization.Diagram.Point(c,s)),s=f.left>=r.right+a?r.bottom+a:r.bottom<=f.bottom?f.bottom+l:r.bottom+a,h.push(t.datavisualization.Diagram.Point(c,s))),h.push(t.datavisualization.Diagram.Point(u.x,s))),h.push(u),h},_bottomToBottom:function(n,i,r,u,f){var s=[],o,e,h,c,l;return s.push(f),o=f.x,h=n._srcDecoratorSize,c=n._tarDecoratorSize,u.width==0&&(h=0),i.width==0&&(c=0),l=h+c,r.x>=f.x?u.bottom+h>=i.bottom+h?(e=u.bottom+h,s.push(t.datavisualization.Diagram.Point(o,e)),r.x<u.right&&(o=u.right+h,s.push(t.datavisualization.Diagram.Point(o,e)),e=u.top-h>=i.bottom+c?u.top-i.bottom>=l?i.bottom+c:i.bottom+(u.top-i.bottom)/2:i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e)))):f.x>i.left?(e=i.bottom-u.bottom>=l?u.bottom+h:u.bottom+(i.bottom-u.bottom)/2,s.push(t.datavisualization.Diagram.Point(o,e)),o=i.left-c,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e))):(e=i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e))):u.bottom+h>=i.bottom+h?(e=u.bottom+h,s.push(t.datavisualization.Diagram.Point(o,e)),r.x>u.left&&(o=u.left-h,s.push(t.datavisualization.Diagram.Point(o,e)),e=u.top-h>=i.bottom+c?u.top-i.bottom>=l?i.bottom+c:i.bottom+(u.top-i.bottom)/2:i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e)))):f.x<i.right?(e=i.bottom-u.bottom>=l?u.bottom+h:u.bottom+(i.bottom-u.bottom)/2,s.push(t.datavisualization.Diagram.Point(o,e)),o=i.right+c,s.push(t.datavisualization.Diagram.Point(o,e)),e=i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e))):(e=i.bottom+c,s.push(t.datavisualization.Diagram.Point(o,e))),s.push(t.datavisualization.Diagram.Point(r.x,e)),s.push(r),s},_addOrthogonalPoints:function(n,i,r,u,f,e){var v=[],o=i?i._endPoint:u,p,w,s,l,y;v.push(o);n._direction||(n._direction=this._getOrthoDirection(o,f,i));n._direction!=="auto"||i||r||(n._direction=this._getBezierDirection(o,f));var h=!e&&e!=0?this._directionToAngle(n._direction||this._getBezierDirection(o,f)):e,l=n._direction;if(l=="left"||l=="right"||l=="top"||l=="bottom")h={right:0,left:180,top:270,bottom:90,auto:90}[l];else switch(l){case"straight":h=0;break;case"clockWise90":h+=90;break;case"opposite":h+=180;break;case"antiClockWise90":h+=270}if((n.length||n.length==0)&&n.direction)s=t.datavisualization.Diagram.Geometry.transform(o,h||0,n._length),s.x=Math.round(s.x*100)/100,s.y=Math.round(s.y*100)/100,v.push(s),n._endPoint=s,r&&(r._startPoint=n._endPoint,r.points&&(r.points[0]=n._endPoint,r.type=="bezier"&&this._updateBezierPoints(r)));else{if(o.x!=f.x&&o.y!=f.y||i&&i._startPoint.x==f.x){var b=20,a=f.x-(s?s.x:o.x),c=f.y-(s?s.y:o.y);a=Math.abs(a)<=.0001?0:a;c=Math.abs(c)<=.0001?0:c;switch(h){case 0:if(f.x<o.x)break;w=Math.abs(o.x-f.x)<30;break;case 180:if(f.x>o.x)break;w=Math.abs(o.x-f.x)<30;break;case 90:if(f.y<o.y)break;w=Math.abs(o.y-f.y)<30;break;case 270:if(f.y>o.y)break;w=Math.abs(o.y-f.y)<30}i?p=i&&i._startPoint.x==f.x?3:a==0||c==0?2:3:(w?(b=h==90||h==270?Math.abs(o.y-f.y):Math.abs(o.x-f.x),p=2,b<10&&(b+=20,p=3)):p=3,(p!=2||Math.abs(c)>1&&Math.abs(a)>1)&&(s=t.datavisualization.Diagram.Geometry.transform(o,h,b)));p==3&&(l=n._direction=="auto"?i?i._direction=="left"||i.direction=="right"?"left":"top":"bottom":n._direction,l=="left"||l=="right"||c==0?(c=c>0?c:-c,y=t.datavisualization.Diagram.Geometry.transform(s||o,90,f.y-(s?s.y:o.y))):(a=a>0?a:-a,y=t.datavisualization.Diagram.Geometry.transform(s||o,0,f.x-(s?s.x:o.x))));s&&(s.x=Math.round(s.x*100)/100,s.y=Math.round(s.y*100)/100,v.push(s));y&&(y.x=Math.round(y.x*100)/100,y.y=Math.round(y.y*100)/100,v.push(y))}n._direction=this._getBezierDirection(v[v.length-1],f);v.push(f);n._endPoint=f;r&&(r._startPoint=n._endPoint,r.points||(r.points=[]),r.points[0]=n._endPoint,r.type=="bezier"&&this._updateBezierPoints(r))}return n.points=v,h},_getOrthoDirection:function(n,t,i){if(i){var r=t;return Math.abs(r.x-n.x)>Math.abs(r.y-n.y)&&i&&(i._direction=="left"||i._direction=="right")?n.x<r.x?"right":"left":n.y<r.y?"bottom":"top"}return n.y<t.y?"bottom":n.y>t.y?"top":n.x<t.x?"right":n.x>t.x?"left":void 0},_directionToAngle:function(n){return{right:0,left:180,top:270,bottom:90,auto:90}[n]},_resetOrthogonalPoints:function(n){var t=[],i;t.push(n.sourcePoint);t.push(n.targetPoint);n.points=[];n.sourcePoint=t[0];n.points.push(t[0]);i=this._constructOrthogonalPoints(t[0],t[1]);n.points.push(i[0]);n.points.push(i[1]);n.targetPoint=t[1];n.points.push(t[1])},_updateBezierPoints:function(n,i,r,u,f,e,o){var c,v={right:0,left:180,top:270,bottom:90},s,h,l,a;(n.vector1||n.vector2)&&(n.vector1&&(n._point1=t.datavisualization.Diagram.Geometry.transform(n._startPoint,n.vector1.angle,n.vector1.distance)),n.vector2&&(n._point2=t.datavisualization.Diagram.Geometry.transform(n._endPoint,n.vector2.angle,n.vector2.distance)));(n.point1!=null||n.vector1)&&(n.point2!=null||n.vector2)||(s=n._endPoint,h=n._startPoint,e?(c=o,h=this._getPortPosition(e,c),f.rotateAngle!==0&&(a=t.Matrix.identity(),t.Matrix.rotate(a,f.rotateAngle,f.offsetX,f.offsetY),h=t.Matrix.transform(a,h)),l=this._getDirection(c,h,!0)):l=this._getBezierDirection(h,s),n.vector1||(n._point1=n.point1||this._getBezierAdjPoint(v[l],n._startPoint,n._endPoint)),r?(c=u,s=this._getPortPosition(r,c),i.rotateAngle!==0&&(a=t.Matrix.identity(),t.Matrix.rotate(a,i.rotateAngle,i.offsetX,i.offsetY),s=t.Matrix.transform(a,s)),l=this._getDirection(c,s,!0)):l=this._getBezierDirection(s,h),n.vector2||(n._point2=n.point2||this._getBezierAdjPoint(v[l],n._endPoint,n._startPoint)))},_getBezierDirection:function(n,t){return Math.abs(t.x-n.x)>Math.abs(t.y-n.y)?n.x<t.x?"right":"left":n.y<t.y?"bottom":"top"},_getDirection:function(n,i,r){var l=n.points,s=n.center,f=r?45:180/(2+2/(n.height/n.width)),h=f,e=180-f,o=e+2*f,c=360-f,u=t.datavisualization.Diagram.Geometry.findAngle(i,s);return u>h&&u<e?"top":u>e&&u<o?"right":u>o&&u<c?"bottom":"left"},_getBezierAdjPoint:function(n,i,r){var u=60,f=t.datavisualization.Diagram.Point(0,0),e=n>45&&n<135?"Bottom":n>135&&n<225?"Left":n>225&&n<315?"Top":"Right";switch(e){case"Right":u=Math.min(Math.abs(i.x-r.x)*.45,u);f=t.datavisualization.Diagram.Point(i.x+u,i.y);break;case"Bottom":u=Math.min(Math.abs(i.y-r.y)*.45,u);f=t.datavisualization.Diagram.Point(i.x,i.y+u);break;case"Left":u=Math.min(Math.abs(i.x-r.x)*.45,u);f=t.datavisualization.Diagram.Point(i.x-u,i.y);break;case"Top":u=Math.min(Math.abs(i.y-r.y)*.45,u);f=t.datavisualization.Diagram.Point(i.x,i.y-u)}return f},_setLineEndPoint:function(n,t,i){var o=n,u,r,e,f;t.x=Math.round(t.x*100)/100;t.y=Math.round(t.y*100)/100;i?(u=n.segments[n.segments.length-1],o.targetPoint=t,u.type!="orthogonal"&&(u.point&&(u.point=t),u._point=t),u.points[u.points.length-1]=t,u._endPoint=t):(o.sourcePoint=t,r=n.segments[0],r.points[0]=t,r._startPoint=t,r.type!="orthogonal"||n.sourcePort||n._staticLength||(r.length||r.length===0)&&r.direction&&r.points.length==2&&(r._direction=="left"||r._direction=="right"?(r._endPoint.y=r._startPoint.y,e=Math.abs(r._startPoint.x-r._endPoint.x)):(r._endPoint.x=r._startPoint.x,e=Math.abs(r._startPoint.y-r._endPoint.y)),n.segments[0]._length=e,n.segments[0].length=n.segments[0]._length,n.segments[0].direction=n.segments[0]._direction));f=i?n.segments[n.segments.length-1]:n.segments[0];f.type!=="orthogonal"||(i||n.sourcePort)&&(!i||n.targetPort)||n.sourceNode&&n.targetNode&&!(n.segments.length>1)?f.type==="bezier"&&this._updateBezierPoints(f):(f.points=[],this._addOrthogonalPoints(f,i?n.segments[n.segments.length-2]:null,i?null:n.segments[1],n.sourcePoint,n.targetPoint))},_setBezierPoint:function(n,i,r){r==="bezierpoint1"?n.vector1?(n.vector1={distance:t.datavisualization.Diagram.Geometry.distance(n._startPoint,i),angle:t.datavisualization.Diagram.Geometry.findAngle(n._startPoint,i)},n._point1=i):n.point1=n._point1=i:n.vector2?(n.vector2={distance:t.datavisualization.Diagram.Geometry.distance(n._endPoint,i),angle:t.datavisualization.Diagram.Geometry.findAngle(n._endPoint,i)},n._point2=i):n.point2=n._point2=i},_setPoints:function(n,t){n.sourcePoint=n.points[0]=t[0];n.targetPoint=n.points[n.points.length-1]=t[t.length-1];n.points=t;n.type==="bezier"&&(n.point1=t[2]||n.point1,n.point2=t[3]||n.point2,n.point1||(n._point1=n.point1),n.point2||(n._point2=n.point2),this._updateBezierPoints(n))},_updateConnectorSegments:function(n,i,r,u){for(var o,s=n.sourcePoint,f=0;f<n.segments.length;f++){var e=n.segments[f],h=n.segments[f-1],c=n.segments[f+1];e._startPoint=h?h._endPoint:s;f==0&&i||f==n.segments.length-1&&r||(e.type=="orthogonal"?o=t.datavisualization.Diagram.Util._addOrthogonalPoints(e,h,c,n.sourcePoint,n.targetPoint,o):(o=t.datavisualization.Diagram.Geometry.findAngle(s,e._endPoint),e.type=="bezier"&&this._updateBezierPoints(e)));s=e._endPoint}u&&u._dock(n,u.nameTable)},_translateLine:function(n,i,r){for(var u,f,e=0;e<n.segments.length;e++){for(u=n.segments[e],f=0;f<u.points.length;f++)f==0?(u._startPoint=u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r),e==0&&(n.sourcePoint=u._startPoint)):f==u.points.length-1?(u._endPoint=u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r),e==n.segments.length-1&&(n.targetPoint=u._endPoint)):u.points[f]=t.datavisualization.Diagram.Geometry.translate(u.points[f],i,r);u.type===t.datavisualization.Diagram.Segments.Bezier?(u._point1=t.datavisualization.Diagram.Geometry.translate(u._point1,i,r),u._point2=t.datavisualization.Diagram.Geometry.translate(u._point2,i,r),u.point1&&(u.point1=u._point1),u.point2&&(u.point2=u._point2),u.point&&(u.point=u._endPoint),u._point=u._endPoint):u.type=="straight"&&(u.point&&(u.point=u._endPoint),u._point=u._endPoint)}},_adjustPoint:function(n,i,r,u){var f=r?{x:n.x,y:n.y}:{x:i.x,y:i.y},e;return n.x==i.x?n.y<i.y&&r||n.y>i.y&&!r?f.y+=u:f.y-=u:n.y==i.y?n.x<i.x&&r||n.x>i.x&&!r?f.x+=u:f.x-=u:r?(e=t.datavisualization.Diagram.Geometry.findAngle(n,i),f=t.datavisualization.Diagram.Geometry.transform(n,e,u)):(e=t.datavisualization.Diagram.Geometry.findAngle(i,n),f=t.datavisualization.Diagram.Geometry.transform(i,e,u)),f},_getIconPosition:function(n,i,r){var o,s,f,e,u,h,c;if(n)return o=n.margin.left-n.margin.right,s=n.margin.top-n.margin.bottom,f=n.offset.x,e=n.offset.y,r?(u=t.datavisualization.Diagram.Point(i.width*f+o,i.height*e+s),(u.x>i.width||u.y>i.height)&&(u=t.datavisualization.Diagram.Point(i.width*f,i.height*e)),u):(h=i.center.x-i.width/2+i.width*f+o,c=i.center.y-i.height/2+i.height*e+s,t.datavisualization.Diagram.Point(h,c))},_getLabelPosition:function(n,i,r){var u=i.width*(r?r.x:n.offset.x),f=i.height*(r?r.y:n.offset.y);return n.horizontalAlignment=="left"?u+=n.margin.left:n.horizontalAlignment=="right"?u-=n.margin.right:u+=n.margin.left-n.margin.right,n.verticalAlignment=="top"?f+=n.margin.top:n.verticalAlignment=="bottom"?f-=n.margin.bottom:f+=n.margin.top-n.margin.bottom,t.datavisualization.Diagram.Point(u,f)},_getPortPosition:function(n,i,r){var u,f,e,o;if(n)return u=(n.margin.left?n.margin.left:0)+(n.margin.right?n.margin.right:0),f=(n.margin.top?n.margin.top:0)+(n.margin.bottom?n.margin.bottom:0),r?t.datavisualization.Diagram.Point(i.width*n.offset.x+u,i.height*n.offset.y+f):(e=i.center.x-i.width/2+i.width*n.offset.x+u,o=i.center.y-i.height/2+i.height*n.offset.y+f,t.datavisualization.Diagram.Point(e,o))},_translate:function(n,i,r,u,f,e){var h,o,s;if(n.segments)t.datavisualization.Diagram.Util._translateLine(n,i,r,n);else if(n.offsetX+=i,n.offsetY+=r,n._type==="group"&&!f){for(h=e._getChildren(n.children),s=0;s<h.length;s++)o=u[h[s]],this._translate(o,i,r,u,null,e),o.parent&&o.parent!=n.name&&n.type!="pseudoGroup"&&t.datavisualization.Diagram.Util._updateGroupBounds(u[o.parent],e);n._type!="group"&&n.container&&t.datavisualization.Diagram.Util._updateGroupBounds(n,e)}},scale:function(n,i,r,u,f,e,o,s,h){var nt,b,v,c,w,a,d,g,l;if(n.container)switch(n.container.type){case"canvas":a={};l=t.Matrix.identity();t.Matrix.rotate(l,-n.rotateAngle,u.x,u.y);t.Matrix.scale(l,i,r,u.x,u.y);t.Matrix.rotate(l,n.rotateAngle,u.x,u.y);k=t.Matrix.transform(l,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY));y=n.width*i;p=n.height*r;o&&(n.minHeight=p,n.minWidth=y);s!=!0?a=h._getMinMaxSize(n,y,p):(a.width=y,a.height=p);a&&a.width>1&&(d=n.offsetX-n.width/2,n.width=a.width,n.offsetX=d+n.width/2);a&&a.height>1&&(g=n.offsetY-n.height/2,n.height=a.height,n.offsetY=g+n.height/2);break;case"stack":l=t.Matrix.identity();t.Matrix.rotate(l,-n.rotateAngle,u.x,u.y);t.Matrix.scale(l,i,r,u.x,u.y);t.Matrix.rotate(l,n.rotateAngle,u.x,u.y);k=t.Matrix.transform(l,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY));y=n.width*i-(n.marginLeft+n.marginRight);p=n.height*r-(n.marginTop+n.marginBottom);a=h._getMinMaxSize(n,y,p);a.width>1&&(d=n.offsetX-n.width/2,n.width=a.width-n.marginLeft,n.offsetX=d+n.width/2+n.marginLeft);a.height>1&&(g=n.offsetY-n.height/2,n.height=a.height-n.marginTop,n.offsetY=g+n.height/2+n.marginTop);t.datavisualization.Diagram.SvgContext._alignOnStack(n,h)}else if(l=t.Matrix.identity(),n.segments)for(t.Matrix.scale(l,i,r,u.x,u.y),v=0;v<n.segments.length;v++){for(c=n.segments[v],w=0;w<c.points.length;w++)c.points[w]=t.Matrix.transform(l,c.points[w]),v!=0||w!=0||n.sourceNode||(c._startPoint=c.points[0],c._endPoint=c.points[c.points.length-1],t.datavisualization.Diagram.Util._setLineEndPoint(n,t.Matrix.transform(l,n.sourcePoint),!1)),v!=n.segments.length-1||w!=c.points.length-1||n.targetNode||(c._startPoint=c.points[0],c._endPoint=c.points[c.points.length-1],n.targetPoint=c._endPoint);c._startPoint=c.points[0];c._endPoint=c.points[c.points.length-1];c.type=="orthogonal"?c.length||c.length===0?c.length=c._length=t.datavisualization.Diagram.Geometry.distance(c._startPoint,c._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(c,n.segments[v-1],n.segments[v+1],n.sourcePoint,n.targetPoint):(c.point&&(c.point=c._endPoint),c._point=c._endPoint)}else if(n._type==="group"){for(nt=h._getChildren(n.children),v=0;v<nt.length;v++)b=f[nt[v]],b&&(this.scale(b,i,r,u,f),b.parent&&b.parent!=n.name&&n.type!="pseudoGroup"&&t.datavisualization.Diagram.Util._updateGroupBounds(f[b.parent],h));t.datavisualization.Diagram.Util._updateGroupBounds(n,h)}else{t.Matrix.rotate(l,-n.rotateAngle,u.x,u.y);t.Matrix.scale(l,i,r,u.x,u.y);t.Matrix.rotate(l,n.rotateAngle,u.x,u.y);var k=t.Matrix.transform(l,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),y=n.width*i,p=n.height*r;y>1&&(n.width=y,n.offsetX=k.x);p>1&&(n.height=p,n.offsetY=k.y)}},_getIntersectingElement:function(n,i){for(var u,f,r,h,o=t.datavisualization.Diagram.SpatialUtil.findQuads(n._spatialSearch,i),s=[],e=0;e<o.length;e++)if(u=o[e],u.objects.length>0)for(f=0;f<u.objects.length;f++)r=u.objects[f],r.visible&&(h=t.datavisualization.Diagram.Util.bounds(r),t.datavisualization.Diagram.Geometry.intersectsRect(i,h)&&(r=n._sortByZIndex(r,!0),s.push(r)));return s},_updateChildBounds:function(n,i){var u,f,e,o,r,s,h;e=n.width;o=n.height;u=n.offsetX;f=n.offsetY;r=t.datavisualization.Diagram.Util._getChildrenBounds(n,i);n.offsetX=r.x+r.width/2;n.offsetY=r.y+r.height/2;n.height=r.height;n.width=r.width;s=e/n.width;h=o/n.height;this.scale(n,s,h,n.pivot,i.nameTable,null,null,null,i);this._translate(n,u-n.offsetX,f-n.offsetY,i.nameTable,null,i)},_updateGroupBounds:function(n,i,r,u){var h,c,o,a,v,e,s;if(n&&!n.container&&n&&(n.type==="pseudoGroup"||n.children&&n.children.length>0)){h=n.width;c=n.height;o=n.offsetX;a=n.offsetY;u&&this._updateRotateAngle(n,i.nameTable);var f=this._getChildrenBounds(n,i,r),y=f.x+f.width*n.pivot.x,p=f.y+f.height*n.pivot.y,l={x:y,y:p};if(n.rotateAngle&&!i._isNodeInitializing&&(v=t.Matrix.identity(),t.Matrix.rotate(v,n.rotateAngle),l=t.Matrix.transform(v,l)),f&&(n.offsetX=l.x,n.offsetY=l.y,n.width=f.width,n.height=f.height),r){if(e=null,n.children&&n.children.length>0)for(s=0;s<n.children.length;s++)i._getChild(n.children[s])&&(e=i.nameTable[i._getChild(n.children[s])]),e&&(e._type==="group"||e.children&&e.children.length>0)&&this._updateGroupBounds(e,i,r);h&&h!=n.width&&i.scale(n,h/n.width,1,new t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),i.nameTable);c&&c!=n.height&&i.scale(n,1,c/n.height,new t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),i.nameTable);o&&o!=n.offsetX&&i._translate(n,o-n.offsetX,1,i.nameTable);o&&a!=n.offsetY&&i._translate(n,1,a-n.offsetY,i.nameTable)}}},_getChildrenBounds:function(n,i,r){var f=i._getChildren(n.children),e,o=t.datavisualization.Diagram.Rectangle(),u,s,h;for(f.length>0&&(u=i.nameTable[f[0]],u&&(o=this._rotateChildBounds(u,n,i))),s=0,h=f.length;s<h;s++)u=i.nameTable[f[s]],u&&(i.selectedItem||!u._isInternalShape)&&(u._type==="group"?(this._updateGroupBounds(u,i,r),e=this._rotateChildBounds(u,n,i)):e=this._rotateChildBounds(u,n,i)),e&&(o=t.datavisualization.Diagram.Geometry.union(o,e));return o},_updateRotateAngle:function(n,t){var i,r;if(n.offsetX==0&&n.offsetY==0&&n.width==0&&n.height==0)for(i=0;i<n.children.length;i++)if(r=t[n.children[i]],r&&!r.segments&&!n.rotateAngle){n.rotateAngle=r.rotateAngle;return}},_rotateChildBounds:function(n,i,r){var f,u;if(n.segments||(i.rotateAngle||n.rotateAngle)&&!r._isNodeInitializing){f=this.bounds(n);u=t.Matrix.identity();t.Matrix.rotate(u,-i.rotateAngle);var e=t.Matrix.transform(u,f.topLeft),o=t.Matrix.transform(u,f.topRight),s=t.Matrix.transform(u,f.bottomLeft),h=t.Matrix.transform(u,f.bottomRight),c=Math.min(e.x,o.x,s.x,h.x),l=Math.min(e.y,o.y,s.y,h.y);return{x:c,width:Math.max(e.x,o.x,s.x,h.x)-c,y:l,height:Math.max(e.y,o.y,s.y,h.y)-l}}return{x:n.offsetX-(n.width||n._width)*n.pivot.x,y:n.offsetY-(n.height||n._height)*n.pivot.y,width:n.width||n._width,height:n.height||n._height}},updateBridging:function(i,r,u){var lt,at,e=[],y,ft,et,l,ni,ot,p,w,ti,ii,ht,bt,ui,tt,kt,dt,fi,h,nt,v,b,o,ei,d,ut,a,gt,s,k,g,oi,si;if(u&&u.length){if(i.segments.length>0)for(h=0;h<i.segments.length;h++)for(v=i.segments[h]._bridges,y=0;y<v.length;y++)v[y]._target==u[0].name?v.splice(y,1):this.findLength(v[y].startPoint,v[y].endPoint)>u[0].bridgeSpace&&(r.nameTable[v[y]._target]&&u.push(r.nameTable[v[y]._target]),v.splice(y,1))}else if(i.segments.length>0)for(h=0;h<i.segments.length;h++)i.segments[h]._bridges=[];if(i._intersects=[],t.datavisualization.Diagram.Util.canBridge(i,r)){var vt=this.getPoints(i),c=i.bridgeSpace,yt=r.bridgeDirection(),pt=-1;if(lt=u&&r.boundaryTable[i.name]?r.boundaryTable[i.name]:t.datavisualization.Diagram.Util.bounds(i),r.boundaryTable[i.name]=lt,ft=u?u:r._getConnectors(),ft.length>0)for(et=0;et<ft.length;et++)if(l=ft[et],i.segments[0].type!="bezier"&&l.segments[0].type!="bezier"&&l.segments&&l.visible&&i.name!==l.name&&(at=r.boundaryTable[l.name]?r.boundaryTable[l.name]:t.datavisualization.Diagram.Util.bounds(l),r.boundaryTable[l.name]=at,t.datavisualization.Diagram.Geometry.intersectsRect(lt,at)&&(ni=this.getPoints(l),ot=this.interSect(vt,ni,!1,r,!0),i._intersects.push(l.name),ot.length>0)))for(b=0;b<ot.length;b++){var wt=0,f=0,it=0,rt=0,st=this.getLengthAtFractionPoint(i,ot[b]);if((it=st.lengthAtFractionPt,wt=st.fullLength,f=st.segmentIndex,rt=st.pointIndex,!(f<0))&&i.segments[0])if(ti=(it-c/2)/wt,p=this.getPointAtLength(it-c/2,vt),ti=(it+c/2)/wt,w=this.getPointAtLength(it+c/2,vt),t.datavisualization.Diagram.Geometry.isEmptyPoint(w)&&(w=p),ii=f===0?i.sourcePoint:i.segments[f-1]._endPoint,k=i.segments[f].type==="straight"?i.segments[f]._point:i.segments[f].points[rt],ht=this._findAngle(ii,k),e.length>f&&e[f]!=null){bt=f===0?i.sourcePoint:i.segments[f-1]._endPoint;var hi=Math.abs(this.findLength(bt,w)),ri=0,ct=-1;for(pt=-1,s=0;s<e[f].bridges.length;s++)if(pt++,ui=e[f].bridges[s],ri=Math.abs(this.findLength(bt,ui.endPoint)),hi<ri){ct=pt;break}ct>=0?(tt=this.createSegment(p,w,ht,yt,rt,i,r),tt._target=l.name,e[f].bridges.splice(ct,0,tt),e[f].bridges.join(),e[f].bridgeStartPoint.splice(ct,0,p),e[f].bridgeStartPoint.join(),e[f].segmentIndex=f):(tt=this.createSegment(p,w,ht,yt,rt,i,r),tt._target=l.name,e[f].bridges.push(tt),e[f].bridgeStartPoint.push(p),e[f].segmentIndex=f)}else isNaN(p.x)||isNaN(p.y)||t.datavisualization.Diagram.Geometry.isEmptyPoint(w)||(kt=this.createSegment(p,w,ht,yt,rt,i,r),kt._target=l.name,dt=[],fi=[],dt.push(p),fi.push(w),e.length<f+1,e[f]=n.extend(!0,{},t.datavisualization.Diagram.BridgeSegments,{}),e[f].bridges.push(kt),e[f].bridgeStartPoint=dt,e[f].segmentIndex=f)}if(u&&u.length&&i.segments.length>0)for(h=0;h<i.segments.length;h++)nt=i.segments[h],v=i.segments[h]._bridges,e[h]||(e[h]=n.extend(!0,{},t.datavisualization.Diagram.BridgeSegments),e[h].segmentIndex=h),e[h].bridges=e[h].bridges.concat(v).sort(function(n,t){return nt._startPoint.x!=nt._endPoint.x?nt._startPoint.x<nt._endPoint.x?n.startPoint.x-t.startPoint.x:t.startPoint.x-n.startPoint.x:nt._startPoint.y<nt._endPoint.y?n.startPoint.y-t.startPoint.y:t.startPoint.y-n.startPoint.y}),e[h].bridgeStartPoint=e[h].bridges.map(function(n){return n.startPoint}),i.segments[h]._bridges=[];if(e.length!=0)for(b=0;b<e.length;b++)if(o=e[b],o){for(s=1;s<o.bridges.length;s++)this.findLength(o.bridges[s].endPoint,o.bridges[s-1].endPoint)<c&&(o.bridges[s-1].endPoint=o.bridges[s].endPoint,a=o.bridges[s-1],ei=r.getBridgeSegment(a.startPoint,a.endPoint,a.angle,c,a.sweep),o.bridges[s-1].path=ei,u&&u.length&&o.bridges[s-1]._target==u[0].name&&(o.bridges[s-1]._target=o.bridges[s]._target),o.bridges.splice(s,1),o.bridgeStartPoint.splice(s,1),s--);for(d=i.sourcePoint,ut=0;ut<o.bridges.length;ut++){for(a=o.bridges[ut],gt=!0,s=0;u&&s<u.length;s++)a._target==u[s].name&&(gt=!1);gt?(i.segments[o.segmentIndex]._bridges.push(a),d=a.endPoint):(i.segments[o.segmentIndex].type==="straight"?k=i.segments[o.segmentIndex]._endPoint:i.segments[o.segmentIndex].type==="orthogonal"&&(k=i.segments[o.segmentIndex].points[a.segmentPointIndex]),f!=0&&(d=i.segments[o.segmentIndex]._endPoint),g=[],g.push(t.datavisualization.Diagram.Point(k.x-c,k.y-c)),g.push(t.datavisualization.Diagram.Point(k.x+c,k.y+c)),oi=t.datavisualization.Diagram.Geometry.rect(g),g=[],g.push(t.datavisualization.Diagram.Point(d.x-c,d.y-c)),g.push(t.datavisualization.Diagram.Point(d.x+c,d.y+c)),si=t.datavisualization.Diagram.Geometry.rect(g),t.datavisualization.Diagram.Geometry.containsPoint(oi,o.bridgeStartPoint[ut])||t.datavisualization.Diagram.Geometry.containsPoint(si,a.endPoint)||(i.segments[o.segmentIndex]._bridges.push(a),d=a.endPoint))}}}},createSegment:function(i,r,u,f,e,o,s){var l,c,h=n.extend(!0,{},t.datavisualization.Diagram.PathSegment);return c=this.sweepDirection(u,f,o,s),l=s.getBridgeSegment(i,r,u,o.bridgeSpace,c),h.path=l,h.startPoint=i,h.endPoint=r,h.angle=u,h.segmentPointIndex=e,h.sweep=c,h},sweepDirection:function(n,t){var r=Math.abs(n),i;return t==="top"||t==="bottom"?(i=1,r>=0&&r<=90&&(i=0)):(t==="right"||t==="left")&&(i=1,n<0&&n>=-180&&(i=0)),(t==="right"||t==="bottom")&&(i=i===0?1:0),i},getPointAtLength:function(n,i){for(var u,o,f=0,r=null,s=t.datavisualization.Diagram.Point(0,0),e=0;e<i.length;e++){if(u=i[e],r)if(o=this.findLength(r,u),f+o>n){var h=n-f,c=this.findAngle(r,u),l=h*Math.cos(c*Math.PI/180),a=h*Math.sin(c*Math.PI/180);s=t.datavisualization.Diagram.Point(r.x+l,r.y+a);break}else f+=o;else{r=u;continue}r=u}return s},getLengthAtFractionPoint:function(n,t){var c=100,o=0,l=-1,a=0,v=0,y=-1,f,e,s,w,i,r,h;if(n.segments===null)return 0;var b=n.segments,u=n.sourcePoint,p=u;for(f=0;f<n.segments.length;f++){for(e=[],s=n.segments[f],i=0;i<s.points.length;i++)w=s.points[i],e.push(w);for(i=0;i<e.length;i++)r=e[i],h=this.getSlope(r,u,t,n),h<c&&(c=h,v=o+this.findLength(t,p),l=a,y=i),o+=this.findLength(r,u),u=r,p=r;a++}return{lengthAtFractionPt:v,fullLength:o,segmentIndex:l,pointIndex:y}},getSlope:function(n,t,i,r){var e=3,o=Math.abs(n.x-t.x),s=Math.abs(n.y-t.y),u=(i.y-n.y)/(t.y-n.y),f=(i.x-n.x)/(t.x-n.x);return!isFinite(u)||!isFinite(f)||isNaN(u)||isNaN(f)?n.x===t.x?n.y===t.y?1e4:n.y>i.y&&i.y>t.y||n.y<i.y&&i.y<t.y?Math.abs(n.x-i.x):1e4:n.y==t.y?n.x>i.x&&i.x>t.x||n.x<i.x&&i.x<t.x?Math.abs(n.y-i.y):1e4:1e4:r.segments.length>0?n.x>=i.x&&i.x>=t.x||n.x<=i.x&&i.x<=t.x||o<e?n.y>=i.y&&i.y>=t.y||n.y<=i.y&&i.y<=t.y||s<e?Math.abs(u-f):1e4:1e4:1e4},getPoints:function(n){var r=[],t,i,u;if(n.segments.length>0)for(t=0;t<n.segments.length;t++)if(i=n.segments[t],i.type==="straight"||i.type==="bezier")t===0&&r.push(n.sourcePoint),i._point&&r.push(i._point);else if(i.type==="orthogonal")for(u=0;u<n.segments[t].points.length;u++)r.push(n.segments[t].points[u]);return r},interSect:function(n,t,i,r,u){var s,h,f,e,o;for(i&&t.length>=2&&(t.splice(0,1),t.splice(0,1)),s=[],h=r.bridgeDirection(),f=0;f<n.length-1;f++){if(e=this.interSect1(n[f],n[f+1],t,r,u,h),e.length>0)for(o=0;o<e.length;o++)s.push(e[o]);i&&t.length>=1&&t.splice(0,1)}return s},checkforHorizontalLine:function(n){var t=Math.abs(n);return t>90?180-t:t},interSect1:function(n,i,r,u,f,e){for(var c,s,h,l=[],o=0;o<r.length-1;o++)c=this.interSect2(n,i,r[o],r[o+1]),t.datavisualization.Diagram.Geometry.isEmptyPoint(c)||(s=this._findAngle(n,i),h=this._findAngle(r[o],r[o+1]),s=this.checkforHorizontalLine(s),h=this.checkforHorizontalLine(h),e==="left"||e==="right"?s>h&&l.push(c):(e==="top"||e==="bottom")&&s<h&&l.push(c),s===h&&f&&l.push(c));return l},interSect2:function(n,i,r,u){var e=t.datavisualization.Diagram.LineUtil(n.x,n.y,i.x,i.y),o=t.datavisualization.Diagram.LineUtil(r.x,r.y,u.x,u.y),f=this.interSect3(e,o);return f.enabled?f.intersectPt:t.datavisualization.Diagram.Point(0,0)},interSect3:function(n,i){var f=t.datavisualization.Diagram.Point(0,0),r=n,u=i,o=(u.y2-u.y1)*(r.x2-r.x1)-(u.x2-u.x1)*(r.y2-r.y1),h=(u.x2-u.x1)*(r.y1-u.y1)-(u.y2-u.y1)*(r.x1-u.x1),c=(r.x2-r.x1)*(r.y1-u.y1)-(r.y2-r.y1)*(r.x1-u.x1),e,s;return o==0?{enabled:!1,intersectPt:f}:(e=h/o,s=c/o,e>=0&&e<=1&&s>=0&&s<=1)?(f.x=r.x1+e*(r.x2-r.x1),f.y=r.y1+e*(r.y2-r.y1),{enabled:!0,intersectPt:f}):{enabled:!1,intersectPt:f}},findLength:function(n,t){try{return Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y))}catch(i){throw i;}},_findAngle:function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)*(180/Math.PI)},findAngle:function(n,i){if(t.datavisualization.Diagram.Geometry.isEqualPoint(n,i))return 0;var u=t.datavisualization.Diagram.Point(i.x,n.y),o=this.findLength(n,u),f=this.findLength(u,i),e=this.findLength(i,n),r=Math.asin(f/e);return r=r*180/Math.PI,n.x<i.x?n.y<i.y||(r=360-r):r=n.y<i.y?180-r:180+r,r},_mapPalettePhase:function(n){var i,r;return n.orientation&&n.orientation=="horizontal"?(i={x:0,y:0},r={x:40,y:0}):(i={x:0,y:0},r={x:0,y:40}),t.datavisualization.Diagram.Connector({name:n?n.name:t.datavisualization.Diagram.Util.randomId(),segments:[{type:"straight"}],sourcePoint:{x:i.x,y:i.y},targetPoint:{x:r.x,y:r.y},lineWidth:n.lineWidth?n.lineWidth:1,lineDashArray:n.lineDashArray?n.lineDashArray:null,lineColor:n.lineColor?n.lineColor:"#606060",targetDecorator:{shape:"none"},isPhase:!0,orientation:n.orientation?n.orientation:"horizontal",labels:n.label?[n.label]:[],paletteItem:n.paletteItem?n.paletteItem:null})},_updateShapeProperties:function(n){n._type="node";n.shape.type||(n.shape.type="rectangle");switch(n.shape.type){case"rectangle":n.type="basic";n._shape=n.shape.type;n.shape.cornerRadius&&(n.cornerRadius=n.shape.cornerRadius);break;case"ellipse":n.type="basic";n._shape=n.shape.type;break;case"path":n.type="basic";n._shape=n.shape.type;n.pathData=n.shape.pathData;break;case"polygon":n.type="basic";n._shape=n.shape.type;n.points=n.shape.points;break;case"image":n.type="image";n._shape=n.shape.type;n.source=n.shape.src;break;case"native":n.type="native";n._shape=n.shape.type;n.templateId=n.shape.templateId;break;case"text":n.type="text";n._shape=n.shape.type;n.textBlock=n.shape.textBlock;break;case"html":n.type="html";n._shape=n.shape.type;n.templateId=n.shape.templateId}},_refreshParentGroup:function(n,i){var r=i.nameTable[n.parent],u;r&&(this._updateGroupBounds(r,i),u=r.parent?document.getElementById(r.parent):i._diagramLayer,t.datavisualization.Diagram.DiagramContext.renderGroup(r,i))},intersectsWith:function(n,t){var i=t;return n.x<i.x&&i.x<n.x+n.width&&n.y<i.y&&i.y<n.y+n.height},_findOffsetOnConnector:function(n,i,r,u){for(var e,a,k,l,y=0,o=[],f=0;f<n.segments.length;f++)for(o[f]=[],e=0;e<n.segments[f].points.length-1;e++)y+=t.datavisualization.Diagram.Geometry.distance(n.segments[f].points[e],n.segments[f].points[e+1]),o[f][e]=y;var p=n.sourceNode&&i.offset==0&&u.nameTable[n.sourceNode]||n.targetNode&&i.offset==1&&u.nameTable[n.targetNode],s=p?this.bounds(p):null,r=i.segmentOffset||0,v,c,b,h,w=y*r;for(f=0;f<o.length;f++)for(e=0;e<o[f].length;e++){if(o[f][e]>=w){if(c=n.segments[f],b=t.datavisualization.Diagram.Geometry.findAngle(c.points[e],n.segments[f].points[e+1]),h=t.datavisualization.Diagram.Geometry.transform(c.points[e],b,w-(v||0)),p){if(this.intersectsWith(s,h)&&!t.datavisualization.Diagram.Geometry.containsRect(s,this.bounds(n))){k=i.offset==0?this._getBezierDirection(c.points[e],n.segments[f].points[e+1]):this._getBezierDirection(c.points[e+1],n.segments[f].points[e]);a=i.offset==0?c.points[e+1]:c.points[e];l=!1;switch(k){case"top":s.y>a.y?h.y=s.top:l=!0;break;case"bottom":s.bottom<a.y?h.y=s.bottom:l=!0;break;case"right":s.right<a.x?h.x=s.right:l=!0;break;case"left":s.left>a.x?h.x=s.left:l=!0}if(l){w=i.offset==1?v||0:o[f][e];v=i.offset==0?o[f][e]:o[f][e-2]||(o[f-1]&&o[f-1].length>1?o[f-1][o[f-1].length-1]:o[f-2]&&o[f-2][o[f-2].length-1])||0;i.offset==0?f=f:e?e-=2:f-=2;continue}}return{segment:f,point:e,offset:{x:h.x,y:h.y}}}return{segment:f,point:e,offset:{x:h.x,y:h.y}}}v=o[f][e]}},_alignLabelOnSegments:function(n,i,r,u){var b=u.angle%360,y,c,f,e,p,w,o;u.angle%=360;var s=45,l=135,h=225,v=315,a;(i.segmentOffset==0&&n.sourceNode||i.segmentOffset==1&&n.targetNode)&&(y=i.segmentOffset==0&&n.sourceNode?r.nameTable[n.sourceNode]:r.nameTable[n.targetNode],y&&(a=this.bounds(y)),a&&(c=180/(2+2/(a.height/a.width)),s=c,l=180-c,h=l+2*c,v=360-c));switch(i.alignment){case"before":u.angle>=s&&u.angle<=l?(f="right",e=i.segmentOffset==.5?"center":"top"):u.angle>=h&&u.angle<=v?(f="left",e=i.segmentOffset==.5?"center":"bottom"):u.angle>s&&u.angle<h?(e="top",f=i.segmentOffset==.5?"center":"right"):(e="bottom",f=i.segmentOffset==.5?"center":"left");break;case"after":u.angle>=s&&u.angle<=l?(f="left",e=i.segmentOffset==.5?"center":"top"):u.angle>=h&&u.angle<=v?(f="right",e=i.segmentOffset==.5?"center":"bottom"):u.angle>s&&u.angle<h?(e="bottom",f=i.segmentOffset==.5?"center":"right"):(e="top",f=i.segmentOffset==.5?"center":"left");break;case"center":if(f="center",e="center",i.boundaryConstraints&&(i.segmentOffset==0||i.segmentOffset==1)){n.segments.length>1&&(o=n.segments[n.segments.length-1]);p=o?o.points.length:n.segments[0].points.length;n.labels[0].name==i.name?w=t.datavisualization.Diagram.Util._getBezierDirection(n.segments[0].points[0],n.segments[0].points[1]):(o=o?o:n.segments[0],w=t.datavisualization.Diagram.Util._getBezierDirection(o.points[p-2],o.points[p-1]));switch(w){case"left":f=i.segmentOffset==0?"right":"left";break;case"right":f=i.segmentOffset==0?"left":"right";break;case"bottom":e=i.segmentOffset==0?"top":"bottom";break;case"top":e=i.segmentOffset==0?"bottom":"top"}}}return{hAlign:f,vAlign:e}},getObjectType:function(n){return n?n.segments?"connector":n._type==="node"||n.type=="bpmn"||n.type=="basic"||n.type=="flow"||n.type=="arrow"?"node":n.type==="text"||n.type==="image"||n.type==="native"||n.type==="html"?"node":n._type!="group"&&n.type=="pseudoGroup"?"pseudoGroup":n._type==="group"||n.isLane||n.isSwimlane?"group":n.isSwimlane?"swimlane":null:null},_canBeTarget:function(n,t){return t&&n.activeTool.helper&&n.activeTool.helper._name&&n.activeTool.helper._name===t.name?!1:!0},getLabelbounds:function(i,r,u){var o=i._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s=o.getBoundingClientRect(),e,f;if(u&&(e=n(o).find("#"+r.name+"_"+u.name)[0],e))return f=e.getBoundingClientRect(),t.datavisualization.Diagram.Rectangle(f.left-s.left,f.top-s.top,f.right-f.left,f.bottom-f.top)},_updateBpmnChild:function(n,i){switch(n.shape){case"event":n=t.datavisualization.Diagram.DefautShapes._getBPMNEventShape(n,i);break;case"gateway":n=t.datavisualization.Diagram.DefautShapes._getBPMNGatewayShape(n,i);break;case"dataobject":n=t.datavisualization.Diagram.DefautShapes._getBPMNDataShape(n,i);break;case"activity":n=t.datavisualization.Diagram.DefautShapes._getBPMNActivityShape(n,i)}return t.datavisualization.Diagram.DefautShapes.initBPMNAnnotationShape(n,i)},_getUndoObject:function(t,i){var r={},r=t._getChildTable(i,r);t.activeTool._undoObject=n.extend(!0,{},{node:i,childTable:r})},_getRedoObject:function(t,i){var r={},r=t._getChildTable(i,r);t.activeTool._redoObject=n.extend(!0,{},{node:i,childTable:r})},_collectionContains:function(n,t){for(var i=0;i<t.length;i++)if(typeof t[i]=="string"&&t[i]===n||t[i].name===n)return!0},_updateBPMNProperties:function(n,i,r,u){var o,w,f,e,l,a,s,v;switch(n.shape){case"activity":var h=t.datavisualization.Diagram.Util.bounds(n,!0),y=n.offsetX,p=n.offsetY,c=i._getChildren(n.children);for(s=0;s<c.length;s++)(o=typeof c[s]=="object"?c[s]:r[c[s]],u&&s==0&&(h=t.datavisualization.Diagram.Util.bounds(o,!0),y=o.offsetX,p=o.offsetY),s==0&&(o.pathData=o._absolutePath=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(n,12),n.subProcess.type=="transaction"&&(w={x:3,y:3,width:n.width-3,height:n.height-3},o.pathData=o._absolutePath+=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(w,12)),delete o._absoluteBounds),u&&t.datavisualization.Diagram.Util.canResize(o))||(f=o.addInfo,f.offset&&(e=t.datavisualization.Diagram.Point(h.x+h.width*f.offset.x,h.y+h.height*f.offset.y),f.margin=t.datavisualization.Diagram.Margin(f.margin?f.margin:{}),f.hAlign&&(e.x+=f.margin.left-f.margin.right,e.x=f.hAlign=="left"?e.x+f.margin.right:f.hAlign=="right"?e.x-f.margin.left:e.x),f.vAlign&&(e.y+=f.margin.top-f.margin.bottom,e.y=f.vAlign=="top"?e.y+f.margin.bottom:f.vAlign=="bottom"?e.y-f.margin.top:e.y),n.rotateAngle&&(l=t.Matrix.identity(),t.Matrix.rotate(l,n.rotateAngle,y,p),e=t.Matrix.transform(l,e)),o.offsetX=e.x,o.offsetY=e.y));break;case"group":n.pathData=n._absolutePath=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(n,15);n._scaled=!1;break;case"annotation":for(s=0;s<n.outEdges.length;s++)if(v=i.nameTable[n.outEdges[s]],v._isAnnotationLine){a=v;break}a&&t.datavisualization.Diagram.DefautShapes.updateBPMNAnnotationShape(a,null,null,i)}}};t.datavisualization.Diagram.BridgeSegments={bridges:[],bridgeStartPoint:[],segmentIndex:-1};t.datavisualization.Diagram.PathSegment={path:"",startPoint:{x:0,y:0},endPoint:{x:0,y:0},angle:0,segmentPointIndex:-1,sweep:1};t.datavisualization.Diagram.LineUtil=function(n,t,i,r){return{x1:Number(n)||0,y1:Number(t)||0,x2:Number(i)||0,y2:Number(r)||0}};t.datavisualization.Diagram.Geometry={checkPointOnCircle:function(n,t,i){var r=Math.pow(i,2),u=Math.pow(n.x-t.x,2),f=Math.pow(n.y-t.y,2);return u+f<=r?!0:!1},rect:function(n){var c=t.datavisualization.Diagram.Rectangle(),e,i,r,h;if(arguments.length===1){var o=Number.MAX_VALUE,s=Number.MAX_VALUE,l=-Number.MAX_VALUE,a=-Number.MAX_VALUE,v=n.length,u,f;for(e=0;e<v;e++)u=n[e].x,f=n[e].y,u<o&&(o=u),u>l&&(l=u),f<s&&(s=f),f>a&&(a=f);c=t.datavisualization.Diagram.Rectangle(o,s,l-o,a-s)}else arguments.length===2&&(i=t.datavisualization.Diagram.Point(arguments[0]),r=t.datavisualization.Diagram.Point(arguments[1]),i.x>r.x&&(h=i.x,i.x=r.x,r.x=h),i.y>r.y&&(h=i.y,i.y=r.y,r.y=h),c=t.datavisualization.Diagram.Rectangle(i.x,i.y,r.x-i.x,r.y-i.y));return c},union:function(n,i){var r=Math.min(n.x,i.x),u=Math.min(n.y,i.y),f=Math.max(n.x+n.width,i.x+i.width),e=Math.max(n.y+n.height,i.y+i.height);return t.datavisualization.Diagram.Rectangle(r,u,f-r,e-u)},distance:function(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))},translate:function(n,i,r){return t.datavisualization.Diagram.Point(n.x+i,n.y+r)},intersectsRect:function(n,t){return t.x<n.x+n.width&&n.x<t.x+t.width&&t.y<n.y+n.height&&n.y<t.y+t.height},findAngle:function(n,t){var i=Math.atan2(t.y-n.y,t.x-n.x);return i=180*i/Math.PI,i%=360,i<0&&(i+=360),i},intersectSegment:function(n,i){var a=n.point1.x,v=n.point1.y,y=n.point2.x,p=n.point2.y,w=i.point1.x,b=i.point1.y,k=i.point2.x,d=i.point2.y,e,o,s,h,c,l,rt,ut,g,nt,tt,it,r,f,u;return(e=p-v,s=a-y,c=y*v-a*p,tt=e*w+s*b+c,it=e*k+s*d+c,tt!==0&&it!==0&&this.sameSign(tt,it))?null:(o=d-b,h=w-k,l=k*b-w*d,g=o*a+h*v+l,nt=o*y+h*p+l,g!==0&&nt!==0&&this.sameSign(g,nt))?null:(r=e*h-o*s,r===0)?null:(f=r<0?-r/2:r/2,f=0,u=s*l-h*c,rt=u<0?(u-f)/r:(u+f)/r,u=o*c-e*l,ut=u<0?(u-f)/r:(u+f)/r,t.datavisualization.Diagram.Point(rt,ut))},updatePath:function(n,i,r,u,f,e,o,s){var h,c;e&&e.pathBounds?(c=!0,h=o||e.pathBounds(f)):(c=s&&!s._absolutePath?!0:!1,h=o);s&&(s._absoluteBounds=h);var l=0,a=0,v=!1;return(n.toString()!==h.x||i.toString()!==h.y)&&(l=n-Number(h.x),a=i-Number(h.y)),(r!==h.width||u!==h.height)&&(l=r/Number(h.width),a=u/Number(h.height),v=!0),t.datavisualization.Diagram.Geometry.processPathData(f,l,a,v,h.x,h.y,n,i,c,e)},processPathData:function(n,i,r,u,f,e,o,s,h,c){var rt=document.createElementNS("http://www.w3.org/2000/svg","path"),ut,ft,p,w,b,k,d,v,nt,y,tt,it;rt.setAttribute("d",n);h&&(c=c||new t.datavisualization.Diagram.Svg({}),n=c.absolutePath(rt).getAttribute("d"),rt.setAttribute("d",n));d=t.datavisualization.Diagram.Util.convertPathToArray(n);for(var l=0,a=0,g=0,et=d.length;g<et;++g){v=d[g];nt=v.pathSegTypeAsLetter;"x1"in v&&(p=v.x1);"x2"in v&&(b=v.x2);"y1"in v&&(w=v.y1);"y2"in v&&(k=v.y2);"x"in v&&(l=v.x);"y"in v&&(a=v.y);u?(l!=undefined&&(l=t.datavisualization.Diagram.Geometry.scalePathData(l,i,f,o),l=Number(l.toFixed(2))),a!=undefined&&(a=t.datavisualization.Diagram.Geometry.scalePathData(a,r,e,s),a=Number(a.toFixed(2))),p!=undefined&&(p=t.datavisualization.Diagram.Geometry.scalePathData(p,i,f,o),p=Number(p.toFixed(2))),w!=undefined&&(w=t.datavisualization.Diagram.Geometry.scalePathData(w,r,e,s),w=Number(w.toFixed(2))),b!=undefined&&(b=t.datavisualization.Diagram.Geometry.scalePathData(b,i,f,o),b=Number(b.toFixed(2))),k!=undefined&&(k=t.datavisualization.Diagram.Geometry.scalePathData(k,r,e,s),k=Number(k.toFixed(2)))):(l!=undefined&&(l=l+i),a!=undefined&&(a=a+r),p!=undefined&&(p=p+i),w!=undefined&&(w=w+r),b!=undefined&&(b=b+i),k!=undefined&&(k=k+r));switch(nt){case"M":y={pathSegTypeAsLetter:"M",x:l,y:a};break;case"L":y={pathSegTypeAsLetter:"L",x:l,y:a};break;case"H":y={pathSegTypeAsLetter:"H",x:l};break;case"V":y={pathSegTypeAsLetter:"V",y:a};break;case"C":y={pathSegTypeAsLetter:"C",x:l,y:a,x1:p,y1:w,x2:b,y2:k};break;case"S":y={pathSegTypeAsLetter:"S",x:l,y:a,x2:b,y2:k};break;case"Q":y={pathSegTypeAsLetter:"Q",x:l,y:a,x1:p,y1:w};break;case"T":y={pathSegTypeAsLetter:"T",x:l,y:a};break;case"A":tt=v.r1;it=v.r2;u&&(tt=tt*i,it=it*r);y={pathSegTypeAsLetter:"A",x:l,y:a,r1:tt,r2:it,angle:v.angle,largeArcFlag:v.largeArcFlag,sweepFlag:v.sweepFlag};break;case"z":case"Z":l=ut;a=ft;y=d[g]}y&&(d[g]=y);(nt==="M"||nt==="m")&&(ut=l,ft=a)}return t.datavisualization.Diagram.Util.pathSegArrayAsString(d)},scalePathData:function(n,t,i,r){return n!==i?n=r!==i?n*t-(Number(i)*t-Number(i))+(r-Number(i)):Number(n)*t-(Number(i)*t-Number(i)):r!==i&&(n=r),n},updatePolygonPoints:function(n,i){var f,r,e,u;if(n.points)for(i||(i=n.points),t.datavisualization.Diagram.Geometry.scalePoints(i,n),f=t.datavisualization.Diagram.Geometry.rect(n.points),r=0,e=n.points.length;r<e;++r)u=t.datavisualization.Diagram.Geometry.translate(i[r],-f.x,-f.y),u=t.datavisualization.Diagram.Geometry.translate(u,0,0),i[r]=u},scalePoints:function(n,i){var u=t.datavisualization.Diagram.Geometry.rect(i.points),f,e,r,o;if(u.width>0&&u.height>0)for(f=i.width/u.width,e=i.height/u.height,r=0,o=i.points.length;r<o;++r)n[r].x=n[r].x*f,n[r].y=n[r].y*e},sameSign:function(n,t){return n*t>=0},containsPoint:function(n,t){return n.x<=t.x&&t.x<=n.x+n.width&&n.y<=t.y&&t.y<=n.y+n.height},containsRect:function(n,t){return n.x<=t.x&&t.x+t.width<=n.x+n.width&&n.y<=t.y&&t.y+t.height<=n.y+n.height},inflate:function(n,t,i){n.x-=t;n.y-=i;n.width+=2*t;n.height+=2*i},isEmptyRect:function(n){return n.x===0&&n.y===0&&n.width===0&&n.height===0},isEmptyPoint:function(n){return n.x===0&&n.y===0},isEqualPoint:function(n,t){return n.x===t.x&&n.y===t.y},isEmptySize:function(n){return n.width===0&&n.height===0},length:function(n){return t.datavisualization.Diagram.Geometry.distance(n.point1,n.point2)},midPoint:function(n){return t.datavisualization.Diagram.Point((n.point1.x+n.point2.x)/2,(n.point1.y+n.point2.y)/2)},transform:function(n,t,i){var r={};return r.x=Math.round((n.x+i*Math.cos(t*Math.PI/180))*100)/100,r.y=Math.round((n.y+i*Math.sin(t*Math.PI/180))*100)/100,r}};t.datavisualization.Diagram.LineSegment=function(n,t){return{point1:n,point2:t}};t.datavisualization.Diagram.Point=function(n,t){return{x:Number(n)||0,y:Number(t)||0}};t.datavisualization.Diagram.Size=function(n,t){return{width:Number(n)||0,height:Number(t)||0}};t.datavisualization.Diagram.Rectangle=function(n,t,i,r){return{x:Number(n)||0,y:Number(t)||0,width:Number(i)||0,height:Number(r)||0}};t.datavisualization.Diagram.ImageAlignment={None:"none",XMinYMin:"xminymin",XMinYMid:"xminymid",XMinYMax:"xminymax",XMidYMin:"xmidymin",XMidYMid:"xmidymid",XMidYMax:"xmidymax",XMaxYMin:"xmaxymin",XMaxYMid:"xmaxymid",XMaxYMax:"xmaxymax"};t.datavisualization.Diagram.ScaleConstraints={None:"none",Stretch:"stretch",Meet:"meet",Slice:"slice"};t.datavisualization.Diagram.KeyModifiers={None:0,Control:1,Meta:1,Alt:2,Shift:4};t.datavisualization.Diagram.Keys={None:"",Number0:0,Number1:1,Number2:2,Number3:3,Number4:4,Number5:5,Number6:6,Number7:7,Number8:8,Number9:9,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Left:37,Up:38,Right:39,Down:40,Escape:27,Delete:46,Tab:9,Enter:13};t.datavisualization.Diagram.DecoratorShapes={None:"none",Arrow:"arrow",OpenArrow:"openarrow",Circle:"circle",Diamond:"diamond",Path:"path"};t.datavisualization.Diagram.ActionType={Unknown:"unknown",Nudge:"nudge",Touch:"touch",Mouse:"mouse",Order:"order",Align:"align",Size:"size",HistoryChange:"historyChange"};t.datavisualization.Diagram.dependentconnector={dependent:1,independent:2};t.datavisualization.Diagram.ContainerType={Canvas:"canvas",Stack:"stack"};t.datavisualization.Diagram.IconShapes={Minus:"minus",Plus:"plus",ArrowUp:"arrowup",ArrowDown:"arrowdown",Template:"template",Path:"path",Image:"image",None:"none"};t.datavisualization.Diagram.PortShapes={X:"x",Circle:"circle",Square:"square",Path:"path"};t.datavisualization.Diagram.PortVisibility={Visible:1,Hidden:2,Hover:4,Connect:8,Default:8};t.datavisualization.Diagram.TextAlign={Left:"left",Center:"center",Right:"right",Justify:"justify"};t.datavisualization.Diagram.HorizontalAlignment={Left:"left",Center:"center",Right:"right",Stretch:"stretch"};t.datavisualization.Diagram.Alignment={Before:"before",After:"after",Center:"center"};t.datavisualization.Diagram.LabelRelativeMode={SegmentBounds:"segmentbounds",SegmentPath:"segmentpath"};t.datavisualization.Diagram.LabelEditMode={Edit:"edit",View:"view"};t.datavisualization.Diagram.RelativeMode={Object:"object",Mouse:"mouse"};t.datavisualization.Diagram.TextWrapping={NoWrap:"nowrap",Wrap:"wrap",WrapWithOverflow:"wrapwithoverflow"};t.datavisualization.Diagram.VerticalAlignment={Top:"top",Center:"center",Bottom:"bottom",Stretch:"stretch"};t.datavisualization.Diagram.TextDecorations={Underline:"underline",Overline:"overline",LineThrough:"line-through",None:"none"};t.datavisualization.Diagram.PaletteConstraints={HeaderVisibility:2,Visible:4,Expandable:8,Default:14};t.datavisualization.Diagram.NodeConstraints={None:1,Select:2,Delete:4,Drag:8,Rotate:16,Connect:32,ResizeNorthEast:64,ResizeEast:128,ResizeSouthEast:256,ResizeSouth:512,ResizeSouthWest:1024,ResizeWest:2048,ResizeNorthWest:4096,ResizeNorth:8192,Resize:16320,Shadow:16384,DragLabel:32768,AllowPan:65536,AspectRatio:131072,AllowDrop:262144,InheritTooltip:524288,MultiSelect:1048576,PointerEvents:2097152,PointerVisibility:2097152,Interaction:16347,Default:2637822};t.datavisualization.Diagram.CollectionChangeCause={ClipBoard:"clipBoard",Drop:"drop",HistoryChange:"historyChange",Unknown:"unknown"};t.datavisualization.Diagram.SelectionChangeCause={Keydown:"keydown",RubberBand:"rubberBand",Mouse:"mouse",Touch:"touch",Unknown:"unknown"};t.datavisualization.Diagram.ScrollChangeCause={Zoom:"zoom",Pan:"pan",Unknown:"unknown"};t.datavisualization.Diagram.ConnectorConstraints={None:1,Select:2,Delete:4,Drag:8,DragSourceEnd:16,DragTargetEnd:32,DragSegmentThumb:64,Bridging:128,DragLabel:256,InheritBridging:512,AllowDrop:1024,InheritTooltip:2048,PointerEvents:4096,PointerVisibility:4096,Interaction:122,Default:6782};t.datavisualization.Diagram.PortConstraints={None:1,Connect:2};t.datavisualization.Diagram.SelectorConstraints={None:1,Rotator:2,Resizer:4,UserHandles:8,Tooltip:16,All:30};t.datavisualization.Diagram.UserHandlePositions={TopLeft:"topleft",TopCenter:"topcenter",TopRight:"topright",MiddleLeft:"middleleft",MiddleRight:"middleright",BottomLeft:"bottomleft",BottomCenter:"bottomcenter",BottomRight:"bottomright"};t.datavisualization.Diagram.SnapConstraints={None:0,SnapToHorizontalLines:1,SnapToVerticalLines:2,SnapToLines:3,ShowHorizontalLines:4,ShowVerticalLines:8,ShowLines:12,All:15};t.datavisualization.Diagram.PageOrientations={Landscape:"landscape",Portrait:"portrait"};t.datavisualization.Diagram.ScrollLimit={Infinity:"infinity",Diagram:"diagram",Limited:"limited"};t.datavisualization.Diagram.BoundaryConstraints={Infinity:"infinity",Diagram:"diagram",Page:"page"};t.datavisualization.Diagram.LayoutOrientations={TopToBottom:"toptobottom",BottomToTop:"bottomtotop",LeftToRight:"lefttoright",RightToLeft:"righttoleft"};t.datavisualization.Diagram.ObjectTypes={Diagram:"diagram",Palette:"palette",Lane:"lane",Group:"group"};t.datavisualization.Diagram.PaletteDefaults={name:"",expanded:!1,subControlId:null,items:[],constraints:t.datavisualization.Diagram.PaletteConstraints.Default};t.datavisualization.Diagram.Palette=function(i){return n.extend(!0,{},t.datavisualization.Diagram.PaletteDefaults,i)};t.datavisualization.Diagram.Shapes={Image:"image",Text:"text",Html:"html",Native:"native",Basic:"basic",Flow:"flow",Arrow:"arrow",BPMN:"bpmn"};t.datavisualization.Diagram.ShapeDefaults={shape:"",source:"",pathData:"",textBlock:null,points:[],templateId:null,scale:"meet",contentAlignment:"xmidymid"};t.datavisualization.Diagram.Shape=function(i){return i&&(i.type==="html"&&typeof i.html=="string"&&(i.html=t.datavisualization.Diagram.Util.htmlEncode(i.html)),i.type==="text"&&(i.textBlock=t.datavisualization.Diagram.TextBlock(i.textBlock?i.textBlock:{})),(i.type=="image"||i.type=="native"||i.type==="text"||i.type==="html")&&(i._shape=i.type),i._type||(i._type=i.type?i.type:"node"),i._shape||(i._shape=i.shape?i.shape:"rectangle")),n.extend(!0,{},t.datavisualization.Diagram.ShapeDefaults,i)};t.datavisualization.Diagram.Segments={Straight:"straight",Orthogonal:"orthogonal",Bezier:"bezier"};t.datavisualization.Diagram.SegmentDefaults={type:t.datavisualization.Diagram.Segments.Straight,point:null,point1:null,point2:null,vector1:null,vector2:null,_point1:t.datavisualization.Diagram.Point(),_point2:t.datavisualization.Diagram.Point(),length:null,_length:null,_bridges:[],direction:null,_direction:null};t.datavisualization.Diagram.Segment=function(i){var r=n.extend(!0,{},t.datavisualization.Diagram.SegmentDefaults,i);return r.points=[],r.type=="orthogonal"?(r._length=r.length,r._direction=r.direction):(r.type=="bezier"&&(r._point1=r.point1,r._point2=r.point2),r.point&&(r._point=r.point)),r};t.datavisualization.Diagram.MarginDefaults={top:0,left:0,right:0,bottom:0};t.datavisualization.Diagram.Margin=function(i){return n.extend(!0,{},t.datavisualization.Diagram.MarginDefaults,i)};t.datavisualization.Diagram.GestureDefaults={key:t.datavisualization.Diagram.Keys.None,keyModifiers:t.datavisualization.Diagram.KeyModifiers.None};t.datavisualization.Diagram.Gesture=function(i){return n.extend(!0,{},t.datavisualization.Diagram.GestureDefaults,i)};t.datavisualization.Diagram.CommandDefaults={gesture:t.datavisualization.Diagram.Gesture(),execute:null,canExecute:null,parameter:null};t.datavisualization.Diagram.Command=function(i){return i.gesture&&(i.gesture=t.datavisualization.Diagram.Gesture(i.gesture)),i.canExecute||(i.canExecute=function(){return!0}),i.execute||(i.execute=function(){}),n.extend(!0,{},t.datavisualization.Diagram.CommandDefaults,i)};t.datavisualization.Diagram.TooltipDefaults={templateId:"",relativeMode:"object",alignment:{horizontal:"center",vertical:"bottom"},margin:{left:5,right:5,top:5,bottom:5},offset:null,delay:0};t.datavisualization.Diagram.Tooltip=function(i){return n.extend(!0,{},t.datavisualization.Diagram.TooltipDefaults,i)};t.datavisualization.Diagram.BackgroundImageDefaults={source:"",alignment:"xmidymid",scale:"meet"};t.datavisualization.Diagram.BackgroundImage=function(i){return n.extend(!0,{},t.datavisualization.Diagram.BackgroundImageDefaults,i)};t.datavisualization.Diagram.Path=function(){this._path=""};t.datavisualization.Diagram.Path.prototype={moveTo:function(n,t){return this._path+="M"+n+","+t,this},lineTo:function(n,t){return this._path+="L"+n+","+t,this},cubicBezierTo:function(n,t){return this._path+=t?"S":"C",this._addPoints(n),this},quadraticBezierTo:function(n,t){return this._path+=t?"T":"Q",this._addPoints(n),this},ellipticalArcTo:function(n,t,i,r,u,f,e){return this._path+="A"+n+","+t+" "+i+" "+r+","+u+" "+f+","+e,this},close:function(){return this._path+="Z",this},toString:function(){return this._path},_addPoints:function(n){for(var i,t=0;t<n.length;t++)i=n[t],this._path+=i.x+", "+i.y,t!==n.length-1&&(this._path+=" ")}};t.datavisualization.Diagram.DecoratorDefaults={shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",borderWidth:1,fillColor:"black",pathData:"",cssClass:""};t.datavisualization.Diagram.Decorator=function(i){return n.extend(!0,{},t.datavisualization.Diagram.DecoratorDefaults,i)};t.datavisualization.Diagram.TextBlockDefaults={readOnly:!1,bold:!1,italic:!1,text:"",textDecoration:t.datavisualization.Diagram.TextDecorations.None,fontSize:12,fontFamily:"Arial",fontColor:"black",boundaryConstraints:!0,segmentOffset:.5,offset:t.datavisualization.Diagram.Point(.5,.5),textAlign:t.datavisualization.Diagram.TextAlign.Center,alignment:t.datavisualization.Diagram.Alignment.Center,relativeMode:t.datavisualization.Diagram.LabelRelativeMode.SegmentPath,horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Center,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Center,wrapping:t.datavisualization.Diagram.TextWrapping.WrapWithOverflow,margin:t.datavisualization.Diagram.Margin(),mode:t.datavisualization.Diagram.LabelEditMode.Edit,width:50,rotateAngle:0,opacity:1};t.datavisualization.Diagram.TextBlock=function(i){return i.wrapText!==undefined&&(i.wrapping=i.wrapText?"wrapwithoverflow":"nowrap"),n.extend(!0,{},t.datavisualization.Diagram.TextBlockDefaults,i)};t.datavisualization.Diagram.LabelDefaults=n.extend(!0,{},t.datavisualization.Diagram.TextBlockDefaults,{name:"",visible:!0,borderColor:"transparent",borderWidth:0,fillColor:"transparent",cssClass:""});t.datavisualization.Diagram.Label=function(i){var r=n.extend(!0,{},t.datavisualization.Diagram.LabelDefaults,i);return r.name||(r.name="label_"+t.datavisualization.Diagram.Util.randomId()),r};t.datavisualization.Diagram.PrintSettingsDefaults={multiplePage:!1,pageWidth:null,pageHeight:null,pageOrientation:"portrait",margin:{left:0,top:0,right:0,bottom:0},region:"pageSettings"};t.datavisualization.Diagram.PrintSettings=function(i){return n.extend(!0,{},t.datavisualization.Diagram.PrintSettingsDefaults,i)};t.datavisualization.Diagram.IconDefaults={shape:t.datavisualization.Diagram.IconShapes.None,width:15,height:15,offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,margin:t.datavisualization.Diagram.Margin(),cornerRadius:0,fillColor:"white",source:"",pathData:"",templateId:""};t.datavisualization.Diagram.expandIcon=function(i){return n.extend(!0,{},t.datavisualization.Diagram.IconDefaults,i)};t.datavisualization.Diagram.collapseIcon=function(i){return n.extend(!0,{},t.datavisualization.Diagram.IconDefaults,i)};t.datavisualization.Diagram.PortDefaults={name:"",visibility:t.datavisualization.Diagram.PortVisibility.Default,constraints:t.datavisualization.Diagram.PortConstraints.Connect,size:8,offset:t.datavisualization.Diagram.Point(0,0),borderColor:"#1a1a1a",borderWidth:1,fillColor:"white",shape:t.datavisualization.Diagram.PortShapes.Square,pathData:"",connectorPadding:0,cssClass:"",margin:t.datavisualization.Diagram.Margin()};t.datavisualization.Diagram.ShadowDefaults={distance:5,angle:45,opacity:.7};t.datavisualization.Diagram.Shadow=function(i){return n.extend(!0,{},t.datavisualization.Diagram.ShadowDefaults,i)};t.datavisualization.Diagram.Port=function(i){var r=n.extend(!0,{},t.datavisualization.Diagram.PortDefaults,i);return r.name||(r.name="port_"+t.datavisualization.Diagram.Util.randomId()),r};t.datavisualization.Diagram.StopDefaults={color:"",offset:0,opacity:1};t.datavisualization.Diagram.Stop=function(i){return n.extend(!0,{},t.datavisualization.Diagram.StopDefaults,i)};t.datavisualization.Diagram.LinearGradientDefaults={type:"linear",x1:0,x2:0,y1:0,y2:0,stops:[]};t.datavisualization.Diagram.LinearGradient=function(i){for(var r=0;i.stops&&r<i.stops.length;r++)i.stops[r]=t.datavisualization.Diagram.Stop(i.stops[r]);return n.extend(!0,{},t.datavisualization.Diagram.LinearGradientDefaults,i)};t.datavisualization.Diagram.RadialGradientDefaults={type:"radial",cx:0,cy:0,fx:0,fy:0,r:50,stops:[]};t.datavisualization.Diagram.RadialGradient=function(i){for(var r=0;r<i.stops.length;r++)i.stops[r]=t.datavisualization.Diagram.Stop(i.stops[r]);return n.extend(!0,{},t.datavisualization.Diagram.RadialGradientDefaults,i)};t.datavisualization.Diagram.NodeBaseDefaults={name:"",width:0,height:0,offsetX:0,offsetY:0,visible:!0,zOrder:-1,excludeFromLayout:!1,constraints:t.datavisualization.Diagram.NodeConstraints.Default,parent:"",labels:[],expandIcon:{shape:t.datavisualization.Diagram.IconShapes.None,width:13,height:10,margin:t.datavisualization.Diagram.Margin(),offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,cornerRadius:0,fillColor:"black",pathData:"",templateId:""},collapseIcon:{shape:t.datavisualization.Diagram.IconShapes.None,width:13,height:10,margin:t.datavisualization.Diagram.Margin(),offset:{x:.5,y:1},borderColor:"#1a1a1a",borderWidth:1,cornerRadius:0,fillColor:"black",pathData:"",templateId:""},ports:[],inEdges:[],outEdges:[],rotateAngle:0,pivot:t.datavisualization.Diagram.Point(.5,.5),addInfo:{},marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:t.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:t.datavisualization.Diagram.VerticalAlignment.Top,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,connectorPadding:0,cornerRadius:0,paletteItem:null};t.datavisualization.Diagram.NodeBase=function(i){var r;if(i.expandIcon&&(i.expandIcon=t.datavisualization.Diagram.expandIcon(i.expandIcon?i.expandIcon:{})),i.collapseIcon&&(i.collapseIcon=t.datavisualization.Diagram.collapseIcon(i.collapseIcon?i.collapseIcon:{})),i.labels)for(r=0;r<i.labels.length;r++)i.labels[r]=t.datavisualization.Diagram.Label(i.labels[r]);if(i.ports)for(r=0;r<i.ports.length;r++)i.ports[r]=t.datavisualization.Diagram.Port(i.ports[r]);return i.paletteItem=t.datavisualization.Diagram.PaletteItem(i.paletteItem?i.paletteItem:{}),n.extend(!0,{},t.datavisualization.Diagram.NodeBaseDefaults,i)};t.datavisualization.Diagram.NodeDefaults={fillColor:"white",borderColor:"black",borderWidth:1,borderDashArray:"",opacity:1,gradient:null,type:t.datavisualization.Diagram.Shapes.Basic,isExpanded:!0,shadow:t.datavisualization.Diagram.Shadow(),cssClass:""};t.datavisualization.Diagram.Node=function(i){return i=i||{},i.gradient&&(i.gradient.type==="linear"?i.gradient=t.datavisualization.Diagram.LinearGradient(i.gradient):i.gradient.type==="radial"&&(i.gradient=t.datavisualization.Diagram.RadialGradient(i.gradient))),i.shadow&&(i.shadow=t.datavisualization.Diagram.Shadow(i.shadow)),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i&&!i.name&&(i.name="node_"+t.datavisualization.Diagram.Util.randomId()),i.minWidth=i.minWidth?i.minWidth:0,i.minHeight=i.minHeight?i.minHeight:0,i.maxWidth=i.maxWidth?i.maxWidth:0,i.maxHeight=i.maxHeight?i.maxHeight:0,i.width||i._width||(i._width=i.minWidth?i.minWidth:i.maxWidth),i.height||i._height||(i._height=i.minHeight?i.minHeight:i.maxHeight),i._hidePorts&&(i.ports=[]),n.extend(!0,{},t.datavisualization.Diagram.NodeDefaults,t.datavisualization.Diagram.NodeBase(i),t.datavisualization.Diagram.Shape(i))};t.datavisualization.Diagram.ConnectorDefaults={name:"",visible:!0,lineDashArray:"",targetDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},sourceDecorator:{shape:t.datavisualization.Diagram.DecoratorShapes.Arrow,width:8,height:8,borderColor:"black",fillColor:"black",pathData:""},shape:undefined,segments:[t.datavisualization.Diagram.Segment({type:"straight"})],sourcePoint:t.datavisualization.Diagram.Point(),targetPoint:t.datavisualization.Diagram.Point(),lineColor:"black",lineWidth:1,constraints:t.datavisualization.Diagram.ConnectorConstraints.Default,opacity:1,parent:"",labels:[],zOrder:-1,lineHitPadding:10,addInfo:{},targetNode:null,targetPort:null,sourceNode:null,sourcePort:null,marginLeft:0,marginTop:0,marginRight:0,marginBottom:0,horizontalAlign:t.datavisualization.Diagram.HorizontalAlignment.Left,verticalAlign:t.datavisualization.Diagram.VerticalAlignment.Top,cornerRadius:0,bridgeSpace:10,sourcePadding:0,targetPadding:0,type:"connector",cssClass:""};t.datavisualization.Diagram.Connector=function(i){if(i=i||{},i.name=i.name?i.name:t.datavisualization.Diagram.Util.randomId(),i.targetDecorator=t.datavisualization.Diagram.Decorator(i.targetDecorator||{}),i.sourceDecorator=t.datavisualization.Diagram.Decorator(i.sourceDecorator||{shape:t.datavisualization.Diagram.DecoratorShapes.None}),i.segments=i.segments||[t.datavisualization.Diagram.Segment({type:"straight"})],i._srcDecoratorSize=Math.max(parseInt(i.sourceDecorator.height),parseInt(i.sourceDecorator.width))+5*i.sourceDecorator.borderWidth,i._tarDecoratorSize=Math.max(parseInt(i.targetDecorator.height),parseInt(i.targetDecorator.width))+5*i.targetDecorator.borderWidth,i._inlineDecorators=[],i.segments.length&&(i.sourcePoint=i.sourcePoint||t.datavisualization.Diagram.Point(),i.targetPoint=i.targetPoint||t.datavisualization.Diagram.Point(),t.datavisualization.Diagram.Util._initializeSegments(i,i.defaultType)),i.labels)for(var r=0;r<i.labels.length;r++)i.labels[r]=t.datavisualization.Diagram.Label(i.labels[r]);return i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i.paletteItem=t.datavisualization.Diagram.PaletteItem(i.paletteItem?i.paletteItem:{}),n.extend(!0,{},t.datavisualization.Diagram.ConnectorDefaults,i)};t.datavisualization.Diagram.ContainerDefaults={type:t.datavisualization.Diagram.ContainerType.Canvas,orientation:"vertical"};t.datavisualization.Diagram.Container=function(i){return n.extend(!0,{},t.datavisualization.Diagram.ContainerDefaults,i)};t.datavisualization.Diagram.GroupDefaults={children:[],canUngroup:!0,allowDrop:!0,container:null,paddingLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,minWidth:100,maxWidth:Number.POSITIVE_INFINITY,minHeight:100,maxHeight:Number.POSITIVE_INFINITY,type:"group"};t.datavisualization.Diagram.Group=function(i){return i=i?i:{},i.type=="bpmn"&&(i=t.datavisualization.Diagram.Node(i)),i.minWidth=i.minWidth?i.minWidth:100,i.minHeight=i.minHeight?i.minHeight:100,i.maxWidth=i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,i.maxHeight=i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,i.container=i.container?t.datavisualization.Diagram.Container(i.container):null,i.fillColor=i.fillColor?i.fillColor:"transparent",i.borderColor=i.borderColor?i.borderColor:"transparent",i&&!i.name&&(i.name="group_"+t.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i._type||i.type=="umlclassifier"||(i._type=i.type?i.type:"group"),n.extend(!0,{},t.datavisualization.Diagram.NodeDefaults,t.datavisualization.Diagram.GroupDefaults,t.datavisualization.Diagram.NodeBase(i))};t.datavisualization.Diagram.ZoomCommand={ZoomIn:1,ZoomOut:2};t.datavisualization.Diagram.Zoom=function(i){return n.extend(!0,{},{zoomFactor:.2,focusPoint:null,zoomCommand:t.datavisualization.Diagram.ZoomCommand.ZoomIn},i)};t.datavisualization.Diagram.DragState={Starting:"starting",Dragging:"dragging",Completed:"completed"};t.datavisualization.Diagram.ResizeState={Starting:"starting",Resizing:"resizing",Completed:"completed"};t.datavisualization.Diagram.DiagramConstraints={None:1,UserInteraction:2,APIUpdate:4,PageEditable:6,Bridging:8,Zoomable:16,PannableX:32,PannableY:64,Pannable:96,Undoable:128,Resizable:256,ZoomTextEditor:512,FloatElements:1024,Default:502};t.datavisualization.Diagram.BridgeDirection={Top:"top",Bottom:"bottom",Left:"left",Right:"right"};t.datavisualization.Diagram.Tool={None:1,SingleSelect:2,MultipleSelect:4,ZoomPan:8,DrawOnce:16,ContinuesDraw:32};t.datavisualization.Diagram.Region={Content:"content",PageSettings:"pageSettings"};t.datavisualization.Diagram.FileFormats={JPG:"jpg",PNG:"png",BMP:"bmp",SVG:"svg"};t.datavisualization.Diagram.ExportModes={Download:"download",Data:"data"};t.datavisualization.Diagram.FitMode={Page:"page",Width:"width",Height:"height"};t.datavisualization.Diagram.shapeType={Image:"image",Path:"path",Native:"native"};t.datavisualization.Diagram.UserHandleDefaults={name:"",pathData:"",templateId:"",source:"",shape:t.datavisualization.Diagram.shapeType.Path,borderColor:"",backgroundColor:"#2382c3",position:t.datavisualization.Diagram.UserHandlePositions.BottomCenter,pathColor:"white",tool:"",size:20,visible:!0,enableMultiSelection:!1};t.datavisualization.Diagram.UserHandle=function(i){return n.extend(!0,{},t.datavisualization.Diagram.UserHandleDefaults,i)};t.datavisualization.Diagram.SwimLaneDefaults={header:n.extend(!0,{},t.datavisualization.Diagram.LabelDefaults,{text:"Title",borderColor:"black",borderWidth:1,fillColor:"#C7D4DF",horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Stretch,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Stretch}),fillColor:"transparent",orientation:"vertical",type:"group",isSwimlane:!0,offsetX:100,offsetY:100,minHeight:100,maxHeight:Number.POSITIVE_INFINITY,minWidth:100,maxWidth:Number.POSITIVE_INFINITY,height:100,width:100,lanes:[],phases:[],phaseSize:20,constraints:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~(t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest),addInfo:{},cssClass:""};t.datavisualization.Diagram.SwimLane=function(i){return i=i||{},i&&!i.name&&(i.name="swimlane_"+t.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),i.header||(i.header={}),i.header.height=i.header.height?i.header.height:50,i.header.width=i.header.width?i.header.width:50,n.extend(!0,{},t.datavisualization.Diagram.SwimLaneDefaults,i)};t.datavisualization.Diagram.LaneDefaults={header:n.extend(!0,{},t.datavisualization.Diagram.LabelDefaults,{text:"Function",borderColor:"black",borderWidth:1,fillColor:"#C7D4DF",horizontalAlignment:t.datavisualization.Diagram.HorizontalAlignment.Stretch,verticalAlignment:t.datavisualization.Diagram.VerticalAlignment.Stretch}),name:"",children:[],isLane:!0,orientation:"horizontal",fillColor:"#f5f5f5",labels:[],addInfo:{},minHeight:100,minWidth:100,maxHeight:Number.POSITIVE_INFINITY,maxWidth:Number.POSITIVE_INFINITY,constraints:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,cssClass:""};t.datavisualization.Diagram.Lane=function(i){return i=i||{},i&&!i.name&&(i.name="lane_"+t.datavisualization.Diagram.Util.randomId()),i.tooltip&&(i.tooltip=t.datavisualization.Diagram.Tooltip(i.tooltip)),n.extend(!0,{},t.datavisualization.Diagram.LaneDefaults,i)};t.datavisualization.Diagram.PhaseDefaults={name:"",type:"phase",offset:100,lineWidth:1,lineDashArray:"3,3",lineColor:"#606060",parent:"",fillColor:"white",orientation:"horizontal",label:{text:"Phase"}};t.datavisualization.Diagram.Phase=function(i){return i.label&&(i.label=t.datavisualization.Diagram.Label(i.label),i.label.text=i.label.text?i.label.text:"Phase"),n.extend(!0,{},t.datavisualization.Diagram.PhaseDefaults,i)};t.datavisualization.Diagram.PaletteItemDefaults={width:undefined,height:undefined,enableScale:!0,previewHeight:undefined,previewWidth:undefined,wrapping:t.datavisualization.Diagram.TextWrapping.NoWrap,label:null,margin:t.datavisualization.Diagram.Margin({left:4,right:4,top:4,bottom:4})};t.datavisualization.Diagram.PaletteItem=function(i){return n.extend(!0,{},t.datavisualization.Diagram.PaletteItemDefaults,i)};t.datavisualization.Diagram.SwimLaneHelper={_initSwimLane:function(i,r,u){var f=null,b=null,i=t.datavisualization.Diagram.SwimLane(i),k,s,e,a,v,o;i.orientation=i.orientation?i.orientation:"vertical";k=this._initphases(i,r);b=this._initLanes(i,r,u);s=[];e=null;i.header||(i.header={text:"",height:0,fillColor:"white"});i.orientation==="horizontal"?a=i.header.height:v=i.header.width;i.header&&(e=t.datavisualization.Diagram.Node({_type:"node",_isHeader:!0,name:i.name+"_header_swimlane",labels:[i.header],height:a?a:50,width:v?v:50,fillColor:i.header.fillColor?i.header.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,horizontalAlign:"stretch",parent:i.name}));e&&(r.nodes().push(e),r._nodes=n.extend(!0,[],r.nodes()),r.nameTable[e.name]=e,s.push(e.name));o=null;o=i.phaseSize==0?.001:i.phaseSize?i.phaseSize:20;var tt=this._initPhaseStack(i,r,s,o),g=null,nt=null;i.orientation=="vertical"?nt="stretch":g="stretch";var y,d=0,p=0,w=0;i.orientation=="horizontal"?(y="vertical",p=(i.header?i.header.height:50)+o,w=0):(y="horizontal",p=i.header?i.header.height:50,d=i.phaseSize?i.phaseSize:o,w=(i.header?i.header.height:50)+o);var h=t.datavisualization.Diagram.Group({name:i.name+"_stack",children:b,parent:i.name,container:{type:t.datavisualization.Diagram.ContainerType.Stack,orientation:y},horizontalAlign:"stretch",verticalAlign:"stretch",marginTop:p,width:10,height:10,marginLeft:d,minHeight:w,constraints:t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.Connect)}),c=0,l=0;return i.orientation=="horizontal"?(c=i.width,l=100):i.orientation=="vertical"&&(c=100,l=i.height-e.height),r.nodes().push(h),r._nodes=n.extend(!0,[],r.nodes()),r.nameTable[h.name]=h,s.push(h.name),f=t.datavisualization.Diagram.Group({name:i.name?i.name:"",type:"group",addInfo:i.addInfo?i.addInfo:{},parent:"",offsetX:i.offsetX?i.offsetX:100,offsetY:i.offsetY?i.offsetY:100,children:s,zOrder:i.zOrder||i.zOrder===0?i.zOrder:-1,fillColor:"transparent",labels:[{mode:t.datavisualization.Diagram.LabelEditMode.View}],container:{type:t.datavisualization.Diagram.ContainerType.Canvas},minHeight:l?l:100,maxHeight:i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,minWidth:c?c:100,maxWidth:i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,constraints:i.constraints?i.constraints|t.datavisualization.Diagram.NodeConstraints.AllowDrop:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.AllowDrop^t.datavisualization.Diagram.NodeConstraints.ResizeNorth^t.datavisualization.Diagram.NodeConstraints.ResizeWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest^t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest,phaseSize:o,cssClass:i.cssClass}),f.isSwimlane=!0,f.phases=k,f.orientation=i.orientation,f.constraints=f.orientation=="horizontal"?f.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeEast^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast:f.constraints^t.datavisualization.Diagram.NodeConstraints.ResizeSouth^t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast,f},_initPhaseStack:function(i,r,u,f){var c="horizontal",y="left",p="top",l,h,v,e,o;c&&(i.orientation=="horizontal"?(c="horizontal",y="stretch",l=!0):(c="vertical",p="stretch",l=!1));var s=t.datavisualization.Diagram.Group({name:i.name+"phaseStack",container:{type:"stack",orientation:c},type:"group",parent:i.name,offsetX:0,offsetY:0,minHeight:f,maxHeight:f,minWidth:f,maxWidth:f,marginTop:i.header?i.header.height:50,isPhaseStack:!0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect}),a=0;for(i.phaseSize&&(i.phaseSize=i.phaseSize<1?20:i.phaseSize),e=0;e<i.phases.length;e++)l?(h=i.phaseSize?i.phaseSize:20,v=i.phases[e].offset-a):(h=i.phases[e].offset-a,e==0&&(h=h-(i.header?i.header.height:50)),v=i.phaseSize?i.phaseSize:20,i.phases[e].label&&(i.phases[e].label.rotateAngle=270)),o=t.datavisualization.Diagram.Node({parent:i.name+"phaseStack",_isHeader:!0,name:"phaseStack"+i.phases[e].name,height:h,width:v,labels:[i.phases[e].label],constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect}),o.labels[0].name="phaseStack"+i.phases[e].name+"label",o.labels[0].mode=t.datavisualization.Diagram.LabelEditMode.View,o.isPhase=!0,a=i.phases[e].offset,r.nameTable[o.name]=o,s.children.push(o.name),r.nodes().push(o),r._nodes=n.extend(!0,[],r.nodes());r.nodes().push(s);r._nodes=n.extend(!0,[],r.nodes());u.push(s);r.nameTable[s.name]=s},_setDefaultLaneProperties:function(n){n.lanes=n.lanes?n.lanes:[];n.lanes.push(t.datavisualization.Diagram.Lane({}))},_initLanes:function(i,r,u){var o=[],e=null,f;if(i.lanes&&i.lanes.length!==0||this._setDefaultLaneProperties(i),i.lanes)for(f=0;f<i.lanes.length;f++)jQuery.isEmptyObject(i.lanes[f])&&(i.lanes[f]=t.datavisualization.Diagram.Lane()),i.lanes[f]._laneHeader=i.lanes[f]._laneHeader?i.lanes[f]._laneHeader:i.lanes[f].header,e=this._initLane(i.lanes[f],i,r,u),o.push(e.name),r.nodes().push(e),r._nodes=n.extend(!0,[],r.nodes()),r.nameTable[e.name]=e;return o},_initLane:function(i,r,u,f){var c=null,l=null,y,e,s,v,o,a,h;if(r.orientation=="horizontal"?c="stretch":l="stretch",y=!1,e=t.datavisualization.Diagram.Group({name:i.name,addInfo:i.addInfo?i.addInfo:{},type:"group",isLane:!0,parent:r.name+"_stack",offsetX:0,offsetY:0,borderColor:i.borderColor?i.borderColor:"black",orientation:r.orientation?r.orientation:"horizontal",fillColor:i.fillColor,container:{type:t.datavisualization.Diagram.ContainerType.Canvas},horizontalAlign:c?c:"left",verticalAlign:l?l:"top",minHeight:i.height?i.height:100,maxHeight:i.maxHeight?i.maxHeight:Number.POSITIVE_INFINITY,minWidth:i.width?i.width:100,maxWidth:i.maxWidth?i.maxWidth:Number.POSITIVE_INFINITY,paddingTop:20,paddingRight:20,paddingBottom:20,paddingLeft:20,constraints:i.constraints?i.constraints|t.datavisualization.Diagram.NodeConstraints.AllowDrop:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,cssClass:i.cssClass}),i.labels&&i.labels.length>0){for(s=0;s<i.labels.length;s++)i.labels[s]=t.datavisualization.Diagram.Label(i.labels[s]);e.labels=i.labels}for(f||(v=i._laneHeader?i._laneHeader:null,o=this._iniLaneHeader(i,e.name,r,u,v),o&&(u.nodes().push(o),u._nodes=n.extend(!0,[],u.nodes()),u.nameTable[o.name]=o,e.children.push(o.name))),a=this._initChildren(i,e.name,u),h=0;h<a.length;h++)e.children.push(a[h]);return e},_iniLaneHeader:function(n,i,r,u,f){var e=null;return n.header&&(e=t.datavisualization.Diagram.Node({_isHeader:!0,name:i+"_Headerr_",type:"node",labels:[r.header],height:f.height?f.height:50,width:f.width?f.width:50,fillColor:n.header.fillColor?n.header.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,marginLeft:-20,marginTop:-20,marginRight:-20,marginBottom:-20,parent:i}),r.orientation&&r.orientation=="horizontal"?(e.verticalAlign="stretch",e.height=1,e.width=f.width?f.width:50):r.orientation&&r.orientation=="vertical"&&(e.horizontalAlign="stretch",e.labels[0].rotateAngle=0,e.height=f.width?f.width:50,e.width=1)),e},_initChildren:function(t,i,r){var o=[],u=null,f,e;if(t.children)for(f=0;f<t.children.length;f++)u=typeof t.children[f]=="object"?t.type&&t.type==="bpmn"?t.children[f]:this._initChild(t.children[f],i,r):r.nameTable[t.children[f]],u&&(u.segments?(r.connectors().push(u),r._connectors=n.extend(!0,[],r.connectors())):(u.children&&(e=this._initChildren(u,u.name,r)),e&&(u.children=e),r.nodes().push(u),r._nodes=n.extend(!0,[],r.nodes())),o.push(u.name),r.nameTable[u.name]=u);return o},_initChild:function(n,i,r){var u=null;return u=n&&n.children&&n.children.length>0?r._getNewGroup(t.datavisualization.Diagram.NodeType(n,r)):r._getNewNode(t.datavisualization.Diagram.NodeType(n,r)),u.parent=i,u},_swapPhaseSize:function(n){if(n.phases.length>0)for(var i=n.phases,t,u,r=0;r<i.length;r++)for(t=0;t<i.length-r-1;t++)i[t].offset>i[t+1].offset&&(u=i[t],i[t]=i[t+1],i[t+1]=u)},_setSwimlaneSize:function(n){var t,i;if(n.phases.length>0)for(i in n.phases)t=n.phases[i],n.orientation==="horizontal"?t.offset>n.width&&(n.width=t.offset):t.offset>n.height&&(n.height=t.offset)},_setLastPhaseSize:function(n){if(n.phases.length>0){var t=n.phases[n.phases.length-1];t.offset=n.orientation==="horizontal"?n.width:n.height}},_NeedDefaultPhase:function(n){return n.phases.length>0?!1:!0},_checkForDefPhase:function(n){return n.phases.length>0?!1:!0},_initphases:function(n,i){var e=[],r=null,o=0,f=0,s,u;if(n.orientation==="vertical"?(f=n.height,o=270):f=n.width,s=t.datavisualization.Diagram.Phase({name:n.name+"defPhase",offset:f,label:n._lastPhase?n._lastPhase.labels[0]:{text:"Phase",rotateAngle:o}}),this._NeedDefaultPhase(n)?n.phases.push(s):(this._swapPhaseSize(n),this._setSwimlaneSize(n),this._setLastPhaseSize(n)),n.phases&&n.phases.length>0)for(u=0;u<n.phases.length;u++)r=t.datavisualization.Diagram.Phase(n.phases[u]),r.parent=n.name,r.orientation=n.orientation,i.nameTable[r.name]=r,e.push(r.name);return e},_createSwimlane:function(n,i,r,u){var c=[],l=r?r.childTable:i.nameTable,e=500,o=500,s=null,f,h,a,v;return n.children[0]?(f=u?n.children[0]:l[n.children[0]],typeof f=="string"&&(f=l[f]),s={text:"Title",width:50,fillColor:f.fillColor?f.fillColor:n.fillColor,height:50}):s={text:"Title",width:50,fillColor:"white",height:50},n.orientation||n.container&&(n.orientation=n.container.orientation),h=0,n.orientation=="horizontal"&&i._selectedSymbol?(e=n.height?n.height:100,o=n.width?n.width:650,h=e):(e=n.height?n.height:650,o=n.width?n.width:100,h=n.height+s.height),n.children.length>1&&(n.children.splice(0,0),c=n.children),a={name:n.name,header:s,fillColor:"white",isSwimlane:!0,minWidth:o,minHeight:e,height:h+1,width:o+1,maxHeight:e+Number.POSITIVE_INFINITY,maxWidth:o+Number.POSITIVE_INFINITY,offsetX:n.offsetX,offsetY:n.offsetY,orientation:n.orientation?n.orientation:"horizontal",lanes:[{name:n.name+"_canvas",addInfo:n.addInfo?n.addInfo:{},header:{text:f.labels[0].text?f.labels[0].text:"HEADER",fontSize:f.labels[0].fontSize?f.labels[0].fontSize:11,width:f.width?f.width:50,height:f.height?f.height:50,fillColor:f.fillColor,bold:f.labels[0].bold?!0:!1,italic:f.labels[0].italic?!0:!1,fontFamily:f.labels[0].fontFamily?f.labels[0].fontFamily:"Arial",fontColor:f.labels[0].fontColor?f.labels[0].fontColor:"black"},fillColor:n.fillColor?n.fillColor:"white",height:e,width:o,minHeight:e,minWidth:o,children:c?c:[],_laneHeader:n._laneHeader?n._laneHeader:null},]},v=t.datavisualization.Diagram.ContainerHelper._initContainer(i,a),v},_createDiagramLane:function(n){var i=n._lane?n._lane:null,r=n.orientation,u={children:[{name:n.name+"_Headerr_",height:i.header?i.header.height:50,width:i.header?i.header.width:50,fillColor:i.header?i.header.fillColor:50,labels:i.header?[i.header]:[],horizontalAlign:r==="vertical"?"stretch":"left",verticalAlign:r==="vertical"?"top":"stretch"}],container:{type:"canvas"},name:n.name?n.name:t.datavisualization.Diagram.Util.randomId(),minHeight:i.minHeight?i.minHeight:100,minWidth:i.minWidth?i.minWidth:100,maxHeight:Number.POSITIVE_INFINITY,maxWidth:Number.POSITIVE_INFINITY,borderColor:"black",constraints:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,cssClass:i.cssClass?i.cssClass:"",addInfo:i.addInfo?i.addInfo:null,fillColor:i.fillColor?i.fillColor:"white",isLane:!0,offsetX:n.offsetX?n.offsetX:100,offsetY:n.offsetY?n.offsetY:100};return u.children[0].labels[0].rotateAngle=r==="horizontal"?270:0,u},_createPaletteLane:function(n,i){var r=0,u=0,f=0,e=0,l=0,a="left",c=0,v,h,o,s;return n=t.datavisualization.Diagram.Lane(n),!n.paletteItem||n.paletteItem.enableScale||n.paletteItem.width||n.orientation==="horizontal"&&(c+=2),n.orientation=="horizontal"?(r=n.height?n.height:50,u=25,f=14+c,e=r/2+1,l=270,a="left"):n.orientation=="vertical"&&(r=25,u=n.width?n.width:50,f=u/2,e=15,a="left"),v=n.header.text?n.header.text:"",h=t.datavisualization.Diagram.Node({name:n.name+"_"+v,_type:"node",labels:[{text:n.header.text?n.header.text:"Function",fontSize:n.header.fontSize?n.header.fontSize:11,offset:{x:.5,y:.5},width:100,rotateAngle:l}],height:r,width:u,fillColor:n.header.fillColor?n.header.fillColor:"white",parent:n.name,offsetX:f,offsetY:e,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Connect}),i[h.name]=h,n.orientation=="horizontal"?(r=n.height,u=n.width-25,f=25+u/2+c,e=r/2+1):n.orientation=="vertical"&&(r=n.height-25,u=n.width,f=u/2,e=25+r/2),o=t.datavisualization.Diagram.Node({name:n.name+"content",_type:"node",height:r,width:u,fillColor:n.fillColor?n.fillColor:"white",parent:n.name,offsetX:f,offsetY:e}),o._laneHeader=n.header,i[o.name]=o,s=t.datavisualization.Diagram.Group({name:n.name+"_group",addInfo:n.addInfo?n.addInfo:{},height:n.height,width:n.width,header:n.header?n.header:null,offsetX:n.offsetX,offsetY:n.offsetY,children:[h.name,o.name,],paletteItem:n.paletteItem?n.paletteItem:null}),s._lane=n,s.isLane=!0,s.orientation=n.orientation,s},_mapObject:function(n,t,i,r){var u;switch(i){case"lane":u=this._mapLane(n,t);break;case"phase":u=this._mapPhase(n,t);break;case"swimlane":u=this._mapSwimlane(n,t,r)}return u},_mapLane:function(n,i,r){var u=t.datavisualization.Diagram.Lane();return this._mapLaneHeader(n,i,u,r),this._mapChildren(n,i,u,r),u.name=i.name,u.labels=i.labels,u.fillColor=i.fillColor,u.orientation=i.orientation,u.maxHeight=i.maxHeight,u.maxWidth=i.maxWidth,u.minHeight=i.height>i.minHeight?i.height:i.minHeight,u.minWidth=i.width>i.minWidth?i.width:i.minWidth,u.constraints=i.constraints,u.addInfo=i.addInfo?i.addInfo:{},i.orientation==="horizontal"?(u.height=i.height,u.width=null):(u.height=null,u.width=i.width),u},_mapLaneHeader:function(n,t,i,r){var u;t.children[0]&&(u=n.nameTable[n._getChild(t.children[0])]);!u&&r&&(u=r[n._getChild(t.children[0])]);u&&(u.labels&&u.labels[0]&&(i.header.text=u.labels[0].text,i.header.fontColor=u.labels[0].fontColor,i.header.fontSize=u.labels[0].fontSize,i.header.fontFamily=u.labels[0].fontFamily,i.header.bold=u.labels[0].bold,i.header.italic=u.labels[0].italic,i.header.textDecoration=u.labels[0].textDecoration,i.header.rotateAngle=u.labels[0].rotateAngle),i.header.fillColor=u.fillColor,t.orientation==="vertical"?(i.header.height=u.height,i.header.width=null):(i.header.height=null,i.header.width=u.width))},_mapChildren:function(n,t,i,r){var f,u;if(t.children&&t.children.length>=2)for(u=1;u<t.children.length;u++)n._getChild(t.children[u])&&(f=n.nameTable[n._getChild(t.children[u])]),r&&!f&&(f=r[n._getChild(t.children[u])]),f&&i.children.push(f)},_mapSwimlane:function(n,i,r){var u=t.datavisualization.Diagram.SwimLane();return this._mapSwimlaneHeader(n,i,u,r),this._mapLanes(n,i,u,r),this._mapPhases(n,i,u,r),u.name=i.name,u.orientation=i.orientation,u.offsetX=i.offsetX,u.offsetY=i.offsetY,u.maxHeight=i.maxHeight,u.maxWidth=i.maxWidth,u.minHeight=i.minHeight,u.minWidth=i.minWidth,u.minWidth=u.orientation==="horizontal"?i.width&&i.minWidth&&i.width>i.minWidth?i.width:i.minWidth:i.minWidth,u.phaseSize=i.phaseSize,u.constraints=i.constraints,u.zOrder=i.zOrder,u.addInfo=i.addInfo?i.addInfo:{},u.height=i.height,u.width=i.width,u},_mapSwimlaneHeader:function(n,t,i,r){if(t.children[0])var u=n.nameTable[n._getChild(t.children[0])];!u&&r&&(u=r[n._getChild(t.children[0])]);u&&(u.labels&&u.labels[0]&&(i.header.text=u.labels[0].text,i.header.fontColor=u.labels[0].fontColor,i.header.fontSize=u.labels[0].fontSize,i.header.fontFamily=u.labels[0].fontFamily,i.header.bold=u.labels[0].bold,i.header.italic=u.labels[0].italic,i.header.textDecoration=u.labels[0].textDecoration),i.header.fillColor=u.fillColor,i.header.height=u.height,i.header.width=u.width)},_mapLanes:function(n,t,i,r){var u,e,o,f;if(t.children[2]&&n._getChild(t.children[2])&&(u=r?r[n._getChild(t.children[2])]:n.nameTable[n._getChild(t.children[2])]),u&&u.children&&u.children.length>0)for(f=0;f<u.children.length;f++)n._getChild(u.children[f])&&(e=r?r[n._getChild(u.children[f])]:n.nameTable[n._getChild(u.children[f])]),e&&(o=this._mapLane(n,e,r),o&&i.lanes.push(o))},_mapPhases:function(n,i,r,u){var f=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i,u),s,e,h,o,c;if(f&&f.length>0){for(s=f.length,e=u?u:n.nameTable,f[f.length-1]&&e[f[f.length-1]]&&(h=e[f[f.length-1]],h.name.split("defPhase").length>1||h.offset==i.width||s++),o=0;o<s;o++)c=this._mapPhase(n,e[n._getChild(f[o])],u),c&&r.phases.push(c);e["phaseStack"+f[f.length-1]]&&(r._lastPhase=this._mapPhase(n,e["phaseStack"+f[f.length-1]],u))}},_mapPhase:function(n,t,i){var r;return t&&(r=i?i[t.name]:n.nameTable[t.name]),r?r:null},_getSwimLaneNode:function(n,t,i,r){if(n.isSwimlane)if(i){if(r.nameTable[r._getChild(n.children[2])].container.orientation==t.orientation)return n}else if(r.nameTable[r._getChild(n.children[2])].container.orientation!=t.orientation)return n;if(n.parent){var u=r.nameTable[n.parent];if(u)return this._getSwimLaneNode(u,t,undefined,r)}return null}}}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.BasicShapes={Rectangle:"rectangle",Ellipse:"ellipse",Path:"path",Polygon:"polygon",Triangle:"triangle",Plus:"plus",Star:"star",Pentagon:"pentagon",Heptagon:"heptagon",Octagon:"octagon",Trapezoid:"trapezoid",Decagon:"decagon",RightTriangle:"righttriangle",Cylinder:"cylinder"};t.datavisualization.Diagram.FlowShapes={Process:"process",Decision:"decision",Document:"document",PreDefinedProcess:"predefinedprocess",Terminator:"terminator",PaperTap:"papertap",DirectData:"directdata",SequentialData:"sequentialdata",Sort:"sort",MultiDocument:"multidocument",Collate:"collate",SummingJunction:"summingjunction",Or:"or",InternalStorage:"internalstorage",Extract:"extract",ManualOperation:"manualoperation",Merge:"merge",OffPageReference:"offpagereference",SequentialAccessStorage:"sequentialaccessstorage",Annotation1:"annotation1",Annotation2:"annotation2",Data:"data",Card:"card"};t.datavisualization.Diagram.ArrowShapes={None:"none",CircularArrow:"circulararrow",CurvedRightArrow:"curvedrightarrow",CurvedUpArrow:"curveduparrow",CurvedLeftArrow:"curvedleftarrow",CurvedDownArrow:"curveddownarrow",JumpingRightArrow:"jumpingrightarrow",JumpingLeftArrow:"jumpingleftarrow"};t.datavisualization.Diagram.BPMNShapes={Event:"event",Gateway:"gateway",Message:"message",DataObject:"dataobject",DataSource:"datasource",Activity:"activity",Group:"group"};t.datavisualization.Diagram.BPMNEvents={Start:"start",Intermediate:"intermediate",End:"end",NonInterruptingStart:"noninterruptingstart",NonInterruptingIntermediate:"noninterruptingintermediate",ThrowingIntermediate:"throwingintermediate"};t.datavisualization.Diagram.BPMNTriggers={None:"none",Message:"message",Timer:"timer",Escalation:"escalation",Link:"link",Error:"error",Compensation:"compensation",Signal:"signal",Multiple:"multiple",Parallel:"parallel",Cancel:"cancel",Conditional:"conditional",Terminate:"terminate"};t.datavisualization.Diagram.BPMNGateways={None:"none",Exclusive:"exclusive",Inclusive:"inclusive",Parallel:"parallel",Complex:"complex",EventBased:"eventbased",ExclusiveEventBased:"exclusiveeventbased",ParallelEventBased:"paralleleventbased"};t.datavisualization.Diagram.BPMNDataObjects={None:"none",Input:"input",Output:"output"};t.datavisualization.Diagram.BPMNActivity={None:"none",Task:"task",SubProcess:"subprocess"};t.datavisualization.Diagram.BPMNLoops={None:"none",Standard:"standard",ParallelMultiInstance:"parallelmultiinstance",SequenceMultiInstance:"sequencemultiinstance"};t.datavisualization.Diagram.BPMNTasks={None:"none",Service:"service",Receive:"receive",Send:"send",InstantiatingReceive:"instantiatingreceive",Manual:"manual",BusinessRule:"businessrule",User:"user",Script:"script",Parallel:"parallel"};t.datavisualization.Diagram.BPMNSubProcessTypes={None:"none",Transaction:"transaction",Event:"event"};t.datavisualization.Diagram.BPMNBoundary={Default:"default",Call:"call",Event:"event"};t.datavisualization.Diagram.BPMNAnnotationDirections={Top:"top",Left:"left",Right:"right",Bottom:"bottom"};t.datavisualization.Diagram.BPMNFlows={Sequence:"sequence",Association:"association",Message:"message"};t.datavisualization.Diagram.BPMNSequenceFlows={Normal:"normal",Conditional:"conditional",Default:"default"};t.datavisualization.Diagram.BPMNMessageFlows={Default:"default",InitiatingMessage:"initiatingmessage",NonInitiatingMessage:"noninitiatingmessage"};t.datavisualization.Diagram.ClassifierShapes={Package:"package",Class:"class",Interface:"interface",Enumeration:"enumeration",CollapsedPackage:"collapsedpackage",Inheritance:"inheritance",Association:"association",Aggregation:"aggregation",Composition:"composition",InterfaceRealization:"interfacerealization",DirectedAssociation:"directedassociation",Dependency:"dependency"};t.datavisualization.Diagram.AssociationFlows={Default:"default",Directional:"directional",BiDirectional:"bidirectional"};t.datavisualization.Diagram.BPMNEventDefaults={event:t.datavisualization.Diagram.BPMNEvents.Start,trigger:t.datavisualization.Diagram.BPMNTriggers.None,offset:t.datavisualization.Diagram.Point()};t.datavisualization.Diagram.BPMNGatewayDefaults={gateway:t.datavisualization.Diagram.BPMNGateways.None};t.datavisualization.Diagram.BPMNDataObject=function(i){return n.extend(!0,{},{type:t.datavisualization.Diagram.BPMNDataObjects.None,collection:!1},i)};t.datavisualization.Diagram.BPMNDataObjectDefaults={data:t.datavisualization.Diagram.BPMNDataObject()};t.datavisualization.Diagram.BPMNTaskDefaults={loop:t.datavisualization.Diagram.BPMNLoops.None,type:t.datavisualization.Diagram.BPMNTasks.None,call:!1,compensation:!1};t.datavisualization.Diagram.BPMNTask=function(i){return n.extend(!0,{},t.datavisualization.Diagram.BPMNTaskDefaults,i)};t.datavisualization.Diagram.BPMNSubProcessDefaults={type:t.datavisualization.Diagram.BPMNSubProcessTypes.None,event:t.datavisualization.Diagram.BPMNEvents.Start,trigger:t.datavisualization.Diagram.BPMNTriggers.Message,boundary:t.datavisualization.Diagram.BPMNBoundary.Default,loop:t.datavisualization.Diagram.BPMNLoops.None,adhoc:!1,compensation:!1,collapsed:!0,events:[]};t.datavisualization.Diagram.BPMNSubProcess=function(i){return n.extend(!0,{},t.datavisualization.Diagram.BPMNSubProcessDefaults,i)};t.datavisualization.Diagram.BPMNActivityDefaults={activity:t.datavisualization.Diagram.BPMNActivity.Task,task:t.datavisualization.Diagram.BPMNTask(),subProcess:t.datavisualization.Diagram.BPMNSubProcess()};t.datavisualization.Diagram.BPMNTextAnnotationDefaults={annotation:{width:20,height:20,angle:0,length:0,text:"",direction:t.datavisualization.Diagram.BPMNAnnotationDirections.Left}};t.datavisualization.Diagram.ConnectorShapeDefaults={type:"bpmn",flow:t.datavisualization.Diagram.BPMNFlows.Sequence,sequence:t.datavisualization.Diagram.BPMNSequenceFlows.Normal,association:t.datavisualization.Diagram.AssociationFlows.Default,message:t.datavisualization.Diagram.BPMNMessageFlows.Default};t.datavisualization.Diagram.ClassifierMultiplicity={OneToOne:"onetoone",OneToMany:"onetomany",ManyToOne:"manytoone"};t.datavisualization.Diagram.AssociationDefaults={type:"classifier",association:t.datavisualization.Diagram.AssociationFlows.BiDirectional,multiplicity:t.datavisualization.Diagram.ClassifierMultiplicity};t.datavisualization.Diagram.AggregationDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicity};t.datavisualization.Diagram.CompositionDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicity};t.datavisualization.Diagram.DependencyDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicity};t.datavisualization.Diagram.RealizationDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicity};t.datavisualization.Diagram.InheritanceDefaults={type:"classifier",multiplicity:t.datavisualization.Diagram.ClassifierMultiplicity};t.datavisualization.Diagram.ScopeValueDefaults={Public:"public",Protected:"",Private:"",Package:""};t.datavisualization.Diagram.ClassMemberDefaults={name:"",value:""};t.datavisualization.Diagram.ClassAttributeDefaults={name:"",type:"",scope:t.datavisualization.Diagram.ScopeValueDefaults.Public};t.datavisualization.Diagram.ClassMethodsArgumentsDefault={name:"",type:""};t.datavisualization.Diagram.ClassMethodsDefaults={name:"",type:"",arguments:t.datavisualization.Diagram.ClassMethodsArgumentsDefault,scope:t.datavisualization.Diagram.ScopeValueDefaults.Public};t.datavisualization.Diagram.ClassmethodArguments=function(i){return n.extend(!0,{},t.datavisualization.Diagram.ClassMethodsArgumentsDefault,i)};t.datavisualization.Diagram.ClassMethod=function(i){return n.extend(!0,{},t.datavisualization.Diagram.ClassMethodsDefaults,i)};t.datavisualization.Diagram.ClassMember=function(i){return n.extend(!0,{},t.datavisualization.Diagram.ClassMemberDefaults,i)};t.datavisualization.Diagram.ClassAttribute=function(i){return n.extend(!0,{},t.datavisualization.Diagram.ClassAttributeDefaults,i)};t.datavisualization.Diagram.ClassifierClass=function(i){return n.extend(!0,{},t.datavisualization.Diagram.ClassDefaults,i)};t.datavisualization.Diagram.ClassifierInterface=function(i){return n.extend(!0,{},t.datavisualization.Diagram.InterfaceDefaults,i)};t.datavisualization.Diagram.ClassifierEnumeration=function(i){return n.extend(!0,{},t.datavisualization.Diagram.EnumerationDefaults,i)};t.datavisualization.Diagram.UMLConnector=function(i){return n.extend(!0,{},t.datavisualization.Diagram.UMLConnectorDefaults,i)};t.datavisualization.Diagram.UMLConnectorAssociation=function(i){return n.extend(!0,{},t.datavisualization.Diagram.AssociationDefaults,i)};t.datavisualization.Diagram.UMLConnectorAggregation=function(i){return n.extend(!0,{},t.datavisualization.Diagram.AggregationDefaults,i)};t.datavisualization.Diagram.UMLConnectorComposition=function(i){return n.extend(!0,{},t.datavisualization.Diagram.CompositionDefaults,i)};t.datavisualization.Diagram.UMLConnectorDependency=function(i){return n.extend(!0,{},t.datavisualization.Diagram.DependencyDefaults,i)};t.datavisualization.Diagram.UMLConnectorRealization=function(i){return n.extend(!0,{},t.datavisualization.Diagram.RealizationDefaults,i)};t.datavisualization.Diagram.UMLConnectorInheritance=function(i){return n.extend(!0,{},t.datavisualization.Diagram.InheritanceDefaults,i)};t.datavisualization.Diagram.ClassDefaults={name:" ",attributes:[t.datavisualization.Diagram.ClassAttribute()],methods:[t.datavisualization.Diagram.ClassMethod()]};t.datavisualization.Diagram.InterfaceDefaults={name:" ",attributes:[t.datavisualization.Diagram.ClassAttribute()],methods:[t.datavisualization.Diagram.ClassMethod()]};t.datavisualization.Diagram.EnumerationDefaults={name:" ",members:[t.datavisualization.Diagram.ClassMember()]};t.datavisualization.Diagram.NodeType=function(i,r){var u=r.model.defaultSettings&&r.model.defaultSettings.node&&r.model.defaultSettings.node.type?r.model.defaultSettings.node.type:"",f=!i.isPhase&&r.model.defaultSettings&&r.model.defaultSettings.node?r.model.defaultSettings.node:{};return i.type||i.children||i.isLane||i.isSwimlane||i.isPhase||i.isPhaseStack||(i.type=i.segments||i.sourceNode||i.sourcePort||i.sourcePoint||i.targetNode||i.targetPort||i.targetPoint?"connector":u?u:"basic"),(i.type=="basic"||i.type=="flow"||i.type=="arrow"||i.type=="bpmn"||i.type=="image"||i.type=="native"||i.type==="html"||i.type==="text")&&(r._isLoad&&(!r._isLoad||i._type)||(i._type="node"),i=n.extend(!0,{},f,i)),r._isLoad||(i.type=="basic"?i=t.datavisualization.Diagram.BasicShape(i):i.type=="flow"?i=t.datavisualization.Diagram.FlowShape(i):i.type=="arrow"?i=t.datavisualization.Diagram.ArrowShape(i):i.type=="bpmn"?i=t.datavisualization.Diagram.BPMNShape(i):i.type=="umlclassifier"&&(i=t.datavisualization.Diagram.ClassifierShape(i,r))),i};t.datavisualization.Diagram.BasicShape=function(n){n._shape="path";n.shape||(n.shape="rectangle");switch(n.shape){case"rectangle":n._shape="rectangle";break;case"ellipse":n._shape="ellipse";break;case"path":n._shape="path";break;case"polygon":n._shape="polygon";break;case"triangle":n.pathData="M81.1582,85.8677L111.1582,33.9067L141.1582,85.8677L81.1582,85.8677z";break;case"plus":n.pathData="M696.6084,158.2656L674.8074,158.2656L674.8074,136.4656L658.4084,136.4656L658.4084,158.2656L636.6084,158.2656L636.6084,174.6646L658.4084,174.6646L658.4084,196.4656L674.8074,196.4656L674.8074,174.6646L696.6084,174.6646L696.6084,158.2656z";break;case"star":n.pathData="M540.3643,137.9336L546.7973,159.7016L570.3633,159.7296L550.7723,171.9366L558.9053,194.9966L540.3643,179.4996L521.8223,194.9966L529.9553,171.9366L510.3633,159.7296L533.9313,159.7016L540.3643,137.9336z";break;case"pentagon":n.pathData="M370.9702,194.9961L359.5112,159.7291L389.5112,137.9341L419.5112,159.7291L408.0522,194.9961L370.9702,194.9961z";break;case"heptagon":n.pathData="M223.7783,195.7134L207.1303,174.8364L213.0713,148.8034L237.1303,137.2174L261.1883,148.8034L267.1303,174.8364L250.4813,195.7134L223.7783,195.7134z";break;case"octagon":n.pathData="M98.7319,196.4653L81.1579,178.8923L81.1579,154.0393L98.7319,136.4653L123.5849,136.4653L141.1579,154.0393L141.1579,178.8923L123.5849,196.4653L98.7319,196.4653z";break;case"trapezoid":n.pathData="M127.2842,291.4492L95.0322,291.4492L81.1582,256.3152L141.1582,256.3152L127.2842,291.4492z";break;case"decagon":n.pathData="M657.3379,302.4141L642.3369,291.5161L636.6089,273.8821L642.3369,256.2481L657.3379,245.3511L675.8789,245.3511L690.8789,256.2481L696.6089,273.8821L690.8789,291.5161L675.8789,302.4141L657.3379,302.4141z";break;case"righttriangle":n.pathData="M836.293,292.9238L776.293,292.9238L776.293,254.8408L836.293,292.9238z";break;case"cylinder":n.pathData="M 542.802,362.009C 542.802,368.452 525.341,373.676 503.802,373.676C 482.263,373.676 464.802,368.452 464.802,362.009L 464.802,466.484C 464.802,472.928 482.263,478.151 503.802,478.151C 525.341,478.151 542.802,472.928 542.802,466.484L 542.802,362.016C 542.802,368.459 525.341,373.534 503.802,373.534C 482.263,373.534 464.802,368.31 464.802,361.867L 464.802,362.016C 464.802,355.572 482.263,350.349 503.802,350.349C 525.341,350.349 542.802,355.572 542.802,362.016"}return n};t.datavisualization.Diagram.FlowShape=function(n){n._shape="path";n.shape||(n.shape="process");var i=n.constraints?n.constraints:t.datavisualization.Diagram.NodeConstraints.Default;n.constraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio||(i=i|t.datavisualization.Diagram.NodeConstraints.AspectRatio);switch(n.shape){case"process":n.pathData="M419.511,76.687L359.511,76.687L359.511,43.086L419.511,43.086z";break;case"decision":n.pathData="M 253.005,115.687L 200.567,146.071L 148.097,115.687L 200.534,85.304L 253.005,115.687 Z";break;case"document":n.pathData="M 60 31.9 c 0 0 -11 -7.7 -30 0 s -30 0 -30 0 V 0 h 60 V 31.9 Z";break;case"predefinedprocess":n.pathData="M 0,0 L 50,0 L 50,50 L 0,50 Z  M 8.333333333333334,0 L 8.333333333333334,50 M 41.66666666666667,0 L 41.66666666666667,50";break;case"terminator":n.pathData="M 269.711,29.3333C 269.711,44.061 257.772,56 243.044,56L 158.058,56C 143.33,56 131.391,44.061 131.391,29.3333L 131.391,29.3333C 131.391,14.6057 143.33,2.66669 158.058,2.66669L 243.044,2.66669C 257.772,2.66669 269.711,14.6057 269.711,29.3333 Z";break;case"papertap":n.pathData="M0.000976562,17.2042 L0.000976562,47.1654 C0.000976562,47.1654 14.403,53.5455 25.001,47.1654 C35.599,40.7852 44.403,43.5087 50.001,47.1654 L50.001,17.2042 M50.001,32.7987 L50.001,2.84052 C50.001,2.84052 35.599,-3.54271 25.001,2.84052 C14.403,9.22376 5.599,6.49418 0.000976562,2.84052 L0.000976562,32.7987";break;case"directdata":n.pathData="M 1477 613 L 1619 613 C 1627 613 1634 636 1634 665 C 1634 694 1627 717 1619 717 L 1477 717 C 1469 717 1461 694 1461 665 C 1461 636 1469 613 1477 613 ZM 1619 613 C 1610 613 1603 636 1603 665 C 1603 694 1610 717 1619 717M 1619 613 C 1610 613 1603 636 1603 665 C 1603 694 1610 717 1619 717";break;case"sequentialdata":n.pathData="M0.00297546,24.999 C0.00297546,11.1922 10.433,0.00216177 23.295,0.00216177 C36.159,0.00216177 46.585,11.1922 46.585,24.999 C46.585,38.8057 36.159,49.9979 23.295,49.9979 C10.433,49.9979 0.00297546,38.8057 0.00297546,24.999 z M23.294,49.999 L50.002,49.999";break;case"sort":n.pathData="M50.001,24.9971 L25.001,49.9971 L0.000976562,24.9971 L25.001,-0.00286865 L50.001,24.9971 z M0.000976562,24.9971 L50.001,24.9971";break;case"multidocument":n.pathData="M43.6826,40 C44.8746,40.6183 45.8586,41.3502 46.8366,42.1122 L46.8366,4.74487 L3.09857,4.74487 L3.09857,10.9544 M46.837,35.1437 C48.027,35.7653 49.025,36.6042 50.003,37.3695 L50.003,0.0021928 L6.26497,0.0021928 L6.26497,4.74451 M43.6826,47.1132 L43.6826,10.7652 L0.00257874,10.7652 L0.00257874,47.1132 C0.00257874,47.1132 12.5846,53.6101 21.8426,47.1132 C31.1006,40.6163 38.7926,43.3935 43.6826,47.1132 z";break;case"collate":n.pathData="M50.001,0.00286865 L25.001,25.0029 L0.000976562,0.00286865 L50.001,0.00286865 z M0.000976562,50.0029 L25.001,25.0029 L50.001,50.0029 L0.000976562,50.0029 z";break;case"summingjunction":n.constraints=i;n.pathData="M7.3252,42.6768 L42.6772,7.32477 M42.6768,42.6768 L7.3248,7.32477 M0.000976562,25.001 C0.000976562,11.193 11.197,0.000976562 25.001,0.000976562 C38.809,0.000976562 50.001,11.193 50.001,25.001 C50.001,38.809 38.809,50.001 25.001,50.001 C11.197,50.001 0.000976562,38.809 0.000976562,25.001 z";break;case"or":n.pathData="M 0 50 L 100 50 M 50 100 L 50 0.0 M 0 50 C 0 22.384 22.392 0 50 0 C 77.616 0 100 22.384 100 50 C 100 77.616 77.616 100 50 100 C 22.392 100 0 77.616 0 50 Z";break;case"internalstorage":n.pathData="M 0 3.8194444444444446A 2.5,3.8194444444444446 0 0,1 2.5,0L 47.5 0A 2.5,3.8194444444444446 0 0,1 50,3.8194444444444446L 50 45.833333333333336A 2.5,3.8194444444444446 0 0,1 47.5,49.65277777777778L 2.5 49.65277777777778A 2.5,3.8194444444444446 0 0,1 0,45.833333333333336L 0 3.8194444444444446ZM 0 11.458333333333334L 50 11.458333333333334M 12.5 0L 12.5 49.65277777777778";break;case"extract":n._shape="polygon";n.constraints=i;n.points=[{x:0,y:35},{x:30,y:0},{x:60,y:35}];break;case"manualoperation":n._shape="polygon";n.points=[{x:46.4,y:28.8},{x:14.8,y:28.8},{x:0,y:0},{x:60,y:0}];break;case"merge":n._shape="polygon";n.constraints=i;n.points=[{x:60,y:0},{x:30,y:35},{x:0,y:0}];break;case"offpagereference":n._shape="polygon";n.points=[{x:60,y:33.3},{x:30.1,y:39},{x:0,y:33.3},{x:0,y:0},{x:60,y:0}];break;case"sequentialaccessstorage":n.constraints=i;n.pathData="M 60 30 C 60 13.4 46.6 0 30 0 S 0 13.4 0 30 s 13.4 30 30 30 h 28.6 v -6.5 h -9.9 C 55.5 48 60 39.5 60 30 Z";break;case"annotation1":n.pathData="M49.9984,50.0029 L-0.00271199,50.0029 L-0.00271199,0.00286865 L49.9984,0.00286865";break;case"annotation2":n.pathData="M49.9977,50.0029 L25.416,50.0029 L25.416,0.00286865 L49.9977,0.00286865 M25.4166,25.0029 L-0.00227869,25.0029";break;case"card":n._shape="polygon";n.points=[{x:275,y:60},{x:400,y:60},{x:400,y:110},{x:260,y:110},{x:260,y:75}];break;case"data":n.pathData="M 10 0 L 40 0 L 30 40 L 0 40 Z "}return n};t.datavisualization.Diagram.ArrowShape=function(n){n._shape="path";n.shape||(n.shape="circulararrow");switch(n.shape){case"circulararrow":n.pathData="M433.4624,503.8848C429.4244,493.2388,419.1354,485.6678,407.0734,485.6678C391.4884,485.6678,378.8544,498.3018,378.8544,513.8868L384.4984,513.8868C384.4984,501.4178,394.6054,491.3108,407.0734,491.3108C415.9494,491.3108,423.6264,496.4338,427.3144,503.8848L422.9114,503.8848L426.8974,508.8848L430.8824,513.8868L434.8684,508.8848L438.8544,503.8848L433.4624,503.8848z";break;case"curvedrightarrow":n.pathData="M0.83006144,28.226993 C2.4030598,37.092016 9.5750604,44.49601 19.365042,48.044014 L19.365042,43.129004 25.376032,47.706001 31.386044,52.282999 25.376032,56.858988 19.365042,61.436991 19.365042,55.399027 C8.24608,51.372995 0.50004381,42.368995 0.50004357,31.905003 0.50004381,30.65601 0.6160717,29.429996 0.83006144,28.226993 z M31.402985,0.5 L31.402985,7.4419994 C15.834992,7.4419994 2.9619988,16.497999 0.81800008,28.275999 0.61199981,27.139999 0.49999988,25.981999 0.5,24.803999 0.49999988,11.379999 14.334993,0.5 31.402985,0.5 z";break;case"curveduparrow":n.pathData="M52.283021,0.51798058 L56.859025,6.5279841 61.436024,12.537989 55.399022,12.537989 C51.373021,23.656996 42.369015,31.403002 31.905011,31.403002 30.65601,31.403002 29.430011,31.288002 28.22701,31.073002 37.092015,29.500999 44.496018,22.328995 48.044018,12.537989 L43.129018,12.537989 47.706021,6.5279841 z M0.5,0.5 L7.4420163,0.5 C7.4420163,16.067989 16.497985,28.940971 28.276,31.083977 27.140013,31.290977 25.981993,31.402 24.804015,31.402 11.380005,31.402 0.5,17.567989 0.5,0.5 z";break;case"curvedleftarrow":n.pathData="M31.073116,28.227982 C31.287107,29.429977 31.403074,30.65599 31.403074,31.905989 31.403074,42.368966 23.657099,51.372959 12.538074,55.399935 L12.538074,61.436979 6.5270846,56.85898 0.51707193,52.282993 6.5270846,47.706976 12.538074,43.129983 12.538074,48.044958 C22.328056,44.496956 29.500118,37.091961 31.073116,28.227982 z M0.5,0.5 C17.568025,0.5 31.403045,11.380997 31.403045,24.803993 31.403045,25.981992 31.291046,27.139992 31.085045,28.276992 28.941042,16.497995 16.068023,7.442997 0.5,7.442997 z";break;case"curveddownarrow":n.pathData="M24.804015,0.50000453 C25.981993,0.50000453 27.140013,0.61301103 28.276,0.8180277 16.498045,2.9630154 7.4420161,15.836023 7.4420156,31.404005 L0.5,31.404005 C0.5,14.336024 11.380004,0.50000453 24.804015,0.50000453 z M31.90502,0.5 C42.369025,0.49999976 51.37303,8.2460016 55.399031,19.365004 L61.436034,19.365004 56.859034,25.377005 52.28303,31.387007 47.70603,25.377005 43.129027,19.365004 48.044028,19.365004 C44.496027,9.5760015 37.092024,2.4040001 28.227019,0.82999995 29.43002,0.61699978 30.65602,0.49999976 31.90502,0.5 z";break;case"jumpingrightarrow":n.pathData="M571.7207,727.7451L563.4507,716.8841L572.3297,716.8841C565.9217,699.1961,552.5427,686.2371,536.5277,683.3951C538.6997,683.0091,540.9157,682.8001,543.1717,682.8001C562.0777,682.8001,578.3457,696.7961,585.6187,716.8841L596.5277,716.8841L588.2577,727.7451L579.9907,738.6041L571.7207,727.7451z";break;case"jumpingleftarrow":n.pathData="M688.4209,727.7441L696.6889,716.8851L687.8119,716.8851C694.2179,699.1971,707.5989,686.2381,723.6119,683.3941C721.4409,683.0101,719.2259,682.8011,716.9679,682.8011C698.0639,682.8011,681.7959,696.7951,674.5209,716.8851L663.6119,716.8851L671.8839,727.7441L680.1509,738.6031L688.4209,727.7441z"}return n};t.datavisualization.Diagram.UMLConnectorShape=function(i){var r,u;i.shape.relationship||(i.shape.relationship="association");switch(i.shape.relationship){case"association":i.shape=t.datavisualization.Diagram.UMLConnectorAssociation(i.shape);break;case"aggregation":i.shape=t.datavisualization.Diagram.UMLConnectorAggregation(i.shape);break;case"composition":i.shape=t.datavisualization.Diagram.UMLConnectorComposition(i.shape);break;case"realization":i.shape=t.datavisualization.Diagram.UMLConnectorRealization(i.shape);break;case"dependency":i.shape=t.datavisualization.Diagram.UMLConnectorDependency(i.shape);break;case"inheritance":i.shape=t.datavisualization.Diagram.UMLConnectorInheritance(i.shape)}if(i.shape.multiplicity){if(i.shape.multiplicity=="manytoone"){if(r=[],r.push({text:"*",segmentOffset:0,alignment:"center"},{text:"1",segmentOffset:1,alignment:"center"}),i.labels)for(u=0;u<r.length;u++)r[u]=n.extend(!0,{},r[u],i.labels[0]);i=n.extend(!0,{},{labels:r},i)}if(i.shape.multiplicity=="onetomany"){if(r=[],r.push({text:"1",segmentOffset:0,alignment:"center"},{text:"*",segmentOffset:1,alignment:"center"}),i.labels)for(u=0;u<r.length;u++)r[u]=n.extend(!0,{},r[u],i.labels[0]);i=n.extend(!0,{},{labels:r},i)}}return i.shape.type=="umlclassifier"&&(i.shape.relationship=="association"&&(i.shape.association=="bidirectional"?i=n.extend(!0,i,{segments:[{type:"straight"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"none"},lineWidth:2}):i.shape.association=="directional"&&(i=n.extend(!0,i,{segments:[{type:"straight"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow"},lineWidth:2}))),i.shape.relationship=="inheritance"&&(i=n.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"})),i.shape.relationship=="composition"&&(i=n.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"diamond",fillColor:"black"},targetDecorator:{shape:"none"},lineWidth:2})),i.shape.relationship=="aggregation"&&(i=n.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"diamond",fillColor:"white"},targetDecorator:{shape:"none"},lineWidth:2})),i.shape.relationship=="dependency"&&(i=n.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"openarrow",fillColor:"white"},lineWidth:2,lineDashArray:"4 4"})),i.shape.relationship=="realization"&&(i=n.extend(!0,i,{segments:[{type:"orthogonal"}],sourceDecorator:{shape:"none"},targetDecorator:{shape:"arrow",fillColor:"white"},lineWidth:2}))),i};t.datavisualization.Diagram.BPMNShape=function(i){i.shape||(i.shape="event");i._annotation&&delete i._annotation;(i.shape!="sequentialflow"||i.shape!="associationflow"||i.shape!="messageflow")&&(i.labels&&i.labels.length||(i.labels=[{}]),i.labels.length&&i.labels[0].offset||(i.labels[0]=n.extend(!0,{},i.labels[0],{offset:{x:.5,y:1},verticalAlignment:"top",margin:{top:2}})));switch(i.shape){case"event":case"gateway":case"dataobject":case"activity":i._type="group";i.children==undefined&&(i.children=[]);i.canUngroup=!1;break;case"message":i=n.extend(!0,i,{_shape:"path",pathData:"M0,0L19.8,12.8L40,0L0,0L0,25.5L40,25.5L40,0z"});break;case"datasource":i=n.extend(!0,i,{_shape:"path",pathData:"M 0 10.6 c 0 5.9 16.8 10.6 37.5 10.6 S 75 16.4 75 10.6 v 0 v 68.9 v -0.1 C 75 85.3 58.2 90 37.5 90 S 0 85.3 0 79.4 l 0 0.1 V 56 V 40.6 L 0 10.6 C 0 4.7 16.8 0 37.5 0 S 75 4.7 75 10.6 S 58.2 21.2 37.5 21.2 S 0 16.5 0 10.6 l 0 6.7 v -0.2 c 0 5.9 16.8 10.6 37.5 10.6 S 75 22.9 75 17.1 v 6.8 v -0.1 c 0 5.9 -16.8 10.6 -37.5 10.6 S 0 29.6 0 23.8"});break;case"group":i=n.extend(!0,i,{_shape:"path",pathData:t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(i,15),borderDashArray:"2 2 6 2"})}return i};t.datavisualization.Diagram.ClassifierShape=function(i,r){var u,f;i.classifier||(i.classifier="class");i.labels||(i.labels=[{margin:{}}]);i.fillColor||(i.fillColor="transparent");i.borderColor||(i.borderColor="transparent");i.borderWidth||(i.borderWidth=1);i.opacity||(i.opacity=1);switch(i.classifier){case"class":for(i["class"]=t.datavisualization.Diagram.ClassifierClass(i["class"]),u=0;u<i["class"].attributes.length;u++)i["class"].attributes[u]=t.datavisualization.Diagram.ClassAttribute(i["class"].attributes[u]);for(f=0;f<i["class"].methods.length;f++)i["class"].methods[f]=t.datavisualization.Diagram.ClassMethod(i["class"].methods[f]);i=t.datavisualization.Diagram.DefautShapes._getClassShape(i,r);break;case"interface":for(i["interface"]=t.datavisualization.Diagram.ClassifierInterface(i["interface"]),u=0;u<i["interface"].attributes.length;u++)i["interface"].attributes[u]=t.datavisualization.Diagram.ClassAttribute(i["interface"].attributes[u]);for(f=0;f<i["interface"].methods.length;f++)i["interface"].methods[f]=t.datavisualization.Diagram.ClassMethod(i["interface"].methods[f]);i=t.datavisualization.Diagram.DefautShapes._getClassShape(i,r);break;case"enumeration":i.enumeration=t.datavisualization.Diagram.ClassifierEnumeration(i.enumeration);i=t.datavisualization.Diagram.DefautShapes._getClassShape(i,r);break;case"member":i.labels[0]=n.extend(!0,{},{name:i.name+"_member",horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5},text:"Member"},i.labels[0]);i=n.extend(!0,{},{borderColor:"transparent",fillColor:"transparent",_shape:"rectangle",horizontalAlign:"stretch",verticalAlign:"bottom",_isClassMember:!0},i)}return i};t.datavisualization.Diagram.DefautShapes={_getBPMNEventShape:function(i,r){var f=[],u,o,s;for(i.children==undefined&&(i.children=[]),i._type="group",i.canUngroup=!1,i=n.extend(!0,{},t.datavisualization.Diagram.BPMNEventDefaults,i),u=0;u<i.children.length;u++)r.nameTable[i.children[u].name||i.children[u]]&&(f.push(r.nameTable[i.children[u].name||i.children[u]]),f[u].rotateAngle=i.rotateAngle);var e=i.pivot||{x:.5,y:.5},h=i.offsetX?i.offsetX-i.width*e.x+i.width/2:i.width*e.x+i.width/2,c=i.offsetY?i.offsetY-i.height*e.y+i.height/2:i.height*e.y+i.height/2;if(!f.length)for(o=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect),s={parent:i.name,type:"node",shape:"path",offsetX:h,offsetY:c,ports:[],rotateAngle:i.rotateAngle,constraints:o,_isDisabled:!0},f.push({name:i.name+"_0",width:i.width,height:i.height}),f.push({name:i.name+"_1",width:i.width*.85,height:i.height*.85}),f.push({name:i.name+"_2",width:i.width*.5,height:i.height*.5}),u=0;u<f.length;u++)f[u]=t.datavisualization.Diagram.Node(n.extend(!0,{},s,f[u]));return i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.children=this._updateBPMNEventShape(i,f,i.event,i.trigger),i},_getBPMNGatewayShape:function(i,r){var u=[],f,o,s;for(i.children==undefined&&(i.children=[]),i._type="group",i.canUngroup=!1,i=n.extend(!0,{},t.datavisualization.Diagram.BPMNGatewayDefaults,i),f=0;f<i.children.length;f++)r.nameTable[i.children[f].name||i.children[f]]&&(u.push(r.nameTable[i.children[f].name||i.children[f]]),u[f].rotateAngle=i.rotateAngle);var e=i.pivot||{x:.5,y:.5},h=i.offsetX?i.offsetX-i.width*e.x+i.width/2:i.width*e.x+i.width/2,c=i.offsetY?i.offsetY-i.height*e.y+i.height/2:i.height*e.y+i.height/2;if(!u.length)for(o=t.datavisualization.Diagram.NodeConstraints.Default^(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect),s={parent:i.name,type:"node",shape:"path",offsetX:h,offsetY:c,ports:[],rotateAngle:i.rotateAngle},u.push({name:i.name+"_0",width:i.width,height:i.height,pathData:"M 40 20 L 20 40 L 0 20 L 20 0 L 40 20 Z",constraints:o,_isDisabled:!0}),u.push({name:i.name+"_1",width:i.width*.45,height:i.height*.45,constraints:o,_isDisabled:!0}),f=0;f<u.length;f++)u[f]=t.datavisualization.Diagram.Node(n.extend(!0,{},s,u[f]));i.children=u;i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default;n.extend(!0,u,[{fillColor:i.fillColor,borderColor:i.borderColor,borderWidth:i.borderWidth,opacity:i.opacity,gradient:i.gradient},{opacity:i.opacity,fillColor:"black",visible:!0}]);switch(i.gateway){case"none":u[1].visible=!1;break;case"exclusive":u[1].pathData="M 11.196 29.009 l 6.36 -9.712 l -5.764 -8.899 h 4.393 l 3.732 5.979 l 3.656 -5.979 h 4.354 l -5.789 9.039 l 6.36 9.572 h -4.532 l -4.126 -6.437 l -4.139 6.437 H 11.196 Z";break;case"inclusive":u[1].pathData="M 20.323 31.333 c -6.625 0 -12.015 -5.39 -12.015 -12.015 s 5.39 -12.015 12.015 -12.015 s 12.016 5.39 12.016 12.015 S 26.948 31.333 20.323 31.333 Z M 20.323 9.303 c -5.522 0 -10.015 4.493 -10.015 10.015 s 4.492 10.015 10.015 10.015 s 10.016 -4.493 10.016 -10.015 S 25.846 9.303 20.323 9.303 Z";break;case"parallel":u[1].pathData="M 18.394 29.542 v -8.833 H 9.626 v -3.691 h 8.768 V 8.251 h 3.734 v 8.767 h 8.768 v 3.691 h -8.768 v 8.833 H 18.394 Z";break;case"complex":u[1].pathData="M29.198,19.063L23.089,19.063L27.794,14.358L26.38,12.944L21.223,18.101L21.223,10.443L19.223,10.443L19.223,17.976L14.022,12.776L12.608,14.19L17.48,19.063L10.365,19.063L10.365,21.063L18.261,21.063L12.392,26.932L13.806,28.346L19.223,22.929L19.223,30.225L21.223,30.225L21.223,22.805L25.925,27.507L27.339,26.093L22.309,21.063L29.198,21.063z";break;case"eventbased":u[1].fillColor="white";u[1].pathData="M 20.322 29.874 c -5.444 0 -9.873 -4.43 -9.873 -9.874 s 4.429 -9.874 9.873 -9.874 s 9.874 4.429 9.874 9.874 S 25.767 29.874 20.322 29.874 Z M 20.322 32.891 c -7.107 0 -12.89 -5.783 -12.89 -12.891 c 0 -7.107 5.782 -12.89 12.89 -12.89 c 7.108 0 12.891 5.783 12.891 12.89 C 33.213 27.108 27.431 32.891 20.322 32.891 Z M 24.191 25.386 h -7.984 l -2.469 -7.595 l 6.461 -4.693 l 6.461 4.693 L 24.191 25.386 Z";break;case"exclusiveeventbased":u[1].fillColor="white";u[1].pathData="M 30 15 C 30 23.28 23.28 30 15 30 S 0 23.28 0 15 S 6.72 0 15 0 S 30 6.72 30 15 z M 15 5 L 5 12.5 L 8 22.5 H 22 L 25 12.5 z";break;case"paralleleventbased":u[1].fillColor="white";u[1].pathData="M 35 17.5 C 35 27.16 27.16 35 17.5 35 S 0 27.16 0 17.5 S 7.84 0 17.5 0 S 35 7.84 35 17.5 z M 14.58 5.83 V 14.58 H 5.83 V 20.42 H 14.58 V 29.17 H 20.42 V 20.42 H 29.17 V 14.58 H 20.42 V 5.83 z"}return i},_getClassShape:function(i,r){var f=[],k,l,y="",p="",w="",b="",v,a,o,c,e,h,u,s;if(i.children){for(u=0;u<i.children.length;u++)r.nameTable[i.children[u].name||i.children[u]]&&f.push(r.nameTable[i.children[u].name||i.children[u]]);if(f.length<=0&&i.children.length>0)for(s=0;s<i.children.length;s++)f.push(i.children[s])}else{if(v=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeSouth|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Rotate|t.datavisualization.Diagram.NodeConstraints.ResizeEast|t.datavisualization.Diagram.NodeConstraints.Drag),a={width:i.width,offsetX:i.offsetX,parent:i.name,ports:[],fillColor:"transparent",borderColor:i.borderColor,type:"node",labels:[{margin:{left:5,right:5,top:5,bottom:5}}],_isClassMember:!0},i.fillColor&&(a.fillColor=i.fillColor),i.borderColor&&(a.borderColor=i.borderColor),i.borderWidth&&(a.borderWidth=i.borderWidth),i.labels)for(u=0;u<i.labels.length;u++)a.labels[u]=n.extend(!0,{},a.labels[u],i.labels[u]);switch(i.classifier){case"class":f.push({ports:[],name:i.name+"_header_classifier",minHeight:30,labels:[{name:"title",offset:{x:.5,y:.65},text:i["class"].name,bold:!0,fontSize:14},{name:"class",offset:{x:.5,y:.25},text:"<<Class>>"}],constraints:v});break;case"interface":f.push({name:i.name+"_header_classifier",minHeight:40,labels:[{name:"title",offset:{x:.5,y:.65},text:i["interface"].name,bold:!0,fontSize:14},{name:"interface",offset:{x:.5,y:.25},text:"<<Interface>>"}],constraints:v});break;case"enumeration":f.push({name:i.name+"_header_classifier",minHeight:40,labels:[{name:i.name+"Label1",offset:{x:.5,y:.65},text:i.enumeration.name,bold:!0,fontSize:14},{name:i.name+"enumeration",offset:{x:.5,y:.25},text:"<<Enumeration>>"}],constraints:v})}if(o=i["class"]?i["class"]:i["interface"],o&&o.attributes&&o.attributes.length){for(u=0;u<o.attributes.length;u++)o.attributes[u]=t.datavisualization.Diagram.ClassAttribute(o.attributes[u]),i.Interface&&(o.attributes[u].scope=t.datavisualization.Diagram.ScopeValueDefaults.Public),o.attributes[u].scope&&o.attributes[u].scope=="public"&&(h="+"),o.attributes[u].scope&&o.attributes[u].scope=="private"&&(h="-"),o.attributes[u].scope&&o.attributes[u].scope=="protected"&&(h="#"),o.attributes[u].scope&&o.attributes[u].scope=="package"&&(h="~"),o.attributes[u].name!=""&&(y+=h?h+" "+o.attributes[u].name+" : "+o.attributes[u].type:o.attributes[u].name+": "+o.attributes[u].type),u!=o.attributes.length-1&&(y+="\n");y&&f.push({name:i.name+"_attribute_classifier",labels:[{text:y,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:v})}if(c=i.enumeration,c&&c.members&&c.members.length){for(u=0;u<c.members.length;u++)c.members[u]=t.datavisualization.Diagram.ClassMember(c.members[u]),c.members[u].name!=""&&(w+=c.members[u].name),u!=c.members.length-1&&(w+="\n");w&&f.push({name:i.name+"_member_classifier",labels:[{text:w,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:v})}if(e=i["class"]?i["class"]:i["interface"],e&&e.methods&&e.methods.length){for(u=0;u<e.methods.length;u++){if(e.methods[u]=t.datavisualization.Diagram.ClassMethod(e.methods[u]),e.methods[u].scope&&e.methods[u].scope=="public"&&(h="+"),e.methods[u].scope&&e.methods[u].scope=="private"&&(h="-"),e.methods[u].scope&&e.methods[u].scope=="protected"&&(h="#"),e.methods[u].scope&&e.methods[u].scope=="package"&&(h="~"),e.methods[u].arguments)for(s=0;s<e.methods[u].arguments.length;s++)b+=e.methods[u].arguments[s].type?e.methods[u].arguments[s].name+":"+e.methods[u].arguments[s].type:e.methods[u].arguments[s].name,s!=e.methods[u].arguments.length-1&&(b+=",");e.methods[u].name!=""&&(p+=h?h+" "+e.methods[u].name+"("+b+") : "+e.methods[u].type:e.methods[u].name+"("+b+") :"+e.methods[u].type);u!=e.methods.length-1&&(p+="\n")}p&&f.push({name:i.name+"_method_classifier",labels:[{text:p,horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:v})}for(u=0;u<f.length;u++)for(f[u]=t.datavisualization.Diagram.Node(n.extend(!0,{},a,f[u])),s=0;s<f[u].labels.length;s++)f[u].labels[s]=n.extend(!0,{},f[u].labels[s],a.labels[0]);for(i.children=f,i._type="group",i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.constraints=i.constraints&~(t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeSouth|t.datavisualization.Diagram.NodeConstraints.Rotate|t.datavisualization.Diagram.NodeConstraints.ResizeEast|t.datavisualization.Diagram.NodeConstraints.Drag),u=0;u<f.length;u++)f.length==1&&(i["class"]&&(delete i["class"].attributes,delete i["class"].methods),i["interface"]&&(delete i["interface"].attributes,delete i["interface"].methods),i.enumeration&&delete i.enumeration.members),f.length==2&&(i.children[u]=typeof i.children[u]=="string"?r.nameTable[i.children[u]]:i.children[u],i["class"]&&(i.children[u].name.match("attribute")&&delete i["class"].methods,i.children[u].name.match("method")&&delete i["class"].attributes),i["interface"]&&(i.children[u].name.match("attribute")&&delete i["interface"].methods,i.children[u].name.match("method")&&delete i["interface"].attributes))}for(i._height=0,u=0;u<f.length;u++)r._getNodeDimension(f[u],f[u].labels[0]),k=f[u].height?f[u].height:f[u]._height,f[u].offsetY=i._height+k/2,i._height+=k;for(l=f[0]._width,f[1]&&(l=f[0]._width>f[1]._width?f[0]._width:f[1]._width),f[2]&&(l=f[2]._width>l?f[2]._width:l),f[0].width=l,f[1]&&(f[1].width=l),f[2]&&(f[2].width=l),i._width=l,i.width=i._width,i.height=i._height,u=0;u<f.length;u++)f[u].offsetY+=i.offsetY-i.height/2;return i},_updateClassNode:function(n,i){var h;if(n.name.match("_header"))i.type=="class"?i.className=n.labels[0].text:i.type=="interface"?i.interfaceName=n.labels[0].text:i.enumerationName=n.labels[0].text;else{for(var o=n.name.match("_attribute")?"attribute":n.name.match("_method")?"method":"member",s=n.labels[0],e=s.text.split("\n"),u=[],r,f=0;f<e.length;f++){h=i.Class?i.Class:i.Interface;switch(o){case"attribute":r=e[f].split(/:[ ]*/g);u.push(t.datavisualization.Diagram.ClassMember({name:r[0],type:r[1]}));break;case"method":r=e[f].replace(")","").replace("(",":").split(/:[ ]*/g);u.push(t.datavisualization.Diagram.ClassMember({name:r[0],returnType:r[1],parameter:r[2]}));break;case"member":u.push(t.datavisualization.Diagram.ClassMember({name:e[f]}))}}o=="attribute"?i.attributes=u:o=="method"?i.methods=u:i.members=u}},_getBPMNDataShape:function(i,r){var u=[],f,e,h,o,c,s,l;for(i.children==undefined&&(i.children=[]),i._type="group",e=i.pivot||{x:.5,y:.5},i.canUngroup=!1,i=n.extend(!0,{},t.datavisualization.Diagram.BPMNDataObjectDefaults,i),h=i.offsetX?i.offsetX-i.width*e.x:i.width*e.x,o=i.offsetY?i.offsetY-i.height*e.y:i.height*e.y,f=0;f<i.children.length;f++)r.nameTable[i.children[f].name||i.children[f]]&&(u.push(r.nameTable[i.children[f].name||i.children[f]]),u[f].rotateAngle=i.rotateAngle);if(c=i.offsetX?i.offsetX-i.width*e.x+i.width/2:i.width*e.x+i.width/2,!u.length)for(s=t.datavisualization.Diagram.NodeConstraints.Default^(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect),l={parent:i.name,type:"node",shape:"path",offsetX:c,ports:[],rotateAngle:i.rotateAngle},u.push({name:i.name+"_0",width:i.width,height:i.height,offsetY:o+i.height/2,shape:"polygon",points:[{x:29.904,y:5},{x:7.853,y:5},{x:7.853,y:45},{x:42.147,y:45},{x:42.147,y:17.242},{x:29.932,y:5},{x:29.932,y:17.242},{x:42.147,y:17.242}],constraints:s,_isDisabled:!0}),u.push({name:i.name+"_1",width:i.width*.075,height:i.height*.15,offsetY:i.height*.85+o,fillColor:"black",pathData:"M 0 0 L 0.1 0 L 0.1 2 L 0 2 Z M 0.4 0 L 0.6 0 L 0.6 2 L0.4 2 Z M 0.9 0 L 1 0 L 1 2 L 0.9 2 Z ",constraints:s,_isDisabled:!0}),u.push({name:i.name+"_2",width:i.width*.25,height:i.height*.2,offsetX:h+i.width*.175,offsetY:o+i.height*.15,borderColor:"black",fillColor:"white",pathData:"M 3 9.4 l 6 0 v 2.4 l 3.6 -4 L 9 4 v 2.5 H 3 V 9.4 Z",constraints:s,_isDisabled:!0}),f=0;f<u.length;f++)u[f]=t.datavisualization.Diagram.Node(n.extend(!0,{},l,u[f]));i.children=u;i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default;n.extend(!0,u,[{fillColor:i.fillColor,borderColor:i.borderColor,borderWidth:i.borderWidth,opacity:i.opacity,gradient:i.gradient},{opacity:i.opacity,visible:i.data.collection},{opacity:i.opacity,visible:!0}]);switch(i.data.type){case"none":u[2].visible=!1;break;case"input":u[2].fillColor="white";break;case"output":u[2].fillColor="black"}return i},_getBPMNActivityShape:function(i,r){var f=[],o={},u,e,s;for(i.children==undefined&&(i.children=[]),i._type="group",i.canUngroup=!1,i=n.extend(!0,{},t.datavisualization.Diagram.BPMNActivityDefaults,i),u=0;u<i.children.length;u++)r.nameTable[i.children[u].name||i.children[u]]&&(f.push(r.nameTable[i.children[u].name||i.children[u]]),f[u].rotateAngle=i.rotateAngle);if(!f.length)for(e=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Resize),s={parent:i.name,type:"node",shape:"path",ports:[],labels:[],constraints:e,rotateAngle:i.rotateAngle,_isDisabled:!0,_isInternalShape:!0},f.push({name:i.name+"_activity",width:i.width,height:i.height,addInfo:{offset:{x:.5,y:.5}},constraints:e|t.datavisualization.Diagram.NodeConstraints.Resize}),f.push({name:i.name+"_taskType",width:14,height:14,borderColor:"black",addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:14,top:14}}}),f.push({name:i.name+"_loop",width:12,height:12,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black"}),f.push({name:i.name+"_compensation",width:12,height:12,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black"}),f.push({name:i.name+"_expanded",width:12,height:12,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black"}),f.push({name:i.name+"_adhoc",width:12,height:8,addInfo:{offset:{x:.5,y:1},hAlign:"center",vAlign:"bottom",margin:{bottom:12}},borderColor:"black",fillColor:"black"}),f.push({name:i.name+"_event_1",width:24,height:24,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),f.push({name:i.name+"_event_2",width:20.4,height:20.4,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),f.push({name:i.name+"_event_3",width:12,height:12,addInfo:{offset:{x:0,y:0},hAlign:"left",vAlign:"top",margin:{left:18,top:18}}}),u=0;u<f.length;u++)f[u]=t.datavisualization.Diagram.Node(n.extend(!0,{},s,f[u]));for(i.constraints=i.constraints?i.constraints:t.datavisualization.Diagram.NodeConstraints.Default,i.children=this._updateBPMNActivityShape(i,f),u=0;u<i.children.length;u++)o[i.children[u].name]=i.children[u];return t.datavisualization.Diagram.Util._updateBPMNProperties(i,r,o),i},_updateBPMNEventShape:function(i,r,u,f){var e="M164.1884,84.6909000000001C156.2414,84.6909000000001,149.7764,78.2259000000001,149.7764,70.2769000000001C149.7764,62.3279000000001,156.2414,55.8629000000001,164.1884,55.8629000000001C172.1354,55.8629000000001,178.6024,62.3279000000001,178.6024,70.2769000000001C178.6024,78.2259000000001,172.1354,84.6909000000001,164.1884,84.6909000000001",o=[{pathData:e,fillColor:i.fillColor,borderWidth:i.borderWidth,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,visible:!0},{pathData:e,fillColor:i.fillColor,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,visible:!0},{pathData:e,fillColor:"white",borderColor:i.borderColor,opacity:i.opacity,height:r[0].height*.5,visible:!0}];n.extend(!0,r,o);switch(u){case"start":r[1].visible=!1;break;case"noninterruptingstart":r[0].borderDashArray="2 3";r[1].visible=!1;break;case"intermediate":r[0].fillColor="white";r[0].gradient=null;break;case"noninterruptingintermediate":r[0].fillColor="white";r[0].gradient=null;r[0].borderDashArray="2 3";r[1].borderDashArray="2 3";break;case"throwingintermediate":case"end":r[0].fillColor=u!="end"?"white":"black";r[0].gradient=null;r[2].fillColor="black";r[2].borderColor=i.fillColor}switch(f){case t.datavisualization.Diagram.BPMNTriggers.None:r[2].visible=!1;break;case t.datavisualization.Diagram.BPMNTriggers.Message:r[2].pathData="M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0";r[2].height=3*r[2].width/4;break;case t.datavisualization.Diagram.BPMNTriggers.Timer:r[2].pathData="M40,20c0,8.654-5.496,16.024-13.189,18.81C24.685,39.58,22.392,40,20,40C8.954,40,0,31.046,0,20S8.954,0,20,0S40,8.954,40,20z M20,0 L20,2.583 L20,5.283 M10.027,2.681 L11.659,5.507 L12.669,7.257 M2.731,9.989 L6.014,11.885 L7.307,12.631 M0.067,19.967 L2.667,19.967 L5.35,19.967M2.748,29.939 L5.731,28.217 L7.323,27.298 M10.056,37.236 L11.292,35.095 L12.698,32.66 M20.033,39.9 L20.033,36.417 L20.033,34.617 M30.006,37.219 L28.893,35.292 L27.364,32.643 M37.302,29.911 L34.608,28.355 L32.727,27.269M39.967,19.933 L37.417,19.933 L34.683,19.933 M37.286,9.961 L34.583,11.521 L32.71,12.602 M29.977,2.664 L28.653,4.957 L27.336,7.24 M22.104,8.5 L19.688,20 L24.75,20 L31.604,20 L24.75,20 L19.688,20z";break;case t.datavisualization.Diagram.BPMNTriggers.Error:r[2].pathData="M 23.77 18.527 l -7.107 27.396 l 8.507 -17.247 L 36.94 40.073 l 6.394 -25.997 l -8.497 15.754 L 23.77 18.527 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Escalation:r[2].pathData="M 30.001 8.098 L 11.842 43.543 l 18.159 -18.882 l 18.162 18.882 L 30.001 8.098 Z ";break;case t.datavisualization.Diagram.BPMNTriggers.Cancel:r[2].pathData="M 3.5 16 L 0 12.6 L 4.6 8 L 0 3.5 L 3.4 0 L 8 4.6 l 4.5 -4.5 L 16 3.5 L 11.5 8 l 4.5 4.5 l -3.4 3.5 L 8 11.4 L 3.5 16 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Compensation:r[2].pathData="M 25.7086 0 L 0 25 L 25.7086 50 V 26.3752 L 50 50 V 0 L 25.7086 23.6248 V 0 Z ";break;case t.datavisualization.Diagram.BPMNTriggers.Conditional:r[2].pathData="M 0 0 H 16 V 16 H 0 z M 1.14 3.2 H 14.85 M 1.14 6.4 H 14.85 M 1.14 9.6 H 14.85 M 1.14 12.8 H 14.85";break;case t.datavisualization.Diagram.BPMNTriggers.Link:r[2].pathData="M 32.014 19.258 v 5.992 H 9.373 v 9.504 h 22.641 v 5.988 L 50.622 30 L 32.014 19.258 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Signal:r[2].pathData="M 50 50 H 0 L 25.0025 0 L 50 50 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Terminate:r[2].pathData="M 25 50 C 11.21 50 0 38.79 0 25 C 0 11.21 11.21 0 25 0 C 38.78 0 50 11.21 50 25 C 50 38.79 38.78 50 25 50";break;case t.datavisualization.Diagram.BPMNTriggers.Multiple:r[2].pathData="M 17.784 48.889 H 42.21 l 7.548 -23.23 L 29.997 11.303 L 10.236 25.658 L 17.784 48.889 Z";break;case t.datavisualization.Diagram.BPMNTriggers.Parallel:r[2].pathData="M 27.276 49.986 h 5.58 v -17.15 h 17.146 V 27.17 h -17.15 l 0.004 -17.15 h -5.58 l -0.004 17.15 H 9.994 v 5.666 h 17.278 L 27.276 49.986 Z"}return r},_updateBPMNActivityShape:function(i,r){var b=[{fillColor:i.fillColor,borderWidth:i.borderWidth,borderColor:i.borderColor,borderDashArray:"1 0",opacity:i.opacity,gradient:i.gradient,pathData:this._updateRoundedRectanglePath(i,12)},{fillColor:"white",borderColor:"black",width:14,height:14,opacity:i.opacity,visible:!1},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!0},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!0},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!1},{addInfo:{margin:{left:0}},opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1},{opacity:i.opacity,visible:!1}],l,a,y,e,c,u,o,p,w,s;n.extend(!0,r,b);l=i.activity=="task"?i.task.loop:i.subProcess.loop;a=i.activity=="task"?i.task.compensation:i.subProcess.compensation;switch(l){case"none":r[2].visible=!1;break;case"standard":r[2].pathData="M 52.002 73.379 c -2.494 -2.536 -6.55 -2.534 -9.043 0 c -1.208 1.228 -1.874 2.861 -1.874 4.598 c 0 1.225 0.337 2.395 0.957 3.411 l -1.167 1.186 l 2.071 0.458 l 2.071 0.458 l -0.45 -2.106 l -0.45 -2.106 l -1.292 1.314 c -1.119 -2.065 -0.842 -4.709 0.877 -6.458 c 2.084 -2.119 5.475 -2.117 7.557 0 c 2.083 2.119 2.083 5.565 0 7.685 c -0.976 0.992 -2.272 1.557 -3.65 1.59 l 0.025 1.068 c 1.65 -0.041 3.2 -0.716 4.368 -1.903 c 1.208 -1.228 1.874 -2.861 1.874 -4.597 C 53.875 76.24 53.209 74.607 52.002 73.379 Z";break;case"parallelmultiinstance":r[2].pathData="M 51.5,69.5 L52.5,69.5 L52.5,84.5 L51.5 84.5 Z M 46.5,69.5 L47.5,69.5 L47.5,84.5 L46.5 84.5 Z M 41.5,69.5 L42.5,69.5 L42.5,84.5 L41.5 84.5 Z  ";break;case"sequencemultiinstance":r[2].pathData="M 40.375,71.5 L 55.375,71.5 L 55.375,72.5 L 40.375,72.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,76.5 L 55.375,76.5 L 55.375,77.5 L 40.375,77.5 Z M 40.375,81.5 L 55.375,81.5 L 55.375,82.5 L 40.375,82.5 Z"}if(a?r[3].pathData="M 22.462 18.754 l -6.79 3.92 l 6.79 3.92 V 22.89 l 6.415 3.705 v -7.841 l -6.415 3.705 V 18.754 Z M 28.331 19.701 v 5.947 l -5.149 -2.973 L 28.331 19.701 Z M 21.916 25.647 l -5.15 -2.973 l 5.15 -2.973 V 25.647 Z M 22.275 12.674 c -5.513 0 -9.999 4.486 -9.999 9.999 c 0 5.514 4.486 10.001 9.999 10.001 c 5.514 0 9.999 -4.486 9.999 -10.001 C 32.274 17.16 27.789 12.674 22.275 12.674 Z M 22.275 32.127 c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 c 5.212 0 9.453 4.241 9.453 9.453 C 31.728 27.887 27.487 32.127 22.275 32.127 Z":r[3].visible=!1,i.activity==t.datavisualization.Diagram.BPMNActivity.Task){r[1].visible=!0;switch(i.task.type){case"none":r[1].visible=!1;break;case"service":r[1].pathData="M 32.699 20.187 v -4.005 h -3.32 c -0.125 -0.43 -0.292 -0.83 -0.488 -1.21 l 2.373 -2.375 l -2.833 -2.83 l -2.333 2.333 c -0.44 -0.253 -0.9 -0.448 -1.387 -0.595 v -3.32 h -4.003 v 3.32 c -0.46 0.137 -0.89 0.322 -1.3 0.537 l -2.285 -2.275 l -2.833 2.83 l 2.285 2.278 c -0.235 0.42 -0.41 0.847 -0.547 1.307 h -3.33 v 4.005 h 3.33 c 0.148 0.488 0.343 0.955 0.588 1.395 l -2.325 2.325 l 2.822 2.832 l 2.373 -2.382 c 0.392 0.205 0.792 0.37 1.212 0.497 v 3.33 h 4.003 v -3.33 c 0.46 -0.138 0.89 -0.323 1.3 -0.547 l 2.43 2.432 l 2.822 -2.832 l -2.42 -2.422 c 0.222 -0.41 0.4 -0.85 0.535 -1.297 H 32.699 Z M 22.699 21.987 c -2.1 0 -3.803 -1.703 -3.803 -3.803 c 0 -2.1 1.703 -3.803 3.803 -3.803 c 2.1 0 3.803 1.703 3.803 3.803 C 26.502 20.285 24.8 21.987 22.699 21.987 Z";break;case"receive":r[1].pathData="M 12.217 12.134 v 13.334 h 20 V 12.134 H 12.217 Z M 30.44 13.007 l -8.223 5.35 l -8.223 -5.35 H 30.44 Z M 13.09 24.594 V 13.459 l 9.127 5.94 l 9.127 -5.94 v 11.135 H 13.09 Z";r[1].height=12;break;case"send":r[1].pathData="M 45.7256 3.16055 L 25 23.4017 L 4.27442 3.16055 H 45.7256 Z M 47.8963 46.8413 H 2.10375 V 4.80813 L 25 27.1709 L 47.8963 4.80813 V 46.8413 Z";r[1].height=12;r[1].fillColor="black";r[1].borderColor="white";break;case"instantiatingreceive":r[1].pathData="M 16.306 17.39 v 8.79 h 13.198 v -8.79 H 16.306 Z M 28.375 17.946 l -5.47 3.558 l -5.47 -3.558 H 28.375 Z M 28.948 25.625 H 16.861 v -7.389 l 6.043 3.931 l 6.043 -3.931 V 25.625 Z M 22.905 11.785 c -5.514 0 -9.999 4.486 -9.999 10 c 0 5.514 4.485 10 9.999 10 s 9.999 -4.486 9.999 -10 C 32.904 16.272 28.419 11.785 22.905 11.785 Z M 22.905 31.239 c -5.212 0 -9.453 -4.241 -9.453 -9.454 c 0 -5.212 4.241 -9.453 9.453 -9.453 s 9.452 4.241 9.452 9.453 C 32.357 26.998 28.117 31.239 22.905 31.239 Z";r[1].width=20;r[1].height=20;break;case"manual":r[1].pathData="M 13.183 15.325 h 2.911 c 0.105 0 0.207 -0.043 0.281 -0.117 c 0.078 -0.074 0.117 -0.176 0.117 -0.281 c 0 -0.753 0.718 -1.362 1.596 -1.362 h 2.579 c -0.117 0.227 -0.191 0.48 -0.195 0.757 c 0 0.433 0.168 0.851 0.46 1.144 c 0.008 0.004 0.015 0.011 0.019 0.015 c -0.289 0.285 -0.475 0.691 -0.479 1.148 c 0 0.433 0.168 0.846 0.46 1.139 c 0.011 0.012 0.023 0.02 0.035 0.032 c -0.301 0.281 -0.491 0.694 -0.495 1.155 c 0 0.432 0.168 0.847 0.46 1.143 c 0.265 0.266 0.612 0.414 0.975 0.414 h 0.839 c 0.027 0.004 0.051 0.012 0.074 0.012 h 8.443 c 0.352 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.285 0.753 -0.636 0.753 h -6.687 c -0.019 0 -0.035 -0.008 -0.051 -0.008 h -2.27 c -0.121 -0.835 -0.667 -1.187 -1.795 -1.187 h -2.158 c -0.223 0 -0.402 0.18 -0.402 0.403 c 0 0.219 0.179 0.398 0.402 0.398 h 2.158 c 0.972 0 1.019 0.203 1.019 0.784 c 0 0.219 0.179 0.399 0.402 0.399 c 0.008 0 0.016 -0.004 0.027 -0.004 c 0.028 0.004 0.055 0.016 0.082 0.016 h 2.56 c 0.34 0.015 0.616 0.343 0.616 0.752 c 0 0.418 -0.285 0.757 -0.636 0.761 h -0.004 h -6.442 c -0.878 0 -1.595 -0.639 -1.595 -1.427 v -0.683 c 0 -0.109 -0.043 -0.211 -0.114 -0.285 c -0.078 -0.074 -0.179 -0.117 -0.285 -0.117 h -0.004 l -2.989 0.027 c -0.223 0 -0.398 0.184 -0.398 0.402 c 0 0.219 0.179 0.395 0.398 0.395 h 0.004 l 2.591 -0.02 v 0.282 c 0 1.229 1.073 2.223 2.391 2.223 h 3.895 c 0.004 0 0.007 0.004 0.011 0.004 h 2.536 c 0.792 0 1.436 -0.698 1.436 -1.561 c 0 -0.273 -0.07 -0.53 -0.188 -0.752 h 5.49 c 0.792 0 1.436 -0.695 1.436 -1.553 c 0 -0.858 -0.644 -1.557 -1.436 -1.557 h -3.566 c 0.121 -0.226 0.199 -0.487 0.199 -0.768 c 0 -0.468 -0.195 -0.882 -0.495 -1.167 c 0.301 -0.285 0.495 -0.698 0.495 -1.163 c 0 -0.456 -0.191 -0.866 -0.483 -1.152 c 0.293 -0.285 0.483 -0.694 0.483 -1.151 c 0 -0.858 -0.647 -1.557 -1.439 -1.557 h -8.373 c -1.167 0 -2.142 0.757 -2.352 1.76 l -2.548 -0.004 c -0.219 0 -0.399 0.18 -0.399 0.403 C 12.784 15.145 12.964 15.325 13.183 15.325 L 13.183 15.325 Z M 21.907 19.707 c -0.191 0 -0.328 -0.094 -0.41 -0.176 c -0.144 -0.145 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.418 0.289 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.008 h 0.051 c 0.351 0 0.636 0.344 0.636 0.761 c 0 0.414 -0.286 0.753 -0.636 0.753 H 21.907 Z M 27.097 16.629 c 0 0.414 -0.286 0.753 -0.64 0.753 h -4.464 c -0.004 0 -0.004 0 -0.004 0 h -0.082 c -0.191 0 -0.328 -0.098 -0.414 -0.18 c -0.14 -0.145 -0.222 -0.352 -0.222 -0.573 c 0 -0.413 0.285 -0.749 0.631 -0.753 h 3.434 c 0 0 0 0 0.004 0 h 1.116 c 0.008 0 0.012 -0.004 0.02 -0.004 C 26.819 15.887 27.097 16.215 27.097 16.629 L 27.097 16.629 Z M 27.097 14.322 c 0 0.41 -0.278 0.737 -0.62 0.749 c -0.008 0 -0.012 0 -0.016 0 h -3.637 c -0.008 0 -0.015 0.004 -0.023 0.004 h -0.886 c -0.004 0 -0.008 0 -0.012 0 c -0.187 0 -0.324 -0.094 -0.406 -0.176 c -0.144 -0.144 -0.226 -0.355 -0.226 -0.577 c 0.003 -0.414 0.293 -0.753 0.643 -0.753 h 4.468 c 0.008 0 0.015 -0.004 0.027 -0.004 h 0.051 C 26.811 13.565 27.097 13.905 27.097 14.322 L 27.097 14.322 Z M 27.097 14.322";r[1].width=20;break;case"businessrule":r[1].pathData="M 32.844 13.245 h -0.089 v 0 H 13.764 v -0.015 h -1.009 v 16.989 h 0.095 v 0.011 h 19.716 v -0.011 h 0.278 V 13.245 Z M 31.844 14.229 v 4.185 h -18.08 v -4.185 H 31.844 Z M 18.168 25.306 v 3.938 h -4.404 v -3.938 H 18.168 Z M 13.764 24.322 v -4.923 h 4.404 v 4.923 H 13.764 Z M 19.177 25.306 h 12.667 v 3.938 H 19.177 V 25.306 Z M 19.177 24.322 v -4.923 h 12.667 v 4.923 H 19.177 Z";break;case"user":r[1].pathData="M 21.762 21.935 c 2.584 0 4.687 -2.561 4.687 -5.703 c 0 -3.147 -2.103 -5.703 -4.687 -5.703 c -1.279 0 -2.475 0.61 -3.363 1.721 c -0.855 1.071 -1.327 2.484 -1.324 3.983 C 17.075 19.374 19.178 21.935 21.762 21.935 L 21.762 21.935 Z M 21.762 11.779 c 1.894 0 3.436 1.995 3.436 4.452 c 0 2.453 -1.541 4.452 -3.436 4.452 c -1.895 0 -3.44 -1.999 -3.44 -4.452 C 18.323 13.774 19.864 11.779 21.762 11.779 L 21.762 11.779 Z M 25.699 21.309 c -0.348 0 -0.626 0.277 -0.626 0.626 c 0 0.344 0.277 0.622 0.626 0.622 c 2.136 0 3.875 1.74 3.875 3.879 c 0 0.272 -0.227 0.498 -0.501 0.498 H 14.447 c -0.274 0 -0.497 -0.223 -0.497 -0.498 c 0 -2.139 1.736 -3.879 3.872 -3.879 c 0.344 0 0.625 -0.277 0.625 -0.622 c 0 -0.348 -0.28 -0.626 -0.625 -0.626 c -2.826 0 -5.124 2.297 -5.124 5.126 c 0 0.965 0.784 1.749 1.748 1.749 h 14.626 c 0.964 0 1.748 -0.784 1.748 -1.749 C 30.822 23.606 28.524 21.309 25.699 21.309 L 25.699 21.309 Z M 22.217 9.832 c 0.448 -0.263 0.924 -0.396 1.419 -0.396 c 1.895 0 3.436 1.995 3.436 4.452 c 0 0.439 -0.048 0.873 -0.143 1.284 c -0.08 0.336 0.128 0.672 0.464 0.751 c 0.048 0.012 0.098 0.019 0.143 0.019 c 0.284 0 0.541 -0.195 0.608 -0.483 c 0.119 -0.506 0.18 -1.034 0.18 -1.571 c 0 -3.147 -2.102 -5.703 -4.687 -5.703 c -0.711 0 -1.419 0.198 -2.054 0.573 c -0.296 0.174 -0.397 0.559 -0.219 0.855 C 21.536 9.911 21.921 10.009 22.217 9.832 L 22.217 9.832 Z M 27.697 18.81 c -0.345 0 -0.626 0.277 -0.626 0.622 c 0 0.348 0.281 0.626 0.626 0.626 c 2.137 0 3.75 1.782 3.75 3.918 c 0 0.07 -0.013 0.141 -0.043 0.205 c -0.14 0.314 0.003 0.684 0.318 0.823 c 0.082 0.037 0.167 0.055 0.253 0.055 c 0.241 0 0.466 -0.141 0.57 -0.373 c 0.101 -0.226 0.153 -0.464 0.153 -0.714 C 32.699 21.15 30.523 18.81 27.697 18.81 L 27.697 18.81 Z M 27.697 18.81";break;case"script":r[1].pathData="M 22.453 15.04 c 0 0 -1.194 -3.741 2.548 -3.774 c 0 0 2.497 0.126 1.766 4.321 c -0.008 0.043 -0.015 0.086 -0.024 0.13 c -0.806 4.323 -2.516 8.42 -3.193 10.581 h 3.904 c 0 0 0.983 4.581 -2.549 4.968 H 13.292 c 0 0 -3.097 -1.42 -1.517 -5.323 l 3 -10.839 H 11.84 c 0 0 -1.129 -2.902 1.709 -3.806 l 11.425 -0.032 l -0.73 0.355 l -1.193 1.726 L 22.453 15.04 Z M 22.409 12.597 c 0 0 -0.242 0.483 -0.278 0.98 h -9.098 c 0 0 -0.06 -0.871 0.714 -1.041 L 22.409 12.597 Z M 26.341 27.734 c 0 0 -0.13 2.678 -2.226 1.871 c 0 0 -0.823 -0.565 -0.758 -1.855 L 26.341 27.734 Z M 22.905 15.008 c 0 0 0.653 -0.258 0.709 -1.501 c 0 0 0.145 -1.144 1.483 -0.693 c 0 0 0.808 0.355 0.259 2.404 c 0 0 -2.226 8.5 -3.032 10.339 c 0 0 -1.064 2.646 0.096 4.226 h -8.581 c 0 0 -1.806 -0.452 -0.741 -3.613 c 0 0 2.935 -9.549 3.193 -11.162 L 22.905 15.008 Z"}i.task.call&&(r[0].borderWidth=4);i.task.compensation&&i.task.loop!="none"&&(r[2].addInfo.margin.left-=r[2].width/2+2,r[3].addInfo.margin.left+=r[3].width/2+2)}else if(i.activity==t.datavisualization.Diagram.BPMNActivity.SubProcess){var v=0,h=0,f=2;i.subProcess.collapsed&&(r[4].visible=!0,r[4].pathData="M 8.13789 15 H 0 V 0 H 8.13789 V 15 Z M 0.625991 13.75 H 7.51189 V 1.25 H 0.625991 V 13.75 Z M 2.18095 7.03125 L 5.95631 7.03125 L 5.95631 7.46875 L 2.18095 7.46875 Z M 3.8342 3.73 L 4.30369 3.73 L 4.30369 11.2687 L 3.8342 11.2687 Z");switch(i.subProcess.boundary){case"default":r[0].borderWidth=1;r[0].borderDashArray="1 0";break;case"call":r[0].borderWidth=4;r[0].borderDashArray="1 0";break;case"event":r[0].borderWidth=1;r[0].borderDashArray="2 2"}if(i.subProcess.adhoc?(r[5].visible=!0,r[5].pathData="M 49.832 76.811 v -2.906 c 0 0 0.466 -1.469 1.931 -1.5 c 1.465 -0.031 2.331 1.219 2.897 1.688 s 1.06 0.75 1.526 0.75 c 0.466 0 1.548 -0.521 1.682 -1.208 s 0.083 3.083 0.083 3.083 s -0.76 0.969 -1.859 0.969 c -1.066 0 -1.865 -0.625 -2.464 -1.438 s -1.359 -0.998 -2.064 -0.906 C 50.598 75.467 49.832 76.811 49.832 76.811 Z"):i.subProcess.type=="event"?(r[0].borderWidth=1,r[0].borderDashArray="2 2",this._updateBPMNEventShape(i,r.slice(6,9),i.subProcess.event,i.subProcess.trigger)):i.subProcess.type=="transaction"&&(y={x:3,y:3,width:i.width-3,height:i.height-3},r[0].pathData+=t.datavisualization.Diagram.DefautShapes._updateRoundedRectanglePath(y,12)),e=i.activity=="task"?i.task.events:i.subProcess.events,e.length)for(c=9,u=0;u<e.length;u++){if(o=r.slice(c+u*3,c+3+u*3),!o.length){for(p=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.PointerEvents|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Resize),w={parent:i.name,type:"node",shape:"path",ports:[],labels:[],constraints:p,rotateAngle:i.rotateAngle,_isInternalShape:!0,opacity:i.opacity,visible:!1,addInfo:{offset:e[u].offset}},e[u]=n.extend(!0,{},t.datavisualization.Diagram.BPMNEventDefaults,e[u]),o=[{width:24,height:24},{width:20.4,height:20.4},{width:12,height:12}],s=0;s<o.length;s++)o[s]=t.datavisualization.Diagram.Node(n.extend(!0,{name:i.name+"_"+t.datavisualization.Diagram.Util.randomId()},w,o[s])),s==0&&(o[s].constraints=t.datavisualization.Diagram.NodeConstraints.Default&~t.datavisualization.Diagram.NodeConstraints.Resize,o[s].name=i.name+"_"+e[u].event+"_"+e[u].trigger);r=r.concat(o)}this._updateBPMNEventShape(i,o,e[u].event,e[u].trigger)}else r.splice(9,r.length-1);do r[f].visible&&(r[f].addInfo.margin.left=h+r[f].width/2,h+=r[f].width+2),f++;while(f<6);h-=2;f=2;v=h/2;do r[f].visible&&(r[f].addInfo.margin.left-=v),f++;while(f<6)}return r},_updateRoundedRectanglePath:function(n,t){for(var u="",i=0,r=[{x:n.x||0,y:n.y||0},{x:n.x||0,y:n.height},{x:n.width,y:n.height},{x:n.width,y:n.y||0}],f=[{x:t,y:t},{x:t,y:-t},{x:-t,y:-t},{x:-t,y:t}],i=0;i<r.length;i++)u+=u?"L":"M",u+=r[i].x+(i%2==0?f[i].x:0)+","+(r[i].y+(i%2!=0?f[i].y:0)),u+="C"+r[i].x+","+r[i].y+" "+r[i].x+","+r[i].y,u+=" "+(r[i].x+(i%2!=0?f[i].x:0))+","+(r[i].y+(i%2==0?f[i].y:0));return u+="L"+(r[0].x+f[0].x)+","+r[0].y,u+"Z"},initBPMNAnnotationShape:function(i,r){var u=[],e,l,o,f;if(i.annotation&&i.annotation.text){if(i=n.extend(!0,{},t.datavisualization.Diagram.BPMNTextAnnotationDefaults,i),i._annotation&&i._annotation.length)for(e=0;e<i._annotation.length;e++)r.nameTable[i._annotation[e]]&&u.push(r.nameTable[i._annotation[e]]);if(!u.length){var s=t.datavisualization.Diagram.PortVisibility.Hidden,a=[{offset:{x:0,y:.5},name:"left",visibility:s},{offset:{x:.5,y:0},name:"top",visibility:s},{offset:{x:1,y:.5},name:"right",visibility:s},{offset:{x:.5,y:1},name:"bottom",visibility:s}],h=i.name+"annotation_"+t.datavisualization.Diagram.Util.randomId(),c=i.name+"annotation_"+t.datavisualization.Diagram.Util.randomId(),v=t.datavisualization.Diagram.NodeConstraints.Default&~t.datavisualization.Diagram.NodeConstraints.Connect,y=t.datavisualization.Diagram.ConnectorConstraints.Default&~(t.datavisualization.Diagram.ConnectorConstraints.DragSourceEnd|t.datavisualization.Diagram.ConnectorConstraints.Drag);i._annotation&&i._annotation.length&&(h=i._annotation[0],c=i._annotation[1]);u.push({name:h,labels:[{text:i.annotation.text}],annotation:i.annotation,type:"bpmn",shape:"annotation",_type:"node",_shape:"path",ports:a,constraints:v,width:i.annotation.width,height:i.annotation.height,_preventStretch:!0});u.push({name:c,labels:[{readOnly:!0}],type:"connector",segments:[{type:"straight"}],targetDecorator:{shape:"none"},sourceNode:u[0].name,targetNode:i.name,constraints:y,annotation:i.annotation,_isAnnotationLine:!0});i._annotation=[u[0].name,u[1].name]}u[0].offsetX=i.offsetX+i.annotation.length*Math.cos(-i.annotation.angle*(Math.PI/180));u[0].offsetY=i.offsetY+i.annotation.length*Math.sin(-i.annotation.angle*(Math.PI/180));l=[{fillColor:"transparent",borderColor:i.borderColor,rotateAngle:i.rotateAngle,opacity:i.opacity,ports:[]},{lineColor:i.borderColor,opacity:i.opacity}];n.extend(!0,u,l);o=r.nameTable[u[0].name];f=r.nameTable[u[1].name];o||(o=r._getNewNode(u[0]),r.nameTable[o.name]=o);f||(f=r._getNewConnector(u[1]),r.nameTable[f.name]=f);this.updateBPMNAnnotationShape(f,null,i,r)}return i},renderBPMNAnnotationShape:function(n,i){var u,r,f,e;if(n._annotation&&n._annotation.length)for(u=0;u<n._annotation.length;u++)i.nameTable[n._annotation[u]]&&(r=i.nameTable[n._annotation[u]],f=i.getObjectType(r),f=="node"?t.datavisualization.Diagram.DiagramContext.renderNode(r,i):f=="connector"&&(e=i._disableSegmentChange,i._disableSegmentChange=!1,i._updateEdges(r),i._dock(r,i.nameTable),t.datavisualization.Diagram.DiagramContext.renderConnector(r,i),i._disableSegmentChange=e))},updateBPMNAnnotationShape:function(i,r,u,f){var a,l,v;if(f.getObjectType(i)=="connector"&&i._isAnnotationLine){r&&f.nameTable[r]&&(a=f.nameTable[r],n.extend(!0,a,t.datavisualization.Diagram.BPMNTextAnnotationDefaults),delete a._annotation);u||(u=f.nameTable[i.targetNode]);var e=f.nameTable[i.sourceNode],o=t.datavisualization.Diagram.Util.bounds(e),s=20,h=20,c;c=u?t.datavisualization.Diagram.Util.bounds(u):{x:i.targetPoint.x,y:i.targetPoint.y,width:i.lineWidth,height:i.lineWidth};l="";o.x<c.x+c.width&&o.x+o.width>c.x&&(o.y+o.height<c.y&&(l="bottom"),o.y>c.y+c.height&&(l="top"));l||(o.x>c.x+c.width&&(l="left"),o.x+o.width<c.x&&(l="right"));i.annotation.direction=l;e.labels[0].horizontalAlignment=e.labels[0].verticalAlignment=e.labels[0].textAlign="center";switch(i.annotation.direction){case"left":h=o.height;e.pathData="M"+s+","+h+" L0,"+h+" L0,0 L"+s+",0";e.labels[0].horizontalAlignment="left";e.labels[0].textAlign="left";e.labels[0].offset=t.datavisualization.Diagram.Point(.05,.5);break;case"right":h=o.height;s=o.width-20;e.pathData="M"+s+","+h+" L"+(s+20)+","+h+" L"+(s+20)+",0 L"+s+",0";e.labels[0].horizontalAlignment="right";e.labels[0].textAlign="right";e.labels[0].offset=t.datavisualization.Diagram.Point(.95,.5);break;case"top":s=o.width;e.pathData="M"+s+","+h+" L"+s+",0 L0,0 L0,"+h;e.labels[0].verticalAlignment="top";e.labels[0].offset=t.datavisualization.Diagram.Point(.5,0);break;case"bottom":h=o.height-20;s=o.width;e.pathData="M"+s+","+h+" L"+s+","+(h+20)+" L0,"+(h+20)+" L0,"+h;e.labels[0].verticalAlignment="bottom";e.labels[0].offset=t.datavisualization.Diagram.Point(.5,1)}i.sourcePort!=i.annotation.direction&&(v=f._disableSegmentChange,f._disableSegmentChange=!1,i.annotation.direction=i.sourcePort=l,f._updateEdges(i),f._dock(i,f.nameTable),f._disableSegmentChange=v);t.datavisualization.Diagram.DiagramContext.update(e,f)}},translateBPMNAnnotationShape:function(i,r,u,f,e){var l,s,y,p,w,v,b,k;if(i.annotation&&i.shape!="annotation"){if(l=[],i.annotation&&i.annotation.text&&(i=n.extend(!0,{},t.datavisualization.Diagram.BPMNTextAnnotationDefaults,i),i._annotation&&i._annotation.length)){for(s=0;s<i._annotation.length;s++)e.nameTable[i._annotation[s]]&&l.push(e.nameTable[i._annotation[s]]);if(y=r,p=u,f){var y=0,p=0,h=t.Matrix.identity();i.rotateAngle?(t.Matrix.rotate(h,-i.rotateAngle,f.x,f.y),t.Matrix.scale(h,r,u,f.x,f.y),t.Matrix.rotate(h,i.rotateAngle,f.x,f.y)):t.Matrix.scale(h,r,u,f.x,f.y);var o=t.datavisualization.Diagram.Util.bounds(i),d={bottom:{x:i.offsetX,y:o.y},left:{x:o.x+o.width,y:i.offsetY},top:{x:i.offsetX,y:o.y+o.height},right:{x:o.x,y:i.offsetY}},c=d[l[0].annotation.direction],a=t.Matrix.transform(h,c);a.x!=c.x&&(y=c.x-a.x);a.y!=c.y&&(p=c.y-a.y)}e._translate(l[0],y,p,e.nameTable)}}else if(i.annotation&&i.shape=="annotation"){for(v=0;v<i.outEdges.length;v++)if(b=e.nameTable[i.outEdges[v]],b._isAnnotationLine){w=b;break}w&&(k=i.targetNode?e.nameTable[i.targetNode]:null,this.updateBPMNAnnotationShape(w,null,k,e))}},updateAnnotationProperties:function(i,r){r.getObjectType(i)=="node"&&(i=r.nameTable[i.outEdges[0]]);var f=r.nameTable[i.targetNode],u=r.nameTable[i.sourceNode];f?(i.annotation.angle=t.datavisualization.Diagram.Util._findAngle({x:u.offsetX,y:u.offsetY},{x:f.offsetX,y:f.offsetY})*-1,i.annotation.length=t.datavisualization.Diagram.Util.findLength({x:f.offsetX,y:f.offsetY},{x:u.offsetX,y:u.offsetY}),u.annotation=f.annotation=n.extend(!0,{},i.annotation),f._annotation=[i.sourceNode,i.name],r.nodes().indexOf(u)>-1&&(t.datavisualization.Diagram.Util.removeItem(r.nodes(),u),t.datavisualization.Diagram.Util.removeItem(r.connectors(),i),r._nodes=n.extend(!0,[],r.nodes()))):(i.annotation.angle=t.datavisualization.Diagram.Util._findAngle({x:u.offsetX,y:u.offsetY},i.targetPoint)*-1,i.annotation.length=t.datavisualization.Diagram.Util.findLength(i.targetPoint,{x:u.offsetX,y:u.offsetY}),u.annotation=n.extend(!0,{},i.annotation),r.nodes().push(u),r.connectors().push(i),r._nodes=n.extend(!0,[],r.nodes()))},updateInlineDecoratorsShape:function(n,i){var r,f,u,e;return n.shape&&n.shape.type=="bpmn"&&n.shape.flow=="message"&&(n._inlineDecorators.length&&(f=n._inlineDecorators.filter(function(t){if(t.name==n.name+"_"+n.shape.message)return t}),f.length&&(r=f[0])),n._inlineDecorators=[],(n.shape.message=="initiatingmessage"||n.shape.message=="noninitiatingmessage")&&(u=t.datavisualization.Diagram.Util._findOffsetOnConnector(n,{segmentOffset:.5},.5,i),e=n.shape.message=="noninitiatingmessage"?"lightgrey":"white",r?(r.offsetX=u.offset.x,r.offsetY=u.offset.y,r.fillColor=e):r=t.datavisualization.Diagram.Node({name:n.name+"_"+n.shape.message,width:25,height:15,offsetX:u.offset.x,offsetY:u.offset.y,fillColor:e,shape:"path",pathData:"M0,0 L19.8,12.8 L40,0 L0, 0 L0, 25.5 L40, 25.5 L 40, 0",constraints:t.datavisualization.Diagram.NodeConstraints.Delete}),n._inlineDecorators.push(r))),n}}}(jQuery,Syncfusion),function(n,t){"use strict";var i=function(){function n(n){return this.xmlns="http://www.w3.org/2000/svg",this.document=document.createElementNS(this.xmlns,"svg"),this.id=n.id,n&&t.datavisualization.Diagram.Util.attr(this.document,n),this}return n.prototype.element=function(n,i){var r;return n&&n.id&&(r=this.document.getElementById(n.id)),r||(r=document.createElementNS(this.xmlns,i)),n&&t.datavisualization.Diagram.Util.attr(r,n),r},n.prototype.g=function(n){return this.element(n,"g")},n.prototype.defs=function(n){return this.element(n,"defs")},n.prototype.image=function(n){return this.element(n,"image")},n.prototype.path=function(n){return this.element(n,"path")},n.prototype.text=function(n){return this.element(n,"text")},n.prototype.textPath=function(n){return this.element(n,"textPath")},n.prototype.tspan=function(n){return this.element(n,"tspan")},n.prototype.rect=function(n){return this.element(n,"rect")},n.prototype.ellipse=function(n){return this.element(n,"ellipse")},n.prototype.circle=function(n){return this.element(n,"circle")},n.prototype.title=function(n){return this.element(n,"title")},n.prototype.line=function(n){return this.element(n,"line")},n.prototype.polyline=function(n){return this.element(n,"polyline")},n.prototype.polygon=function(n){return this.element(n,"polygon")},n.prototype.foreignObject=function(n){return this.element(n,"foreignObject")},n.prototype.linearGradient=function(n){return this.element(n,"linearGradient")},n.prototype.radialGradient=function(n){return this.element(n,"radialGradient")},n.prototype.stop=function(n){return this.element(n,"stop")},n.prototype.pattern=function(n){return this.element(n,"pattern")},n.prototype.appendChild=function(n){this.document.appendChild(n)},n.prototype.removeChild=function(n,t){t?t.removeChild(n):this.document.removeChild(n)},n.prototype.getElementById=function(n){return this.document.getElementById(n)},n.prototype.getElementsByClassName=function(n){return this.document.getElementsByClassName(n)},n.prototype.getElementsByTagName=function(n){return this.document.getElementsByTagName(n)},n.prototype.pathBounds=function(n){var f={d:n},r=this.path(f),i=new t.datavisualization.Diagram.Svg({id:"TempSvg"}),u;return document.body.appendChild(i.document),i.document.appendChild(r),u=r.getBBox(),document.body.removeChild(i.document),u},n.prototype.textBounds=function(n,t,i){var u=null,r;return n&&t?(r=this.text(t),r.appendChild(document.createTextNode(n)),this.document.appendChild(r),u=r.getBBox(),this.document.removeChild(r)):i&&(this.document.appendChild(i),u=i.getBBox(),this.document.removeChild(i)),u},n.prototype.absolutePath=function(n){for(var i,s,f,v,y,h,c,l,a,e=t.datavisualization.Diagram.Util.convertPathToArray(n.getAttribute("d")),r=0,u=0,o=0,p=e.length;o<p;++o){if(i=e[o],s=i.pathSegTypeAsLetter,/[MLHVCSQTA]/.test(s))"x"in i&&(r=i.x),"y"in i&&(u=i.y);else{"x1"in i&&(h=r+i.x1);"x2"in i&&(l=r+i.x2);"y1"in i&&(c=u+i.y1);"y2"in i&&(a=u+i.y2);"x"in i&&(r+=i.x);"y"in i&&(u+=i.y);switch(s){case"m":f={pathSegTypeAsLetter:"M",x:r,y:u};break;case"l":f={pathSegTypeAsLetter:"L",x:r,y:u};break;case"h":f={pathSegTypeAsLetter:"H",x:r};break;case"v":f={pathSegTypeAsLetter:"V",y:u};break;case"c":f={pathSegTypeAsLetter:"C",x:r,y:u,x1:h,y1:c,x2:l,y2:a};break;case"s":f={pathSegTypeAsLetter:"S",x:r,y:u,x2:l,y2:a};break;case"q":f={pathSegTypeAsLetter:"Q",x:r,y:u,x1:h,y1:c};break;case"t":f={pathSegTypeAsLetter:"T",x:r,y:u};break;case"a":f={pathSegTypeAsLetter:"A",x:r,y:u,r1:i.r1,r2:i.r2,angle:i.angle,largeArcFlag:i.largeArcFlag,sweepFlag:i.sweepFlag};break;case"z":case"Z":r=v;u=y;f=e[o]}f&&(e[o]=f)}(s==="M"||s==="m")&&(v=r,y=u)}return n.setAttribute("d",t.datavisualization.Diagram.Util.pathSegArrayAsString(e)),n},n}();t.datavisualization.Diagram.Svg=i;t.datavisualization.Diagram.SvgContext={_renderDocument:function(n,i,r){var f,u;window.SVGSVGElement&&(f={id:n.canvas.id+"_svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:"position:absolute","class":"mainview_svg",role:"img"},t.isMobile()&&(f.style="position: inherit"),u=r?i._svg:new t.datavisualization.Diagram.Svg(f),n.svg=u,i&&(i._svg=u,r||document.getElementById(u.document.id)||n.canvas.appendChild(u.document),i._view=this._renderView(n.canvas,n.svg,r),i._page=this._renderPage(n.canvas,n.svg,i._view,r),this._renderBackground(i,n.canvas,n.svg,i._page,i.model,r),i._pageBackgroundLayer=this._renderBackgroundLayer(n.canvas,n.svg,i._page,r),this._renderGrid(n.canvas,n.svg,i._page,i),i._diagramLayer=n.diagramLayer=this._renderDiagramLayer(n.canvas,n.svg,i._page),i._htmlLayer=this._renderHtmlLayer(n.canvas,r),this._renderAdornerLayer(i,n.canvas,r,n)))},_renderView:function(n,t,i){var r=t.document.getElementById(n.id+"_view"),u;return r||(u={id:n.id+"_view"},r=t.g(u)),i||t.appendChild(r),r},_renderHtmlLayer:function(n,i){var r=document.getElementById(n.id+"_htmlLayer"),f,u;return r||(r=document.createElement("div")),f={id:n.id+"_htmlLayer","class":"htmlLayer"},t.datavisualization.Diagram.Util.attr(r,f),u=r,r.style.pointerEvents="none",i||n.appendChild(u),u},_renderAdornerLayer:function(n,i,r,u){var f=document.getElementById(i.id+"_adorner"),e;f||(f=document.createElement("div"));e={id:i.id+"_adorner","class":"adornerLayer",style:"position:absolute;left:0px;top:0px"};t.datavisualization.Diagram.Util.attr(f,e);n._adornerLayer=this._renderAdornerSvg(n,i,f,r,u);n._tooltipLayer=this._renderTooltipLayer(i,f,r);r||i.appendChild(f)},_renderTooltipLayer:function(n,i,r){var u=document.getElementById(n.id+"_tooltip"),e,f;return u||(u=document.createElement("div")),e={id:n.id+"_tooltip","class":"diagram_tooltip"},t.datavisualization.Diagram.Util.attr(u,e),f=u,u.style.pointerEvents="none",r||i.appendChild(f),f},_renderPage:function(n,t,i,r){var u=t.document.getElementById(n.id+"_page"),f;return u||(f={id:n.id+"_page","class":"page"},u=t.g(f)),r||i.appendChild(u),u},_renderDiagramLayer:function(n,t,i){var r=t.document.getElementById(n.id+"_diagramLayer"),u;return r||(u={id:n.id+"_diagramLayer","class":"DiagramLayer"},r=t.g(u),i.appendChild(r)),r},_renderAdornerSvg:function(n,i,r,u,f){var e,s,h,o;if(window.SVGSVGElement)return o={id:i.id+"_svg_adorner",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:"position:absolute",fill:"none","pointer-events":"none"},e=u?n._adornerSvg:new t.datavisualization.Diagram.Svg(o),u||document.getElementById(e.document.id)||r.appendChild(e.document),s=e.document.getElementById(i.id+"_expander"),s||(o={id:i.id+"_expander","class":"ExpanderLayer","pointer-events":"all"},s=e.g(o),e.document.appendChild(s)),f._expander=n._expander=s,h=e.document.getElementById(i.id+"_adornerLayer"),h||(o={id:i.id+"_adornerLayer","class":"AdornerLayer","pointer-events":"none"},h=e.g(o),e.document.appendChild(h)),n._adornerSvg=e,h},_renderBackgroundLayer:function(n,t,i,r){var u=t.document.getElementById(n.id+"_pageBackground"),f;return u||(f={id:n.id+"_pageBackground","class":"PageBackgroundLayer",style:"pointer-events:none;"},u=t.g(f)),r||i.appendChild(u),u},_renderBackground:function(n,i,r,u){var c,l,s;r.document.style.msTouchAction="none";r.document.style.display="block";r.document.style.backgroundColor="white";var h={id:i.id+"_backgroundLayer"},f=r.g(h),e=n._getDigramBounds();if(n._backgroundImage()){var o=n._backgroundImage(),a=t.datavisualization.Diagram.Util._getImageAlignment(o.alignment),v="none "+a!="none"&&o.scale!="none"?a+" "+o.scale:"none";h={id:i.id+"_backgroundImage",x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:v,"pointer-events":"none"};c=r.image(h);c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o.source);r.getElementById(i.id+"_backgroundImage")||f.appendChild(c)}l=n._backgroundColor();s=r.rect({id:i.id+"_backgroundColor",width:"100%",height:"100%",fill:l,preserveAspectRatio:"none","pointer-events":"none"});l?r.getElementById(i.id+"_backgroundColor")||f.appendChild(s):r.getElementById(s.id)&&f.removeChild(r.getElementById(s.id));r.getElementById(f.id)||u.appendChild(f)},_renderGrid:function(n,i,r,u){var h=u._svg.document.getElementById(n.id+"patterndefinition"),o,c,l,a,e,f,v,s;if(h||(h=i.defs({id:n.id+"patterndefinition"}),i.appendChild(h)),u._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines||u._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.ShowVerticalLines){var s=document.getElementById(n.id+"_grid"),v=document.getElementById(n.id+"pattern_gridline"),f=document.getElementById(n.id+"pattern_grid");f&&f.parentNode&&f.parentNode.removeChild(f);c={id:n.id+"_grid","pointer-events":"none"};o=i.g(c);l=0;u.model.snapSettings.horizontalGridLines.linesInterval&&u.model.snapSettings.horizontalGridLines.linesInterval.forEach(function(n){l+=n});a=0;u.model.snapSettings.verticalGridLines.linesInterval&&u.model.snapSettings.verticalGridLines.linesInterval.forEach(function(n){a+=n});e=this._scaleSnapInterval(u.model,u._currZoom);c={id:n.id+"pattern_grid",x:0,y:0,width:a*e,height:l*e,patternUnits:"userSpaceOnUse"};f=i.pattern(c);e=this._scaleSnapInterval(u.model,e);this._renderHorizontalGridlines(e,f,a,u,i);this._renderVerticalGridlines(e,f,l,u,i);h.appendChild(f);v=i.rect({id:n.id+"pattern_gridline",x:u._hScrollOffset,y:u._vScrollOffset,width:"100%",height:"100%",fill:"url(#"+n.id+"pattern_grid)"});o.appendChild(v);s||(u._diagramLayer?r.insertBefore(o,u._diagramLayer):r.appendChild(o))}else o=document.getElementById(n.id+"_grid"),o&&(s=document.getElementById(n.id+"pattern_gridline"),s&&s.parentNode&&s.parentNode.removeChild(s))},_updateBackground:function(n,i,r,u){var s={x:n,y:i},o=document.getElementById(u._id+"_canvas_backgroundColor"),e,f;o&&t.datavisualization.Diagram.Util.attr(o,s);e=document.getElementById(u._id+"_canvas_backgroundImage");f=u._getDigramBounds();e&&t.datavisualization.Diagram.Util.attr(e,{transform:"scale("+r+")",x:f.x,y:f.y,width:f.width,height:f.height})},_updateGrid:function(n,i,r,u){var l=document.getElementById(u._canvas.id+"pattern_gridline"),f,e,o,s,a,c,h;if(l){if(e=document.getElementById(u._canvas.id+"pattern_grid"),o=0,u.model.snapSettings.horizontalGridLines.linesInterval)for(f=0;f<u.model.snapSettings.horizontalGridLines.linesInterval.length;f++)o+=u.model.snapSettings.horizontalGridLines.linesInterval[f];if(s=0,u.model.snapSettings.verticalGridLines.linesInterval)for(f=0;f<u.model.snapSettings.verticalGridLines.linesInterval.length;f++)s+=u.model.snapSettings.verticalGridLines.linesInterval[f];h={x:n,y:i};t.datavisualization.Diagram.Util.attr(l,h);r=this._scaleSnapInterval(u.model,r);a=u._svg;c=a.defs({id:u._canvas.id+"patterndefinition"});e&&c.removeChild(e);h={id:u._canvas.id+"pattern_grid",x:0,y:0,width:s*r,height:o*r,patternUnits:"userSpaceOnUse"};e=u._svg.pattern(h);this._renderHorizontalGridlines(r,e,s,u,u._svg);this._renderVerticalGridlines(r,e,o,u,u._svg);c.appendChild(e)}},_scaleSnapInterval:function(n,t){if(t>=2)while(t>=2)t/=2;else if(t<=.5)while(t<=.5)t*=2;var i;if(t!==1){for(n.snapSettings.horizontalGridLines._snapinterval=[],i=0;i<n.snapSettings.horizontalGridLines.snapInterval.length;i++)n.snapSettings.horizontalGridLines._snapinterval[i]=n.snapSettings.horizontalGridLines.snapInterval[i]*t;for(n.snapSettings.verticalGridLines._snapinterval=[],i=0;i<n.snapSettings.verticalGridLines.snapInterval.length;i++)n.snapSettings.verticalGridLines._snapinterval[i]=n.snapSettings.verticalGridLines.snapInterval[i]*t}return t},_renderHorizontalGridlines:function(n,i,r,u,f){var a=u.model,o=a.snapSettings,s,c,e,h,l;if(u._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.ShowHorizontalLines)for(s=0,c=0,e=0;e<o.horizontalGridLines.linesInterval.length;e=e+2)h=o.horizontalGridLines.linesInterval[e],l=f.line({x1:0,y1:s*n,x2:r*n,y2:s*n,stroke:o.horizontalGridLines.lineColor,"stroke-width":h,"stroke-dasharray":o.horizontalGridLines.lineDashArray}),s+=o.horizontalGridLines.linesInterval[e+1]+h,i.appendChild(l),c++},_renderVerticalGridlines:function(n,i,r,u,f){var c=u.model,o=c.snapSettings,s,l,e,h,a;if(o.snapConstraints&t.datavisualization.Diagram.SnapConstraints.ShowVerticalLines)for(s=0,l=0,e=0;e<o.verticalGridLines.linesInterval.length;e=e+2)h=c.snapSettings.verticalGridLines.linesInterval[e],a=f.line({x1:s*n,y1:0,x2:s*n,y2:r*n,stroke:o.verticalGridLines.lineColor,"stroke-width":h,"stroke-dasharray":o.verticalGridLines.lineDashArray}),s+=o.verticalGridLines.linesInterval[e+1]+h,i.appendChild(a),l++},transformView:function(n,i,r){var f=n._view,u={transform:"translate("+i+","+r+")"};t.datavisualization.Diagram.Util.attr(f,u);t.datavisualization.Diagram.Util.attr(n._adornerLayer,u);t.datavisualization.Diagram.Util.attr(n._expander,{transform:"translate("+i+","+r+"),scale("+n.model.scrollSettings.currentZoom+")"});n._htmlLayer&&(n._htmlLayer.style.left=i+"px",n._htmlLayer.style.top=r+"px",n._htmlLayer.style.position="absolute")},scaleContent:function(n,i){var u=n._diagramLayer,r;t.datavisualization.Diagram.Util.attr(u,{transform:"scale("+i+")"});t.datavisualization.Diagram.Util.attr(n._expander,{transform:"translate("+-n.model.scrollSettings.horizontalOffset+","+-n.model.scrollSettings.verticalOffset+"),scale("+i+")"});n._htmlLayer&&(n._htmlLayer.style.webkitTransform="scale("+i+")",n._htmlLayer.style.MozTransform="scale("+i+")",n._htmlLayer.style.OTransform="scale("+i+")",n._htmlLayer.style.msTransform="scale("+i+")",n._htmlLayer.style.transform="scale("+i+")");n.selectionList.length>0&&this.updateSelector(n.selectionList[0],n._adornerSvg,i,n,n.model.selectedItems.constraints);n.selectionList[0]&&n.model.selectedItems.userHandles&&n.model.selectedItems.userHandles.length>0&&(r=!1,n.selectionList[0].type=="pseudoGroup"&&(r=!0),n.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&t.datavisualization.Diagram.SvgContext.updateUserHandles(n.model.selectedItems.userHandles,n.selectionList[0],n._adornerSvg,r,!1,i,n))},setSize:function(n,i,r){t.datavisualization.Diagram.Util.attr(n._svg.document,{width:i+"px",height:r+"px"});t.datavisualization.Diagram.Util.attr(n._adornerSvg.document,{width:i+"px",height:r+"px"})},_findIndex:function(t,i){var r,f=1,e,u;return u=i.parent?n("#"+i.parent.name).find(">.node,>.connector,>.group"):n("#DiagramContent_canvas_svg").find(">.node,>.connector,>.group"),i.name!="helper"&&(r=u[u.length-1],r&&r.id=="helper"&&(r=u[u.length-2]),r&&(e=0,r.className.animVal=="ej-d-node"||r.className.animVal=="ej-d-group"?f=e+1:r.className.animVal=="ej-d-connector"&&(f=e+1))),f},renderNode:function(n,i,r,u,f){var e,v=n.width?n.width:n._width||0,y=n.height?n.height:n._height||0,p=n.name,s=0,h=0,c=0,l=0,a=0,w=n.visible?"visible":"hidden",o;return u||(c=n.offsetX-v*n.pivot.x,l=n.offsetY-y*n.pivot.y,s=n.offsetX,h=n.offsetY,a=n.rotateAngle),o={id:p,"class":"ej-d-node",transform:"rotate("+a+","+s+","+h+"),translate("+c+","+l+")",visibility:w},t.datavisualization.Diagram.Util.canEnablePointerEvents(n,f)||(o.style="pointer-events:none"),n._isClassifier&&(o["class"]+=" ej-d-classifier"),e=i.g(o),r?r.appendChild(e):i.appendChild(e),n._isDisabled&&t.datavisualization.Diagram.Util.attr(e,{style:"pointer-events:none;"}),this._renderNode(n,i,e,f,u),n&&n.annotation&&t.datavisualization.Diagram.DefautShapes.renderBPMNAnnotationShape(n,f),n._isClassifier&&delete n._isClassifier,e},_renderNode:function(n,t,i,r,u){this._renderShape(n,t,i,r);this._renderLabels(n,t,r,u);this._renderPorts(n,t,i);n.outEdges.length>0&&this._renderIcons(n,r)},_renderShadow:function(n,i){var u,f,r,e,o,s;n.segments||(u=i.document.getElementById(n.name),n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(f=n.fillColor,n.type==="image"||n.type==="text"||n.type==="html"?r=i.document.getElementById(n.name+"_backRect"):n.type!="text"&&n.type!="image"&&(r=i.document.getElementById(n.name+"_shape")),r&&(e=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),o={id:n.name+"_shadow",width:n.width,height:n.height,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:f!="none"||f!="transparent"?"lightgrey":"none",transform:"translate("+e.x+","+e.y+")",opacity:n.shadow.opacity,"stroke-dasharray":""},n.type==="native"||n.type==="html"?u.insertBefore(i.rect(o),r):(s=r.cloneNode(!0),u.insertBefore(s,r),t.datavisualization.Diagram.Util.attr(s,o)))))},_updateShadow:function(n,i){var f=i.document.getElementById(n.name),r=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),u={id:n.name+"_shadow",transform:"translate("+r.x+","+r.y+")",opacity:n.shadow.opacity};i.g(u)},_removeShadow:function(n,t){if(n.type!="text"){var r=t.document.getElementById(n.name),i=t.document.getElementById(n.name+"_shadow");i&&r.removeChild(i)}},_renderphase:function(n,i,r,u,f){var o,p,s,v,y;o=i.g({id:n.name+"_phase_g","class":"ej-d-seperator"});n.parent?r.appendChild(o):i.appendChild(o);var w="visible",c=0,l=0;if(f){p=u._getChildren(f.children);p.length>1&&(s=u.nameTable[p[0]]);var e=t.datavisualization.Diagram.Util.bounds(f),h=[],a,b=e.top+50,k=e.left+50;n.orientation=="vertical"?(h.push({x:0,y:0}),h.push({x:e.width,y:0}),a=this._convertToSVGPoints(h),c=e.x,l=e.y+n.offset+s.height,s&&(b+=s.height),l<e.bottom&&l>b||(w="hidden")):(h.push({x:0,y:s.height?s.height:0}),h.push({x:0,y:e.height}),a=this._convertToSVGPoints(h),c=e.x+n.offset,l=e.y,c<e.right&&c>k||(w="hidden"));v={id:n.name+"_phase",stroke:n.lineColor,"stroke-width":n.lineWidth,"stroke-dasharray":n.lineDashArray,points:a};y=i.polyline(v);o.appendChild(y);v={id:n.name+"_phase_hitTest","class":"hitTest","stroke-width":10,points:a,stroke:"transparent"};y=i.polyline(v);o.appendChild(y);o.setAttribute("transform","translate("+c+","+l+")")}},renderphase:function(n,t,i,r,u){var f,e;r._views.forEach(function(t){f=r._views[t];e=f.svg||f._canvas;i&&(i=e.document.getElementById(i.id));f.context._renderphase(n,e,i||f.diagramLayer,r,u)})},_renderGroupBackground:function(n,i,r){if(n.fillColor!="none"){var f=n.offsetX-n.width*n.pivot.x,e=n.offsetY-n.height*n.pivot.y,o=n.fillColor,s=n.borderColor;(n.type=="bpmn"||n.classifier&&n.classifier=="package")&&(o="transparent",s="transparent");var c=n.rotateAngle,h=new t.datavisualization.Diagram.Point(f+n.width*n.pivot.x,e+n.height*n.pivot.y),u={id:n.name+"_shape",rx:n.cornerRadius,ry:n.cornerRadius,width:Math.round(n.width<0?0:n.width),height:Math.round(n.height<0?0:n.height),fill:o,stroke:s,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,transform:"rotate("+c+","+h.x+","+h.y+"),translate("+f+","+e+")"};(n.type=="umlclassifier"||n._isClassifier)&&(u["class"]="ej-d-group ej-d-classifier");n.gradient&&n.type!="bpmn"&&(u.fill=this._renderGradient(n.name,n.gradient,r));this._addCssClass(n,u);i.appendChild(r.rect(u))}},renderGroup:function(n,i,r,u,f,e,o){var h,b=n.visible?"visible":"hidden",y={id:n.name,"class":"ej-d-group",visibility:b},c,a,w,s,l,p,r,v;if(t.datavisualization.Diagram.Util.canEnablePointerEvents(n,f)||(y.style="pointer-events:none"),(n.type=="umlclassifier"||n._isClassifier)&&(y["class"]+=" ej-d-classifier"),h=i.g(y),r?r.appendChild(h):i.appendChild(h),n.parent==""&&n.container&&(e&&(n.height=0,n.width=0),o||f._updateChildAdjacentConnectors(n)),this._renderGroupBackground(n,h,i),n.isSwimlane&&(f._disableSwimlaneUptate=!0),c=n.children,c&&c.length>0)for(a=0,w=c.length;a<w;a++)s=u[t.datavisualization.Diagram.Util.getChild(c[a])],s&&(s._type==="group"?(n.type=="umlclassifier"&&(s._isClassifier=!0),this.renderGroup(s,i,h,u,f,e,o),t.datavisualization.Diagram.Util._updateGroupBounds(s,f,!0),t.datavisualization.Diagram.DiagramContext.update(s,f)):s.segments?(t.datavisualization.Diagram.Util.updateBridging(s,f),this.renderConnector(s,i,h,f)):(n.type=="umlclassifier"&&(s._isClassifier=!0),this.renderNode(s,i,h,undefined,f)));return this._renderLabels(n,i,f),this._renderPorts(n,i,h),n.isSwimlane&&delete f._disableSwimlaneUptate,n&&n.annotation&&t.datavisualization.Diagram.DefautShapes.renderBPMNAnnotationShape(n,f),n&&n.isSwimlane&&(v=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(f,n),f._views.forEach(function(t){var i,u;for(l=f._views[t],p=l.svg||l._canvas,r&&(r=p.document.getElementById(r.id)),i=0;v&&i<v.length;i++)u=f.nameTable[v[i]],u&&l.context._renderphase(u,p,r||l.diagramLayer,f,n)})),n._isClassifier&&delete n._isClassifier,h},_renderGradient:function(n,t,i){var u,r;return t.type==="linear"?(r=this._renderLinearGradient(n,t,i),u="url(#"+r+")"):t.type==="radial"&&(r=this._renderRadialGradient(n,t,i),u="url(#"+r+")"),u},_checkGradientTag:function(n,t,i){if(t.getElementById(n+"_gradient")){var r=t.getElementById(n+"_gradient");(i&&r.localName==="radialGradient"||!i&&r.localName==="linearGradient")&&r.parentNode.removeChild(r)}},_renderLinearGradient:function(n,t,i){var u=i.document.getElementById(i.document.parentNode.id+"patterndefinition")||i.document.getElementById(n+"patterndefinition"),f,r;return u?(this._checkGradientTag(n,i,!0),f={id:n+"_gradient",x1:t.x1+"%",y1:t.y1+"%",x2:t.x2+"%",y2:t.y2+"%"},r=i.linearGradient(f),this._renderStops(t,i,r),u.appendChild(r),r.id):null},_renderRadialGradient:function(n,t,i){var u=i.document.getElementById(i.document.parentNode.id+"patterndefinition")||i.document.getElementById(n+"patterndefinition"),f,r;return u?(this._checkGradientTag(n,i,!1),f={id:n+"_gradient",cx:t.cx+"%",cy:t.cy+"%",fx:t.fx+"%",fy:t.fy+"%",r:t.r+"%"},r=i.radialGradient(f),this._renderStops(t,i,r),u.appendChild(r),r.id):null},_renderStops:function(n,t,i){var f,r,u,e;if(t.getElementById(i.getAttribute("id"))===i)while(i.firstChild)i.removeChild(i.firstChild);for(f=n.stops,u=0,e=f.length;u<e;u++)r=f[u],i.appendChild(t.stop({offset:r.offset+"%","stop-color":r.color,"stop-opacity":r.opacity}))},_renderShape:function(n,t,i,r){var u=n._shape?n._shape:n.type;switch(u){case"rectangle":this._renderRect(n,t,i);break;case"ellipse":this._renderEllipse(n,t,i);break;case"image":this._renderImage(n,t,i);break;case"path":this._renderPath(n,t,i);break;case"polygon":this._renderPolygon(n,t,i);break;case"text":this._renderTextElement(n,t,i);break;case"html":this._renderHtmlElement(n,t,i,r);break;case"native":this._rendercontent(n,t,i,r)}},_renderHTMLTemplate:function(t,i){if(t.templateId&&n.templates)return i._renderEjTemplate("#"+t.templateId,t)},_renderSvgTemplate:function(n,t,i,r){var e=document.createElement("div"),u,o,f;e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+r+"<\/g><\/svg>";document.body.appendChild(e);u=document.getElementById("tempNative").cloneNode(!0);u.id=n.name+"_shape";i.appendChild(u);o={id:n.name+"_shape",fill:n.fillColor,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray};this._addCssClass(n,o);n.gradient&&(o.fill=this._renderGradient(n.name,n.gradient,t));t.g(o);f=this._scaleNodeContent(n,u);f&&u.setAttribute("transform","translate("+f.x+","+f.y+"),scale("+f.sx+","+f.sy+")");u.setAttribute("id",n.name+"_shape");e.parentNode.removeChild(e)},_scaleNodeContent:function(n,t){var u,f,i,r;if(n.scale!="none"){t&&(i=n.type=="html"?t.getBoundingClientRect():t.getBBox());n.type=="html"&&(i.x=i.left,i.y=i.top);u=n.width?n.width:n._width;f=n.height?n.height:n._height;t||(i={x:n.offsetX-n.width*n.pivot.x,y:n.offsetY-n.height*n.pivot.y,width:u,height:f});var s=i.width?u/i.width:1,h=i.height?f/i.height:1,e=0,o=0;return n.scale!="stretch"&&n.contentAlignment!="none"?(r=n.scale=="meet"?Math.min(s,h):Math.max(s,h),n.contentAlignment.indexOf("xmid")>-1?e=u/2-i.width*r/2:n.contentAlignment.indexOf("xmax")>-1&&(e=i.x+u-i.width*r),n.contentAlignment.indexOf("ymid")>-1?o=i.y+f/2-i.height*r/2:n.contentAlignment.indexOf("ymax")>-1&&(o=i.y+f-i.height*r),{x:e,y:o,sx:r,sy:r}):{x:e,y:o,sx:s,sy:h}}return null},_rendercontent:function(i,r,u,f){var s,h,c;if(i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow){var e=i.fillColor,o=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},i.shadow.angle,i.shadow.distance),l={id:i.name+"_shadow",width:i.width,height:i.height,stroke:i.borderColor!="none"||i.borderColor!="transparent"?"lightgrey":"none",fill:e!="none"||e!="transparent"?"lightgrey":"none",transform:"translate("+o.x+","+o.y+")",opacity:i.shadow.opacity};u.appendChild(r.rect(l))}!i.segments&&i.templateId&&n.templates&&(s=i.width,h=i.height,i._type!=="node"||i.height||i.width||(i.width=i._width,i.height=i._height),c=f._renderEjTemplate("#"+i.templateId,i),i.width=s,i.height=h,this._renderSvgTemplate(i,r,u,c))},_fill:function(n,t){var i;return n.gradient&&(i=this._renderGradient(n.name,n.gradient,t)),i||(i=n.fillColor),i},_addCssClass:function(n,t){return n.cssClass&&t&&(t["class"]=t["class"]?t["class"]+" "+n.cssClass:n.cssClass),n._cssClass=n.cssClass,t},_updateCssClass:function(n,t){if((n._cssClass!=""||n._cssClass===""&&n.cssClass!=="")&&n._cssClass!==undefined&&n.cssClass!=n._cssClass){var i=t["class"];return i&&(t["class"]=i.replace(n._cssClass,"").trim()),this._addCssClass(n,t)}return t},_renderRect:function(n,i,r){var u=this._fill(n,i),h=n.width?n.width:n._width,c=n.height?n.height:n._height,f={id:n.name+"_shape",rx:n.cornerRadius,ry:n.cornerRadius,role:"presentation",width:h,height:c,fill:u,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray},o,e,s;n._isClassifier&&(o="ej-d-node ej-d-classifier");f["class"]=o;this._addCssClass(n,f);n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(e=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),s={id:n.name+"_shadow",rx:n.cornerRadius,ry:n.cornerRadius,width:n.width,height:n.height,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+e.x+","+e.y+")",opacity:n.shadow.opacity},r.appendChild(i.rect(s)));r.appendChild(i.rect(f))},_renderEllipse:function(n,i,r){var e=n.width?n.width:n._width,o=n.height?n.height:n._height,u=this._fill(n,i),s={id:n.name+"_shape",rx:e/2,ry:o/2,role:"presentation",cx:e/2,cy:o/2,fill:u,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray},f,h;this._addCssClass(n,s);n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(f=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),h={id:n.name+"_shadow",rx:n.width/2,ry:n.height/2,cx:n.width/2,cy:n.height/2,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+f.x+","+f.y+")",opacity:n.shadow.opacity},r.appendChild(i.ellipse(h)));r.appendChild(i.ellipse(s))},_renderImage:function(n,i,r){var l=n.fillColor,a=this._renderBackgroundRect(n,i,r),o=n.width?n.width:n._width,s=n.height?n.height:n._height,h=t.datavisualization.Diagram.Util._getImageAlignment(n.contentAlignment),c=n.scale=="none"?"meet":n.scale,f={id:n.name+"_shape",opacity:n.opacity,preserveAspectRatio:c!="stretch"&&h!="none"?h+" "+c:"none",width:o,height:s,role:"img"},u=new Image,e;u.src=n.source;n.scale=="none"&&(f.width=u.width||o,f.height=u.height||s);e=i.image(f);e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u.src);r.appendChild(e)},_renderPolygon:function(n,i,r){var u=this._fill(n,i),f,e,o,s;t.datavisualization.Diagram.Geometry.updatePolygonPoints(n);f=this._convertToSVGPoints(n.points);e={id:n.name+"_shape",fill:u,stroke:n.borderColor,role:"presentation","stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,points:f};this._addCssClass(n,e);n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(o=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),s={id:n.name+"_shadow",points:f,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+o.x+","+o.y+")",opacity:n.shadow.opacity},r.appendChild(i.polygon(s)));r.appendChild(i.polygon(e))},_renderPath:function(n,i,r){var e=this._fill(n,i),s=n.width?n.width:n._width,h=n.height?n.height:n._height,u,f,o,c;n._absolutePath=n._preventStretch?u=n.pathData:u=t.datavisualization.Diagram.Geometry.updatePath(0,0,s,h,n.pathData,i,null,n);f={id:n.name+"_shape",width:s,height:h,d:u,opacity:n.opacity,role:"presentation","stroke-dasharray":n.borderDashArray,stroke:n.borderColor,"stroke-width":n.borderWidth,fill:e};n._isClassifier&&(f["class"]="ej-d-node ej-d-classifier");this._addCssClass(n,f);n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(o=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),c={id:n.name+"_shadow",width:n.width,height:n.height,d:u,stroke:n.borderColor!="none"||n.borderColor!="transparent"?"lightgrey":"none",fill:e!="none"||e!="transparent"?"lightgrey":"none",transform:"translate("+o.x+","+o.y+")",opacity:n.shadow.opacity},r.appendChild(i.path(c)));r.appendChild(i.path(f))},_renderHtmlElement:function(n,i,r,u){var b=this._renderBackgroundRect(n,i,r),f,o,s,a,e,v,y,h;if(!n.segments&&n.templateId){var c=n.width?n.width:n._width,l=n.height?n.height:n._height,p=n.offsetX-c*n.pivot.x,w=n.offsetY-l*n.pivot.y,f=i.document.getElementById(n.name+"_html");f||(f=document.createElement("div"));o="width:"+c+"px;height:"+l+"px;padding:1px; left:"+p+"px; top:"+w+"px;position:absolute;";o+="display: block; border:0px; pointer-events: all; opacity:"+n.opacity+";";s={id:n.name+"_html","class":"foreignObject",style:o};this._addCssClass(n,s);t.datavisualization.Diagram.Util.attr(f,s);!n.segments&&n.templateId&&(a=this._renderHTMLTemplate(n,u),f.innerHTML=a);e=document.createElement("div");v={id:n.name+"_parentdiv","class":"ej-d-node"};t.datavisualization.Diagram.Util.attr(e,v);e.appendChild(f);y=n.visible?"visible":"hidden";e.style.visibility=y;h=i.document.parentNode.getElementsByClassName("htmlLayer")[0];h?h.appendChild(e):i.document.parentNode.appendChild(f)}},_initializeGuidelines:function(n,t,i){var r=n.g(t);return i.appendChild(r),r},_renderSideAlignmentLines:function(n,t,i,r,u){var f=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":1});i.appendChild(f)},_renderCenterAlignmentLines:function(n,t,i,r,u){var f=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":1});i.appendChild(f)},_renderSpacingLines:function(n,t,i,r,u){var e,o,f,s;i&&(f=r.g({}),n.x==t.x?(e="M"+(n.x*u-5)+" "+(n.y*u+5)+" L"+n.x*u+" "+n.y*u+" L"+(n.x*u+5)+" "+(n.y*u+5)+"z",o="M"+(t.x*u-5)+" "+(t.y*u-5)+" L"+t.x*u+" "+t.y*u+" L"+(t.x*u+5)+" "+(t.y*u-5)+"z",f.appendChild(r.line({x1:n.x*u-8,x2:n.x*u+8,y1:n.y*u-1,y2:n.y*u-1,stroke:"#07EDE1","stroke-width":1})),f.appendChild(r.line({x1:t.x*u-8,x2:t.x*u+8,y1:t.y*u+1,y2:t.y*u+1,stroke:"#07EDE1","stroke-width":1}))):(e="M"+(n.x*u+5)+" "+(n.y*u+5)+" L"+n.x*u+" "+n.y*u+" L"+(n.x*u+5)+" "+(n.y*u-5)+"z",o="M"+(t.x*u-5)+" "+(t.y*u-5)+" L"+t.x*u+" "+t.y*u+" L"+(t.x*u-5)+" "+(t.y*u+5)+"z",f.appendChild(r.line({x1:n.x*u-1,x2:n.x*u-1,y1:n.y*u-8,y2:n.y*u+8,stroke:"#07EDE1","stroke-width":1})),f.appendChild(r.line({x1:t.x*u+1,x2:t.x*u+1,y1:t.y*u-8,y2:t.y*u+8,stroke:"#07EDE1","stroke-width":1}))),f.appendChild(r.path({d:e,fill:"#07EDE1"})),s=r.line({x1:n.x*u,y1:n.y*u,x2:t.x*u,y2:t.y*u,stroke:"#07EDE1","stroke-width":.6,fill:"#07EDE1"}),f.appendChild(s),f.appendChild(r.path({d:o,fill:"#07EDE1"})),i.appendChild(f))},_removeGuidelines:function(n,t){t!=null&&n.removeChild(t)},update:function(n,t){t&&!t._isInit&&n._status!=="new"&&(n._status="update");var i=t._svg;n._type==="group"?this.updateGroup(n,i,t):n.segments?this.updateConnector(n,i,t):this.updateNode(n,i,t)},_updateGoupBackground:function(n,i){var f=n.offsetX-n.width*n.pivot.x,e=n.offsetY-n.height*n.pivot.y,c=n.rotateAngle,o=new t.datavisualization.Diagram.Point(f+n.width*n.pivot.x,e+n.height*n.pivot.y),s=n.fillColor,h=n.borderColor,r,u;(n.type=="bpmn"||n.classifier&&n.classifier=="package")&&(s="transparent",h="transparent");r={id:n.name+"_shape",rx:n.cornerRadius,ry:n.cornerRadius,width:Math.round(n.width<0?0:n.width),height:Math.round(n.height<0?0:n.height),fill:s,stroke:h,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray,transform:"rotate("+c+","+o.x+","+o.y+"),translate("+f+","+e+")"};n.gradient&&n.type!="bpmn"&&(r.fill=this._renderGradient(n.name,n.gradient,i));u=i.getElementById(n.name+"_shape");u&&(r["class"]=u.getAttribute("class"),this._updateCssClass(n,r),t.datavisualization.Diagram.Util.attr(u,r))},updateGroup:function(n,i,r,u){var l=r._getChildren(n.children),v=n.visible?"visible":"hidden",o="display:block;",s,a,f,e,c,h;for(n.visible||(o="display:none;"),t.datavisualization.Diagram.Util.canEnablePointerEvents(n,r)||(o="pointer-events:none"),i.g({id:n.name,visibility:"visible",style:o}),s=0,a=l.length;s<a;s++)f=r.nameTable[l[s]],f&&(f._type==="group"?this.updateGroup(f,i,r,u):f.segments?(t.datavisualization.Diagram.Util.updateBridging(f,r),this.updateConnector(f,i,r)):this.updateNode(f,i,r,u));if(i.g({id:n.name,visibility:v,style:o}),this._updateGoupBackground(n,i),this._updateAssociatedConnector(n,i,r),this._updateLabels(n,i,r),this._updatePorts(n,i),n.isSwimlane&&(e=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(r,n),c=null,e&&e.length>0))for(h=0;h<e.length;h++)c=r.nameTable[r._getChild(e[h])],this._updatephase(c,r,n)},_removephases:function(n,i){var r,u,f;if(n.isSwimlane&&(r=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(i,n),r))for(u=r.length;u>=0;u--)f=i.nameTable[r[u]],this._removePhase(i,f)},_removePhase:function(n,t){t&&n._views.forEach(function(i){var u=n._views[i],f=u.svg||u._canvas,r=f.document.getElementById(t.name+"_phase_g");r&&r.parentNode.removeChild(r)})},_updatePhaseStyle:function(n,t,i){if(n&&t){var r=n.visible?"visible":"hidden";i._svg.g({id:n.name+"_phase_g",visibility:r});t.id=n.name+"_phase";i._svg.g(t)}},_updatephase:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;r.context._updatephase1(n,t,u,i)})},_updatephase1:function(i,r,u,f){var l,o;if(u=u?u:r._svg,f){var s=0,h=0,a=null,c=[],v,e=t.datavisualization.Diagram.Util.bounds(f),y=r._getChildren(f.children);y.length>1&&(l=r.nameTable[y[0]]);var p=e.top+50,w=e.left+50;i.orientation=="vertical"?(s=e.x,h=e.y+l.height+i.offset,l&&(p+=l.height),h-.1<=e.bottom&&h-.1>=p&&(a="translate("+s+","+h+")"),c.push({x:0,y:0}),c.push({x:e.width,y:0}),v=this._convertToSVGPoints(c)):(s=e.x+i.offset,h=e.y,s-.1<=e.right&&s-.1>w&&(a="translate("+s+","+h+")"),l&&(c.push({x:0,y:l.height}),c.push({x:0,y:e.height})),v=this._convertToSVGPoints(c));o={points:v,id:i.name+"_phase"};u.polyline(o);o={points:v,id:i.name+"_phase_hitTest"};u.polyline(o);a&&(o={id:i.name+"_phase_g",transform:a});i.label&&this._updatePhaseLabel(i,i.label,r);u.g(o);u.getElementById(o.id)&&n("#"+o.id).insertAfter(n("#"+o.id)[0].parentNode.lastChild)}},_updatePhaseLabel:function(n,i,r){var f=r._svg,e=r._getPhaseBounds(n),u=f.getElementById(n.name+"_"+i.name);if(u){if(u.setAttribute("fill",i.fontColor),!i.text)return;u.textContent=i.text;e=t.datavisualization.Diagram.Util.bounds(n);this._wrapText(n,e,u,i,f);this._alignTextOnPhase(n,e,u,i,f)}},updateLabelStyle:function(t,i,r){var e=r.document.parentNode.getElementsByClassName("htmlLayer")[0],u=n(e).find("#"+t.name+"_"+i.name)[0],f;t&&u&&i&&(u.style.fontWeight=i.bold?"bold":"",u.style.fontStyle=i.italic?"italic":"",u.style.visibility=i.visible?"":"hidden",u.style.opacity=i.opacity,u.style.textDecoration=i.textDecoration,u.style.fontFamily=i.fontFamily,u.style.fontSize=i.fontSize+"px",u.style.color=i.fontColor,u.style.backgroundColor=i.fillColor,u.style.borderColor=i.borderColor,u.style.borderWidth=i.borderWidth+"px",u.style.borderStyle="solid",t._isHeader&&(u.style.borderWidth="0px",u.style.backgroundColor="transparent"),f=this._updateCssClass(i,{"class":u.className}),f&&(u.className=f["class"]))},updatePort:function(n,i,r){var u=r.getElementById(n.name+"_"+i.name),f;u&&(u&&u.parentNode&&u.parentNode.removeChild(u),f=document.getElementById(n.name),u=t.datavisualization.Diagram.SvgContext._renderPort(n,i,r),f.appendChild(u))},_updateNodeStyle:function(i,r){var u,o,s,f,e;i&&r&&(u={},u.opacity=i.opacity,u.fill=i.fillColor,u.stroke=i.borderColor,u["stroke-width"]=i.borderWidth,u["stroke-dasharray"]=i.borderDashArray,i.gradient&&(u.fill=this._renderGradient(i.name,i.gradient,r)),i._type=="node"&&(o=i.type=="text"||i.type=="html"?"_backRect":"_shape",i.type=="html"&&(s=r.document.parentNode.getElementsByClassName("htmlLayer")[0],f=n(s).children("#"+i.name+"_parentdiv")[0].childNodes[0],f&&(f.style.backgroundColor=i.fillColor,f.style.borderColor=i.borderColor,f.style.borderWidth=i.borderWidth+"px",f.style.opacity=i.opacity)),f=r.getElementById(i.name+o),f&&(u["class"]=f.getAttribute("class"),this._updateCssClass(i,u),t.datavisualization.Diagram.Util.attr(f,u)),i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(e=r.document.getElementById(i.name+"_shadow"),e&&t.datavisualization.Diagram.Util.attr(e,{fill:i.fillColor!="none"||i.fillColor!="transparent"?"lightgrey":"none"}))))},_updateConnectorStyle:function(n,i){var r,u;n&&i&&(r={},r.opacity=n.opacity,r.stroke=n.lineColor,r["stroke-width"]=n.lineWidth,r["stroke-dasharray"]=n.lineDashArray,u=i.getElementById(n.name+"_segments"),u&&(r["class"]=u.getAttribute("class"),this._updateCssClass(n,r),t.datavisualization.Diagram.Util.attr(u,r)))},updateTargetDecoratorStyle:function(n,i){var r,u;i&&(r={},r.stroke=n.targetDecorator.borderColor,r.fill=n.targetDecorator.fillColor,u=i.getElementById(n.name+"_targetDecorator"),u&&(r["class"]=u.getAttribute("class"),this._updateCssClass(n.targetDecorator,r),t.datavisualization.Diagram.Util.attr(u,r)))},updateSourceDecoratorStyle:function(n,i){var r,u;i&&(r={},r.stroke=n.sourceDecorator.borderColor,r.fill=n.sourceDecorator.fillColor,u=i.getElementById(n.name+"_sourceDecorator"),u&&(r["class"]=u.getAttribute("class"),this._updateCssClass(n.sourceDecorator,r),t.datavisualization.Diagram.Util.attr(u,r)))},updateNode:function(n,t,i){if(t){if(i&&!i._isInit&&n._status!=="new"&&(n._status="update"),this._updateLabels(n,t,i),this._updateNode(n,t,i),this._updateIcons(n,t,i),n._scaled=!1,i._layoutInAction)return;this._updateAssociatedConnector(n,t,i);i.activeTool.inAction&&(i.activeTool.name==="move"||i.activeTool.name==="rotate")||this._updatePorts(n,t)}},updateTextBlock:function(t,i,r){var f=r.document.parentNode.getElementsByClassName("htmlLayer")[0],e=n(f).children("#"+t.name)[0],o=n(e).children("#"+t.name+"_shape_lblbg")[0],u=o.childNodes[0];t&&u&&i&&(u.style.fontWeight=i.bold?"bold":"",u.style.fontStyle=i.italic?"italic":"",u.style.textDecoration=i.textDecoration,u.style.fontFamily=i.fontFamily,u.style.fontSize=i.fontSize+"px",u.style.color=i.fontColor);this._updateTextElement(t,r)},_updateAssociatedConnector:function(n,i,r){var u,f;if(n.inEdges&&n.inEdges.length>0)for(u=0,f=n.inEdges.length;u<f;u++)r.nameTable[n.inEdges[u]]&&(r.nameTable[n.inEdges[u]]&&t.datavisualization.Diagram.Util.canBridge(r.nameTable[n.inEdges[u]],r)&&(t.datavisualization.Diagram.Util.updateBridging(r.nameTable[n.inEdges[u]],r),r._updateConnectorBridging(r.nameTable[n.inEdges[u]])),r._disableSegmentChange||t.datavisualization.Diagram.DiagramContext.update(r.nameTable[n.inEdges[u]],r));if(n.outEdges&&n.outEdges.length>0)for(u=0,f=n.outEdges.length;u<f;u++)r.nameTable[n.outEdges[u]]&&(r.nameTable[n.outEdges[u]]&&t.datavisualization.Diagram.Util.canBridge(r.nameTable[n.outEdges[u]],r)&&(t.datavisualization.Diagram.Util.updateBridging(r.nameTable[n.outEdges[u]],r),r._updateConnectorBridging(r.nameTable[n.outEdges[u]])),r._disableSegmentChange||t.datavisualization.Diagram.DiagramContext.update(r.nameTable[n.outEdges[u]],r))},_updateNode:function(i,r,u){var e=i.width?i.width:i._width,o=i.height?i.height:i._height,y=i.offsetX-e*i.pivot.x,p=i.offsetY-o*i.pivot.y,w=i.rotateAngle,c=t.datavisualization.Diagram.Point(i.offsetX,i.offsetY),b=i.visible?"visible":"hidden",f={id:i.name,transform:"rotate("+w+","+c.x+","+c.y+"),translate("+y+","+p+")",visibility:b},l,s,h;f.style=t.datavisualization.Diagram.Util.canEnablePointerEvents(i,u)?"":"pointer-events:none";r.g(f);l=i._shape?i._shape:i.type;switch(l){case"rectangle":r.rect({id:i.name+"_shape",width:e<0?0:e,height:o<0?0:o});i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"ellipse":r.ellipse({id:i.name+"_shape",rx:e/2,ry:o/2,cx:e/2,cy:o/2});i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.ellipse({id:i.name+"_shadow",rx:i.width/2,ry:i.height/2,cx:i.width/2,cy:i.height/2});break;case"image":this._updateBackgroundRect(i,r);var a=t.datavisualization.Diagram.Util._getImageAlignment(i.contentAlignment),v=i.scale=="none"?"meet":i.scale,f={id:i.name+"_shape",preserveAspectRatio:v!="stretch"&&a!="none"?a+" "+v:"none"};i.scale!="none"&&(f.width=e,f.height=o);r.image(f);i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"path":i._preventStretch?s=i._absolutePath=i.pathData:i._scaled||!i._absolutePath?(s=t.datavisualization.Diagram.Geometry.updatePath(0,0,e,o,i.pathData,r,i._absoluteBounds),i._absolutePath=s,i._scaled=!1):s=i._absolutePath;r.path({id:i.name+"_shape",d:s});i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.path({id:i.name+"_shadow",d:s});break;case"polygon":this._updatePolygon(i,r);break;case"text":this._updateTextElement(i,r,u);i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"html":this._updateHtmlElement(i,r);i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height});break;case"native":h=this._scaleNodeContent(i,n("#"+i.name+"_shape")[0]);f={id:i.name+"_shape",width:i.width,height:i.height};h&&(f.transform="translate("+h.x+","+h.y+"),scale("+h.sx+","+h.sy+")");r.g(f);i.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&r.rect({id:i.name+"_shadow",width:i.width,height:i.height})}},_updateHtmlElement:function(t,i){this._updateBackgroundRect(t,i);var f=t.visible?"visible":"hidden",e=t.width?t.width:t._width,o=t.height?t.height:t._height,s=t.offsetX-e*t.pivot.x,h=t.offsetY-o*t.pivot.y,r,c=i.document.parentNode.getElementsByClassName("htmlLayer")[0],u=n(c).children("#"+t.name+"_parentdiv");u&&(r=n(u).children("#"+t.name+"_html")[0],r&&(r.style.left=s+"px",r.style.top=h+"px",r.style.webkitTransform="rotate("+t.rotateAngle+"deg)",r.style.MozTransform="rotate("+t.rotateAngle+"deg)",r.style.OTransform="rotate("+t.rotateAngle+"deg)",r.style.msTransform="rotate("+t.rotateAngle+"deg)",r.style.transform="rotate("+t.rotateAngle+"deg)",r.style.opacity=t.opacity,r.style.visibility=f));r&&(r.style.width=t.width.toString()+"px",r.style.height=t.height.toString()+"px")},_updatePolygon:function(n,i){t.datavisualization.Diagram.Geometry.updatePolygonPoints(n);i.polygon({id:n.name+"_shape",points:this._convertToSVGPoints(n.points)});n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&i.polygon({id:n.name+"_shadow",points:this._convertToSVGPoints(n.points)})},_convertToSVGPoints:function(n){for(var i="",t=0,r=n.length;t<r;t++)i+=n[t].x+","+n[t].y+" ";return i.trim()},_renderTextElement:function(i,r,u){var o=i.textBlock,s,h,e,c,f,v;if(o){s=r.document.parentNode.getElementsByClassName("htmlLayer")[0];this._renderBackgroundRect(i,r,u);h=document.createElement("div");e=document.createElement("span");t.datavisualization.Diagram.Util.attr(e,{id:i.name,"class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal; alignment-baseline:middle"});o.bold&&(e.style.fontWeight="bold");o.italic&&(e.style.fontStyle="italic");e.style.textDecoration=o.textDecoration;e.style.fontFamily=o.fontFamily;e.style.fontSize=o.fontSize+"px";e.style.color=o.fontColor;e.textContent=o.text;c="display: inline-block; position: absolute; width: inherit; height: inherit; pointer-events: none; ";t.datavisualization.Diagram.Util.attr(h,{id:i.name+"_shape_lblbg",style:c});h.appendChild(e);f=n(s).children("#"+i.name)[0];f&&s.removeChild(f);f=document.createElement("div");var l=i.width?i.width:i._width,a=i.height?i.height:i._height,y=i.offsetX-l*i.pivot.x,p=i.offsetY-a*i.pivot.y,c="width:"+l+"px; height:"+a+"px; left:"+y+"px; top:"+p+"px; display: block; position: absolute; pointer-events: none; ";t.datavisualization.Diagram.Util.attr(f,{id:i.name,"class":"ej-d-node",style:c});f.style.webkitTransform="rotate("+i.rotateAngle+"deg) ";f.style.MozTransform="rotate("+i.rotateAngle+"deg) ";f.style.OTransform="rotate("+i.rotateAngle+"deg) ";f.style.msTransform="rotate("+i.rotateAngle+"deg)";f.style.transform="rotate("+i.rotateAngle+"deg) ";f.appendChild(h);s&&s.appendChild(f);v=t.datavisualization.Diagram.Util.bounds(i);this._alignTextOnLabel(i,v,e,h,i.textBlock)}},_updateTextElement:function(i,r,u){var o,e,h;if(this._updateBackgroundRect(i,r),o=r.document.parentNode.getElementsByClassName("htmlLayer")[0],o){var f=this._findChild(o.childNodes,i),y=i.visible?"visible":"hidden",s=t.datavisualization.Diagram.Util.bounds(i),c,l,a,v;f&&(c=s.width,l=s.height,a=i.offsetX-i.width*i.pivot.x,v=i.offsetY-i.height*i.pivot.y,f.style.width=c+"px",f.style.height=l+"px",f.style.left=a+"px",f.style.top=v+"px",f.style.visibility=y,f.style.webkitTransform="rotate("+i.rotateAngle+"deg)",f.style.MozTransform="rotate("+i.rotateAngle+"deg)",f.style.OTransform="rotate("+i.rotateAngle+"deg)",f.style.msTransform="rotate("+i.rotateAngle+"deg)",f.style.transform="rotate("+i.rotateAngle+"deg)");e=n(f).children("#"+i.name+"_shape_lblbg")[0];e&&(h=e.childNodes[0],h.textContent=i.textBlock.text,this._alignTextOnLabel(i,s,h,e,i.textBlock,u))}},_renderBackgroundRect:function(n,i,r){var u=this._fill(n,i),e={id:n.name+"_backRect","class":"backrect",x:0,y:0,width:n.width,height:n.height,fill:u,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray},f,o;this._addCssClass(n,e);n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow&&(f=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance),o={id:n.name+"_shadow","class":"backrect",width:n.width,height:n.height,stroke:"lightgrey",fill:u!="none"||u!="transparent"?"lightgrey":"none",transform:"translate("+f.x+","+f.y+")",opacity:n.shadow.opacity},r.appendChild(i.rect(o)));r.appendChild(i.rect(e))},_updateBackgroundRect:function(n,t){var i=this._fill(n,t),r={id:n.name+"_backRect",x:0,y:0,width:n.width,height:n.height,fill:i,stroke:n.borderColor,"stroke-width":n.borderWidth,opacity:n.opacity,"stroke-dasharray":n.borderDashArray};t.rect(r)},_hideNode:function(n,t){var i={id:n.name,style:"pointer-events:none;"};t.rect(i)},_showNode:function(n,t){var i={id:n.name,style:"pointer-events:auto;"};t.rect(i)},_removePhasehelper:function(n){n._adornerSvg.getElementById("phase_helper")&&n._adornerSvg.removeChild(n._adornerSvg.getElementById("phase_helper"),n._adornerLayer)},_updatePhaseHelper:function(n,t,i){if(t){var f=n._adornerSvg,r=n._currZoom,u;i.width=i.width<0?1:i.width;i.height=i.height<0?1:i.height;u={id:"phase_helper","class":"helper","pointer-events":"none",width:i.width*r,height:i.height*r};n._adornerSvg.rect(u)}},_phasehelper:function(n,t,i){if(t){var u=n._adornerSvg,r=n._currZoom,f=i.x+i.width/2,e=i.y+i.height/2,o=u.rect({id:"phase_helper","class":"helper","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:i.width*r,height:i.height*r,fill:"transparent",stroke:"green",transform:"translate("+(f-i.width/2)*r+","+(e-i.height/2)*r+"),rotate(0,"+i.width/2*r+","+i.height/2*r+")"});n._adornerLayer.appendChild(o)}},_drawContainerHelper:function(n){var i=n.activeTool.helper,c=n._adornerSvg,u=n._currZoom,r,f,e,o,s,h;i&&(r=t.datavisualization.Diagram.Util.bounds(i,!0));f=r.height;e=r.width;o=i.pivot?{x:r.width*i.pivot.x,y:r.height*i.pivot.y}:{x:e/2,y:f/2};s=i.rotateAngle?i.rotateAngle:0;h=c.rect({id:"helper","class":"helper","stroke-width":1,"stroke-dasharray":"3,3","pointer-events":"none",width:e*u,height:f*u,fill:"transparent",stroke:"red",transform:"translate("+r.x*u+","+r.y*u+"),rotate("+s+","+o.x*u+","+o.y*u+")"});n._adornerLayer.appendChild(h)},_updateContainerHelper:function(n){var s,i=n.activeTool.helper,u=n._currZoom,r,f,e,o,h;i&&(r=t.datavisualization.Diagram.Util.bounds(i,!0));f=r.height;e=r.width;o=i.pivot?{x:r.width*i.pivot.x,y:r.height*i.pivot.y}:{x:e/2,y:f/2};n._raiseOffsetPropertyChange(i,r.center.x,r.center.y,!0);n._raiseSizePropertyChange(i,r.width/i.width,r.height/i.height,!0);h=i.rotateAngle?i.rotateAngle:0;s={id:"helper","class":"helper",width:e*u,height:f*u,fill:"transparent",stroke:"red",transform:"translate("+r.x*u+","+r.y*u+"),rotate("+h+","+o.x*u+","+o.y*u+")"};n._adornerSvg.rect(s)},_removeContainerHelper:function(n,t,i){t.getElementById("helper")&&t.removeChild(t.getElementById("helper"),i)},setNodeShape:function(t,i,r,u){var f,e;r?(e=i.getElementById(r.name),f=n(e).find("#"+t.name)[0]):f=i.getElementById(t.name);f&&(n(f).empty(),this._renderNode(t,i,f,u))},setLine:function(t,i,r,u){var f,e;r?(e=i.getElementById(r.name),f=n(e).find("#"+t.name)[0]):f=i.getElementById(t.name);n(f).empty();this.renderConnector(t,i,f,u)},addNodeLabel:function(n,t,i,r,u){this._renderLabels(n,i,u)},renderConnector:function(n,i,r,u){var f,h=n.visible?"visible":"hidden",s={id:n.name,"class":"ej-d-connector",visibility:h,opacity:n.opacity},o,e;if(t.datavisualization.Diagram.Util.canEnablePointerEvents(n,u)||(s.style="pointer-events:none"),f=i.g(s),r?r.id!==f.id&&r.appendChild(f):i.appendChild(f),o=i.g({id:n.name+"segments"}),this._renderSegments(n,i,o,u),f.appendChild(o),this._renderLabels(n,i,u),this._renderDecorators(n,i,f,u),n.shape)for(t.datavisualization.Diagram.DefautShapes.updateInlineDecoratorsShape(n,u),e=0;e<n._inlineDecorators.length;e++)this.renderNode(n._inlineDecorators[e],i,f,undefined,u);return f},_renderSegments:function(n,i,r,u){var s=n.visible&&(u?u._browserInfo.name:t.browserInfo().name)==="msie"?"collapse":"hidden",o=this._findPath(n,u),f={id:n.name+"_hitTest","class":"hitTest","stroke-width":n.lineHitPadding,d:o,stroke:"transparent",visibility:"hidden"},e;f["pointer-events"]=t.datavisualization.Diagram.Util.canEnablePointerEvents(n,u)?n.visible?"stroke":"none":"none";e=i.path(f);r.appendChild(e);f={id:n.name+"_segments",d:o,fill:"none",stroke:n.lineColor,"stroke-width":n.lineWidth,"stroke-dasharray":n.lineDashArray,opacity:n.opacity};this._addCssClass(n,f);e=i.path(f);r.appendChild(e)},_findPath:function(n,i){for(var r,v,k,f,w,y,a,s,u,h,nt,c,l,e,o=0;o<n.segments.length;o++){if(r=n.segments[o],r._bridges.length>0)for(v=0;v<r._bridges.length;v++)k=r._bridges[v],k._rendered=!1;if(f=r.points,n.shape&&n.shape.flow=="sequence"&&n.shape.sequence=="default"&&o==0){w={x:r.points[0].x,y:r.points[0].y};y=t.datavisualization.Diagram.Geometry.distance(r.points[0],r.points[1]);y=Math.min(30,y/2);var b=t.datavisualization.Diagram.Geometry.findAngle(r.points[0],r.points[1]),d=t.datavisualization.Diagram.Geometry.transform({x:w.x,y:w.y},b,y),p=t.datavisualization.Diagram.Geometry.transform({x:d.x,y:d.y},b+45,-12),g=t.datavisualization.Diagram.Geometry.transform({x:p.x,y:p.y},b+45,24),tt="M"+p.x+" "+p.y+" L"+g.x+" "+g.y}if(o==0&&(i&&n.sourceNode&&(a=i._findNode(n.sourceNode)),f=this._clipDecorators(n,r,!0,a),r.type=="bezier"&&n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(f[0]=t.datavisualization.Diagram.Util._adjustPoint(f[0],r._point1,!0,n.lineWidth)),e="M"+f[0].x+" "+f[0].y),o==n.segments.length-1&&(i&&n.targetNode&&(a=i._findNode(n.targetNode)),f=this._clipDecorators(n,r,!1,a)),r.type!="bezier")if(n.cornerRadius>0)for(u=0;u<f.length-1;u++)s=t.datavisualization.Diagram.Geometry.distance(f[u],f[u+1]),s>0&&(l=o<n.segments.length-1||u<f.length-2?s<n.cornerRadius*2?t.datavisualization.Diagram.Util._adjustPoint(f[u],f[u+1],!1,s/2):t.datavisualization.Diagram.Util._adjustPoint(f[u],f[u+1],!1,n.cornerRadius):f[u+1],(o>0||u>0)&&(s<n.cornerRadius*2?(c=t.datavisualization.Diagram.Util._adjustPoint(f[u],f[u+1],!0,s/2),(o<n.segments.length-1||u<f.length-2)&&(l=null)):c=t.datavisualization.Diagram.Util._adjustPoint(f[u],f[u+1],!0,n.cornerRadius)),c&&(e+=" Q"+f[u].x+" "+f[u].y+" "+c.x+" "+c.y),l&&(r._bridges.length>0&&(e=this._updateBridging(r,e,u),r.type==="orthogonal"&&(e=this._updateBridging(r,e,u+1))),e+=" L"+l.x+" "+l.y));else for(u=0;u<f.length;u++)u>0&&(e=this._updateBridging(r,e,u)+(" L"+f[u].x+" "+f[u].y));else h=r._endPoint,n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(h=t.datavisualization.Diagram.Util._adjustPoint(r._endPoint,r._point2,!0,n.lineWidth)),n.targetNode&&i&&(nt=i._findNode(n.targetNode),a.borderColor!="none"&&(h=t.datavisualization.Diagram.Util._adjustPoint(h,r._point2,!0,nt.borderWidth/2))),e+=" C"+r._point1.x+" "+r._point1.y+" "+r._point2.x+" "+r._point2.y+" "+h.x+" "+h.y}return n.shape&&n.shape.flow=="sequence"&&n.shape.sequence=="default"&&(e+=tt),e},_updateBridging:function(n,t,i){var f=t,u,r;if(n._bridges.length>0)if(n.type==="straight")for(u=0;u<n._bridges.length;u++)r=n._bridges[u],r._rendered||(f+=" L"+r.startPoint.x+" "+r.startPoint.y,f+=r.path);else if(n.type==="orthogonal")for(u=0;u<n._bridges.length;u++)r=n._bridges[u],r.segmentPointIndex!==i||r._rendered||(f+=" L"+r.startPoint.x+" "+r.startPoint.y,f+=r.path,r._rendered=!0);return f},_refreshSegments:function(n,t,i){this._updateConnector(n,t,i);this._updateDecorators(n,t,i)},_refreshOnlySegments:function(n,t,i){var u=this._findPath(n,i),r=t.document.getElementById(n.name+"_segments");r&&(r.setAttribute("d",u),r=t.document.getElementById(n.name+"_hitTest"),r.setAttribute("d",u))},_clipDecorators:function(n,i,r,u){var f=[],o,c,s,l,h,e;if(!r&&n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None){for(e=0;e<i.points.length;e++)f[e]=i.points[e];o=f[f.length-1];c=f[f.length-2];s=t.datavisualization.Diagram.Geometry.distance(o,c);s=s==0?1:s;l=n.lineWidth;h=t.datavisualization.Diagram.Point();h.x=o.x+l*(c.x-o.x)/s;h.y=o.y+l*(c.y-o.y)/s;u&&u.borderColor!="none"&&(h=t.datavisualization.Diagram.Util._adjustPoint(h,c,!0,u.borderWidth/2));f[f.length-1]=h}else if(r&&n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None){for(e=0;e<i.points.length;e++)f[e]=i.points[e];o=f[0];c=f[1];s=t.datavisualization.Diagram.Geometry.distance(o,c);s=s==0?1:s;l=n.lineWidth;h=t.datavisualization.Diagram.Point();h.x=o.x+l*(c.x-o.x)/s;h.y=o.y+l*(c.y-o.y)/s;i.type=="bezier"&&(h.x=o.x+(i._point1.x-o.x)/s,h.y=o.y+(i._point1.y-o.y)/s);u&&u.borderColor!="none"&&(h=t.datavisualization.Diagram.Util._adjustPoint(h,i.type!="bezier"?c:i._point1,!0,u.borderWidth/2));f[0]=h}else if(r){for(e=0;e<i.points.length;e++)f[e]=i.points[e];u&&u.borderColor!="none"&&(f[0]=t.datavisualization.Diagram.Util._adjustPoint(f[0],f[1],!0,u.borderWidth/2))}else{for(e=0;e<i.points.length;e++)f[e]=i.points[e];u&&u.borderColor!="none"&&(f[f.length-1]=t.datavisualization.Diagram.Util._adjustPoint(f[f.length-1],f[f.length-2],!0,u.borderWidth/2))}return f},_updateConnector:function(n,i,r){var u,f;r&&!r._isInit&&n._status!=="new"&&(n._status="update");u=this._findPath(n,r);i.path({id:n.name+"_segments",d:u});f={id:n.name+"_hitTest",d:u,"stroke-width":n.lineHitPadding};f["pointer-events"]=t.datavisualization.Diagram.Util.canEnablePointerEvents(n,r)?n.isPhase||r._selectedSymbol&&r.selectionList[0]&&r.selectionList[0].name==n.name?"none":n.visible?"stroke":"none":"none";i.path(f)},updateConnector:function(n,i,r){var e,f,u;if(i&&(e=n.visible?"visible":"hidden",f={id:n.name,visibility:e,opacity:n.opacity},f.style=t.datavisualization.Diagram.Util.canEnablePointerEvents(n,r)?"":"pointer-events:none",r._animatingLayout||i.g(f),this._updateConnector(n,i,r),this._updateLabels(n,i,r),this._updateDecorators(n,i,r),n.shape))for(t.datavisualization.Diagram.DefautShapes.updateInlineDecoratorsShape(n,r),u=0;u<n._inlineDecorators.length;u++)this.updateNode(n._inlineDecorators[u],i,r)},renderDecorators:function(n,t,i){var r=t.getElementById(n.name);this._renderDecorators(n,t,r,i)},clearDecorators:function(n,t,i){this._updateConnector(n,t,i);var u=t.getElementById(n.name),r=t.getElementById(n.name+"_targetDecorator");r&&t.removeChild(r,u);r=t.getElementById(n.name+"_sourceDecorator");r&&t.removeChild(r,u)},_renderDecorators:function(n,i,r,u){var e,o,s,f,h;n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(f=n.segments[n.segments.length-1],e=f.points[f.points.length-2],o=n.targetPoint,f.type=="bezier"&&(e=f._point2),n.targetNode&&u&&(s=u._findNode(n.targetNode),s&&s.borderColor!="none"&&(o=t.datavisualization.Diagram.Util._adjustPoint(o,e,!0,s.borderWidth/2))),this._renderDecorator(n.name+"_targetDecorator",o,e,n,n.targetDecorator,i,r));n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(f=n.segments[0],e=n.sourcePoint,o=f.points[1],f.type=="bezier"&&(o=f._point1),n.sourceNode&&u&&(h=u._findNode(n.sourceNode),h&&h.borderColor!="none"&&(e=t.datavisualization.Diagram.Util._adjustPoint(e,o,!0,h.borderWidth/2))),this._renderDecorator(n.name+"_sourceDecorator",e,o,n,n.sourceDecorator,i,r))},_renderIcons:function(n,t){var u=n.expandIcon,f=n.collapseIcon,l,i,a;if(u.shape!="none"||f.shape!="none"){var r,v=n.width?n.width:n._width||0,y=n.height?n.height:n._height||0,p=n.name,e=0,o=0,s=0,h=0,c=0,w=n.visible?"visible":"hidden";s=n.offsetX-v*n.pivot.x;h=n.offsetY-y*n.pivot.y;e=n.offsetX;o=n.offsetY;c=n.rotateAngle;l={id:p,transform:"rotate("+c+","+e+","+o+"),translate("+s+","+h+")",visibility:w};i=t._adornerSvg;r=i.g(l);a=i.document.parentNode.getElementsByClassName("ExpanderLayer")[0]||t._expander;a.appendChild(r);u!=undefined&&n.isExpanded&&this._renderIcon(n,i,u,r,t);f==undefined||n.isExpanded||this._renderIcon(n,i,f,r,t)}},_renderIcon:function(n,i,r,u,f){var s,e,u,h,l,a,c,o;if(r!=undefined){if(e=t.datavisualization.Diagram.Util._getIconPosition(r,t.datavisualization.Diagram.Util.bounds(n,!0),!0),r.shape!="path")this._renderExpanderTemplate(n,i,r,u,f,e);else if(r.shape=="path")return u=document.createElementNS("http://www.w3.org/2000/svg","g"),u.setAttribute("id",n.name+"_expander"),u.setAttribute("class","ej-d-icon-template"),h=t.datavisualization.Diagram.Geometry.updatePath(e.x-r.width/2,e.y-r.height/2,r.width,r.height,r.pathData,i),l=n.visible?"visible":"hidden",r._absolutePath=h,r.margin.left&&r.margin.right&&(r.width-=(r.margin.left||0)+(r.margin.right||0)),r.margin.top&&r.margin.bottom&&(r.height-=(r.margin.top||0)+(r.margin.bottom||0)),s={id:n.name+"_pathexpander",x:e.x,y:e.y,width:r.width,height:r.height,fill:r.borderColor,stroke:r.borderColor,"stroke-width":r.borderWidth,visibility:l,d:h},this._addCssClass(u,s),a=i.path(s),u.appendChild(a),u;return r.shape=="image"&&(c=new Image,c.src=r.source,o=i.image(s),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c.src),u.appendChild(o)),o}},_renderExpanderTemplate:function(n,t,i,r,u,f,e){var v=this.construct_template_iconshape(i,n.isExpanded,u),s,h,c;if(v!="undefined"){e&&r.removeChild(t.document.getElementById(n.name+"_expander"));s=document.createElement("div");s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+v+"<\/g><\/svg>";document.body.appendChild(s);h=document.getElementById("tempNative");c=h.cloneNode(!0);c.id=n.name+"_expander";var o=h.getBBox(),y=i.width,p=i.height,l=o.width?y/o.width:1,a=o.height?p/o.height:1;s.parentNode.removeChild(s);r.appendChild(c);var d=Math.min(l,a),g=n.visible?"visible":"hidden",w=f.x-i.width/2-o.x*l,b=f.y-i.height/2-o.y*a,k={id:n.name+"_expander","class":"ej-d-icon-template",transform:"translate("+w+","+b+"),scale("+l+","+a+")",x:f.x,y:f.y,width:i.width,height:i.height,fill:i.borderColor,stroke:i.borderColor,"stroke-width":i.borderWidth};t.g(k)}},construct_template_iconshape:function(n,t,i){var r;if(n.shape){switch(n.shape){case"arrowup":r='<rect  x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><path d="M8.7,7.2L8.9,7h2.2l0.2,0.2l0,0l4.8,4.8h-2.5L10,8.4L6.4,12H3.9L8.7,7.2L8.7,7.2z"/><\/path><\/rect>';break;case"arrowdown":r='<rect  x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><path d="M9,12.2l0.1,0.1h1.7l0.1-0.1l0,0l3.8-3.8h-2L10,11.2L7.2,8.4h-2L9,12.2L9,12.2z"/><\/path><\/rect>';break;case"plus":r='<rect x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><line style="fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="6.1" y1="10" x2="13.9" y2="10"/><\/line><line style=" fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="10" y1="6.1" x2="10" y2="13.9"/><\/line><\/rect>';break;case"minus":r=' <rect x="2.5" y="2.5" width="15" height="15" style="fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10"/><line style="fill:#FFFFFF;stroke:#000000;stroke-width:2;stroke-miterlimit:10" x1="6.1" y1="10" x2="13.9" y2="10"/><\/line><\/rect>';break;case"template":r=i._renderEjTemplate("#"+n.templateId,n)}return r}},_updateIcons:function(n,t,i){var r=n.expandIcon,u=n.collapseIcon,l,t,w;if(r.shape!="none"||u.shape!="none"){var f,a=n.width?n.width:n._width||0,v=n.height?n.height:n._height||0,y=n.name,e=0,o=0,s=0,h=0,c=0,p=n.visible?"visible":"hidden";s=n.offsetX-a*n.pivot.x;h=n.offsetY-v*n.pivot.y;e=n.offsetX;o=n.offsetY;c=n.rotateAngle;l={id:y,transform:"rotate("+c+","+e+","+o+"),translate("+s+","+h+")",visibility:p};t=i._adornerSvg;f=t.g(l);w=t.document.parentNode.getElementsByClassName("ExpanderLayer")[0]||i._expander;r!=undefined&&n.isExpanded&&this._updateIcon(n,i._adornerSvg,f,r,i);u==undefined||n.isExpanded||this._updateIcon(n,i._adornerSvg,f,u,i)}},_updateIcon:function(n,i,r,u,f){var o,e,s,l,h,c;u!=undefined&&(n._scaled||n._updateExpander)&&(e=t.datavisualization.Diagram.Util._getIconPosition(u,t.datavisualization.Diagram.Util.bounds(n,!0),!0),u.shape!="path"?(n._scaled||n._updateExpander)&&this._renderExpanderTemplate(n,i,u,r,f,e,!0):u.shape=="path"&&(s=t.datavisualization.Diagram.Geometry.updatePath(e.x-u.width/2,e.y-u.height/2,u.width,u.height,u.pathData,i),l=n.visible?"visible":"hidden",u._absolutePath=s,u.margin.left&&u.margin.right&&(u.width-=(u.margin.left||0)+(u.margin.right||0)),u.margin.top&&u.margin.bottom&&(u.height-=(u.margin.top||0)+(u.margin.bottom||0)),o={id:n.name+"_pathexpander",x:e.x,y:e.y,width:u.width,height:u.height,fill:u.borderColor,stroke:u.borderColor,"stroke-width":u.borderWidth,visibility:l,d:s},i.path(o)),u.shape=="image"&&(h=new Image,h.src=u.source,c=i.image(o),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h.src),r.appendChild(c)),n._updateExpander=!1)},_renderDecorator:function(n,i,r,u,f,e,o){var c,s,l,a,h=t.datavisualization.Diagram.Size(f.width,f.height),p,w,v,y;switch(f.shape){case"arrow":l=this._constructArrow(i,h);s={id:n,"class":"decorator",d:l,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};this._addCssClass(f,s);c=e.path(s);a=1.1*f.borderWidth;break;case"openarrow":l=this._constructArrow(i,h,!0);s={id:n,"class":"decorator",d:l,fill:"transparent",stroke:f.borderColor,"stroke-width":f.borderWidth};this._addCssClass(f,s);c=e.path(s);a=1.1*f.borderWidth;break;case"circle":p=h.width/2;w=h.height/2;s={id:n,"class":"decorator",rx:p,ry:w,cx:i.x+h.width/2,cy:i.y,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};this._addCssClass(f,s);c=e.ellipse(s);a=.5*f.borderWidth;break;case"diamond":l=this._constructDiamond(i,h,e);s={id:n,"class":"decorator",x:i.x,y:i.y,width:h.width,height:h.height,d:l,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};this._addCssClass(f,s);c=e.path(s);a=.7*f.borderWidth;break;case"path":l=t.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-h.height/2,h.width,h.height,f.pathData,e);f._absolutePath=l;s={id:n,"class":"decorator",x:i.x,y:i.y,width:h.width,height:h.height,d:l,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};this._addCssClass(f,s);c=e.path(s);a=.5*f.borderWidth}c&&(f.borderColor!="none"?(v=t.datavisualization.Diagram.Geometry.findAngle(i,r),y=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},v,a),c.setAttribute("transform","translate("+y.x+","+y.y+"),rotate("+v+" "+i.x+" "+i.y+")")):c.setAttribute("transform","rotate("+t.datavisualization.Diagram.Geometry.findAngle(i,r)+" "+i.x+" "+i.y+")"),o.appendChild(c))},_updateDecorators:function(n,i,r){var f,e,s,u,o,h;n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(u=n.segments[n.segments.length-1],o=u.points,f=o[o.length-2],e=n.targetPoint,u.type=="bezier"&&(f=u._point2),n.targetNode&&r&&(s=r._findNode(n.targetNode),s&&s.borderColor!="none"&&(e=t.datavisualization.Diagram.Util._adjustPoint(n.targetPoint,f,!0,s.borderWidth/2))),this._updateDecorator(n.name+"_targetDecorator",e,f,n,n.targetDecorator,i));n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(u=n.segments[0],o=u.points,f=n.sourcePoint,e=o[1],u.type=="bezier"&&(e=u._point1),n.sourceNode&&r&&(h=r._findNode(n.sourceNode),h.borderColor!="none"&&(f=t.datavisualization.Diagram.Util._adjustPoint(n.sourcePoint,e,!0,h.borderWidth/2))),this._updateDecorator(n.name+"_sourceDecorator",f,e,n,n.sourceDecorator,i))},_updateDecorator:function(n,i,r,u,f,e){var c,s,h,l,o=t.datavisualization.Diagram.Size(f.width,f.height),y,p,a,v;switch(f.shape){case"arrow":h=this._constructArrow(i,o);s={id:n,d:h};c=e.path(s);l=1.1*f.borderWidth;break;case"openarrow":h=this._constructArrow(i,o,!0);s={id:n,d:h,fill:"transparent",stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(s);l=1.1*f.borderWidth;break;case"circle":y=o.width/2;p=o.height/2;s={id:n,rx:y,ry:p,cx:i.x+o.width/2,cy:i.y,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.ellipse(s);l=.5*f.borderWidth;break;case"diamond":h=this._constructDiamond(i,o,e);s={id:n,x:i.x,y:i.y,width:o.width,height:o.height,d:h,fill:f.fillColor,stroke:f.borderColor,"stroke-width":f.borderWidth};c=e.path(s);l=.7*f.borderWidth;break;case"path":h=t.datavisualization.Diagram.Geometry.updatePath(i.x,i.y-o.height/2,o.width,o.height,f.pathData,e);f._absolutePath=h;s={id:n,d:h};c=e.path(s);l=.5*f.borderWidth}c&&(f.borderColor!="none"?(a=t.datavisualization.Diagram.Geometry.findAngle(i,r),v=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},a,l),c.setAttribute("transform","translate("+v.x+","+v.y+"),rotate("+a+" "+i.x+" "+i.y+")")):c.setAttribute("transform","rotate("+t.datavisualization.Diagram.Geometry.findAngle(i,r)+" "+i.x+" "+i.y+")"))},_constructArrow:function(n,i,r){var u=new t.datavisualization.Diagram.Path;return u.moveTo(n.x+i.width,n.y+i.height/2),u.lineTo(n.x,n.y),u.lineTo(n.x+i.width,n.y-i.height/2),r||u.close(),u.toString()},_constructDiamond:function(n,i){var r=new t.datavisualization.Diagram.Path;return r.moveTo(n.x+i.width,n.y),r.lineTo(n.x+i.width/2,n.y+i.height/2),r.lineTo(n.x,n.y),r.lineTo(n.x+i.width/2,n.y-i.height/2),r.lineTo(n.x+i.width,n.y),r.toString()},_addLabel:function(i,r,u,f,e){var c,l,y,p,o=t.datavisualization.Diagram.Util.bounds(i),s,h,a,v;c=o.width;l=o.height;y=o.x;p=o.y;h=u.document.parentNode.getElementsByClassName("htmlLayer")[0];s=n(h).children("#"+i.name)[0];a=i._type==="node"?"ej-d-node":i._type==="group"?"ej-d-group":"ej-d-connector";t.datavisualization.Diagram.Util.attr(s,{id:i.name,"class":a});v=this._renderLabel(i,o,r,s,h,u,c,l,f);e!=undefined&&s.insertBefore(v,s.childNodes[e])},_renderLabels:function(i,r,u,f){var v;if(i.labels.length&&i.type!="text"){var y=i.labels,o=t.datavisualization.Diagram.Util.bounds(i),s,h,l,a,e,c=r.document.parentNode.getElementsByClassName("htmlLayer")[0];e=n(c).children("#"+i.name)[0];e&&c.removeChild(e);e=document.createElement("div");i.segments?(s=o.width,h=o.height,l=o.x,a=o.y):(s=i.width?i.width:i._width,h=i.height?i.height:i._height,l=i.offsetX-s*i.pivot.x,a=i.offsetY-h*i.pivot.y);f&&(l=0,a=0);var w=i.visible?"visible":"hidden",b="width:"+s+"px; height:"+h+"px; left:"+l+"px; top:"+a+"px; display: block; position: absolute; pointer-events: none; visibility:"+w+"; padding: inherit;",p=i._type==="node"?"ej-d-node":i._type==="group"?"ej-d-group":"ej-d-connector";for(i._isClassifier&&(p+=" ej-d-classifier"),t.datavisualization.Diagram.Util.attr(e,{id:i.name,"class":p,style:b}),i.rotateAngle&&(e.style.webkitTransform="rotate("+i.rotateAngle+"deg) ",e.style.MozTransform="rotate("+i.rotateAngle+"deg) ",e.style.OTransform="rotate("+i.rotateAngle+"deg) ",e.style.msTransform="rotate("+i.rotateAngle+"deg)",e.style.transform="rotate("+i.rotateAngle+"deg) ",e.style["transform-origin"]=i.pivot.x*100+"% "+i.pivot.y*100+"%"),c&&c.appendChild(e),v=0;v<y.length;v++)this._renderLabel(i,o,y[v],e,c,r,s,h,u)}},_isParentVisible:function(n,t){for(var i=t.document.getElementById(n);i&&(i.getAttribute("class")!="DiagramLayer"||i.localName&&i.localName!=="svg");){if(i.localName&&i.localName!=="svg")break;if(i&&i.getAttribute("visibility")!=="visible")return!0;i=i.parentNode}},_renderLabel:function(n,i,r,u,f,e,o,s,h){var l=document.createElement("div"),c=document.createElement("span"),y,a,v,p;return e.document&&e.document.getAttribute("class")==="overview_svg"?t.datavisualization.Diagram.Util.attr(c,this._addCssClass(r,{id:n.name+"_"+r.name,"class":"ej-d-label",style:"display: inline-block; position: absolute; line-height: normal; pointer-events: none"})):(y=t.datavisualization.Diagram.Util.canEnablePointerEvents(n,h),a="ej-d-label",n._isClassifier&&(a+=" ej-d-classifier"),t.datavisualization.Diagram.Util.attr(c,this._addCssClass(r,{id:n.name+"_"+r.name,"class":a,style:"display: inline-block; position: absolute; line-height: normal; pointer-events:"+(y?"all":"none")}))),(r.horizontalAlignment=="stretch"||r.verticalAlignment=="stretch")&&(v=this._rotateLabel(o,s,r),r.horizontalAlignment=="stretch"&&(c.style.width=Math.abs(v.x)+"px"),r.verticalAlignment=="stretch"&&(c.style.alignItems="center",c.style.display="flex",c.style.justifyContent="center",c.style.height=Math.abs(v.y)+"px")),r.bold&&(c.style.fontWeight="bold"),r.italic&&(c.style.fontStyle="italic"),(!r.visible||this._isParentVisible(n.name,e))&&(c.style.visibility="hidden"),c.style.opacity=r.opacity,c.style.textDecoration=r.textDecoration,c.style.fontFamily=r.fontFamily,c.style.fontSize=r.fontSize+"px",c.style.color=r.fontColor,c.style.backgroundColor=r.fillColor,c.style.borderColor=r.borderColor,c.style.borderWidth=r.borderWidth+"px",n._isHeader&&(c.style.borderWidth="0px",c.style.backgroundColor="transparent"),c.style.borderStyle="solid",c.textContent=r.text,o=o>r.width?o:r.width,r.margin.left&&r.margin.right&&(o-=(r.margin.left||0)+(r.margin.right||0)),r.margin.top&&r.margin.bottom&&(s-=(r.margin.top||0)+(r.margin.bottom||0)),p="display: inline-block; position: absolute; pointer-events: none; width:"+o+"px;height:"+s+"px;",t.datavisualization.Diagram.Util.attr(l,{id:n.name+"_"+r.name+"_lblbg",style:p}),l.appendChild(c),u.appendChild(l),this._alignTextOnLabel(n,i,c,l,r,h),l},_findChild:function(n,t){for(var r=n.length,i=0;i<r;i++)if(n[i].id==t.name)return n[i]},_updateLabels:function(n,i,r){var u,d,g,s,nt,h,tt,w,a,f,e,b;if(n.labels&&n.labels.length&&n.type!="text"){var k=n.labels,c=t.datavisualization.Diagram.Util.bounds(n),o,l,v,y,p=i.document.parentNode.getElementsByClassName("htmlLayer")[0];if(p&&(u=p.childNodes[n.zOrder],u&&u.id==n.name||(d=p.childNodes,u=this._findChild(d,n,i))),u)for(n.segments?(o=c.width,l=c.height,v=c.x,y=c.y):(o=n.width?n.width:n._width,l=n.height?n.height:n._height,v=n.offsetX-o*n.pivot.x,y=n.offsetY-l*n.pivot.y),g=n.visible?"visible":"hidden",u.style.width=o+"px",u.style.height=l+"px",u.style.left=v+"px",u.style.top=y+"px",u.style.opacity=n.opacity,s="rotate("+n.rotateAngle+"deg) ",nt=n.pivot?n.pivot.x*100+"% "+n.pivot.y*100+"%":"50% 50%",u.style.webkitTransform=s,u.style.MozTransform=s,u.style.OTransform=s,u.style.msTransform=s,u.style.transform=s,u.style["transform-origin"]=u.style["ms-transform-origin"]=u.style["webkit-transform-origin"]=u.style["o-transform-origin"]=u.style["moz-transform-origin"]=nt,u.style.visibility=g,a=0;a<k.length;a++)f=k[a],h=u.childNodes[a],h&&(e=h.childNodes[0],(f.text||e.textContent)&&(w=o>f.width?o:f.width,f.margin.left&&f.margin.right&&(w-=(f.margin.left||0)+(f.margin.right||0)),f.margin.top&&f.margin.bottom&&(tt-=(f.margin.top||0)+(f.margin.bottom||0)),h.style.height=tt+"px",h.style.width=w+"px",e.textContent=f.text,(f.horizontalAlignment=="stretch"||f.verticalAlignment=="stretch")&&(b=this._rotateLabel(o,l,f),f.horizontalAlignment=="stretch"&&(e.style.width=Math.abs(b.x)+"px"),f.verticalAlignment=="stretch"&&(e.style.alignItems="center",e.style.display="flex",e.style.justifyContent="center",e.style.height=Math.abs(b.y)+"px")),this._alignTextOnLabel(n,c,e,h,f,r)))}},_alignTextOnPhase:function(n,i,r,u,f){var o,e,s,h;f.getElementById(n.name)&&(o=f.getElementById(n.name).getBoundingClientRect());o&&(e=r.getBBox(),s=f.getElementById(n.name+"_"+u.name+"_lblbg"),r.setAttribute("transform","translate("+-e.width/2+",50), rotate(0,0,0)"),r.setAttribute("pointer-events","auto"),s&&(h={width:e.width,height:e.height,fill:u.fillColor,stroke:u.borderColor,"stroke-width":u.borderWidth,transform:"translate("+-e.width+","+o.top+"), rotate(0,0,0)"},t.datavisualization.Diagram.Util.attr(s,h)))},updateLabel:function(i,r,u,f){var e,a;if(typeof r.text=="string"){var o,v,h,s,c,l=t.datavisualization.Diagram.Util.bounds(i),y=u.document.parentNode.getElementsByClassName("htmlLayer")[0]||f._htmlLayer,p=n(y).children("#"+i.name)[0];i.segments?(s=l.width,c=l.height):(s=i.width?i.width:i._width,c=i.height?i.height:i._height);o=n(p).children("#"+i.name+"_"+r.name+"_lblbg")[0];o&&(e=o.childNodes[0],h=s>r.width?s:r.width,r.margin.left&&r.margin.right&&(h-=(r.margin.left||0)+(r.margin.right||0)),r.margin.top&&r.margin.bottom&&(v-=(r.margin.top||0)+(r.margin.bottom||0)),o.style.height=v+"px",o.style.width=h+"px",e.textContent=r.text,e.style.opacity=r.opacity,(r.horizontalAlignment=="stretch"||r.verticalAlignment=="stretch")&&(a=this._rotateLabel(s,c,r),r.horizontalAlignment=="stretch"&&(e.style.width=Math.abs(a.x)+"px"),r.verticalAlignment=="stretch"&&(e.style.alignItems="center",e.style.display="flex",e.style.justifyContent="center",e.style.height=Math.abs(a.y)+"px")),i.type!="node"||i.width||i.height||this.updateNode(i,u,f),this._alignTextOnLabel(i,l,e,o,r,f))}},_alignTextOnLabel:function(n,i,r,u,f,e){var c,p,w,h,v,y,b;if(n.segments&&f.relativeMode=="segmentpath"){var k=this._getConnectorHandlePosition(f,n,1,e),d=k.position,h={x:(d.x-i.x)/i.width,y:(d.y-i.y)/i.height},g=t.datavisualization.Diagram.Util._alignLabelOnSegments(n,f,e,k);w=g.vAlign;p=g.hAlign}else h={x:f.offset.x,y:f.offset.y},p=f.horizontalAlignment,w=f.verticalAlignment;r.style["pointer-events"]=t.datavisualization.Diagram.Util.canEnablePointerEvents(n,e)?e&&e.activeTool&&e.activeTool.name==="move"&&e.activeTool.inAction?"none":"all":"none";v=n.width?n.width:n._width;y=n.height?n.height:n._height;v-=f.margin.left+f.margin.right;y-=f.margin.top+f.margin.bottom;c={x:v,y:y};f.rotateAngle&&(b=t.Matrix.identity(),t.Matrix.rotate(b,f.rotateAngle,h.x,h.y),c=t.Matrix.transform(b,{x:v,y:y}));var o=0,s=0,l,a,nt=t.datavisualization.Diagram.Util.canMoveLabel(n);f.wrapping==t.datavisualization.Diagram.TextWrapping.NoWrap?(r.style.whiteSpace="nowrap",r.style.wordWrap="normal",r.style.maxWidth="",r.style.maxHeight=""):(r.style.whiteSpace=f.textAlign!="justify"?"pre-wrap":"pre-line",f.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap?(r.style.wordBreak="break-all",r.style.wordWrap="break-word",n.segments?r.style.maxWidth=Math.abs(f.width)+"px":(Math.abs(c.x)<f.width&&(c.x=f.width),r.style.maxWidth=Math.abs(c.x)+"px",r.style.maxHeight=Math.abs(c.y)+"px")):(r.style.wordWrap="break-word",r.style.maxWidth="",r.style.maxHeight=""));switch(p){case t.datavisualization.Diagram.HorizontalAlignment.Left:o="0%";l=f.margin.left+"px";break;case t.datavisualization.Diagram.HorizontalAlignment.Center:o="-50%";l=f.margin.left-f.margin.right+"px";break;case t.datavisualization.Diagram.HorizontalAlignment.Right:o="-100%";l=-f.margin.right+"px";break;case t.datavisualization.Diagram.HorizontalAlignment.Stretch:o="-50%"}switch(w){case t.datavisualization.Diagram.VerticalAlignment.Top:s="0%";a=f.margin.top+"px";break;case t.datavisualization.Diagram.VerticalAlignment.Center:s="-50%";a=f.margin.top-f.margin.bottom+"px";break;case t.datavisualization.Diagram.VerticalAlignment.Bottom:s="-100%";a=-f.margin.bottom+"px";break;case t.datavisualization.Diagram.VerticalAlignment.Stretch:s="-50%"}f.margin.left&&f.margin.right&&f.margin.top&&f.margin.bottom&&!n._isClassifier&&!n._isClassMember?(r.style.marginLeft=l,r.style.marginTop=a):(u.style.marginLeft=l,u.style.marginTop=a);h.x*=100;h.y*=100;r.style.textAlign=f.textAlign;r.style.webkitTransform="translate("+o+", "+s+") rotate("+f.rotateAngle+"deg)";r.style.MozTransform="translate("+o+", "+s+") rotate("+f.rotateAngle+"deg)";r.style.OTransform="translate("+o+", "+s+") rotate("+f.rotateAngle+"deg)";r.style.msTransform="translate("+o+", "+s+") rotate("+f.rotateAngle+"deg)";r.style.transform="translate("+o+", "+s+") rotate("+f.rotateAngle+"deg)";r.style.left="0px";r.style.top="0px";u&&(u.style.left=h.x+"%",u.style.top=h.y+"%")},_rotateLabel:function(n,i,r){var f={x:n,y:i},u;return r.rotateAngle&&(u=t.Matrix.identity(),t.Matrix.rotate(u,r.rotateAngle,0,0),f=t.Matrix.transform(u,{x:n,y:i})),f},_renderLabelsAsSvg:function(n,t,i){var u=t.document.getElementById(n.name),r;if(n.type=="text")this._renderTextElementAsSvg(n,n.textBlock,u,t,i);else for(r=0;r<n.labels.length;r++)this._renderTextElementAsSvg(n,n.labels[r],u,t,i)},_renderTextElementAsSvg:function(n,i,r,u,f){var o={id:n.name+"_"+i.name,"class":"ej-d-label","font-family":i.fontFamily,"font-size":i.fontSize,fill:i.fontColor,"text-decoration":i.textDecoration,"dominant-baseline":"middle","pointer-events":"none"},e,h,s;(i.bold&&(o["font-weight"]="bold"),i.italic&&(o["font-style"]="italic"),e=u.text(o),e.textContent=i.text,o={id:n.name+"_"+i.name+"_lblbg",fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth,transform:"translate(0,0)"},h=u.rect(o),i.text)&&(r.appendChild(e),r.insertBefore(h,e),s=t.datavisualization.Diagram.Util.bounds(n),this._wrapText(n,s,e,i,u),this._alignTextOnSvgLabel(n,s,e,i,u,f))},_alignTextOnSvgLabel:function(n,i,r,u,f,e){var a=r.getBBox(),c=t.datavisualization.Diagram.Util._getLabelPosition(u,i),o=this._adjustOffsetWithTextBounds(n,u,r,c,a,i,e),s=u.borderWidth||0,v,l,h,y;r.setAttribute("transform","translate("+(o.x+s)+","+(o.y+s)+"), rotate("+u.rotateAngle+","+(c.x-o.x)+","+(c.y-o.y)+")");v=f.getElementById(n.name+"_"+u.name+"_lblbg");v&&(l=o.x+a.x,h=o.y,t.browserInfo().name==="mozilla"&&(h=o.y+u.fontSize/2),l=l+s/2,h=h+s/2,y={width:a.width+s,height:a.height+s,transform:"translate("+l+","+h+"), rotate("+u.rotateAngle+","+(c.x-l)+","+(c.y-h)+")",fill:u.fillColor?u.fillColor:"transparent",stroke:u.borderColor,"stroke-width":u.borderWidth},t.datavisualization.Diagram.Util.attr(v,y))},_adjustOffsetWithTextBounds:function(n,i,r,u,f,e,o){var s={x:0,y:0},v=0,h,l,a;if(n.segments&&typeof i.offset!="object"){var y=this._getConnectorHandlePosition(i,n,1,o),p=y.position,c={x:(p.x-e.x)/e.width,y:(p.y-e.y)/e.height};c=t.datavisualization.Diagram.Util._getLabelPosition(i,e,c);u.x=c.x;u.y=c.y;a=t.datavisualization.Diagram.Util._alignLabelOnSegments(n,i,o,y);l=a.hAlign;h=a.vAlign}else l=i.horizontalAlignment,h=i.verticalAlignment;if(v=h==t.datavisualization.Diagram.VerticalAlignment.Top?u.y:h==t.datavisualization.Diagram.VerticalAlignment.Center?u.y-f.height/2:u.y-f.height,s.y=v,i.textAlign=="justify")s.x=r.childNodes.length>1?u.x-n.width/2:u.x;else switch(l){case t.datavisualization.Diagram.HorizontalAlignment.Left:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:s.x=u.x;break;case t.datavisualization.Diagram.TextAlign.Center:s.x=u.x+f.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:s.x=u.x+f.width}break;case t.datavisualization.Diagram.HorizontalAlignment.Center:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:s.x=u.x-f.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:s.x=u.x;break;case t.datavisualization.Diagram.TextAlign.Right:s.x=u.x+f.width/2}break;case t.datavisualization.Diagram.HorizontalAlignment.Right:switch(i.textAlign){case t.datavisualization.Diagram.TextAlign.Left:s.x=u.x-f.width;break;case t.datavisualization.Diagram.TextAlign.Center:s.x=u.x-f.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:s.x=u.x}}return(n.segments||n._type=="group")&&(s.x=s.x+e.x,s.y=s.y+e.y,u.x+=e.x,u.y+=e.y),t.browserInfo().name==="mozilla"&&(s.y=s.y-i.fontSize/2),s},_wrapText:function(n,t,i,r,u){for(var b=r.text,e,y,c,f,s,k,o,p,h,a,l,v,w;i.hasChildNodes();)i.removeChild(i.lastChild);if(n.segments?(e=t.width,y=t.height):(e=t.width-r.margin.left-r.margin.right,y=t.height-r.margin.top-r.margin.bottom),e=e<r.width?r.width:e,c=b.split("\n"),k="",u.getElementById(i.id)&&(o=u.getElementById(i.id).childNodes),o){for(a=r.wrapping=="wrapwithoverflow"?!0:!1,s=0;s<c.length;s++)if(f=u.tspan(),f.style.fontSize=r.fontSize,i.appendChild(f),r.wrapping!="nowrap")for(l=r.wrapping=="wrapwithoverflow"?c[s].split(" "):c[s],h=0;h<l.length;h++)f.textContent+=(v&&a?" ":"")+l[h],p=o[o.length-1].getComputedTextLength(),p>=e?h==l.length-1||(f=u.tspan(),i.appendChild(f)):a&&(v=f.textContent,f.textContent+=l[h+1]||"",w=o[o.length-1].getComputedTextLength(),f.textContent=v,w>e&&(f=u.tspan(),i.appendChild(f)));else f.textContent+=c[s];this._wrapTextAlign(i,o,r.fontSize,r.textAlign,n)}},_wrapTextAlign:function(n,i,r,u,f){for(var l,a,o,h,c,e,s=0;s<i.length;s++){u=="justify"&&s!=i.length-1?(e=i[s].textContent,e[e.length-1]==" "&&(e=e.slice(0,e.length-1)),e[0]==" "&&(e=e.slice(1,e.length)),i[s].textContent=e,o=i[s].getComputedTextLength(),h=f.width-o,c=h/(e.split(" ").length-1),i[s].setAttribute("word-spacing",c+"px"),o=i[s].getComputedTextLength()):o=i[s].getComputedTextLength();u=="justify"&&(u=i.length>1?"left":"center");switch(u){case"left":o=0;break;case"center":o=-o/2;break;case"right":o=-o}l={x:Number(o),dy:r};a=i[s];t.datavisualization.Diagram.Util.attr(a,l)}},_renderPorts:function(n,t,i){for(var e,u=n.ports,f,r=0,o=u.length;r<o;++r)f=u[r],e=this._renderPort(n,f,t),i.appendChild(e)},_renderPort:function(n,i,r){var o,u,s,e=t.datavisualization.Diagram.Size(i.size,i.size),f,h,c,l,a;s=i.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||i.visibility&t.datavisualization.Diagram.PortVisibility.Hover||i.visibility&t.datavisualization.Diagram.PortVisibility.Connect?"hidden":"visible";f=n._type==="group"?t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!1):t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!0);n._type==="group"&&n.rotateAngle&&(h=t.Matrix.identity(),t.Matrix.rotate(h,n.rotateAngle,n.offsetX,n.offsetY),f=t.Matrix.transform(h,f),i._absolutePoint=f);switch(i.shape){case"x":c=this._constructX(f,i.size);u={id:n.name+"_"+i.name,"class":"ej-d-port",fill:i.fillColor,visibility:s,stroke:i.borderColor,"stroke-width":i.borderWidth,d:c};this._addCssClass(i,u);o=r.path(u);break;case"circle":l=e.width/2;a=e.height/2;u={id:n.name+"_"+i.name,"class":"ej-d-port",rx:l,ry:a,visibility:s,cx:f.x,cy:f.y,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth};this._addCssClass(i,u);o=r.ellipse(u);break;case"square":u={id:n.name+"_"+i.name,"class":"ej-d-port",x:f.x-i.size/2,visibility:s,y:f.y-i.size/2,width:e.width,height:e.height,fill:i.fillColor,stroke:i.borderColor,"stroke-width":i.borderWidth};this._addCssClass(i,u);o=r.rect(u);break;case"path":var v=e.width,y=e.height,c=i._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(f.x-i.size/2,f.y-i.size/2,v,y,i.pathData,r),u={id:n.name+"_"+i.name,width:v,height:y,d:c,stroke:i.borderColor,"stroke-width":i.borderWidth,fill:i.fillColor,visibility:s};this._addCssClass(i,u);o=r.path(u)}return o},_insertPort:function(n,i,r){var f,u;f=document.getElementById(n.name);u=t.datavisualization.Diagram.SvgContext._renderPort(n,i,r);f.appendChild(u);(i.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||i.visibility&t.datavisualization.Diagram.PortVisibility.Hover||i.visibility&t.datavisualization.Diagram.PortVisibility.Connect)&&u.setAttribute("visibility","hidden")},_updatePort:function(n,i,r){var e=t.datavisualization.Diagram.Size(i.size,i.size),u=null,f,s,o,h,c;u=n._type==="group"?t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!1):t.datavisualization.Diagram.Util._getPortPosition(i,t.datavisualization.Diagram.Util.bounds(n,!0),!0);f=n.name+"_"+i.name;n._type==="group"&&n.rotateAngle&&(s=t.Matrix.identity(),t.Matrix.rotate(s,n.rotateAngle,n.offsetX,n.offsetY),u=t.Matrix.transform(s,u),i._absolutePoint=u);switch(i.shape){case"x":o=this._constructX(u,i.size);r.path({id:f,d:o});break;case"circle":h=e.width/2;c=e.height/2;n.type==="group"?r.ellipse({id:f,rx:h,ry:c,cx:0,cy:0,transform:"rotate("+n.rotateAngle+","+u.x+","+u.y+"),translate("+u.x+","+u.y+")"}):r.ellipse({id:f,rx:h,ry:c,cx:u.x,cy:u.y});break;case"square":n.type==="group"?r.rect({id:f,x:0,y:0,transform:"rotate("+n.rotateAngle+","+u.x+","+u.y+"),translate("+(u.x-i.size/2)+","+(u.y-i.size/2)+")"}):r.rect({id:f,x:u.x-i.size/2,y:u.y-i.size/2});break;case"path":var a=e.width,v=e.height,o=i._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(u.x-i.size/2,u.y-i.size/2,a,v,i.pathData,r),l={id:f,d:o};n.type==="group"&&(l={id:f,d:o,transform:"rotate("+n.rotateAngle+","+u.x+","+u.y+")"});r.path(l)}},_updatePorts:function(n,t){for(var u,r=n.ports,i=0,f=r.length;i<f;++i)u=r[i],this._updatePort(n,u,t)},_constructX:function(n,i){var r=new t.datavisualization.Diagram.Path;return r.moveTo(n.x-i/2,n.y-i/2),r.lineTo(n.x+i/2,n.y+i/2),r.moveTo(n.x+i/2,n.y-i/2),r.lineTo(n.x-i/2,n.y+i/2),r.toString()},_enableSelectedNode:function(t,i,r){var f,u,l,e,a,o,s,h,c;if(t){if(t.type=="pseudoGroup")for(f=t.children,u=0,l=f.length;u<l;u++)e=r.nameTable[r._getChild(f[u])],e&&this._enableSelectedNode(e,i,r);else a={id:t.name,"pointer-events":"auto",style:"pointer-events:block"},t.segments&&(o=i.document.getElementById(t.name+"_hitTest"),o&&o.setAttribute("pointer-events",t.visible?"stroke":"none")),i.g(a);t&&t.type==="html"&&(s=r._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s&&(h=n(s).find("#"+t.name+"_parentdiv")[0]),h&&(h.style.pointerEvents="all"));r._adornerSvg&&(c=r._adornerSvg.document.getElementById(r._adornerSvg.document.id+"handle_g"),c&&c.setAttribute("pointer-events","visible"));n(".ej-d-seperator").css("pointer-events","stroke");n(".e-resize").css("pointer-events","visible")}},_disableSelectedNode:function(t,i,r){var f,u,c,e,l,a,o,s,h;if(t){if(t.type=="pseudoGroup")for(f=t.children,u=0,c=f.length;u<c;u++)e=r.nameTable[r._getChild(f[u])],e&&this._disableSelectedNode(e,i,r);else l={id:t.name,style:"pointer-events:none","pointer-events":"none"},t.segments&&(a=i.document.getElementById(t.name+"_hitTest"),a.setAttribute("pointer-events","none")),i.g(l);r._adornerSvg&&(o=r._adornerSvg.document.getElementById(r._adornerSvg.document.id+"handle_g"),o&&o.setAttribute("pointer-events","none"));t&&t.type==="html"&&(s=r._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],s&&(h=n(s).find("#"+t.name+"_parentdiv")[0]),h&&(h.style.pointerEvents="none"));n(".e-resize").css("pointer-events","none");n(".ej-d-seperator").css("pointer-events","none")}},_drawStackHighlighter:function(n,i,r,u,f,e){var c,s=[],o=t.datavisualization.Diagram.Util.bounds(n);e?f.y>=o.y&&f.y<o.center.y?(s.push({x:o.topLeft.x*u-5,y:o.topLeft.y*u-5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.topLeft.x*u-5,y:o.topLeft.y*u+5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.topRight.x*u+5,y:o.topRight.y*u-5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.topRight.x*u+5,y:o.topRight.y*u+5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u})):(s.push({x:o.bottomLeft.x*u-5,y:o.bottomLeft.y*u-5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u-5,y:o.bottomLeft.y*u+5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u+5,y:o.bottomRight.y*u-5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u+5,y:o.bottomRight.y*u+5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u})):f.x>=o.x&&f.x<o.center.x?(s.push({x:o.topLeft.x*u-5,y:o.topLeft.y*u-5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.topLeft.x*u+5,y:o.topLeft.y*u-5}),s.push({x:o.topLeft.x*u,y:o.topLeft.y*u}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u-5,y:o.bottomLeft.y*u+5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u+5,y:o.bottomLeft.y*u+5}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u}),s.push({x:o.bottomLeft.x*u,y:o.bottomLeft.y*u})):(s.push({x:o.topRight.x*u-5,y:o.topRight.y*u-5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.topRight.x*u+5,y:o.topRight.y*u-5}),s.push({x:o.topRight.x*u,y:o.topRight.y*u}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u-5,y:o.bottomRight.y*u+5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u+5,y:o.bottomRight.y*u+5}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}),s.push({x:o.bottomRight.x*u,y:o.bottomRight.y*u}));var c=this._convertToSVGPoints(s),l={id:"nodeHighlighter",points:c,fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none",style:"pointer-events: none"},h=i.polyline(l);return r.appendChild(h),h},_drawNodeHighlighter:function(n,i,r,u){var f,e=n.width?n.width:n._width,o=n.height?n.height:n._height,h=n.offsetX-e*n.pivot.x,c=n.offsetY-o*n.pivot.y,s=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),l="rotate("+n.rotateAngle+","+s.x*u+","+s.y*u+")",a=n.isLane||n.isSwimlane?"red":"#0dc923",v={id:"nodeHighlighter","class":"ej-d-node",x:h*u,y:c*u,width:e*u,height:o*u,fill:"transparent",stroke:a,"stroke-width":2,"pointer-events":"none",transform:l,style:"pointer-events: none"};return f=i.rect(v),r.appendChild(f),f},_drawNavigationHighlighter:function(n,t,i,r){var u={id:"nodeHighlighter",x:n.x*r,y:n.y*r,width:n.width*r,height:n.height*r,fill:"transparent",stroke:"black","stroke-dasharray":"2 2","shape-rendering":"crispEdges",style:"pointer-events: none"};i.appendChild(t.rect(u))},_removeNodeHighlighter:function(n,t){var i=n.getElementById("nodeHighlighter");i&&n.removeChild(i,t)},_drawPortHighlighter:function(n,i,r,u,f){var l,o,e,h,c,a,d=i.width?i.width:i._width,g=i.height?i.height:i._height,s,v="#8CC63F",w="#1A1A1A",b=.5,y,p,k;return n?(o=t.datavisualization.Diagram.Size(n.size*2,n.size*2),e=t.datavisualization.Diagram.Util._getPortPosition(n,t.datavisualization.Diagram.Util.bounds(i,!0)),p=t.Matrix.identity(),t.Matrix.rotate(p,i.rotateAngle,i.offsetX,i.offsetY),e=t.Matrix.transform(p,e),h=(e.x-n.size)*f,c=(e.y-n.size)*f,a="rotate(0,"+(h+o.width/2)+","+(c+o.height/2)+")"):(s=t.datavisualization.Diagram.Util.bounds(i,!0),o=t.datavisualization.Diagram.Size(s.width,s.height),e=t.datavisualization.Diagram.Point(s.x,s.y),h=e.x*f,c=e.y*f,w=v,v="transparent",b=2,y=t.datavisualization.Diagram.Point(i.offsetX,i.offsetY),a="rotate("+i.rotateAngle+","+y.x*f+","+y.y*f+")"),k={id:"portHighlighter","class":"ej-d-port",x:h,y:c,width:o.width*f,height:o.height*f,fill:v,stroke:w,"stroke-width":b,"pointer-events":"none",transform:a},l=r.rect(k),u.appendChild(l),l},_drawConnectorHighlighter:function(n,t,i){var u=t._adornerSvg,r=u.g({id:"connector_highlighter",visibility:"visible",transform:"scale("+i+")"});t._adornerLayer.appendChild(r);var f=this._findPath(n,t),e={id:"highlighter_segments",d:f,fill:"none",stroke:"#0dc923","stroke-width":n.lineWidth,"pointer-events":"none"},o=u.path(e);return r.appendChild(o),r},_removeConnectorHighlighter:function(n,t){var i=t.getElementById("connector_highlighter");i&&n.removeChild(i)},_removePortHighlighter:function(n,t){var i=n.getElementById("portHighlighter");i&&n.removeChild(i,t)},_renderPhaseResize:function(n,i,r,u,f){var s,e=[],l="",a=!1,v=!1,o=t.datavisualization.Diagram.Util.bounds(n),c,h;s;e=[];e.push({x:o.topLeft.x*r,y:o.topLeft.y*r});e.push({x:o.bottomLeft.x*r,y:o.bottomLeft.y*r});s=this._convertToSVGPoints(e);h={id:"w-resize",points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none"};c=i.polyline(h);f.appendChild(c);s;e=[];e.push({x:o.topLeft.x*r,y:o.topLeft.y*r});e.push({x:o.topRight.x*r,y:o.topRight.y*r});s=this._convertToSVGPoints(e);h={id:"n-resize",points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":"none"};c=i.polyline(h);f.appendChild(c);l="";n.orientation=="vertical"&&(l="e-resize",v=!0);s;e=[];e.push({x:o.topRight.x*r,y:o.topRight.y*r});e.push({x:o.bottomRight.x*r,y:o.bottomRight.y*r});s=this._convertToSVGPoints(e);v&&(h={id:"e-resize-hitTest","class":l,points:s,fill:"transparent",stroke:"transparent","stroke-width":10,"pointer-events":v?"stroke":"none"},c=i.polyline(h),f.appendChild(c));h={id:"e-resize","class":l,points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":v?"stroke":"none"};c=i.polyline(h);f.appendChild(c);l="";n.orientation=="horizontal"&&(l="s-resize",a=!0);s;e=[];e.push({x:o.bottomLeft.x*r,y:o.bottomLeft.y*r});e.push({x:o.bottomRight.x*r,y:o.bottomRight.y*r});s=this._convertToSVGPoints(e);a&&(h={id:"s-resize-hitTest","class":l,points:s,fill:"transparent",stroke:"transparent","stroke-width":10,"pointer-events":a?"stroke":"none"},c=i.polyline(h),f.appendChild(c));h={id:"s-resize","class":l,points:s,"stroke-dasharray":"3,3",fill:"transparent",stroke:"red","stroke-width":2,"pointer-events":a?"stroke":"none"};c=i.polyline(h);f.appendChild(c)},renderSelector:function(t,i,r,u,f,e){var s,h,o,c;n(".phaseSelector").remove();s=t.width?t.width:t._width;h=t.height?t.height:t._height;t.segments?(o=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible"}),r.appendChild(o),this._renderEndPointHandle(t,i,u)):t.type!="phase"?t.isLane||t.isSwimlane?(o=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible"}),r.appendChild(o),this._renderPhaseResize(t,i,u,f,o,e)):(o=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible",transform:"translate("+(t.offsetX-s*t.pivot.x)*u+","+(t.offsetY-h*t.pivot.y)*u+"),rotate("+t.rotateAngle+","+s*t.pivot.x*u+","+h*t.pivot.y*u+")"}),r.appendChild(o),this._renderResizeHandle(t,i,u,f)):t.type=="phase"&&e&&(o=i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible",transform:"translate("+e.x*u+","+e.y*u+"),rotate(0,"+e.width/2*u+","+e.height/2*u+")"}),i.document.getElementById(i.document.id+"handle_g")||r.appendChild(o),c=i.rect({id:"phaseSelector","class":"phaseSelector","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:e.width<0?1:e.width*u,height:e.height<0?1:e.height*u,fill:"transparent",stroke:"red"}),o.appendChild(c))},_renderResizeHandle:function(n,i,r,u){var f=n.width?n.width:n._width,e=n.height?n.height:n._height,s=n.pivot,o=t.datavisualization.Diagram.Point(f*s.x,-20/r);u&t.datavisualization.Diagram.SelectorConstraints.Rotator&&n.type!="umlclassifier"&&(this._renderPivotLine(n,i,r),this._renderRotateThumb("rotateHandle",n,o.x,o.y,r,i));u&t.datavisualization.Diagram.SelectorConstraints.Resizer&&(this._renderResizeBorder("resizeBorder",n,i,r),n.type!="umlclassifier"&&(this._renderResizeCorner("nw-resize",n,0,0,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest)),this._renderResizeCorner("n-resize",n,f/2*r,0,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorth)),this._renderResizeCorner("ne-resize",n,f*r,0,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast)),this._renderResizeCorner("w-resize",n,0,e/2*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeWest)),this._renderResizeCorner("e-resize",n,f*r,e/2*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeEast)),this._renderResizeCorner("sw-resize",n,0,e*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest)),this._renderResizeCorner("s-resize",n,f/2*r,e*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouth)),this._renderResizeCorner("se-resize",n,f*r,e*r,i,!(n.constraints&t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast))))},renderUserHandles:function(n,t,i,r,u,f,e){var h,s,o;if(t&&(t.type==="phase"&&e&&(h=e._getPhaseBounds(t)),n.length))for(s=i.g({id:i.document.id+"userHandle_g","class":"userHandle","pointer-events":"visible"}),f.appendChild(s),o=0;o<n.length;o++)(r&&n[o].enableMultiSelection||!r)&&this._renderUserHandle(n[o],t,i,u,s,h,e)},_renderUserHandle:function(n,i,r,u,f,e,o){var s,w=this._getHandlePosition(n,i,u,e,o),l=w.x*u,a=w.y*u,g=this._getHandleShape(n,l,a),k,v,y,it,d,c,h,p;n._size=n.size;var nt=f.appendChild(r.circle(g)),tt={id:n.name+"_title"},b=r.title(tt);b.innerHTML=n.name;nt.appendChild(b);switch(n.shape){case"path":k=n._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(0,0,n.size/2,n.size/2,n.pathData,r);s=this._getHandleIcon(n,l-n.size/4,a-n.size/4);s.d=k;f.appendChild(r.path(s));break;case"image":s=this._getHandleIcon(n,l-n.size/4,a-n.size/4);s.preserveAspectRatio="none";v=new Image;v.src=n.source;y=r.image(s);y.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",v.src);f.appendChild(y);break;case"native":it=n.visible?"visible":"hidden";s=this._getHandleIcon(n,l-n.size/4,a-n.size/4);d=o._renderEjTemplate("#"+n.templateId,n);c=document.createElement("div");c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg"><g id="tempNative">'+d+"<\/g><\/svg>";document.body.appendChild(c);h=document.getElementById("tempNative").cloneNode(!0);h.id=n.name+"_shape";f.appendChild(h);var e=h.getBBox(),rt=s.width,ut=s.height,ft=e.width?rt/e.width:1,et=e.height?ut/e.height:1;h.setAttribute("transform","scale("+ft+","+et+")");c.parentNode.removeChild(c);p=r.g(s);p.appendChild(h);f.appendChild(p)}},_getHandleIcon:function(n,t,i){var r=n.visible?"visible":"hidden";return{id:n.name+"_icon","class":"userHandle-icon",fill:n.pathColor,transform:"translate("+t+","+i+")",visibility:r,width:n.size/2,height:n.size/2}},_getHandlePosition:function(n,i,r,u,f){var o,s,e;if(i){if(i.segments&&n.offset)return this._getConnectorHandlePosition(n,i,r,f).position;o=t.datavisualization.Diagram.Point();s=i.type==="phase"&&u?t.datavisualization.Diagram.Util.bounds(u):t.datavisualization.Diagram.Util.bounds(i);var l=n.position,h=10,c=t.Matrix.identity();i.rotateAngle&&t.Matrix.rotate(c,i.rotateAngle);e=new t.datavisualization.Diagram.Point;switch(l){case"topleft":e=t.Matrix.transform(c,t.datavisualization.Diagram.Point(h+n.size/2,h+n.size/2));o.x=s.topLeft.x-e.x/r;o.y=s.topLeft.y-e.y/r;break;case"topcenter":e=t.Matrix.transform(c,t.datavisualization.Diagram.Point(0,h+n.size/2));o.x=s.topCenter.x-e.x/r;o.y=s.topCenter.y-e.y/r;break;case"topright":e=t.Matrix.transform(c,t.datavisualization.Diagram.Point(h+n.size/2,h/2-n.size));o.x=s.topRight.x+e.x/r;o.y=s.topRight.y+e.y/r;break;case"middleleft":e=t.Matrix.transform(c,t.datavisualization.Diagram.Point(-(h+n.size/2),0));o.x=s.middleLeft.x+e.x/r;o.y=s.middleLeft.y+e.y/r;break;case"middleright":e=t.Matrix.transform(c,t.datavisualization.Diagram.Point(h+n.size/2,0));o.x=s.middleRight.x+e.x/r;o.y=s.middleRight.y+e.y/r;break;case"bottomleft":e=t.Matrix.transform(c,t.datavisualization.Diagram.Point(-(h+n.size/2),h+n.size/2));o.x=s.bottomLeft.x+e.x/r;o.y=s.bottomLeft.y+e.y/r;break;case"bottomcenter":e=t.Matrix.transform(c,t.datavisualization.Diagram.Point(0,h/2-n.size));o.x=s.bottomCenter.x-e.x/r;o.y=s.bottomCenter.y-e.y/r;break;case"bottomright":e=t.Matrix.transform(c,t.datavisualization.Diagram.Point(h+n.size/2,h+n.size/2));o.x=s.bottomRight.x+e.x/r;o.y=s.bottomRight.y+e.y/r}return o}},_getConnectorHandlePosition:function(n,i,r,u){var e=t.datavisualization.Diagram.Util._findOffsetOnConnector(i,n,n.segmentOffset,u),o=e.segment,s=e.point,c=e.offset,a=i.segments[o],l=i.segments[o].points[s],f=t.datavisualization.Diagram.Geometry.findAngle(l,i.segments[o].points[s+1]),h;return n.alignment&&n.alignment!="auto"?(n.offset==1&&(f+=180),{position:t.datavisualization.Diagram.Geometry.transform(e.offset,n.offset!=0&&n.offset!=1?f+45:f,this._getAlignedPosition(i,n)),angle:f}):(h=this._avoidOverlapWithSourceAndTarget(i,n.offset,n.size,e.offset,f,o,s,u),c={position:h.position,angle:n.offset==1?(180+f)%360:f,direction:h.direction},c)},_getAlignedPosition:function(n,t){var i=t.text===undefined?10:0;switch(t.alignment){case"center":return 0;case"before":return-((t.size||0)/2+i);case"after":return(t.size||0)/2+i}return 0},_avoidOverlapWithSourceAndTarget:function(n,i,r,u,f,e,o,s){var y,p,w=u,nt=n.segments[e],h=90,l,k,c;if(i==0?(y=n.segments[e].points[o+2]?n.segments[e].points[o+2]:n.segments[e+1]?n.segments[e+1].points[1]:null,y&&(p=t.datavisualization.Diagram.Geometry.findAngle(n.segments[e].points[o],y)),n.sourceNode&&(h=45)):i==1&&(y=n.segments[e].points[o-1]?n.segments[e].points[o-1]:n.segments[e-1]?n.segments[e-1][n.segments[e].points.length-2]:null,y&&(p=t.datavisualization.Diagram.Geometry.findAngle(n.segments[e].points[o+1],y)),f+=180,f%=360,n.targetNode&&(h=45)),y)if(f%90==0)p>270&&f==0&&(f=360),f==90?p<f?(f+=h,l="right"):(f-=h,l="left"):f==270?p<f?(f+=h,l="left"):(f-=h,l="right"):f==180?p<f?(f+=h,l="bottom"):(f-=h,l="top"):p<f?(f+=h,l="top"):(f-=h,l="bottom"),w=t.datavisualization.Diagram.Geometry.transform(w,f,r!=undefined?Math.max(5,r/2+10):0);else{var d=45,a=135,b=225,g=315,v;(i==0&&n.sourceNode||i==1&&n.targetNode)&&(k=i==0&&n.sourceNode?s.nameTable[n.sourceNode]:s.nameTable[n.targetNode],k&&(v=t.datavisualization.Diagram.Util.bounds(k)),v&&(c=180/(2+2/(v.height/v.width)),d=c,a=180-c,b=a+2*c,g=360-c));h=f>=d&&f<=a||f>=b&&f<=g?f%180>90?-h:h:f>a&&f<b?f>180?-45:45:f>0?-45:45;w=t.datavisualization.Diagram.Geometry.transform(w,f+h,r!=undefined?Math.max(5,r/2+10):0)}else{var d=45,a=135,b=225,g=315,v;(i==0&&n.sourceNode||i==1&&n.targetNode)&&(k=i==0&&n.sourceNode?s.nameTable[n.sourceNode]:s.nameTable[n.targetNode],k&&(v=t.datavisualization.Diagram.Util.bounds(k)),v&&(c=180/(2+2/(v.height/v.width)),d=c,a=180-c,b=a+2*c,g=360-c));h=f>=d&&f<=a||f>=b&&f<=g?f%180>90?-h:h:f>a&&f<b?f>180?-45:45:f<=d?-45:45;f+=360;f%=360;w=t.datavisualization.Diagram.Geometry.transform(w,f+h,r!=undefined?Math.max(5,r/2+(Math.abs(h%45)>0?13:10)):0)}return{position:w,direction:l}},_getHandleShape:function(n,t,i){var r=n.visible?"visible":"hidden";return{id:n.name+"_shape","class":"userHandle",cx:t,cy:i,r:n.size/2,fill:n.backgroundColor,stroke:n.borderColor,"stroke-width":n.borderWidth||0,visibility:r}},_updateHandleShape:function(n,t,i,r){var u=n.visible?"visible":"hidden",f={id:n.name+"_shape",cx:t,cy:i,r:n.size/2,fill:n.backgroundColor,stroke:n.borderColor,"stroke-width":n.borderWidth||0,visibility:u};r.circle(f)},_updateHanleIcon:function(n,t,i,r,u){var f=n.visible?"visible":"hidden",e={id:n.name+"_icon",d:t,fill:n.pathColor,transform:"translate("+r+","+u+")",visibility:f};i.path(e)},_getHanleIcon:function(n,t){return{id:n.name,d:t,stroke:n.borderColor,"stroke-width":n.borderWidth,fill:n.fillColor}},renderPivotPoint:function(n,i,r){var u=n.width*n.pivot.x,f=n.height*n.pivot.y;r.getElementById("pivot")?t.datavisualization.Diagram.SvgContext._updateResizeCorner("pivot",u*i,f*i,r):t.datavisualization.Diagram.SvgContext._renderResizeCorner("pivot",n,u*i,f*i,r,undefined,4);this._updatePivotLine(n,r,i,!0)},_removePivotPoint:function(n,t,i){var r=t.getElementById("pivot");r&&(r.parentNode.removeChild(r),this._updatePivotLine(n,t,i,!1))},_renderPivotLine:function(n,i,r){if(!n.container){var u=n.width?n.width:n._width,h=n.height?n.height:n._height,f=t.datavisualization.Diagram.Point(u*n.pivot.x,-20/r),e=t.datavisualization.Diagram.Point(u*n.pivot.x,0),o=i.getElementById(i.document.id+"handle_g"),s=i.line({id:"pivotLine",x1:f.x*r,y1:f.y*r,x2:e.x*r,y2:e.y*r,stroke:"black","stroke-width":1,"stroke-dasharray":"2,3",fill:"none"});o.appendChild(s)}},_renderResizeBorder:function(n,i,r,u){var e=r.getElementById(r.document.id+"handle_g"),o=i.width?i.width:i._width,s=i.height?i.height:i._height,f;f=i.type=="umlclassifier"?t.datavisualization.Diagram.ClassifierHelper.renderResizeBorder(n,i,r,u):r.rect({id:n,"class":"resizeRect",width:o*u,height:s*u,stroke:"#097F7F","stroke-width":.6,"stroke-dasharray":"6,3",fill:"none","pointer-events":"none"});e.appendChild(f)},_renderResizeCorner:function(n,i,r,u,f,e,o){var l=f.getElementById(f.document.id+"handle_g"),h,c="white",s;t.datavisualization.Diagram.Util.canResize(i)||(c="darkgray");e&&(c="darkgray",h="none");s={id:n,"class":"resizeCorners",fill:c,stroke:"black","stroke-width":1,cx:r,cy:u,r:o||7};l.appendChild(f.circle(s));s={id:n+"_transparent","class":n,fill:"transparent",cx:r,cy:u,r:o||10};h&&(s["pointer-events"]=h);l.appendChild(f.circle(s))},_renderRotateThumb:function(n,i,r,u,f,e){if(!i.container){var h=e.getElementById(e.document.id+"handle_g"),c="#231f20";t.datavisualization.Diagram.Util.canRotate(i)||(c="darkgray");var o=20,s=20,l={id:"rotatehandle","class":n,fill:c,stroke:"black","stroke-width":.5,width:o,height:s,d:"M 16.856 10.239 L 18 3.438 l -2.189 0.817 c -0.974 -1.694 -2.482 -2.995 -4.326 -3.696 C 9.375 -0.245 7.071-0.18 5.01 0.744 C 2.942 1.668 1.365 3.342 0.558 5.453 c -0.803 2.115 -0.738 4.414 0.185 6.478 c 0.925 2.064 2.6 3.645 4.714 4.45 c 0.969 0.371 1.993 0.554 3.013 0.554 c 1.345 0 2.685 -0.317 3.897 -0.948 l -1.016 -1.962 c -1.584 0.822-3.445 0.929 -5.114 0.293 c -1.56 -0.596 -2.793 -1.762 -3.479 -3.289 C 2.078 9.502 2.031 7.803 2.622 6.244 C 3.216 4.68 4.387 3.443 5.914 2.761 C 7.437 2.079 9.137 2.03 10.7 2.626 c 1.246 0.475 2.271 1.328 2.986 2.424 L 11.54 5.851 L 16.856 10.239 Z",transform:"translate("+(r*f-o/2)+","+(u*f-s)+")"},a=e.path(l),v=e.circle({id:"rotate","class":n,fill:"transparent",stroke:"none",cx:o/2,cy:s/2,r:13,transform:"translate("+(r*f-o/2)+","+(u*f-s)+")"});h.appendChild(a);h.appendChild(v)}},_refreshEndPointHandles:function(n,t,i){var r,f,u;if(n.segments){if(r=t.getElementById(t.document.id+"handle_g"),r&&r.childNodes.length>0)for(f=r.childNodes.length-1;f>=0;f--)u=r.childNodes[f],u.id!=="sourceEndPoint"&&u.id!=="targetEndPoint"&&u.parentNode.removeChild(u);this._renderEndPointHandle(n,t,i)}},_renderEndPointHandle:function(n,i,r){var e,f,u,o;if(!n.isPhase)for(e=t.datavisualization.Diagram.Util.canDragSegmentThumbs(n),f=0;f<n.segments.length;f++)u=n.segments[f],u.type=="bezier"&&(this._renderBezierLine("bezierline1_"+f,u._startPoint,u._point1,r,i,e),this._renderBezierLine("bezierline2_"+f,u._endPoint,u._point2,r,i,e),this._renderEndPointCorner("bezierpoint1_"+f,u._point1.x*r,u._point1.y*r,!1,i,e),this._renderEndPointCorner("bezierpoint2_"+f,u._point2.x*r,u._point2.y*r,!1,i,e)),o=u.points,f==0&&this._renderEndPointCorner("sourceEndPoint",u._startPoint.x*r,u._startPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)),f==n.segments.length-1?(this._renderEndPointCorner("targetEndPoint",u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isTargetConnected(n),i,t.datavisualization.Diagram.Util.canDragTargetEnd(n)),u.type=="orthogonal"&&this._renderTerminalOrthoThumbs(u,i,r,f,e)):u.type!="orthogonal"?this._renderSegmentEndThumb("segmentEnd_"+f,u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)):this._renderTerminalOrthoThumbs(u,i,r,f,e)},_renderTerminalOrthoThumbs:function(n,i,r,u,f){var o,e,h,s;if(n.points.length>2)for(e=0;e<n.points.length-1;e++)s=t.datavisualization.Diagram.Geometry.distance(n.points[e],n.points[e+1]),o=n.points[e].y.toFixed(2)==n.points[e+1].y.toFixed(2)?"horizontal":"vertical",h=s>=50?"visible":"hidden",this._renderOrthogonalThumb("OrthoThumb_"+e+"_"+u,(n.points[e].x+n.points[e+1].x)/2*r,(n.points[e].y+n.points[e+1].y)/2*r,i,h,o,f);else s=n.length||t.datavisualization.Diagram.Geometry.distance(n._startPoint,n._endPoint),h=s>=50?"visible":"hidden",o=n._startPoint.y.toFixed(2)==n._endPoint.y.toFixed(2)?"horizontal":"vertical",this._renderOrthogonalThumb("OrthoThumb_"+u,(n._endPoint.x+n._startPoint.x)/2*r,(n._endPoint.y+n._startPoint.y)/2*r,i,h,o,f)},_renderEndPointCorner:function(n,t,i,r,u,f){var s=u.getElementById(u.document.id+"handle_g"),o=r?"#8CC63F":"white",e;f||(o="darkgray");e={id:n,"class":n,opacity:.75,fill:o,stroke:"black","stroke-width":2,cx:t,cy:i,r:7};u.getElementById(n)?u.circle(e):s.appendChild(u.circle(e))},_renderSegmentEndThumb:function(n,t,i,r,u,f){var s=u.getElementById(u.document.id+"handle_g"),e="#e2e2e2",o;f||(e="darkgray");o={id:n,"class":"segmentEnd",fill:e,stroke:"black","stroke-width":2,cx:t,cy:i,r:5};s.appendChild(u.circle(o))},_renderOrthogonalThumb:function(n,t,i,r,u,f,e){var o,s,h,l,c,a;f=="horizontal"?(o="M0,7 L15,0 L30,7 L15,14 z",s=-15,h=-7):(o="M7,0 L0,15 L7,30 L14,15 z",s=-7,h=-15);l=r.getElementById(r.document.id+"handle_g");c="#e2e2e2";e||(c="darkgray");a={id:n,"class":"segmentEnd",fill:c,stroke:"black","stroke-width":1,d:o,transform:"translate("+(t+s)+","+(i+h)+")",visibility:u};l.appendChild(r.path(a))},_renderBezierLine:function(n,t,i,r,u){var f=u.line({id:n,x1:t.x*r,y1:t.y*r,x2:i.x*r,y2:i.y*r,stroke:"black","stroke-width":1,"stroke-dasharray":"3,3",fill:"none"}),e=u.getElementById(u.document.id+"handle_g");e.appendChild(f)},_renderControlPointCorner:function(n,t,i,r){var u=r.g({"class":n}),f;r.getElementById(r.document.id+"handle_g").appendChild(u);f={id:n+"_"+i,fill:"white",stroke:"black","stroke-width":2,cx:t.x,cy:t.y,r:5};u.appendChild(r.circle(f))},updateSelector:function(n,i,r,u,f){var o,s,e,l,c,h;if(n)if(o=n.width?n.width:n._width,s=n.height?n.height:n._height,n.segments)this._updateEndPointHandle(n,i,r),f&t.datavisualization.Diagram.SelectorConstraints.UserHandles&&this.updateUserHandles(u.model.selectedItems.userHandles,n,i,!1,!1,r,u);else if(n.type==="phase")e=u._getPhaseBounds(n),i.g({id:i.document.id+"handle_g","class":"handle","pointer-events":"visible",transform:"translate("+e.x*r+","+e.y*r+"),rotate(0,"+e.width/2*r+","+e.height/2*r+")"}),i.rect({id:"phaseSelector","class":"phaseSelector","stroke-width":2,"stroke-dasharray":"3,3","pointer-events":"none",width:e.width<0?1:e.width*r,height:e.height<0?1:e.height*r,fill:"transparent",stroke:"red"});else if(n.isSwimlane||n.isLane||(l=i.g({id:i.document.id+"handle_g",transform:"translate("+(n.offsetX-o*n.pivot.x)*r+","+(n.offsetY-s*n.pivot.y)*r+"),rotate("+n.rotateAngle+","+o*n.pivot.x*r+","+s*n.pivot.y*r+")"})),c=u.getObjectType(n),c!=="group"&&n.type!=="pseudoGroup"&&(u.activeTool.name=="move"||u.activeTool.name=="rotate")&&u.activeTool.inAction||this._updateResizeHandle(n,i,r,f),u.activeTool.name=="rotatetool"&&u.activeTool.inAction&&this.renderPivotPoint(n,r,i),u.model.selectedItems.userHandles&&u.model.selectedItems.userHandles.length>0&&(h=!1,u.selectionList[0]&&u.selectionList[0].name=="multipleSelection"&&(h=!0),f&t.datavisualization.Diagram.SelectorConstraints.UserHandles))return this.updateUserHandles(u.model.selectedItems.userHandles,n,i,h,!1,r,u),!0},_updatePhaseResize:function(n,i,r){var e,u=[],o,f=t.datavisualization.Diagram.Util.bounds(n);e;u=[];u.push({x:f.topLeft.x*r,y:f.topLeft.y*r});u.push({x:f.bottomLeft.x*r,y:f.bottomLeft.y*r});e=this._convertToSVGPoints(u);o={id:"w-resize",points:e};i.polyline(o);e;u=[];u.push({x:f.topLeft.x*r,y:f.topLeft.y*r});u.push({x:f.topRight.x*r,y:f.topRight.y*r});e=this._convertToSVGPoints(u);o={id:"n-resize",points:e};i.polyline(o);e;u=[];u.push({x:f.topRight.x*r,y:f.topRight.y*r});u.push({x:f.bottomRight.x*r,y:f.bottomRight.y*r});e=this._convertToSVGPoints(u);o={id:"e-resize-hitTest",points:e};i.polyline(o);o={id:"e-resize",points:e};i.polyline(o);e;u=[];u.push({x:f.bottomLeft.x*r,y:f.bottomLeft.y*r});u.push({x:f.bottomRight.x*r,y:f.bottomRight.y*r});e=this._convertToSVGPoints(u);o={id:"s-resize-hitTest",points:e};i.polyline(o);o={id:"s-resize",points:e};i.polyline(o)},_updateResizeHandle:function(n,i,r,u){if(n.isSwimlane||n.isLane)this._updatePhaseResize(n,i,r,u);else{var f=n.width?n.width:n._width,e=n.height?n.height:n._height,s=n._corners,o=t.datavisualization.Diagram.Point(f*n.pivot.x,-20/r);u&t.datavisualization.Diagram.SelectorConstraints.Rotator&&n.type!="umlclassifier"&&(this._updateRotateHandle("rotate",o.x,o.y,r,i,n),this._updatePivotLine(n,i,r));u&t.datavisualization.Diagram.SelectorConstraints.Resizer&&(n.type!="umlclassifier"&&(this._updateResizeCorner("nw-resize",0,0,i),this._updateResizeCorner("n-resize",f/2*r,0,i),this._updateResizeCorner("ne-resize",f*r,0,i),this._updateResizeCorner("w-resize",0,e/2*r,i),this._updateResizeCorner("e-resize",f*r,e/2*r,i),this._updateResizeCorner("sw-resize",0,e*r,i),this._updateResizeCorner("s-resize",f/2*r,e*r,i),this._updateResizeCorner("se-resize",f*r,e*r,i)),this._updateResizeBorder("resizeBorder",n,i,r))}},_updateRotateHandle:function(n,t,i,r,u){var f=20,e=20,o={id:"rotatehandle",transform:"translate("+(t*r-f/2)+","+(i*r-e)+")"};u.path(o);u.circle({id:"rotate",transform:"translate("+(t*r-f/2)+","+(i*r-e)+")"})},_updatePivotLine:function(n,i,r,u){var f=n.width?n.width:n._width,s=n.height?n.height:n._height,o=t.datavisualization.Diagram.Point(f*n.pivot.x,-20/r),e,h;e=u?t.datavisualization.Diagram.Point(f*n.pivot.x,s*n.pivot.y):t.datavisualization.Diagram.Point(f*n.pivot.x,0);h=i.line({id:"pivotLine",x1:o.x*r,y1:o.y*r,x2:e.x*r,y2:e.y*r})},_updateResizeBorder:function(n,i,r,u){var f=i.width?i.width:i._width,e=i.height?i.height:i._height,o;i.type=="umlclassifier"?o=t.datavisualization.Diagram.ClassifierHelper.renderResizeBorder(n,i,r,u):r.rect({id:n,width:f*u,height:e*u})},_updateResizeCorner:function(n,t,i,r){var u={id:n,cx:t,cy:i};r.circle(u);u={id:n+"_transparent",cx:t,cy:i};r.circle(u)},_updateEndPointHandle:function(n,i,r){for(var u,e,o=t.datavisualization.Diagram.Util.canDragSegmentThumbs(n),f=0;f<n.segments.length;f++)u=n.segments[f],e=u.points,f==n.segments.length-1?(this._updateEndPointCorner("targetEndPoint",e[e.length-1].x*r,e[e.length-1].y*r,t.datavisualization.Diagram.Util.isTargetConnected(n),i,t.datavisualization.Diagram.Util.canDragTargetEnd(n)),u.type=="orthogonal"&&this._updateTerminalOrthoThumbs(u,i,r,f,o)):u.type!="orthogonal"?this._updateSegmentEndThumb("segmentEnd_"+f,u._endPoint.x*r,u._endPoint.y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)):this._updateTerminalOrthoThumbs(u,i,r,f,o),f==0&&this._updateEndPointCorner("sourceEndPoint",e[0].x*r,e[0].y*r,t.datavisualization.Diagram.Util.isSourceConnected(n),i,t.datavisualization.Diagram.Util.canDragSourceEnd(n)),u.type=="bezier"&&(this._updateEndPointCorner("bezierpoint1_"+f,u._point1.x*r,u._point1.y*r,!1,i,o),this._updateEndPointCorner("bezierpoint2_"+f,u._point2.x*r,u._point2.y*r,!1,i,o),this._updateBezierLine("bezierline1_"+f,u._startPoint,u._point1,r,i),this._updateBezierLine("bezierline2_"+f,u._endPoint,u._point2,r,i))},_updateEndPointCorner:function(n,t,i,r,u,f){var e=r?"#8CC63F":"white",o;f||(e="darkgray");o={id:n,fill:e,cx:t,cy:i};u.circle(o)},_updateSegmentEndThumb:function(n,t,i,r,u){var f={id:n,cx:t,cy:i};u.circle(f)},_updateOrthoThumb:function(n,t,i,r,u,f,e){var c="#e2e2e2",o,s,h,l;e||(c="darkgray");f=="horizontal"?(o="M0,7 L15,0 L30,7 L15,14 z",s=-15,h=-7):(o="M7,0 L0,15 L7,30 L14,15 z",s=-7,h=-15);l={id:n,visibility:u,transform:"translate("+(t+s)+","+(i+h)+")",d:o,fill:c};r.path(l)},_updateTerminalOrthoThumbs:function(n,i,r,u,f){var o,e,h,s;if(n.points.length>2)for(e=0;e<n.points.length-1;e++)s=t.datavisualization.Diagram.Geometry.distance(n.points[e],n.points[e+1]),o=n.points[e].y.toFixed(2)==n.points[e+1].y.toFixed(2)?"horizontal":"vertical",h=s>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+e+"_"+u,(n.points[e].x+n.points[e+1].x)/2*r,(n.points[e].y+n.points[e+1].y)/2*r,i,h,o,f);else s=n.length||t.datavisualization.Diagram.Geometry.distance(n._startPoint,n._endPoint),o=n._startPoint.y.toFixed(2)==n._endPoint.y.toFixed(2)?"horizontal":"vertical",h=s>=50?"visible":"hidden",this._updateOrthoThumb("OrthoThumb_"+u,(n._endPoint.x+n._startPoint.x)/2*r,(n._endPoint.y+n._startPoint.y)/2*r,i,h,o,f)},_updateBezierLine:function(n,t,i,r,u){var f=u.line({id:n,x1:t.x*r,y1:t.y*r,x2:i.x*r,y2:i.y*r})},_updateControlPointCorner:function(n,t,i,r){r.circle({id:n+"_"+i,cx:t.x,cy:t.y})},updateUserHandles:function(n,i,r,u,f,e,o){var h=r.document.getElementById(r.document.id+"userHandle_g"),s;if(o.model.selectedItems.constraints&t.datavisualization.Diagram.SelectorConstraints.UserHandles)if(h){if(n&&n.length>0)for(s=0;s<n.length;s++)(u&&n[s].enableMultiSelection||!u)&&this._updateHandle(n[s],i,r,f,e,o)}else this.renderUserHandles(n,i,r,u,e,o._adornerLayer,o)},_updateHandle:function(n,i,r,u,f,e){var s,o,h,c;!u&&i&&n.visible?(s=this._getHandlePosition(n,i,f,null,e),o=n._absolutePath,o&&n.size==n._size||(o=n._absolutePath=t.datavisualization.Diagram.Geometry.updatePath(0,0,n.size/2,n.size/2,n.pathData,r)),n._size=n._size,h=s.x*f,c=s.y*f,this._updateHandleShape(n,h,c,r),this._updateHanleIcon(n,o,r,h-n.size/4,c-n.size/4),r.getElementById(n.name+"_shape")&&n.visible&&(r.getElementById(n.name+"_shape").style.display="block",r.getElementById(n.name+"_icon").style.display="block")):r.getElementById(n.name+"_shape")&&(r.getElementById(n.name+"_shape").style.display="none",r.getElementById(n.name+"_icon").style.display="none")},clearSelector:function(n,t){var i=n.getElementById(n.document.id+"handle_g");i&&t.removeChild(i);i=n.getElementById(n.document.id+"userHandle_g");i&&t.removeChild(i)},_initializePageBreaks:function(n,t,i){var r=n.g(t);return i.appendChild(r),r},_renderVPageBreakLine:function(n,t,i,r){var u=i.line({x1:n.x,y1:n.y,x2:t.x,y2:t.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});r.appendChild(u)},_renderPageSettingsRect:function(n,t,i,r,u,f,e){var o=i.rect({id:"pageback",x:n.x,y:n.y,width:t.x,height:t.y,style:"fill:"+f+";stroke:"+u+";stroke-width:"+e+""});r.appendChild(o)},_updatePageBakground:function(n,i,r,u,f,e,o){var s=r.document.getElementById("pageback"),h={x:n.x,y:n.y,width:i.x<0?0:i.x,height:i.y<0?0:i.y,style:"fill:"+e+";stroke:"+f+";stroke-width:"+o+""};s&&t.datavisualization.Diagram.Util.attr(s,h)},_renderHPageBreakLine:function(n,t,i,r){var u=i.line({x1:n.x,y1:n.y,x2:t.x,y2:t.y,style:"stroke:#aaaaaa;stroke-width:1;stroke-dasharray:10,10 "});r.appendChild(u)},_removePageBreaks:function(n,t,i){t!=null&&i!=null&&i.removeChild(t)},removeChild:function(n,t){var r=t.svg.document.getElementById(n.name),u=t.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],f=this._findChild(u.childNodes,n),i;r&&r.parentNode.removeChild(r);f&&u.removeChild(f);n._type==="node"&&n.type==="html"&&(i=u.children[n.name+"_parentdiv"],i&&i.parentNode&&i.parentNode.removeChild(i))}};t.datavisualization.Diagram.DiagramContext={_renderNodes:function(n,t,i,r){var f,u,e,o,s;if(r.nodes())for(f=r.nodes(),u=0,e=f.length;u<e;++u)o=r.nameTable[f[u].name],s=n.svg||n._canvas,this._renderNodeObject(o,n,t,i,r)},_renderNodeObject:function(n,i,r,u,f){var e=i.svg||i._canvas;n._type!=="group"||n.parent?n.parent||i.context.renderNode(n,e,i.diagramLayer,null,f):(n.container||t.datavisualization.Diagram.Util._updateGroupBounds(n,f,!0),i.context.renderGroup(n,e,i.diagramLayer,f.nameTable,f,r,u),t.datavisualization.Diagram.Util._updateGroupBounds(n,f),t.datavisualization.Diagram.DiagramContext.update(n,f))},_renderConnectors:function(n,t){var r,e,u,i,f;if(t.connectors()){for(r=t.connectors(),e=n.svg||n._canvas,i=0,f=r.length;i<f;++i)u=r[i],t._setZorder(u);for(i=0,f=r.length;i<f;++i)u=r[i],this._renderConnectorObject(u,n,t)}},_renderConnectorObject:function(n,i,r){var u=i.svg||i._canvas;t.datavisualization.Diagram.Util.updateBridging(n,r);n.parent||i.context.renderConnector(n,u,i.diagramLayer,r)},updateViewPort:function(n){var i;n._views.forEach(function(r){i=n._views[r];i.context==t.datavisualization.Diagram.SvgContext&&i.type=="mainview"&&t.datavisualization.Diagram.PageUtil._updatePageSize(n)})},renderNode:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;i&&(i=u.document.getElementById(i.id));r.context.renderNode(n,u,i||r.diagramLayer,undefined,t)})},addLabel:function(n,t,i,r){var u,f;i._views&&i._views.forEach(function(e){u=i._views[e];f=u.svg||u.canvas;u.context._addLabel(n,t,f,i,r)})},renderPort:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r._canvas;r.context._insertPort(n,t,u)})},renderConnector:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;r.context.renderConnector(n,u,i||r.diagramLayer,t)})},renderGroup:function(n,t,i){var r,u;t._views.forEach(function(f){var e;r=t._views[f];u=r.svg||r._canvas;i=r.svg.getElementById(n.parent);r.type=="overview"&&(e=!0);r.context.renderGroup(n,u,i||r.diagramLayer,t.nameTable,t,null,e)})},update:function(n,t,i){var f=!0,r,u;n.isSwimlane&&t._disableSwimlaneUptate&&(f=!1);f&&t._views.forEach(function(f){r=t._views[f];u=r.svg||r._canvas;t&&!t._isInit&&n._status!=="new"&&(n._status="update");n._type==="group"||n.type==="pseudoGroup"?r.context.updateGroup(n,u,t,i):n.segments?r.context.updateConnector(n,u,t):r.context.updateNode(n,u,t,i)})},_refreshSegments:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;n.segments&&i.context._refreshSegments(n,r,t)})},_refreshOnlySegments:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;n.segments&&i.context._refreshOnlySegments(n,r,t)})},renderShadow:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;i.context._renderShadow(n,r)})},updateShadow:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;i.context._updateShadow(n,r)})},removeShadow:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i._canvas;i.context._removeShadow(n,r)})},addNodeLabel:function(n,t,i,r){var u,f;r._views&&r._views.forEach(function(e){u=r._views[e];f=u.svg||u.canvas;u.context.addNodeLabel(n,t,f,i,r)})},updateLabel:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r.canvas;r.context.updateLabel(n,t,u,i)})},updatePort:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r.canvas;r.context.updatePort(n,t,u,i)})},setNodeShape:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r.canvas;r.context.setNodeShape(n,u,i,t)})},setLine:function(n,t,i){var r,u;t._views.forEach(function(f){r=t._views[f];u=r.svg||r.canvas;r.context.setLine(n,u,i,t)})},renderDecorators:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.renderDecorators(n,r,t)})},clearDecorators:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.clearDecorators(n,r,t)})},updateTargetDecoratorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.updateTargetDecoratorStyle(n,r)})},updateSourceDecoratorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context.updateSourceDecoratorStyle(n,r)})},updateNodeStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context._updateNodeStyle(n,r)})},updateLabelStyle:function(n,t,i){i._views.forEach(function(r){var u=i._views[r],f=u.svg||u.canvas;u.context.updateLabelStyle(n,t,f)})},updateConnectorStyle:function(n,t){var i,r;t._views.forEach(function(u){i=t._views[u];r=i.svg||i.canvas;i.context._updateConnectorStyle(n,r)})},updateTextBlock:function(n,t,i){var r,u;i._views.forEach(function(f){r=i._views[f];u=r.svg||r.canvas;r.context.updateTextBlock(n,t,u)})},updateBPMNNodeStyle:function(n,i){var f,u,r=0;if(n=t.datavisualization.Diagram.Util._updateBpmnChild(n,i),n.children)for(u=i._getChildren(n.children),r=0;r<u.length;r++)f=i.nameTable[u[r]],t.datavisualization.Diagram.DiagramContext.updateNodeStyle(f,i,n);else t.datavisualization.Diagram.DiagramContext.updateNodeStyle(n,i)},updateBPMNNodeShape:function(n,i){var f,r,u=0,e;if(n=t.datavisualization.Diagram.Util._updateBpmnChild(n,i),r=i._getChildren(n.children),r.length>0&&i.nameTable[r[0]])for(u=0;u<r.length;u++)f=i.nameTable[r[u]],f&&t.datavisualization.Diagram.DiagramContext.setNodeShape(f,i,n);else e=i._svg.getElementById(n.name),e.parentNode.removeChild(e),i.add(n)}}}(jQuery,Syncfusion),function(n,t,i){"use strict";t.widget("ejSymbolPalette","ej.datavisualization.SymbolPalette",{element:null,model:null,nameTable:{},defaults:{width:"250px",height:"400px",paletteItemWidth:i,paletteItemHeight:i,previewWidth:i,previewHeight:i,previewOffset:{x:110,y:110},diagramId:"",headerHeight:30,selectedPaletteName:"",cssClass:"e-datavisualization-symbolpalette",showPaletteItemText:!0,allowDrag:!0,palettes:[],defaultSettings:{connector:null,node:null},selectionChange:null,create:null,destroy:null},_oldItem:null,dataTypes:{paletteItemWidth:"number",paletteItemHeight:"number",previewWidth:"number",previewHeight:"number",headerHeight:"number",showPaletteItemText:"boolean",allowDrag:"boolean",palettes:"array"},_canvas:null,_init:function(){t.browserInfo().name==="msie"&&Number(t.browserInfo().version)<9||(this.selectedItem=null,this.activePalette=null,this._selectedElement=null,this._renderSymbolPalette(),this._wireEvents(),this.updateScrollerViewport())},_setModel:function(t){var i,r;for(i in t)switch(i){case"width":this._setWidth(t[i]);break;case"height":this._setHeight(t[i]);break;case"paletteItemWidth":this.model.paletteItemWidth=t[i];this._redrawContent();break;case"paletteItemHeight":this.model.paletteItemHeight=t[i];this._redrawContent();break;case"headerHeight":this._setHeaderHeight(t[i]);break;case"cssClass":this._setCssClass(t[i]);break;case"showPaletteItemText":this._showItemText(t[i]);break;case"allowDrag":this._setAllowDrag(t[i]);break;case"palettes":this._updatePalettes(t[i]);break;case"selectedPaletteName":r=this._getPalette(t.selectedPaletteName);r&&r!==this.activePalette&&(n(document.getElementById(this.activePalette.name+"_header")).removeClass("selected"),this.activePalette=r,n(document.getElementById(this.activePalette.name+"_header")).addClass("selected"))}},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_renderSymbolPalette:function(){this._canvas=document.createElement("div");this._canvas.setAttribute("class","e-scanvas");this._canvas.setAttribute("id",this.element[0].id+"_canvas");this.element[0].setAttribute("style","height:"+this.model.height+"; width:"+this.model.width+";");this.element.append(this._canvas);this.element.ejScroller({width:this._setViewPortWidth(),height:this._setViewPortHeight(),enableTouchScroll:!1});this._renderPalettes()},_updatePalettes:function(t){this.model.palettes=t;n("#"+this.element[0].id+"_canvas").empty();this._renderPalettes();this.updateScrollerViewport()},_renderPalettes:function(){var i=this.model.palettes,n,r;if(i)for(n=0,r=i.length;n<r;n++)i[n]=t.datavisualization.Diagram.Palette(i[n]),this._initPaletteitems(i[n]),this._renderPalette(i[n])},_updatePaletteItemWidth:function(n){var i=t.datavisualization.Diagram.Util.bounds(n);n.segments?i.width>this.element.width()-40&&!n.paletteItem&&t.datavisualization.Diagram.Util.scale(n,(this.element.width()-45)/i.width,1,i.center):n.width>this.element.width()-40?n.width=this.element.width()-40:n.paletteItem&&n.paletteItem.width&&n.paletteItem.width>this.element.width()-40&&(n.paletteItem.width=this.element.width()-40)},_renderHtmlLayer:function(n,i){var r=document.createElement("div"),f={id:n.id+"_htmlLayer","class":"htmlLayer"},u;return t.datavisualization.Diagram.Util.attr(r,f),u=r,r.style.pointerEvents="none",r.style.position="absolute",r.style.left=i?i.style.paddingLeft:"0px",r.style.top=i?i.style.paddingTop:"0px",n.appendChild(u),u},_initPaletteitems:function(i){var u=this.model.defaultSettings&&this.model.defaultSettings.node?this.model.defaultSettings.node:null,f=this.model.defaultSettings&&this.model.defaultSettings.connector?this.model.defaultSettings.connector:null,r;if(i.items)for(r=0;r<i.items.length;r++)i.items[r].shape&&typeof i.items[r].shape=="object"?t.datavisualization.Diagram.Util._updateShapeProperties(i.items[r]):i.items[r]=t.datavisualization.Diagram.NodeType(i.items[r],this),i.items[r].isLane?i.items[r]=t.datavisualization.Diagram.SwimLaneHelper._createPaletteLane(i.items[r],this.nameTable):i.items[r].type=="connector"?i.items[r]=t.datavisualization.Diagram.Connector(n.extend(!0,{},f,i.items[r])):i.items[r]._type==="group"||i.items[r].children&&i.items[r].children.length>0?(i.items[r]=t.datavisualization.Diagram.Group(n.extend(!0,{},u,i.items[r])),i.items[r]=t.datavisualization.Diagram.Util._updateBpmnChild(i.items[r],this),this._initGroupNode(i.items[r],this)):i.items[r]=i.items[r].type=="phase"?t.datavisualization.Diagram.Util._mapPalettePhase(i.items[r]):t.datavisualization.Diagram.Node(n.extend(!0,{},u,i.items[r]))},_initGroupNode:function(i){for(var r=null,f=this.model.defaultSettings&&this.model.defaultSettings.node?this.model.defaultSettings.node:null,e=this.model.defaultSettings&&this.model.defaultSettings.connector?this.model.defaultSettings.connector:null,u=0;u<i.children.length;u++)r=i.children[u],typeof r=="object"&&(r._type=="group"?(r=t.datavisualization.Diagram.Group(n.extend(!0,{},f,r)),r=t.datavisualization.Diagram.Util._updateBpmnChild(r,this),this._initGroupNode(r)):r=r.segments?t.datavisualization.Diagram.Connector(n.extend(!0,{},e,r)):t.datavisualization.Diagram.Node(n.extend(!0,{},f,r)),r=t.datavisualization.Diagram.NodeType(r,this),r.parent=i.name,i.children[u]=r.name,this.nameTable[r.name]=r)},_setViewPortWidth:function(){this.element[0].setAttribute("style","width:"+this.model.width+";");var n=this.element.width();return Math.abs(n)},_setViewPortHeight:function(){this.element[0].setAttribute("style","height:"+this.model.height+";");var n=this.element.height();return Math.abs(n)},_renderPalette:function(n){this._renderHeader(n);this._updateHeaderWrapper(n,this.model.headerHeight);this._renderContent(n);this._collapse(n);this._updatePaletteVisibility(n)},_renderHeader:function(i){var r=document.createElement("div"),u={id:i.name+"_header","class":"e-header",style:"height:"+this.model.headerHeight+"px;"};i.constraints&this._canHeaderVisible(i)||(u.style+="display:none");t.datavisualization.Diagram.Util.attr(r,u);this._renderHeaderArrow(r,i.expanded,i.name,this._canExpand(i));i.templateId&&n.templates?this._renderHeaderTemplate(r,i):this._renderHeaderText(r,i.name);this._addExpandedClass(r,i.expanded);this._disableClickClass(r,this._canExpand(i));this.model.selectedPaletteName===i.name&&(n(r).addClass("selected"),this.activePalette=i);this._canvas.appendChild(r)},_renderHeaderText:function(n,t){var i=document.createElement("span");i.setAttribute("class","e-header-text");i.innerHTML=t;n.appendChild(i)},_renderHeaderTemplate:function(n,i){var u=this._renderEjTemplate("#"+i.templateId,i),r=document.createElement("div"),f={id:i.name+"_Wrapper","class":"e-header-wrapper"};t.datavisualization.Diagram.Util.attr(r,f);this._renderTemplateContent(i,r,u);n.appendChild(r)},_renderTemplateContent:function(i,r,u){var f=document.createElement("div"),e;f.innerHTML=u;f.style.display="inline-block";document.body.appendChild(f);e=f.cloneNode(!0);e.id=i.name+"_templateHeader";var o=f.offsetWidth,h=f.offsetHeight,c=n("#"+this._id).width()-18/o,l=this.model.headerHeight/h,s=Math.min(c,l),a=(s-1)*o/2;t.datavisualization.Diagram.Util.attr(e,{style:"position: relative; left: "+a+"px; transform: scale("+s+")"});r.appendChild(e);f.parentNode.removeChild(f)},_renderHeaderArrow:function(t,i,r,u){var f,e;u?(f=t.getElementsByClassName("e-header-arrow e-icon")[0],f||(f=document.createElement("span"),f.setAttribute("class","e-header-arrow e-icon"),f.setAttribute("style","top:"+(this.model.headerHeight-16)/2+"px;"),this._addExpandedClass(f,i),this.model.selectedPaletteName===name&&n(f).addClass("selected"),t.appendChild(f))):(e=t.getElementsByClassName("e-header-arrow e-icon")[0],e&&e.parentNode.removeChild(e))},_renderContent:function(n){var i=document.getElementById(n.name+"_content"),t,r,u;if(i||(i=document.createElement("div"),this._canvas.appendChild(i)),i.setAttribute("id",n.name+"_content"),i.setAttribute("class","e-scontent"),this.model.palettes.length-1===this.model.palettes.indexOf(n)&&i.setAttribute("style","border-bottom-width: 0px;"),t=n.items,t&&t.length>0)for(r=0,u=t.length;r<u;r++)this.nameTable[t[r].name]=t[r].parent?t[r]:this._renderItem(t[r],i)},_updateRenderSize:function(n,i){var r;if(n.paletteItem&&(n.type!=="group"||n.isLane)&&(n._type!=="group"||n.type!=="bpmn"))if(n.segments&&n.paletteItem&&n.paletteItem.enableScale&&!n.isPhase){var r=t.datavisualization.Diagram.Util.bounds(n),u=(n.paletteItem.width?n.paletteItem.width:this.model.paletteItemWidth)/r.width,f=(n.paletteItem.height?n.paletteItem.height:this.model.paletteItemHeight)/r.height;t.datavisualization.Diagram.Util.scale(n,u,f,{x:.5,y:.5});this._updatePaletteItemWidth(n)}else if(n.segments&&n.paletteItem&&n.paletteItem.enableScale&&!n.isPhase||n.isPhase&&n.paletteItem.width!=n.paletteItem.height){var r=t.datavisualization.Diagram.Util.bounds(n),u=(n.paletteItem.width?n.paletteItem.width:this.model.paletteItemWidth)/r.width,f=(n.paletteItem.height?n.paletteItem.height:this.model.paletteItemHeight)/r.height;t.datavisualization.Diagram.Util.scale(n,u,f,{x:.5,y:.5});this._updatePaletteItemWidth(n)}else n._type=="node"&&this._checkItemUpdate(n)&&(n.width=i.width,n.height=i.height,n.offsetX=i.width/2,n.offsetY=i.height/2);else n.segments?(r=t.datavisualization.Diagram.Util.bounds(n),t.datavisualization.Diagram.Util._translate(n,i.width/2-r.center.x,i.height/2-r.center.y,this.nameTable)):(n.width=i.width,n.height=i.height,n.offsetX=i.width/2,n.offsetY=i.height/2)},_checkItemUpdate:function(n){return(n.paletteItem&&n.paletteItem.enableScale)?!1:!0},_updatePreviewSize:function(n,i){var r;if(n.paletteItem&&(n.type!=="group"||n.isLane))if(n.segments&&n.paletteItem&&n.paletteItem.enableScale&&!n.isPhase){var r=t.datavisualization.Diagram.Util.bounds(n),u=(n.paletteItem.previewWidth?n.paletteItem.previewWidth:this.model.previewWidth)/r.width,f=(n.paletteItem.previewHeight?n.paletteItem.previewHeight:this.model.previewHeight)/r.height;t.datavisualization.Diagram.Util.scale(n,u,f,{x:.5,y:.5});this._updatePaletteItemWidth(n)}else if(n.segments&&n.paletteItem&&n.paletteItem.enableScale&&!n.isPhase||n.isPhase&&n.paletteItem.previewWidth!=n.paletteItem.previewHeight){var r=t.datavisualization.Diagram.Util.bounds(n),u=(n.paletteItem.previewWidth?n.paletteItem.previewWidth:this.model.previewWidth)/r.width,f=(n.paletteItem.previewHeight?n.paletteItem.previewHeight:this.model.previewHeight)/r.height;t.datavisualization.Diagram.Util.scale(n,u,f,{x:.5,y:.5});this._updatePaletteItemWidth(n)}else(n._type=="node"||n._type=="group")&&(n.width=i.width,n.height=i.height,n.offsetX=i.width/2,n.offsetY=i.height/2);else n.segments?(r=t.datavisualization.Diagram.Util.bounds(n),t.datavisualization.Diagram.Util._translate(n,i.width/2-r.center.x,i.height/2-r.center.y,this.nameTable)):(n.width=i.width,n.height=i.height,n.offsetX=i.width/2,n.offsetY=i.height/2)},_getRenderItemSize:function(n){var i=this.model.paletteItemWidth,r=this.model.paletteItemHeight,o,s,f,e,u;return n.segments?(u=t.datavisualization.Diagram.Util.bounds(n),n.paletteItem?(i=n.paletteItem.width?n.paletteItem.width:i,r=n.paletteItem.height?n.paletteItem.height:r,i=i?i:n.width,r=r?r:n.height,n.paletteItem.width=i,n.paletteItem.height=r):(u=t.datavisualization.Diagram.Util.bounds(n),i=i?i:u.width,r=r?r:u.height)):n.type==="group"?(u=t.datavisualization.Diagram.Util._getChildrenBounds(n,this),n.paletteItem&&!n.isLane?(i=n.paletteItem.width?n.paletteItem.width:i,r=n.paletteItem.height?n.paletteItem.height:r,i=i?i:u.width,r=r?r:u.height,n.paletteItem.width=i,n.paletteItem.height=r):n.paletteItem&&n.isLane?n.paletteItem.enableScale?(i=n.paletteItem.width?n.paletteItem.width:i,r=n.paletteItem.height?n.paletteItem.height:r,i=i?i:u.width,r=r?r:u.height,n.paletteItem.width=i,n.paletteItem.height=r):(o=(n.paletteItem.width?n.paletteItem.width:this.model.paletteItemWidth)/n.width,s=(n.paletteItem.height?n.paletteItem.height:this.model.paletteItemHeight)/n.height,t.datavisualization.Diagram.Util.scale(n,o,s,{x:.5,y:.5},this.nameTable,!1,!1,!1,this),f=.0001,e=.001,n.isLane&&n.paletteItem&&!n.paletteItem.enableScale&&(n.orientation==="horizontal"?f-=2.2:f+=.8,e-=1),t.datavisualization.Diagram.Util._translate(n,f,e,this.nameTable,!1,this),i=n.width?n.width:i,r=n.height?n.height:r):(i=i?i:u.width,r=r?r:u.height)):n.paletteItem?(i=n.paletteItem.width?n.paletteItem.width:i,r=n.paletteItem.height?n.paletteItem.height:r,i=i?i:n.width,r=r?r:n.height,n.paletteItem.width=i,n.paletteItem.height=r):(u=t.datavisualization.Diagram.Util.bounds(n),i=u.width?u.width:i,r=u.height?u.height:r),{width:i,height:r}},_renderPetternDefinition:function(n,t){if(n&&t){var i=t.document.getElementById(n+"patterndefinition");i||(i=t.defs({id:n+"patterndefinition"}),t.appendChild(i))}},_renderItem:function(t,i){var r=n.extend(!0,{},t),u=this._getRenderItemSize(r),f;return this._updateRenderSize(r,u),f=this._renderItemContainer(r.name,i,null,u,r),r.segments?this._renderConnector(r,f,u):r._type!="node"||r.children&&r.children.length>0?this._renderGroup(r,f,u):this._renderNode(r,f,u),r.isLane&&r.paletteItem&&!r.paletteItem.enableScale&&r.orientation==="vertical"&&f.document.setAttribute("height",u.height+2),r},_getPreviewItemSize:function(n){var i=this.model.previewWidth,r=this.model.previewHeight,u;return n.segments?(u=t.datavisualization.Diagram.Util.bounds(n),n.paletteItem?(i=n.paletteItem.previewWidth?n.paletteItem.previewWidth:i,r=n.paletteItem.previewHeight?n.paletteItem.previewHeight:r,i=i?i:n.width,r=r?r:n.height,i=i?i:u.width,r=r?r:u.height,n.paletteItem.previewWidth=i,n.paletteItem.previewHeight=r):(u=t.datavisualization.Diagram.Util.bounds(n),i=i?i:u.width,r=r?r:u.height)):n.type==="group"?(u=t.datavisualization.Diagram.Util._getChildrenBounds(n,this),n.paletteItem&&!n.isLane?(i=n.paletteItem.previewWidth?n.paletteItem.previewWidth:i,r=n.paletteItem.previewHeight?n.paletteItem.previewHeight:r,i=i?i:u.width,r=r?r:u.height,n.paletteItem.previewWidth=i,n.paletteItem.previewHeight=r):n.paletteItem&&n.isLane?n.paletteItem.enableScale?(i=n.paletteItem.previewWidth?n.paletteItem.previewWidth:i,r=n.paletteItem.previewHeight?n.paletteItem.previewHeight:r,i=i?i:u.width,r=r?r:u.height,n.paletteItem.previewWidth=i,n.paletteItem.previewHeight=r):(i=n.paletteItem.previewWidth?n.paletteItem.previewWidth:i,r=n.paletteItem.previewHeight?n.paletteItem.previewHeight:r):(i=i?i:u.width,r=r?r:u.height)):n.paletteItem?(i=n.paletteItem.previewWidth?n.paletteItem.previewWidth:i,r=n.paletteItem.previewHeight?n.paletteItem.previewHeight:r,i=i?i:n.width,r=r?r:n.height,n.paletteItem.previewWidth=i,n.paletteItem.previewHeight=r):(u=t.datavisualization.Diagram.Util.bounds(n),i=u.width?u.width:i,r=u.height?u.height:r),{width:i,height:r}},_renderItemContainer:function(n,i,r,u,f){var e=document.createElement("div"),o=this.model.showPaletteItemText?u.height+18:u.height,s=u.width,h=f&&f.paletteItem?f.paletteItem.margin.left:4,c=f&&f.paletteItem?f.paletteItem.margin.top:4,l=f&&f.paletteItem?f.paletteItem.margin.right:4,a=f&&f.paletteItem?f.paletteItem.margin.bottom:4,v={id:n+"_paletteItem",draggable:"true",height:o+"px",width:s+"px","class":"e-paletteItem",style:"padding-left:"+h+"px;padding-right:"+(l+2)+"px;padding-top:"+(c+1)+"px;padding-bottom:"+(a+1)+"px;height:"+(o+1)+"px;width:"+(s+1)+"px;-ms-touch-action: none;touch-action: none;"};return t.datavisualization.Diagram.Util.attr(e,v),i.appendChild(e),this.model.allowDrag&&this._setItemDraggable(e),this._renderAnchor(e,n,u,f)},_renderAnchor:function(n,i,r,u){var f=document.createElement("div"),o={id:i+"_anchor",height:r.height+"px","class":"e-anchor"},e;return t.datavisualization.Diagram.Util.attr(f,o),n.appendChild(f),e=this._renderSvg(f,i,r),this._renderText(f,i,r,u),e},_renderSvg:function(i,r,u){var s,f=document.createElement("div"),e={id:r+"_svgWrapper",width:this.model.paletteItemWidth+"px;",height:+this.model.paletteItemHeight+"px;","class":"e-svg-container",style:"width:"+u.width+"px;height:"+u.height+"px;"},o;return t.datavisualization.Diagram.Util.attr(f,e),e={id:r+"_svg",width:u.width,height:u.height,version:"1.1",xlink:"http://www.w3.org/1999/xlink"},o=new t.datavisualization.Diagram.Svg(e),f.appendChild(o.document),i.id.split("_clone").length>1&&(s=n(i).parents(".e-paletteItem")[0]),this._renderHtmlLayer(f,s),i.appendChild(f),o},_renderText:function(n,i,r,u){var e=document.createElement("div"),f,o,s;e.setAttribute("class","e-text-container");e.setAttribute("style","width:"+r.width+"px; text-align : center;overflow: hidden;text-overflow: ellipsis;font-size: 12px;");f=document.createElement("span");f.setAttribute("class","e-paletteItemText");u&&u.paletteItem&&(i=u.paletteItem.label?u.paletteItem.label:i);f.innerHTML=i.split("_clone").length>1?i.split("_clone")[0]:i;u&&u.paletteItem.wrapping==t.datavisualization.Diagram.TextWrapping.NoWrap&&(f.style.whiteSpace="nowrap",f.style.wordWrap="normal");u&&u.paletteItem.wrapping==t.datavisualization.Diagram.TextWrapping.Wrap&&(f.style.whiteSpace="pre-wrap",f.style.wordBreak="break-all",f.style.wordWrap="break-word");u&&u.paletteItem.wrapping==t.datavisualization.Diagram.TextWrapping.WrapWithOverflow&&(f.style.whiteSpace="pre-wrap",f.style.wordWrap="break-word");e.appendChild(f);this.model.showPaletteItemText||(e.style.display="none");n.appendChild(e);u&&!u.paletteItem.enableScale&&(o=document.getElementById(u.name+"_paletteItem"),s=document.getElementById(u.name+"_anchor").lastChild.getBoundingClientRect(),o.style.height=r.height+s.height+"px")},_renderNode:function(n,i,r){this._renderPetternDefinition(n.name,i);var f=t.datavisualization.Diagram.SvgContext.renderNode(n,i,null,!0,this),u=!1;i.document.getAttribute("drag")!=null&&(u=!0);this._transformItem(f,n.width,n.height,n,u,r)},_updateChildBounds:function(n,i){var u=null,f,r;if(n._type=="group"){for(f=this._getChildren(n.children),r=0;r<f.length;r++)u=i[f[r]],u._type=="group"&&this._updateChildBounds(u,i);t.datavisualization.Diagram.Util._updateChildBounds(n,this)}},_getChildren:function(n){var i,r,t;if(n){for(i=[],r=0;r<n.length;r++)t=n[r],t&&(typeof t=="object"?i.push(t.name):typeof t=="string"&&i.push(t));return i}},_renderGroup:function(n,i,r){this._renderPetternDefinition(n.name,i);this._updateChildBounds(n,this.nameTable);var f=t.datavisualization.Diagram.SvgContext.renderGroup(n,i,null,this.nameTable,this,!1,!1,!0),u=!1;i.document.getAttribute("drag")!=null&&(u=!0);this._transformItem(f,n.width,n.height,n,u,r)},_renderConnector:function(n,i,r){var e=t.datavisualization.Diagram.SvgContext.renderConnector(n,i),u=t.datavisualization.Diagram.Util.bounds(n),f=!1;i.document.getAttribute("drag")!=null&&(f=!0);this._transformItem(e,u.width,u.height,n,f,r)},_wireEvents:function(){this._on(this.element,t.eventType.click,".e-header",this._headerClick);this._on(this.element,t.eventType.mouseDown,".e-header",this._headerMouseDown);this._on(this.element,"mouseover",".e-header",this._headerMouseOver);this._on(this.element,"mouseout",".e-header",this._headerMouseOut);this._on(this.element,t.eventType.mouseDown,".e-paletteItem",this._itemMouseDown);this._on(this.element,"mouseover",".e-paletteItem",this._itemMouseOver);this._on(this.element,"mouseout",".e-paletteItem",this._itemMouseOut);this._on(this.element,t.eventType.click,".e-anchor",this._itemClick)},_headerClick:function(n){this._expandOrCollapsePalette("",n.currentTarget);var t=this._getActivePalette(n.currentTarget.id);t&&t!==this.activePalette&&(this.activePalette=t)},_headerMouseDown:function(n){n.preventDefault();n.stopPropagation()},_headerMouseOver:function(t){var i=this._getActivePalette(t.currentTarget.id);i&&this._canExpand(i)&&(n(t.currentTarget).addClass("hover"),n(t.currentTarget).find(".e-header-arrow").addClass("hover"))},_headerMouseOut:function(t){n(t.currentTarget).removeClass("hover");n(t.currentTarget).find(".e-header-arrow").removeClass("hover")},_itemMouseDown:function(i){var r,u,s,e,f,h,o;if(this.model.diagramId&&(r=n("#"+this.model.diagramId).ejDiagram("instance"),r.activeTool instanceof t.datavisualization.Diagram.LineTool&&(r.activeTool._showAllPorts(!0),r.deactivateTool())),this.model.allowDrag||(i.preventDefault(),i.stopPropagation()),this._selectedElement?this._selectedElement!==i.currentTarget&&(n(this._selectedElement).removeClass("selected"),this._selectedElement=i.currentTarget):this._selectedElement=i.currentTarget,n(i.currentTarget).hasClass("selected")||n(i.currentTarget).addClass("selected"),u=this._getActivePalette(i.currentTarget.parentElement.id),u&&u!==this.activePalette&&(this._clearHeaderSelection(),this._updateHeaderSelection(n(i.currentTarget.parentElement).prev()),this.activePalette=u),this.activePalette&&this._selectedElement)for(s=this._selectedElement.id.slice(0,this._selectedElement.id.lastIndexOf("_")),e=this.activePalette.items,f=0,h=e.length;f<h;f++)o=e[f],o.name===s&&(this.selectedItem=o)},_itemMouseOver:function(t){n(t.currentTarget).addClass("hover")},_itemMouseOut:function(t){n(t.currentTarget).removeClass("hover")},_itemDraStart:function(n){var t=n.originalEvent.dataTransfer;t.setData("Text",this.element[0].id);t.effectAllowed="copy"},_itemClick:function(i){var u,r,l,h,s,f,a,e,o,v,c,y;if((i.type==="click"||i.type==="touchend"&&!n(".dragClone")[0])&&this.model.diagramId){if(u=n("#"+this.model.diagramId).ejDiagram("instance"),r=n.extend(!0,{},this.selectedItem),r.name+=t.datavisualization.Diagram.Util.randomId(),r.type=="bpmn"&&(r.children=[]),l=u.getObjectType(r),l=="group"){for(h=this._getChildren(r.children),s=0;s<h.length;s++)f=n.extend(!0,{},this.nameTable[h[s]]),f.parent=r.name,f.name=r.name+f.name,r.children[s]=f.name,u.nameTable[f.name]=f,u.nodes().push(f),u._nodes=n.extend(!0,[],u.nodes()),u.nameTable[f]&&u._updateQuad(u.nameTable[f]);r.isLane||(r.height=r.width=0,u._updateChildBounds(r,u.nameTable))}r&&r.isLane&&(a=t.datavisualization.Diagram.Util.randomId(),u._cloneGroupNode(r,a),e=t.datavisualization.Diagram.SwimLaneHelper._createDiagramLane(r,u.nameTable),e.isLane=r.isLane,e.orientation=r.orientation,e.height=120,e=t.datavisualization.Diagram.Lane(e),o=t.datavisualization.Diagram.SwimLaneHelper._createSwimlane(e,u,null,!0),o&&(o.offsetX+=10,o.offsetY+=40));v=n.extend(!0,{},this._oldItem);c=o?o:r;this._oldItem=n.extend(!0,{},c);y={oldElement:v,newElement:c};this._trigger("selectionChange",y)}},_updatePaletteVisibility:function(n){this._canHeaderVisible(n)&&(this._canPaletteVisible(n)?(document.getElementById(n.name+"_header").style.display="",document.getElementById(n.name+"_content").style.display=""):(document.getElementById(n.name+"_header").style.display="none",document.getElementById(n.name+"_content").style.display="none"))},_collectionChanged:function(n){var t,i,r;n.changeType=="insert"?this._renderPalette(n.element):n.changeType=="remove"&&(t=n.element,t!=null&&(i=document.getElementById(t.name+"_header"),i&&i.parentNode.removeChild(i),r=document.getElementById(t.name+"_content"),r&&r.parentNode.removeChild(r)))},addPaletteItem:function(n,t){for(var u,i,r=0;r<this.model.palettes.length;r++)i=this.model.palettes[r],i.name===n&&(i.items.push(t),u=document.getElementById(n+"_content"),this._renderItem(t,u))},removePaletteItem:function(n,i){for(var r,u,f=0;f<this.model.palettes.length;f++)u=this.model.palettes[f],u.name===n&&(t.datavisualization.Diagram.Util.removeItem(u.items,i),r=document.getElementById(n+"_content"),r.removeChild(r.getElementsByClassName("e-paletteItem e-draggable e-js").item(i.name+"_paletteItem")),this.selectedItem=null)},expandPalette:function(n){var t=this._findPalette(n);t&&!t.expanded&&this._canExpand(t)&&(t.expanded=!0,this._expandOrCollapsePalette(n))},collapsePalette:function(n){var t=this._findPalette(n);t&&t.expanded&&this._canExpand(t)&&(t.expanded=!1,this._expandOrCollapsePalette(n))},addPalette:function(n){this.model.palettes.push(n);this._renderPalette(n)},removePalette:function(n){for(var r,u,i,f=0;f<this.model.palettes.length;f++)i=this.model.palettes[f],i.name===n&&(t.datavisualization.Diagram.Util.removeItem(this.model.palettes,i),r=document.getElementById(i.name+"_header"),r&&r.parentNode.removeChild(r),u=document.getElementById(i.name+"_content"),u&&u.parentNode.removeChild(u))},setWidth:function(n){this.model.width=n;this._setWidth(n)},setHeight:function(n){this.model.height=n;this._setHeight(n)},setPaletteItemWidth:function(n){this.model.paletteItemWidth=n;this._redrawContent()},setPaletteItemHeight:function(n){this.model.paletteItemHeight=n;this._redrawContent()},setHeaderHeight:function(n){this.model.headerHeight=n;this._setHeaderHeight(n)},setCssClass:function(n){this._setCssClass(n);this.model.cssClass=n},showPaletteItemText:function(n){this._showItemText(n);this.model.showPaletteItemText=n},searchPalette:function(n,i){var r=new t.datavisualization.Diagram.Collection;return i!=""&&(n=this._getSearchPaletteItems(i),r.add(n)),r},updatePalette:function(n,t){var r=this._findPalette(n),u,f;r&&t&&(t.constraints&&r.constraints!=t.constraints&&(r.constraints=t.constraints,u=document.getElementById(r.name+"_header"),this._renderHeaderArrow(u,r.expanded,r.name,this._canExpand(r)),this._disableClickClass(u,this._canExpand(r)),this._updatePaletteVisibility(r),u.style.display=this._canHeaderVisible(r)&&this._canPaletteVisible(r)?"":"none"),t.expanded!=i&&this._canExpand(r)&&(r.expanded=t.expanded,this._expandOrCollapsePalette(n)),t.items&&t.items.length>0&&(f=document.getElementById(r.name+"_content"),f.innerHTML="",r.items=t.items,this._initPaletteitems(r),this._updateNodeWidth(r),this._renderContent(r)));this.updateScrollerViewport()},_findPalette:function(n){for(var i,t=0;t<this.model.palettes.length;t++)if(this.model.palettes[t].name==n){i=this.model.palettes[t];break}return i},_canExpand:function(n){return n.constraints&t.datavisualization.Diagram.PaletteConstraints.Expandable},_canHeaderVisible:function(n){return n.constraints&t.datavisualization.Diagram.PaletteConstraints.HeaderVisibility},_canPaletteVisible:function(n){return n.constraints&t.datavisualization.Diagram.PaletteConstraints.Visible},_canClick:function(n){var t,i;if(n&&(t=n.id.split("_header")[0],t&&(i=this._findPalette(t),this._canExpand(i))))return!0},_expandOrCollapsePalette:function(t,i){var i=i||(t?document.getElementById(t+"_header"):null),r;if(i)if(this._canClick(i))r=this,n(i).next(".e-scontent").slideToggle(200,function(){r._refresh()}),this._updateHeaderState(i);else return!1},_getSearchPaletteItems:function(n){for(var f=new t.datavisualization.Diagram.Palette,u=this.model.palettes,r,i=0;i<u.length;i++)if(u[i].name.toLocaleLowerCase().search(n.toLocaleLowerCase())>=0)for(r=0;r<u[i].items.length;r++)this.element.find("#"+u[i].items[r].name+"_paletteItem")[0].style.display="block";else for(r=0;r<u[i].items.length;r++)this.element.find("#"+u[i].items[r].name+"_paletteItem")[0].style.display=u[i].items[r].name.toLocaleLowerCase().search(n.toLocaleLowerCase())>=0?"block":"none";return f},_disableClickClass:function(t,i){i?n(t).removeClass("e-disableclick"):n(t).addClass("e-disableclick")},_addExpandedClass:function(t,i){i?n(t).addClass("expanded"):n(t).addClass("collapsed")},_collapse:function(t){t.expanded||n(document.getElementById(t.name+"_header")).next(".e-scontent").slideToggle(10)},_transformItem:function(n,i,r,u,f,e){var h,v;if(!f)if(e&&!u.segments&&u.paletteItem&&u.paletteItem.width&&u.paletteItem.height&&u.paletteItem.enableScale){var w=30*e.width/100,b=30*e.height/100,o=(e.width-w)/u.width,s=(e.height-b)/u.height;o=s=Math.min(o,s);o=o>1?1:o;s=s>1?1:s;var c=e.width/2-i*o/2,l=e.height/2-r*s/2,a="";a+="translate("+c+","+l+")";a+="scale("+o+","+s+")";n.setAttribute("transform",a);h=n.parentNode.nextSibling;h||(h=document.getElementById(n.id+"_svgWrapper_htmlLayer"));h.style.webkitTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.MozTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.OTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.msTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.transform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";u&&t.browserInfo().name==="msie"&&u._type=="group"&&u.type==="html"&&(v=document.getElementById(u.name+"_html"),v.setAttribute("style","zoom:"+scale+";"))}else if(u.segments){if(e&&u.paletteItem&&u.paletteItem.width&&u.paletteItem.height||u.isPhase&&u.paletteItem&&u.paletteItem.enableScale){var w=e.width/10,b=e.height/10,o=(e.width-w)/i,s=(e.height-b)/r;o=s=Math.min(o,s);o=o>1?1:o;s=s>1?1:s;var c=e.width/2-i*o/2,l=e.height/2-r*s/2,a="";a+="translate("+c+","+l+")";a+="scale("+o+","+s+")";n.setAttribute("transform",a);h=document.getElementById(n.id+"_svgWrapper_htmlLayer");h.style.webkitTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.MozTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.OTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.msTransform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";h.style.transform="translate("+c+"px,"+l+"px) scale("+o+", "+s+")";u&&t.browserInfo().name==="msie"&&u._type=="group"&&u.type==="html"&&(v=document.getElementById(u.name+"_html"),v.setAttribute("style","zoom:"+scale+";"))}}else{var y=i/(i+u.borderWidth*3),p=r/(r+u.borderWidth*3),k=(i-i*y)/2,d=(r-r*p)/2;n.childNodes[0].setAttribute("transform","scale("+y+","+p+") translate("+k+","+d+")");u&&u.type==="image"&&n.childNodes[1]&&n.childNodes[1].setAttribute("transform","scale("+y+","+p+") translate("+k+","+d+")")}},_getScaleFactor:function(n,t){var u=30*this.model.paletteItemWidth/100,f=30*this.model.paletteItemHeight/100,i=(this.model.paletteItemWidth-u)/n,r=(this.model.paletteItemHeight-f)/t;return i=i>1?1:i,r=r>1?1:r,Math.min(i,r)},_getTranslateFactor:function(){var n=15/100*this.model.paletteItemWidth,t=15/100*this.model.paletteItemHeight;return Math.min(n,t)},_setWidth:function(n){this.element.css("width",n)},_setHeight:function(n){this.element.css("height",n)},_setHeaderHeight:function(n){var t,i;for(this.element.find(".e-header").css("height",n),this.element.find(".e-header-arrow").css("top",(n-16)/2),t=0;t<this.model.palettes.length;t++)i=this.model.palettes[t],i&&this._updateHeaderWrapper(i,n);this.updateScrollerViewport()},_updateHeaderWrapper:function(n,t){var i=document.getElementById(n.name+"_Wrapper"),r;i&&(r=i.getBoundingClientRect(),i.style.marginTop=t/2-r.height/2+"px")},_setCssClass:function(n){this.element.removeClass(this.model.cssClass).addClass(n)},_showItemText:function(n){n!==this.model.showPaletteItemText&&(n?this.element.find(".e-text-container").show():this.element.find(".e-text-container").hide())},_setAllowDrag:function(t){var i,e,r,u,f;if(this.model.allowDrag=t,i=this.model.palettes,i)for(r=0;r<i.length;r++)if(u=i[r].items,u)for(f=0;f<u.length;f++)e=document.getElementById(u[f].name+"_paletteItem"),this.model.allowDrag?this._setItemDraggable(e):n(e).ejDraggable("instance").destroy()},_cloneNode:function(n){var u=t.datavisualization.Diagram.Util.randomId(),r,i;if(n.children&&n.children.length>0)for(i=0;i<n.children.length;i++)r=this._cloneChildren(n.children[i],u),this.nameTable[r.name]=r,n.children[i]=r.name;return n.name+=u,n},_cloneChildren:function(t,i){if(typeof t=="object")return r=n.extend(!0,{},t),r.parent+=i,r.name+=i,r;if(typeof t=="string"){var r=this.nameTable[t];if(r)return this._cloneChildren(r,i)}},_setItemDraggable:function(i){var u=this.element[0].id,r=this;n(i).ejDraggable({clone:!0,cursorAt:{top:r.model.previewOffset.y,left:r.model.previewOffset.x},helper:function(){var f=n("#"+r.model.diagramId).ejDiagram("instance"),h,c,i,u,e,s;if(h=r.model.paletteItemWidth,c=r.model.paletteItemHeight,f._selectedSymbol=r.selectedItem,f._symbolPalette=r.model,i=n.extend(!0,{},r.selectedItem),i.type!="bpmn"&&(i=r._cloneNode(i)),i.isLane&&(r.model.paletteItemWidth=i.paletteItem&&i.paletteItem.previewWidth?i.paletteItem.previewWidth:r.model.previewWidth,r.model.paletteItemHeight=i.paletteItem&&i.paletteItem.previewHeight?i.paletteItem.previewHeight:r.model.previewHeight),u=r._getPreviewItemSize(r.selectedItem),e=r._renderItemContainer(r.selectedItem.name+"_clone",document.body,!0,u),e.document.setAttribute("drag","true"),f._paletteTable=r.nameTable,f._palNameTable=n.extend(!0,{},r.nameTable),i.segments){var o=t.datavisualization.Diagram.Util.bounds(i),l=(u.width-10)/o.width,a=(u.height-10)/o.height;t.datavisualization.Diagram.Util.scale(i,l,a,o.topLeft,f.nameTable);r._renderConnector(i,e,u)}else i.isLane&&i.paletteItem&&!i.paletteItem.enableScale||i.type==="bpmn"?(i.width=u.width,i.height=u.height,i.offsetX=i.width/2,i.offsetY=i.height/2):(i.width=u.width-10,i.height=u.height-10,u&&(u.width=u.width-10,u.height=u.height-10),i.offsetX=i.width/2+10,i.offsetY=i.height/2+1),r._updatePreviewSize(i,u),i._type=="node"?r._renderNode(i,e,u):r._renderGroup(i,e);return s=document.getElementById(r.selectedItem.name+"_clone_paletteItem"),n(s).addClass("dragClone"),r.model.paletteItemWidth=h,r.model.paletteItemHeight=c,n(s)},drag:function(){var t=this.helper[0];n("#"+r.selectedItem.name+"_clone_svg").css("padding","2px");n("#"+r.selectedItem.name+"_clone_svg").siblings(".htmlLayer").css("padding","2px");t&&t.setAttribute("paletteId",u)},dragStop:function(){var t=n("#"+r.model.diagramId).ejDiagram("instance");t._selectedSymbol=null;n(this.helper).remove()}})},_redrawContent:function(){for(var u,e,t,r,o,f=this.element.find(".e-scontent"),i=0,s=f.length;i<s;++i)if(u=f[i],n(u).empty(),e=this.model.palettes[i],t=e.items,t&&t.length>0)for(r=0,o=t.length;r<o;r++)this._renderItem(t[r],u)},_getPalette:function(n){for(var t,r=this.model.palettes,i=0,u=r.length;i<u;i++)if(t=r[i],t.name===n&&t!==this.activePalette)return t;return null},_getActivePalette:function(n){var t=n.slice(0,n.lastIndexOf("_"));return this._getPalette(t)},_updateHeaderState:function(n){this._clearHeaderSelection();this._updateExpandState(n);this._updateHeaderSelection(n)},_updateExpandState:function(t){n(t).hasClass("expanded")?(n(t).removeClass("expanded").addClass("collapsed"),n(t).find(".e-header-arrow").removeClass("expanded").addClass("collapsed"),n(t).attr("aria-expanded","false"),n(t).removeAttr("aria-selected")):(n(t).removeClass("collapsed").addClass("expanded"),n(t).find(".e-header-arrow").removeClass("collapsed").addClass("expanded"),n(t).attr("aria-selected","true"),n(t).attr("aria-expanded","true"))},_updateHeaderSelection:function(t){n(t).hasClass("selected")||(n(t).addClass("selected"),n(t).find(".e-header-arrow").addClass("selected"))},_clearHeaderSelection:function(){this.element.find(".e-header").removeClass("selected");this.element.find(".e-header-arrow").removeClass("selected")},_addItem:function(n,t){var i=document.getElementById(n.name+"_content");this._renderItem(t,i)},_removeItem:function(n,t){var i=document.getElementById(n.name+"_content");i.removeChild(document.getElementById(t.name+"_paletteItem"));t===this._selectedElement&&(this._selectedElement=null)},updateScrollerViewport:function(){var n=this.element.ejScroller("instance");n.model.touchScroll=!1;n.model.width=this._setViewPortWidth();n.model.height=this._setViewPortHeight();this._refresh()},_refresh:function(){this.element.ejScroller("refresh")},_getNodeDimension:function(n){var f=n._width,e=n._height,o=n.width?n.width:n.maxWidth?n.maxWidth:n.minWidth,i=document.createElement("span"),s=0,h=0,r,u;if(n.labels.length){for(t.datavisualization.Diagram.Util.attr(i,{id:n.name+"_label","class":"ej-d-label",style:"display: inline-block; position: absolute; pointer-events: all; line-height: normal;"}),this.element[0].appendChild(i),u=0;u<n.labels.length;u++)r=n.labels[u],r.bold&&(i.style.fontWeight="bold"),r.italic&&(i.style.fontStyle="italic"),i.style.textDecoration=r.textDecoration,i.style.fontFamily=r.fontFamily,i.style.fontSize=r.fontSize+"px",i.style.color=r.fontColor,i.style.backgroundColor=r.fillColor,i.style.borderColor=r.borderColor,i.style.borderWidth=r.borderWidth,i.textContent=r.text,i.style.wordWrap="break-word",i.style.whiteSpace="pre",o&&(i.style.maxWidth=o-(r.margin.left+r.margin.right)-r.fontSize+"px"),s+=i.offsetWidth+r.margin.left+r.margin.right,h+=i.offsetHeight+r.margin.top+r.margin.bottom;n._width=s;n._height=h;n.minWidth&&(n.minWidth>n._width||!n._width)&&(n._width=n.minWidth);n.maxWidth&&(n.maxWidth<n._width||!n._width)&&(n._width=n.maxWidth);n.minHeight&&(n.minHeight>n._height||!n._height)&&(n._height=n.minHeight);n.maxHeight&&(n.maxHeight<n._height||!n._height)&&(n._height=n.maxHeight);n.width||n.labels[0].horizontalAlignment!="left"||(n.offsetX+=(n._width-f)*(1-n.pivot.x));n.width||n.labels[0].horizontalAlignment!="right"||(n.offsetX-=(n._width-f)*n.pivot.x);n.height||n.labels[0].verticalAlignment!="top"||(n.offsetY+=(n._height-e)*(1-n.pivot.y));n.height||n.labels[0].verticalAlignment!="bottom"||(n.offsetY-=(n._height-e)*n.pivot.y);this.element[0].removeChild(i)}}})}(jQuery,Syncfusion),function(n,t){"use strict";var i,u,f,e,o,s,r,h,c,l,a,v,y,p,w,b;t.datavisualization.Diagram.extend=function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r};i=function(){function i(n,i){this.name=n;this.diagram=i;this.helper=null;this.inAction=!1;this.selectedObject=null;this.startPoint=t.datavisualization.Diagram.Point(0,0);this.currentPoint=t.datavisualization.Diagram.Point(0,0);this.previousPoint=t.datavisualization.Diagram.Point(0,0);this.cursor="default";this._currentPossibleConnection=null;this._previousPossibleConnection=null;this._possibleConnectionPort=null;this.singleAction=!1;this.svgHelper=null;this.single=null;this._centralPoint=t.datavisualization.Diagram.Point(0,0);this._enableAutoNode=null;this._prevTool=null;this.activeLabel=null;this._adjustLines={lines:[]}}return i.prototype.abort=function(){this._endAction();this.diagram.selectionList&&this.diagram.selectionList[0]&&t.datavisualization.Diagram.SvgContext.updateSelector(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom,this.diagram,this.diagram.model.selectedItems.constraints);this.diagram._removeTooltip()},i.prototype._snapTop=function(n,i,r,u,f,e){var o=u,s,c,h;if(i.top=!0,n.left=n.right=!1,s=this.diagram.model.snapSettings,c=this.diagram._currZoom,!this.diagram._enableSnapToObject()||f.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(h=this.initialBounds.y-this.initialBounds.height*f.pivot.y+u-(f.offsetY-f.height*f.pivot.y),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,r,h,this.selectedObject,e)),i.snapped)o=u-h+i.offset;else if(s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines){var l=this.initialBounds.y-this.initialBounds.height*f.pivot.y,a=l+u,v=t.datavisualization.Diagram.SnapUtil._round(a,s.horizontalGridLines.snapInterval,c);o=v-l}return o},i.prototype._getSwimLaneStackIndex=function(n){var u=null,i,r;return n.container.type=="canvas"&&(n.parent&&(i=this.diagram.nameTable[n.parent]),i&&(r=t.datavisualization.Diagram.Util.bounds(n),u=i.container.orientation==="vertical"?this.currentPoint.y>=r.y&&this.currentPoint.y<r.center.y?this._getIndex(i.children,n):this._getIndex(i.children,n)+1:this.currentPoint.x>=r.x&&this.currentPoint.x<r.center.x?this._getIndex(i.children,n):this._getIndex(i.children,n)+1)),u},i.prototype._getIndex=function(n,t){var r,i;if(n&&t){for(r=null,i=0;i<n.length;i++)if(r=this.diagram.nameTable[this.diagram._getChild(n[i])],r&&r.name==t.name)return i}else return-1},i.prototype._snapLeft=function(n,i,r,u,f,e){var o=r,s,c,h,a;if(n.left=!0,i.top=i.bottom=!1,s=this.diagram.model.snapSettings,c=this.diagram._currZoom,!this.diagram._enableSnapToObject()||f.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(h=this.initialBounds.x-this.initialBounds.width*f.pivot.x+r-(f.offsetX-f.width*f.pivot.x),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,h,u,this.selectedObject,e)),a=t.datavisualization.Diagram.Util.bounds(f),n.snapped)o=r-h+n.offset;else if(s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines){var l=this.initialBounds.x-this.initialBounds.width*f.pivot.x,v=l+r,y=t.datavisualization.Diagram.SnapUtil._round(v,s.horizontalGridLines.snapInterval,c);o=y-l}return o},i.prototype._snapBottom=function(n,i,r,u,f,e){var o=u,s,c,h,a;if(!this.diagram._disableSnap)if(i.bottom=!0,n.left=n.right=!1,s=this.diagram.model.snapSettings,c=this.diagram._currZoom,!this.diagram._enableSnapToObject()||f.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(h=this.initialBounds.y+this.initialBounds.height*(1-f.pivot.y)+u-(f.offsetY+f.height*(1-f.pivot.y)),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,r,h,this.selectedObject,e)),a=t.datavisualization.Diagram.Util.bounds(f),i.snapped)o=u-h+i.offset;else if(s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines){var l=this.initialBounds.y+this.initialBounds.height*(1-f.pivot.y),v=l+u,y=t.datavisualization.Diagram.SnapUtil._round(v,s.horizontalGridLines.snapInterval,c);o=y-l}return o},i.prototype._snapRight=function(n,i,r,u,f,e){var o=r,s,c,h;if(!this.diagram._disableSnap)if(n.right=!0,i.top=i.bottom=!1,s=this.diagram.model.snapSettings,c=this.diagram._currZoom,!this.diagram._enableSnapToObject()||f.rotateAngle||this.selectedObject.isLane||this.selectedObject.isSwimlane||(h=this.initialBounds.x+this.initialBounds.width*(1-f.pivot.x)+r-(f.offsetX+f.width*(1-f.pivot.x)),t.datavisualization.Diagram.SnapUtil._snapSize(this.diagram,n,i,h,u,this.selectedObject,e)),n.snapped)o=r-h+n.offset;else if(s.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines){var l=this.initialBounds.x+this.initialBounds.width*(1-f.pivot.x),a=l+r,v=t.datavisualization.Diagram.SnapUtil._round(a,s.verticalGridLines.snapInterval,c);o=v-l}return o},i.prototype.keydown=function(n){var i=n.keyCode?n.keyCode:n.which;i===27&&this.inAction?(this.diagram._selectedSymbol?(this.diagram._documentmouseup(n),this._removeHighLighter(),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diagram._selectedSymbol=null):(this.seletedObject||this.selectedObject)&&(this.selectedObject&&(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer)),this.seletedObject&&(t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.seletedObject,this.diagram._svg,this.diagram),t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.seletedObject,this.diagram._adornerSvg,this.diagram._adornerLayer)),this._removeHighLighter(),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram)),this.abort()):i===46&&this.inAction?(this.diagram._selectedSymbol&&(this.diagram._documentmouseup(n),this.diagram._selectedSymbol=null),this.abort()):this.inAction||i!=27||this.diagram._clearSelection()},i.prototype._getSwimlaneHeader=function(n){var t;return n&&n.isSwimlane&&n.children&&n.children.length>0&&(t=this.diagram.nameTable[n.children[0]]),t},i.prototype._removeHelpers=function(){t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer);t.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this.diagram._adornerLayer,this.diagram._adornerSvg);this._removeHighLighter()},i.prototype._cloneGroupNode=function(t,i){var o=null,r,u,e,f;if(u=n.extend(!0,{},t),u.name+=i,t&&t._type==="group")for(u.children=[],e=this.diagram._getChildren(t.children),f=0;f<e.length;f++)o=this.diagram.nameTable[e[f]],r=n.extend(!0,{},o),r.name+=i,r.parent&&(r.parent+=i),r._type==="group"&&this._cloneGroupNode(r,i),this.diagram.nameTable[r.name]=r,this.diagram.nodes().push(r),this.diagram._nodes=n.extend(!0,[],this.diagram.nodes()),u.children.push(r.name);return u},i.prototype._updateNextPhases=function(n,i,r){var o=0,s,u,e,f;for(o=n.orientation=="horizontal"?i:r,s=this.diagram._getPhaseIndex(n.name),e=this.diagram.nameTable[n.parent],f=s+1;f<e.phases.length;f++)u=this.diagram.nameTable[e.phases[f]],u&&(u.offset+=o),t.datavisualization.Diagram.SvgContext._updatephase(u,this.diagram)},i.prototype._getphase=function(n){return this.diagram.nameTable[n]},i.prototype._containsSwimlane=function(n){var i,t;for(i in n)if(t=this.diagram.nameTable[n[i]],t.isSwimlane||t.isLane)return!0;return!1},i.prototype._raiseEndPointDrag=function(n,t,i,r){if(t||i){var u,f,e,o;return f=this._currentPossibleConnection?this._currentPossibleConnection:null,e=this._possibleConnectionPort?this._possibleConnectionPort:null,o=this.currentPoint,u=t?"Target":"Source",this._raiseEvent("connector"+u+"Change",{element:n,node:f,port:e,point:o,dragState:r,cancel:!1})}},i.prototype._decideSelectedItem=function(n,t,i){var r=null,f,u;if(t)t.parent?this.diagram.selectionList&&this.diagram.selectionList[0]&&t.parent==this.diagram.selectionList[0].name&&!i?(r=t,this.diagram.selectionList[0].type=="bpmn"&&(r=this.diagram.selectionList[0])):i&&this.diagram.selectionList[0]&&this.diagram.selectionList[0].name==t.name?r=t:(f=this.diagram.nameTable[t.parent],t.isPhase?(u=t.name.split("phaseStack")[1],u&&(t=this.diagram.nameTable[u]),r=t):(r=this._decideSelectedItem(n,f,i),this.diagram.selectionList&&this.diagram.selectionList[0]&&r&&this.diagram.selectionList[0].name==r.name&&!i&&(r=t))):r=t;else return null;return r},i.prototype._isParentAsLane=function(n){for(var i,t,u,r=0;n.children&&r<n.children.length>0;r++)if(i=this.diagram.nameTable[this.diagram._getChild(n.children[r])],i&&(t=this.diagram.nameTable[i.parent],t&&t.isLane))return u=this.diagram.nameTable[t.parent],this.diagram._activeSwimLane=this.diagram.nameTable[u.parent],!0;return null},i.prototype._getAdjustjecentLines=function(n){if(!n.segments){for(var t=0;n.inEdges&&n.inEdges.length>0&&t<n.inEdges.length;t++)this._containsCollection(this._adjustLines.lines,this.diagram.nameTable[n.inEdges[t]])||this._adjustLines.lines.push(jQuery.extend(!0,{},this.diagram.nameTable[n.inEdges[t]]));for(t=0;n.outEdges&&n.outEdges.length>0&&t<n.outEdges.length;t++)this._containsCollection(this._adjustLines.lines,this.diagram.nameTable[n.outEdges[t]])||this._adjustLines.lines.push(jQuery.extend(!0,{},this.diagram.nameTable[n.outEdges[t]]))}},i.prototype._containsCollection=function(n,t){for(var i=0;n&&n.length>0&&i<n.length;i++)if(t&&n[i].name===t.name)return!0},i.prototype._updateMultipleUndoObject=function(n){for(var t,r=[],i=0;n.children&&n.children.length>0&&i<n.children.length;i++)t=this.diagram.nameTable[n.children[i]],t&&(r.push(jQuery.extend(!0,{},t)),this._getAdjustjecentLines(t));this._undoObject||(this._undoObject={collection:r,adjustLines:jQuery.extend(!0,{},this._adjustLines)})},i.prototype._updateNameTable=function(n){this.diagram._updateNameTable(n)},i.prototype._getParentSwimlane=function(n){var t;return n&&n.isLane?(t=this.diagram.nameTable[n.parent],this.diagram.nameTable[t.parent]):null},i.prototype._removeHighLighter=function(){t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer)},i.prototype._getPadding=function(n){var i=0,r=0,t;return n&&n.parent&&(t=this.diagram.nameTable[n.parent],t&&(i=t.paddingRight,r=t.paddingBottom)),{x:i,y:r}},i.prototype._findStackOverNode=function(n,i){var u,o,r,s,c,h,f,e;if(n&&(u=this.diagram.nameTable[n.parent],o=null,u))for(c=u.children.length,h=0;h<c;h++)if(o=this.diagram.nameTable[this.diagram._getChild(u.children[h])],r=this.mousePosition(i),s=t.datavisualization.Diagram.Util.bounds(o),f=this.diagram.nameTable[this.diagram._getChild(u.children[c-1])],e=this.diagram.nameTable[this.diagram._getChild(u.children[0])],u.container.orientation=="vertical"){if(r.y>=s.y&&r.y<=s.bottom)return o;if(r.y<=e.offsetY-e.height/2)return e;if(r.y>=f.offsetY+f.height/2)return f}else{if(r.x>=s.x&&r.x<=s.right)return o;if(r.x<=e.offsetX-e.width/2)return e;if(r.x>=f.offsetX+f.width/2)return f}},i.prototype._getPageBounds=function(){var i=t.datavisualization.Diagram.Rectangle(0,0,0,0),n=this.diagram.model.pageSettings;return i.x=n.boundaryConstraints==="diagram"?Math.min(this.diagram._getDigramBounds().x,0):0,i.y=n.boundaryConstraints==="diagram"?Math.min(this.diagram._getDigramBounds().y,0):0,i.width=n.boundaryConstraints==="page"?n.pageWidth?n.pageWidth:this.diagram.element.width():this.diagram.element.width(),i.height=n.boundaryConstraints==="page"?n.pageHeight?n.pageHeight:this.diagram.element.height():this.diagram.element.height(),i},i.prototype._nodeHighLighter=function(n){var f=null,r=null,u=null,i,o,e;n&&this.selectedObject.parent?(i=this.diagram.nameTable[this.selectedObject.parent],i.container&&i.container.type=="stack"&&this.selectedObject.name!=n.name?(o=this._stackOverNode,t.datavisualization.Diagram.SvgContext._drawStackHighlighter(o,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom,this.currentPoint,i.container.orientation==="vertical"?!0:!1)):i.container&&i.container.type=="canvas"&&this.selectedObject.parent!=n.name&&!n.isPhase&&t.datavisualization.Diagram.Util.canAllowDrop(n)?t.datavisualization.Diagram.Util._canBeTarget(this.diagram,n)&&t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):this._removeHighLighter()):n&&n.container&&!n.isSwimlane?this.selectedObject.isLane?(i=this.diagram.nameTable[n.parent],n.name.indexOf("phaseStack")===-1&&t.datavisualization.Diagram.SvgContext._drawStackHighlighter(n,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom,this.currentPoint,i.container.orientation==="vertical"?!0:!1)):t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):n.segments?this._removeHighLighter():t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom);this._nodeToHit&&n&&n.name!=this._nodeToHit.name&&(r=t.datavisualization.Diagram.Util.bounds(this._nodeToHit),u=this._getTargetNode(this._nodeToHit,r),this._raiseEvent("mouseLeave",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(this._nodeToHit),target:this.diagram.getNode(u)}));n?(this._nodeToHit&&this._nodeToHit.name!==n.name||!this._nodeToHit)&&(this._nodeToHit=n,this.selectedObject.parent&&(f=this.diagram.nameTable[this.selectedObject.parent]),this.selectedObject.type=="pseudoGroup"&&(e=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],e&&e.parent&&(f=this.diagram.nameTable[e.parent])),r=t.datavisualization.Diagram.Util.bounds(n),u=this._getTargetNode(n,r),this._raiseEvent("mouseEnter",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(f),target:this.diagram.getNode(u)})):this._nodeToHit=null;n&&(this.selectedObject.parent&&(f=this.diagram.nameTable[this.selectedObject.parent]),r=t.datavisualization.Diagram.Util.bounds(n),u=this._getTargetNode(n,r),this._raiseEvent("mouseOver",{element:this.diagram.getNode(this.selectedObject),source:this.diagram.getNode(f),target:this.diagram.getNode(u)}))},i.prototype._doubleClick=function(n){var t,i;n&&n.parent&&(t=this.diagram.nameTable[n.parent],t&&(i=n.name,this.diagram.updateSelectedObject(i),t.isLane||t.isSwimlane||t.isPhaseStack||(this.diagram._clearSelection(!0),this.diagram.addSelection(n,!0))))},i.prototype._itemClick=function(n,t,i,r){var u,e,o,f;t&&t.parent?(u=this.diagram.nameTable[t.parent],u&&(u.container?t&&!this.diagram._selectedSymbol&&(e=t.name,e.indexOf("_header_swimlane")!=-1?n&&this.diagram.updateSelectedObject(n.parent,u):e.indexOf("_Headerr_")!=-1?this.diagram.updateSelectedObject(t.parent):t&&t.isPhase?n.isPhase&&(f=this.diagram.nameTable[n.parent],f&&(this.diagram.selectionList.length===0||this.diagram.selectionList[0].name!=f.name)&&(this.diagram._clearSelection(!0),this.diagram.addSelection(n,!0),this.selectedObject=null)):this.diagram.updateSelectedObject(e)):u.type==="group"&&u.parent&&(o=this.diagram.nameTable[u.parent],o&&o.isLane&&(f=this._getSelectedItem(t,r),f&&this.diagram.updateSelectedObject(f.name))))):t&&this.diagram.updateSelectedObject(t.name);n&&(n.type=="pseudoGroup"||n.name=="multipleSelection")&&t&&!this._containsChild(n,t.name)&&this.diagram.updateSelectedObject(n.name)},i.prototype._getSelectedItem=function(n,t){var i;if(n&&n.parent)return i=this.diagram.nameTable[n.parent],t&&t.name==i.name?n:i.isLane?n:this._getSelectedItem(i)},i.prototype._getTargetNode=function(n,i){for(var e,o,u,s,h=null,f=[],c=t.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,i),r=0;r<c.length;r++)if(e=c[r],e.objects.length>0)for(o=0;o<e.objects.length;o++)u=e.objects[o],!u.segments&&u.visible&&(h=t.datavisualization.Diagram.Util.bounds(u),f.indexOf(u)==-1&&t.datavisualization.Diagram.Geometry.intersectsRect(i,h)&&f.push(u));for(s=[],s.push(n),r=0;r<f.length;r++)f[r].name!=n.name&&s.push(f[r]);return s},i.prototype._updateMargin=function(n,i){var o,s,f,r,u;if(n.type=="pseudoGroup")for(o=null,s=this.diagram._getChildren(n.children),f=0;f<s.length;f++)o=this.diagram.nameTable[s[f]],this._updateMargin(o,i);else if(i&&i.container&&i.container.type=="canvas"){var h=t.datavisualization.Diagram.Util.bounds(i),e=t.datavisualization.Diagram.Util.bounds(n),c=t.datavisualization.Diagram.Geometry.rect([e.topLeft,e.topRight,e.bottomRight,e.bottomLeft]);n.marginLeft=c.x-(h.x+i.paddingLeft);n.marginTop=c.y-(h.y+i.paddingTop);i.isLane&&(r=0,u=0,i.orientation==="horizontal"?(r=50,u=0):(r=0,u=50),n.marginLeft=n.marginLeft>=r?n.marginLeft:r,n.marginTop=n.marginTop>=u?n.marginTop:u)}},i.prototype._getNodeUnderMouse=function(){var n=this.diagram._nodeUnderMouse,r,f,u,i;if(this.diagram._focusedElement&&(this.diagram._focusedElement.isPhase||this.diagram._focusedElement.isLane||this.diagram._focusedElement.isSwimlane)&&(f=!0),this.diagram._focusedElement&&n&&this._containsChild(this.diagram._focusedElement,n.name)&&n&&(f||!t.datavisualization.Diagram.Util.canAllowDrop(n)))if(u=this.diagram.getObjectType(n),u=="connector"||u==="group")r=n;else if(n.parent){if(i=this.diagram.nameTable[n.parent],i&&i.container&&i.container.type=="stack"&&t.datavisualization.Diagram.Util.canAllowDrop(n))return n;u=this.diagram.getObjectType(i);i&&u!="node"&&(r=i)}if(r){if(this.selectedObject!=r&&t.datavisualization.Diagram.Util.canAllowDrop(r))return r}else if(n&&this.selectedObject!=n&&t.datavisualization.Diagram.Util.canAllowDrop(n))return n},i.prototype._isChange=function(n,t){var i=null;return n._type==="group"||n.type==="pseudoGroup"||t._type==="group"||t.type==="pseudoGroup"?(n._type!=="group"&&n.type!=="pseudoGroup"||t._type==="group"||t.type==="pseudoGroup"||(i=!this._containsChild(n,t.name)),n._type==="group"||n.type==="pseudoGroup"||t._type!=="group"&&t.type!=="pseudoGroup"?(n._type==="group"||n.type==="pseudoGroup")&&(t._type==="group"||t.type==="pseudoGroup")&&n.name==t.name&&(i=!0):i=!this._containsChild(t,n.name)):n.name==t.name&&(i=!0),i},i.prototype._containsChild=function(n,t){var u=!0,i=null,e,f,r;if(n.children)for(f=this.diagram._getChildren(n.children),r=0;r<f.length;r++)i=this.diagram.nameTable[f[r]],e=this.diagram.getObjectType(i),e==="group"?u=this._containsChild(i,t):i&&i.name==t&&(u=!1);return u},i.prototype._findNodeUnderMouse=function(i,r){var u=null,f=null,o,s=this.diagram._isForeignObject(i.target),e,h;return s&&(i.target=s),e=n(i.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),h=i.target.className,e&&(s||i.target.localName!="div")&&(o=e.attr("class"),o&&(o==="ej-d-node"||o==="ej-d-group"||t.datavisualization.Diagram.Util.isClassifier(i))?(f=this.diagram._findNode(e.attr("id")),f||(f=this.diagram._findNode(e.attr("id").split("_parentdiv")[0]))):o==="ej-d-connector"&&(f=this.diagram._findConnector(e.attr("id")))),u=f&&!f.parent?f:this._decideSelectedItem(i,f,r),this.prevSelectObject=u,r&&this.diagram.selectionList[0]&&(u&&u._type==="group"&&!this._containsChild(u,this.diagram.selectionList[0].name)?u=u:u&&this.diagram.selectionList[0].name!=u.name&&this._isChange(this.diagram.selectionList[0],u)?u=this.diagram.selectionList[0]:f&&f.name==this.diagram.selectionList[0].name&&!this._isChange(this.diagram.selectionList[0],u)&&(u=this.diagram.selectionList[0])),this.actualObject=f,u},i.prototype._findLabelUnderMouse=function(t,i,r){var u,h=n(t.target),c=h[0].getAttribute("class"),e,s,f,o;return c=="ej-d-label"?(e=n(t.target).parents(".ej-d-node,.ej-d-connector,.ej-d-group"),e&&(s=e[0].getAttribute("id"),f=e[0].getAttribute("class"),f&&(f==="ej-d-node"||f==="ej-d-group"?(u=this.diagram._findNode(s),o=this.diagram._findLabelAtPoint(r?r:this.currentPoint,u),this.activeLabel=o):f==="ej-d-connector"&&(u=this.diagram._findConnector(s),o=this.diagram._findLabelAtPoint(r?r:this.currentPoint,u),this.activeLabel=o)))):this.activeLabel=null,u},i.prototype._selectionContainsChild=function(n){var i,t,r,u,f;if(this.diagram.selectionList[0].children){for(i=this.diagram._getChildren(this.diagram.selectionList[0].children),t=null,r=0;r<i.length;r++)if(t=this.diagram.nameTable[i[r]],t&&t.name==n)return!0}else if(this.diagram.selectionList[0]._type==="group"&&this.diagram.selectionList[0].type!="pseudoGroup"){if(this.diagram.selectionList[0].name==n)return!0}else if(this.diagram.nameTable[n]&&this.diagram.nameTable[n]._type==="group"){for(i=this.diagram._getChildren(this.diagram.nameTable[n].children),u=0;u<i.length;u++)if(t=this.diagram.nameTable[i[u]],t&&(f=this._selectionContainsChild(t.name)),f)return f}else if(this.diagram.selectionList[0].name==n)return!0;return!1},i.prototype._isSelected=function(n){var u=null,i=this.diagram.nameTable[n],r,t;if(this._selectionContainsChild(i.name))return!0;if(i._type==="group")for(r=this.diagram._getChildren(i.children),t=0;t<r.length;t++)if(u=r[t],this._selectionContainsChild(u))return!0;return!1},i.prototype._isColleagueSelected=function(n){var u=this.diagram.nameTable[n],f=null,i,r,t;if(u.parent&&(i=this.diagram.nameTable[u.parent],i))for(r=this.diagram._getChildren(i.children),t=0;t<r.length;t++)if(f=r[t],this._isSelected(f))return!0;return!1},i.prototype._isInSelection=function(n){var i,r,t;if(this.diagram.selectionList[0].type=="pseudoGroup"&&this.diagram.selectionList[0].children)for(i=this.diagram._getChildren(this.diagram.selectionList[0].children),r=null,t=0;t<i.length;t++)if(r=this.diagram.nameTable[i[t]],r.name==n)return!0},i.prototype._getCloneNode=function(n){var t=null;return t=jQuery.extend(!0,{},n),t.children=[],t.minHeight=0,t.minWidth=0,t.maxHeight=0,t.maxWidth=0,t},i.prototype._getProcessedObject=function(n){var t=this.diagram.nameTable[n],i;if(t){if(this._isInSelection(n))return null;if(this._selectionContainsChild(t.name))return{add:t,remove:null};if(t.parent)if(this._selectionContainsChild(t.parent)){if(this._isInSelection(t.parent))return{add:t,remove:this.diagram.nameTable[t.parent]};if(i=this.diagram.nameTable[t.parent],i)return{add:i,remove:this.diagram.nameTable[i.parent]}}else return this._isColleagueSelected(t.parent)&&!this._selectionContainsChild(t.parent)?this._isSelected(t.parent)?{add:t,remove:null}:{add:this.diagram.nameTable[t.parent],remove:null}:this.diagram.selectionList[0]&&this._isInSelection(t.parent)?{add:this.diagram.nameTable[t.name],remove:this.diagram.nameTable[t.parent]}:this._getProcessedObject(t.parent);else return{add:t,remove:null}}},i.prototype.hasSameParent=function(){var n,t,u,r,i;if(this.selectedObject.type=="pseudoGroup"){if(n=this.selectedObject,t=null,this.diagram.nameTable[this.diagram._getChild(n.children[0])])for(u=this.diagram.nameTable[this.diagram._getChild(n.children[0])].parent,r=this.diagram._getChildren(n.children),i=0;i<r.length;i++)if(t=this.diagram.nameTable[r[i]],t.parent!=u||t.parent=="")return!1;return!0}return!1},i.prototype._fromDiagram=function(n){for(var r=!0,t=null,i=0;i<n.length;i++)if(t=this.diagram.nameTable[this.diagram._getChild(n[i])],t&&t.parent){r=!1;break}return r},i.prototype._fromContainer=function(n){for(var t=null,i=null,r=0;r<n.length;r++)if(t=this.diagram.nameTable[this.diagram._getChild(n[r])],t.parent&&(i=this.diagram.nameTable[t.parent],i&&i.container))return!0},i.prototype._fromSameContainer=function(n){for(var t=null,i=null,r=0;r<n.length;r++)if(t=this.diagram.nameTable[this.diagram._getChild(n[r])],!i&&t.parent&&(i=t.parent),t.parent&&t.parent!=i)return!1;return!0},i.prototype._anyFromContainer=function(n){for(var i=null,t=null,r=0;r<n.length;r++)if(i=this.diagram.nameTable[this.diagram._getChild(n[r])],i.parent&&(t=this.diagram.nameTable[i.parent]),t&&t.container&&t.container.type==="canvas")return!0;return!1},i.prototype._processCtrlKey=function(i){var s,r,e,b,l,f,u;if(this.diagram.selectionList.length>0&&t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)){var o=this.diagram.selectionList,a,f,h,v=[],y=[],p=[];o[0].type=="pseudoGroup"?(a=!0,s=this._findNodeUnderMouse(i)):s=this._findNodeUnderMouse(i);var w=this._findNodeUnderMouse(i,!0),k=this.selectedObject,c=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:w,cancel:!1,event:i});if(this._itemClick(this.selectedObject,this.actualObject,w),c.cancel&&(this.selectedObject=k),this.actualObject)if(this.actualObject.parent)a?(r=o[0],e=this._getProcessedObject(this.actualObject.name),e?(this.selectedObject?(r.children=this.diagram._getChildren(r.children),t.datavisualization.Diagram.Util.removeItem(r.children,this.selectedObject.name)):e.remove&&(r.children=this.diagram._getChildren(r.children),t.datavisualization.Diagram.Util.removeItem(r.children,e.remove.name)),this.selectedObject?this._hasMultipleSelection(this.selectedObject)||r.children.push(this.selectedObject.name):e.add&&(this._hasMultipleSelection(e.add)||r.children.push(e.add.name))):(f=this.actualObject,this.selectedObject?this._hasMultipleSelection(this.selectedObject)?(r.children=this.diagram._getChildren(r.children),t.datavisualization.Diagram.Util.removeItem(r.children,this.selectedObject.name)):r.children.push(this.selectedObject.name):this._hasMultipleSelection(f)?(r.children=this.diagram._getChildren(r.children),t.datavisualization.Diagram.Util.removeItem(r.children,f.name)):r.children.push(f.name)),t.datavisualization.Diagram.Util._updateGroupBounds(r,this.diagram),r.children.length<=1?(b=this.diagram.nameTable[this.diagram._getChild(r.children[0])],this.diagram._hasSelection()&&this.diagram._clearSelection(!0),this.selectedObject=b,this.diagram._addSelection(this.selectedObject)):(this.selectedObject=o[0],this.diagram.updateSelection())):(this.diagram.selectionList[0]._type==="group"&&this.diagram.selectionList[0].type!=="bpmn"?(o=this.diagram.selectionList[0],e=this._getProcessedObject(this.actualObject.name),f=e.add,e&&this.diagram._hasSelection()&&this.diagram._clearSelection()):(e=null,s._type==="group"&&(e=this._getProcessedObject(this.actualObject.name)),f=e?e.add:s,o=this.diagram.selectionList[0],this.diagram._hasSelection()&&this.diagram._clearSelection()),this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Keydown,u=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),o.name!=f.name&&u.children.push(o.name),this.selectedObject?u.children.push(this.selectedObject.name):this._containsChild(u,f.name)&&u.children.push(f.name),this._checkRepeatedChild(u.children),this.diagram.nodes().push(u),this.diagram._nodes=n.extend(!0,[],this.diagram.nodes()),this.diagram.nameTable[u.name]=u,t.datavisualization.Diagram.Util._updateGroupBounds(u,this.diagram),this.selectedObject=u,this.diagram._addSelection(this.selectedObject));else if(a){for(r=o[0],f=this.selectedObject?this.selectedObject:this.actualObject,h=this._hasMultipleSelection(f)?"remove":"insert",h=="insert"?(r.children.push(f.name),v.push(f)):(t.datavisualization.Diagram.Util.removeItem(r.children,f.name),y.push(f)),l=0;l<r.children.length;l++)p.push(this.diagram.nameTable[r.children[l]]);c={changeType:h,element:this.diagram.nameTable.multipleSelection,selectedItems:p,oldItems:y,newItems:v,cancel:!1};this._raiseEvent("selectionChange",c);c.cancel||(h=="remove"&&t.datavisualization.Diagram.Util.removeItem(this.diagram.model.selectedItems.children,f),this.diagram.updateSelection(this.selectedObject),t.datavisualization.Diagram.Util._updateGroupBounds(r,this.diagram),this.selectedObject=o[0],this.diagram.model.selectedItems.children.length?t.datavisualization.Diagram.SvgContext.updateSelector(this.selectedObject,this.diagram._adornerSvg,this.diagram._currZoom,this.diagram,this.diagram.model.selectedItems.constraints):(t.datavisualization.Diagram.Util.clear(this.diagram.selectionList),t.datavisualization.Diagram.SvgContext.clearSelector(this.diagram._adornerSvg,this.diagram._adornerLayer)))}else f=this.actualObject,this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Keydown,o=this.diagram.selectionList[0],f!=o&&(this.diagram._hasSelection()&&this.diagram._clearSelection(!0),u=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),u.children.push(o.name),this.selectedObject?u.children.push(this.selectedObject.name):u.children.push(f.name),this.diagram.nodes().push(u),this.diagram._nodes=n.extend(!0,[],this.diagram.nodes()),this.diagram.nameTable[u.name]=u,t.datavisualization.Diagram.Util._updateGroupBounds(u,this.diagram,null,!0),this.selectedObject=u,this.diagram._addSelection(this.selectedObject));this.selectedObject=this.diagram.selectionList[0]}else s=this._findNodeUnderMouse(i),this.selectedObject=s;return s},i.prototype._checkRepeatedChild=function(i){for(var e=null,r=n.extend(!0,{},i),u,r=this.diagram._getChildren(r),f=0;f<r.length;f++)if(e=this.diagram.nameTable[r.children[f]],e._type==="group")for(u=0;u<r.children.length;u++)this._containsChild(e,r.children[u])||(i.children=this.diagram._getChildren(i.children),t.datavisualization.Diagram.Util.removeItem(i.children,r.children[u]))},i.prototype._hasMultipleSelection=function(n){for(var i=this.diagram._getChildren(this.diagram.selectionList[0].children),t=0;t<i.length;t++)if(n.name==i[t])return!0;return!1},i.prototype._getNextParent=function(n){if(n.parent){var t=this.diagram.nameTable[n.parent];return this._hasMultipleSelection(t)?n:this._getNextParent(t)}return n},i.prototype._findObj=function(n,t){var r,u=n.getAttribute("id"),i;return t?r=this.diagram._findChildren(t,u):(i=n.getAttribute("class"),i&&(i==="ej-d-node"||i==="ej-d-group"?r=this.diagram._findNode(u):i==="ej-d-connector"&&(r=this.diagram._findConnector(u)))),r},i.prototype.mousedown=function(n){this.startPoint=this.mousePosition(n);this.currentPoint=this.startPoint;this.previousPoint=this.startPoint;this.diagramBounds=this.diagram._getDigramBounds()},i.prototype.mousemove=function(n){(!t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||this instanceof t.datavisualization.Diagram.LineTool)&&(this.currentPoint=this.mousePosition(n))},i.prototype.mouseup=function(){this._endAction();this.diagram._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(this.diagram);this.singleAction&&this.diagram.activateTool("select");delete this.diagramBounds;this._adjustLines={lines:[]};this._undoObject=null;this._redoObject=null},i.prototype.mousePosition=function(n){return this.diagram._mousePosition(n)},i.prototype.updateCursor=function(n){this.diagram._currentCursor=n;this.diagram._updateCursor()},i.prototype.nearestGridPoint=function(n){var i=t.datavisualization.Diagram.Point();if(this.diagram.model.snap&t.datavisualization.Diagram.Snap.Grid){var o=this.diagram.model.magnification/100,r=this.diagram.model.grid.horizontalSpacing*o,u=this.diagram.model.grid.verticalSpacing*o,f=n.x%r,e=n.y%u;i.x=f>=r/2?n.x+r-f:n.x-f;i.y=e>=u/2?n.y+u-e:n.y-e}return i},i.prototype.snap=function(n){var i=this.diagram.model.snapSettings,r=this.diagram._currZoom;return i.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines&&(n.x=t.datavisualization.Diagram.SnapUtil._round(n.x,i.verticalGridLines.snapInterval,r)),i.snapConstraints&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines&&(n.y=t.datavisualization.Diagram.SnapUtil._round(n.y,i.horizontalGridLines.snapInterval,r)),n},i.prototype._endAction=function(){var i,r,s,u,h,f,o,c,e;if(this.inAction=!1,this.svgHelper)if(i=this.helper,r=this.diagram._spatialSearch,i._type!="group")t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(r,r.quadTable[i.name],i);else for(s=this.helper.children.length-1,u=s;u>=0;u--)t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(r,r.quadTable[i.children[u].name],i.children[u]);this.helper&&(this.svgHelper&&(h=this.diagram,f=this,this.diagram._views.forEach(function(t){var r=h._views[t];if(f.helper)var i=r.svg.getElementById(f.helper.name),u=r.svg.document.parentNode.getElementsByClassName("htmlLayer")[0],e=n(u).find("#"+f.helper.name)[0];i&&i.parentNode&&i.parentNode.removeChild(i);e&&u.removeChild(e)})),this.helper.gradient&&(o=this.diagram._svg.getElementsByTagName("defs")[0],c=this.diagram._svg.getElementById(this.helper.name+"_gradient"),o&&c&&o.removeChild(this.diagram._svg.getElementById(this.helper.name+"_gradient"))),e=document.getElementById(this.helper.name+"_parentdiv"),e&&e.parentNode.removeChild(e));this._previousPossibleConnection&&(this._previousPossibleConnection=null,t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer));this._currentPossibleConnection=null;this._possibleConnectionPort=null;this.helper=null;this.svgHelper=null;this.selectedObject=null;this.startPoint=t.datavisualization.Diagram.Point(0,0);this.currentPoint=t.datavisualization.Diagram.Point(0,0);this.previousPoint=t.datavisualization.Diagram.Point(0,0)},i.prototype._isResizeCorner=function(n){var t=!1;switch(n){case"n-resize":case"e-resize":case"w-resize":case"s-resize":case"ne-resize":case"nw-resize":case"se-resize":case"sw-resize":case"targetEndPoint":case"sourceEndPoint":t=!0}return t},i.prototype._initHelper=function(){this.selectedObject&&(this.helper=n.extend(!0,{},this.selectedObject),this._updateHelperName(this.helper))},i.prototype._updateHelperName=function(n,t){var u,i,r,f,e;for(t?n.name+="helper":n.name="helper",n.opacity=.5,u=n.labels,i=0,r=u.length;i<r;++i)u[i].name+="helper";if(n.ports)for(f=n.ports,i=0,r=f.length;i<r;++i)f[i].name+="helper";if(n._type==="group")for(e=this.diagram._getChildren(n.children),i=0,r=e.length;i<r;i++)this._updateHelperName(e[i],!0)},i.prototype._raiseEvent=function(n,t){return this.diagram.model[n]&&(t.elementType=this.diagram.getObjectType(t.element),this.diagram._trigger(n,t)),t},i.prototype._findPort=function(n,t){var f=this.diagram._findPortAtPoint(n,t),r,e,u,i;if(!f&&t._type==="group")for(e=this.diagram._getChildren(t.children),u=0;u<e.length;u++)if(i=this.diagram.nameTable[e[u]],i&&!i.segments)if(r=this._findPort(n,i),r&&i._type!="group")this._currentPossibleConnection=i,f=r;else if(r)return r;return f},i.prototype._checkConnectionPossible=function(n){var u=null,p=t.datavisualization.Diagram.Point(this.currentPoint.x,this.currentPoint.y),f=this.diagram._findConnectableNodeUnderMouse(n),e,c,l,i,o,s,r,v;if(f&&!f.segments)f.type=="pseudoGroup"||f.isLane||f.isSwimlane?(this._currentPossibleConnection=null,this._possibleConnectionPort=null):(this._showPorts(f),this._currentPossibleConnection=f,(this._previousPossibleConnection==null||this._previousPossibleConnection.name!==this._currentPossibleConnection.name)&&(this._previousPossibleConnection=this._currentPossibleConnection));else if(this.diagram.activeTool instanceof t.datavisualization.Diagram.LineTool)this._showPorts(),this._currentPossibleConnection=null,this._possibleConnectionPort=null;else{for(e=t.datavisualization.Diagram.Point(0,0),this._endPoint=="targetEndPoint"?(e.x=this.selectedObject.targetPoint.x-25,e.y=this.selectedObject.targetPoint.y-25):this._endPoint=="sourceEndPoint"&&(e.x=this.selectedObject.sourcePoint.x-25,e.y=this.selectedObject.sourcePoint.y-25),c=t.datavisualization.Diagram.Rectangle(e.x,e.y,50,50),l=t.datavisualization.Diagram.SpatialUtil.findQuads(this.diagram._spatialSearch,c),i=0;i<this._nearestNodes.length;i++)this._showPort(this._nearestNodes[i],!0);for(this._nearestNodes=[],i=0;i<l.length;i++)if(o=l[i],o.objects.length>0)for(s=0;s<o.objects.length;s++)r=o.objects[s],v=t.datavisualization.Diagram.Util.bounds(r),t.datavisualization.Diagram.Geometry.intersectsRect(c,v)?!r.segments&&r.visible&&(this._showPort(r),this._nearestNodes.push(r)):r.segments||this._showPort(r,!0);this._currentPossibleConnection=null;this._possibleConnectionPort=null}if(this._currentPossibleConnection){if(u=this._findPort(p,this._currentPossibleConnection),u&&t.datavisualization.Diagram.Util.canConnect(u,!0)||t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)?t.datavisualization.Diagram.SvgContext._drawPortHighlighter(u,this._currentPossibleConnection,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom):t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._possibleConnectionPort=u,u&&t.datavisualization.Diagram.Util.canConnect(u,!0)){var h=this._currentPossibleConnection,a=t.datavisualization.Diagram.Util._getPortPosition(this._possibleConnectionPort,t.datavisualization.Diagram.Util.bounds(h,!0)),y=t.Matrix.identity();t.Matrix.rotate(y,h.rotateAngle,h.offsetX,h.offsetY);a=t.Matrix.transform(y,a);this.currentPoint=a}}else this._previousPossibleConnection&&(this._previousPossibleConnection=null,t.datavisualization.Diagram.SvgContext._removePortHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._possibleConnectionPort=null)},i.prototype._showPorts=function(n){n?(this._currentPossibleConnection&&this._currentPossibleConnection.name!==n.name&&this._showPort(this._currentPossibleConnection,!0),this._showPort(n)):this._currentPossibleConnection!=null&&this._showPort(this._currentPossibleConnection,!0)},i.prototype._showPort=function(n,i){var r,u,e,f,o;if(i){if(r=n.ports,r)for(f=0,o=r.length;f<o;++f)u=r[f],(u.visibility&t.datavisualization.Diagram.PortVisibility.Hover||u.visibility&t.datavisualization.Diagram.PortVisibility.Connect&&(this.name=="endPoint"||this instanceof t.datavisualization.Diagram.LineTool))&&(e=this.diagram._svg.getElementById(n.name+"_"+u.name),e&&e.setAttribute("visibility","hidden"))}else if(n.visible&&(r=n.ports,r))for(f=0,o=r.length;f<o;++f)u=r[f],(u.visibility&t.datavisualization.Diagram.PortVisibility.Hover||u.visibility&t.datavisualization.Diagram.PortVisibility.Connect&&(this.name=="endPoint"&&this.inAction||this instanceof t.datavisualization.Diagram.LineTool))&&(e=this.diagram._svg.getElementById(n.name+"_"+u.name),e&&e.setAttribute("visibility","visible"))},i.prototype._getAllLaneChildren=function(n,t){var i=this.diagram.getNode(n.name),r,u;if(i&&i.lanes&&i.lanes.length>0)for(r=0;r<i.lanes.length;r++)for(u=0;u<i.lanes[r].children.length;u++)t.push(i.lanes[r].children[u]);return t},i.prototype._getAllChildren=function(n){for(var t=0;t<n.length;t++)n[t].isSwimlane&&n.concat(this._getAllLaneChildren(n[t],n));return n},i.prototype._showAllPorts=function(n){var i,u,r=this.diagram.nodes();if(r=this._getAllChildren(r),t.datavisualization.Diagram.Util.isPageEditable(this.diagram)||(n=!0),n)for(i=0,u=r.length;i<u;i++)this._showPort(r[i],n);else for(i=0,u=r.length;i<u;++i)this._showPort(r[i])},i.prototype._disconnect=function(n){var r,i=this.diagram.nameTable[n.targetNode],u=null;i&&(u=t.datavisualization.Diagram.Util.findPortByName(i,n.targetPort),r=this._raiseEvent("connectionChange",{element:n,connection:i,port:u,cancel:!1}),r.cancel||(t.datavisualization.Diagram.Util.removeItem(i.inEdges,n.name),n.targetNode=null,n.targetPort=null));i=this.diagram.nameTable[n.sourceNode];i&&(u=t.datavisualization.Diagram.Util.findPortByName(i,n.sourcePort),r=this._raiseEvent("connectionChange",{element:n,connection:i,port:u,cancel:!1}),r.cancel||(t.datavisualization.Diagram.Util.removeItem(i.outEdges,n.name),n.sourceNode=null,n.sourcePort=null))},i.prototype.getLabelUnderMouse=function(){return this.diagram._findLabelEditing?null:this.activeLabel},i}();t.datavisualization.Diagram.ToolBase=i;u=function(i){function r(n){i.call(this,"select",n);this.cursor="default";this._svgHelper=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);var r=this._findNodeUnderMouse(n);this.selectedObject=r&&t.datavisualization.Diagram.Util.canSelect(r)?r:null;this._itemClick(this.selectedObject,this.actualObject,this.selectedObject);this._nodeUnderMouseDown=this.diagram._findNodeUnderMouse(n)},r.prototype.mousemove=function(n){i.prototype.mousemove.call(this,n);var r=this._nodeUnderMouseDown;(!this.selectedObject&&!t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||r&&r.isLane&&t.datavisualization.Diagram.Util.canMultiSelectOnLane(r)||r&&r._type!="connector"&&t.datavisualization.Diagram.Util.canMultiSelectOnNode(r))&&t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)&&(this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y?this._updateHelper():(this.inAction=!0,this._initHelper()))},r.prototype.mouseup=function(r){var c,f,l,b,u,e,y,o,p,s,v,h,a,k,w;if(this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Mouse,this.inAction)if(this.currentPoint=this.mousePosition(r),c=t.datavisualization.Diagram.Geometry.rect([{x:this.startPoint.x,y:this.startPoint.y},{x:this.currentPoint.x,y:this.currentPoint.y}]),c.width!==0||c.height!==0){for(e=[],y=this.diagram.nodes(),f=0,l=y.length;f<l;f++)o=this.diagram.nameTable[y[f].name],o&&o.visible&&(u=t.datavisualization.Diagram.Util.bounds(o),u=t.datavisualization.Diagram.Geometry.rect([u.topLeft,u.topRight,u.bottomRight,u.bottomLeft]),t.datavisualization.Diagram.Util.canSelect(o)&&(b=this.diagram.getObjectType(o),t.datavisualization.Diagram.Geometry.containsRect(c,u)?o.parent===""&&e.push(o):b==="group"&&this._checkGroupChildren(e,o,c)));for(p=this.diagram.connectors(),f=0,l=p.length;f<l;f++)s=this.diagram.nameTable[p[f].name],s&&s.visible&&(u=t.datavisualization.Diagram.Util.bounds(s),u=t.datavisualization.Diagram.Geometry.rect([u.topLeft,u.topRight,u.bottomRight,u.bottomLeft]),t.datavisualization.Diagram.Util.canSelect(s)&&t.datavisualization.Diagram.Geometry.containsRect(c,u)&&s.parent===""&&e.push(s));if(this.diagram._hasSelection()&&(e=this.diagram._getChildren(e),t.datavisualization.Diagram.Util.removeItem(e,"multipleSelection"),this.diagram._clearSelection(e.length?!0:!1)),e.length>0){if(v=e,this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.RubberBand,v.length>1){for(a=t.datavisualization.Diagram.Group({type:"pseudoGroup",name:"multipleSelection"}),f=0,l=v.length;f<l;f++)a.children.push(this.diagram._getChild(v[f]));this.diagram.nodes().push(a);this.diagram._nodes=n.extend(!0,[],this.diagram.nodes());this.diagram.nameTable[a.name]=a;h=a}else t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&(h=e[0]);h&&((h._type==="group"||h.type==="pseudoGroup")&&t.datavisualization.Diagram.Util._updateGroupBounds(h,this.diagram),this.diagram._addSelection(h))}}else this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();else this.selectedObject||this.diagram._hasSelection()?(r.ctrlKey||r.shiftKey?t.datavisualization.Diagram.Util.canDoMultipleSelection(this.diagram)&&this._processCtrlKey(r):this.diagram._hasSelection()&&(!this.selectedObject||this.diagram.selectionList[0].name!=this.selectedObject.name)&&this.diagram._clearSelection(this.selectedObject?!0:!1),this.diagram._enableAPIMethods=!1,this.diagram._addSelection(this.selectedObject),this.diagram._enableAPIMethods=!0):this.diagram._hasSelection()&&!this.diagram._isDropped&&this.diagram._clearSelection();this.diagram._isDropped=!1;this._nodeUnderMouseDown=null;(this.selectedObject||this.actualObject)&&(k=this.selectedObject||this.actualObject,w=this.diagram._mousePosition(r.originalEvent),this._raiseEvent("click",{element:this.diagram.getNode(k),actualObject:this.actualObject,count:this.diagram._getEventDetail(r),offsetX:w.x,offsetY:w.y,event:r}));i.prototype.mouseup.call(this,r)},r.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this.selectedObject=null,this._svgHelper=null);i.prototype._endAction.apply(this)},r.prototype._initHelper=function(){var n,t,i;this._svgHelper||(n=this.diagram._adornerSvg.g(),this.diagram._adornerLayer.appendChild(n),t=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper","class":"rubberBandSelection",x:this.startPoint.x*t,y:this.startPoint.y*t,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),n.appendChild(i),n.setAttribute("pointer-events","none"),this._svgHelper=n)},r.prototype._updateHelper=function(){var t=this.diagram._adornerSvg.getElementById("helper"),i=Math.abs(this.startPoint.x-this.currentPoint.x),r=Math.abs(this.startPoint.y-this.currentPoint.y),n=this.diagram._currZoom,u=(this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x)*n,f=(this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y)*n;t&&this.diagram._adornerSvg.rect({id:t.id,x:u,y:f,width:i*n,height:r*n})},r.prototype._checkGroupChildren=function(n,i,r){for(var u,e,o=this.diagram._getChildren(i.children),f=0;f<o.length;f++)u=this.diagram.nameTable[o[f]],u&&t.datavisualization.Diagram.Util.canSelect(u)&&(e=t.datavisualization.Diagram.Util.bounds(u),t.datavisualization.Diagram.Geometry.containsRect(r,e)&&n.indexOf(u)<0?n.push(u):u._type==="group"&&this._checkGroupChildren(n,u,r))},r}(i);t.datavisualization.Diagram.SelectTool=u;f=function(i){function r(n){i.call(this,"move",n);this.cursor="move";this._isMouseDown=!1;this.diffx=0;this.diffy=0;this.helper=null;this.hoverNode=null;this.stackOverNode=null;this.undoObject=[];this.activeLabel=null;this._canMoveLabel=!1;this.dragState=""}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){if(t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diffx=0,this.diffy=0,this._allowPan(this.selectedObject,"mousedown",n),i.prototype.mousedown.call(this,n),this._isMouseDown=!0,this._canMoveLabel=!1,this.activeLabel=null,n)var r=this._findNodeUnderMouse(n);r&&!t.datavisualization.Diagram.Util.canSelect(r)?this.updateCursor("default"):this.diagram._currentCursor!="pointer"&&this.updateCursor(this.cursor);this._findLabelUnderMouse(n);this.dragState=t.datavisualization.Diagram.DragState.Starting},r.prototype.mousemove=function(r){var o,u,f,s,h,e,c;this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Mouse;this._allowPan(this.selectedObject,"mousemove",r);i.prototype.mousemove.call(this,r);t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);o=!this.inAction;this._isMouseDown&&!this.inAction&&(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y||this.diagram._selectedSymbol)&&(this.selectedObject||(this._updateSelectedObject(),this._itemClick(this.selectedObject,this.actualObject,this.diagram.model),this.selectedObject!=null&&(u=f=t.datavisualization.Diagram.Util.bounds(this.selectedObject),s={bounds:{x:f.x,y:f.y,width:f.width,height:f.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},h={bounds:{x:u.x,y:u.y,width:u.width,height:u.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this.diagram.selectionList[0]!=this.selectedObject&&this.diagram._clearSelection(!0),this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:{x:0,y:0},oldValue:s,newValue:h,cancel:!1}),e={},this.selectedObject&&(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(e=this.diagram._getChildTable(this.selectedObject,e)),c=n.extend(!0,{},{childTable:e,node:this.selectedObject}),this.undoObject=jQuery.extend(!0,{},c))));this._isMouseDown&&this.selectedObject&&t.datavisualization.Diagram.Util.canSelect(this.selectedObject)&&!this.diagram._isEditing&&(this.dragState=t.datavisualization.Diagram.DragState.Dragging,this.inAction||(this.inAction=!0,this._canMoveLabel||this.updateCursor("move"),this._updateSelection(),this.selectedObject.segments&&!this._canMoveLabel&&(t.datavisualization.Diagram.Util.isTargetConnected(this.selectedObject)||t.datavisualization.Diagram.Util.isSourceConnected(this.selectedObject))&&this._disconnect(this.selectedObject),t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram)),this._canMoveLabel?this._updateLabelXY(this.activeLabel,this.previousPoint,this.currentPoint):(this.diagram&&!this.diagram._isEditing&&this._containerMouseMove(r),this.helper||this._updateObject(),this.selectedObject.segments||this.selectedObject.isLane||this.diagram._renderTooltip(this.selectedObject,o),this.diagram._updateSelectionHandle(!0)));this.previousPoint=this.currentPoint;this._stackOverNode=this._findStackOverNode(this.helper,r)},r.prototype._updateSelectedObject=function(){var n=this.diagram._focusedElement;n&&(this.activeLabel&&(t.datavisualization.Diagram.Util.canMoveLabel(n)?this._canMoveLabel=!0:(this._disableLabel(n,this.activeLabel),this._canMoveLabel=!1)),this.diagram.selectionList[0]&&this.diagram.selectionList[0].type=="pseudoGroup"?this._canMoveLabel?(this.selectedObject=n,this.diagram._clearSelection(!0)):this.selectedObject=this.diagram.selectionList[0]:this.diagram.selectionList[0]!=n?(this.diagram._clearSelection(!0),this.selectedObject=this.diagram.nameTable[n.name]):this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name])},r.prototype._nodeCanHighlight=function(n){var t=!1;return this.diagram._getChildren(n.children).indexOf(this.selectedObject.name)==-1&&(this.selectedObject._type!="group"?t=!0:n._type==="group"&&(this._containsChild(this.selectedObject,n.name)||(t=!0))),t},r.prototype._swimlanPhaseDrag=function(){if(this.selectedObject&&this.selectedObject.isPhase){var n=null,i=this._getNodeUnderMouse();i&&(n=this._getSwimLaneNode(i,this.selectedObject,!0));n&&t.datavisualization.Diagram.SvgContext._drawNodeHighlighter(n,this.diagram._adornerSvg,this.diagram._adornerLayer,this.diagram._currZoom)}},r.prototype._containerMouseMove=function(n){var i,f,r=this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent],u;r&&r.container?(u=r.container,(u.type=="canvas"||u.type=="stack")&&(t.datavisualization.Diagram.canvasHelper._updateHelper(this.diagram),t.datavisualization.Diagram.canvasHelper._updateHighlighter(this.diagram,n))):(this.selectedObject.isSwimlane||(this.selectedObject.type=="pseudoGroup"&&this._isParentAsLane(this.selectedObject)?this._removeHighLighter():this.isDiagram(n)||this.selectedObject.segments?!this.isDiagram(n)&&this.selectedObject.isPhase?t.datavisualization.Diagram.SvgContext._disableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram):this._removeHighLighter():(i=this._getNodeUnderMouse(),i&&i.container&&(this.selectedObject.isSwimlane||this.selectedObject.isLane)?this._getSwimLaneNode(i,this.selectedObject)&&this._nodeHighLighter(i):i&&i.container&&i.container.type!="stack"?(this.selectedObject.name!=i.name&&this.selectedObject.type!="pseudoGroup"&&this._nodeHighLighter(i),i&&(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this._fromDiagram(this.selectedObject.children)&&this._nodeHighLighter(i)):i&&(this._removeHighLighter(),i.segments?t.datavisualization.Diagram.SvgContext._drawConnectorHighlighter(i,this.diagram,this.diagram._currZoom):this._nodeHighLighter(i)))),f||(this.selectedObject.type=="pseudoGroup"?this._fromDiagram(this.diagram._getChildren(this.selectedObject.children))?(this._undoObject||t.datavisualization.Diagram.Util._getUndoObject(this.diagram,this.selectedObject),this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)):(this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&this.hasSameParent()||this._anyFromContainer(this.diagram._getChildren(this.selectedObject.children)))&&(t.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject),this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)):t.datavisualization.Diagram.Util.canMove(this.selectedObject)&&this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)));this._swimlanPhaseDrag(n)},r.prototype.isDiagram=function(n){return n.target.id==this.diagram._id+"_canvas_svg"||n.target.id.match(this.selectedObject.name)?!0:!1},r.prototype._allowPan=function(n,i,r){i==="mousedown"&&this.diagram.tools.panTool.mousedown(r);n&&(n._type==="group"||n._type=="node")&&n.constraints&t.datavisualization.Diagram.NodeConstraints.AllowPan&&(i==="mousemove"?this.diagram.tools.panTool.mousemove(r):i==="mouseup"&&this.diagram.tools.panTool.mouseup(r))},r.prototype._checkForDropEvent=function(n,i){var o;if(!this.diagram._selectedSymbol){var r=this.diagram,f=n,e=null,u=t.datavisualization.Diagram.ObjectTypes.Diagram;return this.selectedObject&&this.selectedObject.parent&&(r=this.diagram.nameTable[this.selectedObject.parent],r.isLane?u=t.datavisualization.Diagram.ObjectTypes.Lane:r._type=="group"&&(u=t.datavisualization.Diagram.ObjectTypes.Group)),n&&!i&&(e=t.datavisualization.Diagram.Util.bounds(n),f=this._getTargetNode(n,e)),o=this._raiseEvent("drop",{cancel:!1,element:this.selectedObject,source:this.diagram.getNode(r),target:this.diagram.getNode(f),sourceType:u}),o.cancel}return!1},r.prototype._getSwimLaneNode=function(n,t,i){if(n.isSwimlane)if(i){if(this.diagram.nameTable[this.diagram._getChild(n.children[2])].container.orientation==t.orientation)return n}else if(this.diagram.nameTable[this.diagram._getChild(n.children[2])].container.orientation!=t.orientation)return n;if(n.parent){var r=this.diagram.nameTable[n.parent];if(r)return this._getSwimLaneNode(r,t,i)}return null},r.prototype._cloneGroupNode=function(t,i){var o=null,r,u,e,f;if(u=n.extend(!0,{},t),u.name+=i,t&&t._type==="group")for(u.children=[],e=this.diagram._getChildren(t.children),f=0;f<e.length;f++)o=this.diagram.nameTable[e[f]],r=n.extend(!0,{},o),r.name+=i,r.parent&&(r.parent+=i),r._type==="group"&&this._cloneGroupNode(r,i),this.diagram.nameTable[r.name]=r,u.children.push(r.name);return u},r.prototype._outOfBoundsLaneDrop=function(n,i){var r,o,s;if(n&&n.isLane&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var p=t.datavisualization.Diagram.Util.bounds(n),u=this._getPageBounds(),l=i.offsetX,a=i.offsetY,h=0,c=0,f=0,v=0,y=this.diagram.nameTable[i.children[2]],e=this.diagram.nameTable[i.children[0]];if((v=e?e.height:v,f=i.phaseSize?i.phaseSize:f,y&&(r=this.diagram.nameTable[y.children[0]],r&&(h=r.minHeight>100?r.minHeight:100,c=r.minWidth>100?r.minWidth:100)),n.orientation==="horizontal"?(o=c,s=h+e.height+f):(o=c+f,s=h+e.height),l+o/2+5>=u.width||l-o/2-5<=u.x)||a+s/2+5>=u.height||a-s/2-5<=u.y)return!1}return!0},r.prototype._getMouseOverElement=function(t,i){var r=null,e,f;if(t&&t.target)for(var o=n(t.target).parents(".ej-d-node,.ej-d-group,.ej-d-group ej-d-classifier,.ej-d-node ej-d-classifier,.ej-d-label ej-d-classifier"),u=o[0],s=1;u;)if(r=this.diagram._findNode(u.getAttribute("id")),r&&r.container)u=null;else{if(r&&i&&r._isHeader&&r.parent&&(e=this.diagram.nameTable[r.parent],e&&e.isSwimlane))break;u=o[s];!u&&r&&r.parent&&(f=this.diagram.nameTable[r.parent],f&&f.isLane&&(r=f));s++}return r},r.prototype._multiNodedrag=function(n){t.datavisualization.Diagram.canvasHelper&&!this._containsSwimlane(this.selectedObject.children)&&t.datavisualization.Diagram.canvasHelper._multiNodedrag(this.diagram,n,this.selectedObject)},r.prototype._changeNodeState=function(n,i,r){var c,e=null,u=this._getMouseOverElement(n,r),f,o,s,h;return u&&(u=this.selectedObject&&!this.selectedObject.isLane||u.isLane?u:null),this.diagram._selectedSymbol&&this.diagram._selectedSymbol.isLane&&!i?(this.diagram._isDragg=!0,u&&(e=this._getSwimLaneNode(u,this.selectedObject)),u&&e?t.datavisualization.Diagram.canvasHelper._addNewLane(this.diagram,u,e):(f=t.datavisualization.Diagram.SwimLaneHelper._createSwimlane(this.selectedObject,this.diagram),f&&(o={element:this.diagram.getNode(f),cancel:!1},this.diagram._isUndo=!0,this.diagram.remove(this.selectedObject),t.datavisualization.Diagram.containerCommon._removeObject(this.diagram,this.selectedObject),this.diagram._selectedSymbol&&t.datavisualization.Diagram.containerCommon._removeObject(this.diagram,this.diagram._selectedSymbol),this.diagram._isUndo=!1,this.diagram._selectedSymbol=null,this._outOfBoundsLaneDrop(this.selectedObject,f)?(this.diagram._raiseDropEvent(o),o.cancel?this.selectedObject=null:(this.diagram._eventCause.nodeCollectionChange=t.datavisualization.Diagram.CollectionChangeCause.Drop,this.diagram.add(f)&&(this.diagram._selectedSymbol=f,this.diagram._updateDroppedSymbol(f),this.selectedObject=f))):this.selectedObject=null))):this.selectedObject&&this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container?(s=this.diagram.nameTable[this.selectedObject.parent].container,this._removeHelpers(),s.type=="canvas"?(t.datavisualization.Diagram.SvgContext._showNode(this.selectedObject,this.diagram._svg),this.selectedObject.type=="pseudoGroup"||this.diagram._isDragg||(this._swimlaneNodeDragged=t.datavisualization.Diagram.canvasHelper._singleNodedrag(this.diagram,n,u))):s.type=="stack"?t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer):(this.isDiagram(n)&&this._addToDiagram(),this.diffx=this.diffy=0)):this.selectedObject&&!this.selectedObject.isSwimlane&&(this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()?(this.currentPoint=this.previousPoint,this.diffx=0,this.diffy=0,this._removeHelpers(),this._multiNodedrag(n,u)):(this.selectedObject.type!="connector"||this.selectedObject.isPhase)&&!this.isDiagram(n)&&this.selectedObject.type!="pseudoGroup"?(u=this._getMouseOverElement(n),this.diagram._isDragg||(u&&u.container&&t.datavisualization.Diagram.Util.canAllowDrop(u)&&!this._checkForDropEvent(u)&&!u.isSwimlane?(h=this.helper?this.helper:this.selectedObject,t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,h,u)?(t.datavisualization.Diagram.canvasHelper._addNodeToContainer(this.diagram,this.selectedObject,u),this.diagram._raiseGroupChangeEvent(this.selectedObject,null,u,"group")):(this.diagram._translate(this.selectedObject,this.undoObject.node.offsetX-this.selectedObject.offsetX,this.undoObject.node.offsetY-this.selectedObject.offsetY,this.diagram.nameTable),this.diagram._updateAssociatedConnectorEnds(this.selectedObject,this.diagram.nameTable))):u&&this.selectedObject.name!=u.name&&this._checkForDropEvent(u,!0))):this.selectedObject.type!="connector"||this.selectedObject.isPhase?(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this.diagram._activeSwimLane?(this._multiNodedrag(n,u),this.selectedObject=null):!this.diagram._activeSwimLane&&u&&u.isLane&&(this.diagram._activeSwimLane=this._getParentSwimlane(u),this._multiNodedrag(n,u),this.selectedObject=null):u&&(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this._fromDiagram(this.selectedObject.children)&&t.datavisualization.Diagram.Util.canAllowDrop(u)&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),this._multiNodedrag(n,u))),this._removeHelpers(),this._checkPhaseDrop(n),c},r.prototype._checkPhaseDrop=function(n){var i=null,r,u,f,e,s,o;this.selectedObject&&this.selectedObject.isPhase&&(f=this._findNodeUnderMouse(n),f&&(i=this._getSwimLaneNode(f,this.selectedObject,!0)),i?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.SvgContext._removeNodeHighlighter(this.diagram._adornerSvg,this.diagram._adornerLayer),e=this._getSwimlaneHeader(i),this.selectedObject.orientation=="vertical"?(r=this.currentPoint.x-(i.offsetX-i.width/2),u="horizontal"):(r=this.currentPoint.y-(i.offsetY-i.height/2),r-=e?e.height:0,u="vertical"),s={element:this.selectedObject,cancel:!1,target:i},this.diagram._dropPhase=!0,this.diagram.remove(this.selectedObject),delete this.diagram._dropPhase,this.diagram._selectedSymbol=null,this.inAction=!1,o=this.selectedObject.labels&&this.selectedObject.labels.length>0?this.selectedObject.labels[0]:{text:"Phase"},this.diagram._addPhase(i.name,{name:t.datavisualization.Diagram.Util.randomId(),offset:r,orientation:u,label:o,lineColor:this.selectedObject.lineColor,lineDashArray:this.selectedObject.lineDashArray,lineWidth:this.selectedObject.lineWidth}),this.diagram._selectedSymbol=null):(this.diagram._remove(this.selectedObject),this.diagram._clearSelection(!0),this.selectedObject=null,this.diagram._selectedSymbol=null))},r.prototype._removeHelpers=function(){t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer);t.datavisualization.Diagram.SvgContext._removeConnectorHighlighter(this.diagram._adornerLayer,this.diagram._adornerSvg);this._removeHighLighter();this.diffx=0;this.diffy=0},r.prototype._updateNodeState=function(n,i){var f,u,o,h,c,e,r,a,l,s;this.diagram.nameTable[this.selectedObject.parent]&&(f=this.diagram.nameTable[this.selectedObject.parent].container);u=this._getNodeUnderMouse();u&&(u=!this.selectedObject.isLane||u.isLane?u:null);f?f.type=="canvas"?u&&i&&(o=this.selectedObject.parent,h=this.diagram._getSwimlane(o),h&&this.diagram._updateChildAdjacentConnectors(h,!0),t.datavisualization.Diagram.DiagramContext.update(i,this.diagram)):f.type=="stack"&&(c=this._checkForDropEvent(u),c||(e=this._stackOverNode,e?(r=this.diagram.nameTable[e.parent],r||(r=u),a=t.datavisualization.Diagram.Util.bounds(r),l=r.rotateAngle,r.rotateAngle==0||l!=0||this.diagram._rotate(r,-r.rotateAngle,this.diagram.nameTable),r.children=this.diagram._getChildren(r.children),this.selectedObject.name!=e.name&&(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.canvasHelper._swapLane(this.diagram,r.children,this.selectedObject.name,e.name,r.container.orientation==="vertical"?!0:!1),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(this.diagram,r,!1),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdateLane(this.diagram,this.selectedObject))):this.diffx=this.diffy=0)):this.selectedObject.type=="pseudoGroup"&&(s=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],s&&s.parent&&(f=this.diagram.nameTable[s.parent].container),f&&f.type=="canvas"&&u&&i&&(o=this.selectedObject.parent,this.diagram._updateChildAdjacentConnectors(o,!0),t.datavisualization.Diagram.DiagramContext.update(i,this.diagram)))},r.prototype.mouseup=function(r,u){var y=this.inAction,f,c,e,o,p,w,b,k,s,d,g,l,it,a,nt,h,v;if(t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.diagram._eventCause.selectionChange=t.datavisualization.Diagram.SelectionChangeCause.Mouse,this.inAction?(this.dragState=t.datavisualization.Diagram.DragState.Completed,t.datavisualization.Diagram.SvgContext._enableSelectedNode(this.selectedObject,this.diagram._svg,this.diagram),this._canMoveLabel||(c=this._changeNodeState(r,u,!0)),this.inAction=!1,this.selectedObject&&(this._canMoveLabel?this._updateLabelXY(this.activeLabel,this.previousPoint,this.currentPoint):(e=o=t.datavisualization.Diagram.Util.bounds(this.selectedObject),p={bounds:{x:o.x,y:o.y,width:o.width,height:o.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},w={bounds:{x:e.x,y:e.y,width:e.width,height:e.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this._swimlaneNodedragged||(b=this._updateXY(this.selectedObject,this.previousPoint,this.currentPoint)),this.selectedObject&&this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent].container&&c||(this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:{x:0,y:0},oldValue:p,newValue:w,cancel:!1}),this.dragState="")),u||this._updateNodeState(r,c),this._updateObject(),s={},(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(s=this.diagram._getChildTable(this.selectedObject,s)),this.diagram._selectedSymbol||this.selectedObject.isPhase||this.selectedObject.isLane||this._isLane||this.diagram._isDragg||(d={childTable:s,node:this.selectedObject},k=n.extend(!0,{},d),g={type:"positionchanged",undoObject:jQuery.extend(!0,{},this.undoObject),redoObject:jQuery.extend(!0,{},k),isMultipleNode:this.selectedObject._type==="group"?!0:!1,category:"internal"},this._multipleUndo||this.diagram.addHistoryEntry(g)),this.diagram._selectedSymbol&&this.diagram._selectedSymbol.isSwimlane&&(this.diagram._selectedSymbol=null),this.diagram._updateSelectionHandle(),f=this.selectedObject,this._isLane=!1,this._multipleUndo=!1)):this.selectedObject?f=this._findNodeUnderMouse(r):(r.ctrlKey||r.shiftKey?f=this._processCtrlKey(r):(l=!0,it=r.target.className,a=t.datavisualization.Diagram.Util.isClassifier(r)?t.datavisualization.Diagram.ClassifierHelper.getSelectableElementUnderMouse(r,this.diagram):this._findNodeUnderMouse(r),r.which===3&&this.diagram.selectionList[0]&&(this.diagram.selectionList[0].type==="pseudoGroup"||this.diagram.selectionList[0]._type==="group")&&this._hasMultipleSelection(a)&&(l=!1),t.datavisualization.Diagram.Util.canDoSingleSelection(this.diagram)&&this._isMouseDown&&(this.selectedObject=l?a:this.diagram.selectionList[0]),f=this.selectedObject),nt=this.diagram.selectionList.length>0?this.diagram.selectionList[0]:null,this.selectedObject&&!this.diagram._selectionContains(this.selectedObject)&&this.diagram._clearSelection(!0)),!b&&this.selectedObject){if(this.selectedObject&&this.selectedObject.type!="pseudoGroup"&&!y){var tt=this._findNodeUnderMouse(r,!0),rt=this.selectedObject,ut=this._raiseEvent("itemClick",{element:this.selectedObject,actualObject:this.actualObject,selectedObject:tt,model:this.diagram.model,cancel:!1,event:r});this._itemClick(this.selectedObject,this.actualObject,tt,nt);ut.cancel&&(this.selectedObject=rt)}this.selectedObject&&(this._allowPan(this.selectedObject,"mouseup",r),this.selectedObject.isPhase||this._updateSelection(),this._enableLabel(this.selectedObject,this.activeLabel),this.selectedObject&&this.selectedObject.parent===""&&(this.selectedObject.isSwimlane?(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),h=this.selectedObject,this.diagram._isDragg&&!this.diagram._selectionContains(h)&&(this.diagram._clearSelection(),h.isPhase||this.diagram._addSelection(h))));f&&!y&&(v=this.diagram._mousePosition(r.originalEvent),this._raiseEvent("click",{element:this.diagram.getNode(f),actualObject:this.diagram.getNode(this.actualObject),count:this.diagram._getEventDetail(r),offsetX:v.x,offsetY:v.y,event:r}))}this._multipleUndo=!1;delete this.diffx;delete this.diffy;delete this._isMouseDown;delete this.actualObject;delete this._swimlaneNodedragged;this.diagram._removeTooltip();this.diagram._isEditing||this.diagram._isDragg||this.diagram._endEdit();delete this.hoverNode;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);this.diagram._activeSwimLane=null;i.prototype.mouseup.call(this,r)},r.prototype._updateObject=function(){var i,r,n,u;if(this.selectedObject)if(this.selectedObject.type=="pseudoGroup")for(r=this.diagram._getChildren(this.selectedObject.children),n=0,u=r.length;n<u;n++)i=this.diagram.nameTable[r[n]],i&&t.datavisualization.Diagram.DiagramContext.update(i,this.diagram);else this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),this.selectedObject.isSwimlane?(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)},r.prototype._endAction=function(){i.prototype._endAction.apply(this);this._isMouseDown=!1;this._mouseOffset=t.datavisualization.Diagram.Size(0,0)},r.prototype._updateHelperXY=function(n,i,r){var a=r.x<i.x,v=r.y<i.y,o=this.diffx+(r.x-i.x),s=this.diffy+(r.y-i.y),u,f,h,e,c,l;(this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines)&&this.diagram._enableSnapToObject()&&(u=t.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.helper,a,v,t.datavisualization.Diagram.Point(o,s),r,i));u||(u=t.datavisualization.Diagram.Point(o,s));this.diffx=o-u.x;this.diffy=s-u.y;t.datavisualization.Diagram.Geometry.isEmptyPoint(u)||(f=t.datavisualization.Diagram.Util.bounds(n),f=t.datavisualization.Diagram.Rectangle(f.left,f.top,f.right-f.left,f.bottom-f.top),h={bounds:{x:f.x,y:f.y,width:f.width,height:f.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},this._outOfBoundsDrag(n,u.x,u.y)&&this.diagram._translate(n,u.x,u.y,this.diagram.nameTable),e=t.datavisualization.Diagram.Util.bounds(n),e=t.datavisualization.Diagram.Rectangle(e.left,e.top,e.right-e.left,e.bottom-e.top),c={bounds:{x:e.x,y:e.y,width:e.width,height:e.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},l=this._raiseDragEvent({element:this.diagram.getNode(this.helper),offset:u,oldValue:h,newValue:c,cancel:!1}),l.cancel?this.diagram._translate(n,-u.x,-u.y,this.diagram.nameTable):this.inAction||n._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram))},r.prototype._outOfBoundsDrag=function(n,i,r,u){var f,e,o;return(i=i?i:0,r=r?r:0,n&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)&&(f=t.datavisualization.Diagram.Util.bounds(n),e=this._getPageBounds(),u&&(i=u==="horizontal"?0:i,r=u==="vertical"?0:r),f&&((o=this._getPadding(n),(!this.diagram._selectedSymbol||this._skipSelectedSymbol)&&(f.right+i+o.x>e.width||f.left+i-o.x<e.x))||(!this.diagram._selectedSymbol||this._skipSelectedSymbol)&&(f.bottom+r+o.y>e.height||f.top+r-o.y<e.y))))?(this.updateCursor("not-allowed"),!1):(this.updateCursor("move"),!0)},r.prototype._updateXY=function(n,i,r,u){var v=r.x<i.x,y=r.y<i.y,h=this.diffx+(r.x-i.x),c=this.diffy+(r.y-i.y),f,s,e,l,o,a;if((this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines||this.diagram._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines||this.diagram._enableSnapToObject())&&(f=t.datavisualization.Diagram.SnapUtil._snapPoint(this.diagram,this.selectedObject,v,y,t.datavisualization.Diagram.Point(h,c),r,i)),f||(f=t.datavisualization.Diagram.Point(h,c)),this.diffx=h-f.x,this.diffy=c-f.y,(!t.datavisualization.Diagram.Geometry.isEmptyPoint(f)||this.diagram._selectedSymbol&&!this.inAction)&&(e=t.datavisualization.Diagram.Util.bounds(n),e=t.datavisualization.Diagram.Rectangle(e.left,e.top,e.right-e.left,e.bottom-e.top),l={bounds:{x:e.x,y:e.y,width:e.width,height:e.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},n.segments||t.datavisualization.Diagram.Util.canAllowPan(n)&&(this.diagram._hScrollOffset===0&&(f.x=0),this.diagram._vScrollOffset===0&&(f.y=0)),u&&!n.isSwimlane&&n.type!="pseudoGroup"&&(this.diagram._preventDocking=!0),this._outOfBoundsDrag(n,f.x,f.y))){if(this.diagram._raiseOffsetPropertyChange(n,f.x,f.y,!0),this.diagram._translate(n,f.x,f.y,this.diagram.nameTable),delete this.diagram._preventDocking,o=t.datavisualization.Diagram.Util.bounds(n),o=t.datavisualization.Diagram.Rectangle(o.left,o.top,o.right-o.left,o.bottom-o.top),a={bounds:{x:o.x,y:o.y,width:o.width,height:o.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},this.diagram._selectedSymbol){if(s={element:this.diagram.getNode(this.selectedObject),allowDrop:!0,target:this._getNodeUnderMouse(),oldValue:l,newValue:a,cancel:!1},s.target&&s.target.segments&&t.datavisualization.Diagram.SvgContext._drawConnectorHighlighter(s.target,this.diagram,this.diagram._currZoom),this._raiseEvent("dragOver",s),s.allowDrop)this.updateCursor("move");else if(this.updateCursor("not-allowed"),!this.inAction)return this.diagram._removeSymbolFromDiagram(),!0}else s=this._raiseDragEvent({element:this.diagram.getNode(this.selectedObject),offset:f,oldValue:l,newValue:a,cancel:!1});s&&!s.cancel||this.diagram._selectedSymbol?(n._type==="group"&&n.type!="bpmn"||n.type==="pseudoGroup")&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram):s&&s.cancel&&this.diagram._translate(n,-f.x,-f.y,this.diagram.nameTable)}},r.prototype._updateLabelXY=function(n,i,r){var u=r.x-i.x,f=r.y-i.y,e,o,s;this.selectedObject.segments||(e=t.Matrix.identity(),t.Matrix.rotate(e,-this.selectedObject.rotateAngle),o=t.Matrix.transform(e,t.datavisualization.Diagram.Point(u,f)),u=o.x,f=o.y);this.diagram._translateLabel(this.selectedObject,n,u,f);s=this._raiseDragEvent({element:this.diagram.getNode(n),offset:n.offset,cancel:!1});s.cancel&&this.diagram._translateLabel(this.selectedObject,n,-u,-f)},r.prototype._raiseDragEvent=function(n){if(!this.diagram._selectedSymbol&&!this.diagram._isDragg)return n.dragState=this.dragState,this._raiseEvent("drag",n)},r.prototype._updateSelection=function(){this.diagram._selectionContains(this.selectedObject)||(this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject))},r.prototype._disableLabel=function(t,i){if(t&&i){var u=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],f=t._shape=="text"?t.name:t.name+"_"+i.name,r=n(u).find("#"+f+".ej-d-label")[0];r&&(r.style.pointerEvents="none")}},r.prototype._enableLabel=function(t,i){if(t&&i){var u=this.diagram._svg.document.parentNode.getElementsByClassName("htmlLayer")[0],f=t._shape=="text"?t.name:t.name+"_"+i.name,r=n(u).find("#"+f+".ej-d-label")[0];r&&(r.style.pointerEvents="all")}},r}(i);t.datavisualization.Diagram.MoveTool=f;e=function(i){function r(n){i.call(this,"resize",n);this.cursor="default";this._resizeDirection=null;this._mouseOffset=t.datavisualization.Diagram.Size(0,0);this.diffx=0;this.diffy=0;this._startPoint=t.datavisualization.Diagram.Size(0,0);this.undoObject=null;this.pseudoGroupConstraints=null;this._mouseDown=!1;this.resizeState=""}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);i.prototype.mousedown.call(this,n);this._mouseDown=!0;this.resizeState=t.datavisualization.Diagram.ResizeState.Starting},r.prototype.mousemove=function(r){var h,c,e,u,f,l,a,v,o,s;i.prototype.mousemove.call(this,r);h=!this.inAction;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);!this.inAction&&this.diagram.selectionList[0]&&this._mouseDown&&(this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name],e={},u=f=t.datavisualization.Diagram.Util.bounds(this.selectedObject),l={bounds:{x:f.x,y:f.y,width:f.width,height:f.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},a={bounds:{x:u.x,y:u.y,width:u.width,height:u.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:{x:0,y:0},oldValue:l,newValue:a,cancel:!1,direction:this._resizeDirection}),(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(e=this.diagram._getChildTable(this.selectedObject,e)),v={childTable:e,node:this.selectedObject},this.selectedObject&&this.selectedObject.type==="pseudoGroup"&&(this.pseudoGroupConstraints=this.diagram.model.selectedItems.getConstraints&&n.isFunction(this.diagram.model.selectedItems.getConstraints)?this.diagram.model.selectedItems.getConstraints():t.datavisualization.Diagram.Util._getPseudoGroupConstraints(this.diagram,this.selectedObject,this.selectedObject)),c=n.extend(!0,{},v),this.undoObject=jQuery.extend(!0,{},c),this._resizeDirection=r.target.getAttribute("class"),this.selectedObject.width||(this.selectedObject.width=this.selectedObject._width),this.selectedObject.height||(this.selectedObject.height=this.selectedObject._height),this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:this.selectedObject.offsetY,x:this.selectedObject.offsetX},t.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._svg,this.diagram._currZoom),this.inAction=!0);this.selectedObject&&(this.resizeState=t.datavisualization.Diagram.DragState.Resizing,o=!1,this.selectedObject&&this.selectedObject.parent?(s=this.diagram.nameTable[this.selectedObject.parent],s.container&&(s.container.type=="canvas"||s.container.type=="stack")&&(o=!0)):this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(o=!0),this.selectedObject&&o||this.selectedObject.type==="pseudoGroup"&&this._anyFromContainer(this.diagram._getChildren(this.selectedObject.children))?this.selectedObject.type==="pseudoGroup"&&this._isParentAsLane(this.selectedObject)?t.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject):t.datavisualization.Diagram.canvasHelper._updateResizeHelper(this.diagram):this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?t.datavisualization.Diagram.canvasHelper._updateResizeHelper(this.diagram):this.selectedObject.parent&&this.diagram.nameTable[this.selectedObject.parent]&&this.diagram.nameTable[this.selectedObject.parent].container&&this.diagram.nameTable[this.selectedObject.parent].container.type=="stack"?(this.helper||(this.helper=this._getCloneNode(this.selectedObject)),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram),this._startPoint=this.currentPoint,this._updateSize(this.helper,this.previousPoint,this.currentPoint),t.datavisualization.Diagram.DiagramContext.update(this.helper,this.diagram)):this.selectedObject.type!="pseudoGroup"?this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint):this.selectedObject.type=="pseudoGroup"&&!this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&this._fromSameContainer(this.diagram._getChildren(this.selectedObject.children))&&(this._undoObject||t.datavisualization.Diagram.Util._getUndoObject(this.diagram,this.selectedObject),this._updateSize(this.selectedObject,this.previousPoint,this.currentPoint)),this.helper||(this.selectedObject.isSwimlane?this._isMouseDown||(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(this.diagram,this.selectedObject)):t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram)),this.diagram._renderTooltip(this.selectedObject,h),this.diagram._updateSelectionHandle(!0));this.previousPoint=this.currentPoint},r.prototype.mouseup=function(r){var h=null,s,f,e,c,l,o,a,u,v,y;this._mouseDown=!1;this.inAction&&(this.resizeState=t.datavisualization.Diagram.ResizeState.Completed,t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this.inAction=!1,s=!1,f=e=t.datavisualization.Diagram.Util.bounds(this.selectedObject),c={bounds:{x:e.x,y:e.y,width:e.width,height:e.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},l={bounds:{x:f.x,y:f.y,width:f.width,height:f.height},offsetX:this.selectedObject.offsetX,offsetY:this.selectedObject.offsetY,width:this.selectedObject.width,height:this.selectedObject.height},this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:{x:0,y:0},oldValue:c,newValue:l,cancel:!1,direction:this._resizeDirection}),this.resizeState="",(this.selectedObject.isLane||this.selectedObject.isSwimlane)&&(u={},u=this.diagram._getChildTable(this.selectedObject,u),h=n.extend(!0,{},{childTable:u,node:this.selectedObject})),this.selectedObject&&this.selectedObject.parent?(o=this.diagram.nameTable[this.selectedObject.parent],o.container&&(o.container.type=="canvas"||o.container.type=="stack")&&(s=!0)):this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(s=!0),this.selectedObject&&s?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,this.diagram.activeTool.helper,o)&&(t.datavisualization.Diagram.canvasHelper._singleNodeResize(this.diagram,r,this.selectedObject),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram))):this.selectedObject&&this.diagram.nameTable[this.selectedObject.name].container?(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),t.datavisualization.Diagram.canvasHelper._resizeLane(this.diagram,this.selectedObject)):(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this.diagram._activeSwimLane&&t.datavisualization.Diagram.canvasHelper._multiNodeResize(this.diagram,r,this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(),u={},(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(u=this.diagram._getChildTable(this.selectedObject,u)),v={childTable:u,node:this.selectedObject},a=n.extend(!0,{},v),y={type:"sizechanged",undoObject:h?h:this.undoObject,redoObject:jQuery.extend(!0,{},a),isMultipleNode:this.selectedObject._type==="group"?!0:!1,category:"internal"},this._multipleUndo||this.diagram.addHistoryEntry(y),this.diagram._removeTooltip(),this._multipleUndo=!1);i.prototype.mouseup.call(this,r)},r.prototype._updateSize=function(n,i,r,u,f,e,o,s,h){var y,a,tt=t.Matrix.identity(),rt,ut,v,et,ft,p,ht,w,ct,ot,st;t.Matrix.rotate(tt,-n.rotateAngle);var b={snapped:!1,offset:0,left:!1,right:!1},k={snapped:!1,offset:0,top:!1,bottom:!1},l=u?u:this.currentPoint.x-this.startPoint.x,c=f?f:this.currentPoint.y-this.startPoint.y,d=t.datavisualization.Diagram.Point(0,0),it=t.Matrix.identity(),g=n.offsetX,nt=n.offsetY;t.Matrix.rotate(it,n.rotateAngle,g,nt);rt=n.width;ut=n.height;g=g-rt*n.pivot.x;nt=nt-ut*n.pivot.y;switch(this._resizeDirection){case"n-resize":d=t.Matrix.transform(it,t.datavisualization.Diagram.Point(g+rt/2,nt+ut));v=1;a=t.Matrix.transform(tt,t.datavisualization.Diagram.Point(l,c));l=a.x;c=a.y;c=this._snapTop(b,k,l,c,n,r==i);y=(this.initialBounds.height-c)/n.height;break;case"e-resize":d=t.Matrix.transform(it,t.datavisualization.Diagram.Point(g,nt+ut/2));a=t.Matrix.transform(tt,t.datavisualization.Diagram.Point(l,c));l=a.x;c=a.y;l=this._snapRight(b,k,l,c,n,r==i,h);c=0;v=(this.initialBounds.width+l)/n.width;y=1;break;case"w-resize":d=t.Matrix.transform(it,t.datavisualization.Diagram.Point(g+rt,nt+ut/2));a=t.Matrix.transform(tt,t.datavisualization.Diagram.Point(l,c));l=a.x;c=a.y;l=this._snapLeft(b,k,l,c,n,r==i);c=0;v=(this.initialBounds.width-l)/n.width;y=1;break;case"s-resize":d=t.Matrix.transform(it,t.datavisualization.Diagram.Point(g+rt/2,nt));v=1;a=t.Matrix.transform(tt,t.datavisualization.Diagram.Point(l,c));l=a.x;c=a.y;c=this._snapBottom(b,k,a.x,a.y,n,r&&i&&r==i?!0:!1);y=(this.initialBounds.height+c)/n.height;break;case"ne-resize":d=t.Matrix.transform(it,t.datavisualization.Diagram.Point(g,nt+ut));a=t.Matrix.transform(tt,t.datavisualization.Diagram.Point(l,c));l=a.x;c=a.y;l=this._snapRight(b,k,l,c,n,r==i,h);c=this._snapTop(b,k,l,c,n,r==i);v=(this.initialBounds.width+l)/n.width;y=(this.initialBounds.height-c)/n.height;break;case"nw-resize":d=t.Matrix.transform(it,t.datavisualization.Diagram.Point(g+rt,nt+ut));a=t.Matrix.transform(tt,t.datavisualization.Diagram.Point(l,c));l=a.x;c=a.y;c=this._snapTop(b,k,l,c,n,r==i);l=this._snapLeft(b,k,l,c,n,r==i);v=(this.initialBounds.width-l)/n.width;y=(this.initialBounds.height-c)/n.height;break;case"se-resize":d=t.Matrix.transform(it,t.datavisualization.Diagram.Point(g,nt));a=t.Matrix.transform(tt,t.datavisualization.Diagram.Point(l,c));l=a.x;c=a.y;c=this._snapBottom(b,k,l,c,n,r==i,h);l=s?l:this._snapRight(b,k,l,c,n,r==i);v=(this.initialBounds.width+l)/n.width;y=(this.initialBounds.height+c)/n.height;break;case"sw-resize":d=t.Matrix.transform(it,t.datavisualization.Diagram.Point(g+rt,nt));a=t.Matrix.transform(tt,t.datavisualization.Diagram.Point(l,c));l=a.x;c=a.y;c=this._snapBottom(b,k,l,c,n,r==i,h);l=this._snapLeft(b,k,l,c,n,r==i);v=(this.initialBounds.width-l)/n.width;y=(this.initialBounds.height+c)/n.height}if(n&&(this.pseudoGroupConstraints||(this.pseudoGroupConstraints=n.constraints)),this.pseudoGroupConstraints&t.datavisualization.Diagram.NodeConstraints.AspectRatio&&(this._resizeDirection=="n-resize"||this._resizeDirection=="s-resize"||this._resizeDirection=="w-resize"||this._resizeDirection=="e-resize"?(et=t.Matrix.transform(tt,t.datavisualization.Diagram.Point(i.x-r.x,i.y-r.y)),Math.abs(et.x)>Math.abs(et.y)?y=v:v=y):y=i!=r?v=Math.max(y,v):v=0),ft=t.datavisualization.Diagram.Size(),v<0&&(v=1),y<0&&(y=1),ft.width=v,ft.height=y,p=t.datavisualization.Diagram.Util.bounds(n),p=t.datavisualization.Diagram.Rectangle(p.left,p.top,p.right-p.left,p.bottom-p.top),ht={bounds:{x:p.x,y:p.y,width:p.width,height:p.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},!t.datavisualization.Diagram.Geometry.isEmptySize(ft))if(this.resizeState=t.datavisualization.Diagram.ResizeState.Resizing,this._outOfBoundsDrag(n,v,y,d))this.diagram._raiseSizePropertyChange(n,v,y,!0),this.diagram.scale(n,v,y,d,this.diagram.nameTable,null,e,o),w=t.datavisualization.Diagram.Util.bounds(n),w=t.datavisualization.Diagram.Rectangle(w.left,w.top,w.right-w.left,w.bottom-w.top),ct={bounds:{x:w.x,y:w.y,width:w.width,height:w.height},offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height},ot=n.pathData,(p.width!=w.width||p.height!=w.height)&&(st=this._raiseEvent("sizeChange",{element:this.diagram.getNode(this.selectedObject),resizeState:this.resizeState,offset:ft,oldValue:ht,newValue:ct,direction:this._resizeDirection})),ot&&n.pathData!=ot&&(n._absoluteBounds=null,n._scaled=!0),st&&st.cancel&&!o&&this.diagram.scale(n,1/v,1/y,d,this.diagram.nameTable),n._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram),this.diagram._updateAssociatedConnectorEnds(n,this.diagram.nameTable);else return!0;this.pseudoGroupConstraints=null},r.prototype._getSwimLaneNode=function(n){var u,t,i,r;if(n&&(u=n.parent,t=this.diagram.nameTable[u],t&&(i=t.parent,i&&(r=this.diagram.nameTable[i],r))))return r},r.prototype._outOfBoundsDrag=function(n,i,r,u){var o;if(!this.diagram._skipoutOfBounds&&n&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var f=this._getPageBounds(),c=n.height*r-n.height,l=n.width*i-n.width;if(!this.inAction&&n.isLane){var a=this._getSwimLaneNode(n),e=t.datavisualization.Diagram.Util.bounds(a),s=this._getPadding(n);if(!this.diagram._selectedSymbol&&e.right+l+s.x>f.width||!this.diagram._selectedSymbol&&e.bottom+c+s.y>f.height)return this.updateCursor("not-allowed"),!1}else{var e=t.datavisualization.Diagram.Util.bounds(n),s=this._getPadding(n),h=t.Matrix.identity();if((t.Matrix.rotate(h,-n.rotateAngle,u.x,u.y),t.Matrix.scale(h,i,r,u.x,u.y),t.Matrix.rotate(h,n.rotateAngle,u.x,u.y),o=t.Matrix.transform(h,t.datavisualization.Diagram.Point(n.offsetX,n.offsetY)),!this.diagram._selectedSymbol&&(o.x+(e.width+l)/2+s.x>f.width||o.x-(e.width+l)/2<f.x))||!this.diagram._selectedSymbol&&(o.y+(e.height+c)/2+s.y>f.height||o.y-(e.height+c)/2<f.y))return this.updateCursor("not-allowed"),!1}this.updateCursor(this._resizeDirection)}return!0},r}(i);t.datavisualization.Diagram.ResizeTool=e;o=function(i){function r(n){i.call(this,"endPoint",n);this.cursor="move";this._endPoint=null;this._undoObject=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(r){var u;i.prototype.mousedown.call(this,r);r.ctrlKey&&r.shiftKey&&(u=n(r.target).parents(".ej-d-connector"),u.length>0&&(this.selectedObject=this.diagram.nameTable[u[0].id],this.diagram._hasSelection()&&this.diagram._clearSelection(!0),this.diagram._addSelection(this.selectedObject)));this._initialValue=null;this.diagram.selectionList[0]&&!this.selectedObject&&(this.selectedObject=this.diagram.nameTable[this.diagram.selectionList[0].name]);this.undoObject=this._getClonedObject(this.selectedObject);this._endPoint=r.target.getAttribute("class");this.targetid=r.target.id;this._selectedSegment="";this._nearestNodes=[];var f=this._endPoint=="targetEndPoint"?!0:!1,e=this._endPoint=="sourceEndPoint"?!0:!1,o=this._raiseEndPointDrag(this.selectedObject,f,e,t.datavisualization.Diagram.DragState.Starting)},r.prototype.mousemove=function(r){var b,c,l,o,e,v,a,p,w,s,h,y;if(i.prototype.mousemove.call(this,r),b=!this.inAction,this.selectedObject&&!(r.ctrlKey&&r.shiftKey)){c=!1;this.selectedObject.segments.length==2&&(c=!0);var u=this.currentPoint.x-this.previousPoint.x,f=this.currentPoint.y-this.previousPoint.y,k=n.extend(!0,{},this.selectedObject.sourcePoint),d=n.extend(!0,{},this.selectedObject.targetPoint),g=n.extend(!0,{},this.selectedObject.segments);if(this._outOfBoundsDrag(this.selectedObject,this.currentPoint.x,this.currentPoint.y))if(this.inAction||this.startPoint.x==this.currentPoint.x&&this.startPoint.y==this.currentPoint.y)this.inAction&&(this.selectedSegment&&this._endPoint=="segmentEnd"?(w=this._raiseSegmentEditEvent(t.datavisualization.Diagram.DragState.Dragging),w.cancel||u==0&&f==0||(s=this.currentPoint.x-this.startPoint.x,h=this.currentPoint.y-this.startPoint.y,this._initialValue&&(s=this._initialValue.x+s-this.selectedSegment._endPoint.x,h=this._initialValue.y+h-this.selectedSegment._endPoint.y),u=u*s<0?0:s,f=f*h<0?0:h,this._updateAdjacentSegments(u,f))):this._endPoint!="segmentEnd"&&((this._endPoint=="targetEndPoint"||this._endPoint=="sourceEndPoint")&&this._checkConnectionPossible(r),y=this._updatePoints(this.selectedObject,t.datavisualization.Diagram.DragState.Dragging),y.cancel||(this._disconnect(this.selectedObject),this._updateConnection(this.selectedObject,y.updateSelection))),this.diagram._updateSelectionHandle(!0),this.diagram._updateQuad(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram));else{if(this.inAction=!0,this.selectedObject.segments.length>0)for(l=0;l<this.selectedObject.segments.length;l++)this.selectedObject.segments[l]._bridges=[];this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest").setAttribute("pointer-events","none");this.diagram._svg.getElementById(this.selectedObject.name).setAttribute("pointer-events","none");this.diagram._adornerSvg.getElementById(this.diagram._adornerSvg.document.id+"handle_g").setAttribute("pointer-events","none");o=this.targetid.split("_");o.reverse();e=Number(o[0]);this.selectedSegment=this.selectedObject.segments[e];v=this.selectedSegment;this.selectedSegment&&this.selectedSegment.type=="orthogonal"?(a=!1,e===0&&(p=!0),this.selectedSegment.length&&this.selectedSegment.direction?e==0?(this.insertFirstSegment(u,f,o),a=!0):this.nextSegment=this.selectedObject.segments[e+1]:(this._addTerminalSegment(u,f,o),a=!0)):this.nextSegment=this.selectedObject.segments[e+1];a&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,!(c||p||!this.selectedObject.sourcePort),!(c||!(v.length||v.length===0)||!this.selectedObject.targetPort),this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom));this.selectedSegment||this._endPoint!="targetEndPoint"||(this.selectedSegment=this.selectedObject.segments[this.selectedObject.segments.length-1]);this.selectedSegment||this._endPoint!="sourceEndPoint"||(this.selectedSegment=this.selectedObject.segments[0],this.nextSegment=this.selectedObject.segments[1]);this.selectedSegment&&(this._initialValue={x:this.selectedSegment._endPoint.x,y:this.selectedSegment._endPoint.y});this.diagram._updateSelectionHandle(!0);this._raiseSegmentEditEvent(t.datavisualization.Diagram.DragState.Starting)}this.diagram._comparePropertyValues(this.selectedObject,"sourcePoint",{sourcePoint:k},!0);this.diagram._comparePropertyValues(this.selectedObject,"targetPoint",{targetPoint:d},!0);this.diagram._comparePropertyValues(this.selectedObject,"segments",{segments:g},!0)}this.previousPoint=this.currentPoint},r.prototype._raiseSegmentEditEvent=function(n){return this._raiseEvent("segmentChange",{element:this.selectedObject,dragState:n,point:this.currentPoint,cancel:!1})},r.prototype._updateAdjacentSegments=function(n,i){var r=this.selectedSegment,u={x:n+r._endPoint.x,y:i+r._endPoint.y},e,f;u=this.snap(u);r.type=="orthogonal"?(r._direction=="left"||r._direction=="right"?(i=u.y-r._endPoint.y,r._startPoint.y+=i,r._endPoint.y=r._startPoint.y):(n=u.x-r._endPoint.x,r._startPoint.x+=n,r._endPoint.x=r._startPoint.x),r.points[0]=r._startPoint,r.points[r.points.length-1]=r._endPoint,e=this.selectedObject.segments.indexOf(this.selectedSegment),f=this.selectedObject.segments[e-1],f&&this.updatePreviousSegment(r,f,n,i)):r.type=="straight"?(r.points[r.points.length-1]=r._endPoint=u,r._point=r.point=u):(r.points[r.points.length-1]=r._endPoint=u,r._point=r.point=u,t.datavisualization.Diagram.Util._updateBezierPoints(r));this.nextSegment&&this.updateNextSegment(r,this.nextSegment,n,i)},r.prototype._addTerminalSegment=function(n,i,r){var u=this.selectedSegment,f,e,o,h,c,s;for(this.selectedObject.segments.pop(),f=this.selectedObject.segments[this.selectedObject.segments.length-1]&&this.selectedObject.segments[this.selectedObject.segments.length-1].type=="orthogonal"?this.selectedObject.segments[this.selectedObject.segments.length-1]:null,e=0;e<u.points.length-2;e++)o=t.datavisualization.Diagram.Segment({type:"orthogonal",length:t.datavisualization.Diagram.Geometry.distance(u.points[e],u.points[e+1]),direction:t.datavisualization.Diagram.Util._getBezierDirection(u.points[e],u.points[e+1])}),o.length==0&&(o._direction=f.direction=="top"||f.direction=="bottom"?o.direction=n>0?"right":"left":o.direction=i>0?"bottom":"top"),f=o,this.selectedObject.segments.push(o);if(h=Number(r[1]),(u.points.length==2||h==u.points.length-2)&&(f&&(f.length+=5,f._length=f.length),h!=0)){var l=t.datavisualization.Diagram.Geometry.distance(u.points[u.points.length-2],u._endPoint),a=t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint),v=t.datavisualization.Diagram.Segment({type:"orthogonal",length:2*l/3,direction:a});this.selectedObject.segments.push(v)}c=t.datavisualization.Diagram.Segment({type:"orthogonal"});this.selectedObject.segments.push(c);s=Number(r[0])+(Number(r[1])||0);this.selectedSegment=this.selectedObject.segments[s];this.nextSegment=this.selectedObject.segments[s+1];s==this.selectedObject.segments.length-2?this.nextSegment._direction=Number(r[0])==0?t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint):u._direction:c._direction=t.datavisualization.Diagram.Util._getBezierDirection(u.points[u.points.length-2],u._endPoint);s==0&&this.insertFirstSegment(n,i,r)},r.prototype.insertFirstSegment=function(n,i,r){var u=this.selectedSegment,c,e,o,f,h,l,s,a;if(this.selectedObject.sourcePort&&u.length&&this.selectedObject.segments[0].points.length>2){for(this.selectedObject.segments.splice(0,1),f=[],e=0;e<u.points.length-1;e++)o=t.datavisualization.Diagram.Segment({type:"orthogonal",length:t.datavisualization.Diagram.Geometry.distance(u.points[e],u.points[e+1]),direction:t.datavisualization.Diagram.Util._getBezierDirection(u.points[e],u.points[e+1])}),o.length==0&&(o._direction=c&&(c.direction=="top"||c.direction=="bottom")?o.direction=n>0?"right":"left":o.direction=i>0?"bottom":"top"),c=o,f.push(o);this.selectedObject.segments=f.concat(this.selectedObject.segments);this.selectedSegment=this.selectedObject.segments[Number(r[1])];this.nextSegment=this.selectedObject.segments[Number(r[1])+1]}else u=this.selectedObject.segments[0],f=[],f.push(t.datavisualization.Diagram.Segment({type:"orthogonal",direction:u.direction,length:u.length/3})),u.direction=="bottom"||u.direction=="top"?(h=Math.max(5,Math.abs(n)),l=n>0?"right":"left"):(h=Math.max(5,Math.abs(i)),l=i>0?"bottom":"top"),f.push(t.datavisualization.Diagram.Segment({type:"orthogonal",direction:l,length:h})),s=this.selectedObject.segments[1],s&&s.length&&(l!=s.direction&&(h*=-1),s.length-=h,s._length=s.length),u.length=u._length=2*u._length/3,this.selectedObject.segments=f.concat(this.selectedObject.segments),a=Number(r[0])+Number(r[1]),this.selectedSegment=this.selectedObject.segments[2],this.nextSegment=this.selectedObject.segments[3]},r.prototype.updatePreviousSegment=function(n,i,r,u){i._endPoint=i.points[i.points.length-1]=n._startPoint;i.type=="orthogonal"?(i.direction=="bottom"?(i.length+=u,i.length<0&&(i._direction=i.direction="top",i.length*=-1)):i.direction=="top"?(i.length-=u,i.length<0&&(i._direction=i.direction="bottom",i.length*=-1)):i.direction=="right"?(i.length+=r,i.length<0&&(i._direction=i.direction="left",i.length*=-1)):i.direction=="left"&&(i.length-=r,i.length<0&&(i._direction=i.direction="right",i.length*=-1)),i._length=i.length):i.type=="bezier"&&t.datavisualization.Diagram.Util._updateBezierPoints(i)},r.prototype.updateNextSegment=function(n,i,r,u){var o=n._endPoint,e,f;i._startPoint=i.points[0]=this.selectedSegment._endPoint;i&&(i.type=="orthogonal"?(i.length||i.length===0)&&(i._direction=="left"||i._direction=="right"?(r!=0&&(i._direction=="right"?i._length-=r:i._length+=r,(i.length||i.length===0)&&(i.length=i._length,i.length<0&&(i.direction=="left"?i.direction="right":i.direction=="right"&&(i.direction="left"),i.length*=-1,i._direction=i.direction,i._length=i.length))),u!=0&&n.type!="orthogonal"&&(i._startPoint.y=i.points[0].y=i._endPoint.y=i.points[i.points.length-1].y=o.y,e=this.selectedObject.segments.indexOf(i),f=this.selectedObject.segments[e+1],f._startPoint.y=f.points[0].y=i._endPoint.y,f.length&&(f.direction=="bottom"?(f.length-=u,f.length<0&&(f.direction="top",f.length*=-1)):(f.length+=u,f.length<0&&(f.direction="bottom",f.length*=-1))))):(u!=0&&(i._direction=="bottom"?i._length-=u:i._length+=u,(i.length||i.length===0)&&(i.length=i._length,i.length<0&&(i.direction=="top"?i.direction="bottom":i.direction=="bottom"&&(i.direction="top"),i.length*=-1,i._length=i.length,i._direction=i.direction))),r!=0&&n.type!="orthogonal"&&(i._startPoint.x=i.points[0].x=i._endPoint.x=i.points[i.points.length-1].x=o.x,e=this.selectedObject.segments.indexOf(i),f=this.selectedObject.segments[e+1],f.length&&(f.direction=="right"?(f.length+=r,f.length<0&&(f.direction="left",f.length*=-1)):(f.length-=r,f.length<0&&(f.direction="right",f.length*=-1)))))):i.type=="bezier"&&t.datavisualization.Diagram.Util._updateBezierPoints(i))},r.prototype.mouseup=function(n){var c,u,h,l,a,e;if(n.shiftKey&&n.ctrlKey)this._addOrRemoveStraightSegments(n);else if(this.inAction){if(this.inAction=!1,this._endPoint=="segmentEnd"&&this.selectedSegment.type=="orthogonal"){if(h=this._raiseSegmentEditEvent(t.datavisualization.Diagram.DragState.Completed),!h.cancel){var f=this.selectedObject.segments.indexOf(this.selectedSegment),o=this.selectedObject.segments[f-1],r=this.selectedObject.segments[f+1],s=!1;o&&o.type=="orthogonal"&&Math.abs(o.length)<5?f!=1&&(s=this._removePrevSegment(f)):r&&r.type=="orthogonal"&&(c=r.length||r.length===0?r.length:t.datavisualization.Diagram.Geometry.distance(r.points[0],r.points[1]),Math.abs(c<=5)&&(s=this._removeNextSegment(f)));s&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))}}else this._endPoint!="segmentEnd"&&(u=this._updatePoints(this.selectedObject,t.datavisualization.Diagram.DragState.Completed),u.cancel?u&&u.cancel&&u.eventType&&(u.eventType==="connectorSourceChange"&&this.undoObject.sourceNode&&(this.selectedObject.sourceNode=this.undoObject.sourceNode,this.diagram.nameTable[this.undoObject.sourceNode].outEdges.push(this.selectedObject.name)),u.eventType==="connectorTargetChange"&&this.undoObject.targetNode&&(this.selectedObject.targetNode=this.undoObject.targetNode,this.diagram.nameTable[this.undoObject.targetNode].inEdges.push(this.selectedObject.name))):(this._disconnect(this.selectedObject),this._currentPossibleConnection&&!this.inAction?this._updateConnection(this.selectedObject):(this.selectedObject.sourceNode||this.selectedObject.targetNode)&&this._updateConnection(this.selectedObject),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram)));this.selectedObject.annotation&&(l=this.diagram.nameTable[this.selectedObject.targetNode],t.datavisualization.Diagram.DefautShapes.updateBPMNAnnotationShape(this.selectedObject,this.undoObject.targetNode,l,this.diagram));this.diagram._dock(this.selectedObject,this.diagram.nameTable,!0);t.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram);t.datavisualization.Diagram.SvgContext.update(this.selectedObject,this.diagram);this.diagram._updateConnectorBridging(this.selectedObject);this.diagram._updateQuad(this.selectedObject);this.diagram._updateSelectionHandle();this.selectedObject.annotation&&t.datavisualization.Diagram.DefautShapes.updateAnnotationProperties(this.selectedObject,this.diagram);this.selectedObject&&(this.diagram._svg.getElementById(this.selectedObject.name+"_hitTest").setAttribute("pointer-events","stroke"),this.diagram._svg.getElementById(this.selectedObject.name).setAttribute("pointer-events","auto"));this.diagram._adornerSvg.getElementById(this.diagram._adornerSvg.document.id+"handle_g").setAttribute("pointer-events","visible");this._initialValue=null}if(this.selectedObject)for(a={type:"endpointchanged",undoObject:this.undoObject,redoObject:this._getClonedObject(this.selectedObject),isMultipleNode:this.selectedObject._type==="group"?!0:!1,category:"internal"},this.diagram.addHistoryEntry(a),e=0;e<this._nearestNodes.length;e++)this._showPort(this._nearestNodes[e],!0);delete this._nearestNodes;i.prototype.mouseup.call(this,n)},r.prototype._addOrRemoveStraightSegments=function(n){var s,e,r,f,i,u;if(this._endPoint=="segmentEnd")s=n.target.id,e=s.split("_"),e.reverse(),r=Number(e[0]),i=this.selectedObject.segments[r],i&&i.type=="straight"&&(f=this.selectedObject.segments[r+1],f&&(this.selectedObject.segments.splice(r,1),f._startPoint=f.points[0]=i._startPoint,o=!0));else{var h=n.target.getAttribute("class"),s=n.target.id,o=!1,r=this._findIndex();this.selectedObject.segments&&this.selectedObject.segments[r]&&this.selectedObject.segments[r].type=="straight"&&(i=this.selectedObject.segments[r],u=t.datavisualization.Diagram.Segment({type:"straight",_point:i._endPoint}),this.selectedObject.segments.splice(r+1,0,u),r+1!=this.selectedObject.segments.length-1&&(u.point=u._point),i._point=i.point=i.points[1]=i._endPoint=this.currentPoint,u.points[0]=u._startPoint=this.currentPoint,u.points[1]=u._endPoint=u._point,o=!0)}o&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.Util.updateBridging(this.selectedObject,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))},r.prototype._findIndex=function(){for(var n,o,e,s,h,u,c,l,f,r=[],i=0;i<this.selectedObject.segments.length;i++)n=this.selectedObject.segments[i],o={x:Math.min(n._startPoint.x,n._endPoint.x),y:Math.min(n._startPoint.y,n._endPoint.y),width:Math.abs(n._startPoint.x-n._endPoint.x),height:Math.abs(n._startPoint.y-n._endPoint.y)},t.datavisualization.Diagram.Geometry.inflate(o,this.selectedObject.lineHitPadding/2,this.selectedObject.lineHitPadding/2),t.datavisualization.Diagram.Geometry.containsPoint(o,this.currentPoint)&&r.push(n);if(r.length==1)return this.selectedObject.segments.indexOf(r[0]);for(i=0;i<r.length;i++)u=r[i],f=this.currentPoint,c=(f.y-u._startPoint.y)/(u._endPoint.y-f.y),l=(f.x-u._startPoint.x)/(u._endPoint.x-f.x),e=Math.abs(c-l),i==0&&(s=e,h=0),e<s&&(s=e,h=i);return this.selectedObject.segments.indexOf(r[h])},r.prototype._removeNextSegment=function(n){var i=this.selectedObject.segments[n-1],r=this.selectedObject.segments[n+2],u=this.selectedObject.segments[n+1];return u.length||u.length===0?(this.selectedObject.segments.splice(n,2),this.selectedSegment.direction=="top"||this.selectedSegment.direction=="bottom"?(r._startPoint.y=this.selectedSegment._startPoint.y,i._endPoint.x=r._startPoint.x):(r._startPoint.x=this.selectedSegment._startPoint.x,i._endPoint.y=r._startPoint.y)):(this.selectedObject.segments.splice(n+1,1),this.selectedSegment.direction=="top"||this.selectedSegment.direction=="bottom"?i._endPoint.x=u._endPoint.x:i._endPoint.y=u._endPoint.y,i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint)),this.selectedSegment.length=this.selectedSegment._length=this.selectedSegment.direction=null),i&&r&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,r._startPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,r._startPoint)),(r.length||r.length===0)&&(r._length=r.length=t.datavisualization.Diagram.Geometry.distance(i._endPoint,r._endPoint),r.length&&(r._direction=r.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._endPoint,r._endPoint)))),!0},r.prototype._removePrevSegment=function(n){var i=this.selectedObject.segments[n-2],f=this.selectedObject.segments[n+1],o=f.length||f.length===0?f.length:t.datavisualization.Diagram.Geometry.distance(f.points[0],f.points[1]),r,u,e;return o<=5?(r=this.selectedObject.segments[n+2],f.length===o?this.selectedObject.segments.splice(n-1,4):this.selectedObject.segments.splice(n-1,3),r?(i.direction=="top"||i.direction=="bottom"?(i._endPoint.y=r._endPoint.y,r._startPoint.x=i._endPoint.x):(i._endPoint.x=r._endPoint.x,r._startPoint.y=i._endPoint.y),(i.length||i.length===0)&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i.length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint))),(r.length||r.length===0)&&(r._length=r.length=t.datavisualization.Diagram.Geometry.distance(r._startPoint,r._endPoint),r._length&&(r._direction=r.direction=t.datavisualization.Diagram.Util._getBezierDirection(r._startPoint,r._endPoint)))):(i._endPoint=this.selectedObject.endPoint,i.direction=i.length=i._length=null,i._direction=f._direction)):(u=this.selectedObject.segments[n+1],this.selectedObject.segments.splice(n-1,2),e=this.selectedSegment,e.direction=="left"||e.direction=="right"?(i._endPoint.x=u._startPoint.x,u._startPoint.y=i._endPoint.y):(i._endPoint.y=u._startPoint.y,u._startPoint.x=i._endPoint.x),(this.selectedSegment.length||this.selectedSegment.length===0)&&(i._length=i.length=t.datavisualization.Diagram.Geometry.distance(i._startPoint,i._endPoint),i._length&&(i._direction=i.direction=t.datavisualization.Diagram.Util._getBezierDirection(i._startPoint,i._endPoint))),(u.length||u.length===0)&&(u._length=u.length=t.datavisualization.Diagram.Geometry.distance(u._startPoint,u._endPoint),u.length&&(u._direction=u.direction=t.datavisualization.Diagram.Util._getBezierDirection(u._startPoint,u._endPoint)))),!0},r.prototype._getClonedObject=function(t){if(t){var i=n.extend(!0,{},t);return i.targetNode=t.targetNode,i.sourceNode=t.sourceNode,i.targetPort=t.targetPort,i.sourcePort=t.sourcePort,i}},r.prototype._updateConnection=function(n,i){var r,u;this._endPoint=="targetEndPoint"?(this._currentPossibleConnection?this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(n.targetNode!=this._currentPossibleConnection.name||n.targetPort!=this._possibleConnectionPort.name)&&(r=this._raiseConnectionChangeEvent(n,!0)):t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(n.targetNode!=this._currentPossibleConnection.name||n.targetPort)&&(r=this._raiseConnectionChangeEvent(n,!0)):this.selectedObject.targetNode&&(r=this._raiseConnectionChangeEvent(n,!0)),r&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),(n.segments.length>2||n.segments[0].points.length==2)&&t.datavisualization.Diagram.Util._updatePreviousSegment(n),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom))):this._endPoint=="sourceEndPoint"&&(this._currentPossibleConnection?this._possibleConnectionPort&&t.datavisualization.Diagram.Util.canConnect(this._possibleConnectionPort,!0)?(n.sourceNode!=this._currentPossibleConnection.name||n.sourcePort!=this._possibleConnectionPort.name)&&(r=this._raiseConnectionChangeEvent(n)):t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection)&&(n.sourceNode!=this._currentPossibleConnection.name||n.sourcePort)&&(r=this._raiseConnectionChangeEvent(n)):(this.selectedObject.sourceNode&&(r=this._raiseConnectionChangeEvent(n),t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram)),r&&t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)));u=this.selectedSegment._endPoint;this.diagram._dock(n,this.diagram.nameTable,i);r&&this._endPoint=="sourceEndPoint"&&this.selectedObject.segments.length>1&&(this.selectedSegment.points.length==2&&!this.selectedObject.sourcePort&&this.selectedSegment.length?(this.selectedSegment.direction=="right"||this.selectedSegment.direction=="left"?(this.selectedSegment.direction=this.selectedSegment._startPoint.x<u.x?this.selectedSegment._direction="right":this.selectedSegment._direction="left",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.x-u.x)):(this.selectedSegment.direction=this.selectedSegment._startPoint.y<u.y?this.selectedSegment._direction="bottom":this.selectedSegment._direction="top",this.selectedSegment.length=this.selectedSegment._length=Math.abs(this.selectedSegment._startPoint.y-u.y)),t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)):r&&(t.datavisualization.Diagram.Util._updateConnectorSegments(this.selectedObject,this.selectedObject.sourcePort,this.selectedObject.targetPort,this.diagram),t.datavisualization.Diagram.DiagramContext._refreshSegments(this.selectedObject,this.diagram),t.datavisualization.Diagram.SvgContext._refreshEndPointHandles(this.diagram.selectionList[0],this.diagram._adornerSvg,this.diagram._currZoom)))},r.prototype._raiseConnectionChangeEvent=function(n,i){var u=this._raiseEvent("connectionChange",{element:this.selectedObject,endPoint:this._endPoint,connection:this._currentPossibleConnection,port:this._possibleConnectionPort,cancel:!1}),r;if(!u.cancel)return i?(this._currentPossibleConnection&&n.targetNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.inEdges.push(n.name),n.targetNode&&(r=this.diagram.nameTable[this.selectedObject.targetNode],t.datavisualization.Diagram.Util.removeItem(r.inEdges,n.name))),this.diagram._comparePropertyValues(n,"targetNode",{targetNode:this._currentPossibleConnection?this._currentPossibleConnection.name:null},!0),n.targetNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,this.diagram._comparePropertyValues(n,"targetPort",{targetPort:this._possibleConnectionPort?this._possibleConnectionPort.name:null},!0),n.targetPort=this._possibleConnectionPort?this._possibleConnectionPort.name:null):(this._currentPossibleConnection&&n.sourceNode==this._currentPossibleConnection.name||(this._currentPossibleConnection&&this._currentPossibleConnection.outEdges.push(n.name),n.sourceNode&&(r=this.diagram.nameTable[this.selectedObject.sourceNode],t.datavisualization.Diagram.Util.removeItem(r.outEdges,n.name))),this.diagram._comparePropertyValues(n,"sourceNode",{sourceNode:this._currentPossibleConnection?this._currentPossibleConnection.name:null},!0),n.sourceNode=this._currentPossibleConnection?this._currentPossibleConnection.name:null,this.diagram._comparePropertyValues(n,"sourcePort",{sourcePort:this._possibleConnectionPort?this._possibleConnectionPort.name:null},!0),n.sourcePort=this._possibleConnectionPort?this._possibleConnectionPort.name:null),!0},r.prototype._disconnect=function(){},r.prototype._endAction=function(){this._showPorts();var n;this._currentPossibleConnection&&!this._possibleConnectionPort&&(n=this._currentPossibleConnection);i.prototype._endAction.apply(this);this._endPoint&&(this._endPoint=null,n&&(this.diagram._checkToolToActivate(n,this.currentPoint),this.diagram._updateCursor()))},r.prototype._outOfBoundsDrag=function(n,i,r){if(i=i?i:0,r=r?r:0,n&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var u=this._getPageBounds();if(!this.diagram._selectedSymbol&&(i>=u.width||i<=u.x)||!this.diagram._selectedSymbol&&(r>=u.height||r<=u.y))return this.updateCursor("not-allowed"),!1;this.updateCursor(this.cursor)}return!0},r.prototype._updatePoints=function(n,i){var h=!1,w="",f,c,e,y,r,b,l,a,p,u,o,s,v,k;if(this._endPoint&&this._endPoint!="segmentEnd"&&this.selectedSegment&&(f=this._endPoint=="targetEndPoint"?!0:!1,c=this._endPoint=="sourceEndPoint"?!0:!1,this._endPoint)){y=this._endPoint.match("bezierpoint1")?"bezierpoint1":this._endPoint.match("bezierpoint2")?"bezierpoint2":this._endPoint;switch(y){case"targetEndPoint":e=this.selectedSegment._endPoint;break;case"sourceEndPoint":e=this.selectedSegment._startPoint;break;case"bezierpoint1":e=this.selectedSegment._point1;break;case"bezierpoint2":e=this.selectedSegment._point2}if(r=this.currentPoint,this._possibleConnectionPort==null&&(r=this.snap(r)),b=t.datavisualization.Diagram.Point(e.x-r.x,e.y-r.y),l=this._raiseEndPointDrag(n,f,c,i),l&&(h=l.cancel,w=l.type),!t.datavisualization.Diagram.Geometry.isEmptyPoint(b)&&!h)if(f||c){if(a=this._currentPossibleConnection?t.datavisualization.Diagram.Util.canConnect(this._currentPossibleConnection,!1):!1,this._outOfBoundsDrag(this.selectedObject,r.x,r.y,f)&&(this.selectedObject.segments.length>1&&(f||a||this.selectedSegment.type!="orthogonal"||!this.selectedSegment.length&&this.selectedSegment.length!==0?f&&!a&&this.selectedSegment.type=="orthogonal"&&this.selectedSegment.points.length==2&&(o=r.x-this.selectedSegment._endPoint.x,s=r.y-this.selectedSegment._endPoint.y,this.selectedSegment._direction=="left"||this.selectedSegment._direction=="right"?(this.selectedSegment._startPoint.y=this.selectedSegment.points[0].y+=s,this.selectedSegment._endPoint.y=this.selectedSegment.points[1].y=this.selectedSegment._startPoint.y):(this.selectedSegment._startPoint.x=this.selectedSegment.points[0].x+=o,this.selectedSegment._endPoint.x=this.selectedSegment.points[1].x=this.selectedSegment._startPoint.x),v=this.selectedObject.segments.length-1,this.selectedObject.segments[v-1]&&this.updatePreviousSegment(this.selectedObject.segments[v],this.selectedObject.segments[v-1],o,s)):(this.selectedObject.sourcePoint=r,o=r.x-this.selectedSegment._startPoint.x,s=r.y-this.selectedSegment._startPoint.y,this.selectedSegment.direction=="left"||this.selectedSegment.direction=="right"?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=r.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=r.x,this.selectedSegment._startPoint=this.selectedSegment.points[0]=r,this.selectedSegment._length=this.selectedSegment.length=t.datavisualization.Diagram.Geometry.distance(r,this.selectedSegment._endPoint),this.selectedSegment._length&&(this.selectedSegment._direction=this.selectedSegment.direction=t.datavisualization.Diagram.Util._getBezierDirection(r,this.selectedSegment._endPoint)),this.updateNextSegment(this.selectedObject.segments[0],this.selectedObject.segments[1],o,s),u=this.selectedObject.segments[1],p=!1,u&&u.length&&(u.length=u._length=t.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,u._endPoint),u.length&&(u.direction=u._direction=t.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,u._endPoint))),this.selectedSegment.length==0||u.length===0?(u.length==0&&this.selectedObject.segments.length>2?this.selectedObject.segments.splice(0,2):this.selectedObject.segments.length>1&&this.selectedObject.segments.splice(0,1),this.selectedSegment=this.selectedObject.segments[0],this.selectedSegment._startPoint=this.selectedSegment.points[0]=r,this.selectedSegment._direction=="left"||this.selectedSegment._direction=="right"?this.selectedSegment._endPoint.y=this.selectedSegment.points[this.selectedSegment.points.length-1].y=r.y:this.selectedSegment._endPoint.x=this.selectedSegment.points[this.selectedSegment.points.length-1].x=r.x,u=this.selectedObject.segments[1],this.selectedObject.segments.length>1?(this.selectedSegment._length=this.selectedSegment.length=t.datavisualization.Diagram.Geometry.distance(r,u._startPoint),t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),t.datavisualization.Diagram.Util._addOrthogonalPoints(n.segments[1],n.segments[0],n.segments[2],n.sourcePoint,n.targetPoint),u._startPoint=u.points[0]=n.segments[0]._endPoint):t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),p=!0):t.datavisualization.Diagram.Util._addOrthogonalPoints(this.selectedSegment,null,n.segments[1],n.sourcePoint,n.targetPoint),u&&u.length&&(u.length=u._length=t.datavisualization.Diagram.Geometry.distance(this.selectedSegment._endPoint,u._endPoint),u.length&&(u.direction=u._direction=t.datavisualization.Diagram.Util._getBezierDirection(this.selectedSegment._endPoint,u._endPoint))))),(c||f)&&!a&&(k=this.selectedSegment.points.length,this.diagram._setEndPoint(n,t.datavisualization.Diagram.Point(r.x,r.y),f),k!=this.selectedSegment.points.length||p)))return{updateSelection:!0,cancel:h}}else t.datavisualization.Diagram.Util._setBezierPoint(this.selectedSegment,t.datavisualization.Diagram.Point(r.x,r.y),y)}return{cancel:h,eventType:w}},r}(i);t.datavisualization.Diagram.ConnectionEditTool=o;s=function(i){function r(n){i.call(this,"shapeTool",n);this.cursor="crosshair";this._drawingPolygon=!1;this._points=[]}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){if(i.prototype.mousedown.call(this,n),this._drawingPolygon){var t=this.helper.points[this.helper.points.length-1];t={x:t.x,y:t.y};this.helper.points.push(t);this._points.push(this.currentPoint)}else this.selectedObject=this.createNode(),this.selectedObject.type=="bpmn"&&this.diagram._initGroupNode(this.selectedObject),this.selectedObject._type="node";this._prevPoint=this.currentPoint},r.prototype.createNode=function(){var n=this.diagram._getNewNode(this.diagram.model.drawType);return n.name=this.diagram.model.drawType.name?this.diagram.model.drawType.name+t.datavisualization.Diagram.Util.randomId():"node"+t.datavisualization.Diagram.Util.randomId(),n.offsetX=this.currentPoint.x,n.offsetY=this.currentPoint.y,n.width=5,n.height=5,n.type!="text"&&(n.shape=this.diagram.model.drawType.shape?this.diagram.model.drawType.shape:n.shape),this.diagram.model.drawType.shape!="polygon"||this.diagram.model.drawType.points&&this.diagram.model.drawType.points.length||(this._drawingPolygon=!0,n.points=[{x:this.startPoint.x-2.5,y:this.startPoint.y-2.5},{x:this.currentPoint.x+2.5,y:this.currentPoint.y+2.5}],this._points=[{x:this.startPoint.x-2.5,y:this.startPoint.y-2.5},{x:this.currentPoint.x+2.5,y:this.currentPoint.y+2.5}]),t.datavisualization.Diagram.NodeType(n,this.diagram)},r.prototype.mousemove=function(n){i.prototype.mousemove.call(this,n);this.selectedObject&&(this.inAction?this._updateHelper():(this.inAction=!0,this._initHelper(),this._renderHelper(),this._calcOffset()));this.previousPoint=this.currentPoint},r.prototype.mouseup=function(n){this._drawingPolygon&&n.button!=2&&this.diagram._getEventDetail(n)!=2||(this.inAction&&(this.inAction=!1,this.diagram.model.snapSettings.snapConstraints.snapToLines&&this._calcOffset(),this._drawingPolygon&&(this.selectedObject.points=this.helper.points),this._updateSize(this.selectedObject,this.startPoint,this.currentPoint),this.diagram.add(this.selectedObject)),this.diagram._toolToActivate="selectTool",this.diagram._drawingTool=!1,i.prototype.mouseup.call(this,n),this._drawingPolygon&&(this.diagram._disableDefaultContextMenu=!0,delete this._drawingPolygon,delete this._points))},r.prototype._calcOffset=function(){var r=this.diagram.model.magnification/100,n=t.datavisualization.Diagram.Util.bounds(this.helper),i=n.topLeft;i=t.datavisualization.Diagram.Point(n.x+n.width,n.y+n.height);var u=i.x*r,f=i.y*r,e=t.datavisualization.Diagram.Point(u,f),o=this.snap(t.datavisualization.Diagram.Point(u,f));this._mouseOffset=t.datavisualization.Diagram.Size(e.x-o.x,e.y-o.y)},r.prototype.getBoundingRect=function(){var u=Math.abs(this.startPoint.x-this.currentPoint.x),f=Math.abs(this.startPoint.y-this.currentPoint.y),n=t.datavisualization.Diagram.Size(u,f),i,r;return this.diagram._snapConstraints().snapToVerticalLines&&this._mouseOffset.width!=0&&(n.width-=this._mouseOffset.width,this._mouseOffset.width=0),this.diagram._snapConstraints().snapToHorizontalLines&&this._mouseOffset.height!=0&&(n.height-=this._mouseOffset.height,this._mouseOffset.height=0),i=Math.min(this.startPoint.x,this.currentPoint.x),r=Math.min(this.startPoint.y,this.currentPoint.y),{size:n,offset:t.datavisualization.Diagram.Point(i,r)}},r.prototype._renderHelper=function(){this.svgHelper||(this.helper.type!="bpmn"?this.svgHelper=t.datavisualization.Diagram.SvgContext.renderNode(this.helper,this.diagram._svg,this.diagram._diagramLayer,undefined,this.diagram):(this.helper._type="group",this.diagram._initGroupNode(this.helper),this.svgHelper=t.datavisualization.Diagram.SvgContext.renderGroup(this.helper,this.diagram._svg,this.diagram._diagramLayer,this.diagram.nameTable,this.diagram)),this.svgHelper=document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"))},r.prototype._updateHelper=function(){var i,r;this._drawingPolygon&&(i={x:this.currentPoint.x-this.previousPoint.x,y:this.currentPoint.y-this.previousPoint.y},this.helper.points[this.helper.points.length-1].x+=i.x,this.helper.points[this.helper.points.length-1].y+=i.y,this._points[this._points.length-1].x+=i.x,this._points[this._points.length-1].y+=i.y);r=n.extend(!0,{},this.helper);this._updateSize(this.helper,this.startPoint,this.currentPoint);this.diagram._comparePropertyValues(this.helper,"height",{height:r.height},!0);this.diagram._comparePropertyValues(this.helper,"width",{width:r.width},!0);this.diagram._comparePropertyValues(this.helper,"offsetX",{offsetX:r.offsetX},!0);this.diagram._comparePropertyValues(this.helper,"offsetY",{offsetY:r.offsetY},!0);t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},r.prototype._updateSize=function(n,i,r){var o=this._drawingPolygon?this._points:[i,r],f=t.datavisualization.Diagram.Geometry.rect(o),u={width:f.width,height:f.height},e={x:f.x,y:f.y};t.datavisualization.Diagram.Geometry.isEmptySize(u)||(this.helper.type!="bpmn"?(n.offsetX=e.x+u.width/2,n.offsetY=e.y+u.height/2,n.width=u.width,n.height=u.height,n._shape==="path"&&(n._scaled=!0)):(n._type="group",this.diagram._translate(n,e.x+u.width/2-n.offsetX,e.y+u.height/2-n.offsetY,this.diagram.nameTable),this.diagram.scale(n,u.width/this.helper.width,u.height/this.helper.height,new t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),this.diagram.nameTable),t.datavisualization.Diagram.Util._updateGroupBounds(n,this.diagram)))},r}(i);t.datavisualization.Diagram.ShapeTool=s;r=function(i){function r(n,t){i.call(this,n,t);this.cursor="crosshair";this._isMouseDown=!1;this._targetPossibleConnection=null;this._sourcePossibleConnection=null;this._targetPort=null;this._sourcePort=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){if(i.prototype.mousedown.call(this,n),t.datavisualization.Diagram.Util.isPageEditable(this.diagram)){if(this._isMouseDown=!0,this.diagram._hasSelection()&&this.diagram._clearSelection(),n&&n.type==="touchstart"&&(this._currentPossibleConnection=this.diagram._findConnectableNodeUnderMouse(n),this._currentPossibleConnection)){var r=this.mousePosition(n);this._possibleConnectionPort=this.diagram._findPortAtPoint(r,this._currentPossibleConnection)}this._currentPossibleConnection&&(this._sourcePossibleConnection=this._currentPossibleConnection,this._sourcePort=this._possibleConnectionPort);this._raiseEndPointDrag(this.helper,!0,!1,t.datavisualization.Diagram.DragState.Starting)}},r.prototype.mousemove=function(r){if(i.prototype.mousemove.call(this,r),this._checkConnectionPossible(r),this._isMouseDown)if(this.inAction){if(this._targetPossibleConnection=this._currentPossibleConnection,this._targetPort=this._possibleConnectionPort,this.helper){var f=this._raiseEndPointDrag(this.helper,!0,!1,t.datavisualization.Diagram.DragState.Dragging),u=n.extend(!0,{},this.helper);f.cancel||this._updateHelper();this.diagram._comparePropertyValues(this.helper,"sourcePoint",{sourcePoint:u.sourcePoint},!0);this.diagram._comparePropertyValues(this.helper,"targetPoint",{targetPoint:u.targetPoint},!0);this.diagram._comparePropertyValues(this.helper,"segments",{segments:u.segments},!0);this.diagram._comparePropertyValues(this.helper,"targetNode",{targetNode:this._targetPossibleConnection},!0);this.diagram._comparePropertyValues(this.helper,"targetPort",{targetPort:this._targetPort},!0)}}else this.inAction=!0,this._initHelper(),this._renderHelper();this.previousPoint=this.currentPoint},r.prototype.mouseup=function(n){var r,u,f,s;if(this._isMouseDown=!1,this.inAction){this.inAction=!1;var e=this._getStartPoint(),o=this._getCurrentPoint(),h=t.datavisualization.Diagram.Geometry.distance(e,o);this._outOfBoundsDrag(this.helper,o.x,o.y)&&this._outOfBoundsDrag(this.helper,e.x,e.y)&&h>0&&(r=this.createConnector(e,o),r.name="connector"+t.datavisualization.Diagram.Util.randomId(),this._sourcePossibleConnection&&(this._sourcePort&&t.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(u=this._raiseEvent("connectionChange",{element:r,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),f=this._raiseEndPointDrag(r,!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.sourceNode=this._sourcePossibleConnection.name,r.sourcePort=this._sourcePort.name,t.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name))):t.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(u=this._raiseEvent("connectionChange",{element:r,connection:this._sourcePossibleConnection,port:this._sourcePort,cancel:!1}),f=this._raiseEndPointDrag(r,!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.sourceNode=this._sourcePossibleConnection.name,t.datavisualization.Diagram.Util.removeItem(this._sourcePossibleConnection.outEdges,this.helper.name)))),this._targetPossibleConnection&&(this._targetPort&&t.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(u=this._raiseEvent("connectionChange",{element:r,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),f=this._raiseEndPointDrag(r,!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.targetNode=this._targetPossibleConnection.name,r.targetPort=this._targetPort.name,t.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name))):t.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(u=this._raiseEvent("connectionChange",{element:r,connection:this._targetPossibleConnection,port:this._targetPort,cancel:!1}),f=this._raiseEndPointDrag(r,!0,!1,t.datavisualization.Diagram.DragState.Completed),u.cancel||f.cancel||(r.targetNode=this._targetPossibleConnection.name,t.datavisualization.Diagram.Util.removeItem(this._targetPossibleConnection.inEdges,this.helper.name)))),s=this.diagram.add(r),s&&(r=this.diagram.nameTable[r.name],t.datavisualization.Diagram.Util.updateBridging(r,this.diagram),t.datavisualization.Diagram.SvgContext.update(r,this.diagram),this.diagram._updateConnectorBridging(r)))}this.singleAction&&this.diagram.deactivateTool();this._prevTool&&(this._prevTool.inAction=!1);this._showPorts();i.prototype.mouseup.call(this,n)},r.prototype._getStartPoint=function(){return this._sourcePossibleConnection&&this._sourcePort?t.datavisualization.Diagram.Util._getPortPosition(this._sourcePort,t.datavisualization.Diagram.Util.bounds(this._sourcePossibleConnection)):this.snap(this.startPoint)},r.prototype._getCurrentPoint=function(){return this._targetPossibleConnection&&this._targetPort?t.datavisualization.Diagram.Util._getPortPosition(this._targetPort,t.datavisualization.Diagram.Util.bounds(this._targetPossibleConnection)):this.snap(this.currentPoint)},r.prototype._initHelper=function(){this.helper=this.createConnector(t.datavisualization.Diagram.Point(0,0),t.datavisualization.Diagram.Point(0,0));this.diagram._setZorder(this.helper);this.helper.name="helper";this.helper._connectorType="helper"},r.prototype.createConnector=function(){return null},r.prototype._renderHelper=function(){this.svgHelper||(this.svgHelper=t.datavisualization.Diagram.SvgContext.renderConnector(this.helper,this.diagram._svg,this.diagram._diagramLayer),this.svgHelper=this.diagram._svg.document.getElementById(this.helper.name),this.svgHelper.setAttribute("pointer-events","none"),n(this.diagram._svg.getElementById(this.svgHelper.id)).attr("pointer-events","none"),n(this.diagram._svg.getElementById(this.svgHelper.id+"_hitTest")).attr("pointer-events","none"))},r.prototype._outOfBoundsDrag=function(n,i,r){if(i=i?i:0,r=r?r:0,n&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){var u=this._getPageBounds();if(!this.diagram._selectedSymbol&&(i>=u.width||i<=u.x)||!this.diagram._selectedSymbol&&(r>=u.height||r<=u.y))return this.updateCursor("not-allowed"),!1;this.updateCursor(this.cursor)}return!0},r.prototype._updateHelper=function(){var r=[],n=this._getStartPoint(),i=this._getCurrentPoint();r.push(n);r.push(i);this._outOfBoundsDrag(this.helper,i.x,i.y)&&this._outOfBoundsDrag(this.helper,n.x,n.y)&&(this.diagram._setEndPoint(this.helper,n,!1),this.diagram._setEndPoint(this.helper,i,!0),this._disconnect(this.helper),this._sourcePossibleConnection&&(this._sourcePort&&t.datavisualization.Diagram.Util.canConnect(this._sourcePort,!0)?(this.helper.sourceNode=this._sourcePossibleConnection.name,this.helper.sourcePort=this._sourcePort.name,this._sourcePossibleConnection.outEdges.push(this.helper.name)):t.datavisualization.Diagram.Util.canConnect(this._sourcePossibleConnection)&&(this.helper.sourceNode=this._sourcePossibleConnection.name,this._sourcePossibleConnection.outEdges.push(this.helper.name))),this._targetPossibleConnection&&(this._targetPort&&t.datavisualization.Diagram.Util.canConnect(this._targetPort,!0)?(this.helper.targetNode=this._targetPossibleConnection.name,this.helper.targetPort=this._targetPort.name,this._targetPossibleConnection.inEdges.push(this.helper.name)):t.datavisualization.Diagram.Util.canConnect(this._targetPossibleConnection)&&(this.helper.targetNode=this._targetPossibleConnection.name,this._targetPossibleConnection.inEdges.push(this.helper.name))),this.diagram._dock(this.helper,this.diagram.nameTable));t.datavisualization.Diagram.SvgContext.update(this.helper,this.diagram)},r.prototype._endAction=function(){i.prototype._endAction.apply(this);this._targetPossibleConnection=null;this._sourcePossibleConnection=null;this._targetPort=null;this._sourcePort=null;this._isMouseDown=!1},r.prototype._showPorts=function(){},r.prototype._showAllPorts=function(n){i.prototype._showAllPorts.call(this,n)},r}(i);t.datavisualization.Diagram.LineTool=r;h=function(i){function r(n){i.call(this,"straightLine",n)}return t.datavisualization.Diagram.extend(r,i),r.prototype.createConnector=function(t,i){var r={segments:[{type:"straight"}],sourcePoint:t,targetPoint:i};return this.diagram._getNewConnector(n.extend(!0,{},r,this.diagram.model.drawType))},r}(r);t.datavisualization.Diagram.StraightLineTool=h;c=function(i){function r(n){i.call(this,"orthogonalLine",n)}return t.datavisualization.Diagram.extend(r,i),r.prototype.createConnector=function(t,i){var r={segments:[{type:"orthogonal"}],sourcePoint:t,targetPoint:i};return this.diagram._getNewConnector(n.extend(!0,{},r,this.diagram.model.drawType))},r}(r);t.datavisualization.Diagram.OrthogonalLineTool=c;l=function(i){function r(n){i.call(this,"bezierLine",n)}return t.datavisualization.Diagram.extend(r,i),r.prototype.createConnector=function(t,i){var r={segments:[{type:"bezier"}],sourcePoint:t,targetPoint:i};return this.diagram._getNewConnector(n.extend(!0,{},r,this.diagram.model.drawType))},r}(r);t.datavisualization.Diagram.BezierLineTool=l;a=function(i){function r(n){i.call(this,"rotatetool",n);this._mouseOffset=t.datavisualization.Diagram.Size(0,0);this.undoObject=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(t){var u,r,f,e;i.prototype.mousedown.call(this,t);this.selectedObject=this.diagram.selectionList[0];r={};(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(r=this.diagram._getChildTable(this.selectedObject,r));f={childTable:r,node:this.selectedObject};u=n.extend(!0,{},f);this.undoObject=jQuery.extend(!0,{},u);e=this.diagram._currZoom},r.prototype.mousemove=function(n){var f,e,r,o,u,s;if(i.prototype.mousemove.call(this,n),f=!this.inAction,this.selectedObject){if(!this.inAction){if(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")for(e=this.diagram._getChildren(this.selectedObject.children),r=0;r<e.length;r++)if(o=this.diagram.nameTable[e[r]],!o.segments&&!t.datavisualization.Diagram.Util.canRotate(o))return;this._initialValue=this.selectedObject.rotateAngle;this.inAction=!0}u=!1;this.selectedObject.parent?(s=this.diagram.nameTable[this.selectedObject.parent],s.container&&(u=!0)):this.selectedObject.type=="pseudoGroup"&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(u=!0);u?this.selectedObject.type=="pseudoGroup"&&this._isParentAsLane(this.selectedObject)?(t.datavisualization.Diagram.canvasHelper._removeFromParentContainer(this.diagram,this.selectedObject),this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram)):(this.helper||(this.helper=this._getCloneNode(this.selectedObject),this.helper.inEdges=this.helper.outEdges=[],this.helper.type=null,this.helper.name="helper"),this._rotate(this.helper),t.datavisualization.Diagram.SvgContext._drawContainerHelper(this.diagram)):this.selectedObject.type=="pseudoGroup"&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))?this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject,f)):(this.selectedObject.type==="pseudoGroup"&&this._updateMultipleUndoObject(this.selectedObject),this._rotate(this.selectedObject),this.selectedObject.parent&&t.datavisualization.Diagram.Util._updateGroupBounds(this.diagram.nameTable[this.selectedObject.parent],this.diagram),t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram),this.diagram._updateSelectionHandle(!0),this.diagram._renderTooltip(this.selectedObject,f))}this.previousPoint=this.currentPoint},r.prototype._rotate=function(n){var u,f,e=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),c=this.currentPoint,r=t.datavisualization.Diagram.Geometry.findAngle(t.datavisualization.Diagram.Point(e.x,e.y),c)+90,i,o,s,h;r=t.datavisualization.Diagram.SnapUtil._snapAngle(this.diagram,r)-n.rotateAngle;i=t.datavisualization.Diagram.Util.bounds(n);u=t.datavisualization.Diagram.Rectangle(i.left,i.top,i.right-i.left,i.bottom-i.top);o={bounds:u,offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height};this.diagram._comparePropertyValues(n,"rotateAngle",{rotateAngle:r},!0);this.diagram._rotate(n,r,this.diagram.nameTable);i=t.datavisualization.Diagram.Util.bounds(n);f=t.datavisualization.Diagram.Rectangle(i.left,i.top,i.right-i.left,i.bottom-i.top);s={bounds:f,offsetX:n.offsetX,offsetY:n.offsetY,width:n.width,height:n.height};h=this._raiseEvent("rotationChange",{element:this.diagram.getNode(n),angle:n.rotateAngle,oldValue:o,newValue:s,cancel:!1});h.cancel&&this.diagram._rotate(n,-r,this.diagram.nameTable)},r.prototype.mouseup=function(r){var u,h,c,f,l,a;if(this.inAction){this.inAction=!1;var e=!1,o=!0,s=!1;this.selectedObject.parent?(u=this.diagram.nameTable[this.selectedObject.parent],u.container&&(e=!0)):this.selectedObject.type=="pseudoGroup"&&this.hasSameParent()&&this._fromContainer(this.diagram._getChildren(this.selectedObject.children))&&(h=this.diagram.nameTable[this.diagram._getChild(this.selectedObject.children[0])],u=this.diagram.nameTable[h.parent],u.container&&(e=!0));(this.selectedObject.type=="pseudoGroup"||this.selectedObject.name=="multipleSelection")&&this.diagram._activeSwimLane?t.datavisualization.Diagram.canvasHelper._multiNodeRotate(this.diagram,r,this.selectedObject):e&&(t.datavisualization.Diagram.SvgContext._removeContainerHelper(this.selectedObject,this.diagram._adornerSvg,this.diagram._adornerLayer),this._removeHighLighter(),u.container.type=="canvas"&&(s=!0),s&&(t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(this.diagram,this.diagram.activeTool.helper,u)?t.datavisualization.Diagram.canvasHelper._singleNodeRotate(this.diagram,r,this.selectedObject):o=!1));this.selectedObject.type!="pseudoGroup"?o&&this._rotate(this.selectedObject):this._fromContainer(this.diagram._getChildren(this.selectedObject.children))||this._rotate(this.selectedObject);t.datavisualization.Diagram.DiagramContext.update(this.selectedObject,this.diagram);f={};(this.selectedObject._type==="group"||this.selectedObject.type==="pseudoGroup")&&(f=this.diagram._getChildTable(this.selectedObject,f));l={childTable:f,node:this.selectedObject};c=n.extend(!0,{},l);a={type:"rotationchanged",undoObject:this.undoObject,redoObject:jQuery.extend(!0,{},c),isMultipleNode:this.selectedObject._type==="group"?!0:!1,category:"internal"};this._multipleUndo||this.diagram.addHistoryEntry(a);this.selectedObject&&t.datavisualization.Diagram.SvgContext._removePivotPoint(this.selectedObject,this.diagram._adornerSvg,this.diagram._currZoom);this.diagram._updateSelectionHandle();this.diagram._removeTooltip()}this._multipleUndo=!1;i.prototype.mouseup.call(this,r)},r}(i);t.datavisualization.Diagram.RotateTool=a;v=function(n){function i(i){n.call(this,"PivotTool",i);this._mouseOffset=t.datavisualization.Diagram.Size(0,0)}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){n.prototype.mousedown.call(this,t);this.selectedObject=this.diagram.selectionList[0]},i.prototype.mousemove=function(i){if(n.prototype.mousemove.call(this,i),this.selectedObject)if(this.inAction){var r=this.currentPoint.x-this.previousPoint.x,u=this.currentPoint.y-this.previousPoint.y,f=t.Matrix.identity();t.Matrix.rotate(f,-this.selectedObject.rotateAngle);var e=t.Matrix.transform(f,t.datavisualization.Diagram.Point(r,u)),o=(this.selectedObject.width*this.selectedObject.pivot.x+e.x)/this.selectedObject.width,s=(this.selectedObject.height*this.selectedObject.pivot.y+e.y)/this.selectedObject.height;this.selectedObject.pivot.x=o;this.selectedObject.pivot.y=s;this.selectedObject.offsetX+=r;this.selectedObject.offsetY+=u;this.diagram._updateSelectionHandle()}else this.inAction=!0;this.previousPoint=this.currentPoint},i.prototype._rotate=function(n){var i=t.datavisualization.Diagram.Point(n.offsetX,n.offsetY),r=this.currentPoint,u=this.FindAngle(i,r);this.diagram._rotate(n,u-n.rotateAngle,i,this.diagram.nameTable)},i.prototype.mouseup=function(t){this.inAction&&(this.inAction=!1,this.diagram._updateSelectionHandle());n.prototype.mouseup.call(this,t)},i}(i);t.datavisualization.Diagram.PivotTool=v;y=function(n){function i(t){n.call(this,"panTool",t);this.diagram=t;this._isMouseDown=!1;this.cursor="pointer"}return t.datavisualization.Diagram.extend(i,n),i.prototype.mousedown=function(t){var r;n.prototype.mousedown.call(this,t);var u=this.diagram._svg.document,i=this.diagram._svg.document.createSVGPoint(),f=this.diagram._isTouchEvent(t);return i.x=f.clientX,i.y=f.clientY,r=i.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),u.lastMouseX=r.x,u.lastMouseY=r.y,this._isMouseDown=!0,!1},i.prototype.mousemove=function(i){if(n.prototype.mousemove.call(this,i),this._isMouseDown&&(this.startPoint.x!=this.currentPoint.x||this.startPoint.y!=this.currentPoint.y)){this.inAction=!0;var r=this.diagram._svg.document,u=this.diagram._svg.document.createSVGPoint(),h=this.diagram._isTouchEvent(i);u.x=h.clientX;u.y=h.clientY;var c=u.matrixTransform(this.diagram._svg.document.getScreenCTM().inverse()),f=c.x,e=c.y,o,s;return o=f-r.lastMouseX,s=e-r.lastMouseY,this.diagram.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableX||(o=0),this.diagram.model.constraints&t.datavisualization.Diagram.DiagramConstraints.PannableY||(s=0),t.datavisualization.Diagram.ZoomUtil.zoomPan(this.diagram,1,o,s,t.datavisualization.Diagram.Point(f,e)),r.lastMouseX=f,r.lastMouseY=e,!1}},i.prototype.mouseup=function(i){this.inAction=!1;document.onmousemove=null;document.onmouseup=null;this._isMouseDown=!1;this.diagram._removeTooltip();this.diagram._isEditing||this.diagram._isDragg||this.diagram._endEdit();delete this.hoverNode;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);n.prototype.mouseup.call(this,i)},i}(i);t.datavisualization.Diagram.PanTool=y;p=function(i){function r(n,r){i.call(this,n,r);this.boundingRect=t.datavisualization.Diagram.Rectangle();this.activeLabel=null;this._overNode="";this.cursor="crosshair"}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);this._findNodeUnderMouse(n);var t=this._getNodeUnderMouse();t&&(this._overNode=this.selectedObject&&!this.selectedObject.isLane||t.isLane?t.name:"");this.diagram._isEditing&&this.diagram._endEdit()},r.prototype.createNode=function(){},r.prototype.mousemove=function(n){i.prototype.mousemove.call(this,n);t.datavisualization.Diagram.Util.isPageEditable(this.diagram)&&(this.selectedObject||t.datavisualization.Diagram.Geometry.isEmptyPoint(this.startPoint)||this.diagram._isEditing||(this.inAction?this._updateHelper():(this.inAction=!0,this._initHelper())))},r.prototype.mouseup=function(n){var r,u,i;this.activeLabel=null;r=12;this.inAction?(i=this.getBoundingRect(this.startPoint,this.currentPoint),this._endAction(),(i.width===0||i.height===0)&&(i.width=90,i.height=r),this.selectedObject=this.createNode(i.x+i.width/2,i.y+i.height/2,i.width,i.height),this.diagram._startEdit(this.selectedObject)):(u=this._findNodeUnderMouse(n),t.datavisualization.Diagram.Util.isPageEditable(this.diagram)&&(u==null||u.isSwimlane||u.isLane?(i=t.datavisualization.Diagram.Rectangle(this.currentPoint.x-45,this.currentPoint.y-r/2,90,r),this._endAction(),this.selectedObject=this.createNode(i.x+i.width/2,i.y+i.height/2,i.width,r),this.diagram._startEdit(this.selectedObject)):(this.selectedObject=u,this.diagram._startEdit(this.selectedObject))));this._overNode=""},r.prototype.getBoundingRect=function(){var n=Math.abs(this.startPoint.x-this.currentPoint.x),t=Math.abs(this.startPoint.y-this.currentPoint.y),i=this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x,r=this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y;return{x:i,y:r,width:n,height:t}},r.prototype._initHelper=function(){var n,t,i;this._svgHelper||(n=this.diagram._adornerSvg.g(),this.diagram._adornerLayer.appendChild(n),t=this.diagram._currZoom,i=this.diagram._svg.rect({id:"helper",x:this.startPoint.x*t,y:this.startPoint.y*t,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"}),n.appendChild(i),n.setAttribute("pointer-events","none"),this._svgHelper=n)},r.prototype._updateHelper=function(){var t=this.diagram._adornerSvg.getElementById("helper"),i=Math.abs(this.startPoint.x-this.currentPoint.x),r=Math.abs(this.startPoint.y-this.currentPoint.y),n=this.diagram._currZoom,u=(this.startPoint.x>this.currentPoint.x?this.currentPoint.x:this.startPoint.x)*n,f=(this.startPoint.y>this.currentPoint.y?this.currentPoint.y:this.startPoint.y)*n;t&&this.diagram._adornerSvg.rect({id:t.id,x:u,y:f,width:i*n,height:r*n})},r.prototype._endAction=function(){this._svgHelper&&(this.diagram._adornerLayer.removeChild(this._svgHelper),this._svgHelper=null);i.prototype._endAction.apply(this)},r.prototype._findNodeUnderMouse=function(t){var i,o=this.diagram._isForeignObject(t.target),e,s,r,f;if(o&&(t.target=o),e=t.target,e.getAttribute("class")=="ej-d-label")s=n(e).parents(".ej-d-node,.ej-d-connector,.ej-d-group")[0],i=this._findObj(s),this.activeLabel=this.diagram._findLabelAtPoint(this.currentPoint,i);else if(r=n(t.target).parents("g"),r.length>3){var h=r[r.length-4],c=h.getAttribute("id"),u=h.getAttribute("class");u&&(u==="ej-d-node"||u==="ej-d-group"?(i=this.diagram._findNode(c),f=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=f):u==="ej-d-connector"&&(i=this.diagram._findConnector(c),f=this.diagram._findLabelAtPoint(this.currentPoint,i),this.activeLabel=f))}return i},r}(t.datavisualization.Diagram.ToolBase);t.datavisualization.Diagram.TextToolBase=p;w=function(n){function i(t){n.call(this,"textTool",t)}return t.datavisualization.Diagram.extend(i,n),i.prototype.createNode=function(n,i,r,u){var f=this.diagram._getNewNode({name:"text"+t.datavisualization.Diagram.Util.randomId(),offsetX:n,offsetY:i,width:r,height:u,borderColor:"transparent",fillColor:"transparent",labels:[],ports:[],type:"text",parent:this._overNode}),e;return(f._type="text")&&(f._type="node"),e=this.diagram.nameTable[f.parent],e&&e.container&&this._updateMargin(f,e),f},i}(t.datavisualization.Diagram.TextToolBase);t.datavisualization.Diagram.TextTool=function(n){return new w(n)};b=function(i){function r(n){i.call(this,"phase",n);this.selectedSeperator=null;this._svgHelper=null}return t.datavisualization.Diagram.extend(r,i),r.prototype.mousedown=function(n){i.prototype.mousedown.call(this,n);this.inAction=!0},r.prototype._getSeperator=function(t){if(n(t.target).parents("g").first()[0]){var i=n(t.target).parents("g").first()[0].id;if(i)return this._getphase(i.split("_phase_g")[0])}},r.prototype._removePhasehelper=function(){t.datavisualization.Diagram.SvgContext._removePhasehelper(this.diagram)},r.prototype._outOfBoundsDrag=function(n){var f=this.currentPoint.x-this.startPoint.x,e=this.currentPoint.y-this.startPoint.y,i,r,u;if(n&&t.datavisualization.Diagram.Util.canMoveOutofBoundary(this.diagram)){if(i=this._getPageBounds(),r=this.diagram.nameTable[n.parent],r&&((u=t.datavisualization.Diagram.Util.bounds(r),!this.diagram._selectedSymbol&&(u.right+f>=i.width||n.offset+f<i.x))||!this.diagram._selectedSymbol&&(u.bottom+e>=i.height||n.offset+e<i.y)))return this.updateCursor("not-allowed"),!1;n.orientation=="horizontal"?this.updateCursor("e-resize"):this.updateCursor("n-resize")}return!0},r.prototype._updatePhasehelper=function(i){var f=this._bounds?jQuery.extend(!0,{},this._bounds):this.diagram._getPhaseBounds(i),r,u,e=this.startPoint,o=this.currentPoint,s={snapped:!1,offset:0,left:!1,right:!1},h={snapped:!1,offset:0,top:!1,bottom:!1};this.selectedObject=this.diagram.nameTable[this.selectedSeperator.parent];this.initialBounds={width:this.selectedObject.width,height:this.selectedObject.height,y:this.selectedObject.offsetY,x:this.selectedObject.offsetX};i.orientation==="horizontal"?(r=o.x-e.x,r=this._snapRight(s,h,r,0,this.selectedObject,!1),u=0,this.diagram._comparePropertyValues(i,"offset",{offset:i.offset+r},!0)):(r=0,u=o.y-e.y,u=this._snapBottom(s,h,0,u,this.selectedObject,!1),this.diagram._comparePropertyValues(i,"offset",{offset:i.offset+u},!0));f&&(f.width+=r,f.height+=u,this._helperBounds=n.extend(!0,{},f),t.datavisualization.Diagram.SvgContext._updatePhaseHelper(this.diagram,i,f))},r.prototype._drawPhasehelper=function(n){var i=this.diagram._getPhaseBounds(n);n&&i&&t.datavisualization.Diagram.SvgContext._phasehelper(this.diagram,n,i)},r.prototype.mousemove=function(n){if(i.prototype.mousemove.call(this,n),t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram),this._outOfBoundsDrag(this.selectedSeperator)){if(this.selectedSeperator)this.selectedSeperator&&(this._bounds||(this._bounds=this.diagram._getPhaseBounds(this.selectedSeperator)),this._updatePhasehelper(this.selectedSeperator));else{if(this.inAction){var r=this._getSeperator(n);r&&!this.selectedSeperator&&(this.selectedSeperator=r)}this._drawPhasehelper(this.selectedSeperator);this.diagram.selectionList[0]&&this.diagram.selectionList[0].type!="phase"?(this.diagram._clearSelection(!0),this.diagram.addSelection(this.selectedSeperator,!0)):this.diagram.addSelection(this.selectedSeperator,!0)}this.previousPoint=this.currentPoint}},r.prototype._getPadding=function(n){var r=20,u=20,f=this.diagram.nameTable[this.diagram._getChild(n.children[n.children.length-1])],i,t;return f&&(i=f.children,i.length>0&&(t=this.diagram.nameTable[this.diagram._getChild(i[0])],t&&t.isLane&&(r=t.paddingRight,u=t.paddingBottom))),{x:r,y:u}},r.prototype.mouseup=function(n){var u=this._getSeperator(n),e,r,h,c;if(this.diagram.selectionList.length>0&&u&&this.diagram.selectionList[0].name!=u.name&&this.diagram._clearSelection(!0),u&&!this.selectedSeperator)this.selectedSeperator=u,this.diagram.addSelection(this.selectedSeperator,!0);else if(this.selectedSeperator&&(e=this.selectedSeperator.parent.split("phaseStack")[0],e&&(r=this.diagram.nameTable[e],r&&this._helperBounds&&r.isSwimlane))){var o=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(this.diagram,r),f=0,s=o.indexOf(this.selectedSeperator.name);s>0?f=this.diagram.nameTable[o[s-1]].offset:r.orientation==="horizontal"&&(f=50);h=jQuery.extend(!0,{},this.selectedSeperator);r.orientation==="horizontal"?this.diagram._updatePhase({name:this.selectedSeperator.name,offset:f+this._helperBounds.width}):this.diagram._updatePhase({name:this.selectedSeperator.name,offset:f+this._helperBounds.height});c={type:"phasepositionchanged",undoObject:jQuery.extend(!0,{},h),redoObject:jQuery.extend(!0,{},jQuery.extend(!0,{},this.selectedSeperator)),category:"internal"};this._multipleUndo||this.diagram.addHistoryEntry(c);this.diagram.addSelection(this.selectedSeperator,!0)}this._removePhasehelper();this._bounds=null;this.inAction=!1;this.selectedSeperator=null;t.datavisualization.Diagram.SnapUtil._removeGuidelines(this.diagram);i.prototype.mouseup.call(this,n)},r.prototype._getOuterPhaseNodes=function(n,i){var f,r,e;if(n){var o=this.diagram.nameTable[this.diagram._getChild(n.children[2])],s=[],h=null,u=null;for(f=0;o&&f<o.children.length;f++)if(r=this.diagram.nameTable[this.diagram._getChild(o.children[f])],r&&r.children&&r.children.length>1)for(e=0;e<r.children.length;e++)u=this.diagram.nameTable[this.diagram._getChild(r.children[e])],u&&(h=t.datavisualization.Diagram.Util.bounds(u),i?h.y>n.offsetY-n.height/2+this.selectedSeperator.offset&&s.push(u):h.x>n.offsetX-n.width/2+this.selectedSeperator.offset&&s.push(u))}return s},r}(i);t.datavisualization.Diagram.PhaseTool=b}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.LayoutTypes={None:"none",HierarchicalTree:"hierarchicaltree",OrganizationalChart:"organizationalchart",RadialTree:"radialtree"};t.datavisualization.Diagram.ChartOrientations={Horizontal:"horizontal",Vertical:"vertical"};t.datavisualization.Diagram.ChartTypes={Left:"left",Right:"right",Alternate:"alternate",Center:"center"};t.datavisualization.Diagram.Layout={doLayout:function(i,r){var e=i.model,u={diagram:i,_anchorX:0,_anchorY:0,_graphNodes:{},_firstLevelNodes:[],_centerNode:null,levels:[],maxLevel:0,layoutNodes:[]};for(var f in e.layout)f=="type"?u.type=i._layoutType():f=="orientation"?u.orientation=i._layoutOrientation():f=="fixedNode"?u.fixedNode=i._fixedNode():f=="horizontalSpacing"?u.horizontalSpacing=Number(i._horizontalSpacing()):f=="verticalSpacing"?u.verticalSpacing=Number(i._verticalSpacing()):f=="marginX"?u.marginX=Number(i._layoutMarginX()):f=="marginY"?u.marginY=Number(i._layoutMarginY()):f=="getLayoutInfo"?typeof e.layout.getLayoutInfo=="string"?u.getLayoutInfo=t.util.getObject(e.layout.getLayoutInfo,window):n.isFunction(e.layout.getLayoutInfo)&&(u.getLayoutInfo=e.layout.getLayoutInfo):f=="getConnectorSegments"?typeof e.layout.getConnectorSegments=="string"?u.getConnectorSegments=t.util.getObject(e.layout.getConnectorSegments,window):n.isFunction(e.layout.getConnectorSegments)&&(u.getConnectorSegments=e.layout.getConnectorSegments):u[f]=e.layout[f];return u.updateView=r===undefined?!0:u.updateView,u.objects=[],u.type!="radialtree"?t.datavisualization.Diagram.HierarchicalLayout.doLayout(u):t.datavisualization.Diagram.RadialTreeLayout.doLayout(u),u.updateView?void 0:u.objects}};t.datavisualization.Diagram.HierarchicalLayout={doLayout:function(n){var u,p,e,r,y,l,t,i,a,v,o,s,h,c,f;if(u=n.diagram,p=u.model,e=u.nodes(),e.length>0){for(t=0;t<e.length;t++)r=e[t],r.excludeFromLayout||(y=n._graphNodes[r.name]=this._setUpLayoutInfo(n,r),y.tree.hasSubTree=!1,r.inEdges&&r.inEdges.length||n._firstLevelNodes.push(r));for(t=0;t<n._firstLevelNodes.length;t++)r=n._firstLevelNodes[t],this._updateEdges(n,r,1);l=n._graphNodes;for(t in l)delete l[t]._updateEdge;if(n._firstLevelNodes.length>0){for(n._rootNode=n._firstLevelNodes[0],a=0,v=0,t=0;t<n._firstLevelNodes.length;t++)i=this._updateTree(n,a,v,n._firstLevelNodes[t],0,n._firstLevelNodes[t-1]),f=n._graphNodes[n._firstLevelNodes[t].name],f.y<i.y&&(i.y=f.y),f.x<i.x&&(i.x=f.x),n.orientation=="lefttoright"||n.orientation=="righttoleft"?v=i.right+n.horizontalSpacing:a=i.right+n.horizontalSpacing,t==0?(o=i.x,h=i.y,s=i.right,c=i.bottom):(o=Math.min(o,i.x),h=Math.min(h,i.y),s=Math.max(s,i.right),c=Math.max(c,i.bottom));for(this._updateAnchor(n,{x:o,y:h,right:s,bottom:c}),u._layoutInAction=!0,t=0;t<n._firstLevelNodes.length;t++)this._updateNodes(n,n._firstLevelNodes[t],0);if(u._layoutInAction=!1,n._finalUpdate=!0,n._hasMultipleParent&&this._fromSameLayout(n,n._firstLevelNodes)&&this._updateChildTreePosition(n,n._firstLevelNodes),delete n._hasMultipleParent,delete n._finalUpdate,n.updateView||(u._internalLayout=n),n.updateView)for(t=0;t<n._firstLevelNodes.length;t++)this._updateConnectors(n,n._firstLevelNodes[t],1)}}},_getconnectedNodes:function(n,t){var r=[],i,u,e,f,o;if(t&&t.outEdges&&t.outEdges.length>0)for(i=0;i<t.outEdges.length;i++)if(u=n.diagram.nameTable[n.diagram._getChild(t.outEdges[i])],u.targetNode){e=n.diagram.nameTable[n.diagram._getChild(u.targetNode)];f=this._getconnectedNodes(n,e);for(o in f)r.push(f[o])}return r.push(t),r},_connectedAny:function(n,t){for(var r,i=0;i<n.length;i++)for(r=0;r<t.length;r++)if(n[i]===t[r])return!0;return!1},_fromSameLayout:function(n,t){var i,r,u;if(t&&t.length>0)for(i=1;i<t.length;i++)if(r=this._getconnectedNodes(n,t[i-1]),u=this._getconnectedNodes(n,t[i]),!this._connectedAny(r,u))return!1;return!0},_sameCollection:function(n,t){if(n&&t&&n.length>0&&t.length>0&&n.length===t.length){for(var i in n)if(t.indexOf(n[i])===-1)return!1;return!0}},_containsSameChildren:function(n,t){for(var e,u,i,r,o=[],s=[],f=0;f<t.length;f++)if(e=n.diagram.nameTable[n.diagram._getChild(t[f])],e)if(f==0)for(u=e.outEdges,i=0;i<u.length;i++)r=n.diagram.nameTable[n.diagram._getChild(u[i])],r&&r.targetNode&&o.push(r.targetNode);else{for(u=e.outEdges,i=0;i<u.length;i++)r=n.diagram.nameTable[n.diagram._getChild(u[i])],r&&r.targetNode&&s.push(r.targetNode);if(!this._sameCollection(o,s))return!1}return!0},_positionToCenterofChildren:function(n,i){var f,e,r;if(i&&i.length>1&&this._containsSameChildren(n,i)){var u=[],s=n.diagram.nameTable[n.diagram._getChild(i[0])],o=s.outEdges;for(f=0;f<o.length;f++)e=n.diagram.nameTable[n.diagram._getChild(o[f])],e&&e.targetNode&&u.push(n.diagram.nameTable[e.targetNode]);if(u.length==i.length)for(r=0;r<i.length;r++)n.orientation==="toptobottom"||n.orientation==="bottomtotop"?n.diagram._translate(i[r],u[r].offsetX-i[r].offsetX,0,n.diagram.nameTable):n.diagram._translate(i[r],0,u[r].offsetY-i[r].offsetY,n.diagram.nameTable),n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(i[r],n.diagram)}},_getFirstLevelNodes:function(n,t){var r=[],i;for(var u in t)i=n.diagram.nameTable[n.diagram._getChild(t[u])],i&&i.outEdges&&i.outEdges.length&&r.push(t[u]);return r},_updateChildTreePosition:function(n,t){for(var e=this._getFirstLevelNodes(n,t),i=this._getGroupBounds(e,n.diagram),r=this._nextLevelNodes(t,n.diagram,n),u=this._getGroupBounds(r,n.diagram),f=0;f<r.length;f++)n.orientation==="toptobottom"||n.orientation==="bottomtotop"?this._updateTreePosition(n,r[f],i.x+i.width/2-(u.x+u.width/2),0):this._updateTreePosition(n,r[f],0,i.y+i.height/2-(u.y+u.height/2));this._positionToCenterofChildren(n,t)},_nextLevelNodes:function(n,i,r){var s=n,u,h=[],e,o,f,c;if(s.length>0)for(e=0;e<s.length;e++)if(u=i.nameTable[i._getChild(s[e])],u&&u.outEdges&&u.outEdges.length>0&&u.inEdges&&u.inEdges.length===0)for(o=0;o<u.outEdges.length;o++)f=i.nameTable[u.outEdges[o]],t.datavisualization.Diagram.Util._collectionContains(f.targetNode,h)||(c=r._graphNodes[u.name],c.tree.assistants.indexOf(f.targetNode)==-1&&h.push(i.nameTable[f.targetNode]));return h},_getGroupBounds:function(n,i){var u=n,o,f=t.datavisualization.Diagram.Rectangle(),r,e,s;for(u.length>0&&(r=i.nameTable[i._getChild(u[0])],r&&(f=t.datavisualization.Diagram.Util.bounds(r))),e=0,s=u.length;e<s;e++)r=i.nameTable[i._getChild(u[e])],r&&(o=t.datavisualization.Diagram.Util.bounds(r)),o&&(f=t.datavisualization.Diagram.Geometry.union(f,o));return f},_updateTreePosition:function(n,i,r,u){var e,s,a,h,f,o;if(n.diagram._translate(i,r,u,n.diagram.nameTable),i&&i.outEdges&&i.outEdges.length>0)for(f=0;f<i.outEdges.length;f++)o=n.diagram.nameTable[i.outEdges[f]],this._updateTreePosition(n,n.diagram.nameTable[o.targetNode],r,u);if(n._finalUpdate&&i.inEdges&&i.inEdges.length>0){for(e=[],s=0;s<i.inEdges.length;s++)if(a=n.diagram.nameTable[i.inEdges[s]],h=n.diagram.nameTable[a.sourceNode],h.outEdges&&h.outEdges.length==1)e.push(h);else{e=[];break}if(e&&e.length>0){var c=this._getGroupBounds(e,n.diagram),l=0,v=0;if(n.orientation==="toptobottom"||n.orientation==="bottomtotop"?l=c.x+c.width/2-i.offsetX:v=c.y+c.height/2-i.offsetY,n.diagram._translate(i,l,v,n.diagram.nameTable),i&&i.outEdges&&i.outEdges.length>0)for(f=0;f<i.outEdges.length;f++)o=n.diagram.nameTable[i.outEdges[f]],this._updateTreePosition(n,n.diagram.nameTable[o.targetNode],l,u)}}n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(i,n.diagram)},_updateTree:function(n,t,i,r,u,f,e){var o,s,l,y,p,c,w,a,b,v,k,h;return o=this._getDimensions(n,r,t,i,u),s=n._graphNodes[r.name],n.maxLevel=Math.max(n.maxLevel,u),l=u,p=this._hasChild(n,r),p||s.tree.assistants.length?(h=o.y+o.height+n.verticalSpacing,s.tree.assistants.length&&(y=this._setDepthSpaceForAssistants(n,r,h,o.height,u,n.verticalSpacing),l=y.level,h=y.bottom),s.tree.assistants.length||s.tree.orientation=="horizontal"||(h=o.y+o.height+n.verticalSpacing/2),s.tree.children.length&&(c=s.tree.orientation=="horizontal"&&(s.tree.type!="balanced"||s.tree.children.length==1)?this._updateHorizontalTree(n,r,f,o.x,h,l):s.tree.type=="balanced"?this._updateHorizontalTreeWithMultipleRows(n,r,f,o.x,h,l):this._updateVerticalTree(n,r,o.x,h,l,e)),s.y=o.y,t=s.mid,s.tree.assistants.length&&(k=t!==undefined?t:o.x,v=this._setBreadthSpaceForAssistants(n,r,o,k,h,u),p||(a=c=v,t=(a.x+a.right)/2-o.width/2,c=a),b=v?v.canMoveBy:undefined),s.x=t,s.translate||(s._treeWidth=c.right-c.x),w={x:t,y:o.y,right:t+o.width,bottom:o.y+o.height},this._translateSubTree(n,r,w,c,o,u,b,f!=undefined,e),typeof s.firstChild!="string"&&(s.firstChild.x+=s.subTreeTranslation),c):this._updateLeafNode(n,r,f,o,u,e)},_updateLeafNode:function(n,t,i,r,u,f){var e,o;return e=n._graphNodes[t.name],e.x=r.x,e.y=r.y,e.maxLevel=Math.max(u,e.maxLevel||0),o={x:r.x,y:r.y,right:r.x+r.width,bottom:r.y+r.height},e.maxLevel=Math.max(e.maxLevel||0,u),this._translateSubTree(n,t,o,o,r,u,undefined,i!=undefined,f),{x:e.x,y:e.y,right:e.x+r.width,bottom:e.y+r.height}},_translateSubTree:function(n,t,i,r,u,f,e,o,s){var h=n._graphNodes[t.name],c=n.diagram.nameTable[h.firstChild?h.firstChild.child:h.tree.children[0]],l=c?n._graphNodes[c.name]:null,a=this._hasChild(n,t),v=this._findIntersectingLevels(n,i,f,h.actualLevel),p=this._findIntersectingLevels(n,r,f,h.actualLevel),y=[];v.length&&h.translate?(h.intersect=v,this._spaceLeftFromPrevSubTree(n,t,i),h.canMoveBy=h.diff,e!==undefined&&(h.canMoveBy=Math.min(e,h.canMoveBy)),c&&l.canMoveBy!==undefined&&(l.canMoveBy>=h.canMoveBy&&(h.translated=!0),h.canMoveBy=Math.min(h.canMoveBy,l.canMoveBy)),o&&(h.x-=h.canMoveBy,h.subTreeTranslation-=h.canMoveBy,a&&(this._shiftSubordinates(n,p,h.canMoveBy),r.x=Math.min(r.x,h.x),r.right=Math.max(r.right,h.x+u.width),r.bottom=Math.max(r.bottom,h.y+u.height),r.x-=h.canMoveBy,r.right-=h.canMoveBy),c&&l.canMoveBy>h.canMoveBy?h.canMoveBy=l.canMoveBy-h.canMoveBy:c&&h.canMoveBy!==undefined&&(h.canMoveBy=0))):(a&&(r.x=Math.min(r.x,i.x),r.right=Math.max(r.right,i.x+u.width),r.bottom=Math.max(r.bottom,h.y+u.height)),h.translate||(h.canMoveBy=0,h.subTreeTranslation=0));s||(i={x:h.x,y:u.y,right:h.x+u.width,bottom:u.y+u.height},y.push({rBounds:i}),this._updateRearBounds(n,t,y,f))},_updateRearBounds:function(n,t,i,r,u){var f,o,u,s,h,a=!0,c,l,e;if(t&&(c=n._graphNodes[t.name],u=c.intersect,a=!c.tree.children.length&&!c.tree.assistants.length),s=i[0].rBounds,h=i[i.length-1].rBounds,u&&u.length){for(f=n.levels[u[0]].rBounds,l=f.bottom,f.y<s.y&&(f.bottom=s.y,i.splice(0,0,{rBounds:f})),l>h.bottom?i.push({rBounds:{x:f.x,right:f.right,y:s.bottom,bottom:l}}):(f=n.levels[u[u.length-1]].rBounds,a&&f.bottom>h.bottom&&(f.y=h.bottom,i.push({rBounds:f}))),o=u[0],e=i.length-1;e>=0;e--)n.levels.splice(o,0,i[e]);o+=i.length;n.levels.splice(o,u.length)}else for(o=this._findLevel(n,i[i.length-1].rBounds,r),e=i.length-1;e>=0;e--)n.levels.splice(o,0,i[e])},_shiftSubordinates:function(n,t,i){var r;if(i!=0)for(r=0;r<t.length;r++)n.levels[t[r]].rBounds&&(n.levels[t[r]].rBounds.x-=i,n.levels[t[r]].rBounds.right-=i)},_setDepthSpaceForAssistants:function(n,t,i,r,u,f){for(var h=n._graphNodes[t.name],s,c,o,l=i,e=0;e<h.tree.assistants.length;e++)s=n._graphNodes[h.tree.assistants[e]],s&&(s.tree.children=s.tree.assistants=[],s.y=i,o=n.diagram.nameTable[h.tree.assistants[e]],c=o.height?o.height:o._height,(n.orientation=="lefttoright"||n.orientation=="righttoleft")&&(c=o.width?o.width:o._width),l=i+c+f/2,n.maxLevel=u+1,e%2==1&&e!=h.tree.assistants.length-1&&(i=l,u++));return{level:n.maxLevel,bottom:i+c+f}},_setBreadthSpaceForAssistants:function(n,t,i,r,u,f){for(var s,y,h,o,c=n._graphNodes[t.name],b=u,a=f,p,v,l,w,e=0;e<c.tree.assistants.length;e++)s=n._graphNodes[c.tree.assistants[e]],s&&(o=n.diagram.nameTable[c.tree.assistants[e]],y=o.width?o.width:o._width,(n.orientation=="lefttoright"||n.orientation=="righttoleft")&&(y=o.height?o.height:o._height),p=e%2==0?r+i.width/2-20-y:r+i.width/2+20,h=this._updateTree(n,p,s.y,n.diagram.nameTable[c.tree.assistants[e]],a+1),this._hasChild(n,t)||(e==0?l=h:this._uniteRects(l,h)),e%2==0&&s.prevBounds&&(v=v===undefined?s.canMoveBy:Math.min(v,s.canMoveBy)),(e%2==1||e==c.tree.assistants.length-1)&&(w=this._findIntersectingLevels(n,h,a+1),this._updateRearBounds(n,null,[{rBounds:h}],a+1,w),a++));return l&&(l.canMoveBy=v),l},_updateHorizontalTree:function(n,t,i,r,u,f){var s,e,h,g,nt,a,ft,v,y,p,tt,it=this._getDimensions(n,t,r,u,f),o=n._graphNodes[t.name],rt=o.tree.type,w=f,ut=r,et=u,b,k,ot=n.levels.slice(0,n.levels.length),d,c,l;if(this._hasChild(n,t)){for(d=n.orientation=="lefttoright"||n.orientation=="righttoleft"?!0:!1,c=0;c<o.tree.children.length;c++)s=n.diagram.nameTable[o.tree.children[c]],b=s.width?s.width:s._width,k=s.height?s.height:s._height,g=d?k:b,nt=d?b:k,ft=n.levels[w+1]?n.levels[w+1].rBounds:null,h=this._updateTree(n,ut,et,s,w+1,n.diagram.nameTable[o.tree.children[c-1]]),e=n._graphNodes[s.name],o.maxLevel=Math.max(o.maxLevel||0,e.maxLevel||0),y={x:e.x,y:e.y,right:e.x+g,bottom:e.y+nt},c==0&&(v={x:Math.min(e.x,h.x),y:Math.min(e.y,h.y),right:h.right,bottom:h.bottom},a=e),c==0&&(o.firstChild={x:e.x,canMoveBy:e.canMoveBy,child:s.name}),this._hasChild(n,s)&&(!o.firstChild||o.firstChild.x>=e.firstChild.x?(e.firstChild&&o.firstChild.canMoveBy<e.canMoveBy&&(l=o.firstChild.canMoveBy,e.canMoveBy=l,n._graphNodes[o.firstChild.child].canMoveBy=l,o.firstChild.canMoveBy=l),o.firstChild={x:e.firstChild.x,canMoveBy:l!==undefined?l:e.canMoveBy,child:s.name}):e.firstChild&&e.translated&&o.firstChild.canMoveBy>e.canMoveBy&&(o.firstChild.canMoveBy=n._graphNodes[o.firstChild.child].canMoveBy=e.canMoveBy)),p=p?Math.max(e.maxLevel,p):e.maxLevel,this._uniteRects(v,h),ut=c!=0&&!this._hasChild(n,s)&&e.subTreeTranslation<0?h.right-e.subTreeTranslation+n.horizontalSpacing:h.right+n.horizontalSpacing;isNaN(tt)||(a.canMoveBy=tt);o.mid=(a.x+y.right)/2-it.width/2;rt=="left"?o.mid=y.right-it.width:rt=="right"&&(o.mid=r)}return v},_updateHorizontalTreeWithMultipleRows:function(n,t,i,r,u,f,e){var h,l,a,rt,kt,st,ut,ni,ft=this._getDimensions(n,t,r,u,f),b=n._graphNodes[t.name],fi=b.tree.type,g=f,nt=r,ht=u,et,ot,ei=n.levels.slice(0,n.levels.length),e=[],tt=0,bt,lt,p,it,d,ti,dt,gt,at,oi,v,o,vt,yt,pt,wt,s;if(this._hasChild(n,t)){var ct=n.orientation=="lefttoright"||n.orientation=="righttoleft"?!0:!1,w=this._splitChildrenInRows(n,t),k=b.tree.children.length==5&&w[0].length==3,y=[],c=[];if(k)c=w;else for(o=0;o<w.length;o++){if(y[o]=[],c[o]=[],bt=w[o].length,w[o].length%2!=1)for(bt=Math.ceil(w[o].length/2),lt=0;lt<bt;lt++)y[o].push(w[o][lt]);for(s=y[o].length;s<w[o].length;s++)c[o].push(w[o][s])}for(p=[],tt=0,o=0;o<y.length&&y[o].length;o++){for(nt=r,p[o-1]&&(ht=p[o-1].bottom+n.verticalSpacing),s=0;s<y[o].length;s++)h=n.diagram.nameTable[y[o][s]],et=h.width?h.width:h._width,ot=h.height?h.height:h._height,rt=ct?ot:et,kt=ct?et:ot,st=n.levels[g+1]?n.levels[g+1].rBounds:null,l=n._graphNodes[h.name],l.actualLevel=g+1+o,a=this._updateTree(n,nt,ht,h,g+1,n.diagram.nameTable[y[o][s-1]]),s==0?p[o]={x:a.x,y:a.y,right:a.right,bottom:a.bottom}:this._uniteRects(p[o],a),o==0&&s==0?(tt=l.canMoveBy,b.firstChild={x:l.x,child:h.name,canMoveBy:l.canMoveBy}):s==0&&l.canMoveBy!==undefined&&tt>l.canMoveBy&&(tt=Math.min(tt,l.canMoveBy||0),b.firstChild={x:l.x,child:h.name,canMoveBy:l.canMoveBy}),nt=a.right+n.horizontalSpacing;it=o==0?p[o].right:Math.max(it,p[o].right);st=ni}for(o=0;o<y.length&&y[o].length;o++){if(it!=p[o].right)for(d=it-p[o].right,s=0;s<y[o].length;s++)ti=n.diagram.nameTable[y[o][s]],dt=n._graphNodes[y[o][s]],dt.x+=d;o==0?ut={x:p[0].x,y:p[0].y,right:p[0].right,bottom:p[0].bottom}:this._uniteRects(ut,p[o]);st=a}for(gt=(it||0)+(it!==undefined?n.horizontalSpacing/2:0),it!==undefined&&(b.mid=gt-ft.width/2,at=it+n.horizontalSpacing),ht=u,v=[],o=0;o<c.length;o++){for(nt=w[o].length%2==1&&o==c.length-1||k?r:at||r,o!=0&&(ht=v[o-1].bottom+n.verticalSpacing),s=0;s<c[o].length;s++)h=n.diagram.nameTable[c[o][s]],et=h.width?h.width:h._width,ot=h.height?h.height:h._height,rt=ct?ot:et,kt=ct?et:ot,st=n.levels[g+1]?n.levels[g+1].rBounds:null,l=n._graphNodes[h.name],l.actualLevel=g+1+o,s==0&&y[o]&&y[o].length&&(l.translate=!1),k&&o==1&&(s==0&&yt+rt+n.horizontalSpacing<=pt&&(vt=!0,nt=yt-rt/2),vt&&s==1&&(nt=pt-rt/2)),a=this._updateTree(n,nt,ht,h,g+1,n.diagram.nameTable[c[o][s-1]]),k&&s<=2&&o==0&&s==1&&(yt=a.x-n.horizontalSpacing/2,pt=a.x+rt+n.horizontalSpacing/2),s==0?v[o]={x:a.x,y:a.y,right:a.right,bottom:a.bottom}:this._uniteRects(v[o],a),ut||(ut={x:v[o].x,y:v[o].y,right:v[o].right,bottom:v[o].bottom}),this._uniteRects(ut,v[o]),nt=a.right+n.horizontalSpacing,st=a,(!b.firstChild||(o==c.length-1&&w[o].length%2==1||k)&&s==0&&l.canMoveBy!==undefined&&tt>l.canMoveBy)&&(tt=Math.min(tt,l.canMoveBy||0),b.firstChild={x:l.x,child:h.name,canMoveBy:l.canMoveBy});if(k&&o==1&&(wt=v[0].right-v[0].x>=v[1].right-v[1].x?0:1),o==w.length-1&&(w[o].length%2==1||k&&o==1)){var e=c[o][Math.floor(c[o].length/2)],ii=n.diagram.nameTable[e],ri=this._getDimensions(n,ii,n._graphNodes[e].x,n._graphNodes[e].y,g+1);if(d=undefined,!vt&&k?(wt==1&&(o=0),d=(v[wt].x+v[wt].right)/2-(v[o].x+v[o].right)/2,o==0&&(b.mid+=d)):k||at===undefined||(d=at-n.horizontalSpacing/2-(n._graphNodes[e].x+ri.width/2)),d!==undefined)for(s=0;s<c[o].length;s++)if(n._graphNodes[c[o][s]].x+=d,n._graphNodes[c[o][s]].canMoveBy+=d,s==c[o].length-1){var si=this._getDimensions(n,n.diagram.nameTable[c[o][s]],n._graphNodes[c[o][s]].x,n._graphNodes[c[o][s]].y,n._graphNodes[c[o][s]].actualLevel),h=n._graphNodes[c[o][s]],ui=this._findIntersectingLevels(n,{x:h.x,y:h.y,right:h.x+ft.width,bottom:h.y+ft.height},n._graphNodes[c[o][s]].actualLevel);this._updateRearBounds(n,null,[{rBounds:{x:h.x,y:h.y,right:h.x+ft.width,bottom:h.y+ft.height}}],n._graphNodes[c[o][s]].actualLevel,ui)}k&&(b.mid=(pt+yt)/2+(o==0?d:0)-ft.width/2);b.mid==undefined&&n._graphNodes[e]&&(b.mid=n._graphNodes[e].x);vt=!1;o++}}}return ut},_updateVerticalTree:function(n,t,i,r,u,f){var s,o,a,k,nt,tt,v,y,ot,p,ct,e,st,it,rt,ut,d,w,h,ht,b=[],l=[],g,ft,et,c;for(ct=this._getDimensions(n,t,i,r,u),e=n._graphNodes[t.name],st=n.diagram.nameTable[e.tree.children[0]],it=n.orientation=="lefttoright"||n.orientation=="righttoleft"?!0:!1,rt=e.tree.type=="left"||e.tree.type=="leftoffset"?-1:0,ut=i,d=r,w=u,h=0;h<e.tree.children.length;h++)e.tree.type=="alternate"&&(ht=h%2==0&&e.tree.children.length>2?"left":"right",rt=h%2==0&&e.tree.children.length>2?-1:0),ut=i+this._findOffset(n,t,e,ht),s=n.diagram.nameTable[e.tree.children[h]],ft=s.width?s.width:s._width,et=s.height?s.height:s._height,k=it?et:ft,nt=it?ft:et,a=this._updateTree(n,ut+rt*k,d,s,u+1,undefined,!0),o=n._graphNodes[s.name],y={x:o.x,y:o.y,right:o.x+k,bottom:o.y+nt},h==0?(this._uniteRects(a,y),v=a):this._uniteRects(v,a),!o.prevBounds||e.tree.type=="alternate"&&h%2==1&&e.tree.children.length>2||(c=c!==undefined?Math.min(o.canMoveBy,c):o.canMoveBy),e.maxLevel=Math.max(e.maxLevel||0,o.maxLevel||0),e.tree.type=="alternate"&&e.tree.children.length>2&&h%2==0?(h!=0&&(d=tt.bottom+n.verticalSpacing/2),l.push({rBounds:y}),o.levelBounds&&(l=l.concat(o.levelBounds))):(d=e.tree.type=="alternate"&&e.tree.children.length>2?Math.max(a.bottom,tt.bottom)+n.verticalSpacing/2:a.bottom+n.verticalSpacing/2,u=e.maxLevel,b.push({rBounds:y}),p?this._uniteRects(p,y):p={x:o.x,y:o.y,right:o.x+k,bottom:o.y+nt},o.levelBounds&&(b=b.concat(o.levelBounds))),h==0&&(e.firstChild={x:o.x,canMoveBy:o.canMoveBy,child:s.name}),this._hasChild(n,s)&&(!e.firstChild||e.firstChild.x>=o.firstChild.x?(o.firstChild&&e.firstChild.canMoveBy<o.canMoveBy&&(c=e.firstChild.canMoveBy,o.canMoveBy=c,n._graphNodes[e.firstChild.child].canMoveBy=c,e.firstChild.canMoveBy=c),e.firstChild={x:o.firstChild.x,canMoveBy:c!==undefined?c:o.canMoveBy,child:s.name}):o.firstChild&&o.translated&&e.firstChild.canMoveBy>o.canMoveBy&&(e.firstChild.canMoveBy=n._graphNodes[e.firstChild.child].canMoveBy=o.canMoveBy)),tt=y;return f?e.levelBounds=b:(e.tree.type=="alternate"&&e.tree.children.length>2&&(ot={x:l[0].rBounds.x,y:l[0].rBounds.y,right:l[l.length-1].rBounds.right,bottom:l[l.length-1].rBounds.bottom},g=this._findIntersectingLevels(n,ot,w+1),this._updateRearBounds(n,null,l,w+1,g)),g=this._findIntersectingLevels(n,p||v,w+1),this._updateRearBounds(n,null,p?b:[{rBounds:v}],w+1,g)),isNaN(c)||(n._graphNodes[st.name].canMoveBy=c),e.childBounds=v,e.mid=i,v},_splitChildrenInRows:function(t,i){var r=t._graphNodes[i.name],u=4,o=[],f=r.tree.children.length,h=n.extend([],!0,r.tree.children),s,e;for(r.tree.rows?(s=r.tree.children.length,e=Math.ceil(s/r.tree.rows),u=e%2==0?e:e+1):r.tree.children.length==3||r.tree.children.length==4?u=2:r.tree.children.length==5&&(u=3);f>0;)o[o.length]=h.splice(0,u),f-=u,f<u&&(u=f);return o},_findOffset:function(n,t,i,r){var u=0,f=n.orientation=="lefttoright"||n.orientation=="righttoleft"?t.height?t.height:t._height:t.width?t.width:t._width,e=r?r:i.tree.type;u=i.tree.offset||20;i.tree.type=="alternate"&&u>=n.horizontalSpacing&&(u=n.horizontalSpacing/2);switch(e){case"left":u=f/2-u;break;case"right":u=u+f/2}return u},_translateSiblings:function(n,t,i){var r,f,u,e;for(u=n._graphNodes[t.name],e=n._graphNodes[i.name].diff-n._graphNodes[i.name].canMoveBy,r=0;r<u.tree.children.length;r++){if(i.name==u.tree.children[r])break;f=n._graphNodes[u.tree.children[r]];f.x+=e}},_uniteRects:function(n,t){n.x=Math.min(n.x,t.x);n.right=Math.max(n.right,t.right);n.bottom=Math.max(n.bottom,t.bottom)},_spaceLeftFromPrevSubTree:function(n,t,i){for(var r=n._graphNodes[t.name],f,e,o=n.horizontalSpacing,u=0;u<r.intersect.length;u++)e=n.levels[r.intersect[u]].rBounds,f=i.x-(e.right+o),(r.diff==undefined||f<r.diff)&&(r.diff=f,r.prevBounds=n.levels[r.intersect[u]])},_findIntersectingLevels:function(n,t,i,r){var f={x:t.x,y:t.y,right:t.right,bottom:t.bottom},o,u,e;f.y-=n.verticalSpacing/2;f.bottom+=n.verticalSpacing/2;o=[];e=r!==undefined?r:i;u=n.levels[e]?n.levels[e].rBounds:null;do{if(u&&(f.y<u.y&&f.bottom>u.y||f.y<u.bottom&&u.bottom<f.bottom||f.y>=u.y&&f.bottom<=u.bottom||f.y<u.y&&f.bottom>u.bottom))o.splice(0,0,e);else if(u&&u.bottom<f.y)break;e--;u=n.levels[e]?n.levels[e].rBounds:null}while(e>=0);e=(r!==undefined?r:i)+1;u=n.levels[e]?n.levels[e].rBounds:null;do{if(u&&(f.y<u.y&&f.bottom>u.y||f.y<u.bottom&&u.bottom<f.bottom||f.y>=u.y&&f.bottom<=u.bottom||f.y<u.y&&f.bottom>u.bottom))o.push(e);else if(u&&u.y>f.bottom)break;e++;u=n.levels[e]?n.levels[e].rBounds:null}while(e<=n.levels.length);return o},_findLevel:function(n,t){for(var u=t,i=0,r=n.levels[i]?n.levels[i].rBounds:null;i<n.levels.length;){if(r&&u.bottom<r.y)return i;i++;r=n.levels[i]?n.levels[i].rBounds:null}return i},_updateEdges:function(n,i,r){var u=n._graphNodes[i.name],o,h,f,c,e,s;if(i.outEdges&&i.outEdges.length&&i.isExpanded){for(o=[],h=0;h<i.outEdges.length;h++)f=n.diagram.nameTable[n.diagram.nameTable[i.outEdges[h]].targetNode],f.excludeFromLayout||(t.datavisualization.Diagram.Util._collectionContains(f.name,u.tree.children)||(f.inEdges&&f.inEdges.length>1?(o.push(f.name),n._hasMultipleParent=!0):(s=n._graphNodes[f.name],s._updateEdge||(u.tree.children.push(f.name),s._updateEdge=!0))),f.outEdges&&f.outEdges.length&&f.isExpanded&&(u.tree.hasSubTree=!0),this._updateEdges(n,f,r+1));if(o&&o.length>0)for(c in o)e=n.diagram.nameTable[o[c]],s=n._graphNodes[e.name],s._updateEdge||(u.tree.children.push(e.name),s._updateEdge=!0,e.outEdges&&e.outEdges.length&&e.isExpanded&&(u.tree.hasSubTree=!0),this._updateEdges(n,e,r+1))}u.tree.level=r;u.tree.hasSubTree&&(u.tree.orientation="horizontal");n.getLayoutInfo&&n.type=="organizationalchart"&&(n.getLayoutInfo(n.diagram,i,u.tree),u.tree.type=="balanced"&&u.tree.hasSubTree&&(u.tree.type="center",u.tree.orientation="horizontal"));n.level&&u.tree.type!="alternate"&&r>=n.level&&(u.tree.hasSubTree=!1)},_updateAnchor:function(n,i){var o,s,u,c,l,h,r,f,a,v,y,p,e;if(n.diagram.viewPort=s=t.datavisualization.Diagram.ScrollUtil._viewPort(n.diagram,!0),s.x=0,s.y=0,r=n.bounds?n.bounds:s,f=n.diagram._layoutOrientation(),f=="toptobottom"||f=="bottomtotop"){switch(n.horizontalAlignment){case"left":n._anchorX=r.x-i.x+n.margin.left;break;case"right":n._anchorX=r.x+r.width-n.margin.right-i.right;break;case"center":n._anchorX=r.x+r.width/2-(i.x+i.right)/2}switch(n.verticalAlignment){case"top":a=r.y+n.margin.top;n._anchorY=f=="toptobottom"?a:i.bottom+a;break;case"bottom":v=r.y+r.height-n.margin.bottom;n._anchorY=f=="toptobottom"?v-i.bottom:v;break;case"center":e=r.y+r.height/2;n._anchorY=n.orientation=="toptobottom"?e-(i.y+i.bottom)/2:e+(i.y+i.bottom)/2}}else if(f=="lefttoright"||f=="righttoleft"){switch(n.horizontalAlignment){case"left":y=r.x+n.margin.left;n._anchorX=f=="lefttoright"?y:i.bottom+y;break;case"right":p=r.x+r.width-n.margin.right;n._anchorX=f=="lefttoright"?p-i.bottom:p;break;case"center":e=r.width/2+r.x;n._anchorX=n.orientation=="lefttoright"?e-(i.y+i.bottom)/2:e+(i.y+i.bottom)/2}switch(n.verticalAlignment){case"top":n._anchorY=r.y+n.margin.top-i.x;break;case"center":n._anchorY=r.y+r.height/2-(i.right+i.x)/2;break;case"bottom":n._anchorY=r.y+r.height-n.margin.bottom-i.right}}if(n.fixedNode){for(u=n.diagram.nameTable[n.fixedNode],c=u.width?u.width:u._width,l=u.height?u.height:u._height,n._anchorX=u.offsetX,n._anchorY=u.offsetY,n._anchorX+=n.orientation=="righttoleft"?c*u.pivot.x:-c*u.pivot.x,n._anchorY+=n.orientation=="bottomtotop"?l*u.pivot.y:-l*u.pivot.y,o=u,h=0;o.inEdges.length;)o=this._getParentNode(n,o),h+=n._graphNodes[o.name].subTreeTranslation||0;n.orientation=="lefttoright"||n.orientation=="righttoleft"?(n._anchorX-=n._graphNodes[u.name].y,n._anchorY-=n._graphNodes[u.name].x+h):(n._anchorX-=n._graphNodes[u.name].x+h,n._anchorY-=n._graphNodes[u.name].y)}},_updateConnectors:function(n,i,r){var l,h,u,f,c,y,o,v=0,a=0,p=0,w=0,e=0,b=0,s,k,d;if(f=n._graphNodes[i.name],i.outEdges.length)for(l=0;l<i.outEdges.length;l++)if(h=n.diagram.nameTable[i.outEdges[l]],h.visible)if(n.getConnectorSegments)n.getConnectorSegments(n);else{if(f.tree.children.indexOf(h.targetNode)!=-1){u=n.diagram.nameTable[h.targetNode];var g=i.width?i.width:i._width,nt=i.height?i.height:i._height,tt=u.width?u.width:u._width,it=u.height?u.height:u._height;n.type=="organizationalchart"&&(n.orientation=="toptobottom"||n.orientation=="bottomtotop"?(a=n.orientation=="toptobottom"?nt:-nt,w=n.orientation=="toptobottom"?-it:it,c=n.orientation=="toptobottom"?"bottom":"top",f.tree.assistants.length?(e=Math.abs(u.offsetY+w/2-(i.offsetY+a/2))-n.verticalSpacing/2,o=[{type:"orthogonal",length:e,direction:c}]):f.tree.orientation=="horizontal"&&(h.segments.length==1||f.tree.type=="balanced")?f.tree.type=="balanced"?f.tree.children.length==5&&l>2?(s=f.tree.children[1],isNaN(n._graphNodes[s]._treeWidth)&&(n._graphNodes[s]._treeWidth=n.diagram.nameTable[s].width),k=l==3?n.diagram.nameTable[s].offsetX-n._graphNodes[s]._treeWidth/2-n.horizontalSpacing/2:n.diagram.nameTable[s].offsetX+n._graphNodes[s]._treeWidth/2+n.horizontalSpacing/2,o=[{type:"orthogonal",length:n.verticalSpacing/2,direction:"bottom"},{type:"orthogonal",length:i.offsetX-k,direction:"left"},{type:"orthogonal",length:u.offsetY+w/2-(i.offsetY+a/2)-n.verticalSpacing,direction:"bottom"}]):(d=Math.min(30,n.verticalSpacing/2)*(c=="bottom"?1:-1),e=Math.abs(u.offsetY+w*u.pivot.y-d-(i.offsetY+a*(1-u.pivot.y))),o=[{type:"orthogonal",length:e,direction:c}]):n.diagram._dock(h,n.diagram.nameTable):f.tree.orientation=="horizontal"?o=[{type:"orthogonal"}]:(e=Math.abs(u.offsetY-(i.offsetY+a/2)),o=[{type:"orthogonal",length:e,direction:c}],f.tree.offset<5&&(y=f.tree.type=="left"?"right":"left",e=n.verticalSpacing/4,b=Math.abs(f.tree.offset)+n.horizontalSpacing/2,o=[{type:"orthogonal",length:e,direction:c},{type:"orthogonal",length:b,direction:y}]))):(v=n.orientation=="lefttoright"?g:-g,p=n.orientation=="lefttoright"?-tt:tt,c=n.orientation=="lefttoright"?"right":"left",f.tree.assistants.length?(e=Math.abs(u.offsetX+p/2-(i.offsetX+v/2))-n.verticalSpacing/2,o=[{type:"orthogonal",length:e,direction:c}]):f.tree.orientation=="horizontal"&&(h.segments.length==1||f.tree.type=="balanced")?f.tree.type=="balanced"?f.tree.children.length==5&&l>2?(s=f.tree.children[1],isNaN(n._graphNodes[s]._treeWidth)&&(n._graphNodes[s]._treeWidth=n.diagram.nameTable[s].width),k=l==3?n.diagram.nameTable[s].offsetY-n._graphNodes[s]._treeWidth/2-n.verticalSpacing/2:n.diagram.nameTable[s].offsetY+n._graphNodes[s]._treeWidth/2+n.verticalSpacing/2,o=[{type:"orthogonal",length:n.horizontalSpacing/2,direction:"right"},{type:"orthogonal",length:i.offsetY-k,direction:"top"},{type:"orthogonal",length:u.offsetX+p/2-(i.offsetX+v/2)-n.horizontalSpacing,direction:"right"}]):(d=Math.min(30,n.horizontalSpacing/2)*(c=="right"?1:-1),e=Math.abs(u.offsetX+p*u.pivot.x-d-(i.offsetX+v*(1-u.pivot.x))),o=[{type:"orthogonal",length:e,direction:c}]):n.diagram._dock(h,n.diagram.nameTable):f.tree.orientation=="horizontal"?o=[{type:"orthogonal"}]:(e=Math.abs(u.offsetX-(i.offsetX+v/2)),o=[{type:"orthogonal",length:e,direction:c}],f.tree.offset<5&&(y=f.tree.type=="left"?"bottom":"top",e=n.verticalSpacing/4,b=Math.abs(f.tree.offset)+10,o=[{type:"orthogonal",length:e,direction:c},{type:"orthogonal",length:b,direction:y}]))))}o?n.diagram.updateConnector(h.name,{segments:o}):n.diagram._dock(h,n.diagram.nameTable);n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(h,n.diagram);u&&(u.isExpanded||this._hasChild(n,u))&&this._updateConnectors(n,u,r+1)}if(f.tree.assistants.length)for(l=0;l<f.tree.assistants.length;l++)u=n.diagram.nameTable[f.tree.assistants[l]],h=n.diagram.nameTable[u.inEdges[0]],e=Math.abs(u.offsetY-(i.offsetY+a/2)),o=[{type:"orthogonal",length:e,direction:c}],o&&n.diagram.updateConnector(h.name,{segments:o}),n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(h,n.diagram),(u.isExpanded||this._hasChild(n,u))&&this._updateConnectors(n,u,r+1)},_updateNodes:function(n,i,r,u){var s,o,h=i.width?i.width:i._width,c=i.height?i.height:i._height,f=i.offsetX,e=i.offsetY,l;if(i.excludeFromLayout||(f=n._anchorX,e=n._anchorY,n.orientation=="lefttoright"?(f+=n._graphNodes[i.name].y+h/2,e+=n._graphNodes[i.name].x+r+c/2):n.orientation=="righttoleft"?(f-=n._graphNodes[i.name].y+h/2,e+=n._graphNodes[i.name].x+r+c/2):n.orientation=="toptobottom"?(f+=n._graphNodes[i.name].x+r+h/2,e+=n._graphNodes[i.name].y+c/2):(f+=n._graphNodes[i.name].x+r+h/2,e-=n._graphNodes[i.name].y+c/2),n.updateView?n.diagram._translate(i,f-(i.offsetX||0),e-(i.offsetY||0),n.diagram.nameTable):(u=i.name==n.fixedNode||u,!u&&this._withinView(f,e,h,c,i,n)?(f!=i.offsetX||e!=i.offsetY)&&n.objects.push({object:i.name,diff:f-i.offsetX,diffy:e-i.offsetY}):n.diagram._translate(i,f-(i.offsetX||0),e-(i.offsetY||0),n.diagram.nameTable))),l=[],this._hasChild(n,i))for(o=0;o<n._graphNodes[i.name].tree.children.length;o++)s=n.diagram.nameTable[n._graphNodes[i.name].tree.children[o]],this._updateNodes(n,s,r+(n._graphNodes[i.name].subTreeTranslation||0),u),l.push(s);if(n._graphNodes[i.name].tree.assistants.length)for(o=0;o<n._graphNodes[i.name].tree.assistants.length;o++)s=n.diagram.nameTable[n._graphNodes[i.name].tree.assistants[o]],this._updateNodes(n,s,r+(n._graphNodes[i.name].subTreeTranslation||0));n.diagram._updateQuad(n.diagram.nameTable[i.name]);n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(i,n.diagram)},_withinView:function(n,t,i,r,u,f){var e=f.diagram.model.scrollSettings.horizontalOffset/f.diagram.model.scrollSettings.currentZoom,o=f.diagram.model.scrollSettings.verticalOffset/f.diagram.model.scrollSettings.currentZoom,s=f.diagram.model.scrollSettings.viewPortWidth+e,h=f.diagram.model.scrollSettings.viewPortHeight+o;return(n+i/2>e||u.offsetX+i/2>e)&&(n-i/2<s||u.offsetX-i/2<s)&&(t+r/2>o||u.offsetY+r/2>o)&&(t-r/2<h||u.offsetY-r/2<h)?!0:!1},_getDimensions:function(n,t,i,r,u){var f=t.width?t.width:t._width,e=t.height?t.height:t._height,o;return(n.orientation=="lefttoright"||n.orientation=="righttoleft")&&(u||(o=i,i=r,r=o),e=t.width?t.width:t._width,f=t.height?t.height:t._height),{x:i,y:r,width:f,height:e}},_getParentNode:function(n,t){if(t.inEdges&&t.inEdges.length)return n.diagram.nameTable[n.diagram.nameTable[t.inEdges[0]].sourceNode]},_hasChild:function(n,t){var t=n._graphNodes[t.name];return t.tree.children&&t.tree.children.length},_setUpLayoutInfo:function(n){var t={};return t.subTreeTranslation=0,n.type=="organizationalchart"?t.tree={orientation:"vertical",type:"alternate",offset:20,enableRouting:!0}:n.type=="hierarchicaltree"&&(t.tree={orientation:"horizontal",type:"center",enableRouting:!0}),t.tree.children=[],t.tree.assistants=[],t.tree.level=0,t.translate=!0,t}};t.datavisualization.Diagram.RadialTreeLayout={doLayout:function(n){var r,i,t;for(r=n.diagram,i=r.nodes(),t=0;t<i.length;t++)i[t].excludeFromLayout||(n._graphNodes[i[t].name]=this._setUpLayoutInfo(n,i[t]),i[t].inEdges&&i[t].inEdges.length||n._firstLevelNodes.push(i[t]));n.rootNode&&r.nameTable[n.rootNode]?n._centerNode=r.nameTable[n.rootNode]:n._firstLevelNodes.length&&(n._centerNode=n._firstLevelNodes[0],r.model.layout.rootNode=n._centerNode.name);n._centerNode&&(this._updateEdges(n,n._centerNode,0),this._depthFirstAllignment(n,n._centerNode,0,0),this._populateLevels(n),this._transformToCircleLayout(n),this._updateAnchor(n),this._updateNodes(n,n._centerNode))},_updateEdges:function(n,t,i){var u=n._graphNodes[t.name],f,r;for(n.layoutNodes.push(u),u.level=i,u.visited=!0,n.maxLevel=Math.max(n.maxLevel,i),f=0;f<t.outEdges.length;f++)r=n.diagram.nameTable[n.diagram.nameTable[t.outEdges[f]].targetNode],r.excludeFromLayout||r.visited||(u.children.push(r),this._updateEdges(n,r,i+1))},_depthFirstAllignment:function(n,t,i,r){var s,u,o,f,e;if(t){if(u=n._graphNodes[t.name],u.children.length){for(r+=300,e=0;e<u.children.length;e++)s=this._depthFirstAllignment(n,u.children[e],i,r),i=s.x,r=s.y;if(u.children=u.children.sort(function(t,i){return n._graphNodes[t.name].x-n._graphNodes[i.name].x}),o=n._graphNodes[u.children[0].name].min,f=n._graphNodes[u.children[u.children.length-1].name].max,u.x=o+(f-o)/2,i=f+n.horizontalSpacing,u.segmentOffset=f+n.horizontalSpacing,u.x-=u.width/2,u.y-=u.height/2,u.min=o,u.max=f,u.x<o&&u.visited){for(u.x=o,i=u.x+u.width/2-(f-o)/2,u.visited=!1,e=0;e<u.children.length;e++)s=this._depthFirstAllignment(n,u.children[e],i,r);u.visited=!0;i=u.x+u.width+n.horizontalSpacing}f=n._graphNodes[u.children[u.children.length-1].name].segmentOffset;i=i<f?f:i;r-=300;u.y=r}else u.x=i,u.y=r,u.min=i,u.max=i+u.width,i+=u.width+n.horizontalSpacing;return{x:i,y:r}}},_populateLevels:function(n){var i=[],e=Math.min.apply(Math,n.layoutNodes.map(function(n){return n.x})),o=Math.max.apply(Math,n.layoutNodes.map(function(t){return t.x+t.width+n.horizontalSpacing})),s=o-e,r,t,u,f;for(n.levels=[],r=0;r<=n.maxLevel;r++){for(i=n.layoutNodes.filter(function(n){if(n.level==r)return n}),t={},i=i.sort(function(n,t){return n.x-t.x}),t.min=i[0].x,t.max=i[i.length-1].x+i[i.length-1].width+n.horizontalSpacing,t._actualCircumference=0,t.height=0,u=0;u<i.length;u++)i[u].height>t.height&&(t.height=i[u].height),t._actualCircumference+=Math.max(i[u].width,i[u].height),u!=i.length-1&&(t._actualCircumference+=n.horizontalSpacing);for(t.circumference=t.max-t.min,t._actualCircumference<t.circumference&&(t.circumference=(t.circumference+t._actualCircumference)/2),t.radius=t.circumference/(2*Math.PI)+t.height,t.nodes=[],r>1&&n.levels[r-1].radius+n.levels[r-1].height>=t.radius&&(t.radius=n.levels[r-1].radius+n.levels[r-1].height),f=0;f<i.length;f++)i[f].ratio=Math.abs(i[f].x+i[f].width/2-e)/s,t.nodes.push(i[f]);n.levels.push(t)}},_transformToCircleLayout:function(n){var u=n._graphNodes[n._centerNode.name],t,r,i;for(u.x=0,u.y=0,t=1;t<n.levels.length;t++)for(r=0;r<n.levels[t].nodes.length;r++)i=n.levels[t].nodes[r],i.x=Math.cos(i.ratio*360*Math.PI/180)*(n.levels[t].radius+n.verticalSpacing*t),i.y=Math.sin(i.ratio*360*Math.PI/180)*(n.levels[t].radius+n.verticalSpacing*t),n._anchorX=Math.min(n._anchorX,i.x),n._anchorY=Math.min(n._anchorY,i.y)},_updateAnchor:function(n){var i=t.datavisualization.Diagram.ScrollUtil._viewPort(n.diagram);n._anchorX=i.width/2;n._anchorY=i.height/2},_updateNodes:function(n,i){var r=n._graphNodes[i.name],e=r.x+n._anchorX,o=r.y+n._anchorY,u,f;for(n.diagram._translate(i,e-i.offsetX||0,o-i.offsetY||0,n.diagram.nameTable),u=0;u<r.children.length;u++)f=r.children[u],this._updateNodes(n,n.diagram.nameTable[f.name]);n.diagram._svg&&t.datavisualization.Diagram.DiagramContext.update(i,n.diagram)},_isValidLayout:function(n){if(n._centerNode){var t=Math.max.apply(Math,n.diagram.nodes().map(function(n){return n.inEdges.length}));if(t<2)return!0}return!1},_setUpLayoutInfo:function(n,t){var i={};return i.name=t.name,i.x=0,i.y=0,i.min=0,i.max=0,i.width=t.width?t.width:t._width,i.height=t.height?t.height:t._height,i.children=[],i.level=0,i.ratio=0,i.visited=!1,i}}}(jQuery,Syncfusion),function(n,t){"use strict";t.datavisualization.Diagram.ZoomUtil={zoomPan:function(i,r,u,f,e,o){var h,c,l,v,y;if(o&&t.datavisualization.Diagram.Util.canZooming(i)||!o&&t.datavisualization.Diagram.Util.canPanning(i)){var a=t.datavisualization.Diagram.ScrollUtil._viewPort(i,!0),p={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:a},s=t.Matrix.identity();t.Matrix.scale(s,i._currZoom,i._currZoom);t.Matrix.translate(s,-i._hScrollOffset,-i._vScrollOffset);h=i._currZoom*r;h>30?r=30/i._currZoom:h<.25&&(r=.25/i._currZoom);c=t.Matrix.identity();l=e?t.Matrix.transform(s,e):t.datavisualization.Diagram.Point(n(i.element).width()/2,n(i.element).height()/2);t.Matrix.scale(c,r,r,l.x,l.y);h=i._currZoom*r;t.Matrix.translate(c,u,f);t.Matrix.multiply(s,c);v=t.Matrix.transform(s,t.datavisualization.Diagram.Point(0,0));i._compareModelProperty("scrollSettings",!0);this._applyTransform(i,h,v,o);y={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:a};i._eventCause.scrollChange=t.datavisualization.Diagram.ScrollChangeCause.Zoom;i._raiseEvent("scrollChange",{newValues:y,oldValues:p})}},_applyTransform:function(n,i,r,u){n._currZoom=i;var f=r.x*-1,e=r.y*-1,o=n._getDigramBounds();if(!u&&n._scrollLimit()!==t.datavisualization.Diagram.ScrollLimit.Infinity)if(n._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Diagram){o.x-=n.model.scrollSettings.padding.left;o.y-=n.model.scrollSettings.padding.top;o.width+=n.model.scrollSettings.padding.left+n.model.scrollSettings.padding.right;o.height+=n.model.scrollSettings.padding.top+n.model.scrollSettings.padding.bottom;var s=o.width*n._currZoom>n._viewPort.width,h=o.height*n._currZoom>n._viewPort.height,c=(o.width+o.x)*n._currZoom-n._viewPort.width,l=(o.height+o.y)*n._currZoom-n._viewPort.height;!s&&f>n._hScrollOffset&&f>o.x*n._currZoom||s&&f<n._hScrollOffset&&f<o.x*n._currZoom?f=n._hScrollOffset:(!s&&f<n._hScrollOffset&&f<c||s&&f>n._hScrollOffset&&f>c)&&(f=n._hScrollOffset);!h&&e>n._vScrollOffset&&e>o.y*n._currZoom||h&&e<n._vScrollOffset&&e<o.y*n._currZoom?e=n._vScrollOffset:(!h&&e<n._vScrollOffset&&e<l||h&&e>n._vScrollOffset&&e>l)&&(e=n._vScrollOffset)}else f<n._hScrollbar.model.minimum&&!(n._hScrollbar.model.minimum==0&&-n._hScrollOffset>r.x)?f=n._hScrollOffset:f>n._hScrollbar.model.maximum&&(f=n._hScrollbar.model.maximum),e<n._vScrollbar.model.minimum&&!(n._vScrollbar.model.minimum==0&&-n._vScrollOffset>r.y)?e=n._vScrollOffset:e>n._vScrollbar.model.maximum&&(e=n._vScrollbar.model.maximum);n._updateScrollOffset(f,e,!0,u)}};t.datavisualization.Diagram.PageUtil={_createPageBreaks:function(n){this._removePageBreaks(n);var i={id:n._canvas.id+"pagebreaks","pointer-events":"none"},r=t.datavisualization.Diagram.SvgContext._initializePageBreaks(n._svg,i,n._pageBackgroundLayer);this._updatePageBreaks(r,n)},_removePageBreaks:function(n){var i=n._svg.getElementById(n._canvas.id+"pagebreaks");i&&t.datavisualization.Diagram.SvgContext._removePageBreaks(n._svg,i,n._pageBackgroundLayer)},_updatePageBreaks:function(n,i){var o=i._getDigramBounds(),k=i.model.pageSettings,r=o.x,w=o.width+o.x,u=o.y,b=o.height+o.y,f=i._currZoom,a=i._pageHeight(),v=i._pageWidth(),e=i._pageMargin(),y=parseInt(Math.ceil((w-r)/v)),p=parseInt(Math.ceil((b-u)/a)),s,h,c,l;for(r=-i._canvas.clientLeft+(e+r)*f,u=-i._canvas.clientTop+(e+u)*f,s=(v*y-e*2)*f,h=(a*p-e*2)*f,t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r,u),t.datavisualization.Diagram.Point(r+s,u),i._svg,n),t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u),t.datavisualization.Diagram.Point(r,u+h),i._svg,n),c=1;c<y;c++)t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r+(v*c-e)*f,u),t.datavisualization.Diagram.Point(r+(v*c-e)*f,u+h),i._svg,n);for(l=1;l<p;l++)t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u+(a*l-e)*f),t.datavisualization.Diagram.Point(r+s,u+(a*l-e)*f),i._svg,n);t.datavisualization.Diagram.SvgContext._renderVPageBreakLine(t.datavisualization.Diagram.Point(r+s,u),t.datavisualization.Diagram.Point(r+s,u+h),i._svg,n);t.datavisualization.Diagram.SvgContext._renderHPageBreakLine(t.datavisualization.Diagram.Point(r,u+h),t.datavisualization.Diagram.Point(r+s,u+h),i._svg,n)},_updatePageSize:function(n,i){var f=!1,e,l;n._pageOrientation()==t.datavisualization.Diagram.PageOrientations.Landscape?n._pageHeight()>n._pageWidth()&&(f=!0):n._pageWidth()>n._pageHeight()&&(f=!0);f&&(e=n._pageWidth(),n._pageWidth(n._pageHeight()),n._pageHeight(e));var r=n._getDigramBounds(),u=n._currZoom,o=r.x*u,s=r.y*u,h=r.width*u,c=r.height*u,a=n.model.pageSettings;n._pageBackgroundLayer&&n._pageBackgroundLayer.firstChild?t.datavisualization.Diagram.SvgContext._updatePageBakground(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),n._svg,n._pageBackgroundLayer,n._pageBorderColor(),n._pageBackgroundColor(),n._pageBorderWidth()):t.datavisualization.Diagram.SvgContext._renderPageSettingsRect(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),n._svg,n._pageBackgroundLayer,n._pageBorderColor(),n._pageBackgroundColor(),n._pageBorderWidth());n.model.backgroundImage&&n.model.backgroundImage.source&&t.datavisualization.Diagram.SvgContext._updateBackground(n._hScrollOffset,n._vScrollOffset,n._currZoom,n);n._svg.document.style.left=0;n._svg.document.style.top=0;l=!1;n._pageWidth()||n._pageHeight()||(l=!0);a.pageWidth&&n._pageHeight()&&(n._showPageBreak()?this._createPageBreaks(n):this._removePageBreaks(n));i||t.datavisualization.Diagram.ScrollUtil._setScrollContentSize(n)}};t.datavisualization.Diagram.ScrollUtil={_transform:function(n,i,r,u){t.datavisualization.Diagram.SvgContext.transformView(n,-i,-r);u&&t.datavisualization.Diagram.SvgContext.scaleContent(n,n._currZoom);t.datavisualization.Diagram.PageUtil._updatePageSize(n);t.datavisualization.Diagram.SvgContext._updateGrid(i,r,n._currZoom,n)},_viewPort:function(n,i){var o;if(n._viewPort&&!i)return n._viewPort;var h=n.element[0],r=n.element[0].getBoundingClientRect(),u=r.width,f=n._vScrollbar&&n._vScrollbar.model.height?n._vScrollbar.model.height:null,e=f?r.height===f?f+18:r.height:r.height,s=window.screenX<0?window.screenX*-1:window.screenX;return u===0&&(u=Math.floor(window.innerWidth-s-Math.floor(r.left))),o=window.screenY<0?window.screenY*-1:window.screenY,e===0&&(e=Math.floor(window.innerHeight-o-Math.floor(r.window))),t.datavisualization.Diagram.Size(u,e)},_union:function(n,t){var i,r,u,f;return n.width<=0?t:n.width>0?(i=Math.min(n.x,t.x),r=Math.min(n.y,t.y),t.width===Infinity||n.width===Infinity?n.width=Infinity:(u=Math.max(n.x+n.width,t.x+t.width),n.width=Math.max(u-i,0)),t.height===Infinity||n.height===Infinity?n.height=Infinity:(f=Math.max(n.y+n.height,t.y+t.height),n.height=Math.max(f-r,0)),n.x=i,n.y=r,n):void 0},_setScrollContentSize:function(i){var l=i._currZoom,u=this._viewPort(i),a,v,r,p,b,y,w,k,c,d;u=t.datavisualization.Diagram.Rectangle(i._hScrollOffset,i._vScrollOffset,u.width,u.height);var h=i.model.scrollSettings.padding,f=i._spatialSearch.pageLeft,o=i._spatialSearch.pageRight,e=i._spatialSearch.pageTop,s=i._spatialSearch.pageBottom;f>o&&(f=o=0);e>s&&(e=s=0);i.model.pageSettings&&(a=Number(i._pageWidth()),v=Number(i._pageHeight()),a>0&&v>0?(i._multiplePage()?(f=Math.floor(f/a)*a,e=Math.floor(e/v)*v,o=Math.ceil(o/a)*a,s=Math.ceil(s/v)*v):(f=0,e=0,o=a,s=v),f-=h.left,o+=h.right,e-=h.top,s+=h.bottom):(f=f<0?f:0,e=e<0?e:0,o=o>u.width?o:u.width,s=s>u.height?s:u.height,i._spatialSearch.pageLeft-f<h.left&&(f+=i._spatialSearch.pageLeft-f-h.left),i._spatialSearch.pageTop-e<h.top&&(e+=i._spatialSearch.pageTop-e-h.top),i._spatialSearch.pageRight+h.right>u.width&&i._spatialSearch.pageRight<u.width?o+=h.right+i._spatialSearch.pageRight-u.width:i._spatialSearch.pageRight>u.width&&(o+=h.right),i._spatialSearch.pageBottom+h.bottom>u.height&&i._spatialSearch.pageBottom<u.height?s+=h.bottom+i._spatialSearch.pageBottom-u.height:i._spatialSearch.pageBottom>u.height&&(s+=h.bottom)));f=f*l;e=e*l;o=o*l;s=s*l;r=t.datavisualization.Diagram.Rectangle(0,0,0,0);r=this._union(r,t.datavisualization.Diagram.Rectangle(0,0,u.width,u.height));r=this._union(r,t.datavisualization.Diagram.Geometry.rect([{x:f,y:e},{x:o,y:s}]));r.width-=u.width;r.height-=u.height;r.x>i._hScrollOffset&&(y=r.x-i._hScrollOffset,r.x-=y,r.width+=y);i._hScrollOffset>r.x+r.width&&(r.width=i._hScrollOffset-r.x);p=r.x;b=Math.max(0,r.x+r.width);r.y>i._vScrollOffset&&(y=r.y-i._vScrollOffset,r.y-=y,r.height+=y);i._vScrollOffset>r.y+r.height&&(r.height=i._vScrollOffset-r.y);w=r.y;k=Math.max(0,r.y+r.height);r.width=r.width<u.width?u.width:r.width;r.height=r.height<u.height?u.height:r.height;i._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Limited&&(c=i.model.pageSettings.scrollableArea,p=c.x*l,w=c.y*l,b=(c.x+c.width)*l-u.width,k=(c.y+c.height)*l-u.height,s=(c.y+c.height)*l,o=(c.x+c.width)*l,e=c.y*l,f=c.x*l);f>=i._hScrollOffset&&o<=u.width+i._hScrollOffset?(i._hScrollbar._remove(),i._hScrollbar.model.width=0,i._hScrollbar.model.minimum=i._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Limited?Math.min(0,p):0,i._hScrollbar.model.maximum=0):(i._preventScrollerUpdate?(i._hScrollbar.model.minimum=p,i._hScrollbar.model.maximum=b):(n("#"+i._canvas.id+"_hScrollbar").ejScrollBar({width:u.width-18,viewportSize:u.width-18,maximum:b,minimum:p}),n("#"+i._canvas.id+"_hScrollbar").ejScrollBar("scroll",i._hScrollOffset)),d=document.getElementById(i._canvas.id+"_hScrollbar"),d.style.marginTop=u.height-18+"px");e>=i._vScrollOffset&&s<=u.height+i._vScrollOffset?(i._vScrollbar._remove(),i._vScrollbar.model.height=0,i._vScrollbar.model.minimum=i._scrollLimit()===t.datavisualization.Diagram.ScrollLimit.Limited?Math.min(0,w):0,i._vScrollbar.model.maximum=0):i._preventScrollerUpdate?(i._vScrollbar.model.minimum=w,i._vScrollbar.model.maximum=k):(n("#"+i._canvas.id+"_vScrollbar").ejScrollBar({height:u.height-18,viewportSize:u.height-18,maximum:k,minimum:w}),n("#"+i._canvas.id+"_vScrollbar").ejScrollBar("scroll",i._vScrollOffset));i._isMobile&&i._disableScrollbar();t.datavisualization.Diagram.SvgContext.setSize(i,r.width,r.height)},_setMinMaxValues:function(n,t,i,r,u,f,e){var o=n.model.pageSettings.scrollableArea;return t=Math.max(t,o.x*e),i=Math.max(i,o.y*e),r=Math.min((o.x+o.width)*e-f.width,r),u=Math.min((o.y+o.height)*e-f.height,u),r=r>0?r:0,u=u>0?u:0,{minX:t,minY:i,maxX:r,maxY:u}},_initScrollbar:function(i){var u=i._canvas,f=document.getElementById(u.id+"_hScrollbar"),e=document.getElementById(u.id+"_vScrollbar"),r=this._viewPort(i);n(f).ejScrollBar({orientation:t.ScrollBar.Orientation.Horizontal,width:r.width-18,viewportSize:r.width-18,scroll:function(n){var r,u;n.source!=null&&(n.source=="thumb"||n.source=="button"||n.source=="key")&&n.scrollData!=null&&(r={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._updateScrollOffset(n.scrollLeft,i._vScrollOffset),u={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._compareModelProperty("scrollSettings",!0),i._eventCause.scrollChange=t.datavisualization.Diagram.ScrollChangeCause.Pan,i._raiseEvent("scrollChange",{newValues:u,oldValues:r}))}});i._hScrollbar=n(f).ejScrollBar("instance");n(e).ejScrollBar({orientation:t.ScrollBar.Orientation.Vertical,height:r.height-18,viewportSize:r.height-18,scroll:function(n){var r,u;n.source!=null&&(n.source=="thumb"||n.source=="button"||n.source=="key")&&n.scrollData!=null&&(r={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._updateScrollOffset(i._hScrollOffset,n.scrollTop),u={zoom:i._getCurrentZoom(),horizontalOffset:i._hScrollOffset,verticalOffset:i._vScrollOffset,viewPort:i._viewPort},i._compareModelProperty("scrollSettings",!0),i._eventCause.scrollChange=t.datavisualization.Diagram.ScrollChangeCause.Pan,i._raiseEvent("scrollChange",{newValues:u,oldValues:r}))}});i._vScrollbar=n(e).ejScrollBar("instance")}};t.datavisualization.Diagram.SnapUtil={_canConsider:function(n,t,i){var r=!1;return t!=i&&(t._type=="group"||t._type=="pseudoGroup"?r=i.isSwimlane&&!t.isSwimlane?!1:!this._contains(n,t,i):i._type=="group"&&i.type!="bpmn"||i.type=="pseudoGroup"?r=i.isSwimlane&&!t.isSwimlane?!1:!this._contains(n,i,t):t.segments||(r=!(t==i))),r},_contains:function(n,t,i){var e=i.name,o=null,f,u,r;if(t.children.indexOf(e)>=0){if(o=n[e],o==i)return!0}else if(t.children.indexOf(i)>=0)return!0;if(t._type=="group"||t._type=="pseudoGroup"){for(f=!1,u=0;u<t.children.length;u++)if(this.diagram&&(r=typeof t.children[u]=="string"?n[t.children[u]]:n[t.children[u].name],r&&(typeof r=="string"&&(r=n[r]),r._type=="group"&&(f=this._contains(n,r,i)),f)))return f;return f}return!1},_round:function(n,t,i){var f,r;for(i=i>1?Math.pow(2,Math.floor(Math.log(i)/Math.log(2))):Math.pow(2,Math.ceil(Math.log(i)/Math.log(2))),f=0,r=0;r<t.length;r++)f+=t[r];f/=i;var o=Math.floor(Math.abs(n)/f),e=n%f,u=o*f;if(u!=n)if(n>=0)for(r=0;r<t.length;r++){if(e<=t[r]/i)return u+(e<t[r]/(2*i)?0:t[r]/i);u+=t[r]/i;e-=t[r]/i}else for(u=u*-1,r=t.length-1;r>=0;r--){if(Math.abs(e)<=t[r]/i)return u-(Math.abs(e)<t[r]/(2*i)?0:t[r]/i);u-=t[r]/i;e+=t[r]/i}return n},_findNodes:function(n,i,r,u,f){for(var c=[],o,e,l,h,a=t.datavisualization.Diagram.SpatialUtil.findQuads(n,f?u:r),s=0;s<a.length;s++)if(o=a[s],o.objects.length>0)for(h=0;h<o.objects.length;h++)e=o.objects[h],!e.segments&&e.visible&&(l=t.datavisualization.Diagram.Util.bounds(e),c.indexOf(e)==-1&&t.datavisualization.Diagram.Geometry.intersectsRect(r,l)&&c.push(e),f&&f.indexOf(e)&&t.datavisualization.Diagram.Geometry.intersectsRect(u,l)&&f.push(e));return c},_snapAngle:function(n,t){var i=n._snapAngle(),r=t%i;return r>=i/2?t+i-r:t-r},_snapPoint:function(n,i,r,u,f,e,o){var c=n.model.snapSettings,l=n._currZoom,h=t.datavisualization.Diagram.Point(),s=t.datavisualization.Diagram.Util.bounds(i),k={snapped:!1,offset:0},d={snapped:!1,offset:0};this.diagram=n;n._enableSnapToObject()&&this._snapObject(n,i,k,d,f,o==e);var g=s.x+f.x,nt=s.y+f.y,tt=s.x+s.width+f.x,it=s.y+s.height+f.y,a=this._round(tt,c.verticalGridLines.snapInterval,l),v=this._round(g,c.verticalGridLines.snapInterval,l),y=this._round(nt,c.horizontalGridLines.snapInterval,l),p=this._round(it,c.horizontalGridLines.snapInterval,l),w=s.x+s.width,b=s.y+s.height;return k.snapped?h.x=n._enableSnapToObject()?k.offset:e.x-o.x:n._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToVerticalLines?Math.abs(f.x)>=1&&(h.x+=r?Math.abs(a-w)>Math.abs(v-s.x)?v-s.x:a-w:Math.abs(a-w)<Math.abs(v-s.x)?a-w:v-s.x):h.x=e.x-o.x,d.snapped?h.y=d.offset:n._snapConstraints()&t.datavisualization.Diagram.SnapConstraints.SnapToHorizontalLines?Math.abs(f.y)>=1&&(h.y+=u?Math.abs(p-b)>Math.abs(y-s.y)?y-s.y:p-b:Math.abs(p-b)<Math.abs(y-s.y)?p-b:y-s.y):h.y=e.y-o.y,h},_snapObject:function(n,i,r,u,f,e){var v=null,y=null,w,b,d=[],g=[],it=[],rt=[],o=t.datavisualization.Diagram.Util.bounds(i),l=n._currZoom,ut=n._hScrollOffset,ft=n._vScrollOffset,h=n._snapObjectDistance(),p=n._viewPort,et=t.datavisualization.Diagram.Rectangle(ut/l,o.y-h-5,p.width/l,o.height+2*h+10),ot=t.datavisualization.Diagram.Rectangle(o.x-h-5,ft/l,o.width+2*h+10,p.height/l),k,a,c,s,nt,tt;for(p=t.datavisualization.Diagram.Rectangle(ut/l,ft/l,p.width/l,p.height/l),k=this._findNodes(n._spatialSearch,i,ot,p),nt=n.nameTable,a=0;a<k.length;a++)c=k[a],t.datavisualization.Diagram.Util._canBeTarget(n,c)&&!c.segments&&this._canConsider(nt,i,c)&&(s=t.datavisualization.Diagram.Util.bounds(c),s.y+s.height<o.y+f.y?it.push({object:c,distance:Math.abs(o.y+f.y-s.y-s.height)}):s.y>o.y+f.y+o.height&&rt.push({object:c,distance:Math.abs(o.y+f.y+o.height-s.y)}),(v==null||v>Math.abs(s.y-o.y-f.y))&&(Math.abs(s.x+s.width/2-(o.x+o.width/2+f.x))<=h?(w=this._createSnapObject(s,o,"centerX"),v=Math.abs(s.y-o.y)):Math.abs(s.x-(o.x+f.x))<=h?(w=this._createSnapObject(s,o,"left"),v=Math.abs(s.y-o.y)):Math.abs(s.x+s.width-(o.x+o.width+f.x))<=h?(w=this._createSnapObject(s,o,"right"),v=Math.abs(s.y-o.y)):Math.abs(s.x+s.width-(o.x+f.x))<=h?(w=this._createSnapObject(s,o,"leftRight"),v=Math.abs(s.y-o.y)):Math.abs(s.x-(o.x+o.width+f.x))<=h&&(w=this._createSnapObject(s,o,"rightLeft"),v=Math.abs(s.y-o.y))));for(k=this._findNodes(n._spatialSearch,i,et,p),a=0;a<k.length;a++)c=k[a],t.datavisualization.Diagram.Util._canBeTarget(n,c)&&!c.segments&&this._canConsider(nt,i,c)&&(s=t.datavisualization.Diagram.Util.bounds(c),s.x+s.width<o.x+f.x&&(d[d.length]={object:c,distance:Math.abs(o.x+f.x-s.x-s.width)}),s.x>o.x+f.x+o.width&&(g[g.length]={object:c,distance:Math.abs(o.x+f.x+o.width-s.x)}),(y==null||y>Math.abs(s.x-o.x-f.x))&&(Math.abs(s.y+s.height/2-(o.y+o.height/2+f.y))<=h?(b=this._createSnapObject(s,o,"centerY"),y=Math.abs(s.x-o.x)):Math.abs(s.y-o.y-f.y)<=h?(b=this._createSnapObject(s,o,"top"),y=Math.abs(s.x-o.x)):Math.abs(s.y+s.height-(o.y+o.height+f.y))<=h?(b=this._createSnapObject(s,o,"bottom"),y=Math.abs(s.x-o.x)):Math.abs(s.y+s.height-o.y-f.y)<=h?(b=this._createSnapObject(s,o,"topBottom"),y=Math.abs(s.x-o.x)):Math.abs(s.y-(o.y+o.height+f.y))<=h&&(b=this._createSnapObject(s,o,"bottomTop"),y=Math.abs(s.x-o.x))));tt=this._createGuidelines(n,w,b,r,u,e);r.snapped||this._createHSpacingLines(n,i,d,g,r,u,e,tt,f,h);u.snapped||this._createVSpacingLines(n,i,it,rt,r,u,e,tt,f,h)},_snapSize:function(n,i,r,u,f,e,o){var p=null,w=null,d,g,s=t.datavisualization.Diagram.Util.bounds(e),ut=n.nameTable,nt=[],tt=[],l=n._currZoom,st=n._hScrollOffset,ht=n._vScrollOffset,v=n._snapObjectDistance(),y=n._viewPort,lt=t.datavisualization.Diagram.Rectangle(st/l,(s.y-5)/l,y.width/l,(s.height+10)/l),at=t.datavisualization.Diagram.Rectangle((s.x-5)/l,ht/l,(s.width+10)/l,y.height/l),it,b,a,c,h,et,ot;for(y=t.datavisualization.Diagram.Rectangle(st/l,ht/l,y.width/l,y.height/l),it=[],b=this._findNodes(n._spatialSearch,e,at,y,it),a=0;a<b.length;a++)c=b[a],this._canConsider(ut,e,c)&&!c.segments&&(h=t.datavisualization.Diagram.Util.bounds(c),(p==null||p>Math.abs(h.y-s.y))&&(i.left?Math.abs(s.x+u-h.x)<=v?(d=this._createSnapObject(h,s,"left"),p=Math.abs(h.y-s.y)):Math.abs(s.x+u-h.x-h.width)<=v&&(d=this._createSnapObject(h,s,"leftRight"),p=Math.abs(h.y-s.y)):i.right&&(Math.abs(s.x+u+s.width-h.x-h.width)<=v?(d=this._createSnapObject(h,s,"right"),p=Math.abs(h.y-s.y)):Math.abs(s.x+u+s.width-h.x)<=v&&(d=this._createSnapObject(h,s,"rightLeft"),p=Math.abs(h.y-s.y)))));for(b=this._findNodes(n._spatialSearch,e,lt,y),a=0;a<b.length;a++)c=b[a],this._canConsider(ut,e,c)&&!c.segments&&(h=t.datavisualization.Diagram.Util.bounds(c),(w==null||w>Math.abs(h.x-s.x))&&(r.top?Math.abs(s.y+f-h.y)<=v?(g=this._createSnapObject(h,s,"top"),w=Math.abs(h.x-s.x)):Math.abs(s.y+f-h.y-h.height)<=v&&(g=this._createSnapObject(h,s,"topBottom"),w=Math.abs(h.x-s.x)):r.bottom&&(Math.abs(s.y+s.height+f-h.y-h.height)<=v?(g=this._createSnapObject(h,s,"bottom"),w=Math.abs(h.x-s.x)):Math.abs(s.y+s.height+f-h.y)<=v&&(g=this._createSnapObject(h,s,"bottomTop"),w=Math.abs(h.x-s.x)))));for(a=0;a<it.length;a++)if(c=it[a],this._canConsider(ut,e,c)){var k=t.datavisualization.Diagram.Util.bounds(c),ft=i.left?-u:u,ct=Math.abs(s.width+ft-k.width),rt;ct<=v&&(rt=i.left?-k.width+s.width:k.width-s.width,nt[nt.length]={source:c,diff:ct,offset:rt});ft=r.top?-f:f;et=Math.abs(s.height+ft-k.height);et<=v&&(rt=r.top?-k.height+s.height:k.height-s.height,tt[tt.length]={source:c,diff:et,offset:rt})}n.activeTool.selectedSeperator||(ot=this._createGuidelines(n,d,g,i,r,o));!i.snapped&&nt.length>0&&(i.left||i.right)&&this._addSameWidthLines(n,nt,i,o,ot,e);!r.snapped&&tt.length>0&&(r.top||r.bottom)&&this._addSameHeightLines(n,tt,r,o,ot,e)},_createSnapObject:function(n,i,r){var u;switch(r){case"left":u={start:t.datavisualization.Diagram.Point(n.x,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x-i.x,offsetY:0,type:"sideAlign"};break;case"right":u={start:t.datavisualization.Diagram.Point(n.x+n.width,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"top":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y),offsetY:n.y-i.y,offsetX:0,type:"sideAlign"};break;case"bottom":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height),offsetY:n.y+n.height-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"topBottom":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height),offsetY:n.y+n.height-i.y,offsetX:0,type:"sideAlign"};break;case"bottomTop":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y),offsetY:n.y-i.y-i.height,offsetX:0,type:"sideAlign"};break;case"leftRight":u={start:t.datavisualization.Diagram.Point(n.x+n.width,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width-i.x,offsetY:0,type:"sideAlign"};break;case"rightLeft":u={start:t.datavisualization.Diagram.Point(n.x,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x-i.x-i.width,offsetY:0,type:"sideAlign"};break;case"centerX":u={start:t.datavisualization.Diagram.Point(n.x+n.width/2,Math.min(n.y,i.y)),end:t.datavisualization.Diagram.Point(n.x+n.width/2,Math.max(n.y+n.height,i.y+i.height)),offsetX:n.x+n.width/2-(i.x+i.width/2),offsetY:0,type:"centerAlign"};break;case"centerY":u={start:t.datavisualization.Diagram.Point(Math.min(n.x,i.x),n.y+n.height/2),end:t.datavisualization.Diagram.Point(Math.max(n.x+n.width,i.x+i.width),n.y+n.height/2),offsetY:n.y+n.height/2-(i.y+i.height/2),offsetX:0,type:"centerAlign"}}return u},_createGuidelines:function(n,i,r,u,f,e){var l={id:n._canvas.id+"guideline",style:"pointer-events:none;"},o=t.datavisualization.Diagram.SvgContext._initializeGuidelines(n._adornerSvg,l,n._adornerLayer),s=n._currZoom,h=n._hScrollOffset,c=n._vScrollOffset;return i&&(u.offset=i.offsetX,u.snapped=!0,e||(i.type=="sideAlign"?t.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(i.start,i.end,o,n._adornerSvg,s,h,c):i.type=="centerAlign"&&t.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(i.start,i.end,o,n._adornerSvg,s,h,c))),r&&(f.offset=r.offsetY,f.snapped=!0,e||(r.type=="sideAlign"?t.datavisualization.Diagram.SvgContext._renderSideAlignmentLines(r.start,r.end,o,n._adornerSvg,s,h,c):r.type=="centerAlign"&&t.datavisualization.Diagram.SvgContext._renderCenterAlignmentLines(r.start,r.end,o,n._adornerSvg,s,h,c))),o},_removeGuidelines:function(n){var i=n._adornerSvg.getElementById(n._canvas.id+"guideline");i!=null&&t.datavisualization.Diagram.SvgContext._removeGuidelines(n._adornerLayer,i)},_sortByDistance:function(n,t,i){var r,u,f;if(i)for(r=0;r<n.length;r++)for(u=r+1;u<n.length;u++)n[r][t]>n[u][t]&&(f=n[r],n[r]=n[u],n[u]=f);else for(r=0;r<n.length;r++)for(u=r+1;u<n.length;u++)n[r][t]<n[u][t]&&(f=n[r],n[r]=n[u],n[u]=f)},_createHSpacingLines:function(n,i,r,u,f,e,o,s,h,c){var a=null,l,w,p,y,b,v,d,g,k;this._sortByDistance(r,"distance",!0);this._sortByDistance(u,"distance",!0);l=[];w=t.datavisualization.Diagram.Util.bounds(i);r.length>0&&(l[l.length]=r[0],p=t.datavisualization.Diagram.Util.bounds(r[0].object),a=p.y,r.length>1?(b=t.datavisualization.Diagram.Util.bounds(r[1].object),v=p.x-b.x-b.width,Math.abs(v-r[0].distance)<=c?a=this._findEquallySpacedNodesAtLeft(r,v,a,l):v=r[0].distance):v=r[0].distance);this._sortByDistance(l,"distance");l[l.length]={object:i,distance:0};a=w.y<a||!a?w.y:a;u.length>0&&(y=t.datavisualization.Diagram.Util.bounds(u[0].object),a=y.y<a?y.y:a,u.length>1&&(b=t.datavisualization.Diagram.Util.bounds(u[1].object),d=b.x-y.x-y.width),r.length>0?Math.abs(u[0].distance-r[0].distance)<=c?(g=Math.abs(u[0].distance-r[0].distance)/2,u[0].distance<r[0].distance?v-=g:v+=g,l[l.length]=u[0]):r.length==1&&(p=undefined,l.splice(0,1),l[l.length]=u[0],v=d):(v=d,l[l.length]=u[0]),u.length>1&&y.x+y.width<b.x&&(a=this._findEquallySpacedNodesAtRight(u,d,a,l,c)));l.length>2&&(this._addHSpacingLines(n,l,o,s,a),k=0,o&&(k=h.x),p?f.offset=v-Math.abs(w.x+k-p.x-p.width)+k:y&&(f.offset=Math.abs(w.x+w.width+k-y.x)-v+k),f.snapped=!0)},_createVSpacingLines:function(n,i,r,u,f,e,o,s,h,c){var a=null,l,p,w,v,b,y,d,g,k;this._sortByDistance(r,"distance",!0);this._sortByDistance(u,"distance",!0);l=[];p=t.datavisualization.Diagram.Util.bounds(i);r.length>0&&(l[l.length]=r[0],w=t.datavisualization.Diagram.Util.bounds(r[0].object),a=w.x+w.width,r.length>1?(b=t.datavisualization.Diagram.Util.bounds(r[1].object),y=w.y-b.y-b.height,Math.abs(y-r[0].distance)<=c?a=this._findEquallySpacedNodesAtTop(r,y,a,l):y=r[0].distance):y=r[0].distance);this._sortByDistance(l,"distance");l[l.length]={object:i,distance:0};a=p.x+p.width>a||!a?p.x+p.width:a;u.length>0&&(v=t.datavisualization.Diagram.Util.bounds(u[0].object),a=v.x+v.width>a?v.x+v.width:a,u.length>1&&(b=t.datavisualization.Diagram.Util.bounds(u[1].object),d=b.y-v.y-v.height),r.length>0?Math.abs(u[0].distance-r[0].distance)<=c?(g=Math.abs(u[0].distance-r[0].distance)/2,u[0].distance<r[0].distance?y-=g:y+=g,l[l.length]=u[0]):r.length==1&&(w=undefined,l.splice(0,1),l[l.length]=u[0],y=d):(y=d,l[l.length]=u[0]),u.length>1&&b.y>v.y+v.height&&(a=this._findEquallySpacedNodesAtBottom(u,d,a,l,c)));l.length>2&&(this._addVSpacingLine(n,l,o,s,a),k=0,o&&(k=h.y),w?e.offset=y-Math.abs(p.y+k-w.y-w.height)+k:v&&(e.offset=Math.abs(p.y+p.height+k-v.y)-y+k),e.snapped=!0)},_addHSpacingLines:function(n,i,r,u,f){var h=n._currZoom,c=n._hScrollOffset,l=n._vScrollOffset,e,o,s;if(i.length>2&&!r)for(e=0;e<i.length-1;e++)o=t.datavisualization.Diagram.Util.bounds(i[e].object),s=t.datavisualization.Diagram.Util.bounds(i[e+1].object),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width,f-15),t.datavisualization.Diagram.Point(s.x,f-15),u,n._adornerSvg,h,c,l)},_addVSpacingLine:function(n,i,r,u,f){var h=n._currZoom,c=n._hScrollOffset,l=n._vScrollOffset,o,s,e;if(i.length>2&&!r)for(e=0;e<i.length-1;e++)o=t.datavisualization.Diagram.Util.bounds(i[e].object),s=t.datavisualization.Diagram.Util.bounds(i[e+1].object),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(f+15,o.y+o.height),t.datavisualization.Diagram.Point(f+15,s.y),u,n._adornerSvg,h,c,l)},_addSameWidthLines:function(n,i,r,u,f,e){var l=n._currZoom,a=n._hScrollOffset,v=n._vScrollOffset,s,y;this._sortByDistance(i,"offset");var o=t.datavisualization.Diagram.Util.bounds(e),c=i[0],p=t.datavisualization.Diagram.Util.bounds(c.source),h=[];for(h.push(i[0]),s=1;s<i.length;s++)y=t.datavisualization.Diagram.Util.bounds(i[s].source),y.width==p.width&&h.push(i[s]);if(h.length>0&&!u)for(t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+c.offset,o.y-15),t.datavisualization.Diagram.Point(o.x+o.width+c.offset,o.y-15),f,n._adornerSvg,l,a,v),s=0;s<h.length;s++)o=t.datavisualization.Diagram.Util.bounds(h[s].source),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x,o.y-15),t.datavisualization.Diagram.Point(o.x+o.width,o.y-15),f,n._adornerSvg,l,a,v);r.offset=c.offset;r.snapped=!0},_addSameHeightLines:function(n,i,r,u,f,e){var l=n._currZoom,a=n._hScrollOffset,v=n._vScrollOffset,s,y;this._sortByDistance(i,"offset");var o=t.datavisualization.Diagram.Util.bounds(e),c=i[0],p=t.datavisualization.Diagram.Util.bounds(c.source),h=[];for(h.push(i[0]),s=0;s<i.length;s++)y=t.datavisualization.Diagram.Util.bounds(i[s].source),y.height==p.height&&h.push(i[s]);if(h.length>0){if(!u)for(t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+c.offset),t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+o.height+c.offset),f,n._adornerSvg,l,a,v),s=0;s<h.length;s++)o=t.datavisualization.Diagram.Util.bounds(h[s].source),t.datavisualization.Diagram.SvgContext._renderSpacingLines(t.datavisualization.Diagram.Point(o.x+o.width+15,o.y),t.datavisualization.Diagram.Point(o.x+o.width+15,o.y+o.height),f,n._adornerSvg,l,a,v);r.offset=c.offset;r.snapped=!0}},_findEquallySpacedNodesAtLeft:function(n,i,r,u){for(var o,f,s,e=1;e<n.length;e++)if(o=t.datavisualization.Diagram.Util.bounds(n[e-1].object),f=t.datavisualization.Diagram.Util.bounds(n[e].object),s=o.x-f.x-f.width,Math.abs(s-i)<=1)u[u.length]=n[e],f.y<r&&(r=f.y);else break;return r},_findEquallySpacedNodesAtRight:function(n,i,r,u,f){var l=n[0].distance,s,h,o,c,e;if(Math.abs(i-l)<=f)for(e=0;e<n.length-1;e++)if(s=n[e].object,h=t.datavisualization.Diagram.Util.bounds(n[e+1].object),o=t.datavisualization.Diagram.Util.bounds(s),c=h.x-o.x-o.width,Math.abs(c-i)<=1)u[u.length]=n[e+1],o.y<r&&(r=o.y);else break;return r},_findEquallySpacedNodesAtTop:function(n,i,r,u){for(var o,f,s,e=1;e<n.length;e++)if(o=t.datavisualization.Diagram.Util.bounds(n[e-1].object),f=t.datavisualization.Diagram.Util.bounds(n[e].object),s=o.y-f.y-f.height,Math.abs(s-i)<=1)u[u.length]=n[e],f.x+f.width>r&&(r=f.x+f.width);else break;return r},_findEquallySpacedNodesAtBottom:function(n,i,r,u,f){var l=n[0].distance,s,h,e,c,o;if(Math.abs(i-l)<=f)for(o=0;o<n.length-1;o++)if(s=n[o].object,h=t.datavisualization.Diagram.Util.bounds(n[o+1].object),e=t.datavisualization.Diagram.Util.bounds(s),c=h.y-e.y-e.height,Math.abs(c-i)<=1)u[u.length]=n[o+1],e.x+e.width>r&&(r=e.x+e.width);else break;return r}};t.datavisualization.Diagram.SpatialUtil={findQuads:function(n,t){n.quads=[];var i=n.parentQuad;return this._findQuads(n,i,t),n.quads},_addIntoAQuad:function(n){for(var t=!1;!t;)t=this._add(n,n.parentQuad)},_setCurrentNode:function(n,i){n.childnode=i;var r=t.datavisualization.Diagram.Util.bounds(i);n.childLeft=r.left;n.childTop=r.top;n.childRight=r.right;n.childBottom=r.bottom},_add:function(n,i){if(this._isContained(n,i))return this._selectQuad(n,i),!0;var r,u=!i.objects.length&&i.first==null&&i.second==null&&i.third==null&&i.fourth==null;return n.childLeft<i.left?n.childTop<i.top?(r=t.datavisualization.Diagram.Quad(i.left-i.width,i.top-i.height,i.width*2,i.height*2),u||(r.fourth=i)):(r=t.datavisualization.Diagram.Quad(i.left-i.width,i.top,i.width*2,i.height*2),u||(r.second=i)):n.childTop<i.top?(r=t.datavisualization.Diagram.Quad(i.left,i.top-i.height,i.width*2,i.height*2),u||(r.third=i)):(r=t.datavisualization.Diagram.Quad(i.left,i.top,i.width*2,i.height*2),u||(r.first=i)),i.parent=r,n.parentQuad=r,!1},_isContained:function(n,t){return n.childLeft>=t.left&&n.childRight<=t.left+t.width&&n.childTop>=t.top&&n.childBottom<=t.top+t.height?!0:!1},_selectQuad:function(n,t){for(var i=t;i!==null;)i=this._getQuad(n,i)},_getQuad:function(n,i){var u=i.width/2,f=i.height/2,e,r;if(u>=100&&f>=100)if(e=i.left+u,r=i.top+f,n.childRight<=e){if(n.childBottom<=r)return i.first?i.first:i.first=t.datavisualization.Diagram.Quad(i.left,i.top,u,f,i);if(n.childTop>=r)return i.third?i.third:i.third=t.datavisualization.Diagram.Quad(i.left,r,u,f,i)}else if(n.childLeft>=e){if(n.childBottom<=r)return i.second?i.second:i.second=t.datavisualization.Diagram.Quad(e,i.top,u,f,i);if(n.childTop>=r)return i.fourth?i.fourth:i.fourth=t.datavisualization.Diagram.Quad(e,r,u,f,i)}return i.objects.push(n.childnode),n.quadTable[n.childnode.name]=i,null},_findQuads:function(n,t,i){t.first&&this._isIntersect(t.first,i)&&this._findQuads(n,t.first,i);t.second&&this._isIntersect(t.second,i)&&this._findQuads(n,t.second,i);t.third&&this._isIntersect(t.third,i)&&this._findQuads(n,t.third,i);t.fourth&&this._isIntersect(t.fourth,i)&&this._findQuads(n,t.fourth,i);t.objects.length>0&&n.quads.push(t)},_isIntersect:function(n,t){return n.left+n.width<t.x||n.top+n.height<t.y||n.left>t.x+t.width||n.top>t.y+t.height?!1:!0},_update:function(n){if(n.parent!=null&&n.objects.length==0&&n.first==null&&n.second==null&&n.third==null&&n.fourth==null){var t=n.parent;t.first==n?t.first=null:t.second==n?t.second=null:t.third==n?t.third=null:t.fourth==n&&(t.fourth=null);this._update(n.parent)}else return},_isWithinPageBounds:function(n,t){return t.left>=n.pageLeft&&t.right<=n.pageRight&&t.top>=n.pageTop&&t.bottom<=n.pageBottom?!0:!1},_updateBounds:function(n,i,r,u){var f=!1;i.topElement&&r.name==i.topElement.name&&(f=!0,i.pageTop=null,this._findQuadElement(i,i.parentQuad,"top"));i.leftElement&&r.name==i.leftElement.name&&(f=!0,i.pageLeft=null,this._findQuadElement(i,i.parentQuad,"left"));i.rightElement&&r.name==i.rightElement.name&&(f=!0,i.pageRight=null,this._findQuadElement(i,i.parentQuad,"right"));i.bottomElement&&r.name==i.bottomElement.name&&(f=!0,i.pageBottom=null,this._findQuadElement(i,i.parentQuad,"bottom"));f&&n._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(n,u!==undefined?u:!0)},_findQuadElement:function(n,i,r){var u,f;switch(r){case"bottom":i.third!=null||i.fourth!=null?(i.third!=null&&this._findQuadElement(n,i.third,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r)):(i.first!=null&&this._findQuadElement(n,i.first,r),i.second!=null&&this._findQuadElement(n,i.second,r));break;case"top":i.first!=null||i.second!=null?(i.first!=null&&this._findQuadElement(n,i.first,r),i.second!=null&&this._findQuadElement(n,i.second,r)):(i.third!=null&&this._findQuadElement(n,i.third,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r));break;case"left":i.first!=null||i.third!=null?(i.first!=null&&this._findQuadElement(n,i.first,r),i.third!=null&&this._findQuadElement(n,i.third,r)):(i.second!=null&&this._findQuadElement(n,i.second,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r));break;case"right":i.second!=null||i.fourth!=null?(i.second!=null&&this._findQuadElement(n,i.second,r),i.fourth!=null&&this._findQuadElement(n,i.fourth,r)):(i.third!=null&&this._findQuadElement(n,i.third,r),i.first!=null&&this._findQuadElement(n,i.first,r))}for(f=0;f<i.objects.length;f++)u=t.datavisualization.Diagram.Util.bounds(i.objects[f]),r==="bottom"&&(n.pageBottom<=u.bottom||n.pageBottom==null)?(n.pageBottom=u.bottom,n.bottomElement=i.objects[f]):r==="top"&&(n.pageTop>=u.top||n.pageTop==null)?(n.pageTop=u.top,n.topElement=i.objects[f]):r==="left"&&(n.pageLeft>=u.left||n.pageLeft==null)?(n.pageLeft=u.left,n.leftElement=i.objects[f]):r==="right"&&(n.pageRight<=u.right||n.pageRight==null)&&(n.pageRight=u.right,n.rightElement=i.objects[f])},_initializeNodes:function(n,t){for(var r,f,u=n.nodes(),i=0;i<u.length;i++)r=u[i],f=this.getObjectType(r),f!="group"&&this._updateQuad(n,t,r)},_initializeConnectors:function(n,t){for(var r=n.connectors(),i=0;i<r.length;i++)this._updateQuad(n,t,r[i])},_updateQuad:function(i,r,u){var h,s,f,o,e;this._setCurrentNode(r,u);h=t.datavisualization.Diagram.Util.bounds(u);s=r.quadTable[u.name];s?this._isContained(r,s)||(this._removeFromaQuad(r,s,u),this._addIntoAQuad(r)):(r.parentQuad||(r.parentQuad=t.datavisualization.Diagram.Quad(0,0,200,200)),this._addIntoAQuad(r));this._isWithinPageBounds(r,h)&&r.leftElement!=u&&r.topElement!=u&&r.rightElement!=u&&r.bottomElement!=u||(f=!1,o=!1,r.pageLeft>=r.childLeft||r.pageLeft==null?(r.pageLeft=r.childLeft,r.leftElement=u,f=!0):u==r.leftElement&&(r.pageLeft=null,this._findQuadElement(r,r.parentQuad,"left"),o=f=!0),r.pageTop>=r.childTop||r.pageTop==null?(r.pageTop=r.childTop,r.topElement=u,f=!0):u==r.topElement&&(r.pageTop=null,this._findQuadElement(r,r.parentQuad,"top"),o=f=!0),r.pageBottom<=r.childBottom||r.pageBottom==null?(f=!0,r.pageBottom=r.childBottom,r.bottomElement=u):u==r.bottomElement&&(r.pageBottom=null,this._findQuadElement(r,r.parentQuad,"bottom"),o=f=!0),r.pageRight<=r.childRight||r.pageRight==null?(r.pageRight=r.childRight,r.rightElement=u,f=!0):u==r.rightElement&&(r.pageRight=null,this._findQuadElement(r,r.parentQuad,"right"),o=f=!0));e=i.activeTool.diagramBounds;f&&i.model.pageSettings.multiplePage&&(i.model.pageSettings.pageWidth||i.model.pageSettings.pageHeight)&&e&&(f=!1,(o||r.pageLeft<e.x||r.pageTop<e.y||r.pageRight>e.x+e.width||r.pageBottom>e.y+e.height)&&(f=!0,i.activeTool.diagramBounds=i._getDigramBounds()));f&&(i._views.forEach(function(t){var u=i._views[t],r;u.type=="overview"&&(r=n("#"+t).ejOverview("instance"),r&&r._updateOverview(u))}),!i._layoutInAction&&i._pageBackgroundLayer&&t.datavisualization.Diagram.PageUtil._updatePageSize(i,i.activeTool.inAction||i._selectedSymbol))},_removeFromaQuad:function(n,t,i){if(t){var r=t.objects.indexOf(i);t.objects.splice(r,1);this._update(t);delete n.quadTable[i.name]}}};t.datavisualization.Diagram.Quad=function(n,t,i,r,u){return{left:n,top:t,width:i,height:r,parent:u,first:null,second:null,third:null,fourth:null,objects:[]}};t.datavisualization.Diagram.SpatialSearch=function(){return{pageLeft:null,pageRight:null,pageTop:null,pageBottom:null,topElement:null,bottomElement:null,rightElement:null,leftElement:null,childLeft:null,childTop:null,childRight:null,childBottom:null,childNode:null,quads:null,parentQuad:t.datavisualization.Diagram.Quad(0,0,200,200),quadTable:{}}};t.datavisualization.Diagram.ClassifierHelper={getEditableElementUnderMouse:function(n,t){var i=t._findNodeUnderMouse(n),r;return i&&(r=i.name.match("_attribute")?"attribute":i.name.match("_method")?"method":i.name.match("_member")?"member":"header",r&&i.parent&&(i=t.nameTable[i.parent])),i},getMovableElementUnderMouse:function(n,t){var i=t._findNodeUnderMouse(n),r=n.target.className;return!i||!i.parent||i.type=="umlclassifier"||(i=t.nameTable[i.parent]),i},getSelectableElementUnderMouse:function(n,t){var i=t._findNodeUnderMouse(n);return!i||!i.parent||i.type=="umlclassifier"||(i=t.nameTable[i.parent]),i},getDropableElementUnderMouse:function(n,i){var r=i._findNodeUnderMouse(n);return i._nodeUnderMouse||(i._nodeUnderMouse=r),r&&t.datavisualization.Diagram.Util.canAllowDrop(r)?r:!0},renderResizeBorder:function(n,t,i,r){var u=t.width?t.width:t._width,f=t.height?t.height:t._height;return i.rect({id:n,width:u*r+t.borderWidth+4,height:f*r+t.borderWidth+4,x:-(t.borderWidth/2+2),y:-(t.borderWidth/2+2),stroke:"#f93732","stroke-width":2,"stroke-dasharray":"0",fill:"none","pointer-events":"none"})},getEditboxValue:function(i,r,u){for(var v,s,y,o,p,c,w,a,f,e=0;e<r.children.length;e++)typeof r.children[e]=="string"&&(r.children[e]=u.nameTable[r.children[e]]),v=r.children[e].name.match("_attribute")?"attribute":r.children[e].name.match("_method")?"method":r.children[e].name.match("_member")?"member":"header";for(s=i.split("\n"),f=0;f<s.length;f++)s[f]=s[f].trim().replace(/\s+/g," "),!s[f].indexOf("---")>-1&&s[f].charAt(0)=="+"||s[f].charAt(0)=="-"||s[f].charAt(0)=="#"||s[f].charAt(0)=="~"?s[f]=s[f]:f!=s[f].length-s[f].length&&!s[f].indexOf("---")>-1&&s[f].length>0&&v!="member"&&!r.enumeration&&(s[f]="+ "+s[f]),s[f].indexOf("---")>-1&&s[f].match(/\w|\d|\D|\s/g)&&(y=s[f].match(/---/g),s[f]=y[0]);for(i=s.join("\n"),o=i.split("\n---\n"),f=0;f<o.length;f++)o[f]=o[f].replace(/^\n+/g,"");for(o[0].indexOf("+")>-1&&(o[0]=o[0].replace(/[+]/g,"")),o[0].length>0&&(r.children[0].labels[0].text=o[0]),r.children[1]&&!o[2]?r.children[1].labels[0].text=o[1]:r.children[1]&&o[2]&&(r.children[1].name.indexOf("method")>-1?r.children[1].labels[0].text.indexOf(o[1])>-1?(r.children[1].labels[0].text=o[1],o.pop()):r.children[1].labels[0].text=o[2]:(p=r.children[1].name.indexOf("attribute")>-1?o[1]:r.children[1].name.indexOf("member")>-1?o[1]:o[2],r.children[1].labels[0].text=p)),r.children[2]&&(r.children[2].labels[0].text=o[2]),e=0;e<r.children.length;e++)c=r.children[e].labels[0].text,c&&c.indexOf("--")>-1&&(c=c.replace(/---\n*/g,""),r.children[e].labels[0].text=c),c&&c.endsWith("\n")&&(w=c.replace(/\n+$/g,""),r.children[e].labels[0].text=w),a=r.children[e].labels[0].text?r.children[e].labels[0].text.length:null,!a&&a<=0&&(u._remove(r.children[e]),e--),u.nameTable[r.children[e].name]=r.children[e];if(o[2]&&!r.children[2]||o[1]&&!r.children[1]){var h=[],l=t.datavisualization.Diagram.NodeConstraints.Default&~(t.datavisualization.Diagram.NodeConstraints.Select|t.datavisualization.Diagram.NodeConstraints.ResizeNorthEast|t.datavisualization.Diagram.NodeConstraints.ResizeWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthEast|t.datavisualization.Diagram.NodeConstraints.ResizeNorthWest|t.datavisualization.Diagram.NodeConstraints.ResizeSouthWest|t.datavisualization.Diagram.NodeConstraints.ResizeNorth|t.datavisualization.Diagram.NodeConstraints.ResizeSouth|t.datavisualization.Diagram.NodeConstraints.Connect|t.datavisualization.Diagram.NodeConstraints.Rotate|t.datavisualization.Diagram.NodeConstraints.ResizeEast),b={width:r.width,offsetX:r.offsetX,parent:r.name,ports:[],fillColor:"transparent",borderColor:r.borderColor,type:"node",labels:[{margin:{left:5,right:5,top:5,bottom:5}}],_isClassMember:!0};for(e=0;e<r.children.length;e++)e!=0&&r.children[e].name.indexOf("_attribute")>-1&&o[2].length>0?h.push({name:r.name+"_method_classifier",labels:[{text:o[2],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:l}):e!=0&&r.children[e].name.indexOf("_method")>-1&&o[1].length>0&&h.push({name:r.name+"_attribute_classifier",labels:[{text:o[1],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:l});for(r.children.length<2&&(o[1]&&h.push({name:r.name+"_attribute_classifier",labels:[{text:o[1],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:l}),o[2]&&h.push({name:r.name+"_method_classifier",labels:[{text:o[2],horizontalAlignment:"left",textAlign:"left",offset:{x:0,y:.5}}],constraints:l})),f=0;f<h.length;f++)h[f].labels[0]=n.extend(!0,{},r.labels[0],h[f].labels[0]),h[f]=t.datavisualization.Diagram.Node(n.extend(!0,{},b,h[f])),u._getNodeDimension(h[f],h[f].labels[0]),h[f].offsetY+=r.offsetY-r.height/2,u.add(h[f]),u.nameTable[h[f].name]=h[f];r.children[2]&&r.children[2].match("_attribute")&&(r.children.splice(1,0,r.children[2]),r.children.pop());typeof r.children[1]=="string"&&(r.children[1]=u.nameTable[r.children[1]]);typeof r.children[2]=="string"&&(r.children[2]=u.nameTable[r.children[2]])}for(e=0;e<r.children.length;e++)r.children.length==1&&(r["class"]&&(delete r["class"].attributes,delete r["class"].methods),r["interface"]&&(delete r["interface"].attributes,delete r["interface"].methods),r.enumeration&&delete r.enumeration.members),r.children.length==2&&(r["class"]&&(r.children[e].name.match("attribute")&&delete r["class"].methods,r.children[e].name.match("method")&&delete r["class"].attributes),r["interface"]&&(r.children[e].name.match("attribute")&&delete r["interface"].methods,r.children[e].name.match("method")&&delete r["interface"].attributes)),this._updateClassNode(r.children[e],r);return i},getUMLConnectorValue:function(n,t){var i=t.split(".....");return n.labels[0].text=i[0],n.labels[1]&&(n.labels[1].text=i[1]),n},getClassifierNodeDimension:function(n,t){for(var f,r,u,i=0;i<n.children.length;i++)t._getNodeDimension(n.children[i]);for(n._height=0,i=0;i<n.children.length;i++)f=n.children[i].height?n.children[i].height:n.children[i]._height,n.children[i].offsetY=n._height+f/2,n._height+=f,n.height=n._height;for(r=n.children[0]._width,n.children[1]&&(r=n.children[0]._width>n.children[1]._width?n.children[0]._width:n.children[1]._width),n.children[2]&&(r=n.children[2]._width>r?n.children[2]._width:r),n.children[0].width=r,n.children[1]&&(n.children[1].width=r),n.children[2]&&(n.children[2].width=r),n.width=r,u=0;u<n.children.length;u++)n.children[u].offsetY+=n.offsetY-n.height/2;return t._updateAssociatedConnectorEnds(n,t.nameTable),n},_updateClassNode:function(n,i){var s,a;if(n.name.match("_header"))i["class"]?i["class"].name=n.labels[0].text:i["interface"]?i["interface"].name=n.labels[0].text:i.enumeration.name=n.labels[0].text;else{for(var v=n.name.match("_attribute")?"attribute":n.name.match("_method")?"method":"member",y=n.labels[0],h,u,l=[],c,f=y.text.split("\n"),e=[],o,r=0;r<f.length;r++){f[r].indexOf("+")>-1?h="public":f[r].indexOf("-")>-1?h="private":f[r].indexOf("#")>-1?h="protected":f[r].indexOf("~")>-1&&(h="package");(f[r].indexOf("+")>-1||f[r].indexOf("-")>-1||f[r].indexOf("#")>-1||f[r].indexOf("~")>-1)&&(f[r]=f[r].replace(/[+|~|#|-]\s/g,""));switch(v){case"attribute":o=f[r].split(/:[ ]*/g);e.push(t.datavisualization.Diagram.ClassAttribute({name:o[0],type:o[1],scope:h}));break;case"method":for(u=f[r].split(/["("|")"]/g),s=0;s<u.length;s++)u[s].indexOf(",")>-1&&(o=u[s].split(",")),s==u.length-1&&(u[s]=u[s].replace(/[:\s]|:/g,""));if(o)for(a=0;a<o.length;a++)c=o[a].split(":"),l.push(t.datavisualization.Diagram.ClassmethodArguments({name:c[0],type:c[1]}));u.length!=3||o||(u[1].indexOf(":")>-1?(c=u[1].split(":"),l.push(t.datavisualization.Diagram.ClassmethodArguments({name:c[0],type:c[1]}))):l.push(t.datavisualization.Diagram.ClassmethodArguments({name:u[1]})));e.push(t.datavisualization.Diagram.ClassMethod({name:u[0],arguments:l,type:u[u.length-1],scope:h}));break;case"member":e.push(t.datavisualization.Diagram.ClassMember({name:f[r]}))}}v=="attribute"?i["class"]?i["class"].attributes=e:i["interface"]&&(i["interface"].attributes=e):v=="method"?i["class"]?i["class"].methods=e:i["interface"]&&(i["interface"].methods=e):i.enumeration.members=e}}};t.datavisualization.Diagram.SwimLaneContainerHelper={_initSwimLane:function(n,i){var i=t.datavisualization.Diagram.SwimLane(i);return i=this._initLaneCollection(n,i),this._swapPhaseSize(i),i=this._setPhaseMinValues(n,i),this._initPhaseCollection(n,i)},_initLaneCollection:function(n,i){var r,u,f,e;for(i.lanes.length===0&&(i.lanes=[t.datavisualization.Diagram.Lane({orientation:i.orientation})]),r=0;r<i.lanes.length;r++){if(i.lanes[r]=t.datavisualization.Diagram.Lane(i.lanes[r]),i.lanes[r].container={type:"canvas",orientation:i.orientation},i.lanes[r].borderColor=i.lanes[r].borderColor?i.lanes[r].borderColor:"black",i.lanes[r].orientation=i.orientation?i.orientation:"horizontal",i.lanes[r].horizontalAlign=i.orientation==="horizontal"?"stretch":"left",i.lanes[r].verticalAlign=i.orientation==="vertical"?"stretch":"top",i.lanes[r].addInfo=i.lanes[r].addInfo?i.lanes[r].addInfo:{},i.lanes[r].fillColor=i.lanes[r].fillColor,i.lanes[r].paddingTop=20,i.lanes[r].paddingRight=20,i.lanes[r].paddingBottom=20,i.lanes[r].paddingLeft=20,i.lanes[r].constraints=i.lanes[r].constraints?i.lanes[r].constraints|t.datavisualization.Diagram.NodeConstraints.AllowDrop:t.datavisualization.Diagram.NodeConstraints.Default|t.datavisualization.Diagram.NodeConstraints.AllowDrop&~t.datavisualization.Diagram.NodeConstraints.Connect,i.lanes[r].cssClass=i.lanes[r].cssClass,i.lanes[r]._laneHeader=i.lanes[r]._laneHeader?i.lanes[r]._laneHeader:null,i.lanes[r].labels&&i.lanes[r].labels.length>0)for(u=0;u<i.lanes[r].labels.length;u++)i.lanes[r].labels[u]=t.datavisualization.Diagram.Label(i.lanes[r].labels[u]);f=i.lanes[r]._laneHeader=i.lanes[r]._laneHeader?i.lanes[r]._laneHeader:i.lanes[r].header;e=this._initLaneHeader(n,i.lanes[r],f,i);i.lanes[r].children.splice(0,0,e)}return i},_initLaneHeader:function(n,i,r,u){var f=i.header,s=u.orientation,e,o,u;return s==="horizontal"?(e="left",o="stretch",f.rotateAngle=270):(e="stretch",o="top",f.rotateAngle=0),t.datavisualization.Diagram.Node({_hidePorts:!0,_isHeader:!0,name:n._isUndo&&r.name?r.name:i.name+"_Headerr_",type:"node",labels:[f],height:r.height?r.height:50,width:r.width?r.width:50,fillColor:f.fillColor?f.fillColor:"white",rotateAngle:0,horizontalAlign:e,verticalAlign:o,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,marginLeft:-20,marginTop:-20,marginRight:-20,marginBottom:-20})},_initPhaseCollection:function(n,i){var u=0,f=0,r;for(i.phases.length===0&&(i.phases=[t.datavisualization.Diagram.Phase({orientation:i.orientation})]),r=0;r<i.phases.length;r++)i.phases[r]=t.datavisualization.Diagram.Phase(i.phases[r]),i.phases[r].isPhase=!0,i.phases[r]._hidePorts=!0,i.phases[r].constraints=t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,i.phases[r].parent="",i.phases[r]._isHeader=!0,i.phases[r]._type="node",i.phases[r].orientation=i.orientation,n._isLoad?i.phases[r].labels&&i.phases[r].labels.length>0&&(i.phases[r].label=[i.phases[r].labels[0]]):i.phases[r].label&&(i.phases[r].label.rotateAngle=i.orientation==="vertical"?270:0,i.phases[r].labels=[i.phases[r].label]),i.orientation==="horizontal"?(i.phases[r].width=i.phases[r].offset-f,i.phases[r].height=i.phaseSize,f=i.phases[r].offset):(i.phases[r].height=i.phases[r].offset-u,i.phases[r].width=i.phaseSize,u=i.phases[r].offset);return i},_setPhaseMinValues:function(n,t){var u,i,r;if(i=t.phases[0],i)for(i.offset<70&&(i.offset=70),r=1;r<t.phases.length;r++)u=t.phases[r],i=t.phases[r-1],i.offset+20>=u.offset&&(u.offset=i.offset+20);return t},_swapPhaseSize:function(n){if(n.phases.length>0)for(var i=n.phases,t,u,r=0;r<i.length;r++)for(t=0;t<i.length-r-1;t++)i[t].offset>i[t+1].offset&&(u=i[t],i[t]=i[t+1],i[t+1]=u)},_setLastPhaseSize:function(n){if(n.phases.length>0){var t=n.phases[n.phases.length-1];t.offset=n.orientation==="horizontal"?n.width:n.height}},_createSwimlane:function(n,i){var e=this._createSwimlaneHeader(n,i),l=i.orientation==="horizontal"?"vertical":"horizontal",s=i.orientation,h,c,f,o;s==="horizontal"?(h=e.height+i.phaseSize,c=0):(h=e.height,c=i.phaseSize);var u={name:i.name+"phaseStack",isPhaseStack:!0,container:{type:"stack",orientation:s},minHeight:10,minWidth:10,children:i.phases,marginTop:e.height,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect&~t.datavisualization.Diagram.NodeConstraints.AllowDrop},a={name:i.name+"laneStack",isLaneStack:!0,container:{type:"stack",orientation:l},children:i.lanes,marginTop:h,marginLeft:c,verticalAlign:"stretch",horizontalAlign:"stretch"},r={_hidePorts:!0,name:i.name,container:{type:"canvas"},children:[e,a],constraints:i.constraints,cssClass:i.cssClass,offsetX:i.offsetX?i.offsetX:100,offsetY:i.offsetY?i.offsetY:100,orientation:i.orientation,phaseSize:i.phaseSize,isSwimlane:!0,height:i.height?i.height:100,width:i.width?i.width:100};return r.offsetX=i.offsetX?i.offsetX:100,r.offsetY=i.offsetY?i.offsetY:100,f=t.datavisualization.Diagram.containerCommon._cloneObject(n,r,t.datavisualization.Diagram.Util.randomId()),f=t.datavisualization.Diagram.ContainerHelper._initContainer(n,f),o=t.datavisualization.Diagram.Util.bounds(f),o=this._setSwimlaneSize(n,r,o),t.datavisualization.Diagram.containerCommon._removeObject(n,f),s==="horizontal"?(u.maxHeight=i.phaseSize,u.minWidth=10):(u.minHeight=10,u.maxWidth=i.phaseSize),r.children.splice(1,0,u),this._setPhaseValues(n,r,o),t.datavisualization.Diagram.ContainerHelper._initContainer(n,r)},_setSwimlaneSize:function(n,t,i){var f,r,u;if(t.orientation==="horizontal"){if(t.width>i.width){for(r=t.children[1].children,u=0;u<r.length;u++)r[u].minWidth=t.width;i.width=t.width}t.height>i.height&&(r=t.children[1].children,f=r[r.length-1],f.minHeight+=t.height-i.height,i.height=t.height)}else if(t.width>i.width&&(r=t.children[1].children,f=r[r.length-1],f.minWidth+=t.width-i.width,i.height=t.height),t.height>i.height){for(r=t.children[1].children,u=0;u<r.length;u++)r[u].minHeight=t.height-2*t.children[0].height;i.height=t.height}return i},_setPhaseValues:function(n,t,i){var f=t.children[1].children,u=f[f.length-1],c=t.orientation,s,h,o,e,r;if(c==="horizontal")if(u.offset<=i.width)for(f.length==1?(u.offset=i.width,u.width=i.width):(h=f[f.indexOf(u)-1],u.offset=i.width,u.width=i.width-h.offset),e=t.children[2].children,r=0;r<e.length;r++)e[r].minWidth=u.offset;else{for(o=0,r=0;r<f.length;r++)f[r].offset>=o&&(o=f[r].offset);for(e=t.children[2].children,r=0;r<e.length;r++)e[r].minWidth=o}else if(s=t.children[0],u.offset<=i.height-s.height)for(f.length==1?(u.offset=i.height-s.height,u.height=u.offset):(h=f[f.indexOf(u)-1],u.offset=i.height-s.height,u.height=i.height-h.offset-s.height),e=t.children[2].children,r=0;r<e.length;r++)e[r].minHeight=u.offset;else{for(o=0,r=0;r<f.length;r++)f[r].offset>=o&&(o=f[r].offset);for(e=t.children[2].children,r=0;r<e.length;r++)e[r].minHeight=o}},_createSwimlaneHeader:function(n,i){var r=i.header,u=i.lanes[0]._laneHeader?i.lanes[0]._laneHeader:null,f=t.datavisualization.Diagram.Node({_type:"node",_hidePorts:!0,_isHeader:!0,name:i.name+"_header_swimlane",labels:[r],height:r.height?r.height:50,width:r.width?r.width:50,fillColor:i.header.fillColor?i.header.fillColor:u?u.fillColor:"white",rotateAngle:0,constraints:t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,horizontalAlign:"stretch",parent:i.name});return n._isLoad&&(f.fillColor=i.header.fillColor),f},_updateSwimlane:function(n,i){this._updateLaneStack(n,i);this._updatePhaseStack(n,i);t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,i)},_updateLaneStack:function(n,t){for(var r,f,e=this.getLanes(n,t),i,u=0;u<e.length;u++)if(i=n.nameTable[n._getChild(e[u])],i){for(r=1;r<i.children.length;r++)f=typeof i.children[r]=="string"?n.nameTable[i.children[r]]:i.children[r],f.marginBottom=f.marginRight=0;this._updateLane(n,i)}},_updatePhaseStack:function(n,i){var r=n.nameTable[n._getChild(i.children[1])];t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r)},_updateLane:function(n,i){t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,i)},getPhases:function(n,t,i){var u,r;if(t&&(t.children[1]&&(u=i?i[n._getChild(t.children[1])]:n.nameTable[n._getChild(t.children[1])]),u&&(r=n._getChildren(u.children),r&&r.length>0)))return r},getLanes:function(n,t){var r,i;return t&&t.children[2]&&(r=n.nameTable[n._getChild(t.children[2])]),r&&(i=r.children,i&&i.length>0)?i:void 0},_updateLanesMinValue:function(n,t,i,r){for(var e=this.getLanes(n,t),u,f=0;f<e.length;f++)u=n.nameTable[n._getChild(e[f])],u&&(u[i]=r)},_resizeLastPhase:function(){},_getPhaseBounds:function(n,i){var r=null,u,l,o,f=0,h=0,s=0,c=0,e,a,v,y;return i&&i.type=="phase"&&i.parent&&(e=this._getPrevPhase(n,i),a=this._getNextPhase(n,i),u=n.nameTable[i.parent.split("phaseStack")[0]],u&&u.orientation&&(r=t.datavisualization.Diagram.Util.bounds(u),u.orientation=="horizontal"?(o=this._getPrevOffset(n,i,e,a,u,r),e&&e.name===i.name?(f=o.left+r.left,h=f+(i.offset-f-o.left)):(e&&(f=r.left+e.offset),h=i.offset-f+r.left),s=o.top+r.top,c=r.bottom-s,l=t.datavisualization.Diagram.Rectangle(f,s,h,c)):(o=this._getPrevOffset(n,i,e,a,u,r),e===i?(f=o.left+r.left,c=i.offset+s,s=o.top+r.top):(v=typeof u.children[0]=="string"?n.nameTable[u.children[0]]:n.nameTable[u.children[0].name],y=v?v.height:0,f=o.left+r.left,e&&(s=e.offset+r.top+y),c=r.top+i.offset-s+y),h=r.right-f,l=t.datavisualization.Diagram.Rectangle(f,s,h,c)))),l},_getPrevPhase:function(n,i){var f=null,u,e=n.nameTable[i.parent.split("phaseStack")[0]],r=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,e);return e&&r&&r.length>0&&(u=this._getPhaseIndex(n,i.name),f=u===0?n.nameTable[r[0]]:n.nameTable[r[u-1]]),f},_getPrevOffset:function(n,t,i,r,u){var f,e,h=0,c=0,s,o;return u.children[0]&&(s=n.nameTable[n._getChild(u.children[0])],s&&(c=s.height)),u.orientation=="horizontal"&&(u.children[2]&&(f=n.nameTable[n._getChild(u.children[2])]),f&&f.children&&f.children.length>0&&(e=n.nameTable[n._getChild(f.children[0])],e&&e.children&&e.children.length>0&&(o=n.nameTable[n._getChild(e.children[0])],o&&o.name.indexOf("_Headerr")!=-1&&(h=o.width)))),{left:h,top:c}},_getNextPhase:function(n,i){var f=null,u,e=n.nameTable[i.parent.split("phaseStack")[0]],r=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,e);return e&&r&&r.length>0&&(u=n._getPhaseIndex(i.name),f=u===r.length-1?n.nameTable[r[u]]:n.nameTable[r[u+1]]),f},_getPhaseIndex:function(n,i){var r,f,e=-1,u;return r=n.nameTable[i],r&&r.parent&&(f=n.nameTable[r.parent.split("phaseStack")[0]],u=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,f),u&&u.length>0&&(e=u.indexOf(i))),e},_cloneLaneObj:function(t,i,r,u){var s=u?u:t.nameTable,e,o,f;if(i=n.extend(!0,{},i),e=i.children,e&&e.length>0)for(o=0;o<e.length;o++)f=s[t._getChild(e[o])],f&&(f=jQuery.extend(!0,{},f),f&&f.children&&f.children.length&&(f=t._cloneLaneObj(f,r,u)),f.name+=r,f.parent=r,i.children[o]=f,u&&t._preserveConnection(u,f));return i&&i.header&&(i.header.name+=r),i.name+=r,i},_cloneSwimlaneObj:function(t,i,r,u){var f;if(i=n.extend(!0,{},i),i&&i.isSwimlane){if(i=jQuery.extend(!0,{},i),i.name+=r,i.lanes&&i.lanes.length>0)for(f=0;f<i.lanes.length;f++)i.lanes[f]&&(i.lanes[f]=t._cloneLaneObj(i.lanes[f],r,u&&u.childTable?u.childTable:null));if(i.phases&&i.phases.length>0)for(f=0;f<i.phases.length;f++)i.phases[f]&&(i.phases[f].name+=r,i.phases[f].parent="")}return i},_pasteSwimlaneObj:function(n,i,r){i=n._pasteSwimlane(i,r);var u=n._pasteIndex*10;return n._translate(i,u,u,n.nameTable),t.datavisualization.Diagram.DiagramContext.update(i,n),i},_pasteSwimlane:function(n,i,r){if(n._pasteObj=!0,i&&i.isSwimlane){var u=n._cloneSwimlaneObj(n._getNode(i.name,r?r.childTable:null),n._swimlanePaste?"":t.datavisualization.Diagram.Util.randomId(),r);return u=t.datavisualization.Diagram.ContainerHelper._initContainer(n,u,r),n.add(u),n._pasteObj=!1,u}},_updateNextPhase:function(n,i,r,u){for(var o=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i),f,e=u+1;e<o.length;e++)f=n.nameTable[n._getChild(o[e])],f&&(f.offset+=r)},_getOuterNodes:function(n,i,r,u){for(var f,e,o,l,h=[],c=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(n,i),a=i.orientation==="horizontal"?"left":"top",v=i.orientation==="horizontal"?r:u,s=0;s<c.length;s++)if(f=n.nameTable[n._getChild(c[s])],f&&f.children.length>1)for(e=0;e<f.children.length;e++)o=n.nameTable[n._getChild(f.children[e])],o&&(l=t.datavisualization.Diagram.Util.bounds(o),l[a]>v&&h.push(o));return h},_getInnerNodes:function(n,i,r,u){for(var f,e,o,h,c=[],l=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(n,i),a=i.orientation==="horizontal"?"left":"top",v=i.orientation==="horizontal"?"right":"bottom",s=0;s<l.length;s++)if(f=n.nameTable[n._getChild(l[s])],f&&f.children.length>1)for(e=0;e<f.children.length;e++)o=n.nameTable[n._getChild(f.children[e])],o&&(h=t.datavisualization.Diagram.Util.bounds(o),h[a]>=r&&h[v]<=u&&c.push(o));return c},_moveOuterNodes:function(n,i,r,u){var v=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i),s=n.nameTable[n._getChild(v[u])],h=t.datavisualization.Diagram.Util.bounds(i),y=n.nameTable[n._getChild(i.children[0])],c=h.left+s.offset,l=h.top+s.offset+y.height,a=i.orientation==="horizontal"?"offsetX":"offsetY",w=i.orientation==="horizontal"?c:l,p=i.orientation==="horizontal"?"marginLeft":"marginTop",f=n._getOuterNodes(i,c,l),e,o;if(f&&f.length>0)for(e=0;e<f.length;e++)o=n.nameTable[n._getChild(f[e])],n._translate(o,a==="offsetX"?r:0,a==="offsetY"?r:0,n.nameTable),o[p]+=r},_moveOnPhaseChange:function(n,i,r){var u,s=i.parent.split("phaseStack")[0],f,o,h,e;if(s&&(f=n.nameTable[s]),f){for(o=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(n,f),h=n.nameTable[n._getChild(f.children[0])],e=0;e<o.length;e++)u=n.nameTable[n._getChild(o[e])],u&&(i.orientation==="horizontal"?(u.width+=r,u.minWidth=u.width):(u.height+=r,u.minHeight=u.height));i.orientation==="horizontal"?f.minWidth+=r:f.minHeight=u.height;t.datavisualization.Diagram.SwimLaneContainerHelper._updateSwimlane(n,f)}},_getPhaseDifferece:function(n,i,r,u){var p=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i),f=n.nameTable[n._getChild(p[r])],e=t.datavisualization.Diagram.Util.bounds(i),y=i.orientation==="horizontal"?"left":"top",v=n.nameTable[n._getChild(i.children[0])],c=0,a,s,l,o,h;return i.orientation==="vertical"&&(c=v.height),r===0?(s=n._getInnerNodes(i,e[y]+c,e[y]+f.offset+c),s&&s.length>0?(l=t.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup",children:s}),t.datavisualization.Diagram.Util._updateGroupBounds(l,n),o=t.datavisualization.Diagram.Util.bounds(l)):(o=t.datavisualization.Diagram.Util.bounds(),o.right=e.left+50),i.orientation==="horizontal"?(e.left+(f.offset+u)>=o.right+20||(h=o.right+20-(e.left+(f.offset+u)),u=u+h),f.offset+u<100&&(u=0)):(e.top+v.height+(f.offset+u)>=o.bottom+20||(h=o.bottom+20-(e.top+c+(f.offset+u)),u=u+h),f.offset+u<100&&(u=0))):(a=n.nameTable[n._getChild(p[r-1])],s=n._getInnerNodes(i,e[y]+a.offset+c,e[y]+f.offset+c),s&&s.length>0?(l=t.datavisualization.Diagram.Group({name:"multipleSelection",type:"pseudoGroup",children:s}),t.datavisualization.Diagram.Util._updateGroupBounds(l,n),o=t.datavisualization.Diagram.Util.bounds(l)):(o=t.datavisualization.Diagram.Util.bounds(),o.bottom=e.top+v.height+a.offset),i.orientation==="horizontal"?e.left+(f.offset+u)>=o.right+20||(h=o.right+20-(e.left+(f.offset+u)),u=u+h):e.top+v.height+(f.offset+u)>=o.bottom+20||(h=o.bottom+20-(e.top+v.height+(f.offset+u)),u=u+h)),a&&f.offset-a.offset+u<20&&(u-=f.offset-a.offset+u-20),u}};t.datavisualization.Diagram.ContainerHelper={_initContainer:function(n,i){if(i.container)switch(i.container.type){default:case"canvas":i=t.datavisualization.Diagram.canvasHelper._initCanvas(n,i);break;case"stack":i=t.datavisualization.Diagram.stackHelper._initStack(n,i)}else(i.type==="swimlane"||i.isSwimlane)&&(i=t.datavisualization.Diagram.SwimLaneContainerHelper._initSwimLane(n,i),i=t.datavisualization.Diagram.SwimLaneContainerHelper._createSwimlane(n,i));return i},_add:function(n,i){var r,u,e,f;if(n.getObjectType(i)!=="connector"&&(r=i.parent?n.nameTable[i.parent]:null,r&&r.container)){for(u=r.children.length-1;u>=0;u--)e=n.nameTable[n._getChild(r.children[u])],e.name===i.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(r.children,r.children[u]);r.children.push(i.name);n._disableSwimlaneUptate=!0;t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(n);this._updateCollectionChange(n,r,!0);delete n._disableSwimlaneUptate;t.datavisualization.Diagram.canvasHelper._updateLastSwimlanePhase(n,i);f=n._svg.document.getElementById(i.parent);i._type==="group"?t.datavisualization.Diagram.DiagramContext.renderGroup(i,n,f):t.datavisualization.Diagram.DiagramContext.renderNode(i,n,f);t.datavisualization.Diagram.canvasHelper._enableConnectorUpdateNode(n,i)}},_updateCollectionChange:function(n,i,r,u){var f,e,o,s,h;n._diagramClear||(o=!0,i&&(s=t.datavisualization.Diagram.Util.bounds(i),f={x:s.x,y:s.y},i.container&&(i.container.type==="canvas"?t.datavisualization.Diagram.canvasHelper._updateCollectionChange(n,i):t.datavisualization.Diagram.stackHelper._updateCollectionChange(n,i,null,u)),(r&&!i.isLane||i.isSwimlane)&&(n._disableSwimlaneUptate&&(o=!1),h=t.datavisualization.Diagram.Util.bounds(i),e={x:h.x,y:h.y},n._translate(i,f.x-e.x,f.y-e.y,n.nameTable),o&&t.datavisualization.Diagram.DiagramContext.update(i,n))),!i||!i.container||i.isLane||i.isSwimlane||i.isLaneStack||i.isPhaseStack||t.datavisualization.Diagram.DiagramContext.update(i,n))}};t.datavisualization.Diagram.stackHelper={_initStack:function(n,i){return i=t.datavisualization.Diagram.Group(i),i=this._initGroupNode(n,i),i=this._initChildren(n,i),this._setSize(n,i),this._alignChildren(n,i),i},_initGroupNode:function(n,i){return t.datavisualization.Diagram.containerCommon._initGroupNode(n,i)},_initChildren:function(n,i){return t.datavisualization.Diagram.containerCommon._initChildren(n,i)},_setSize:function(n,t){var i=this._getStackBoundsBounds(n,t);i.width>=t.minWidth&&i.width<=t.maxWidth?t.width=i.width:i.width<=t.minWidth?t.width=t.minWidth:i.width>=t.maxWidth&&(t.width=t.maxWidth);i.height>=t.minHeight&&i.height<=t.maxHeight?t.height=i.height:i.height<=t.minHeight?t.height=t.minHeight:i.height>=t.maxHeight&&(t.height=t.maxHeight)},_getStackBoundsBounds:function(n,i){var f=t.datavisualization.Diagram.Rectangle(),e,u,r,c=0,l=0,s=0,h=0,a=i.container.orientation?i.container.orientation:"vertical",o;if(i.children&&i.children.length>0)for(o=i.children,e=0;e<o.length;e++)u=typeof o[e]=="string"?n.nameTable[o[e]]:o[e],u&&(r=t.datavisualization.Diagram.Util.bounds(u),r=t.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),r&&(a==="vertical"?(l=r.width+=u.marginLeft+u.marginRight,l>s&&(s=r.width=l),r.width=u.horizontalAlign==="stretch"?r.width>u.minWidth?r.width:s:s,r.height+=u.marginTop+u.marginBottom,r.height+=f.height):(c=r.height+=u.marginTop+u.marginBottom,c>h&&(h=r.height=c),r.height=u.verticalAlign==="stretch"?r.height>u.minHeight?r.height:h:h,r.width+=u.marginLeft+u.marginRight,r.width+=f.width),r.x=0,r.y=0),f=n._union(f,r));return f.width+=i.paddingLeft+i.paddingRight,f.height+=i.paddingTop+i.paddingBottom,f},_alignChildren:function(n,t){for(var f,i,e=0,o=0,u=t.children,r=0;r<u.length;r++)i=typeof u[r]=="string"?n.nameTable[u[r]]:u[r],i&&(f=this._getStackPosition(n,i,t,e,o),this._translate(n,i,f.x,f.y),t.container.orientation=="vertical"?o+=(i.height?i.height:i._height)+i.marginTop+i.marginBottom:e+=(i.width?i.width:i._width)+i.marginLeft+i.marginRight)},_getStackPosition:function(n,i,r,u,f){var s=0,h=0,e=t.datavisualization.Diagram.Util.bounds(r),o=t.datavisualization.Diagram.Util.bounds(i),y=r.container.orientation?r.container.orientation:"vertical",a=i.width?i.width:i._width,v=i.height?i.height:i._height,c,l;if(r.container.orientation=="vertical"){h=e.y-o.y+f+i.marginTop+r.paddingTop;switch(i.horizontalAlign){case"left":s=e.x-o.x+i.marginLeft+r.paddingLeft;break;case"center":s=e.center.x-o.center.x;break;case"right":s=e.x+e.width-(o.x+o.width+r.paddingRight);break;case"stretch":c=(r.width-(r.paddingLeft+r.paddingRight)-(i.marginLeft+i.marginRight))/a;n.scale(i,c,1,r.pivot,n.nameTable);e=t.datavisualization.Diagram.Util.bounds(r);o=t.datavisualization.Diagram.Util.bounds(i,n);s=e.x+r.paddingLeft+i.marginLeft-o.x}}else{s=e.x-o.x+u+i.marginLeft+r.paddingLeft;switch(i.verticalAlign){case"top":h=e.y-o.y+i.marginTop+r.paddingTop;break;case"center":h=e.center.y-o.center.y;break;case"bottom":h=e.y+e.height-(o.y+o.height+r.paddingBottom);break;case"stretch":l=(r.height-(r.paddingTop+r.paddingBottom)-(i.marginTop+i.marginBottom))/v;n.scale(i,1,l,r.pivot,n.nameTable);e=t.datavisualization.Diagram.Util.bounds(r);o=t.datavisualization.Diagram.Util.bounds(i,n);h=e.y+r.paddingTop+i.marginTop-o.y}}return{x:s,y:h}},_translate:function(n,i,r,u){var f,o,e;if(r||u)if(i.segments)t.datavisualization.Diagram.Util._translateLine(i,r,u,i);else{if(i.offsetX+=r,i.offsetY+=u,i._type==="group"||i.type==="pseudoGroup"||i.type=="umlclassifier")for(f=i.children,e=0;f&&e<f.length;e++)o=n.nameTable[n._getChild(f[e])],o&&this._translate(n,o,r,u);t.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(i,r,u,null,n)}},_updateCollectionChange:function(n,i,r,u){if(this._setSize(n,i),this._alignChildren(n,i),i.parent){var f=n.nameTable[i.parent];f||u&&i.isPhaseStack&&(f=u);f&&f.container&&!r&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,f)}}};t.datavisualization.Diagram.canvasHelper={_initCanvas:function(n,i){return i._type="group",i.type="group",i=t.datavisualization.Diagram.Group(i),i=this._initGroupNode(n,i),i=this._initChildren(n,i),this._setSize(n,i),this._alignChildren(n,i),i},_initGroupNode:function(n,i){return t.datavisualization.Diagram.containerCommon._initGroupNode(n,i)},_initChildren:function(n,i){return t.datavisualization.Diagram.containerCommon._initChildren(n,i)},_setSize:function(n,t){var i=this._getCanvasBounds(n,t);i.width>=t.minWidth&&i.width<=t.maxWidth?t.width=i.width:i.width<=t.minWidth?t.width=t.minWidth:i.width>=t.maxWidth&&(t.width=t.maxWidth);i.height>=t.minHeight&&i.height<=t.maxHeight?t.height=i.height:i.height<=t.minHeight?t.height=t.minHeight:i.height>=t.maxHeight&&(t.height=t.maxHeight)},_alignChildren:function(n,t){for(var f,i,e=!0,u=t.children,r=0;r<u.length;r++)i=typeof u[r]=="string"?n.nameTable[u[r]]:u[r],i&&(n._disablePhaseUpdate&&i.isPhaseStack&&(e=!1),e&&(f=this._getCanvasPosition(n,i,t),this._translate(n,i,f.x,f.y)))},_translate:function(n,i,r,u){var e,o,f;if(r||u)if(i.segments)t.datavisualization.Diagram.Util._translateLine(i,r,u,i);else{if(i.offsetX+=r,i.offsetY+=u,i._type==="group"||i.type==="pseudoGroup")for(e=i.children,f=0;f<e.length;f++)o=n.nameTable[n._getChild(e[f])],o&&this._translate(n,o,r,u);t.datavisualization.Diagram.DefautShapes.translateBPMNAnnotationShape(i,r,u,null,n)}},_getCanvasPosition:function(n,i,r){var e=0,o=0,u=t.datavisualization.Diagram.Util.bounds(r),f=t.datavisualization.Diagram.Util.bounds(i),s,h;switch(i.horizontalAlign){case"left":e=u.x-f.x+i.marginLeft+r.paddingLeft;break;case"center":e=u.x+u.width/2-(f.x+f.width/2)+i.marginLeft+r.paddingLeft;break;case"right":e=u.x+u.width-i.marginRight-(f.x+f.width+r.paddingRight);break;case"stretch":s=(u.width-r.paddingLeft-r.paddingRight-i.marginLeft-i.marginRight)/i.width;n.scale(i,s,0,r.pivot,n.nameTable);f=t.datavisualization.Diagram.Util.bounds(i,n);e=u.x+r.paddingLeft-f.x+i.marginLeft}switch(i.verticalAlign){case"top":o=u.y-f.y+i.marginTop+r.paddingTop;break;case"center":o=u.y+u.height/2-(f.y+f.height/2)+i.marginTop+r.paddingTop;break;case"bottom":o=u.y+u.height-i.marginBottom-(f.y+f.height+r.paddingBottom);break;case"stretch":h=(u.height-r.paddingTop-r.paddingBottom-i.marginTop-i.marginBottom)/i.height;n.scale(i,0,h,r.pivot,n.nameTable);f=t.datavisualization.Diagram.Util.bounds(i,n);o=u.y+r.paddingTop-f.y+i.marginTop}return{x:e,y:o}},_getCanvasBounds:function(n,i){var e=t.datavisualization.Diagram.Rectangle(),f=0,u,r,o;if(i.children&&i.children.length>0)for(o=i.children;f<o.length;f++)u=typeof o[f]=="string"?n.nameTable[o[f]]:o[f],r=t.datavisualization.Diagram.Util.bounds(u),r=t.datavisualization.Diagram.Geometry.rect([r.topLeft,r.topRight,r.bottomRight,r.bottomLeft]),u&&(u.horizontalAlign==="stretch"&&(r.width=r.width>=i.minWidth?r.width:1,(i.isLane||i.isSwimlane)&&f==0&&(r.width=1)),u.verticalAlign==="stretch"&&(r.height=r.height>=i.minHeight?r.height:1,i.isLane&&f==0&&(r.height=1)),r&&(r.width+=u.marginLeft+u.marginRight,r.height+=u.marginTop+u.marginBottom,r.x=0,r.y=0)),e=n._union(e,r);return e.width+=i.paddingLeft+i.paddingRight,e.height+=i.paddingTop+i.paddingBottom,e},_updateCollectionChange:function(n,i){if(this._setSize(n,i),this._alignChildren(n,i),i.parent){var r=n.nameTable[i.parent];r&&r.container&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r)}},_getSwimlane:function(n,t){var i=n.nameTable[t],r,u;if(i&&i.isLane&&(r=n.nameTable[i.parent],r&&(u=n.nameTable[r.parent],u)))return n.getNode(u.name)},_swapLane:function(i,r,u,f,e){var c=i.nameTable[f],o=i.tools.move,l=this._getSwimlane(i,u),v,y;if(o._undoObject=n.extend(!0,{},{name1:u,name2:f}),c){var h=t.datavisualization.Diagram.Util.bounds(c),a=r.indexOf(u),s=r.indexOf(f);r.splice(r.indexOf(u),1);s+=a>s?0:-1;s+=e?o.currentPoint.y>=h.y&&o.currentPoint.y<h.center.y?0:1:o.currentPoint.x>=h.x&&o.currentPoint.x<h.center.x?0:1;r.splice(s,0,u)}o._redoObject=n.extend(!0,{},{name1:f,name2:u});v={type:"swapLane",undoObject:jQuery.extend(!0,{},o._undoObject),redoObject:jQuery.extend(!0,{},o._redoObject),currentIndex:a,moveIndex:s,category:"internal"};y=this._getSwimlane(i,u);l&&i._comparePropertyValues(y,"lanes",{lanes:l.lanes},!0);i.addHistoryEntry(v);o._multipleUndo=!0},_updateHelper:function(n){n.activeTool.helper?(this._updateHelperXY(n,n.activeTool.helper,n.activeTool.previousPoint,n.activeTool.currentPoint),t.datavisualization.Diagram.SvgContext._updateContainerHelper(n)):this._initHelper(n)},_updateHelperXY:function(n,i,r,u){var h=u.x<r.x,c=u.y<r.y,e=n.activeTool.diffx+(u.x-r.x),o=n.activeTool.diffy+(u.y-r.y),f,l=n.activeTool.diagram._enableSnapToObject(),s;n.activeTool.diagram._enableSnapToObject(!0);f=t.datavisualization.Diagram.SnapUtil._snapPoint(n,n.activeTool.helper,h,c,t.datavisualization.Diagram.Point(e,o),u,r);n.activeTool.diagram._enableSnapToObject(l);f||(f=t.datavisualization.Diagram.Point(e,o));n.activeTool.diffx=e-f.x;n.activeTool.diffy=o-f.y;t.datavisualization.Diagram.Geometry.isEmptyPoint(f)||(s=n.activeTool._raiseDragEvent({element:n.getNode(n.activeTool.helper),offset:f,cancel:!1}),s.cancel||(n.activeTool._outOfBoundsDrag(i,f.x,f.y)&&n._translate(i,f.x,f.y,n.nameTable),i._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(i,n)))},_initHelper:function(n){n.activeTool.helper=this._getCloneNode(n.activeTool.selectedObject);n.activeTool.helper._name=n.activeTool.selectedObject.name;n.activeTool.helper.name="helper";n.activeTool.startPoint=n.activeTool.currentPoint;t.datavisualization.Diagram.SvgContext._drawContainerHelper(n)},_getCloneNode:function(n){var t=null;return t=jQuery.extend(!0,{},n),t.children=[],t.minHeight=0,t.minWidth=0,t.maxHeight=0,t.maxWidth=0,t},_updateHighlighter:function(n,t){var i=n.activeTool._getMouseOverElement(t);i&&!i.segments&&(!n.activeTool.selectedObject.isLane||i.isLane)?n.activeTool._nodeHighLighter(i,t):n.activeTool._removeHighLighter()},_updateNodeMargin:function(i,r,u){var h,c,a,o,s;if(r&&u){if(r._type=="group")for(h=0;h<r.children.length;h++)c=r.children[h],this._updateNodeMargin(i,typeof c=="string"?i.nameTable[c]:c,u);var l=n.extend(!0,{},r),f=t.datavisualization.Diagram.Util.bounds(r),e=t.datavisualization.Diagram.Util.bounds(u),y=u.container&&u.container.type&&u.container.type=="stack"?!0:!1;y?u.container.orientation==="horizontal"?r.marginTop=f.top-e.top-u.paddingTop:r.marginLeft=f.left-e.left-u.paddingLeft:(r.marginLeft=f.left-e.left-u.paddingLeft,r.marginTop=f.top-e.top-u.paddingTop);var p=f.right-f.left,w=f.bottom-f.top,v=e.x+e.width-(f.x+p)-u.paddingRight;r.marginRight=v<0?0:v;a=e.y+e.height-(f.y+w)-u.paddingBottom;r.marginBottom=a<0?0:a;u.isLane&&(o=0,s=0,u.orientation==="horizontal"?(o=50,s=0):(o=0,s=50),r.marginLeft=r.marginLeft>=o?r.marginLeft:o,r.marginTop=r.marginTop>=s?r.marginTop:s,i._comparePropertyValues(r,"marginLeft",{marginLeft:l.marginLeft},!0),i._comparePropertyValues(r,"marginRight",{marginLeft:l.marginRight},!0),i._comparePropertyValues(r,"marginBottom",{marginLeft:l.marginBottom},!0),i._comparePropertyValues(r,"marginRight",{marginLeft:l.marginRight},!0))}},_singleNodedrag:function(i,r,u){var o=!i.activeTool._checkForDropEvent(u),f,e;return o&&(u?(t.datavisualization.Diagram.Util.canAllowDrop(u)||u.name==i.activeTool.selectedObject.parent)&&u.container&&u.container.type=="canvas"&&(t.datavisualization.Diagram.canvasHelper._outOfBoundaryNodeDrop(i,i.activeTool.helper,u)?(u.isLane&&this._disableConnectorUpdate(i),i.activeTool.seletedObject=i.nameTable[i.activeTool.selectedObject.name],i.activeTool.selectedObject.parent&&(f=i.nameTable[i.activeTool.selectedObject.parent]),i._disablePhaseUpdate=!0,i._disableSwimlaneUptate=!0,this._removeNodeFromContainer(i,i.activeTool.selectedObject),this._addNodeToContainer(i,i.activeTool.selectedObject,u,null,!0),i._raiseGroupChangeEvent(i.activeTool.selectedObject,f,u,"group"),i._comparePropertyValues(i.activeTool.selectedObject,"parent",{parent:f.name},!0),delete i._disablePhaseUpdate,delete i._disableSwimlaneUptate,this._updateLastSwimlanePhase(i,i.activeTool.selectedObject),u.isLane&&this._enableConnectorUpdateNode(i,i.activeTool.selectedObject)):(i._translate(i.activeTool.selectedObject,i.activeTool.undoObject.node.offsetX-i.activeTool.selectedObject.offsetX,i.activeTool.undoObject.node.offsetY-i.activeTool.selectedObject.offsetY,i.nameTable),i._updateAssociatedConnectorEnds(i.activeTool.selectedObject,i.nameTable))):(e=n.extend(!0,{},i.activeTool.selectedObject),i.activeTool.selectedObject.type!="pseudoGroup"&&this._disableConnectorUpdate(i),i.activeTool.selectedObject.parent&&(f=i.nameTable[i.activeTool.selectedObject.parent]),this._removeNodeFromContainer(i,i.activeTool.selectedObject),i._raiseGroupChangeEvent(i.activeTool.selectedObject,f,null,"group"),this._addMultiNodeToDiagram(i,i.activeTool.selectedObject),this._enableConnectorUpdateNode(i,e),i._updateAssociatedConnectorEnds(e,i.nameTable))),!0},_updateLastSwimlanePhase:function(n,t){var i,r,u;t&&t.parent&&(i=n.nameTable[t.parent],i&&i.isLane&&(r=n.nameTable[i.parent],r&&(u=n.nameTable[r.parent],u&&this._updateLastPhase(n,u))))},_updateLastPhase:function(n,i){var f,r;if(i&&i.isSwimlane){var h=n.nameTable[n._getChild(i.children[2])],c=n.nameTable[n._getChild(i.children[1])],o=t.datavisualization.Diagram.stackHelper._getStackBoundsBounds(n,h),s=t.datavisualization.Diagram.stackHelper._getStackBoundsBounds(n,c),e=t.datavisualization.Diagram.SwimLaneContainerHelper.getPhases(n,i),l=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(n,i),u;u=n.nameTable[l[0]];e.length>0&&(f=n.nameTable[e[e.length-1]],f&&(i.orientation==="horizontal"?(r=o.width-s.width,f.width+=r,f.offset+=r,u&&u.isLane&&(u.minWidth+=r)):(r=o.height-s.height,f.height+=r,f.offset+=r,u&&u.isLane&&(u.minHeight+=r))),t.datavisualization.Diagram.SwimLaneContainerHelper._updatePhaseStack(n,i))}},_disableConnectorUpdate:function(n){n._disableSegmentChange=!0},_enableConnectorUpdate:function(n,t,i){delete n._disableSegmentChange;t&&(n._updateChildAdjacentConnectors(t,!0),i||(n._disableSegmentChange=!0,this._updateSwimalneAssociatedConnectors(n,t,n._svg),delete n._disableSegmentChange),this._updateChildAdjacentConnectors(n,t))},_updateChildAdjacentConnectors:function(n,i){var f=n._getChildTable(i,{}),u,r;for(u in f)r=n.nameTable[u],r&&r.segments&&i.children.indexOf(u)==-1&&t.datavisualization.Diagram.DiagramContext.update(r,n)},_updateSwimalneAssociatedConnectors:function(n,i,r,u){var e=n._getChildren(i.children),o,s,f;if(e&&e.length>0)for(o=0,s=e.length;o<s;o++)f=n.nameTable[e[o]],f&&(f._type==="group"?this._updateSwimalneAssociatedConnectors(n,f,r,u):this._updateSwimalneAssociatedConnectors(n,f,r,u));i.type!="group"&&t.datavisualization.Diagram.SvgContext._updateAssociatedConnector(i,r,n)},_enableConnectorUpdateNode:function(n,t){var i=null,r;t&&t.parent&&(i=n.nameTable[t.parent]);i&&i.isLane&&(r=n.nameTable[i.parent.split("laneStack")[0]],r&&r.isSwimlane&&this._enableConnectorUpdate(n,r))},_enableConnectorUpdatePhase:function(n,t){var i=null,r;t&&t.parent&&(i=n.nameTable[t.parent]);i&&i.isPhase&&(r=n.nameTable[i.parent.split("phaseStack")[0]],r&&r.isSwimlane&&this._enableConnectorUpdate(n,r))},_enableConnectorUpdateLane:function(n,t){if(t&&t.isLane){var i=n.nameTable[t.parent.split("laneStack")[0]];i&&i.isSwimlane&&this._enableConnectorUpdate(n,i)}},_outOfBoundaryMultiNodeDrop:function(n,i){var r,u,e,o,f;if(t.datavisualization.Diagram.Util.canMoveOutofBoundary(n)&&i&&i.type==="pseudoGroup")for(o=i.children,f=0;f<o.length;f++)if(r=n.nameTable[n._getChild(o[f])],u=this._getTargets(n,r),u&&u.length>0&&(e=this._getContainerFromTarget(n,u,r),e))return this._isExeedBounds(n,r,e);return!0},_multiNodedrag:function(n,i,r){var u,e,c,l,o,s,h,f,a;if(this._outOfBoundaryMultiNodeDrop(n,r)){if(r){if(n._disableSwimlaneUptate=!0,this._disableConnectorUpdate(n),r.children.length>0)for(l=r.children,o=0;o<l.length;o++)u=n.nameTable[n._getChild(l[o])],e=this._getTargets(n,u),e&&e.length>0?(c=this._getContainerFromTarget(n,e,u),c?this._addNodeToContainer(n,u,c):this._addMultiNodeToDiagram(n,u)):this._addMultiNodeToDiagram(n,u),u.parent&&(s=n.nameTable[u.parent],s&&s.isLane&&(h=n.nameTable[s.parent.split("laneStack")[0]],h&&(n._updateSwimlanes||(n._updateSwimlanes=[]),n._collectionContains(h.name,n._updateSwimlanes)||n._updateSwimlanes.push(h.name))));if(delete n._disableSwimlaneUptate,n._updateSwimlanes&&n._updateSwimlanes.length>0)for(f=0;f<n._updateSwimlanes.length;f++)t.datavisualization.Diagram.DiagramContext.update(n.nameTable[n._updateSwimlanes[f]],n),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(n,n.nameTable[n._updateSwimlanes[f]]);else delete n._disableSegmentChange;delete n._updateSwimlanes;this._getRedoObject(n,r);a={type:"positionchanged",node:jQuery.extend(!0,{},r),undoObject:jQuery.extend(!0,{},n.activeTool._undoObject),redoObject:jQuery.extend(!0,{},n.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0};n.addHistoryEntry(a);n.activeTool._multipleUndo=!0;t.datavisualization.Diagram.Util._updateGroupBounds(r,n);n.updateSelection()}}else this._updateBoundsExceedNodes(n,r,"move")},_updateBoundsExceedNodes:function(n,i,r){var h=n.tools[r].undoObject,s=i.children,e,f,u,c,o;for(i.rotateAngle=h.node.rotateAngle,e=0;e<s.length;e++)f=h.childTable[s[e]],u=n.nameTable[s[e]],f&&u&&(r==="move"?n._translate(u,f.offsetX-u.offsetX,f.offsetY-u.offsetY,n.nameTable):r==="resize"?(n._translate(u,f.offsetX-u.offsetX,f.offsetY-u.offsetY,n.nameTable),n.scale(u,f.width/u.width,f.height/u.height,t.datavisualization.Diagram.Point(u.offsetX,u.offsetY),n.nameTable)):r==="rotate"&&(n._translate(u,f.offsetX-u.offsetX,f.offsetY-u.offsetY,n.nameTable),c=f.rotateAngle-u.rotateAngle,u.rotateAngle+=c),u._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(u,n),n._updateAssociatedConnectorEnds(f,n.nameTable),f.parent&&(o=n.nameTable[f.parent],o&&o.children.length>0&&(o.children.push(f.name),u.parent=f.parent)),t.datavisualization.Diagram.DiagramContext.update(f,n));t.datavisualization.Diagram.Util._updateGroupBounds(i,n);n.updateSelection()},_getContainerFromTarget:function(n,i,r){for(var f,e,u=0;u<i.length;u++)if(i[u].container&&i[u].container.type==="canvas"&&(f=t.datavisualization.Diagram.Util.bounds(r),e=t.datavisualization.Diagram.Util.bounds(i[u]),f.center.x>e.left&&f.center.x<e.right&&f.center.y>e.top&&f.center.y<e.bottom))return i[u]},_getTargets:function(n,i){var a=null,s,u=[],h,c,f,e,o,r,l,v;if(i)for(s=t.datavisualization.Diagram.Util.bounds(i),c=t.datavisualization.Diagram.SpatialUtil.findQuads(n._spatialSearch,s),f=0;f<c.length;f++)if(e=c[f],e.objects.length>0)for(o=0;o<e.objects.length;o++)if(r=e.objects[o],!r.segments&&r.visible&&(a=t.datavisualization.Diagram.Util.bounds(r),u.indexOf(r)==-1&&t.datavisualization.Diagram.Geometry.intersectsRect(s,a)))if(r.isSwimlane){l=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(n,r);for(v in l)h=n.nameTable[n._getChild(l[v])],h&&u.splice(0,0,h)}else u.push(r);return u},_removeFromParentContainer:function(n,t){this._removeNodeFromContainer(n,t)},_removeNodeFromContainer:function(n,i,r){var s,h,f,o,u,e;if(n._removedFromContiner=!0,i.type!=="pseudoGroup"){if(e=n.nameTable[i.parent],e){for(f=e.children,s=f,s=s.slice(0),o=0;o<f.length;o++)u=n.nameTable[n._getChild(f[o])],u.name===i.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(e.children,f[o]);t.datavisualization.Diagram.SpatialUtil._removeFromaQuad(n._spatialSearch,n._spatialSearch.quadTable[u.name],u);h={element:e,cause:n.activeTool.inAction?t.datavisualization.Diagram.ActionType.Mouse:t.datavisualization.Diagram.ActionType.Unknown,propertyName:"children",oldValue:s,newValue:f};n._raisePropertyChange(h);n._comparePropertyValues(i,"parent",{parent:""},h.cause);i.parent="";u._type==="group"?t.datavisualization.Diagram.SvgContext.renderGroup(u,n._svg,n._diagramLayer,n.nameTable,n):u.segments?t.datavisualization.Diagram.SvgContext.renderConnector(u,n._svg,n._diagramLayer):t.datavisualization.Diagram.SvgContext.renderNode(u,n._svg,n._diagramLayer,undefined,n);r||t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,e,!0)}}else if(f=i.children,f.length>0){for(this._getUndoObject(n,i),o=0;o<f.length;o++)u=n.nameTable[f[o]],u&&this._removeNodeFromContainer(n,u,!0);u.parent&&(e=n.nameTable[u.parent]);e&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,e,!0)}},_addDrgaHistoryEntry:function(n,t){var i={},i=n._getChildTable(t,i),r;n.activeTool._multipleUndo=!0;r={type:"positionchanged",node:jQuery.extend(!0,{},t),childTable:i,category:"internal",swimlaneMultiSelection:!0};n.addHistoryEntry(r)},_cloneNode:function(t,i,r){var f,e,u;if(i){if(i=n.extend(!0,{},i),i.name+=r,i.parent+=r,i.children&&i.children.length>0)for(e=i.children,u=0;u<e.length;u++)f=t.nameTable[t._getChild(e[u])],f&&(i.children[u]=this._cloneNode(t,f,r));return i}},_isExeedBounds:function(n,i,r){var s,o,f,u,e,h,c;if(n._disableUpdateQuad=!0,i&&r&&r.isLane&&(s=n.nameTable[r.parent.split("laneStack")[0]],s)){if(o=t.datavisualization.Diagram.Util.randomId(),f=n._cloneSwimlaneObj(n._getNode(s.name),o),f=t.datavisualization.Diagram.ContainerHelper._initContainer(n,f),u=this._cloneNode(n,i,o),n.nameTable[u.name]=u,e=n.nameTable[r.name+o],e){if((e.children.push(u.name),this._updateNodeMargin(n,u,n.nameTable[r.name+o]),n._disableSwimlaneUptate=!0,this._disableConnectorUpdate(n),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,e),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,f),delete n._disableSegmentChange,delete n._disableSwimlaneUptate,h=t.datavisualization.Diagram.Util.bounds(f),t.datavisualization.Diagram.containerCommon._removeObject(n,e),t.datavisualization.Diagram.containerCommon._removeObject(n,f),delete n._disableUpdateQuad,c=n.activeTool._getPageBounds(),h.bottom>c.height)||h.right>c.width)return!1;e.children.pop(u.name)}n.nameTable[u.name]}return delete n._disableUpdateQuad,!0},_outOfBoundaryNodeDrop:function(n,i,r){return t.datavisualization.Diagram.Util.canMoveOutofBoundary(n)?this._isExeedBounds(n,i,r):!0},_addNodeToContainer:function(i,r,u,f,e){var h,a,o,v,c,l,s,y;if(i.getObjectType(r)!=="connector"&&r&&u&&!r.isPhase)if(r.type!=="pseudoGroup"){var p=t.datavisualization.Diagram.Util.bounds(i.activeTool.helper),w=t.datavisualization.Diagram.Util.bounds(i.activeTool.selectedObject),b=i.activeTool.helper?p.x-w.x:0,k=i.activeTool.helper?p.y-w.y:0;i._raiseOffsetPropertyChange(r,r.offsetX+b,r.offsetY+k,!0);i._translate(r,b,k,i.activeTool.diagram.nameTable);h=u.children;h=h.slice(0);u.children.push(r.name);a={element:u,cause:i.activeTool.inAction?t.datavisualization.Diagram.ActionType.Mouse:t.datavisualization.Diagram.ActionType.Unknown,propertyName:"children",oldValue:h,newValue:u.children};i._raisePropertyChange(a);i._comparePropertyValues(r,"parent",{parent:u.name},a.cause);r.parent=u.name;this._updateNodeMargin(i,r,u);i._isDragg&&(o=i._historyList,o&&o.currentEntry&&o.currentEntry.object&&o.currentEntry.object.parent===""&&(o.currentEntry.object=n.extend(!0,{},r)));v=i._svg.getElementById(u.name);r._type==="group"?t.datavisualization.Diagram.DiagramContext.renderGroup(r,i,v):r.segments||t.datavisualization.Diagram.DiagramContext.renderNode(r,i,v);this._disableConnectorUpdate(i);f||t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,u,!0);this._updateLastSwimlanePhase(i,r);e||this._enableConnectorUpdateNode(i,r);i._findLabelEditing&&u.children.splice(u.children.indexOf(r.name),1)}else if(c=r.children,c.length>0){for(l=0;l<c.length;l++)s=i.nameTable[i._getChild(c[l])],s&&this._addNodeToContainer(i,s,u,!0);s&&s.parent&&(y=i.nameTable[s.parent]);y&&(t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,y,!0),t.datavisualization.Diagram.Util._updateGroupBounds(r,i),t.datavisualization.Diagram.SvgContext.updateSelector(r,i._adornerSvg,i._currZoom,i,i.model.selectedItems.constraints))}},_addMultiNodeToDiagram:function(n,i){var r,u,o;if(n.activeTool.helper){var f=t.datavisualization.Diagram.Util.bounds(n.activeTool.helper),e=t.datavisualization.Diagram.Util.bounds(i),s=n.activeTool.helper?f.x-e.x:0,h=n.activeTool.helper?f.y-e.y:0;n._translate(i,s,h,n.nameTable)}for(r=n.nodes(),u=r.length-1;u>=0;u--)o=n.nameTable[n._getChild(r[u])],i.name===o.name&&t.datavisualization.Diagram.Util.removeItem(r,r[u]);n.nodes().push(i);n._removedFromContiner&&(i._type==="group"?t.datavisualization.Diagram.SvgContext.renderGroup(i,n._svg,n._diagramLayer,n.nameTable,n):i.segments?t.datavisualization.Diagram.SvgContext.renderConnector(i,n._svg,n._diagramLayer):t.datavisualization.Diagram.SvgContext.renderNode(i,n._svg,n._diagramLayer,undefined,n));delete n._removedFromContiner;n.activeTool.helper&&this._updateLastSwimlanePhase(n,n.activeTool.helper)},_singleNodeResize:function(n,t,i){n.activeTool.selectedObject&&this._resizeNode(n,i)},_resizeNode:function(n,i){var r;if(i){var f=t.datavisualization.Diagram.Util.bounds(i),e=t.datavisualization.Diagram.Util.bounds(n.activeTool.helper),u=!0;i.container||(i.parent==""&&i._parent&&(i.parent=i._parent,delete i._parent,u=!1),i.segments||(i.parent&&(r=n.nameTable[i.parent]),r&&r.isLane&&this._disableConnectorUpdate(n),u&&n.activeTool._updateSize(i,n.activeTool.startPoint,n.activeTool.currentPoint),r&&(this._updateNodeMargin(n,i,r),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r,!0),this._updateLastSwimlanePhase(n,i)),this._enableConnectorUpdateNode(n,i)))}},_updateResizeHelper:function(n){var i,r;n.activeTool.helper?(i=t.datavisualization.Diagram.Util.bounds(n.activeTool.helper),n._resizeStack=!0,n.activeTool._updateSize(n.activeTool.helper,n.activeTool.previousPoint,n.activeTool.currentPoint,null,null,null,!0),delete n._resizeStack,r=t.datavisualization.Diagram.Util.bounds(n.activeTool.helper),n.activeTool.selectedObject.container&&n._translate(n.activeTool.helper,i.topLeft.x-r.topLeft.x,i.topLeft.y-r.topLeft.y,n.nameTable),t.datavisualization.Diagram.SvgContext._updateContainerHelper(n)):(n.activeTool.helper=n.activeTool._getCloneNode(n.activeTool.selectedObject),n.activeTool.helper.inEdges=n.activeTool.helper.outEdges=[],n.activeTool.helper.type=null,n.activeTool.helper.name="helper",t.datavisualization.Diagram.SvgContext._drawContainerHelper(n),n.activeTool._startPoint=n.activeTool.currentPoint,n._resizeStack=!0,n.activeTool._updateSize(n.activeTool.helper,n.activeTool.previousPoint,n.activeTool.currentPoint,null,null,null,!0),delete n._resizeStack)},_multiNodeResize:function(n,i,r){var u,f,o,s,e,h;if(r)if(this._outOfBoundaryMultiNodeDrop(n,r)){if(r.children.length>0)for(s=r.children,e=0;e<s.length;e++)u=n.nameTable[n._getChild(s[e])],f=this._getTargets(n,u),f&&f.length>0?(o=this._getContainerFromTarget(n,f,u),o?this._addNodeToContainer(n,u,o):this._addMultiNodeToDiagram(n,u)):this._addMultiNodeToDiagram(n,u);this._getRedoObject(n,r);h={type:"sizechanged",node:jQuery.extend(!0,{},r),undoObject:jQuery.extend(!0,{},n.activeTool._undoObject),redoObject:jQuery.extend(!0,{},n.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0};n.addHistoryEntry(h);n.activeTool._multipleUndo=!0;t.datavisualization.Diagram.Util._updateGroupBounds(r,n);n.updateSelection()}else this._updateBoundsExceedNodes(n,r,"resize")},_singleNodeRotate:function(n,t,i){n.activeTool.selectedObject&&this._rotateNode(n,i)},_rotateNode:function(n,i){var u,r,e,f;i&&(u=!0,i.container||(i.parent==""&&i._parent&&(i.parent=i._parent,delete i._parent,u=!1),i.parent&&(r=n.nameTable[i.parent]),r&&r.isLane&&this._disableConnectorUpdate(n),i.segments||(u&&(e=n.nameTable[n.activeTool.selectedObject.name],n.activeTool.helper&&(f=n.activeTool.helper.rotateAngle-n.nameTable[n.activeTool.selectedObject.name].rotateAngle,n._comparePropertyValues(i,"rotateAngle",{rotateAngle:n.activeTool.helper.rotateAngle},!0),n._rotate(n.activeTool.selectedObject,f,n.nameTable))),r&&(this._updateNodeMargin(n,i,r),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r,!0),this._updateLastSwimlanePhase(n,i)),this._enableConnectorUpdateNode(n,i))))},_multiNodeRotate:function(n,i,r){var u,f,o,s,e,h;if(r)if(this._outOfBoundaryMultiNodeDrop(n,r)){if(r.children.length>0)for(s=r.children,e=0;e<s.length;e++)u=n.nameTable[n._getChild(s[e])],f=this._getTargets(n,u),f&&f.length>0?(o=this._getContainerFromTarget(n,f,u),o?this._addNodeToContainer(n,u,o):this._addMultiNodeToDiagram(n,u)):this._addMultiNodeToDiagram(n,u);this._getRedoObject(n,r);h={type:"rotationchanged",node:jQuery.extend(!0,{},r),undoObject:jQuery.extend(!0,{},n.activeTool._undoObject),redoObject:jQuery.extend(!0,{},n.activeTool._redoObject),category:"internal",swimlaneMultiSelection:!0};n.addHistoryEntry(h);n.activeTool._multipleUndo=!0;t.datavisualization.Diagram.Util._updateGroupBounds(r,n);n.updateSelection()}else this._updateBoundsExceedNodes(n,r,"rotate")},_updateDropLaneProperties:function(n,i,r){if(i&&r){i.orientation=r.orientation;i.horizontalAlign=r.orientation==="horizontal"?"stretch":"left";i.verticalAlign=r.orientation==="vertical"?"stretch":"top";i.paddingBottom=20;i.paddingTop=20;i.paddingLeft=20;i.paddingRight=20;var u=n.nameTable[i.children[0]];u&&(u.marginLeft=-20,u.marginTop=-20,u.marginRight=-20,u.marginBottom=-20,u.constraints=t.datavisualization.Diagram.NodeConstraints.Default^t.datavisualization.Diagram.NodeConstraints.Select^t.datavisualization.Diagram.NodeConstraints.Connect,u._isHeader=!0)}return i},_outOfBoundaryAddLane:function(i,r,u,f){var e,o,s,h,c;return t.datavisualization.Diagram.Util.canMoveOutofBoundary(i)&&((e=i._cloneSwimlaneObj(i._getNode(r.name),t.datavisualization.Diagram.Util.randomId()),e=t.datavisualization.Diagram.ContainerHelper._initContainer(i,e),o=i.activeTool._cloneGroupNode(n.extend(!0,{},u),t.datavisualization.Diagram.Util.randomId()),i.nameTable[o.name]=o,s=i.nameTable[i._getChild(e.children[2])],f||f===0?s.children.splice(f,0,o.name):s.children.push(o.name),o.parent=s.name,i._disableSwimlaneUptate=!0,this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,o),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,e),this._enableConnectorUpdate(i,e),delete i._disableSwimlaneUptate,h=t.datavisualization.Diagram.Util.bounds(e),t.datavisualization.Diagram.containerCommon._removeObject(i,o),t.datavisualization.Diagram.containerCommon._removeObject(i,e),c=i.activeTool._getPageBounds(),h.bottom>c.height)||h.right>c.width)?!1:!0},_addNewLane:function(n,i,r,u,f){var o,e,l,c,f,s,h,a,v;if(n.activeTool._removeHelpers(),o=n.nameTable[n._getChild(r.children[2])],o){if(e=n.activeTool._cloneGroupNode(n.activeTool.selectedObject,u?"":t.datavisualization.Diagram.Util.randomId()),e=this._updateDropLaneProperties(n,e,r),l=n._isUndo,n._isUndo=!0,n.activeTool.selectedObject=null,n.remove(n.activeTool.selectedObject),n._isUndo=l,n._isUndo||this._outOfBoundaryAddLane(n,r,e,f)){if(c={element:n.getNode(e),cancel:!1,target:i},i&&(f=f!==undefined?f:n.activeTool._getSwimLaneStackIndex(i)),f||f===0?o.children.splice(f,0,e.name):o.children.push(e.name),e.parent=o.name,n._raiseDropEvent(c),n.remove(e),!c.cancel){if(n.activeTool._isLane=!0,e.isLane&&(s=n.nameTable[n._getChild(e.children[0])],s&&e.labels&&s.labels.length>0))for(h=0;h<s.labels.length;h++)s.labels[h].visible=!0;n._isUndo||(a=n._getChildTable(e,{}),v={type:"collectionchanged",object:jQuery.extend(!0,{},e),childTable:jQuery.extend(!0,{},a),index:f,changeType:"insert",category:"internal"},n.addHistoryEntry(v));n.add(e)&&n._updateDroppedSymbol(e)}this._disableConnectorUpdate(n);t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,o);this._enableConnectorUpdateLane(n,e)}n._clearSelection(!0);n._addSelection(r,!0);n.activeTool.selectedObject=null}},_outOfBoundsOnLaneResize:function(n,i,r){var h,e,u,f,o,s;return t.datavisualization.Diagram.Util.canMoveOutofBoundary(n)&&((h=r?n.nameTable[i.parent.split("laneStack")[0]]:i,e=t.datavisualization.Diagram.Util.randomId(),u=n._cloneSwimlaneObj(n._getNode(h.name),e),u=t.datavisualization.Diagram.ContainerHelper._initContainer(n,u),r?(f=n.nameTable[i.name+e],f&&(f.minWidth=n.activeTool.helper.width,f.minHeight=n.activeTool.helper.height)):(u.minWidth=n.activeTool.helper.width,u.minHeight=n.activeTool.helper.height),n._disableSwimlaneUptate=!0,this._disableConnectorUpdate(n),r&&t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,f),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,u),this._enableConnectorUpdateLane(n,u),delete n._disableSwimlaneUptate,o=t.datavisualization.Diagram.Util.bounds(u),t.datavisualization.Diagram.containerCommon._removeObject(n,u),s=n.activeTool._getPageBounds(),o.bottom>s.height)||o.right>s.width)?!1:!0},_resizeLane:function(i,r){var u=i.nameTable[r.name],s,e,f,o;u&&(u.isLane?this._outOfBoundsOnLaneResize(i,u,!0)&&(u.container&&(i._raiseSizePropertyChange(r,i.activeTool.helper.width/r.width,i.activeTool.helper.height/r.height,!0),i.activeTool._undoObject=n.extend(!0,{},{node:u}),i._comparePropertyValues(r,"minWidth",{minWidth:i.activeTool.helper.width},!0),i._comparePropertyValues(r,"offsetX",{offsetX:r.offsetX+i.activeTool.helper.width/2},!0),u.minWidth=i.activeTool.helper.width<=100?100:i.activeTool.helper.width,i._comparePropertyValues(r,"minHeight",{minHeight:i.activeTool.helper.height},!0),i._comparePropertyValues(r,"offsetY",{offsetY:r.offsetY+i.activeTool.helper.height/2},!0),u.minHeight=i.activeTool.helper.height<=100?100:i.activeTool.helper.height,i.activeTool._redoObject=n.extend(!0,{},{node:u})),o={type:"sizechanged",node:jQuery.extend(!0,{},u),undoObject:jQuery.extend(!0,{},i.activeTool._undoObject),redoObject:jQuery.extend(!0,{},i.activeTool._redoObject),category:"internal"},i.addHistoryEntry(o),i.activeTool._multipleUndo=!0,this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,u,!0),this._enableConnectorUpdateLane(i,u)):u.isSwimlane?(s=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(i,u),s.length>0&&(f=i.nameTable[s[s.length-1]],f&&(i.activeTool._undoObject=n.extend(!0,{},{node:f}),i._raiseSizePropertyChange(u,i.activeTool.helper.width/u.width,i.activeTool.helper.height/u.height,!0),u.orientation==="vertical"?(e=f.width+i.activeTool.helper.width-u.width,i._comparePropertyValues(f,"minWidth",{minWidth:e},!0),i._comparePropertyValues(f,"offsetX",{offsetX:r.offsetX+e/2},!0),f.minWidth=e<=100?100:e):(e=f.height+i.activeTool.helper.height-u.height,i._comparePropertyValues(f,"minHeight",{minHeight:e},!0),i._comparePropertyValues(f,"offsetY",{offsetY:r.offsetY+e/2},!0),f.minHeight=e<=100?100:e),this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,f,!0),this._enableConnectorUpdateLane(i,u),i.activeTool._redoObject=n.extend(!0,{},{node:f}),o={type:"sizechanged",node:jQuery.extend(!0,{},u),undoObject:jQuery.extend(!0,{},i.activeTool._undoObject),redoObject:jQuery.extend(!0,{},i.activeTool._redoObject),category:"internal"},i.addHistoryEntry(o),i.activeTool._multipleUndo=!0,this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,u,!0),this._enableConnectorUpdateLane(i,u)))):u.container&&(u.minWidth=i.activeTool.helper.width,u.minHeight=i.activeTool.helper.height,t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,u,!0)))},_getUndoObject:function(t,i){var r={},r=t._getChildTable(i,r);t.activeTool._undoObject=n.extend(!0,{},{node:i,childTable:r})},_getRedoObject:function(t,i){var r={},r=t._getChildTable(i,r);t.activeTool._redoObject=n.extend(!0,{},{node:i,childTable:r})},_undoRemoveNodeFromContainer:function(n,i){var r,f,e,u;if(i.type!=="pseudoGroup"&&(r=n.nameTable[i.parent],r)){for(i.parent="",f=r.children,u=0;u<f.length;u++)e=n.nameTable[n._getChild(f[u])],e&&e.name===i.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(r.children,f[u]);t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r,!0)}},_undoAddNodeToContainer:function(n,i,r){if(i.type!=="pseudoGroup"){var u=n.nameTable[r.parent],f;n._translate(i,r.offsetX-i.offsetX,r.offsetY-i.offsetY,n.nameTable);u&&(i.parent=u.name,u.children.push(i.name),f=n._svg.getElementById(u.name),this._updateNodeMargin(n,i,u),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,u,!0));i._type==="group"?t.datavisualization.Diagram.DiagramContext.renderGroup(i,n,f):i.segments?t.datavisualization.Diagram.DiagramContext.renderConnector(i,n,f):t.datavisualization.Diagram.DiagramContext.renderNode(i,n,f)}},_undoDragNode:function(t,i,r,u){if(r=n.extend(!0,{},r),i&&r&&i.type!=="pseudoGroup"){var e=n.extend(!0,{},r),f=n.extend(!0,{},i);u||(this._disableConnectorUpdate(t),t._disableSwimlaneUptate=!0);this._undoRemoveNodeFromContainer(t,i);this._undoAddNodeToContainer(t,i,r);u||delete t._disableSwimlaneUptate;t._clearSelection(!0);t._addSelection(i,!0);this._updateLastSwimlanePhase(t,i);u||(f.parent?this._enableConnectorUpdateNode(t,f):this._enableConnectorUpdateNode(t,e))}},_undoMultiDragNode:function(i,r){var u=n.extend(!0,{},r.node),s,a,h,f,e,c,l,o;if(u&&u.type==="pseudoGroup"){for(a=u.children,i._disableSwimlaneUptate=!0,h=0;h<a.length;h++)this._disableConnectorUpdate(i),f=i.nameTable[i._getChild(a[h])],e=f.parent,s=r.undo&&f?r.undoObject.childTable?r.undoObject.childTable[f.name]:null:r.redoObject.childTable?r.redoObject.childTable[f.name]:null,this._undoDragNode(i,f,s,!0),e||s.parent&&(e=s.parent),e?(c=i.nameTable[e],c&&c.isLane&&(l=i.nameTable[c.parent.split("laneStack")[0]],l&&(i._updateSwimlanes||(i._updateSwimlanes=[]),i._collectionContains(l.name,i._updateSwimlanes)||i._updateSwimlanes.push(l.name)))):(delete i._disableSegmentChange,this._updateAssociatedConnectorEnds(i,f,i.nameTable)),delete i._disableSegmentChange,this._updateAssociatedConnectorEnds(i,f,i.nameTable);if(delete i._disableSwimlaneUptate,i._updateSwimlanes&&i._updateSwimlanes.length>0)for(o=0;o<i._updateSwimlanes.length;o++)t.datavisualization.Diagram.DiagramContext.update(i.nameTable[i._updateSwimlanes[o]],i),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdate(i,i.nameTable[i._updateSwimlanes[o]]);delete i._updateSwimlanes;i._clearSelection(!0);t.datavisualization.Diagram.Util._updateGroupBounds(u,i);i._addSelection(u,!0);delete i.nameTable[u.name];i.nameTable[u.name]=u}},_updateAssociatedConnectorEnds:function(n,i,r){var f,o,u,c,e,h,s;if(n.getObjectType(i)!=="connector"&&(i.inEdges.length||i.outEdges.length)){for(c=n._isNodeToNodeConnection(i),e=i,i.type=="bpmn"&&i._type=="group"&&(e=typeof i.children[0]=="object"?i.children[0]:n.nameTable[i.children[0]]),c&&(h=t.datavisualization.Diagram.Util._findSegmentPoints(e)),s={},n._parentNode&&(s=n._getChildTable(n._parentNode,{})),f=0,o=i.inEdges.length;f<o;f++)u=r[i.inEdges[f]],!u||n._parentNode&&s[u.sourceNode]||(u.targetPadding?delete e._segmentPoints:e._segmentPoints=h,n._dock(u,r),t.datavisualization.Diagram.DiagramContext.update(u,n));for(f=0,o=i.outEdges.length;f<o;f++)u=r[i.outEdges[f]],!u||n._parentNode&&s[u.targetNode]||(u.sourcePadding?delete e._segmentPoints:e._segmentPoints=h,n._dock(u,r));delete e._segmentPoints}},_undoRemoveResizeNodeFromContainer:function(n,i){var r,f,e,u;if(i.type!=="pseudoGroup"&&(r=n.nameTable[i.parent],r)){for(i.parent="",f=r.children,u=0;u<f.length;u++)e=n.nameTable[n._getChild(f[u])],e&&e.name===i.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(r.children,f[u]);t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r,!0)}},_undoAddResizeNodeToContainer:function(n,i,r){if(i.type!=="pseudoGroup"){var u=n.nameTable[r.parent],f;i.segments||(n._translate(i,r.offsetX-i.offsetX,r.offsetY-i.offsetY,n.nameTable),n.scale(i,r.width/i.width,r.height/i.height,t.datavisualization.Diagram.Point(i.offsetX,i.offsetY),n.nameTable),i._type==="group"&&t.datavisualization.Diagram.Util._updateGroupBounds(i,n));u&&(i.parent=u.name,u.children.push(i.name),f=n._svg.getElementById(u.name),this._updateNodeMargin(n,i,u),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,u,!0));i._type==="group"?t.datavisualization.Diagram.DiagramContext.renderGroup(i,n,f):i.segments?t.datavisualization.Diagram.DiagramContext.renderConnector(i,n,f):t.datavisualization.Diagram.DiagramContext.renderNode(i,n,f)}},_undoResizeNode:function(t,i,r,u){r=n.extend(!0,{},r);i&&r&&i.type!=="pseudoGroup"&&(u||this._disableConnectorUpdate(t),this._undoRemoveResizeNodeFromContainer(t,i),this._undoAddResizeNodeToContainer(t,i,r),t._clearSelection(!0),t._addSelection(i,!0),this._updateLastSwimlanePhase(t,i),u||this._enableConnectorUpdateNode(t,i))},_undoMultiResizeNode:function(i,r){var u=n.extend(!0,{},r.node),s,o,e,f;if(u&&u.type==="pseudoGroup"){for(o=u.children,e=0;e<o.length;e++)f=i.nameTable[i._getChild(o[e])],s=r.undo&&f?r.undoObject.childTable?r.undoObject.childTable[f.name]:null:r.redoObject.childTable?r.redoObject.childTable[f.name]:null,this._undoResizeNode(i,f,s);i._clearSelection(!0);t.datavisualization.Diagram.Util._updateGroupBounds(u,i);i._addSelection(u,!0);delete i.nameTable[u.name];i.nameTable[u.name]=u}},_undoResizeLane:function(i,r,u){var f=i.nameTable[r.name],o,e;f&&(u&&u.node&&u.node.isSwimlane?(o=t.datavisualization.Diagram.SwimLaneContainerHelper.getLanes(i,u.node),o.length>0&&(e=i.nameTable[o[o.length-1]],e&&(r=u.undo?u.undoObject&&u.undoObject.node?u.undoObject.node:e:u.undoObject&&u.redoObject.node?u.redoObject.node:e,i._comparePropertyValues(e,"minWidth",{minWidth:r.minWidth}),e.minWidth=r.minWidth,i._comparePropertyValues(e,"minHeight",{minHeight:r.minHeight}),e.minHeight=r.minHeight,this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,f,!0),this._enableConnectorUpdateLane(i,f)))):f.isLane&&(f.container&&(i.activeTool._undonode=n.extend(!0,{},{node:f}),i._comparePropertyValues(f,"minWidth",{minWidth:r.minWidth}),f.minWidth=r.minWidth,i._comparePropertyValues(f,"minHeight",{minHeight:r.minHeight}),f.minHeight=r.minHeight),this._disableConnectorUpdate(i),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(i,f,!0),this._enableConnectorUpdateLane(i,f)))},_undoRemoveRotateNodeFromContainer:function(n,i){var r,f,e,u;if(i.type!=="pseudoGroup"&&(r=n.nameTable[i.parent],r)){for(i.parent="",f=r.children,u=0;u<f.length;u++)e=n.nameTable[n._getChild(f[u])],e&&e.name===i.name&&t.datavisualization.Diagram.Util.removeChildFromGroup(r.children,f[u]);t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,r,!0)}},_undoAddRotateNodeToContainer:function(n,i,r){var u,f,e;i.type!=="pseudoGroup"&&(u=n.nameTable[r.parent],i.segments||(e=r.rotateAngle-i.rotateAngle,n._rotate(i,e,n.nameTable)),u&&(i.parent=u.name,u.children.push(i.name),f=n._svg.getElementById(u.name),this._updateNodeMargin(n,i,u),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,u,!0)),i._type==="group"?t.datavisualization.Diagram.DiagramContext.renderGroup(i,n,f):i.segments?t.datavisualization.Diagram.DiagramContext.renderConnector(i,n,f):t.datavisualization.Diagram.DiagramContext.renderNode(i,n,f))},_undoRotateNode:function(t,i,r,u){r=n.extend(!0,{},r);i&&r&&i.type!=="pseudoGroup"&&(u||this._disableConnectorUpdate(t),this._undoRemoveRotateNodeFromContainer(t,i),this._undoAddRotateNodeToContainer(t,i,r),t._clearSelection(!0),t._addSelection(i,!0),this._updateLastSwimlanePhase(t,i),u||this._enableConnectorUpdateNode(t,i))},_undoMultiRotateNode:function(i,r){var u=n.extend(!0,{},r.node),o,s,e,f;if(u&&u.type==="pseudoGroup"){for(s=u.children,e=0;e<s.length;e++)f=i.nameTable[i._getChild(s[e])],o=r.undo&&f?r.undoObject.childTable?r.undoObject.childTable[f.name]:null:r.redoObject.childTable?r.redoObject.childTable[f.name]:null,this._undoRotateNode(i,f,o,!0);i._clearSelection(!0);u.rotateAngle=o.rotateAngle;t.datavisualization.Diagram.Util._updateGroupBounds(u,i);i._addSelection(u,!0);delete i.nameTable[u.name];i.nameTable[u.name]=u}},_undoSwap:function(n,i){var r,e,o;n.activeTool._removeHelpers();n._clearSelection(!0);var s=i.undo?i.insertIndex:i.moveIndex,u=n.nameTable[i.undoObject.name1],f=u&&u.parent?n.nameTable[u.parent]:null;f&&f.children.length>0&&(r=f.children);e=this._getSwimlane(n,r[0]);r&&r.length>0&&(t.datavisualization.Diagram.canvasHelper._disableConnectorUpdate(n),this._undoSwapLane(n,r,s,u,null),t.datavisualization.Diagram.ContainerHelper._updateCollectionChange(n,f,!1),t.datavisualization.Diagram.canvasHelper._enableConnectorUpdateLane(n,u));o=this._getSwimlane(n,r[0]);n._comparePropertyValues(o,"lanes",{lanes:e.lanes})},_undoSwapLane:function(n,t,i,r){t&&t.length>0&&(t.splice(t.indexOf(r.name),1),t.splice(i,0,r.name))}};t.datavisualization.Diagram.containerCommon={_initGroupNode:function(n,i){var r=null,u;for(i=n._getNewGroup(i),u=0;u<i.children.length;u++)r=i.children[u],r&&typeof r=="object"&&(typeof r.shape!="object"&&(r=t.datavisualization.Diagram.NodeType(r,n)),r._type=="group"||r.children||r.segments||r.type=="connector"?r.segments||r.type=="connector"?(r=n._getNewConnector(r),r.name==""&&(r.name=t.datavisualization.Diagram.Util.randomId())):(r=n._getNewGroup(r),r.name==""&&(r.name=t.datavisualization.Diagram.Util.randomId()),r=this._initGroupNode(n,r)):(i.type!="bpmn"&&(r=n._getNewNode(r)),r.name==""&&(r.name=t.datavisualization.Diagram.Util.randomId()),r._type=="node"&&r.labels.length&&(r.width==0||r.height==0)&&n._getNodeDimension(r)),i.children[u]=r,r.parent=i.name);return i},_initChildren:function(n,i){var u,r,f;if(i.children&&i.children.length>0)for(u=i.children,r=0;r<u.length;r++)f=typeof u[r]=="string"?n.nameTable[u[r]]:u[r],i.container&&(f.type==="bpmn"?n._translate(f,0-f.offsetX,0-f.offsetY,n.nameTable):f.offsetX=0,f.offsetY=0),f&&(f.container?u[r]=t.datavisualization.Diagram.ContainerHelper._initContainer(n,f):f.children?(u[r]=t.datavisualization.Diagram.Group(f),u[r]=this._initGroupNode(n,u[r]),u[r]=n._getNewGroup(u[r]),u[r]=this._initChildren(n,u[r]),this._updateGroupBounds(n,u[r])):f.segments?(u[r]=t.datavisualization.Diagram.Connector(f),u[r]=n._getNewConnector(f)):(u[r]=t.datavisualization.Diagram.NodeType(f,n),u[r]=n._getNewNode(f)),n.nameTable[u[r].name]=u[r],i.children[r]=u[r].name);return i},_getChildrenBounds:function(n,i){var u=i.children,f,e=t.datavisualization.Diagram.Rectangle(),r,o,s;for(u.length>0&&(r=n.nameTable[n._getChild(u[0])],r&&(e=t.datavisualization.Diagram.Util._rotateChildBounds(r,i,n))),o=0,s=u.length;o<s;o++)r=n.nameTable[n._getChild(u[o])],r&&(r._type==="group"?(t.datavisualization.Diagram.Util._updateGroupBounds(r,n),f=t.datavisualization.Diagram.Util._rotateChildBounds(r,i,n)):f=t.datavisualization.Diagram.Util._rotateChildBounds(r,i,n)),f&&(e=t.datavisualization.Diagram.Geometry.union(e,f));return e},_updateGroupBounds:function(n,i,r){var o,s,h,c,e;if(i&&!i.container&&i&&(i.type==="pseudoGroup"||i.children&&i.children.length>0)){o=i.width;s=i.height;h=i.offsetX;c=i.offsetY;r&&t.datavisualization.Diagram.Util._updateRotateAngle(i,n.nameTable);var u=this._getChildrenBounds(n,i),l=u.x+u.width*i.pivot.x,a=u.y+u.height*i.pivot.y,f={x:l,y:a};i.rotateAngle&&(e=t.Matrix.identity(),t.Matrix.rotate(e,i.rotateAngle),f=t.Matrix.transform(e,f));u&&(i.offsetX=f.x,i.offsetY=f.y,i.width=u.width,i.height=u.height)}},_cloneObject:function(t,i,r){var u,f;if(i){if(u=n.extend(!0,{},i),u.children&&u.children.length>0)for(f=0;f<u.children.length;f++)u.children[f]=this._cloneObject(t,u.children[f],r);u.name+=r}return u},_removeObject:function(n,t){var i;if(t){if(typeof t=="string"&&(t=n.nameTable[t]),t&&t.children&&t.children.length>0)for(i=0;i<t.children.length;i++)this._removeObject(n,t.children[i]);t&&delete n.nameTable[t.name]}}}}(jQuery,Syncfusion),function(n,t){"use strict";t.widget("ejOverview","ej.datavisualization.Overview",{element:null,validTags:["div"],model:null,defaults:{sourceID:"",width:null,height:null},_canvas:null,_actionName:"",_startPoint:null,_currentPoint:null,_prevPoint:null,_helper:null,_viewPortRatio:1,_resizeDirection:"",_inAction:!1,_init:function(){t.browserInfo().name==="msie"&&Number(t.browserInfo().version)<9||(this._wireEvents(),this._renderCanvas(),this._setParent(this.model.sourceID))},_renderCanvas:function(){var n=document.createElement("div");n.setAttribute("id",this.element[0].id+"_canvas");n.setAttribute("class","drawing");n.setAttribute("style","position:relative; height:"+this.model.height+"; width:"+this.model.width+";style:-ms-touch-action: none;touch-action: none;");this.element[0].setAttribute("tabindex",0);this.element.css({overflow:"hidden",outline:"none",display:"block",height:this.model.height,width:this.model.width});this.element.append(n);this._canvas=n},_renderDocument:function(i){var o,r,h,c;if(i.canvas=this._canvas,window.SVGSVGElement){o={id:this._canvas.id+"_svg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:i.style,"class":"overview_svg"};r=new t.datavisualization.Diagram.Svg(o);this._svg=r;i.svg=r;var l=document.getElementById(this._id),e=l,u=n(e).width(),f=n(e).height(),s=e.getBoundingClientRect(),a=window.screenX<0?window.screenX*-1:window.screenX;u===0&&(u=Math.floor(window.innerWidth-a-Math.floor(s.left)));h=window.screenY<0?window.screenY*-1:window.screenY;f===0&&(f=Math.floor(window.innerHeight-h-Math.floor(s.top)));r.document.setAttribute("width",u);r.document.setAttribute("height",f);this.width=u;this.height=f;i.diagramLayer=t.datavisualization.Diagram.SvgContext._renderDiagramLayer(i.canvas,i.svg,i.svg);c=r.defs({id:i.canvas.id+"patterndefinition"});r.appendChild(c);i.canvas.appendChild(r.document);this._renderHtmlLayer(i.canvas);this._addOverviewRectPanel(i)}},_removeDocument:function(){var t=document.getElementById(this._canvas.id+"_svg"),n;this._canvas.removeChild(t);n=document.getElementById(this._canvas.id+"_htmlLayer");this._canvas.removeChild(n)},_renderHtmlLayer:function(n){var i=document.createElement("div"),u={id:n.id+"_htmlLayer","class":"htmlLayer"},r;return t.datavisualization.Diagram.Util.attr(i,u),r=i,i.style.pointerEvents="none",i.style.position="absolute",i.style.left="0px",i.style.top="0px",n.appendChild(r),r},_setModel:function(n){for(var t in n)switch(t){case"sourceID":this._setParent(n[t])}},_setParent:function(t){if(this._parent){var i=n("#"+this._parent._id).ejDiagram("instance");this._parent=null;i._setOverview(null,this._id)}t&&(this.model.sourceID=t,this._parent=n("#"+t).ejDiagram("instance"),this._parent&&this._parent._setOverview(this))},_destroy:function(){this.element.empty().removeClass(this.model.cssClass)},_wireEvents:function(){var i=n(this._canvas);this._on(i,t.eventType.mouseDown,this._mousedown);this._on(i,t.eventType.mouseMove,this._mousemove);this._on(i,t.eventType.mouseUp,this._mouseup);this._on(i,t.eventType.mouseLeave,this._documentmouseup);this._on(i,"touchstart",this.handleTouchStart);this._on(i,"touchmove",this.handleTouchMove);this._on(i,"touchend",this.handleTouchEnd)},_mouseup:function(n){var f,e,t,u;if(this._currentPoint=this._mouseposition(n),f=this.width,e=this.height,this._actionName)if(this._startPoint.x!=this._currentPoint.x||this._startPoint.y!=this._currentPoint.y){if(this._actionName!="pan"&&this._helper){t=this._helper.getBBox();this._resizeDirection=this._resizeDirection||"";var o=t.x,s=t.y,i=t.width,r=t.height,h=this._resizeDirection=="topleft"||this._resizeDirection=="topright"||this._resizeDirection=="bottomleft"||this._resizeDirection=="bottomright";this._renderOverviewRect(o,s,i,r)}}else if((n.target.id==this._canvas.id+"overviewbackrect"||n.target.id=="helper")&&this._startPoint.x==this._currentPoint.x&&this._startPoint.y==this._currentPoint.y){var u=document.getElementById(this._canvas.id+"overviewrect"),t=u.getBBox(),i=t.width||100,r=t.height||100/this._viewPortRatio;this.inAction=!0;this._actionName="pan";this._renderOverviewRect(this._currentPoint.x-i/2,this._currentPoint.y-r/2,i,r);this.inAction=!1}this._helper&&(u=document.getElementById(this._canvas.id+"overviewhandle"),u.removeChild(this._helper),this._helper=null);this._actionName="";this._startPoint=null;this._currentPoint=null;this._prevPoint=null;this._helper=null;this._viewPortRatio=1;this._resizeDirection="";this._inAction=!1},_mousedown:function(n){if(n.target.className.animVal=="overviewbackrect"&&(this._actionName="draw"),n.target.id==this._canvas.id+"overviewrect"&&(this._actionName="pan"),n.target.className.animVal=="overviewresizer"){this._actionName="scale";switch(n.target.id){case this._canvas.id+"left":this._resizeDirection="left";break;case this._canvas.id+"right":this._resizeDirection="right";break;case this._canvas.id+"top":this._resizeDirection="top";break;case this._canvas.id+"bottom":this._resizeDirection="bottom";break;case this._canvas.id+"topleft":this._resizeDirection="topleft";break;case this._canvas.id+"topright":this._resizeDirection="topright";break;case this._canvas.id+"bottomleft":this._resizeDirection="bottomleft";break;case this._canvas.id+"bottomright":this._resizeDirection="bottomright"}}this._startPoint=this._prevPoint=this._mouseposition(n);var i=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent);this._viewPortRatio=i.width/i.height},_mouseposition:function(n){var i=this._parent._isTouchEvent(n);i||(i=n);var u=this._canvas.scrollLeft,f=this._canvas.scrollTop,r=this._canvas.getBoundingClientRect(),e=i.clientX+u-r.left,o=f+i.clientY-r.top;return new t.datavisualization.Diagram.Point(e,o)},_updateCursor:function(n){if(n.target.className.animVal=="overviewresizer")switch(n.target.id){case this._canvas.id+"left":this._canvas.style.cursor="w-resize";break;case this._canvas.id+"right":this._canvas.style.cursor="e-resize";break;case this._canvas.id+"top":this._canvas.style.cursor="n-resize";break;case this._canvas.id+"bottom":this._canvas.style.cursor="s-resize";break;case this._canvas.id+"topleft":this._canvas.style.cursor="nw-resize";break;case this._canvas.id+"topright":this._canvas.style.cursor="ne-resize";break;case this._canvas.id+"bottomleft":this._canvas.style.cursor="sw-resize";break;case this._canvas.id+"bottomright":this._canvas.style.cursor="se-resize"}else this._canvas.style.cursor="default"},_mousemove:function(n){if(this._updateCursor(n),this._currentPoint=this._mouseposition(n),this._actionName)switch(this._actionName){case"draw":this._inAction||this._startPoint.x==this._currentPoint.x&&this._startPoint.y!=this._currentPoint.y||(this._initHelper(),this._inAction=!0);this._inAction&&this._updateHelper();break;case"scale":this._inAction||(this._initHelper(),this._inAction=!0);this._updateOverviewRectangle();break;case"pan":(this._startPoint.x!=this._currentPoint.x||this._startPoint.y==this._currentPoint.y||this._inAction)&&(this._inAction=!0,this._translateOverviewRectangle())}this._prevPoint=this._currentPoint},_documentmouseup:function(){if(this._inAction=!1,this._actionName="",this._helper){var n=document.getElementById(this._canvas.id+"overviewhandle");n.removeChild(this._helper);this._helper=null}},_addOverviewRectPanel:function(){var u=new t.datavisualization.Diagram.Svg({id:this._canvas.id+"_overviewsvg",version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:"position:absolute;left:0px;top:0px",width:this.width,height:this.height}),f,e,r,i,o;this._canvas.appendChild(u.document);f=u.g({id:this._id+"_overviewlayer"});u.appendChild(f);e=u.rect({fill:"transparent",width:"100%",height:"100%","class":"overviewbackrect",id:this._canvas.id+"overviewbackrect"});f.appendChild(e);r=n(f);this._on(r,t.eventType.mouseDown,this._mousedown);this._on(r,t.eventType.mouseMove,this._mousemove);this._on(r,t.eventType.mouseUp,this._mouseup);this._on(r,t.eventType.mouseLeave,this._documentmouseup);this._on(r,"touchstart",this.handleTouchStart);this._on(r,"touchmove",this.handleTouchMove);this._on(r,"touchend",this.handleTouchEnd);i=u.g({id:this._canvas.id+"overviewhandle"});f.appendChild(i);o=u.rect({id:this._canvas.id+"overviewrect",fill:"transparent"});i.appendChild(o);this._renderOverviewCorner("left",i);this._renderOverviewCorner("right",i);this._renderOverviewCorner("top",i);this._renderOverviewCorner("bottom",i);this._renderOverviewCorner("topleft",i);this._renderOverviewCorner("topright",i);this._renderOverviewCorner("bottomleft",i);this._renderOverviewCorner("bottomright",i)},_updateOverview:function(n){var c,l,i,f,e,v,r,u,y,h;n=n||this._parent._views[this._id];i=this._parent._getDigramBounds();c=i.width;l=i.height;var a=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),o=this.width,s=this.height;n.context==t.datavisualization.Diagram.SvgContext?(f=Math.max(c,a.width),e=Math.max(l,a.height),this.contentWidth=f=Math.max(f,o/s*e),this.contentHeight=e=Math.max(e,s/o*f),v=document.getElementById(this._canvas.id+"_diagramLayer"),r=Math.min(o/f,s/e),this.scale=r,v.setAttribute("transform","scale("+r+","+r+"),translate("+-i.x+","+-i.y+")"),u=document.getElementById(this._canvas.id+"_htmlLayer"),u.style.webkitTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.MozTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.OTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.msTransform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",u.style.transform="scale("+r+") translate("+-i.x+"px,"+-i.y+"px)",y=document.getElementById(this._id+"_overviewlayer"),y.setAttribute("transform","translate("+-i.x*r+","+-i.y*r+")")):(h=n._canvas.document.getContext("2d"),n.scale&&h.scale(1/n.scale.x,1/n.scale.y),n.scale={x:r,y:r},h.scale(r,r),t.datavisualization.Diagram.CanvasContext.refreshCanvas(this._parent.model,n));this._scrollOverviewRect(this._parent._hScrollOffset,this._parent._vScrollOffset,this._parent._currZoom)},_updateOverviewRectangle:function(){var n=this._currentPoint.x-this._prevPoint.x,t=this._currentPoint.y-this._prevPoint.y;if(this._actionName=="scale"){var i={width:0,height:0},r=0,u=0,f,e;switch(this._resizeDirection){case"left":i.width-=n;i.height-=n/this._viewPortRatio;r=n;u=n/this._viewPortRatio/2;break;case"right":i.width+=n;i.height+=n/this._viewPortRatio;u=n/this._viewPortRatio/-2;break;case"top":i.height-=t;i.width-=t*this._viewPortRatio;u=t;r=t*this._viewPortRatio/2;break;case"bottom":i.height+=t;i.width+=t*this._viewPortRatio;r=t*this._viewPortRatio/-2;break;case"topleft":Math.abs(t)>Math.abs(n)?n=t*this._viewPortRatio:t=n/this._viewPortRatio;i.width-=n;i.height-=t;r=n;u=t;break;case"topright":Math.abs(t)>Math.abs(n)?n=-t*this._viewPortRatio:t=-(n/this._viewPortRatio);u=t;i.width+=n;i.height-=t;break;case"bottomleft":Math.abs(t)>Math.abs(n)?n=-t*this._viewPortRatio:t=-n/this._viewPortRatio;r=n;i.width-=n;i.height+=t;break;case"bottomright":Math.abs(t)>Math.abs(n)?n=t*this._viewPortRatio:t=n/this._viewPortRatio;i.width+=n;i.height+=t}this._updateHelper(r,u,i,f,e)}},_initHelper:function(){var e,n,t;if(!this._helper){var o=this._svg,s=document.getElementById(this._canvas.id+"overviewhandle"),h=this._parent._currZoom,i=this._startPoint.x,r=this._startPoint.y,u=1,f=1;this._actionName=="scale"&&(e=document.getElementById(this._canvas.id+"overviewrect"),n=e.getBBox(),i=n.x,r=n.y,u=n.width,f=n.height);t=o.rect({id:"helper",x:i,y:r,width:u,height:f,fill:"transparent",stroke:"gray","stroke-dasharray":"2 2","shape-rendering":"crispEdges"});s.appendChild(t);this._helper=t}},_updateHelper:function(n,i,r){var n,i,o,s;if(r)var u=this._helper.getBBox(),h=u.x+n,c=u.y+i,f=u.width+r.width,e=u.height+r.height;else{n=this._currentPoint.x>this._startPoint.x?this._currentPoint.x-this._prevPoint.x:this._prevPoint.x-this._currentPoint.x;i=this._currentPoint.y>this._startPoint.y?this._currentPoint.y-this._prevPoint.y:this._prevPoint.y-this._currentPoint.y;Math.abs(i)>Math.abs(n)?(n=this._viewPortRatio*i,s=!0,o=!1):(i=n/this._viewPortRatio,o=!0,s=!1);var u=this._helper.getBBox(),h=this._startPoint.x>this._currentPoint.x?u.x-n:u.x,c=this._startPoint.y>this._currentPoint.y?u.y-i:u.y,f=u.width+n,e=u.height+i}this._helper&&t.datavisualization.Diagram.Util.attr(this._helper,{id:this._helper.id,x:h,y:c,width:f<0?0:f,height:e<0?0:e})},_renderOverviewCorner:function(n,t){var i=this._svg,r,u;n=="top"||n=="bottom"||n=="right"||n=="left"?(r=i.rect({id:this._canvas.id+"visible"+n}),t.appendChild(r),u=i.rect({id:this._canvas.id+n,"class":"overviewresizer",fill:"transparent"}),t.appendChild(u)):(r=i.circle({id:this._canvas.id+"visible"+n}),t.appendChild(r),u=i.circle({id:this._canvas.id+n,"class":"overviewresizer",fill:"transparent"}),t.appendChild(u))},_updateOverviewrect:function(n,i,r,u){if(r&&u){var f=document.getElementById(this._canvas.id+"overviewrect"),e={x:n,y:i,width:Math.max(1,r),height:Math.max(1,u)};t.datavisualization.Diagram.Util.attr(f,e);this._updateOverviewCorner("top",n+8,i-2,Math.max(0,r-16),2);this._updateOverviewCorner("bottom",n+8,i+u,Math.max(0,r-16),2);this._updateOverviewCorner("left",n-2,i+8,2,Math.max(0,u-16));this._updateOverviewCorner("right",n+r,i+8,2,Math.max(0,u-16));this._updateOverviewCorner("topleft",n,i,5,5);this._updateOverviewCorner("topright",n+r,i,5,5);this._updateOverviewCorner("bottomleft",n,i+u,5,5);this._updateOverviewCorner("bottomright",n+r,i+u,5,5)}},_scrollOverviewRect:function(n,i,r){if(!this._actionName){var o=this.width,s=this.height,u=Math.min(this.contentWidth/o,this.contentHeight/s),f={},h=f.x=n/r/u,c=f.y=i/r/u,e=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),l=f.width=e.width/r/u,a=f.height=e.height/r/u,v=e.width/e.height;this._updateOverviewrect(h,c,l,a)}},_updateOverviewCorner:function(n,i,r,u,f){var h="visible"+n,c=document.getElementById(this._canvas.id+h),e,o,s;n=="top"||n=="bottom"||n=="right"||n=="left"?(e={x:i,y:r,width:u,height:f,fill:"#ED1C24"},o={x:i-2,y:r-2,width:u==2?4:u,height:f==2?4:f}):(e={cx:i,cy:r,r:4,fill:"#ED1C24"},o={cx:i,cy:r,r:6,fill:"transparent"});t.datavisualization.Diagram.Util.attr(c,e);s=document.getElementById(this._canvas.id+n);t.datavisualization.Diagram.Util.attr(s,o)},_translateOverviewRectangle:function(){var o=this.width,s=this.height,h=this._currentPoint.x-this._prevPoint.x,c=this._currentPoint.y-this._prevPoint.y,i=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),a=Math.min(i.width/o,i.height/s),l=document.getElementById(this._canvas.id+"overviewrect"),n=l.getBBox(),r=n.x+h,u=n.y+c,f=n.width,e=n.height;this._updateOverviewrect(r,u,f,e);this._updateView(this._parent._currZoom,r,u,f,e,null)},_updateView:function(i,r,u,f,e,o){var b=this.width,k=this.height,d=this.contentWidth/b,g=this.contentHeight/k,y=r*d*i,p=u*g*i,h=this._parent._getDigramBounds(),v,s;if(i!=1||this._actionName=="pan"){var a=n("#"+this._parent._canvas.id+"_hScrollbar").ejScrollBar("instance").model,w=-y+a.maximum,c=-y+this._parent._hScrollOffset,l=-p+this._parent._vScrollOffset;h.width*i<w&&(s=h.width*i-w,Math.abs(s)<Math.abs(c)&&(c=c-s));a=n("#"+this._parent._canvas.id+"_vScrollbar").ejScrollBar("instance").model;v=-p+a.maximum;h.height*i<v&&(s=h.height*i-v,Math.abs(s)<Math.abs(l)&&(l=l-s))}t.datavisualization.Diagram.ZoomUtil.zoomPan(this._parent,i/this._parent._currZoom,c,l,o,!1)},_renderOverviewRect:function(n,i,r,u){var o=this.width,s=this.height,e=t.datavisualization.Diagram.ScrollUtil._viewPort(this._parent),h=r/o*this.contentWidth,c=u/s*this.contentHeight,f=Math.max(e.width/h,e.height/c);f>=.25&&f<=30&&(this._updateView(f,n,i,r,u,new t.datavisualization.Diagram.Point(0,0)),this._updateOverviewrect(n,i,r,u))},handleTouchStart:function(n){n.preventDefault()},handleTouchMove:function(n){n.preventDefault()},handleTouchEnd:function(n){n.preventDefault()},handleTouchLeave:function(n){n.preventDefault()}})}(jQuery,Syncfusion),function(n,t){"use strict";var i=function(){function i(n){return this.document=document.createElement("canvas"),this.id=n.id,n&&t.datavisualization.Diagram.Util.attr(this.document,n),this}return i.prototype.rect=function(n,t,i,r,u,f){var e=this.document.getContext("2d");e.beginPath();u&&u.angle&&this.rotateContext(u,e);f&&(this.setStyle(f,e),f.dashArray&&this.dashedRectangle(n,t,i,r,f.dashArray));e.fillRect(n,t,i,r);e.strokeRect(n,t,i,r);e.closePath();u&&u.angle&&e.restore()},i.prototype.roundedRect=function(n,t,i,r,u,f,e){var h=this.document.getContext("2d"),o;h.beginPath();f&&f.angle&&this.rotateContext(f,h);var s=[{x:n+u,y:t},{x:n+i-u,y:t},{x:n+i,y:t+u},{x:n+i,y:t+r-u},{x:n+i-u,y:t+r},{x:n+u,y:t+r},{x:n,y:t+r-u},{x:n,y:t+u}],l=[{x:n+i,y:t},{x:n+i,y:t+r},{x:n,y:t+r},{x:n,y:t}],c=0,a,v;for(e&&this.setStyle(e,h),h.moveTo(s[0].x,s[0].y),o=0;o<s.length;o=o+2)a=s[o+1],h.lineTo(a.x,a.y),v=s[o+2]||s[0],h.quadraticCurveTo(l[c].x,l[c].y,v.x,v.y),c++;if(h.fill(),e&&e.dashArray)for(c=0,o=0;o<s.length;o=o+2)this.dashedLine(s[o].x,s[o].y,s[o+1].x,s[o+1].y,e.dashArray),this.quadraticCurve(s[o+1],l[c],s[o+2]||s[0],e),c++;h.stroke();h.closePath();f&&f.angle&&h.restore()},i.prototype.ellipse=function(n,i,r,u,f,e){var s=this.document.getContext("2d"),o;e&&this.setStyle(e,s);o=4*((Math.sqrt(2)-1)/3);s.beginPath();f&&f.angle&&this.rotateContext(f,s);s.moveTo(n,i-u);s.bezierCurveTo(n+o*r,i-u,n+r,i-o*u,n+r,i);s.bezierCurveTo(n+r,i+o*u,n+o*r,i+u,n,i+u);s.bezierCurveTo(n-o*r,i+u,n-r,i+o*u,n-r,i);s.bezierCurveTo(n-r,i-o*u,n-o*r,i-u,n,i-u);s.fill();e&&e.dashArray&&(this.bezierCurve(t.datavisualization.Diagram.Point(n,i-u),new t.datavisualization.Diagram.Point(n+o*r,i-u),new t.datavisualization.Diagram.Point(n+r,i-o*u),new t.datavisualization.Diagram.Point(n+r,i),e),this.bezierCurve(t.datavisualization.Diagram.Point(n+r,i),new t.datavisualization.Diagram.Point(n+r,i+o*u),new t.datavisualization.Diagram.Point(n+o*r,i+u),new t.datavisualization.Diagram.Point(n,i+u),e),this.bezierCurve(t.datavisualization.Diagram.Point(n,i+u),new t.datavisualization.Diagram.Point(n-o*r,i+u),new t.datavisualization.Diagram.Point(n-r,i+o*u),new t.datavisualization.Diagram.Point(n-r,i),e),this.bezierCurve(t.datavisualization.Diagram.Point(n-r,i),new t.datavisualization.Diagram.Point(n-r,i-o*u),new t.datavisualization.Diagram.Point(n-o*r,i-u),new t.datavisualization.Diagram.Point(n,i-u),e));s.stroke();s.closePath();f&&f.angle&&s.restore()},i.prototype.circle=function(n,t,i,r,u){var f=this.document.getContext("2d");u&&this.setStyle(u,f);r&&r.angle&&this.rotateContext(r,f);u&&u.dashArray?(f.beginPath(),f.arc(n,t,i,0,2*Math.PI),f.fill(),f.stroke(),f.closePath()):this.ellipse(n,t,i*2,i*2,r,u);r&&r.angle&&f.restore()},i.prototype.arc=function(n,t,i,r,u,f){var o={angle:r,x:n,y:t},e=this.document.getContext("2d"),s,h;f&&this.setStyle(f,e);o&&o.angle&&this.rotateContext(o,e);e.beginPath();s=0;h=Math.PI;u||(s=Math.PI,h=0);f&&f.dashArray?e.arc(n,t,i,s,h):e.arc(n,t,i,s,h);e.stroke();e.closePath();o&&o.angle&&e.restore()},i.prototype.path=function(n,i,r,u,f,e,o){var h=this.document.getContext("2d"),pt,tt,it,s,wt,g;o&&this.setStyle(o,h);h.beginPath();pt=i;tt=r;h.translate(pt,tt);e&&e.angle&&this.rotateContext(e,h);it=document.createElementNS("http://www.w3.org/2000/svg","path");it.setAttribute("d",n);this.document.appendChild(it);for(var ti=this.getSegments(it),fi=i,ei=r,et,ot,k,d,st,ht,ct=ti,i=0,r=0,lt=0,ii=ct.length;lt<ii;++lt){s=ct[lt];wt=s.command;"x1"in s&&(k=s.x1);"x2"in s&&(st=s.x2);"y1"in s&&(d=s.y1);"y2"in s&&(ht=s.y2);"x"in s&&(i=s.x);"y"in s&&(r=s.y);switch(wt){case"M":h.moveTo(i,r);s.x=i;s.y=r;break;case"L":h.lineTo(i,r);s.x=i;s.y=r;break;case"C":h.bezierCurveTo(k,d,st,ht,i,r);s.x=i;s.y=r;s.x1=k;s.y1=d;s.x2=st;s.y2=ht;break;case"Q":h.quadraticCurveTo(k,d,i,r);s.x=i;s.y=r;s.x1=k;s.y1=d;break;case"A":var w=new t.datavisualization.Diagram.Point(et,ot),c=s.r1,l=s.r2,v=s.angle*(Math.PI/180),ri=s.largeArcFlag,rt=s.sweepFlag,b=new t.datavisualization.Diagram.Point(i,r),a=new t.datavisualization.Diagram.Point(Math.cos(v)*(w.x-b.x)/2+Math.sin(v)*(w.y-b.y)/2,-Math.sin(v)*(w.x-b.x)/2+Math.cos(v)*(w.y-b.y)/2),at=Math.pow(a.x,2)/Math.pow(c,2)+Math.pow(a.y,2)/Math.pow(l,2);at>1&&(c*=Math.sqrt(at),l*=Math.sqrt(at));g=(ri==rt?-1:1)*Math.sqrt((Math.pow(c,2)*Math.pow(l,2)-Math.pow(c,2)*Math.pow(a.y,2)-Math.pow(l,2)*Math.pow(a.x,2))/(Math.pow(c,2)*Math.pow(a.y,2)+Math.pow(l,2)*Math.pow(a.x,2)));isNaN(g)&&(g=0);var y=new t.datavisualization.Diagram.Point(g*c*a.y/l,g*-l*a.x/c),p=new t.datavisualization.Diagram.Point((w.x+b.x)/2+Math.cos(v)*y.x-Math.sin(v)*y.y,(w.y+b.y)/2+Math.sin(v)*y.x+Math.cos(v)*y.y),bt=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2))},ut=function(n,t){return(n[0]*t[0]+n[1]*t[1])/(bt(n)*bt(t))},kt=function(n,t){return(n[0]*t[1]<n[1]*t[0]?-1:1)*Math.acos(ut(n,t))},ft=kt([1,0],[(a.x-y.x)/c,(a.y-y.y)/l]),vt=[(a.x-y.x)/c,(a.y-y.y)/l],yt=[(-a.x-y.x)/c,(-a.y-y.y)/l],nt=kt(vt,yt);ut(vt,yt)<=-1&&(nt=Math.PI);ut(vt,yt)>=1&&(nt=0);var ui=1-rt?1:-1,dt=ft+ui*(nt/2),oi=new t.datavisualization.Diagram.Point(p.x+c*Math.cos(dt),p.y+l*Math.sin(dt));if(s.centp=p,s.xAxisRotation=v,s.rx=c,s.ry=l,s.a1=ft,s.ad=nt,s.sweepFlag=rt,h!=null){var ut=c>l?c:l,gt=c>l?1:c/l,ni=c>l?l/c:1;h.save();h.translate(p.x,p.y);h.rotate(v);h.scale(gt,ni);h.arc(0,0,ut,ft,ft+nt,1-rt);h.scale(1/gt,1/ni);h.rotate(-v);h.translate(-p.x,-p.y);h.restore()}break;case"Z":case"z":h.closePath();i=et;r=ot}et=i;ot=r}h.fill();o&&o.dashArray?this.drawDashedPath(ct,o):h.stroke();h.translate(-tt,-tt);e&&e.angle&&h.restore()},i.prototype.getSegments=function(i){for(var r,a,c,l,k,u,e,o,v,y,p,w,d,g,nt=t.datavisualization.Diagram.Util.convertPathToArray(i.getAttribute("d")),f=[],s=0,h=0,b=0,tt=nt.length;b<tt;++b){r=nt[b];a=r.pathSegTypeAsLetter;"x1"in r&&(v=r.x1);"x2"in r&&(p=r.x2);"y1"in r&&(y=r.y1);"y2"in r&&(w=r.y2);"x"in r&&(s=r.x);"y"in r&&(h=r.y);switch(a){case"M":f.push({command:"M",x:s,y:h});break;case"L":f.push({command:"L",x0:e,y0:o,x:s,y:h});break;case"H":f.push({command:"L",x0:e,y0:o,x:s,y:o});break;case"V":f.push({command:"L",x0:e,y0:o,x:e,y:h});break;case"C":f.push({command:"C",x0:e,y0:o,x1:v,y1:y,x2:p,y2:w,x:s,y:h});break;case"S":u&&(c=u.command=="C"||u.command=="S"?{x:u.x2,y:u.y2}:{x:u.x0,y:u.y0},l=new t.datavisualization.Diagram.Point(2*e-c.x,2*o-c.y),f.push({command:"C",x0:e,y0:o,x1:l.x,y1:l.y,x2:p,y2:w,x:s,y:h}));break;case"Q":f.push({command:"Q",x0:e,y0:o,x1:v,y1:y,x:s,y:h});break;case"T":u&&(c=u.command=="Q"?{x:u.x1,y:u.y1}:{x:u.x0,y:u.y0},l=new t.datavisualization.Diagram.Point(2*e-c.x,2*o-c.y),f.push({command:"Q",x0:e,y0:o,x1:l.x,y1:l.y,x:s,y:h}));break;case"A":k=n.extend(!0,{},r);k.command="A";f.push(k);break;case"Z":case"z":f.push({command:"L",x0:s,y0:h,x:d,y:g});s=e;h=o}u=f[f.length-1];(a==="M"||a==="m")&&(d=s,g=h);e=s;o=h}return f},i.prototype.drawDashedPath=function(n,i){for(var r,p,u,h,c,v,y,o,s,l,f=0,e=0,a=0,k=n.length;a<k;++a){r=n[a];p=r.command;"x1"in r&&(h=r.x1);"x2"in r&&(v=r.x2);"y1"in r&&(c=r.y1);"y2"in r&&(y=r.y2);"x"in r&&(f=r.x);"y"in r&&(e=r.y);switch(p){case"M":l={x:f,y:e};break;case"L":this.dashedLine(o,s,f,e,i.dashArray);break;case"H":this.dashedLine(o,s,f,s,i.dashArray);break;case"V":this.dashedLine(o,s,o,e,i.dashArray);break;case"C":this.bezierCurve(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(f,e),i);break;case"Q":this.quadraticCurve(t.datavisualization.Diagram.Point(o,s),t.datavisualization.Diagram.Point(h,c),t.datavisualization.Diagram.Point(f,e),i);break;case"A":if(u=this.document.getContext("2d"),u!=null){var d=r.rx>r.ry?r.rx:r.ry,w=r.rx>r.ry?1:r.rx/r.ry,b=r.rx>r.ry?r.ry/r.rx:1;u.save();u.translate(r.centp.x,r.centp.y);u.rotate(r.xAxisRotation);u.scale(w,b);this.dashedArc(d,0,0,r.a1,r.a1+r.ad,1-r.sweepFlag,i.dashArray);u.scale(1/w,1/b);u.rotate(-r.xAxisRotation);u.translate(-r.centp.x,-r.centp.y);u.restore()}break;case"Z":case"z":this.dashedLine(f,e,l.x,l.y,i.dashArray);f=o;e=s}o=f;s=e}},i.prototype.calculateCirclePoints=function(n,i,r,u,f,e){var h,o,s,c;for(u=u*180/Math.PI,f=f*180/Math.PI,h=2*Math.PI*n*(Math.abs(u-f)/360)*.7,o=Math.abs(u-f)/h,o=e?o*-1:o,s=0,c=[];s<h;)c.push(t.datavisualization.Diagram.Geometry.transform({x:i,y:r},u+o*s,n)),s++;return c},i.prototype.polygon=function(n,t,i){var u=this.document.getContext("2d"),r;for(u.beginPath(),t&&t.angle&&this.rotateContext(t,u),i&&this.setStyle(i,u),u.moveTo(n[0].x,n[0].y),r=1;r<n.length;r++)u.lineTo(n[r].x,n[r].y);if(u.lineTo(n[0].x,n[0].y),u.fill(),i&&i.dashArray){for(r=1;r<n.length;r++)this.line(n[r-1],n[r],i);this.line(n[r-1],n[0],i)}u.stroke();u.closePath();t&&t.angle&&u.restore()},i.prototype.image=function(n,t,i,r,u,f,e){var o=this.document.getContext("2d");o.beginPath();f&&f.angle&&this.rotateContext(f,o);e&&this.setStyle(e,o);r&&u?o.drawImage(n,t,i,r,u):o.drawImage(n,t,i);o.closePath();f&&f.angle&&o.restore()},i.prototype.text=function(n,t,i,r,u){var f=this.document.getContext("2d");f.beginPath();r&&r.angle&&this.rotateContext(r,f);u&&this.setStyle(u,f);f.fillText(n.text,t,i);f.closePath();r&&r.angle&&f.restore()},i.prototype.line=function(n,t,i,r,u){var f=this.document.getContext("2d");r||(f.beginPath(),i&&this.setStyle(i,f));i&&i.dashArray?this.dashedLine(n.x,n.y,t.x,t.y,i.dashArray):(r||f.moveTo(n.x,n.y),f.lineTo(t.x,t.y),f.stroke());u||f.closePath()},i.prototype.polyline=function(n,t){var r=this.document.getContext("2d"),i;for(r.beginPath(),t&&this.setStyle(t,r),i=1;i<n.length;i++)this.line(n[i-1],n[i],t);r.stroke()},i.prototype.bezierCurve=function(n,t,i,r,u){var f=this.document.getContext("2d"),e,c,o,h;if(f.beginPath(),f.moveTo(n.x,n.y),u&&this.setStyle(u,f),u&&u.dashArray){for(e=[],this.flattenCubicBezier(e,n,t,i,r),c=0,o=0;o<u.dashArray.length;o++)c+=Number(u.dashArray[o]);var a=e.length/c,l=!0,s=0;for(o=0;o<a;o++)for(h=0;h<u.dashArray.length;h++)s+=Number(u.dashArray[h]),s<e.length&&(l?f.lineTo(e[s].x,e[s].y):f.moveTo(e[s].x,e[s].y)),l=!l}else f.moveTo(n.x,n.y),f.bezierCurveTo(t.x,t.y,i.x,i.y,r.x,r.y);f.stroke()},i.prototype.quadraticCurve=function(n,t,i,r){var u=this.document.getContext("2d"),f,h,e,s;if(u.beginPath(),u.moveTo(n.x,n.y),r&&this.setStyle(r,u),r&&r.dashArray){for(f=[],this.flattenQuadraticBezier(f,n,t,i),h=0,e=0;e<r.dashArray.length;e++)h+=Number(r.dashArray[e]);var l=f.length/h,c=!0,o=0;for(e=0;e<l;e++)for(s=0;s<r.dashArray.length;s++)o+=Number(r.dashArray[s]),o<f.length&&(c?u.lineTo(f[o].x,f[o].y):u.moveTo(f[o].x,f[o].y)),c=!c}else u.moveTo(n.x,n.y),u.quadraticCurveTo(t.x,t.y,i.x,i.y);u.stroke()},i.prototype.arrow=function(n,t,i,r,u){var f=this.document.getContext("2d");f.beginPath();u&&this.setStyle(u,f);t&&t.angle&&this.rotateContext(t,f);f.moveTo(n.x+i.width,n.y+i.height/2);f.lineTo(n.x,n.y);f.lineTo(n.x+i.width,n.y-i.height/2);r||(f.closePath(),f.fill());f.stroke();t&&t.angle&&f.restore()},i.prototype.diamond=function(n,t,i,r){var u=this.document.getContext("2d");u.beginPath();r&&this.setStyle(r,u);t&&t.angle&&this.rotateContext(t,u);u.moveTo(n.x+i.width,n.y);u.lineTo(n.x+i.width/2,n.y+i.height/2);u.lineTo(n.x,n.y);u.lineTo(n.x+i.width/2,n.y-i.height/2);u.lineTo(n.x+i.width,n.y);u.stroke();u.fill();u.closePath();t&&t.angle&&u.restore()},i.prototype.dashedLine=function(n,t,i,r,u){var f=this.document.getContext("2d");f.save();var o=i-n,s=r-t,h=Math.sqrt(o*o+s*s),l=Math.atan2(s,o);f.beginPath();f.translate(n,t);f.moveTo(0,0);f.rotate(l);for(var a=u.length,v=0,c=!0,e=0;h>e;)e+=Number(u[v++%a]),e>h&&(e=h),c?f.lineTo(e,0):f.moveTo(e,0),c=!c,f.stroke();f.restore()},i.prototype.dashedRectangle=function(n,t,i,r,u){this.dashedLine(n,t,n+i,t,u);this.dashedLine(n+i,t,n+i,t+r,u);this.dashedLine(n+i,t+r,n,t+r,u);this.dashedLine(n,t+r,n,t,u)},i.prototype.dashedArc=function(n,t,i,r,u,f,e){for(var o,h,l,a=0,s=0;s<e.length;s++)a+=Number(e[s]);o=this.calculateCirclePoints(n,t,i,r,u,f,a);h=this.document.getContext("2d");h.beginPath();var y=o.length/a,v=!0,c=0;for(s=0;s<y;s++)for(l=0;l<e.length;l++)c+=Number(e[l]),c<o.length&&(v?(h.lineTo(o[c].x,o[c].y),h.stroke()):h.moveTo(o[c].x,o[c].y)),v=!v;h.closePath()},i.prototype.absolutePath=function(n){for(var r,h,e,y,p,c,l,a,v,o=t.datavisualization.Diagram.Util.convertPathToArray(n.getAttribute("d")),u=0,f=0,s=0,w=o.length;s<w;++s){if(r=o[s],h=r.pathSegTypeAsLetter,/[MLHVCSQTA]/.test(h))"x"in r&&(u=r.x),"y"in r&&(f=r.y);else{"x1"in r&&(c=u+r.x1);"x2"in r&&(a=u+r.x2);"y1"in r&&(l=f+r.y1);"y2"in r&&(v=f+r.y2);"x"in r&&(u+=r.x);"y"in r&&(f+=r.y);switch(h){case"m":e={pathSegTypeAsLetter:"M",x:u,y:f};break;case"l":e={pathSegTypeAsLetter:"L",x:u,y:f};break;case"h":e={pathSegTypeAsLetter:"H",x:u};break;case"v":e={pathSegTypeAsLetter:"V",y:f};break;case"c":e={pathSegTypeAsLetter:"C",x:u,y:f,x1:c,y1:l,x2:a,y2:v};break;case"s":e={pathSegTypeAsLetter:"S",x:u,y:f,x2:a,y2:v};break;case"q":e={pathSegTypeAsLetter:"Q",x:u,y:f,x1:c,y1:l};break;case"t":e={pathSegTypeAsLetter:"T",x:u,y:f};break;case"a":e={pathSegTypeAsLetter:"A",x:u,y:f,r1:r1,r2:r2,angle:angle,largeArcFlag:largeArcFlag,sweepFlag:sweepFlag};break;case"z":case"Z":u=y;f=p;e=o[s]}e&&(o[s]=e)}(h==="M"||h==="m")&&(y=u,p=f)}return n.setAttribute("d",t.datavisualization.Diagram.Util.pathSegArrayAsString(o)),i.prototype._scalePathData=function(n,t,i,r){return n!==i?n=r!==i?n*t-(Number(i)*t-Number(i))+(r-Number(i)):Number(n)*t-(Number(i)*t-Number(i)):r!==i&&(n=r),n},n},i.prototype.setStyle=function(n,t){n.fill&&(t.fillStyle=n.fill);n.stroke&&(t.strokeStyle=n.stroke=="none"?"transparent":n.stroke);n.font&&(t.font=n.font);n.lineWidth&&(t.lineWidth=n.lineWidth)},i.prototype.rotateContext=function(n,t){t.save();t.translate(n.x,n.y);t.rotate(n.angle*Math.PI/180);t.translate(-n.x,-n.y)},i.prototype.pathBounds=function(n){for(var i,b,r,v,y,p,w,c,l,u,f,e,o,s=0,h=0,a=0,k=n.length;a<k;++a){i=n[a];b=i.command;a==0&&i.x&&i.y&&(u=e=i.x,f=o=i.y);"x1"in i&&(v=i.x1);"x2"in i&&(p=i.x2);"y1"in i&&(y=i.y1);"y2"in i&&(w=i.y2);"x"in i&&(s=i.x);"y"in i&&(h=i.y);switch(b){case"M":c=s;l=h;case"L":case"H":case"V":s&&(u=Math.min(s,u),e=Math.max(s,e));h&&(f=Math.min(h,f),o=Math.max(h,o));break;case"C":case"S":r=this.getBezierBounds(t.datavisualization.Diagram.Point(c,l),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(p,w),t.datavisualization.Diagram.Point(s,h));u=Math.min(r.x,u);e=Math.max(r.x+r.width,e);f=Math.min(r.y,f);o=Math.max(r.y+r.height,o);break;case"Q":case"q":case"T":r=this.getQuadraticBounds(t.datavisualization.Diagram.Point(c,l),t.datavisualization.Diagram.Point(v,y),t.datavisualization.Diagram.Point(s,h));u=Math.min(r.x,u);e=Math.max(r.x+r.width,e);f=Math.min(r.y,f);o=Math.max(r.y+r.height,o);break;case"Z":case"z":s=c;h=l}}return{x:u,y:f,width:e-u,height:o-f}},i.prototype.flattenCubicBezier=function(n,i,r,u,f,e){for(var e=1.5,h=Number((t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r)+t.datavisualization.Diagram.Geometry.distance(f,u))/e),s=0;s<=h;s++){var o=s/h,c=(1-o)*(1-o)*(1-o)*i.x+3*o*(1-o)*(1-o)*r.x+3*o*o*(1-o)*u.x+o*o*o*f.x,l=(1-o)*(1-o)*(1-o)*i.y+3*o*(1-o)*(1-o)*r.y+3*o*o*(1-o)*u.y+o*o*o*f.y;n.push(new t.datavisualization.Diagram.Point(c,l))}},i.prototype.flattenQuadraticBezier=function(n,i,r,u,f){for(var f=1.5,s=Number((t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r))/f),o=0;o<=s;o++){var e=o/s,h=(1-e)*(1-e)*i.x+2*e*(1-e)*r.x+e*e*u.x,c=(1-e)*(1-e)*i.y+2*e*(1-e)*r.y+e*e*u.y;n.push(new t.datavisualization.Diagram.Point(h,c))}},i.prototype.getBezierBounds=function(n,i,r,u,f){for(var f=3,o,s,h,c,y=Number((t.datavisualization.Diagram.Geometry.distance(i,n)+t.datavisualization.Diagram.Geometry.distance(r,i)+t.datavisualization.Diagram.Geometry.distance(u,r))/f),l=0;l<=y;l++){var e=l/y,a=(1-e)*(1-e)*(1-e)*n.x+3*e*(1-e)*(1-e)*i.x+3*e*e*(1-e)*r.x+e*e*e*u.x,v=(1-e)*(1-e)*(1-e)*n.y+3*e*(1-e)*(1-e)*i.y+3*e*e*(1-e)*r.y+e*e*e*u.y;l==0?(o=h=a,s=c=v):(o=Math.min(a,o),s=Math.min(v,s),h=Math.max(a,h),c=Math.max(v,c))}return{x:o,y:s,width:h-o,height:c-s}},i.prototype.getQuadraticBounds=function(n,i,r,u){for(var u=3,e,o,s,h,v=Number((t.datavisualization.Diagram.Geometry.distance(i,n)+t.datavisualization.Diagram.Geometry.distance(r,i))/u),c=0;c<=v;c++){var f=c/v,l=(1-f)*(1-f)*n.x+2*f*(1-f)*i.x+f*f*r.x,a=(1-f)*(1-f)*n.y+2*f*(1-f)*i.y+f*f*r.y;c==0?(e=s=l,o=h=a):(e=Math.min(l,e),o=Math.min(a,o),s=Math.max(l,s),h=Math.max(a,h))}return{x:e,y:o,width:s-e,height:h-o}},i}();t.datavisualization.Diagram.Canvas=i;t.datavisualization.Diagram.CanvasContext={_renderDocument:function(n,i){var r={id:n.canvas.id+"_canvas",width:i._canvas.clientWidth,height:i._canvas.clientHeight,version:"1.1",xlink:"http://www.w3.org/1999/xlink",style:n.style,"pointer-events":"none"};n._canvas=new t.datavisualization.Diagram.Canvas(r);i._view=n.canvas;n.canvas.appendChild(n._canvas.document);n.type=="mainview"&&(this._canvas=n.canvas,i._svg=this._svg=n._canvas)},_renderGroupBackground:function(n,t){var i,r,u,f,e,o;n.pivot||(n.pivot={},n.pivot.x=.5,n.pivot.y=.5);i=t.document.getContext("2d");n.visible&&(r={angle:n.rotateAngle,x:n.offsetX,y:n.offsetY},i.save(),i.translate(r.x,r.y),i.rotate(r.angle*Math.PI/180),i.translate(-r.x,-r.y),i.fillStyle=n.type!="bpmn"?n.fillColor:"transparent",i.strokeStyle=n.type!="bpmn"?n.borderColor:"transparent",i.lineWidth=n.borderWidth,n.borderDashArray&&(n.borderDashArray.indexOf("[")!=-1||n.borderDashArray instanceof Array?u=n.borderDashArray:n.borderDashArray.indexOf(",")!=-1?u=n.borderDashArray.split(","):n.borderDashArray.indexOf(" ")!=-1&&(u=n.borderDashArray.split(" ")),i.setLineDash?i.setLineDash(u):i.mozDash?i.mozDash=u:f={dashArray:u}));e=n.offsetX-n.width*n.pivot.x;o=n.offsetY-n.height*n.pivot.y;t.rect(e,o,n.width,n.height,null,f);i.restore()},renderGroup:function(n,t,i){var u,f,o,r,c,l,e,s,h;if(n.visible){for(u=t.document.getContext("2d"),f={angle:n.rotateAngle,x:n.offsetX,y:n.offsetY},u.save(),this._renderGroupBackground(n,t,i),o=0;o<n.children.length;o++)r=i.nameTable[i._getChild(n.children[o])],r&&(r._type==="group"?this.renderGroup(r,t,i):r._type==="node"?this.renderNode(r,t):r.segments&&this.renderConnector(r,t));if(u.translate(f.x,f.y),u.rotate(f.angle*Math.PI/180),u.translate(-f.x,-f.y),c=n.offsetX-n.width*n.pivot.x,l=n.offsetY-n.height*n.pivot.y,n.isLane||(this.renderLabels(n,t),this.renderPorts(n,t,c,l)),n.isSwimlane&&i._renderCanvasPhase(n,t),n.annotation&&n._annotation&&n._annotation.length)for(e=0;e<n._annotation.length;e++)i.nameTable[n._annotation[e]]&&(s=i.nameTable[n._annotation[e]],h=i.getObjectType(s),h=="node"?this.renderNode(s,t):h=="connector"&&this.renderConnector(s,t));u.restore()}},_isExportable:function(n){var f=!0,e,i,r,u;if(n.type==="image")try{i=new t.datavisualization.Diagram.Canvas({id:"temp_canvas",width:100,height:100});r=i.document.getContext("2d");r.save();i.rect(0,0,n.width,n.height);u=new Image;u.src=n.source;i.image(u,0,0,n.width,n.height);r.restore();e=i.document.toDataURL()}catch(o){f=!1}return f},_isImageExportable:function(n){var f=!0,e,i,r,u;if(n.source)try{i=new t.datavisualization.Diagram.Canvas({id:"temp_canvas",width:100,height:100});r=i.document.getContext("2d");r.save();u=new Image;u.src=n.source;i.image(u,0,0,100,100);r.restore();e=i.document.toDataURL()}catch(o){f=!1}return f},renderNode:function(n,i){var r=i.document.getContext("2d"),e,o,p,s,l,h,c,w,a,v,y,b;if(n.visible&&this._isExportable(n)){var u=n.width||n._width||0,f=n.height||n._height||0,c={angle:n.rotateAngle,x:n.offsetX,y:n.offsetY};if(r.save(),r.translate(c.x,c.y),r.rotate(c.angle*Math.PI/180),r.translate(-c.x,-c.y),r.save(),r.fillStyle=n.fillColor,r.strokeStyle=n.borderColor=="none"||!n.borderWidth?"transparent":n.borderColor,r.lineWidth=n.borderWidth,r.globalAlpha=n.opacity,e=n.offsetX-u*n.pivot.x,o=n.offsetY-f*n.pivot.y,n._shape=="path"?this._renderGradient(n,r,0,0):this._renderGradient(n,r,e,o),p=n.fillColor,n.constraints&t.datavisualization.Diagram.NodeConstraints.Shadow){r.save();r.strokeStyle="lightgrey";s=t.datavisualization.Diagram.Geometry.transform({x:0,y:0},n.shadow.angle,n.shadow.distance);r.fillStyle=p!="none"||p!="transparent"?"lightgrey":"none";switch(n._shape){case"image":case"rectangle":n.cornerRadius?i.roundedRect(e+s.x,o+s.y,u,f,n.cornerRadius,null):i.rect(e+s.x,o+s.y,u,f,null);break;case"ellipse":i.ellipse(e+u/2+s.x,o+f/2+s.y,u/2,f/2,null);break;case"path":i.path(n._absolutePath,e+s.x,o+s.y,u,f,null);break;case"polygon":this._updatePolygonPoints(n);r.translate(s.x,s.y);i.polygon(n.points,null,h)}r.restore()}n.borderDashArray&&(n.borderDashArray.indexOf("[")!=-1||n.borderDashArray instanceof Array?l=n.borderDashArray:n.borderDashArray.indexOf(",")!=-1?l=n.borderDashArray.split(","):n.borderDashArray.indexOf(" ")!=-1&&(l=n.borderDashArray.split(" ")),r.setLineDash?r.setLineDash(l):r.mozDash?r.mozDash=l:h={dashArray:l});switch(n._shape){case"rectangle":n.cornerRadius?i.roundedRect(e,o,u,f,n.cornerRadius,null,h):i.rect(e,o,u,f,null,h);break;case"ellipse":i.ellipse(e+u/2,o+f/2,u/2,f/2,null,h);break;case"path":i.path(n._absolutePath,e,o,u,f,null,h);break;case"image":c={angle:n.rotateAngle,x:n.offsetX,y:n.offsetY};i.rect(e,o,u,f,null,h);w=new Image;w.src=n.source;i.image(w,e,o,u,f,null);break;case"text":i.rect(e,o,u,f,null,h);n.textBlock&&(a="",n.textBlock.italic&&(a+="italic "),n.textBlock.bold&&(a+="bold "),a+=n.textBlock.fontSize+" ",a+=n.textBlock.fontFamily,r.font=a,this._renderTextElement(n,n.textBlock,i));break;case"polygon":this._updatePolygonPoints(n);i.polygon(n.points,null,h)}if(r.restore(),this.renderPorts(n,i,e,o),n.type!="text"&&this.renderLabels(n,i),n.annotation&&n._annotation&&n._annotation.length)for(v=0;v<n._annotation.length;v++)diagram.nameTable[n._annotation[v]]&&(y=diagram.nameTable[n._annotation[v]],b=diagram.getObjectType(y),b=="node"?this.renderNode(y,i):b=="connector"&&this.renderConnector(y,i));r.restore()}},renderPhases:function(n,t,i){var f,r,u;n&&t&&(r=t.document.getContext("2d"),r.save(),r.strokeStyle=n.lineColor?n.lineColor:"black",r.lineWidth=n.lineWidth?n.lineWidth:1,n.lineDashArray&&(n.lineDashArray.indexOf("[")!=-1||n.lineDashArray instanceof Array?u=n.lineDashArray:n.lineDashArray.indexOf(",")!=-1?u=n.lineDashArray.split(","):n.lineDashArray.indexOf(" ")!=-1&&(u=n.lineDashArray.split(" ")),r.setLineDash?r.setLineDash(u):r.mozDash?r.mozDash=u:f={dashArray:u}),i&&i.length>0&&t.line(i[0],i[1],f));r.restore()},renderConnector:function(n,t){var i,r,f,u;if(n.visible&&(i=t.document.getContext("2d"),i.save(),i.strokeStyle=n.lineColor,i.lineWidth=n.lineWidth,n.lineDashArray&&(n.lineDashArray.indexOf("[")!=-1||n.lineDashArray instanceof Array?r=n.lineDashArray:n.lineDashArray.indexOf(",")!=-1?r=n.lineDashArray.split(","):n.lineDashArray.indexOf(" ")!=-1&&(r=n.lineDashArray.split(" ")),i.setLineDash?i.setLineDash(r):i.mozDash?i.mozDash=r:f={dashArray:r}),n.segments&&this._renderSegments(n,t,f),i.restore(),this._renderDecorators(n,t),this.renderLabels(n,t),n.shape))for(u=0;u<n._inlineDecorators.length;u++)this.renderNode(n._inlineDecorators[u],t)},_renderSegments:function(n,i,r){for(var f,d,ut,u,w,b,g,nt,v,c,a,it,h,l,e,p,rt,o,s=0;s<n.segments.length;s++){if(f=n.segments[s],f._bridges.length>0)for(d=0;d<f._bridges.length;d++)ut=f._bridges[d],ut._rendered=!1;if(u=f.points,w=i._diagram,s==0?(w&&n.sourceNode&&(g=w._findNode(n.sourceNode)),u=t.datavisualization.Diagram.SvgContext._clipDecorators(n,f,!0,g),f.type=="bezier"&&n.sourceDecorator&&n.sourceDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(u[0]=t.datavisualization.Diagram.Util._adjustPoint(u[0],f._point1,!0,n.lineWidth)),a=u[0],b=!0):b=!1,s==n.segments.length-1&&(w&&n.targetNode&&(g=w._findNode(n.targetNode)),u=t.datavisualization.Diagram.SvgContext._clipDecorators(n,f,!1,g),a&&n.segments.length<2&&(u[0]=a,a=null),nt=!0),n.shape&&n.shape.flow=="sequence"&&n.shape.sequence=="default"&&s==0){v={x:f.points[0].x,y:f.points[0].y};c=t.datavisualization.Diagram.Geometry.distance(f.points[0],f.points[1]);c=Math.min(30,c/2);var y=t.datavisualization.Diagram.Geometry.findAngle(f.points[0],f.points[1]),tt=t.datavisualization.Diagram.Geometry.transform({x:v.x,y:v.y},y,c),k=t.datavisualization.Diagram.Geometry.transform({x:tt.x,y:tt.y},y+135,-12),ft=t.datavisualization.Diagram.Geometry.transform({x:k.x,y:k.y},y+135,24)}if(n.shape&&n.shape.flow=="sequence"&&n.shape.sequence=="default"&&s==0){v={x:f.points[0].x,y:f.points[0].y};c=t.datavisualization.Diagram.Geometry.distance(f.points[0],f.points[1]);c=Math.min(30,c/2);var y=t.datavisualization.Diagram.Geometry.findAngle(f.points[0],f.points[1]),tt=t.datavisualization.Diagram.Geometry.transform({x:v.x,y:v.y},y,c),k=t.datavisualization.Diagram.Geometry.transform({x:tt.x,y:tt.y},y+135,-12),ft=t.datavisualization.Diagram.Geometry.transform({x:k.x,y:k.y},y+135,24)}if(f.type=="bezier")a=u[0],it=f._endPoint,n.targetDecorator&&n.targetDecorator.shape!==t.datavisualization.Diagram.DecoratorShapes.None&&(it=t.datavisualization.Diagram.Util._adjustPoint(f._endPoint,f._point2,!0,n.lineWidth)),i.bezierCurve(a,f._point1,f._point2,it,r);else if(n.cornerRadius>0)for(e=0;e<u.length-1;e++)p=t.datavisualization.Diagram.Geometry.distance(u[e],u[e+1]),p>0&&(rt=l||h,l=s<n.segments.length-1||e<u.length-2?p<n.cornerRadius*2?this._adjustPoint(u[e],u[e+1],!1,p/2):this._adjustPoint(u[e],u[e+1],!1,n.cornerRadius):u[e+1],(s>0||e>0)&&(p<n.cornerRadius*2?(h=this._adjustPoint(u[e],u[e+1],!0,p/2),(s<n.segments.length-1||e<u.length-2)&&(l=null)):h=this._adjustPoint(u[e],u[e+1],!0,n.cornerRadius)),rt&&h?i.quadraticCurve(rt,u[e],h,r):h=u[e],f._bridges.length>0&&this._updateBridging(f,i,e+1,h?h:u[e],l?l:u[e+1],n.bridgeSpace,r,b&&o==1?!0:!1,nt&&o==u.length-1?!0:!1),l&&(f._bridges.length>0||i.line(h,l,r)));else for(o=1;o<u.length;o++)f._bridges.length>0?this._updateBridging(f,i,o,u[o-1],u[o],n.bridgeSpace,r,b&&o==1?!0:!1,nt&&o==u.length-1?!0:!1):i.line(u[o-1],u[o],r,b&&o==1?!1:!0,nt&&o==u.length-1?!1:!0)}n.shape&&n.shape.flow=="sequence"&&n.shape.sequence=="default"&&i.line(k,ft,r)},_updateBridging:function(n,i,r,u,f,e,o,s,h){var a,v=this._findAngle(u,f),p=i._diagram.bridgeDirection(),y,l,c;if(n._bridges.length>0)if(n.type==="straight"){for(l=0;l<n._bridges.length;l++)if(c=n._bridges[l],!c._rendered){a=n._bridges[l-1]!=null&&n._bridges[l-1].segmentPointIndex==c.segmentPointIndex?n._bridges[l-1].endPoint:u;i.line(a,c.startPoint,o,!(s||l==0),!0);var w=c.startPoint.x+(c.endPoint.x-c.startPoint.x)/2,b=c.startPoint.y+(c.endPoint.y-c.startPoint.y)/2,k=t.datavisualization.Diagram.Util.sweepDirection(v,p,null,i._diagram);i.arc(w,b,e/2,v,k,o);n._bridges[l+1]!=null&&n._bridges[l+1].segmentPointIndex==c.segmentPointIndex?i.line(c.endPoint,n._bridges[l+1].startPoint,o,!1):i.line(c.endPoint,f,o,!1,!h);c._rendered=!0}}else if(n.type==="orthogonal"){for(y=u,l=0;l<n._bridges.length;l++)if(c=n._bridges[l],c.segmentPointIndex===r&&!c._rendered){a=n._bridges[l-1]!=null&&n._bridges[l-1].segmentPointIndex==c.segmentPointIndex?n._bridges[l-1].endPoint:u;i.line(a,c.startPoint,o,!(s||l==0),!0);var w=c.startPoint.x+(c.endPoint.x-c.startPoint.x)/2,b=c.startPoint.y+(c.endPoint.y-c.startPoint.y)/2,k=t.datavisualization.Diagram.Util.sweepDirection(v,p,null,i._diagram);i.arc(w,b,e/2,v,k,o);n._bridges[l+1]!=null&&n._bridges[l+1].segmentPointIndex==c.segmentPointIndex?i.line(c.endPoint,n._bridges[l+1].startPoint,o,!1):y=c.endPoint;c._rendered=!0}i.line(y,f,o,!1,!h)}},_findAngle:function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)*(180/Math.PI)},_adjustPoint:function(n,i,r,u){var f=r?{x:n.x,y:n.y}:{x:i.x,y:i.y},e;return n.x==i.x?n.y<i.y&&r||n.y>i.y&&!r?f.y+=u:f.y-=u:n.y==i.y?n.x<i.x&&r||n.x>i.x&&!r?f.x+=u:f.x-=u:r?(e=t.datavisualization.Diagram.Geometry.findAngle(n,i),f=t.datavisualization.Diagram.Geometry.transform(n,e,u)):(e=t.datavisualization.Diagram.Geometry.findAngle(i,n),f=t.datavisualization.Diagram.Geometry.transform(i,e,u)),f},renderLabels:function(n,t){for(var i,r,u=0;u<n.labels.length;u++)i=n.labels[u],r=t.document.getContext("2d"),r.save(),r.globalAlpha=i.opacity,r.lineWidth=i.borderWidth,r.strokeStyle=i.borderColor,i.text&&this._renderTextElement(n,i,t),r.restore()},renderPorts:function(n,i,r,u){for(var f,o,h,c,l,e=i.document.getContext("2d"),s=0;s<n.ports.length;s++)if(f=n.ports[s],!(f.visibility&t.datavisualization.Diagram.PortVisibility.Hidden||f.visibility&t.datavisualization.Diagram.PortVisibility.Hover||f.visibility&t.datavisualization.Diagram.PortVisibility.Connect)){o=t.datavisualization.Diagram.Util._getPortPosition(f,t.datavisualization.Diagram.Util.bounds(n,!0));e.fillStyle=f.fillColor;e.strokeStyle=f.borderColor;e.lineWidth=f.borderWidth;switch(f.shape){case"x":e.beginPath();e.moveTo(o.x-f.size/2,o.y-f.size/2);e.lineTo(o.x+f.size/2,o.y+f.size/2);e.moveTo(o.x+f.size/2,o.y-f.size/2);e.lineTo(o.x-f.size/2,o.y+f.size/2);e.stroke();e.fill();e.closePath();break;case"circle":h=f.size/2;c=f.size/2;i.ellipse(o.x,o.y,h,c);break;case"square":i.rect(o.x-f.size/2,o.y-f.size/2,f.size,f.size);break;case"path":e.save();n._type=="group"?(e.translate(n.offsetX,n.offsetY),e.rotate(-n.rotateAngle*Math.PI/180),e.translate(-n.offsetX,-n.offsetY),n.rotateAngle&&(l={angle:n.rotateAngle,x:f._absolutePoint.x,y:f._absolutePoint.y}),i.path(f._absolutePath,0,0,f.size,f.size,l)):(r=o.x-n.width*f.offset.x,u=o.y-n.height*f.offset.y,i.path(f._absolutePath,r,u,f.size,f.size,null));e.restore()}}},_renderTextElement:function(n,t,i){var f,u,r,e;t&&(f={childNodes:[]},u=i.document.getContext("2d"),u.save(),r="",t.italic&&(r+="italic "),t.bold&&(r+="bold "),r+=t.fontSize+"px ",r+=t.fontFamily,u.font=r,e=this._wrapText(n,f,t,i),this._alignTextOnLabel(t,n,f,i,e),u.restore())},_alignTextOnLabel:function(n,i,r,u,f){var tt=i.width||i._width||0,pt=i.height||i._height||0,o={width:f&&f.width||n.width,height:r.childNodes.length*n.fontSize},v=t.datavisualization.Diagram.Util.bounds(i),e,it,k,at=u._diagram,rt,ut,ft,s,p,d,g,ot,w,c,ht,nt,ct,lt;i.segments&&n.relativeMode=="segmentpath"?(rt=t.datavisualization.Diagram.SvgContext._getConnectorHandlePosition(n,i,1,at),ut=rt.position,e={x:(ut.x-v.x)/v.width,y:(ut.y-v.y)/v.height},ft=t.datavisualization.Diagram.Util._alignLabelOnSegments(i,n,at,rt),k=ft.vAlign,it=ft.hAlign):(it=n.horizontalAlignment,k=n.verticalAlignment);e=t.datavisualization.Diagram.Util._getLabelPosition(n,v,e);var h={x:0,y:0},y={x:e.x,y:e.y},b=0;b=k==t.datavisualization.Diagram.VerticalAlignment.Top?e.y+o.height/2:k==t.datavisualization.Diagram.VerticalAlignment.Center?e.y:e.y-o.height/2;h.y=b;h.x=e.x;y.y=b;s=u.document.getContext("2d");n.textAlign=="justify"?r.childNodes.length>1?(s.textAlign="left",o.width=tt-2*n.borderWidth):s.textAlign="center":s.textAlign=n.textAlign;switch(it){case t.datavisualization.Diagram.HorizontalAlignment.Left:y.x=e.x+o.width/2;switch(s.textAlign){case t.datavisualization.Diagram.TextAlign.Left:h.x=e.x;break;case t.datavisualization.Diagram.TextAlign.Center:h.x=e.x+o.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:h.x=e.x+o.width}break;case t.datavisualization.Diagram.HorizontalAlignment.Center:y.x=e.x;switch(s.textAlign){case t.datavisualization.Diagram.TextAlign.Left:h.x=e.x-o.width/2;break;case t.datavisualization.Diagram.TextAlign.Center:h.x=e.x;break;case t.datavisualization.Diagram.TextAlign.Right:h.x=e.x+o.width/2}break;case t.datavisualization.Diagram.HorizontalAlignment.Right:y.x=e.x-o.width/2;switch(s.textAlign){case t.datavisualization.Diagram.TextAlign.Left:h.x=e.x-o.width;break;case t.datavisualization.Diagram.TextAlign.Center:h.x=e.x-o.width/2;break;case t.datavisualization.Diagram.TextAlign.Right:h.x=e.x}break;case t.datavisualization.Diagram.HorizontalAlignment.Stretch:y.x=e.x;h.x=e.x}d=v.x;g=v.y;i.segments||(d=i.offsetX-tt*i.pivot.x,g=i.offsetY-pt*i.pivot.y);var l=n.borderWidth||0,et=d+h.x+(f?f.x:0)-l/2,b=g+h.y-o.height/2-l/2;for(n.verticalAlignment=="stretch"?u.rect(et,v.y,o.width+l,v.height+l,null,{fill:n.fillColor&&!i._isHeader?n.fillColor:"transparent",stroke:l&&!i._isHeader?n.borderColor||"transparent":"transparent",lineWidth:l}):u.rect(et,b,o.width+l,o.height+l,null,{fill:n.fillColor?n.fillColor:"transparent",stroke:l?n.borderColor||"transparent":"transparent",lineWidth:l}),p={angle:n.rotateAngle,x:d+y.x,y:g+y.y},n.textAlign=="justify"&&(ot=Math.max(tt,n.width)-2*n.borderWidth),s.save(),s.translate(p.x,p.y),s.rotate(p.angle*Math.PI/180),s.translate(-p.x,-p.y),w=0;w<r.childNodes.length;w++){var a=r.childNodes[w],vt=et+a.x-f.x+l/2,yt=b+a.dy*w+n.fontSize*.8+l/2,st=s.measureText(a.text).width;if(ot>st&&w<r.childNodes.length-1&&(c=a.text,c[c.length-1]==" "&&(c=c.slice(0,c.length-1)),c[0]==" "&&(c=c.slice(1,c.length)),st=s.measureText(c).width,ht=c.split(" "),ht.length>1)){for(nt=(ot-st)/s.measureText(" ").width/(ht.length-1),nt=Math.round(nt),ct="",lt=0;lt<nt;lt++)ct+=" ";a.text=c.replace(" ",ct)}if(n.horizontalAlignment=="stretch")switch(n.textAlign){case"left":a.x=e.x-o.width/2;break;case"center":a.x=-o.width/2;break;case"right":a.x=-e.x-o.width/2}u.text({text:a.text},vt-a.x,yt,null,{fill:n.fontColor});n.textDecoration!="none"&&this._renderTextDecoration(vt-a.x,yt,s.measureText(a.text).width,n,u)}s.restore()},_wrapText:function(n,i,r,u){var b=r.text,c=t.datavisualization.Diagram.Util.bounds(n),e,v,f,h,w;n.segments?(e=c.width,v=c.height):(e=c.width-r.margin.left-r.margin.right,v=c.height-r.margin.top-r.margin.bottom);e-=2*(r.borderWidth?r.borderWidth:1);e=e<r.width?r.width:e;for(var l=b.split("\n"),y,s,a=u.document.getContext("2d"),p=r.wrapping=="wrapwithoverflow"?!0:!1,o=0;o<l.length;o++)if(f="",r.wrapping!="nowrap")for(h=r.wrapping=="wrapwithoverflow"?l[o].split(" "):l[o],s=0;s<h.length;s++)f+=(f&&p?" ":"")+h[s],y=a.measureText(f).width,y>=e?(i.childNodes[i.childNodes.length]={text:f},f=""):(p&&(w=f+(h[s+1]||""),a.measureText(w).width>e&&(i.childNodes[i.childNodes.length]={text:f},f="")),s==h.length-1&&(i.childNodes[i.childNodes.length]={text:f},f=""));else f+=l[o],i.childNodes[i.childNodes.length]={text:f};return this._wrapTextAlign(i,i.childNodes,r.fontSize,r.textAlign,a,n,r)},_wrapTextAlign:function(n,i,r,u,f,e,o){for(var s,c,h,a=t.datavisualization.Diagram.Util.bounds(e),l=0;l<i.length;l++){if(s=f.measureText(i[l].text).width,c=s,o.horizontalAlignment=="stretch")c=a.width,s=-c/2;else switch(u){case"left":s=0;break;case"center":s=-s/2;break;case"right":s=-s;break;case"justify":s=i.length>1?0:-s/2}i[l].x=Number(s);i[l].dy=r;h?(h.x=Math.min(h.x,s),h.width=Math.max(h.width,c)):h={x:s,width:c}}return h},_renderTextDecoration:function(n,t,i,r,u){var f=u.document.getContext("2d"),e,o;f.save();f.strokeStyle=r.fontColor;f.lineWidth=1;switch(f.textAlign){case"center":n-=i/2;break;case"right":n-=i}t+=2;switch(r.textDecoration){case"overline":t-=r.fontSize;break;case"line-through":t-=r.fontSize/2}e={x:n,y:t};o={x:n+i,y:t};u.line(e,o,null);f.restore()},_renderGradient:function(n,t,i,r){var f,o,s,u,e,h;if(n.gradient){for(u=0;u<n.gradient.stops.length;u++)f=f?Math.max(f,n.gradient.stops[u].offset):n.gradient.stops[u].offset,o=o?Math.min(o,n.gradient.stops[u].offset):n.gradient.stops[u].offset;if(n.gradient.type=="linear")for(s=t.createLinearGradient(i+n.gradient.x1,r+n.gradient.y1,i+n.gradient.x2,r+n.gradient.y2),u=0;u<n.gradient.stops.length;u++)e=n.gradient.stops[u],h=o<0?(f+e.offset)/(2*f):e.offset/f,s.addColorStop(h,e.color);else if(n.gradient.type=="radial")for(s=t.createRadialGradient(i+n.gradient.fx,r+n.gradient.fy,0,i+n.gradient.cx,r+n.gradient.cy,n.gradient.r),u=0;u<n.gradient.stops.length;u++)e=n.gradient.stops[u],h=o<0?(f+e.offset)/(2*f):e.offset/f,s.addColorStop(h,e.color);t.fillStyle=s}},_renderDecorators:function(n,i){var u,f,e=i._diagram,o,r,s;n.targetDecorator&&n.targetDecorator.shape&&(r=n.segments[n.segments.length-1],u=r.points[r.points.length-2],f=n.targetPoint,r.type=="bezier"&&(u=r._point2),n.targetNode&&e&&(o=e._findNode(n.targetNode),o&&o.borderColor!="none"&&(f=t.datavisualization.Diagram.Util._adjustPoint(f,u,!0,o.borderWidth/2))),this._renderDecorator(n.name+"_targetDecorator",f,u,n.targetDecorator,i));n.sourceDecorator&&n.sourceDecorator.shape&&(r=n.segments[0],u=n.sourcePoint,f=r.points[1],r.type=="bezier"&&(f=r._point1),n.sourceNode&&e&&(s=e._findNode(n.sourceNode),s&&s.borderColor!="none"&&(u=t.datavisualization.Diagram.Util._adjustPoint(u,f,!0,s.borderWidth/2))),this._renderDecorator(n.name+"_sourceDecorator",u,f,n.sourceDecorator,i))},_renderDecorator:function(n,i,r,u,f){var a,e=new t.datavisualization.Diagram.Size(u.width,u.height),s=f.document.getContext("2d"),h,o,c,l;s.fillStyle=u.fillColor;s.strokeStyle=u.borderColor=="none"?"transparent":u.borderColor;s.lineWidth=u.borderWidth;h=t.datavisualization.Diagram.Geometry.findAngle(i,r);o={angle:h,x:i.x,y:i.y};switch(u.shape){case"arrow":f.arrow(i,o,e);break;case"openarrow":f.arrow(i,o,e,!0);break;case"circle":c=e.width/2;l=e.height/2;f.ellipse(i.x+e.width/2,i.y,c,l,o);break;case"diamond":f.diamond(i,o,e);break;case"path":f.path(u._absolutePath,0,0,e.width,e.height,o)}return a},_updatePolygonPoints:function(n){var r,f,e;if(n.points){var o=n.width||n._width||0,s=n.height||n._height||0,i=n.points;if(i.length){this._scalePoints(i,n);var u=t.datavisualization.Diagram.Geometry.rect(i),h=n.offsetX-o*n.pivot.x-u.x,c=n.offsetY-s*n.pivot.y-u.y;for(r=0,f=i.length;r<f;++r)e=t.datavisualization.Diagram.Geometry.translate(i[r],h,c),i[r]=e}}},_scalePoints:function(n,i){var u=t.datavisualization.Diagram.Geometry.rect(n),r,f;if(u.width>0&&u.height>0){var e=i.width||i._width||0,o=i.height||i._height||0,s=e/u.width,h=o/u.height;for(r=0,f=n.length;r<f;++r)n[r].x=n[r].x*s,n[r].y=n[r].y*h}},updateNode:function(n,t){this.refreshCanvas(n,t)},updateConnector:function(n,t){this.refreshCanvas(n,t)},updateGroup:function(n,t){this.refreshCanvas(n,t)},refreshCanvas:function(n,t){var r=t.document.getContext("2d"),u,i;for(r.save(),view.scale&&r.scale(1/view.scale.x,1/view.scale.y),u={x:t.document.offsetLeft,y:t.document.offsetTop,width:t.document.offsetWidth,height:t.document.offsetHeight},r.clearRect(u.x,u.y,u.width,u.height),view.scale&&r.scale(view.scale.x,view.scale.y),r.restore(),i=0;i<n.nodes.length;i++)n.nodes[i]._type==="node"?this.renderNode(n.nodes[i],t):n.nodes[i]._type==="group"&&this.renderGroup(n.nodes[i],t);for(i=0;i<n.connectors.length;i++)this.renderConnector(n.connectors[i],t)},updateViewport:function(){},addNodeLabel:function(n,t){this.refreshCanvas(n,t)},updateLabel:function(n,t){this.refreshCanvas(n,t)},setNodeShape:function(n,t){this.refreshCanvas(n,t)},setLine:function(n,t){this.refreshCanvas(n,t)},renderDecorators:function(n,t){this.refreshCanvas(n,t)},clearDecorators:function(n,t){this.refreshCanvas(n,t)},updateTargetDecoratorStyle:function(n,t){this.refreshCanvas(n,t)},updateSourceDecoratorStyle:function(n,t){this.refreshCanvas(n,t)},_updateNodeStyle:function(n,t){this.refreshCanvas(n,t)},updateLabelStyle:function(n,t){this.refreshCanvas(n,t)},updateConnectorStyle:function(n,t){this.refreshCanvas(n,t)},updateTextBlock:function(n,t,i){this.refreshCanvas(n,i)},removeChild:function(){this.refreshCanvas(model,canvas)}}}(jQuery,Syncfusion)});
