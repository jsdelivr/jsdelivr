/*!
*  filename: ej.pivotschemadesigner.min.js
*  version : 15.1.0.41
*  Copyright Syncfusion Inc. 2001 - 2017. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.touch.min","./../common/ej.draggable.min","./../common/ej.scroller.min","./ej.menu.min","./ej.togglebutton.min","./ej.button.min","./ej.checkbox.min","./ej.dialog.min","./ej.maskedit.min","./ej.waitingpopup.min","./ej.treeview.min","./../datavisualization/ej.chart.min"],n):n()})(function(){(function(n,t,i){t.widget("ejPivotSchemaDesigner","ej.PivotSchemaDesigner",{_rootCSS:"e-pivotschemadesigner",element:null,model:null,_requiresID:!0,validTags:["div","span"],defaults:{url:"",cssClass:"",height:n(this.element).parents(".e-pivotclient").length>0?"":"630px",width:"415px",locale:"en-US",layout:"excel",enableRTL:!1,pivotControl:null,pivotTableFields:[],pivotCalculations:[],pivotColumns:[],pivotRows:[],filters:[],olap:{showKpi:!1,showNamedSets:!1},enableWrapper:!1,enableDragDrop:!0,serviceMethods:{fetchMembers:"FetchMembers",nodeStateModified:"NodeStateModified",nodeDropped:"NodeDropped",removeButton:"RemoveButton",memberExpand:"MemberExpanded",filtering:"filtering"},customObject:{},beforeServiceInvoke:null,afterServiceInvoke:null,dragMove:null,applyFieldCaption:null},dataTypes:{serviceMethods:"data",customObject:"data",pivotControl:"data",pivotTableFieldList:"array",pivotCalculationList:"array",pivotColumnList:"array",pivotRowList:"array",filterList:"array"},locale:t.util.valueFunction("locale"),_init:function(){this._initPrivateProperties();this._load()},_destroy:function(){this.element.empty().removeClass("e-pivotschemadesigner"+this.model.cssClass)},_initPrivateProperties:function(){this._id=this.element.attr("id");this._dialogTitle="";this._currentMembers=[];this._memberTreeObj=null;this._tableTreeObj=null;this._dialogOKBtnObj=null;this._curFilteredText="";this._curFilteredAxis="";this._tempFilterData=null;this._droppedClass="";this._selectedTreeNode=null;this._selectedMember="";this._selectedLevel="";this._isDragging=!1;this._dataModel="";this._droppedPosition="";this._currentCubeName="";this._errorDialog="";this._nodeDropedParams="";this._contextMenuObj=null;this._removeButtonDeferUpdate=!1;this._isMeasureBtnRemove=!1;this._nodeCheck=!1;this._isFiltered=!1;this._curFocus={tree:null,node:null,tab:null,button:null};this._index={tree:0,node:0,tab:0,button:0};this._selectedFieldName="";this._selectedFieldCaption="";this._selectedFieldAxis="";this._isDropAction=!1},_load:function(){var u="",r,e,o,f,s;this.model.pivotControl!=null&&(this.model.pivotControl._schemaData=this,this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(u=JSON.parse(JSON.parse(this.model.pivotControl.getOlapReport()).ItemsProperties),r=JSON.parse(this.model.pivotControl.getOlapReport()),this.model.pivotControl._dataModel=="Pivot"?(r=this.model.pivotControl._filterReport(r),e=r.PivotRows.concat(r.PivotColumns,r.PivotCalculations,r.Filters),o=n.grep(u,function(t){return n.grep(e,function(n){t.id==(n.FieldHeader||n.DimensionHeader)&&(t.id=n.FieldName||n.DimensionName)}),t}),this._setTableFields(o)):this._setTableFields(u),this._setPivotRows(r.PivotRows),this._setPivotColumns(r.PivotColumns),this._setPivotCalculations(r.PivotCalculations),this._setFilters(r.Filters),this._dataModel=r.DataModel,this._currentCubeName=r.CurrentCube):(r=this.model.pivotControl.model.dataSource,this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(this.model.pivotTableFields=t.PivotAnalysis.getTreeViewData(this.model.pivotControl.model.dataSource))),this.model._waitingPopup?this._waitingPopup=this.model._waitingPopup:(n("#"+this._id).ejWaitingPopup({showOnInit:!0}),this._waitingPopup=n("#"+this._id).data("ejWaitingPopup")),this.element.width(this.model.width).height(this.model.height),pschemaDesignerWaitingPopup=this._waitingPopup,this._waitingPopup.show());this.model.enableWrapper?(this.element.show(),this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this._refreshPivotButtons():(this._setFilters(r.Filters),this.element.find(".axisTable .schemaFilter").append(this._createPivotButtons(this.model.filters,"filter")),this.element.find(".axisTable .schemaRow").append(this._createPivotButtons(this.model.pivotRows,"row")+(this._dataModel!="XMLA"||this.model.pivotCalculations.length==0?"":this.model.pivotCalculations[0].measures!=i&&this.model.pivotCalculations[0].measures.length>0&&this.model.pivotCalculations[0].axis!=i&&this.model.pivotCalculations[0].axis=="rows"?this._createPivotButtons([{fieldName:"Measures"}],"row"):"")),this.element.find(".axisTable .schemaColumn").append(this._createPivotButtons(this.model.pivotColumns,"column")+(this._dataModel!="XMLA"||this.model.pivotCalculations.length==0?"":this.model.pivotCalculations[0].measures!=i&&this.model.pivotCalculations[0].measures.length>0&&this.model.pivotCalculations[0].axis!=i&&this.model.pivotCalculations[0].axis=="columns"?this._createPivotButtons([{fieldName:"Measures"}],"column"):"")),this.element.find(".axisTable .schemaValue").append(this._createPivotButtons(this.model.pivotCalculations,"values")),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this.element.append(t.buildTag("div.deferUpdateLayout",t.buildTag("input.chkDeferUpdate","",{}).attr("type","checkbox")[0].outerHTML+t.buildTag("button.btnDeferUpdate",this._getLocalizedLabels("Update"),{}).attr("type","button")[0].outerHTML)[0].outerHTML),this.model.pivotControl!=null&&this.model.enableDragDrop&&this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button,enableRTL:this.model.enableRTL}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped:this._clientOnPvtBtnDropped,this),helper:t.proxy(function(t){if(n(t.element).addClass("dragHover"),t.sender.target.className.indexOf("e-btn")>-1){var i=n(t.sender.target).clone().attr("id",this._id+"_dragClone").appendTo("body");return n("#"+this._id+"_dragClone").removeAttr("style").height(n(t.sender.target).height()),i}return!1},this)})),this._reSizeHandler()):(f=(this.model.layout=="onebyone"?"":t.buildTag("table.headerTable",t.buildTag("tr",t.buildTag("td",t.buildTag("div.listHeader",t.buildTag("span.headerText",this._getLocalizedLabels("PivotTableFieldList"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.listSubhead",t.buildTag("span.subheadText",this._getLocalizedLabels("ChooseFieldsToAddToReport"),{})[0].outerHTML,{})[0].outerHTML,{}).attr("valign","top")[0].outerHTML,{})[0].outerHTML,{width:"100%",height:"10%"})[0].outerHTML)+t.buildTag("div.fieldTable",(this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?t.buildTag("div.cubelists",t.buildTag("input#cubeList.cubeList").attr("type","text")[0].outerHTML)[0].outerHTML:"")+t.buildTag("div.schemaFieldTree#schemaFieldTree",{},{width:"100%",overflow:"auto"})[0].outerHTML).attr("valign","top")[0].outerHTML,filterAxis=t.buildTag("div.axisTd1",t.buildTag("div.pivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("ReportFilter"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaFilter",t.buildTag("p#reportfilter","report filter",{display:"none"})[0].outerHTML+this._createPivotButtons(this.model.filters,"filter")).attr("aria-describedby","reportfilter").attr("aria-dropeffect","none").attr("aria-selected","false")[0].outerHTML,{})[0].outerHTML,columnAxis=t.buildTag("div.axisTd2",t.buildTag("div.rPivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("ColumnLabel"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaColumn",t.buildTag("p#columnlabel","column label",{display:"none"})[0].outerHTML+this._createPivotButtons(this.model.pivotColumns,"column")+(this._dataModel!="XMLA"||this.model.pivotCalculations.length==0?"":this.model.pivotCalculations[0].measures!=i&&this.model.pivotCalculations[0].measures.length>0&&this.model.pivotCalculations[0].axis!=i&&this.model.pivotCalculations[0].axis=="columns"?this._createPivotButtons([{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}],"column"):""),{})[0].outerHTML,{}).attr("aria-describedby","columnlabel").attr("aria-dropeffect","none").attr("aria-selected","false")[0].outerHTML,rowAxis=t.buildTag("div.axisTd1#axisTd",t.buildTag("div.pivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("RowLabel"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaRow",t.buildTag("p#rowlabel","row label",{display:"none"})[0].outerHTML+this._createPivotButtons(this.model.pivotRows,"row")+(this._dataModel!="XMLA"||this.model.pivotCalculations.length==0?"":this.model.pivotCalculations[0].measures!=i&&this.model.pivotCalculations[0].measures.length>0&&this.model.pivotCalculations[0].axis!=i&&this.model.pivotCalculations[0].axis=="rows"?this._createPivotButtons([{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}],"row"):""),{})[0].outerHTML,{}).attr("aria-describedby","rowlabel").attr("aria-dropeffect","none").attr("aria-selected","false")[0].outerHTML,values=t.buildTag("div.axisTd2#axisTd3",t.buildTag("div.rPivotHeader",t.buildTag("span.headerText",this._getLocalizedLabels("Values"),{})[0].outerHTML,{})[0].outerHTML+t.buildTag("div.schemaValue",t.buildTag("p#valuelabel","values",{display:"none"})[0].outerHTML+this._createPivotButtons(this.model.pivotCalculations,"values"),{}).attr("aria-describedby","valuelabel").attr("aria-dropeffect","none").attr("aria-selected","false")[0].outerHTML,{})[0].outerHTML,axisTable=t.buildTag("div.axisTable",this.model.layout=="onebyone"?columnAxis+rowAxis+filterAxis+values:t.buildTag("div",filterAxis+columnAxis,{})[0].outerHTML+t.buildTag("div",rowAxis+values,{})[0].outerHTML,this.model.enableRTL&&this.model.layout=="onebyone"?{position:"relative",left:"7px"}:{})[0].outerHTML,deferUpdate=t.buildTag("div.deferUpdateLayout",t.buildTag("input.chkDeferUpdate","",{}).attr("type","checkbox")[0].outerHTML+t.buildTag("button.btnDeferUpdate",this._getLocalizedLabels("Update"),{}).attr("type","button")[0].outerHTML)[0].outerHTML,htmlTag=this.model.enableRTL&&this.element.parents(".e-pivotclient").length>0&&oclientProxy.model.enableSplitter?axisTable+(this.model.layout=="onebyone"?"":t.buildTag("div.centerDiv")[0].outerHTML+t.buildTag("div.centerHead",this._getLocalizedLabels("DragFieldBetweenAreasBelow"))[0].outerHTML)+f+(n(this.element).parents(".e-pivotclient").length>0?"":t.buildTag("span.responsiveSchema","")[0].outerHTML)+(this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&n(this.element).parents(".e-pivotclient").length==0?deferUpdate:"")+(n(this.element).parents(".e-pivotclient").length>0?"":t.buildTag("div.schemaNoClick","")[0].outerHTML):f+(this.model.layout=="onebyone"?"":t.buildTag("div.centerDiv")[0].outerHTML+t.buildTag("div.centerHead",this._getLocalizedLabels("DragFieldBetweenAreasBelow"))[0].outerHTML)+axisTable+(n(this.element).parents(".e-pivotclient").length>0?"":t.buildTag("span.responsiveSchema","")[0].outerHTML)+(this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&n(this.element).parents(".e-pivotclient").length==0?deferUpdate:"")+(n(this.element).parents(".e-pivotclient").length>0?"":t.buildTag("div.schemaNoClick","")[0].outerHTML),n(htmlTag).appendTo("#"+this._id),this.element.parents(".e-pivotclient").length>0&&!oclientProxy.model.enableSplitter&&(oclientProxy.model.isResponsive&&this.element.find(".fieldTable").addClass("addedFieldTable"),this.model.enableRTL||this.element.find(".fieldTable").addClass("fieldDisSplitTable")),this.element.parents(".e-pivotclient").length>0&&oclientProxy.model.enableSplitter&&this.element.find(".fieldTable").addClass("fieldEnSplitTable"),this.model.enableRTL&&this.element.parents(".e-pivotclient").length>0&&(this.element.find(".fieldTable").addClass("clientFieldTable"),this.element.find(".fieldTable").addClass("rtlSplitTable"),this.element.parents(".e-pivotclient").length>0&&oclientProxy.model.enableSplitter&&this.element.find(".axisTable").addClass("clientAxisSplitterTable")),this.model.pivotControl!=null?((this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode||this.model.pivotControl.element.hasClass("e-pivotclient"))&&this._refreshPivotButtons(),this._reSizeHandler()):this.element.hide());this.model.enableDragDrop&&this.model.pivotControl&&this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button,enableRTL:this.model.enableRTL}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped:this._clientOnPvtBtnDropped,this),helper:t.proxy(function(t){if(n(t.element).addClass("dragHover"),t.sender.target.className.indexOf("e-btn")>-1){var i=n(t.sender.target).clone().attr("id",this._id+"_dragClone").appendTo("body");return n("#"+this._id+"_dragClone").removeAttr("style").height(n(t.sender.target).height()),i}return!1},this)});this.element.find(".pivotButton .filterBtn").ejButton({size:"normal",enableRTL:this.model.enableRTL,type:t.ButtonType.Button,contentType:"imageonly",prefixIcon:"filter"});this.model.pivotControl&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne&&(s={url:this.model.pivotControl.model.dataSource.data,cube:this.model.pivotControl.model.dataSource.cube,catalog:this.model.pivotControl.model.dataSource.catalog,request:"MDSCHEMA_CUBES"},t.Pivot._getTreeData(s,t.Pivot.getCubeList,{pvtCtrldObj:this,action:"loadcubelist",hierarchy:this._selectedField}),this.element.find(".cubeList").ejDropDownList({dataSource:this.model.cubeCollection,enableRTL:this.model.enableRTL,fields:{text:"name",value:"name"},width:"100%",height:"27px",change:t.proxy(this._cubeChanged,this),create:function(){n(this.wrapper.find(".e-input")).focus(function(){n(this).blur()})}}),ddlTarget=this.element.find(".cubeList").data("ejDropDownList"),t.isNullOrUndefined(ddlTarget)||ddlTarget.selectItemByText(this.model.pivotControl.model.dataSource.cube));this.element.find(".pivotButton input").ejToggleButton({size:"normal",enableRTL:this.model.enableRTL,contentType:"imageonly",defaultPrefixIcon:"ascending",activePrefixIcon:"descending",click:t.proxy(this._sortBtnClick,this)});this.model.pivotControl!=null&&(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot||this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?this._createTreeView(this,this.model.pivotTableFields):t.Pivot.generateTreeViewData(this));this.model.enableRTL&&this.element.addClass("e-rtl");this._createContextMenu();this._waitingPopup&&this._waitingPopup.hide();this._setPivotBtnWidth()},setCubeList:function(n){this.model.cubeCollection=n},refreshControl:function(){var i,t;for(n(this._tableTreeObj.element).ejTreeView("unCheckAll"),this._isDropAction=!0,i=this.model.pivotControl.model.dataSource,t=0;t<i.rows.length;t++)this._tableTreeObj.checkNode(i.rows[t].fieldName);for(t=0;t<i.columns.length;t++)this._tableTreeObj.checkNode(i.columns[t].fieldName);for(t=0;t<i.filters.length;t++)this._tableTreeObj.checkNode(i.filters[t].fieldName);for(t=0;t<i.values.length;t++)this._tableTreeObj.checkNode(i.values[t].fieldName);this._isDropAction=!1;this._refreshPivotButtons()},_cubeChanged:function(n){this.model.pivotControl.model.dataSource.cube!=n.selectedValue&&(oclientProxy._waitingPopup&&oclientProxy._waitingPopup.show(),this.model.pivotControl.model.dataSource.cube=n.selectedValue,this.model.pivotControl.model.dataSource.rows=this.model.pivotControl.model.dataSource.columns=this.model.pivotControl.model.dataSource.values=this.model.pivotControl.model.dataSource.filters=[],delete this.model.pivotControl._fieldData,this.element.find(".pivotButton").remove(),this.element.find(".schemaFieldTree").empty(),t.Pivot.generateTreeViewData(this,this.model.pivotControl.model.dataSource),oclientProxy.refreshControl())},_setPivotBtnWidth:function(){if(this.model.layout!="excel"&&this.model.pivotControl){var r=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?!0:!1,u=r?this._dataModel:this.model.pivotControl._dataModel,i=u=="Olap"||u=="XMLA"?15:20;n.each(this.element.find(".schemaRow .pvtBtn,.schemaColumn .pvtBtn"),function(t,u){n(u).attr("aria-describedby")=="Measures"?n(u).width(n(u).parent().width()-i-10):(n(u).width(n(u).parent().width()-3*i),this._dataModel!="Pivot"&&r&&n(".pivotButton:contains('"+n(u).text()+"'):first").find(".filtered").length>0&&n(u).parent().find(".filter").addClass("filtered"))});n.each(this.element.find(".schemaValue .pvtBtn"),function(t,r){n(r).width(n(r).parent().width()-i-10)});n.each(this.element.find(".schemaFilter .pvtBtn"),function(t,u){n(u).width(n(u).parent().width()-2*i-10);this._dataModel!="Pivot"&&r&&n(".pivotButton:contains('"+n(u).text()+"'):first").find(".filtered").length>0&&n(u).parent().find(".filter").addClass("filtered")})}else n.each(this.element.find(".pvtBtn"),function(t,i){n(i).width(n(i).parent().width()-15)})},_onContextOpen:function(n){t.Pivot._contextMenuOpen(n,this)},_contextClick:function(n){this.model.pivotControl._waitingPopup.show();var r=n.text==this._getLocalizedLabels("AddToColumn")?this.element.find(".schemaColumn"):n.text==this._getLocalizedLabels("AddToRow")?this.element.find(".schemaRow"):n.text==this._getLocalizedLabels("AddToValues")?this.element.find(".schemaValue"):n.text==this._getLocalizedLabels("AddToFilter")?this.element.find(".schemaFilter"):"",i={element:this._selectedMember,target:r[0],cancel:!1};this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped(i):this._clientOnPvtBtnDropped(i)},_createTreeView:function(r,u){var f,e,c,l,o,s,a,h;for(this.element.find(".schemaFieldTree").ejTreeView({showCheckbox:this.model.layout=="onebyone"?!1:!0,fields:{id:"id",parentId:"pid",text:this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode||this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?"name":"caption",isChecked:"isSelected",spriteCssClass:"spriteCssClass",dataSource:u},enableRTL:this.model.enableRTL,allowDragAndDrop:this.model.enableDragDrop?!0:!1,allowDropChild:!1,allowDropSibling:!1,dragAndDropAcrossControl:!0,beforeDelete:function(){return!1},cssClass:"pivotTreeViewDragedNode",nodeDropped:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._nodeDropped:this._clientOnNodeDropped,this),nodeDragStart:t.proxy(this._nodeDrag,this),nodeDrag:t.proxy(this._nodeDraged,this)}),f=[],this._tableTreeObj=this.element.find(".schemaFieldTree").data("ejTreeView"),this._tableTreeObj.element.find(".e-ul").css({width:"100%",height:"100%"}),this._tableTreeObj.element.find(".measureGroupCDB").parent().siblings(".e-chkbox-wrap").remove(),this._tableTreeObj.element.find(".folderCDB").parent().siblings(".e-chkbox-wrap").remove(),this._tableTreeObj.element.find(".dimensionCDB").parent().siblings(".e-chkbox-wrap").remove(),this.model.layout!=t.PivotSchemaDesigner.Layouts.OneByOne&&(this._tableTreeObj.element.find(".measureGroupCDB").parents("li").append(t.buildTag("span.elementSeparator")[0].outerHTML),this._tableTreeObj.element.find(".dimensionCDB").parents("li").append(t.buildTag("span.elementSeparator")[0].outerHTML)),this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne&&(f=this._tableTreeObj.element,n.map(u,function(t){t.defaultHierarchy&&n(f).find("li[id='"+t.tag+"']").attr("defaultHierarchy",t.defaultHierarchy)})),f=this._tableTreeObj.element.find("li"),e=0;e<f.length;e++)c=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?n(f[e]).attr("id"):this.model.pivotTableFields[e].tag,f[e].setAttribute("tag",c),l=n(f[e]).find(".e-chkbox-wrap"),n(l[0]).attr("aria-checked")=="true"&&n(n(f[e])).find(".folderCDB").length<=0&&n(f[e]).attr("tag").toLowerCase().indexOf("[measures]")==-1&&(this.model.pivotControl._dataModel=="XMLA"?n(f[e]).parents("li:eq(0)").length>0&&n(f[e]).parents("li:eq(0)").attr("tag").toLowerCase().indexOf("[measures]")==-1&&(o=t.Pivot.getReportItemByFieldName(n(f[e]).attr("tag"),this.model.pivotControl.model.dataSource,this._dataModel).item,!t.isNullOrUndefined(o)>0&&(o.isNamedSets==i||!o.isNamedSets)&&(s=t.buildTag("span.e-icon").css("display","inline-block").addClass("treeDrop").attr("role","button").attr("aria-label","filter button")[0].outerHTML,n(n(f[e]).find(".e-text")[0]).after(s))):(s=t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML,n(n(f[e]).find(".e-text")[0]).after(s)));this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?(this._tableTreeObj.model.nodeCheck=t.proxy(this._clientPivotCheckedStateModified,this),this._tableTreeObj.model.nodeUncheck=t.proxy(this._clientPivotCheckedStateModified,this)):(this._tableTreeObj.model.nodeCheck=t.proxy(this._checkedStateModified,this),this._tableTreeObj.model.nodeUncheck=t.proxy(this._checkedStateModified,this));this._tableTreeObj.element.find(".attributeCDB").parent().siblings("ul").remove();this._tableTreeObj.element.find(".attributeCDB").closest("div").find(".e-plus").remove();this._tableTreeObj.element.find(".hierarchyCDB").parent().parent().siblings("ul").find(".e-chkbox-wrap").remove();this._tableTreeObj.element.find(".e-plus").length==0&&this._tableTreeObj.element.find(".e-item").css("padding","0px");this.element.find(".schemaFilter, .schemaColumn, .schemaRow, .schemaValue").ejDroppable({});this.model.pivotControl!=null&&(a=t.buildTag("ul.pivotTreeContext#pivotTreeContext",t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToFilter"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToRow"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToColumn"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToValues"))[0].outerHTML)[0].outerHTML)[0].outerHTML,n(this.element).append(a),n("#pivotTreeContext").ejMenu({menuType:t.MenuType.ContextMenu,openOnClick:!1,enableRTL:this.model.enableRTL,contextMenuTarget:this._tableTreeObj.element,click:t.proxy(this._treeContextClick,this),beforeOpen:t.proxy(this._contextOpen,this),close:t.proxy(t.Pivot.closePreventPanel,this)}));this.model.pivotControl!=null&&(h=!1,this.model.pivotControl.model.enableDeferUpdate&&(h=!0),this.element.find(".btnDeferUpdate").ejButton({size:"mini",type:t.ButtonType.Button,enabled:h,click:t.proxy(this.model.pivotControl._deferUpdate,this.model.pivotControl)}),this.element.find(".chkDeferUpdate").ejCheckBox({text:this._getLocalizedLabels("DeferLayoutUpdate"),change:this._checkedChange,size:"normal",checked:h}));pschemaDesignerWaitingPopup.hide();this._unWireEvents();this._wireEvents()},_nodeDraged:function(n){this._trigger("dragMove",n)},_setFirst:!0,_setModel:function(t){for(var i in t)switch(i){case"OlapReport":this.setOlapReport(t[i]);break;case"locale":this._load();break;case"locale":case"enableRTL":n(this.element).html("");this._load()}},_wireEvents:function(){this._on(n(document),"keydown",this._keyDownPress);this._on(n(document),"keyup",t.proxy(function(n){n.keyCode===93&&n.preventDefault()}));this.model.layout!="excel"&&this.model.layout!=t.PivotSchemaDesigner.Layouts.OneByOne&&(this._on(this.element,"mouseover",".pivotButton .pvtBtnDiv",t.proxy(function(t){this._isDragging||n(t.target).find("button").removeClass("e-hoverBtn").addClass("e-hoverBtn")},this)),this._on(this.element,"mouseleave",".pivotButton .pvtBtnDiv",t.proxy(function(t){n(t.target).find("button").length>0?n(t.target).find("button").removeClass("e-hoverBtn"):n(t.target).removeClass("e-hoverBtn")},this)),this._on(this.element,"mouseover",".filter,.sorting,.removeBtn",t.proxy(function(t){this._isDragging||n(t.target.parentElement).find("button").removeClass("e-hoverBtn").addClass("e-hoverBtn")},this)),this._on(this.element,"mouseleave",".filter,.sorting,.removeBtn",t.proxy(function(t){n(t.target.parentElement).find("button").removeClass("e-hoverBtn")},this)));this._on(this.element,"mouseover",".pvtBtnDiv .pvtBtn",t.proxy(function(t){this._isDragging&&(this.element.find(".dropIndicator").removeClass("dropIndicatorHover"),n(t.target).parent().siblings(".dropIndicator").addClass("dropIndicatorHover"))},this));this._on(this.element,"mouseleave",".pivotButton",t.proxy(function(t){this._isDragging&&n(t.target).siblings(".dropIndicator").removeClass("dropIndicatorHover")},this));this._on(this.element,"mouseover",".pivotButton",t.proxy(function(t){n(t.target).attr("title",t.target.textContent)},this));this._tableTreeObj.element.find("li").mouseover(t.proxy(function(i){var u,r;n(i.target).siblings("span.e-icon.filter:eq(0)").length>0||n(i.target).find("span.e-icon.filter:eq(0)").length>0||n(i.target).parentsUntil("li").find("span.e-icon.filter:eq(0)").length>0?(u="-31px",this.element.find("span.e-icon.filter").attr("role","button").attr("aria-label","filtered")):(u="-20px",this.element.find("span.e-icon.treeDrop").attr("role","button").attr("aria-label","filter button"));r=n(i.target).siblings("span.e-icon.filter:eq(0)").length>0||n(i.target).find("span.e-icon.filter:eq(0)").length>0||n(i.target).parentsUntil("li").find("span.e-icon.filter:eq(0)").length>0?10:5;this.model.enableRTL?this.model.pivotControl.model.analysisMode!=t.Pivot.AnalysisMode.Pivot?n(i.target).siblings("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).siblings("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute",top:n(i.target).hasClass("filter")?n(i.target).position().top-22:n(i.target).position().top+2,left:n(i.target).hasClass("filter")?n(i.target).position().left+(6-r):(n(i.target).attr("role")==""?n(i.target).position().left:-2)+(5-r)}):n(i.target).find("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute"}):n(i.target).parentsUntil("li").find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute"}):n(i.target).siblings("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).siblings("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute",top:n(i.target).hasClass("filter")?n(i.target).position().top-22:n(i.target).position().top+2,left:n(i.target).hasClass("filter")?n(i.target).position().left+(7-r):n(i.target).position().left+(10-r)}):n(i.target).find("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute"}):n(i.target).parentsUntil("li").find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"absolute"}):n(i.target).siblings("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).siblings("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"static","margin-left":u}):n(i.target).find("span.e-icon.treeDrop:eq(0)").length>0?n(i.target).find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"static"}):n(i.target).parentsUntil("li").find("span.e-icon.treeDrop:eq(0)").css({display:"inline-block",position:"static"});n(i.target).parent().find(".measureGroupCDB, .folderCDB",this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?"":".dimensionCDB").length>0&&n(i.target).css("cursor","default")},this)).mouseout(t.proxy(function(){n(this._tableTreeObj.element).find("span.e-icon.treeDrop").css({display:"none"})},this));this._on(this.element,"click",".filterBtn,.filter",t.proxy(this._filterBtnClickCommon,this));this._on(this.element,"click",".sorting",t.proxy(this._sortBtnClick,this));this._on(this.element,"click",".removeBtn",t.proxy(this._removePvtBtn,this));this._on(this.element,"click",".pvtBtn",t.proxy(this._filterBtnClickCommon,this));this._on(this._tableTreeObj.element,"click",".treeDrop",t.proxy(this._filterBtnClickCommon,this));this._on(this.element,"click",".removeClientPivotBtn",t.proxy(this._removeBtnClick,this));this._on(this.element,"click",".removePivotBtn",t.proxy(this._removeBtnClick,this));this._on(this.element,"click",".ascOrder, .descOrder",t.proxy(this._sortField,this));this._on(this.element,"click",".collapseSchema",t.proxy(this._hideSchemaDesigner,this));this._on(this.element,"click",".expandSchema",t.proxy(this._showSchemaDesigner,this));this._on(this.element,"click",".nextPage, .prevPage, .firstPage, .lastPage",t.proxy(this._navigateTreeData,this));n(window).on("resize",n.proxy(this._reSizeHandler,this))},_navigateTreeData:function(n){t.Pivot.editorTreeNavigatee(n,this.model.pivotControl)},_filterBtnClickCommon:function(i){if(n(i.target).hasClass("pvtBtn")&&this.element.parents(".e-pivotclient").length>0||n(i.target).hasClass("treeDrop")||n(i.target).hasClass("filter"))if(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode)this._clientOnFilterBtnClick(i);else if(this.model.pivotControl.model.operationalMode!=t.Pivot.OperationalMode.ServerMode||t.isNullOrUndefined(n(i.target.nextElementSibling)))this._filterBtnClick(i);else{if(n(i.target.nextElementSibling).hasClass("treeDrop"))return!1;this._filterBtnClick(i)}},_unWireEvents:function(){this._off(this.element,"click",".filterBtn, .ascOrder, .descOrder, .nextPage, .prevPage, .firstPage, .lastPage");this._off(n(document),"keydown",this._keyDownPress);this._off(n(document),"keyup");this._off(this.element,"mouseover",".pivotButton");this._off(this.element,"mouseover",".pivotButton .pvtBtn");this._off(this.element,"mouseleave",".pivotButton");this._off(this.element,"click",".sorting");this._off(this.element,"click",".filter");this._off(this.element,"click",".removeBtn,.removeClientPivotBtn");this._off(this.element,"mouseover",".schemaFieldTree li");this._off(this.element,"mouseout",".schemaFieldTree li");this._off(this._tableTreeObj.element,"click",".treeDrop");this._off(this.element,"click",".ascOrder, .descOrder",t.proxy(this._sortField,this));this._off(this.element,"click",".filterBtn");this._off(this.element,"click",".pvtBtn");this._off(this._tableTreeObj.element,"click",".treeDrop");this._off(this._tableTreeObj.element,"click","li");this._off(this.element,"click",".removeClientPivotBtn, .removePivotBtn");n(window).off("resize",n.proxy(this._reSizeHandler,this))},_keyDownPress:function(i){var r,u,e,f;if((i.keyCode===40||i.which===38)&&(!t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)&&this.model.pivotControl._curFocus.tab.hasClass("e-text")||n("#"+this._id).find(".schemaFieldList .e-text:visible").hasClass("hoverCell"))&&!n(".editorTreeView:visible").length>0&&!n(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0?(n("#"+this._id).find(".hoverCell").removeClass("hoverCell"),this.model.pivotControl._curFocus.tab.mouseleave(),i.preventDefault(),r=n("#"+this._id).find(".schemaFieldTree .e-text:visible"),t.isNullOrUndefined(this._curFocus.tree)?(this._index.tree=i.which==40?1:i.which==38?r.length-1:0,this._curFocus.tree=r.eq(this._index.tree).attr("tabindex","-1")):(this._curFocus.tree.attr("tabindex","0").removeClass("hoverCell").mouseleave(),i.which===40?this._index.tree=this._index.tree+1>r.length-1?0:this._index.tree+1:i.which===38&&(this._index.tree=this._index.tree-1<0?r.length-1:this._index.tree-1),this._curFocus.tree=r.eq(this._index.tree).attr("tabindex","-1")),this._curFocus.tree.focus().addClass("hoverCell").mouseover(),n(".e-node-focus").removeClass("e-node-focus")):(i.which===40||i.which===38||i.which===37||i.which===39)&&!t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)&&this.model.pivotControl._curFocus.tab.hasClass("pvtBtn")&&!n(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0&&document.activeElement.className.startsWith("pvtBtn")?(i.preventDefault(),n("#"+this._id).find(".hoverCell").removeClass("hoverCell"),t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)||this.model.pivotControl._curFocus.tab.mouseleave().attr("tabindex","0").removeClass("hoverCell"),r=n("#"+this._id).find(".pvtBtn"),t.isNullOrUndefined(this._curFocus.button)?i.which===40||i.which===39?this._curFocus.button=r.eq(1).attr("tabindex","-1"):(i.which===38||i.which===37)&&(this._curFocus.button=r.eq(r.length-1).attr("tabindex","-1")):(this._curFocus.button.attr("tabindex","0").removeClass("hoverCell").mouseleave(),i.which===40||i.which===39?this._index.button=this._index.button+1>r.length-1?0:this._index.button+1:(i.which===38||i.which===37)&&(this._index.button=this._index.button-1<0?r.length-1:this._index.button-1),this._curFocus.button=r.eq(this._index.button)),this._curFocus.button.addClass("hoverCell").mouseover().focus()):(i.keyCode===40||i.which===38)&&n("#"+this._id).find(".editorTreeView:visible").length>0&&!t.isNullOrUndefined(n("#"+this._id).find(".e-dialog .e-text"))&&n(".e-dialog .e-text").hasClass("hoverCell")&&(n("#"+this._id).find(".editorTreeView .hoverCell").removeClass("hoverCell"),i.preventDefault(),r=n("#"+this._id).find(".e-dialog .e-text:visible"),t.isNullOrUndefined(this._curFocus.node)?(this._index.node=i.which==40?1:i.which==38?r.length-1:0,this._curFocus.node=r.eq(this._index.node).attr("tabindex","-1")):(this._curFocus.node.attr("tabindex","0").removeClass("hoverCell"),i.which===40?this._index.node=this._index.node+1>r.length-1?0:this._index.node+1:i.which===38&&(this._index.node=this._index.node-1<0?r.length-1:this._index.node-1),this._curFocus.node=r.eq(this._index.node).attr("tabindex","-1")),this._curFocus.node.focus().addClass("hoverCell"),n(".e-node-focus").removeClass("e-node-focus")),(i.which===39||i.which===37)&&n("#"+this._id).find(".schemaFieldTree .e-text:visible").hasClass("hoverCell")&&!n(".editorTreeView:visible").length>0?n("#"+this._id).find(".schemaFieldTree .hoverCell").parent().find(".e-plus,.e-minus").click():(i.which===39||i.which===37)&&n("#"+this._id).find(".editorTreeView .e-text:visible").hasClass("hoverCell")?n("#"+this._id).find(".editorTreeView .hoverCell").parent().find(".e-plus,.e-minus").click():i.which===9&&n("#"+this._id).find(".editorTreeView:visible").length>0&&(i.preventDefault(),n("#"+this._id).find(".e-dialog .hoverCell").removeClass("hoverCell"),this._curFocus.node=null,this._index.node=0,u=[],u.push(n("#"+this._id).find(".e-dialog .e-text").first()),n("#"+this._id).find(".dialogOKBtn:visible").hasClass("e-disable")||u.push(n("#"+this._id).find(".dialogOKBtn:visible")),u.push(n("#"+this._id).find(".dialogCancelBtn:visible")),u.push(n("#"+this._id).find(".e-close:visible")),t.isNullOrUndefined(this._curFocus.tab)?(this._index.tab=1,this._curFocus.tab=u[this._index.tab].attr("tabindex","-1")):(this._curFocus.tab.attr("tabindex","0").removeClass("hoverCell"),this._index.tab=this._index.tab+1>u.length-1?0:this._index.tab+1,this._curFocus.tab=u[this._index.tab].attr("tabindex","-1")),this._curFocus.tab.focus().addClass("hoverCell"),i.stopImmediatePropagation()),i.which===13&&n("#"+this._id).find(".hoverCell").length>0&&!n(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0){if(n("#"+this._id).find(".e-dialog:visible").length>0){if(n(i.target).hasClass("memberCurrentPage")){t.Pivot.editorTreeNavigatee(args,this.model.pivotControl);return}n("#"+this._id).find(".e-dialog .hoverCell").parent().find(".e-chkbox-small").length>0?n("#"+this._id).find(".e-dialog .hoverCell").parent().find(".e-chkbox-small").click():(n("#"+this._id).find(".e-dialog .hoverCell").click(),this._index.tab=0,t.isNullOrUndefined(this._curFocus.tree)?t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)||this.model.pivotControl._curFocus.tab.attr("tabindex","-1").focus().mouseover().addClass("hoverCell"):this._curFocus.tree.attr("tabindex","-1").focus().mouseover().addClass("hoverCell"))}else n("#"+this._id).find(".schemaFieldTree .hoverCell").length>0?n("#"+this._id).find(".schemaFieldTree .hoverCell").parent().find(".e-chkbox-small").click():n(".pivotTree:visible,.pivotTreeContext:visible,.pivotTreeContextMenu:visible").length>0&&(this._curFocus.button&&(e=this._curFocus.button.parent().attr("tag")),this.model.pivotControl._curFocus.button=n("#"+this._id).find("[tag='"+e+"'] button"),this.model.pivotControl._curFocus.button.attr("tabindex","-1").focus().addClass("hoverCell"));i.stopImmediatePropagation()}i.which===70&&i.ctrlKey&&(i.preventDefault(),n("#"+this._id).find(".treeDrop").length>0&&n("#"+this._id).find(".hoverCell").length>0&&n("#"+this._id).find(".hoverCell").parent().find(".treeDrop").click());i.keyCode===93&&(i.preventDefault(),f={x:n(".hoverCell").offset().left+n(".hoverCell").outerWidth(),y:n(".hoverCell").offset().top+n(".hoverCell").outerHeight()},n(".hoverCell").trigger({type:"mouseup",which:3,clientX:f.x,clientY:f.y,pageX:f.x,pageY:f.y}));((i.which===79||i.which===67)&&i.ctrlKey||i.which===27)&&n("#"+this._id).find(".hoverCell").length>0&&(i.keyCode==79&&n("#"+this._id).find(".e-dialog").length>0&&i.ctrlKey&&(i.preventDefault(),n("#"+this._id).find(".dialogOKBtn:visible").click()),i.keyCode==67&&n("#"+this._id).find(".e-dialog").length>0&&i.ctrlKey&&(i.preventDefault(),n("#"+this._id).find(".dialogCancelBtn:visible").click()),this._index.node=0,n("#"+this._id).find(".hoverCell").removeClass("hoverCell"),t.isNullOrUndefined(this._curFocus.tree)?t.isNullOrUndefined(this._curFocus.button)?t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)||this.model.pivotControl._curFocus.tab.attr("tabindex","-1").focus().mouseover().addClass("hoverCell"):this._curFocus.button.attr("tabindex","-1").focus().mouseover().addClass("hoverCell"):this._curFocus.tree.attr("tabindex","-1").focus().mouseover().addClass("hoverCell"))},_getLocalizedLabels:function(n){return t.PivotSchemaDesigner.Locale[this.locale()][n]===i?t.PivotSchemaDesigner.Locale["en-US"][n]:t.PivotSchemaDesigner.Locale[this.locale()][n]},_setTableFields:function(n){t.isNullOrUndefined(n)||(this.model.pivotTableFields=n)},_setPivotRows:function(n){t.isNullOrUndefined(n)||(this.model.pivotRows=n)},_setPivotColumns:function(n){t.isNullOrUndefined(n)||(this.model.pivotColumns=n)},_setPivotCalculations:function(n){t.isNullOrUndefined(n)||(this.model.pivotCalculations=n)},_setFilters:function(n){t.isNullOrUndefined(n)||(this.model.filters=n)},_getSortedHeaders:function(){for(var i=this.element.find(".descending").parents("label"),r="",t=0;t<i.length;t++)r+=n(i[t]).attr("for").replace("toggleBtn","")+"##";return r},_contextOpen:function(i){var u,r;if(n(i.target.parentElement).find(".measureGroupCDB").length>0||n(i.target.parentElement).find(".folderCDB").length>0||!(this.element.parents(".e-pivotclient").length>0)&&n(i.target.parentElement).find(".dimensionCDB").length>0||!n(i.target).hasClass("e-text"))return!1;t.Pivot.openPreventPanel(this);this._selectedMember=n(i.target);this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?(r=n("#pivotTreeContext").data("ejMenu"),n(i.target).parents("li:eq(0)").attr("tag").toLowerCase().indexOf("[measures]")>=0?(r.disableItem(this._getLocalizedLabels("AddToFilter")),r.disableItem(this._getLocalizedLabels("AddToRow")),r.disableItem(this._getLocalizedLabels("AddToColumn")),r.enableItem(this._getLocalizedLabels("AddToValues"))):(r.disableItem(this._getLocalizedLabels("AddToValues")),n(i.target.parentElement).find(".namedSetCDB").length>0?r.disableItem(this._getLocalizedLabels("AddToFilter")):r.enableItem(this._getLocalizedLabels("AddToFilter")),r.enableItem(this._getLocalizedLabels("AddToRow")),r.enableItem(this._getLocalizedLabels("AddToColumn")))):this._dataModel=="Pivot"&&(u=i.target.textContent,n(i.target).hasClass("e-text")&&(n(this.element).parents(".e-pivotclient").length>0||n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==u}).length==0)?(r=n("#pivotTreeContext").data("ejMenu"),r.enable()):(r=n("#pivotTreeContext").data("ejMenu"),r.disable()))},_nodeDrag:function(i){return this._isDragging=!0,(n(i.dragTarget.parentElement).find(".measureGroupCDB").length>0||n(i.dragTarget.parentElement).find(".folderCDB").length>0||n(i.dragTarget.parentElement).find(".dimensionCDB").length>0)&&!(n(i.dragTarget.parentElement).find(".dimensionCDB").length>0&&this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne)?!1:void 0},_treeContextClick:function(n){t.isNullOrUndefined(this._curFocus.tree)?t.isNullOrUndefined(this.model.pivotControl._curFocus.tab)||this.model.pivotControl._curFocus.tab.attr("tabindex","-1").focus().addClass("hoverCell"):this._curFocus.tree.attr("tabindex","-1").focus().addClass("hoverCell");var i=n.text==this._getLocalizedLabels("AddToColumn")?this.element.find(".schemaColumn"):n.text==this._getLocalizedLabels("AddToRow")?this.element.find(".schemaRow"):n.text==this._getLocalizedLabels("AddToValues")?this.element.find(".schemaValue"):n.text==this._getLocalizedLabels("AddToFilter")?this.element.find(".schemaFilter"):"",r={dropTarget:i,droppedElement:this._selectedMember.parent().parent(),target:i};this.model.pivotControl._waitingPopup.show();this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._nodeDropped(r):this._clientOnNodeDropped(r)},_checkedChange:function(t){var i=n(t.event.target).parents(".e-pivotschemadesigner").data("ejPivotSchemaDesigner"),r=n(".btnDeferUpdate").data("ejButton");t.isChecked?(i.model.pivotControl.model.enableDeferUpdate=!0,r.enable()):(i.model.pivotControl.model.enableDeferUpdate=!1,i.model.pivotControl._isUpdateRequired&&i.model.pivotControl._deferUpdate(),r.disable())},_sortBtnClick:function(i){var r;if(n(i.target).toggleClass("descending"),this.model.pivotControl._dataModel!="Olap"&&this.model.pivotControl._dataModel!="XMLA")if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){t.PivotAnalysis._valueSorting=null;var f=n(i.target).parents(".pivotButton").attr("tag").split(":")[1],e=this.model.pivotControl.model.dataSource[n(i.target).parents(".pivotButton").attr("tag").split(":")[0].toLowerCase()],u=n.grep(e,function(n){return n.fieldName==f}),o=i.target.className.indexOf("descending")>=0?t.PivotAnalysis.SortOrder.Descending:t.PivotAnalysis.SortOrder.Ascending;for(r=0;r<u.length;r++)u[r].sortOrder=o;this.model.pivotControl._populatePivotGrid()}else this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this.model.pivotControl._sortBtnClick(i)},_generateMembers:function(i,r){var u,e,h;if(i.action=="loadFieldElements"){this._memberCount=n(r).find("Axis:eq(0) Tuple").length;return}var o=n(r).find("Axis:eq(0) Tuple"),f=[],s={};for(f.push({id:"All",name:"All",checkedStatus:!0,tag:""}),u=0;u<o.length;u++)e=n(n(r).find("Axis:eq(0) Tuple:eq("+u+")").children().children()[0]).text(),h=n(n(r).find("Axis:eq(0) Tuple:eq("+u+")").children().children()[1]).text(),s={hasChildren:n(o[u]).find("CHILDREN_CARDINALITY").text()!="0",checkedStatus:!0,id:e.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"),name:h,tag:e},f.push(s);t.isNullOrUndefined(pschemaDesignerWaitingPopup)||pschemaDesignerWaitingPopup.hide();this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(f)})},_generateChildMembers:function(t,i){for(var e=n(i).find("Axis:eq(0) Tuple"),f=[],r=this.element.find("[tag='"+t.currentNode.replace(/&amp;/g,"&")+"']"),u=0;u<e.length;u++){var o=n(n(i).find("Axis:eq(0) Tuple:eq("+u+")").children().children()[0]).text(),s=n(n(i).find("Axis:eq(0) Tuple:eq("+u+")").children()).find("Caption").text(),h={hasChildren:n(e[u]).find("CHILDREN_CARDINALITY").text()!="0",checkedStatus:!1,id:o.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"),name:s,tag:o};f.push(h)}parentNode=n(r).parents("li").length>1?n(r).parents("li").first():n(r).parents("li");r.find(".e-load").removeClass("e-load");n(n(parentNode).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1});n.each(r.find("li"),function(n,t){t.setAttribute("tag",f[n].tag)});this._memberTreeObj=n(".editorTreeView").data("ejTreeView");this._memberTreeObj.addNode(f,n(r))},_sortField:function(i){if(t.Pivot.closePreventPanel(this),this.element.find(".e-dialog, .clientDialog").remove(),n(i.element).attr("id")=="descOrder"||n(i.element).attr("id")=="ascOrder"){var r=t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource).item;t.isNullOrUndefined(r)||(r.sortOrder=n(i.element).attr("id")=="descOrder"?t.olap.SortOrder.Descending:t.olap.SortOrder.Ascending);this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?this.model.pivotControl.refreshControl():(t.olap.base._clearDrilledCellSet(),t.olap.base.getJSONData({action:"sorting"},this.model.pivotControl.model.dataSource,this.model.pivotControl))}},_clientOnFilterBtnClick:function(i){var r;if(t.Pivot.openPreventPanel(this),this._waitingPopup.show(),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap){if(t.isNullOrUndefined(this.model.pivotControl._memberPageSettings)||(this.model.pivotControl._memberPageSettings.filterCollection=[]),n(i.target).parents().hasClass("pivotButton")&&n(i.target).parents(".pivotButton").attr("tag").indexOf(":[")>=0&&!(n(i.target).parents(".pivotButton").attr("tag").toLowerCase().indexOf("[measures]")>=0))this._selectedFieldName=n(i.target).parents(".pivotButton").attr("tag").split(":")[1];else{if(n(i.target).parents().attr("tag")!=null&&(n(i.target).parents().attr("tag").split(":")[1]=="Measures"||n(i.target).parent().attr("tag").toLowerCase().indexOf("[measures]")>=0))return t.Pivot.closePreventPanel(this),!1;this._selectedLevel=n(n(i.target).parents("li:eq(0)")).attr("tag");this._selectedFieldName=n(i.target).parents("li:eq(0)").children("div:eq(0)").find(".levels").length>0?n(n(i.target).parents("li:eq(1)")).attr("tag"):n(n(i.target).parents("li:eq(0)")).attr("tag")}if(t.isNullOrUndefined(this._selectedFieldName)||this._selectedFieldName.toLocaleLowerCase().indexOf("measures")>=0)return!1;var o=this._selectedFieldName,e=this.model.pivotControl.model.dataSource,f,u=n.map(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName==o&&(t.isNullOrUndefined(n.dataSrc)||n.dataSrc.cube==e.cube&&n.dataSrc.reportName==e.reportName))return f=n.pageSettings,n.filterItems});this.model.pivotControl.model.enableMemberEditorPaging&&(f&&(this._memberCount=f),this.model.pivotControl._memberPageSettings.endPage=this.model.pivotControl.model.memberEditorPageSize,this.model.pivotControl._memberPageSettings.startPage=0,this.model.pivotControl._memberPageSettings.currentMemeberPage=1);u.length>0?(this.model.pivotControl.model.enableMemberEditorPaging&&(u=n.grep(u,function(n){if(n.pageNo==1)return n})[0].memberTreeObj.dataSource()),this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(u)})):t.olap._mdxParser.getMembers(this.model.pivotControl.model.dataSource,this._selectedFieldName,this)}else this._selectedFieldName=n(i.target).parent().hasClass("pivotButton")&&n(i.target).parent().attr("tag").indexOf(":")>=0?n.grep(this.model.pivotTableFields,function(t){return t.caption==n(i.target).parent().attr("tag").split(":")[1]})[0].name:n.grep(this.model.pivotTableFields,function(t){return t.caption==n(n(i.target).parent()).text()})[0].name;r=n(this.element.find(".pivotButton button[fieldname='"+this._selectedFieldName+"']"));this._dialogHead=this._selectedFieldCaption=r.text();this._selectedFieldAxis=r.parents().hasClass("schemaRow")?"rows":r.parents().hasClass("schemaColumn")?"columns":r.parents().hasClass("schemaValue")?"values":"filters";this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(this._getTreeViewData())})},_getTreeViewData:function(){var s=this.model.pivotControl.model.dataSource[this._selectedFieldAxis],o=this._selectedFieldName,f=n.grep(s,function(n){return n.fieldName==o})[0],u=t.PivotAnalysis.getMembers(o),e=[{id:"All",name:"All",checkedStatus:!0}],r;if(f.filterItems!=null&&f.filterItems!=i)for(r=0;r<u.length;r++)e.push({id:u[r],name:u[r],checkedStatus:f.filterItems.filterType==t.PivotAnalysis.FilterType.Include?n.inArray(u[r].toString(),f.filterItems.values)>=0:n.inArray(u[r].toString(),f.filterItems.values)<0});else for(r=0;r<u.length;r++)e.push({id:u[r],name:u[r],checkedStatus:!0});return e},_filterBtnClick:function(i){var e,s,a,c,v,h,u,r,o,f,l,y;if(this.model.pivotControl._editorFlag=!1,t.Pivot.openPreventPanel(this),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){for(this.model.pivotControl._dataModel=="XMLA"?n(i.target).parents("li:eq(0)").length>0?(this._selectedLevel=n(n(i.target).parents("li:eq(0)")).attr("tag"),e=n(i.target).parents("li:eq(0)").children("div:eq(0)").find(".levels").length>0?n(n(i.target).parents("li:eq(1)")).attr("tag"):n(n(i.target).parents("li:eq(0)")).attr("tag")):(this._selectedLevel=n(i.target).parent().attr("tag").split(":")[1],e=n(i.target).parent().attr("tag").split(":")[1]):e=n.grep(this.model.pivotTableFields,function(t){return t.caption==n(n(i.target).parent()).text()})[0].name,r=0;r<this.element.find(".pivotButton").length;r++)if(uniqueName=n(this.element.find(".pivotButton")[r]).find("button").attr("fieldName"),uniqueName==e){s=n(this.element.find(".pivotButton")[r]).find("button").text();this._selectedAxis=n(this.element.find(".pivotButton")[r]).parent()[0].className.split(" ")[0];break}this._selectedAxis=this.model.pivotControl._selectedAxis=this._selectedAxis=="schemaRow"?"rows":this._selectedAxis=="schemaColumn"?"columns":this._selectedAxis=="schemaValue"?"values":"filters";this._dialogTitle=this.model.pivotControl._dialogTitle=s;this._dialogHead=this.model.pivotControl._dialogHead=s;this._selectedMember=this.model.pivotControl._selectedField=e;this.model.pivotControl._dataModel=="XMLA"?(a=n(i.target).parents("li:eq(0)").length>0?n(i.currentTarget).parents("li:eq(0)").attr("tag"):n(i.target).parent().attr("tag").split(":")[1],c=n.map(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName==a)return n.filterItems}),c.length>0?this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(c)}):this._selectedMember=e):(v=this.model.pivotControl._getTreeViewData(e,s,this._selectedAxis),this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(v)}))}else{if(n(this._tableTreeObj.element).find("span.e-icon.treeDrop").css({display:"none"}),this._dataModel=="Olap"){if(n(i.target).attr("class").indexOf("filter")>-1){for(r=0;r<this.model.pivotTableFields.length;r++)(this.model.pivotTableFields[r].tag.replace(/\[/g,"").replace(/\]/g,"").indexOf("Measures")>-1&&this.model.pivotTableFields[r].isSelected==!0||this.model.pivotTableFields[r].isSelected==!0&&n(i.target.parentElement).attr("tag").split(":")[1]==this.model.pivotTableFields[r].tag.replace(/\[/g,"").replace(/\]/g,""))&&(h=this.model.pivotTableFields[r].spriteCssClass);for(o=0;o<this._tableTreeObj.element.find("li").length;o++)n(n(i.target).parent()).attr("tag").split(":")[1]==n(this._tableTreeObj.element.find("li")[o]).attr("tag").replace(/\]/g,"").replace(/\[/g,"")&&(u=n(this._tableTreeObj.element.find("li")[o]))}else h=n(i.target).parent().find("a>span").attr("class");n(i.target).attr("class").indexOf("filter")>-1||(u=h.indexOf("hierarchyCDB")>-1||h.indexOf("attributeCDB")>-1?n(i.target).parents("li")[0]:n(i.target).parents("li")[1])}else u=n(i.target).attr("class").indexOf("filter")>-1?this._tableTreeObj.element.find("li:contains('"+n(n(i.target).parent()).attr("tag").split(":")[1]+"')"):n(n(i.target).parent()).parent();if(this._selectedTreeNode=u,i.target.tagName.toLowerCase()=="span"||i.target.tagName.toLowerCase()=="button"){if(this._curFilteredText=this.model.layout!="excel"&&n(i.target).attr("class").indexOf("filter")>-1?n(n(i.target).parents(".pivotButton")).attr("tag").split(":")[1].replace(/\]/g,"").replace(/\[/g,""):this._dataModel=="Olap"?n(u).attr("tag").replace(/\]/g,"").replace(/\[/g,""):n(u).find("div:first").text(),n(this.element).parents(".e-pivotclient").length>0&&(this._curFilteredText=n(n(i.target).parents(".pivotButton")).attr("tag").split(":")[1].replace(/\]/g,"").replace(/\[/g,"")),n(i.target).parents("li:eq(1)").find("div:first>a>span").hasClass("hierarchyCDB")&&(this._curFilteredText=n(i.target).parents("li:eq(1)").find("div:first>a").text()),this._dataModel=="Pivot"&&(this._curFilteredAxis=n(this.element).parents(".e-pivotclient").length>0?n(u)[0].className.split(" ")[0]:t.isNullOrUndefined(this.element.find(".e-btn:contains('"+(n(this.element).parents(".e-pivotclient").length>0?n(u).text():n(u).find("div:first").text())+"')").parents(".e-droppable")[0])?"":this.element.find(".e-btn:contains('"+n(u).find("div:first").text()+"')").parents(".e-droppable")[0].className.split(" ")[0],this._dialogHead=n(i.target).attr("fieldcaption")),this._dialogTitle=this._dataModel=="Olap"?n(this.element.find(".pivotButton:contains('"+n(u).find("div:first").text()+"')")[0]).attr("tag"):n(i.target).parents("li").length>0?n(i.target).parents("li").attr("id")||i.target.id.replace("filterBtn","")||n(i.target).parents(".filterBtn")[0].id.replace("filterBtn",""):n(i.target).parent().attr("tag").split(":")[1]||i.target.id.replace("filterBtn","")||n(i.target).parents(".filterBtn")[0].id.replace("filterBtn",""),n(this.element).parents(".e-pivotclient").length>0&&n(u)[0].className.split(" ")[0]=="schemaFilter"&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&(this._dialogTitle=this._dialogHead),this._dataModel=="Olap")for(f=0;f<this.element.find(".e-btn").length;f++)if(!t.isNullOrUndefined(n(n(n(this.element.find(".e-btn"))[f]).parent()[0]).attr("tag"))&&n(n(n(this.element.find(".e-btn"))[f]).parent()[0]).attr("tag").split(":")[1]==n(this._selectedTreeNode).attr("tag").replace(/\]/g,"").replace(/\[/g,"")&&n(n(n(this.element.find(".e-btn"))[f]).parent()[0]).attr("tag").indexOf(this._curFilteredText)>-1){this._curFilteredAxis=t.isNullOrUndefined(n(n(this.element.find(".e-btn"))[0]).parents(".e-droppable")[0])?"":n(n(this.element.find(".e-btn"))[0]).parents(".e-droppable")[0].className.split(" ")[0];this._dialogTitle=n(n(n(this.element.find(".e-btn"))[f]).parent()[0]).attr("tag");this._dialogHead=n(n(n(this.element.find(".e-btn"))[f]).parent()[0]).text();break}try{l=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(p){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(l=this.model.pivotControl.getOlapReport())}sortedHeaders=this._getSortedHeaders();this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.pivotControl.model.customObject});y=JSON.stringify({action:"fetchMembers",headerTag:this._dialogTitle+(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.enableAdvancedFilter?"##true":"")||"UniqueName##"+n(u).attr("tag"),sortedHeaders:this.model.pivotControl._ascdes,currentReport:l,customObject:JSON.stringify(this.model.pivotControl.model.customObject)});this.model.pivotControl._waitingPopup.show();this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.fetchMembers,y,this._fetchMemberSuccess)}}},_removeBtnClick:function(i){var o,f,c,s,r,u,h,e;if(this.model.pivotControl._waitingPopup.show(),this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode)t.PivotAnalysis._valueSorting=null,o=n(i.target).parent().attr("tag").split(":")[1],t.Pivot.removeReportItem(this.model.pivotControl.model.dataSource,o,o.toLocaleLowerCase().indexOf("measures")==0),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(this.model.pivotControl._fieldMembers={},this.model.pivotControl._fieldSelectedMembers={},t.olap.base.clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"},this.model.pivotControl)),this.model.pivotControl.element.hasClass("e-pivotclient")&&this.model.pivotControl._pivotChart&&(this.model.pivotControl._pivotChart._labelCurrentTags={}),this._refreshPivotButtons(),this.model.pivotControl.refreshControl(),n(i.target).parent().remove();else{for(f=n(i.target.parentElement).find("button").attr("fieldcaption")||n(i.target.parentElement).text(),s=n(n(this._tableTreeObj.element).find("div:contains("+f+")>span")[1]).find(".e-chk-act"),n(s).removeClass("e-chk-act").addClass("e-chk-inact"),n(s).children("e-checkmark").removeClass("e-checkmark"),r=0;r<this.model.pivotTableFields.length;r++)this.model.pivotTableFields[r].FieldHeader==f&&(this.model.pivotTableFields[r].IsSelected=!1,c=this.model.pivotTableFields[r]);if(n(i.target.parentElement).remove(),n(this.element).parents(".e-pivotclient").length>0&&(u=n(i.target).parent().attr("tag"),delete this.model.pivotControl._fieldMembers[u.split(":")[u.split(":").length-1]],delete this.model.pivotControl._fieldSelectedMembers[u.split(":")[u.split(":").length-1]]),this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.pivotControl.model.customObject}),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&n(this.element).parents(".e-pivotclient").length>0){try{h=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(l){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(h=this.model.pivotControl.getOlapReport())}e=JSON.stringify({action:"removeButton",args:JSON.stringify({headerTag:f,currentReport:h}),customObject:JSON.stringify(this.model.pivotControl.model.customObject)});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,e,this._droppedSuccess)}else e=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(c),sortedHeaders:this._getSortedHeaders(),currentReport:this.model.pivotControl.getOlapReport(),customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,e,this._nodeStateModifiedSuccess)}},_nodeCheckChanges:function(i){if(this._isFiltered=!0,(i.id.toLowerCase()=="(all)_0"||i.id.toLowerCase()=="all")&&i.type=="nodeUncheck")this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this.element.find(".editorTreeView").ejTreeView("unCheckAll"),this._memberTreeObj.model.nodeCheck=t.proxy(this._nodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._nodeCheckChanges,this),this.model.pivotControl&&!this.model.pivotControl.model.enableMemberEditorPaging&&this._dialogOKBtnObj.disable();else if((i.id.toLowerCase()=="(all)_0"||i.id.toLowerCase()=="all")&&i.type=="nodeCheck")this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this.element.find(".editorTreeView").ejTreeView("checkAll"),n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-stop"),this._memberTreeObj.model.nodeCheck=t.proxy(this._nodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._nodeCheckChanges,this),this._dialogOKBtnObj.enable();else if(i.id.toLowerCase()=="(all)_0"||i.id.toLowerCase()!="all"){var r=this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),u=n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)");r.length==0||r.length==1&&r[0].id[r[0].id.length-1]==0?(n(u).parent().removeClass("e-chk-inact").removeClass("e-chk-ind").addClass("e-chk-act"),u.removeClass("e-stop").addClass("e-checkmark")):i.type=="nodeCheck"&&r.length==1&&r[0].id[r[0].id.length-1]==0?u.removeClass("e-stop").addClass("e-checkmark"):r.length>0&&u.removeClass("e-checkmark").addClass("e-stop");this._dialogOKBtnObj.enable();i.type=="nodeUncheck"&&r.length+1==this._memberTreeObj.element.find("li").length&&(u.removeClass("e-checkmark").removeClass("e-stop"),this._dialogOKBtnObj.disable())}},_pivotCheckedStateModified:function(r){var f,p,a,w,v,u;if(this._nodeCheck==!0)return this._nodeCheck=!1,!1;if(this._isDropAction)return!1;t.PivotAnalysis._valueSorting=null;var e=this.model.pivotControl._dataModel=="XMLA"?n(r.currentElement).attr("tag"):this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?n.grep(this.model.pivotTableFields,function(t){return t.caption==n(r.currentElement).find("a")[0].textContent})[0].name:n(r.currentElement).find("a")[0].textContent,s=n(r.currentElement).find("a")[0].textContent,h="",c="",y="",l="",o=this.model.pivotControl._dataModel=="XMLA"?"XMLA":"",h=[];for(u=0;u<this.element.find(".pivotButton").length;u++)if(y=n(this.element.find(".pivotButton")[u]).find("button").attr("fieldName"),y==e&&(h.push(this.element.find(".pivotButton")[u]),o=="XMLA"))break;for(u=0;u<this.model.pivotTableFields.length;u++)this.model.pivotTableFields[u].name==e&&r.type=="nodeCheck"?(this.model.pivotTableFields[u].isSelected=!0,c=this.model.pivotTableFields[u]):this.model.pivotTableFields[u].name==e&&r.type=="nodeUncheck"&&(this.model.pivotTableFields[u].isSelected=!1,c=this.model.pivotTableFields[u]);if(r.type=="nodeUncheck")if(h.length>1)for(u=0;u<h.length;u++)n(h[u]).find("button").attr("fieldName")==e&&n(h[u]).remove();else n(h).remove();try{l=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(b){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(l=this.model.pivotControl.getOlapReport())}if(o=="XMLA"&&l==""&&(l=this.model.pivotControl.model.dataSource,this._selectedMember=e,this._selectedTreeNode=n(r.currentElement),this.model.pivotControl.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeStateModefied"})),f=this._droppedClass!=""?this._droppedClass:c.pivotType!=i?c.pivotType=="PivotItem"?"schemaRow":"schemaValue":"schemaRow",this._droppedClass="",r.type=="nodeCheck"){if(o=="XMLA"?(s=n(r.currentElement).find(".kpi").length>0?n(r.currentElement).parents("li:eq(0)").children("div").text()+" "+s:s,p=this.model.pivotControl.model.dataSource.enableAdvancedFilter?n(r.currentElement.find(".e-text")):n(r.currentElement.find(".e-text")[0]),n(r.currentElement).attr("tag").toLowerCase().indexOf("[measures]")<0&&!(n(r.currentElement).find(".namedSetCDB").length>0)?p.after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML):"",n(r.currentElement).attr("tag").toLocaleLowerCase().indexOf("[measures]")>=0&&(f="schemaValue"),droppedItem=n(r.currentElement).find(".namedSetCDB").length>0?{fieldName:n(r.currentElement).attr("tag"),fieldCaption:n(r.currentElement).text(),isNamedSets:!0}:t.olap.base._getCaption({fieldName:e,fieldCaption:s},this.model.pivotControl._fieldData.hierarchy)):(n(r.currentElement.find(".e-text")[0]).after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML),droppedItem={fieldName:e,fieldCaption:s}),f=f==""?"row":f=="schemaColumn"?"column":f=="schemaRow"?"row":f=="schemaValue"?"value":f=="schemaFilter"?"filter":"",this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(a=n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==e}),a.length>0)){if(this._calculatedFieldItems(a))return;f="value";droppedItem={fieldName:e,fieldCaption:s,isCalculatedField:!0,formula:a[0].formula}}this._createPivotButton(droppedItem,f,"","","");o=="XMLA"&&f=="value"?(this.model.pivotControl.model.dataSource.values.length==0&&this.model.pivotControl.model.dataSource.values.push({measures:[],axis:"columns"}),measuresAxis=this.model.pivotControl.model.dataSource.values[0].axis=="columns"?"Columns:":"Rows:",this.element.find("div[tag='"+measuresAxis+"Measures']").length==0&&this._createPivotButton({fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")},measuresAxis=="Columns:"?"column":"row","","",""),this.model.pivotControl.model.dataSource.values[0].measures.push(droppedItem)):n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.fieldName==droppedItem.fieldName}).length==0&&(f=="row"?this.model.pivotControl.model.dataSource.rows.push(droppedItem):f=="column"?this.model.pivotControl.model.dataSource.columns.push(droppedItem):f=="filter"?this.model.pivotControl.model.dataSource.filters.push(droppedItem):this.model.pivotControl.model.dataSource.values.push(droppedItem));o=="XMLA"?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),t.olap.base.getJSONData({action:"nodeCheck"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(this._trigger("fieldItemDropped",{axis:f,fieldItem:r.currentElement}),this.model.pivotControl.model.editCellsInfo={},this.model.pivotControl._populatePivotGrid())}else if(r.type=="nodeUncheck"){if(n(r.currentElement).removeClass("filter").find(".filter").remove(),n(r.currentElement).removeClass("filter").find(".treeDrop").remove(),this.model.pivotControl.model.dataSource.columns=n.grep(this.model.pivotControl.model.dataSource.columns,function(n){return n.fieldName!=e}),this.model.pivotControl.model.dataSource.rows=n.grep(this.model.pivotControl.model.dataSource.rows,function(n){return n.fieldName!=e}),w=this.model.pivotControl.model.dataSource.values,o=="XMLA")t.olap._mdxParser._getItemPosition(this.model.pivotControl.model.dataSource.values[0].measures,e).length>0&&this.model.pivotControl.model.dataSource.values[0].measures.splice(t.olap._mdxParser._getItemPosition(this.model.pivotControl.model.dataSource.values[0].measures,e)[0],1),this.model.pivotControl.model.dataSource.values[0].measures.length==0&&this.element.find("div[tag='"+(this.model.pivotControl.model.dataSource.values[0].axis=="columns"?"Columns":"Rows")+":Measures']").remove();else if(this.model.pivotControl.model.dataSource.values=n.grep(w,function(n){return n.fieldName!=e}),this.model.pivotControl._calculatedField.length>0)for(v=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.isCalculatedField==!0&&n.formula.indexOf(e)>-1}),u=0;u<v.length;u++)this._tableTreeObj.uncheckNode(v[u].fieldName);this.model.pivotControl.model.dataSource.filters=n.grep(this.model.pivotControl.model.dataSource.filters,function(n){return n.fieldName!=e});o=="XMLA"?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),t.olap.base.getJSONData({action:"nodeUncheck"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(f=f==""?"row":f=="schemaColumn"?"column":f=="schemaRow"?"row":f=="schemaValue"?"value":f=="schemaFilter"?"filter":"",this._trigger("fieldItemDropped",{axis:f,fieldItem:r.currentElement}),this.model.pivotControl.model.editCellsInfo={},this.model.pivotControl._populatePivotGrid())}this._setPivotBtnWidth()},_calculatedFieldItems:function(i){var u,r;if(i.length>0)for(u=i[0].formula.replace(/\(|\)/g," ").replace(/[-+*/^%]/g," ").split(" "),r=0;r<u.length;r++)if(!n.isNumeric(u[r])&&u[r].replace(/\s+|\s+$/gm,"")!=""&&(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.fieldName==u[r]}).length==0||this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&n.grep(JSON.parse(this.model.pivotControl.getOlapReport()).PivotCalculations,function(n){return n.FieldName==u[r]}).length==0))return alert(this.model.pivotControl._getLocalizedLabels("NotPresent")),this._tableTreeObj.model.nodeCheck=null,this._tableTreeObj.model.nodeUncheck=null,this._tableTreeObj.uncheckNode(i[0].name),this._tableTreeObj.model.nodeCheck=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?t.proxy(this._checkedStateModified,this):t.proxy(this._pivotCheckedStateModified,this),this._tableTreeObj.model.nodeUncheck=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?t.proxy(this._checkedStateModified,this):t.proxy(this._pivotCheckedStateModified,this),!0;return!1},_checkedStateModified:function(i){var tt,k,d,v,h,l,y,p,u,o,f,g,it,w,b,r;if(this.model.pivotControl._isUpdateRequired=!0,this._isMeasureBtnRemove==!0)return this._isMeasureBtnRemove=!1,!1;if(this._nodeCheck==!0)return this._nodeCheck=!1,!1;var e=n(i.currentElement).find("a")[0].textContent,a="",nt="",s="",u="",c="";if(this._dataModel!="Pivot"||i.type!="nodeCheck"||(tt=n.grep(this.model.pivotControl._calculatedField,function(t){return t.name==n(i.currentElement).attr("id")}),!this._calculatedFieldItems(tt))){if(this._dataModel=="Olap")if(!i.currentElement[0].id.indexOf("[Measures]")>-1){for(r=0;r<this.element.find(".pivotButton").length;r++)if(u=n(this.element.find(".pivotButton")[r]).attr("tag"),c="",c=u.indexOf("[Measures]")>-1||u.indexOf("[")>-1?u.split(":")[1]:this.model.pivotControl._getNodeUniqueName(u),c=c.replace("<>","."),n(i.currentElement).attr("tag").toLowerCase()==c.toLowerCase()){s=n(this.element.find(".pivotButton")[r]);break}}else s=this.element.find(".pivotButton:contains("+e+")"),u,o;else s=this.element.find(".pivotButton:contains("+e+")"),u,o;for(k=s.length>0&&n(s).siblings(".filterIndicator").length>0?!0:!1,d=i.currentElement.find("~ span:eq(0) span.descending").length>0?!0:!1,r=0;r<this.model.pivotTableFields.length;r++)this.model.pivotTableFields[r].name==e&&i.type=="nodeCheck"?(this.model.pivotTableFields[r].isSelected=!0,u=this.model.pivotTableFields[r]):this.model.pivotTableFields[r].name==e&&i.type=="nodeUncheck"&&(this.model.pivotTableFields[r].isSelected=!1,u=this.model.pivotTableFields[r]);if(t.isNullOrUndefined(u)&&(u=n(i.currentElement).attr("tag")),i.type=="nodeUncheck")if(s.length>1)for(r=0;r<s.length;r++)n(s[r]).text()==e&&n(s[r]).remove();else n(s).remove();else this._droppedClass!=""?this._createPivotButton(e,this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaValue"?"value":this._droppedClass=="schemaFilter"?"filter":"",k,d,""):this._createPivotButton(e,this._dataModel=="Olap"&&n(i.currentElement).attr("tag").indexOf("[Measures]")<0||this._dataModel=="Pivot"&&u.pivotType=="PivotItem"?"row":"value",k,d,"");if(!t.isNullOrUndefined(this._tempFilterData))for(r=0;r<this._tempFilterData.length;r++)if(!t.isNullOrUndefined(this._tempFilterData[r][e]))for(v=0;v<this._tempFilterData[r][e].length;v++)nt+="##"+this._tempFilterData[r][e][v];try{o=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(rt){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(o=this.model.pivotControl.getOlapReport())}if(a="schemaRow::"+e+"::FILTERED"+nt,h=this._droppedClass!=""?this._droppedClass:u.pivotType=="PivotItem"?"schemaRow":"schemaValue",this._droppedClass="",t.isNullOrUndefined(this.model.pivotControl)||t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show(),this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left}),i.type=="nodeCheck"||i.type=="nodeUncheck"||h==""){if(i.type=="nodeCheck")this._dataModel=="Olap"?(n(i.currentElement).attr("tag").indexOf("[Measures]")==-1&&(p=t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filter button").addClass("treeDrop")[0].outerHTML,n(i.currentElement.find(".e-text")[0]).after(n(p).hide())),this._nodeDropedParams=h=="schemaColumn"?"Categorical":h=="schemaRow"?"Series":h=="schemaFilter"?"Slicer":"",u=n(i.currentElement).attr("tag"),l=this._nodeDropedParams==""?n(i.currentElement).attr("tag").indexOf("[Measures]")>=0?"Categorical":"Series":this._nodeDropedParams,u.toLowerCase().indexOf("[measures]")>-1&&(l="Categorical"),y=this._currentCubeName+"--"+u+"--"+l+"--",o,this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject}),f=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:y,currentReport:o,gridLayout:this.model.pivotControl.model.layout,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f.replace("nodeDropped","nodeDroppedDeferUpdate"),this._droppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f,this._droppedSuccess)):(n(i.currentElement.find(".e-text")[0]).after(n(t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filter button").addClass("treeDrop")[0].outerHTML).hide()),this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.pivotControl.model.customObject}),f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(u),dropAxis:h+"::",sortedHeaders:this.model.pivotControl._ascdes,filterParams:a,currentReport:o,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess),t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess));else if(i.type=="nodeUncheck")if(this._dataModel=="Olap"){if(n(i.currentElement.find(".treeDrop")).remove(),n(i.currentElement).find(".filter").removeClass("filter"),u=n(s).attr("tag"),delete this.model.pivotControl._fieldMembers[u.split(":")[u.split(":").length-1]],delete this.model.pivotControl._fieldSelectedMembers[u.split(":")[u.split(":").length-1]],this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.pivotControl.model.customObject}),f=JSON.stringify({action:"removeButton",headerInfo:u,currentReport:o,gridLayout:this.model.pivotControl.model.layout,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),t.isNullOrUndefined(u))return!1;(u.indexOf("[Measures]")>=0||u.toLowerCase().indexOf("[measures]"))&&this.element.find(".schemaValue .pivotButton").length==0?(g=u.split(":"),it=g[0]=="Rows"?".schemaRow":g[0]=="Columns"?".schemaColumn":"",this.element.find(it+" .pivotButton:contains('Measures')").remove()):u.indexOf("[Measures]")<0&&u.indexOf("Measures")>=0&&this.element.find(".schemaValue .pivotButton").remove();this.model.pivotControl.model.enableDeferUpdate?(this._removeButtonDeferUpdate=!0,this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,f.replace("removeButton","removeButtonDeferUpdate"),this._droppedSuccess)):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,f,this._pvtBtnDroppedSuccess)}else{if(!t.isNullOrUndefined(this._tempFilterData))for(r=0;r<this._tempFilterData.length;r++)for(w in this._tempFilterData[r])w==e&&(this._tempFilterData[r][e]=[]);if(!t.isNullOrUndefined(this.model.pivotControl._tempFilterData))for(r=0;r<this.model.pivotControl._tempFilterData.length;r++)for(w in this.model.pivotControl._tempFilterData[r])w==u.id&&(this.model.pivotControl._tempFilterData[r][u.id]=[]);if(this.model.pivotControl._calculatedField.length>0)for(b=n.grep(JSON.parse(this.model.pivotControl.getOlapReport()).PivotCalculations,function(n){return n.CalculationType==8&&n.Formula.indexOf(u.id)>-1}),r=0;r<b.length;r++)this._tableTreeObj.model.nodeUncheck=null,this._tableTreeObj.uncheckNode(b[r].FieldName),this._tableTreeObj.element.find("li[id='"+b[r].FieldName+"']").removeClass("filter").find(".treeDrop").remove(),this._tableTreeObj.model.nodeUncheck=t.proxy(this._checkedStateModified,this);delete this.model.pivotControl._fieldMembers[u.name];n(i.currentElement).removeClass("filter").find(".filter").remove();n(i.currentElement).removeClass("filter").find(".treeDrop").remove();this.model.pivotControl._ascdes=this.model.pivotControl._ascdes.replace(e+"##","");this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.pivotControl.model.customObject});f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(u),dropAxis:h+"::",sortedHeaders:this.model.pivotControl._ascdes,filterParams:a,currentReport:o,customObject:JSON.stringify(this.model.pivotControl.model.customObject)});this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess),t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess)}}else this._dataModel=="Pivote"?(this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.pivotControl.model.customObject}),f=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(u),dropAxis:h+"::"+this._droppedPosition,sortedHeaders:this.model.pivotControl._ascdes,filterParams:a,currentReport:o,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this._droppedPosition="",this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeStateModified,f,this._nodeStateModifiedSuccess)):(n(i.currentElement).attr("tag").toLowerCase().indexOf("[measures]")==-1&&(p=t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filter button").addClass("treeDrop")[0].outerHTML,n(i.currentElement.find(".e-text")[0]).after(n(p).hide())),u=n(i.currentElement).attr("tag"),l=this._nodeDropedParams==""?n(i.currentElement).attr("tag").toLowerCase().indexOf("[Measures]")>=0?"Categorical":"Series":this._nodeDropedParams,y=this._currentCubeName+"--"+u+"--"+l+"--",o,this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject}),f=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:y,currentReport:o,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f.replace("nodeDropped","nodeDroppedDeferUpdate"),this._droppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,f,this._droppedSuccess));this._setPivotBtnWidth()}},_nodeDropped:function(r){var b,it,g,et,ot,st,rt,k,ht,nt,u,o,d,l,p,w,h,y,ct,lt,a;if(n(r.dropTarget).hasClass("pvtBtn")&&(r.dropTarget=n(r.dropTarget).parents("div.e-droppable").length>0&&n(r.dropTarget).parents(".e-pivotschemadesigner").length>0?n(r.dropTarget).parents("div.e-droppable"):r.dropTarget),n(this.element).parents(".e-pivotclient").length>0&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot){var s="",e=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.pivotControl._dataModel!="XMLA"?n.grep(this.model.pivotTableFields,function(n){return n.caption==r.droppedElement.text()})[0].name:this._dataModel=="XMLA"?r.droppedElement.attr("tag"):r.droppedElement.text(),tt=n(r.droppedElement).attr("id"),ut=r.dropTarget.hasClass("schemaColumn")?"schemaColumn":r.dropTarget.hasClass("schemaRow")?"schemaRow":r.dropTarget.hasClass("schemaFilter")?"schemaFilter":r.dropTarget.hasClass("schemaValue")?"schemaValue":"";if(ut=="")return!1;h=this._setSplitBtnTargetPos(t.isNullOrUndefined(r.event)?r:r.event);n(this.element).parents(".e-pivotclient").length>0&&(delete this.model.pivotControl._fieldMembers[tt],delete this.model.pivotControl._fieldSelectedMembers[tt]);try{v=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(vt){v=this.model.pivotControl.getOlapReport()}for(t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show(),u=0;u<this.model.pivotTableFields.length;u++)if(this.model.pivotTableFields[u].name==e){this.model.pivotTableFields[u].isSelected=!0;s=this.model.pivotTableFields[u];break}a=JSON.stringify({action:this.model.pivotControl.model.enableDeferUpdate?"nodeDroppedDeferUpdate":"nodeDropped",args:JSON.stringify({droppedFieldCaption:e,droppedFieldName:tt,headerTag:s,dropAxis:ut,droppedPosition:h,currentReport:v}),customObject:JSON.stringify(this.model.pivotControl.model.customObject)});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,a,this._pvtNodeDroppedSuccess);this._isDragging=!1;return}if(this.model.pivotControl._isUpdateRequired=!0,r.dropTarget[0]!=i||r.dropTarget.className!=i){if(b=!1,this._dataModel=="Pivot")for(it=n(r.dropTarget).parents(),u=0;u<it.length;u++)n(it[u]).hasClass("e-pivotgrid")&&(b=!0);if(r.dropTarget.hasClass("e-droppable")||r.dropTarget[0]!=i&&r.dropTarget[0].className.indexOf("e-droppable")>=0||r.dropTarget.className!=i&&r.dropTarget.className.indexOf("e-droppable")>=0||b){this._isDragging=!1;this.element.find(".dropIndicator").removeClass("dropIndicatorHover");var s=n(r.droppedElement).attr("tag"),e=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.pivotControl._dataModel!="XMLA"?n.grep(this.model.pivotTableFields,function(n){return n.caption==r.droppedElement.text()})[0].name:this._dataModel=="XMLA"?r.droppedElement.attr("tag"):r.droppedElement.text(),at="",v,c=this.element.find(".pivotButton:contains("+e+")"),f=this._dataModel=="XMLA"?this._tableTreeObj.element.find("li[tag='"+s+"']").length>1?r.droppedElement:this._tableTreeObj.element.find("li[tag='"+s+"']"):this._dataModel=="Pivot"&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this._tableTreeObj.element.find("li[id="+e+"]"):this._dataModel=="Pivot"?this._tableTreeObj.element.find("li:contains('"+e+"'):last"):this._tableTreeObj.element.find("li[tag='"+s+"']"),y=n(c).find(".filterIndicator").length>0?!0:!1,ft=n(c).find("~ span:eq(0) span.descending").length>0?!0:!1;if(r.dropTarget.parent().attr("role")=="presentation")return!1;if(this.model.pivotControl._dataModel=="XMLA"){if(g=n.map(n(s.split("].")),function(n){return n.lastIndexOf("]")>=0?n:n+"]"}),g.length>=2&&(et=g[0]+"."+g[1],f=this._tableTreeObj.element.find("li[tag='"+et+"']"),s=f.attr("tag")),ot=n(r.dropTarget).hasClass("value")||n(r.dropTarget).hasClass("colheader")||n(r.dropTarget).hasClass("rowheader")||n(r.dropTarget).hasClass("summary")||n(r.dropTarget).parents("table:eq(0)").hasClass("pivotGridTable")||n(r.dropTarget).parents(".groupingBarPivot").length>0,st=r.droppedElement.find(".namedSetCDB").length>0&&n(r.dropTarget).hasClass("schemaFilter"),ot||st||n(r.droppedElement).attr("tag").toLowerCase().indexOf("measures")>=0&&!n(r.dropTarget).hasClass("schemaValue")||n(r.droppedElement).attr("tag").indexOf("Measures")<0&&n(r.dropTarget).hasClass("schemaValue"))return this._createErrorDialog(),pschemaDesignerWaitingPopup.hide(),!1;if(rt=t.Pivot.getReportItemByFieldName(s,this.model.pivotControl.model.dataSource,this._dataModel),k=rt.axis,!(f.length>1)&&rt.item.length>0&&(k=="rows"&&r.dropTarget.hasClass("schemaRow")||k=="columns"&&r.dropTarget.hasClass("schemaColumn")||k=="values"&&n(r.dropTarget).hasClass("schemaValue")||k=="filters"&&n(r.dropTarget).hasClass("schemaFilter")))return!1;if(f.length>1&&r.droppedElement.find(".kpiValue").length>0&&(f=f.find(".kpiValue").parents("li:eq(0)")),this._tableTreeObj.isNodeChecked(f))for(u=0;u<this.element.find(".pivotButton").length;u++)this.element.find(".pivotButton:eq("+u+")").attr("tag").split(":")[1]==s?this.element.find(".pivotButton:eq("+u+")").remove():""}else if(this._dataModel=="Olap"&&(n(r.droppedElement).attr("tag").indexOf("Measures")>=0&&(n(r.dropTarget).hasClass("schemaFilter")||n(r.dropTarget).hasClass("drag"))||n(r.droppedElement).attr("tag").indexOf("Measures")<0&&n(r.dropTarget).hasClass("schemaValue")))return this._createErrorDialog(),pschemaDesignerWaitingPopup.hide(),!1;if(n(f).find(".filter").remove(),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)for(c=[],u=0;u<this.element.find(".pivotButton").length;u++)uniqueName=n(this.element.find(".pivotButton")[u]).find("button").attr("fieldName"),uniqueName==e&&c.push(this.element.find(".pivotButton")[u]);if(b)if(r.event.target.tagName=="TH"||r.event.target.tagName=="TD"){if(this._droppedClass=r.event.target.className.split(" ")[0]=="rowheader"||r.event.target.className.split(" ")[0]=="grpRow"?"schemaRow":r.event.target.className.split(" ")[0]=="colheader"?"schemaColumn":n(r.event.target).hasClass("value")?"schemaValue":"",this._droppedClass=="")return}else this._droppedClass=r.event.target.className.split(" ")[0]=="rows"||r.event.target.className.split(" ")[0]=="emptyRows"?"schemaRow":r.event.target.className.split(" ")[0]=="columns"?"schemaColumn":r.event.target.className.split(" ")[0]=="values"?"schemaValue":r.event.target.className.split(" ")[0]=="drag"?"schemaFilter":"";else this._droppedClass=t.isNullOrUndefined(r.event)?r.dropTarget.hasClass("schemaColumn")?"schemaColumn":r.dropTarget.hasClass("schemaRow")?"schemaRow":r.dropTarget.hasClass("schemaFilter")?"schemaFilter":r.dropTarget.hasClass("schemaValue")?"schemaValue":"":r.event.target.className.split(" ")[0];if(this._dataModel=="Olap"&&(ht=n(r.droppedElement).children("div:eq(0)").find(".e-checkbox").length,f=ht==0?r.droppedElement.parent("ul").parent("li:eq(0)"):r.droppedElement),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._dataModel=="Pivot"&&this._droppedClass!="schemaValue"&&(n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==f.attr("id")}).length>0||n.grep(JSON.parse(this.model.pivotControl.getOlapReport()).PivotCalculations,function(n){return n.FieldName==f.attr("id")&&n.CalculationType==8}).length>0)){this.model.pivotControl._createErrorDialog(this.model.pivotControl._getLocalizedLabels("CalcValue"),this.model.pivotControl._getLocalizedLabels("Warning"));return}if(f.find(".e-chk-inact").length>0&&this._droppedClass!=""&&(this._droppedClass=="schemaRow"||this._droppedClass=="schemaColumn"||this._droppedClass=="schemaFilter"||this._droppedClass=="schemaValue"))return this._tableTreeObj.checkNode(f),!1;if(f.find(".e-chk-inact").length>0&&this._droppedClass!=""&&(this._droppedClass=="pvtBtn"||this._droppedClass=="rowheader"||this._droppedClass=="colheader"||this._droppedClass=="value"&&n(r.droppedElement).attr("tag").indexOf("Measures")<0)&&(this._nodeCheck=!0,this._tableTreeObj.checkNode(f)),t.isNullOrUndefined(s))for(u=0;u<this.model.pivotTableFields.length;u++)this.model.pivotTableFields[u].name==e&&(this.model.pivotTableFields[u].isSelected=!0,s=this.model.pivotTableFields[u]);if(!t.isNullOrUndefined(this._tempFilterData))for(u=0;u<this._tempFilterData.length;u++)if(!t.isNullOrUndefined(this._tempFilterData[u][e]))for(nt=0;nt<this._tempFilterData[u][e].length;nt++)at+="##"+this._tempFilterData[u][e][nt];if(r.droppedElement[0].tagName.toLowerCase()=="button")if(c.length>1)for(u=0;u<c.length;u++)n(c[u]).text()==e&&n(c[u]).remove();else n(c).remove();try{v=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(vt){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(v=this.model.pivotControl.getOlapReport())}if(this.model.pivotControl._dataModel=="XMLA"&&(v=this.model.pivotControl.model.dataSource),this._dataModel=="Pivot"||this.model.pivotControl._dataModel=="XMLA"){for(e=this.model.pivotControl._dataModel=="XMLA"?s:e,h="",h=b?this._droppedPosition="":t.isNullOrUndefined(r.event)?"":this._droppedPosition=this._setSplitBtnTargetPos(r.event),u=0;u<this.model.pivotTableFields.length;u++)if(this.model.pivotTableFields[u].name==e){this.model.pivotTableFields[u].isSelected=!0;s=this.model.pivotTableFields[u];n(c).remove();break}if(f.find(".e-chk-inact").length>0&&this._droppedClass!=""&&(this._droppedClass=="schemaRow"||this._droppedClass=="schemaColumn"||this._droppedClass=="schemaFilter"||this._droppedClass=="schemaValue"))this._tableTreeObj.checkNode(f);else if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(o=this.model.pivotControl._getDroppedItem(e),o.length&&o[0].filterItems&&o[0].filterItems.values&&o[0].filterItems.values.length&&n(n(f).find(".e-text")[0]).after(t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filtered").addClass("filter")[0].outerHTML),o.length||(o[0]={fieldName:e,fieldCaption:this._dataModel=="XMLA"&&f.find(".hierarchyCDB ").length>0?f.find("div:eq(0)").text():e}),this.model.pivotControl.model.dataSource.columns=n.grep(this.model.pivotControl.model.dataSource.columns,function(n){return n.fieldName!=e}),this.model.pivotControl.model.dataSource.rows=n.grep(this.model.pivotControl.model.dataSource.rows,function(n){return n.fieldName!=e}),this._dataModel!="XMLA"?this.model.pivotControl.model.dataSource.values=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.fieldName!=e}):this.model.pivotControl.model.dataSource.values[0].measures=n.grep(this.model.pivotControl.model.dataSource.values[0].measures,function(n){return n.fieldName!=e}),this.model.pivotControl.model.dataSource.filters=n.grep(this.model.pivotControl.model.dataSource.filters,function(n){return n.fieldName!=e}),d=this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaFilter"?"filter":this._droppedClass=="schemaValue"?"value":"",this.model.pivotControl._dataModel=="Pivot"&&n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==o[0].fieldCaption}).length>0&&d!="value"){alert(this.model.pivotControl._getLocalizedLabels("CalcValue"));this._tableTreeObj.checkNode(o[0].fieldCaption);return}this._createPivotButton(o[0],d,y,ft,h);n.isNumeric(h)?this._droppedClass=="schemaRow"?this.model.pivotControl.model.dataSource.rows.splice(h,0,o[0]):this._droppedClass=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.splice(h,0,o[0]):this._droppedClass=="schemaValue"?this.model.pivotControl._dataModel=="XMLA"?this.model.pivotControl.model.dataSource.values[0].measures.splice(h,0,o[0]):this.model.pivotControl.model.dataSource.values.splice(h,0,o[0]):this.model.pivotControl.model.dataSource.filters.splice(h,0,o[0]):this._droppedClass=="schemaRow"?this.model.pivotControl.model.dataSource.rows.push(o[0]):this._droppedClass=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.push(o[0]):this._droppedClass=="schemaValue"?this.model.pivotControl._dataModel=="XMLA"?this.model.pivotControl.model.dataSource.values[0].measures.push(o[0]):this.model.pivotControl.model.dataSource.values.push(o[0]):this.model.pivotControl.model.dataSource.filters==null?(this.model.pivotControl.model.dataSource.filters=[],this.model.pivotControl.model.dataSource.filters.push(o[0])):this.model.pivotControl.model.dataSource.filters.push(o[0]);this.model.pivotControl._dataModel=="Pivot"&&this.model.pivotControl._calculatedField.length>0&&d!="value"&&(this.model.pivotControl._calcFieldNodeDrop(o[0]),this.model.pivotControl.model.dataSource.values=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return t.isNullOrUndefined(n.isCalculatedField)||n.isCalculatedField==!1||n.isCalculatedField==!0&&n.formula.indexOf(o[0].fieldName)==-1}));this.model.pivotControl._dataModel=="XMLA"?(this._droppedClass=="schemaFilter"&&(this.model.pivotControl.model.dataSource.filters=n.map(this.model.pivotControl.model.dataSource.filters,function(n){return n.advancedFilter=[],n})),t.olap.base.getJSONData({action:"nodeDropped"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(this._trigger("fieldItemDropped",{axis:d,fieldItem:f}),this.model.pivotControl.model.editCellsInfo={},this.model.pivotControl._populatePivotGrid())}else y=!1,this._tempFilterData!=null&&n.each(this._tempFilterData,function(t,i){n.each(i,function(t,i){t==n(f).attr("id")&&i.length>0&&(y=!0)})}),y&&n(n(f).find(".e-text")[0]).after(t.buildTag("span.e-icon").addClass("filter")[0].outerHTML),this._dataModel=="Pivot"&&this.model.pivotControl._calculatedField.length>0&&this._droppedClass!="schemaValue"&&this.model.pivotControl._calculatedFieldNodeRemove(s),this._createPivotButton(e,this._droppedClass=="schemaRow"?"row":this._droppedClass=="schemaColumn"?"column":this._droppedClass=="schemaFilter"?"filter":this._droppedClass=="schemaValue"?"value":"",y,ft,h),this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject}),a=JSON.stringify({action:"nodeDropped",dropAxis:this._droppedClass+"::"+h,headerTag:JSON.stringify(s),sortedHeaders:this.model.pivotControl._ascdes,currentReport:v,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show(),this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left}),this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,a.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtNodeDroppedSuccess),t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,a,this._pvtNodeDroppedSuccess)}else{if(l=r.dropTarget[0]!=i&&r.dropTarget[0].className=="pivotButton"?n(r.dropTarget).parents()[0]:r.dropTarget[0]!=i&&r.dropTarget[0].tagName.toLowerCase()=="td"&&!n(r.dropTarget.parents("table.pivotGridTable")[0]).length?r.dropTarget.children(":last")[0]:r.dropTarget,this._droppedClass=l[0].className.split(" ")[0],p="",w="",p=l[0].className.split(" ")[0],n(r.dropTarget.parents("table.pivotGridTable")[0]).length){if(w=n(l).hasClass("rowheader")?"Series":n(l).hasClass("grpRow")?"Series":n(l).hasClass("rows")?"Series":n(l).hasClass("colheader")?"Categorical":n(l).hasClass("columns")?"Categorical":n(l).hasClass("value")?"Slicer":n(l).hasClass("drag")?"Slicer":"",n(r.droppedElement).attr("tag").indexOf("Measures")>0&&w=="Slicer")return this._createErrorDialog(),!1}else w=p=="columns"?"Categorical":p=="schemaColumn"?"Categorical":p=="rows"?"Series":p=="schemaRow"?"Series":p=="drag"?"Slicer":p=="schemaFilter"?"Slicer":"";w==""&&(w=this.element.find(".schemaRow .pivotButton:contains('Measures')").length>0||this.element.find(".schemaRow .pivotButton:contains('MEASURES')").length>0?"Series":"Categorical");h=t.isNullOrUndefined(r.event)?"":this._setSplitBtnTargetPos(r.event);y=!1;this.model.pivotControl._tempFilterData!=null&&n.each(this.model.pivotControl._tempFilterData,function(t,i){n.each(i,function(n,t){n==s.replace(/[\[\]']/g,"")&&t.length>0&&(y=!0)})});y&&n(n(f).find(".e-text")[0]).after(t.buildTag("span.e-icon").addClass("filter")[0].outerHTML);ct=this._currentCubeName+"--"+s+"--"+w+"--"+h;lt="";this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject});a=JSON.stringify({action:"nodeDropped",dropType:"TreeNode",nodeInfo:ct,filterParams:lt,currentReport:v,gridLayout:this.model.pivotControl.model.layout,customObject:JSON.stringify(this.model.pivotControl.model.customObject)});this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show();this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,a.replace("nodeDropped","nodeDroppedDeferUpdate"),this._droppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,a,this._droppedSuccess)}}this._setPivotBtnWidth()}},_addTreeDropIcon:function(i){this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(n(args.currentElement).attr("tag").toLowerCase().indexOf("[measures]")<0&&!(n(args.currentElement).find(".namedSetCDB").length>0)?i.after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML):i.after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML))},_clientPivotCheckedStateModified:function(i){var r,u,f,e;(t.PivotAnalysis._valueSorting=null,this._isDropAction)||(r="",t.isNullOrUndefined(this.model.pivotControl)||t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show(),r=this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?n.grep(this.model.pivotTableFields,function(t){return t.name==n(i.currentElement).attr("id")})[0].name:n(i.currentElement).attr("tag"):n(i.currentElement).find("a")[0].textContent,i.type=="nodeUncheck"?(delete this.model.pivotControl._fieldMembers[r.toLowerCase()],delete this.model.pivotControl._fieldSelectedMembers[r.toLowerCase()],t.Pivot.removeReportItem(this.model.pivotControl.model.dataSource,r,!1),n(i.currentElement).removeClass("filter").find(".treeDrop,.filter").remove()):(u="row",this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&n(i.currentElement).attr("tag").toLocaleLowerCase().indexOf("[measures]")>=0&&(u="value"),(this.model.pivotControl.model.analysisMode!=t.Pivot.AnalysisMode.Olap||n(i.currentElement).attr("tag").toLowerCase().indexOf("[measures]")<0&&n(i.currentElement).find(".namedSetCDB").length==0)&&n(i.currentElement.find(".e-text")).after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML),f=n(i.currentElement).find("a")[0].textContent,e={droppedFieldName:r,droppedFieldCaption:f,droppedClass:u,droppedPosition:"",isMeasuresDropped:r.toLocaleLowerCase().indexOf("measures")==0},t.Pivot.addReportItem(this.model.pivotControl.model.dataSource,e)),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&t.olap.base.clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"},this.model.pivotControl),this._refreshPivotButtons(),this.model.pivotControl.refreshControl(),this._setPivotBtnWidth())},_clientOnNodeDropped:function(i){var e,o,f,r,s,h,c,a;if(t.PivotAnalysis._valueSorting=null,this._isDragging=!1,e=!1,this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot)for(o=n(i.dropTarget).parents(),f=0;f<o.length;f++)o[f].className.split(" ")[0]=="e-pivotgrid"&&(e=!0);var u=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?n.grep(this.model.pivotTableFields,function(n){return n.name==i.droppedElement.attr("id")})[0].name:i.droppedElement.attr("defaulthierarchy")||i.droppedElement.attr("tag"),l=n(i.droppedElement).find("div:first").text(),r="";if(r=n(i.dropTarget).hasClass("pvtBtn")?n(i.dropTarget).parents("div.e-droppable").hasClass("schemaColumn")?"column":n(i.dropTarget).parents("div.e-droppable").hasClass("schemaRow")?"row":n(i.dropTarget).parents("div.e-droppable").hasClass("schemaFilter")?"filter":n(i.dropTarget).parents("div.e-droppable").hasClass("schemaValue")?"value":"":i.dropTarget.hasClass("schemaColumn")?"column":i.dropTarget.hasClass("schemaRow")?"row":i.dropTarget.hasClass("schemaFilter")?"filter":i.dropTarget.hasClass("schemaValue")?"value":"",e&&(r=n(i.dropTarget).prop("tagName")=="TH"||n(i.dropTarget).prop("tagName")=="TD"?n(i.dropTarget).hasClass("rowheader")||n(i.dropTarget).hasClass("grpRow")?"row":n(i.dropTarget).hasClass("colheader")?"column":n(i.dropTarget).hasClass("value")?"value":"":n(i.dropTarget).hasClass("rows")||n(i.dropTarget).hasClass("emptyRows")?"row":n(i.dropTarget).hasClass("columns")?"column":n(i.dropTarget).hasClass("values")?"value":n(i.dropTarget).hasClass("drag")?"filter":""),r=="")return!1;if(s=t.isNullOrUndefined(i.event)?"":this._setSplitBtnTargetPos(i.event),h=n(i.dropTarget).hasClass("value")||n(i.dropTarget).hasClass("colheader")||n(i.dropTarget).hasClass("rowheader")||n(i.dropTarget).hasClass("summary")||n(i.dropTarget).parents("table:eq(0)").hasClass("pivotGridTable")||n(i.dropTarget).parents(".groupingBarPivot").length>0,u.toLowerCase().indexOf("[measures]")>=0&&r!="value"||u==this._getLocalizedLabels("Measures")&&r!="row"&&r!="column"||this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&u.toLowerCase().indexOf("[measures]")<0&&r=="value"||h&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap){this._createErrorDialog();return}this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(this.model.pivotControl._fieldMembers={},this.model.pivotControl._fieldSelectedMembers={},u.toLowerCase().indexOf("[measures")>=0&&(this.model.pivotControl.model.dataSource.values[0].axis=r=="column"?"columns":r=="row"?"rows":this.model.pivotControl.model.dataSource.values[0].axis,r="value"));this.model.pivotControl._waitingPopup.show();c={droppedFieldName:u,droppedFieldCaption:l,droppedClass:r,droppedPosition:s,isMeasuresDropped:u.toLocaleLowerCase().indexOf("measures")==0};t.Pivot.addReportItem(this.model.pivotControl.model.dataSource,c);this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&t.olap.base.clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"},this.model.pivotControl);this.model.pivotControl.element.hasClass("e-pivotclient")&&this.model.pivotControl._pivotChart&&(this.model.pivotControl._pivotChart._labelCurrentTags={});a=i.droppedElement;this._isDropAction=!0;r==""?this._tableTreeObj.uncheckNode(i.droppedElement):(n(i.droppedElement).find(".treeDrop").length==0&&this.element.parents(".e-pivotclient").length==0&&(this.model.pivotControl.model.analysisMode!=t.Pivot.AnalysisMode.Olap||n(i.droppedElement).attr("tag").toLowerCase().indexOf("[measures]")<0&&n(i.droppedElement).find(".namedSetCDB").length==0)&&n(i.droppedElement.find(".e-text")).after(t.buildTag("span.e-icon").css("display","none").addClass("treeDrop")[0].outerHTML),this._tableTreeObj.checkNode(i.droppedElement));this._isDropAction=!1;this._refreshPivotButtons();this.model.pivotControl.refreshControl();this._setPivotBtnWidth()},_clientOnPvtBtnDropped:function(i){var r,h,u,c,l,e,o,f,a,s;if(t.PivotAnalysis._valueSorting=null,t.isNullOrUndefined(this.model.pivotControl)||t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show(),n(i.target).hasClass("removeClientPivotBtn")&&(i.target=n(i.target).parent()),this._isDragging=!1,n("#"+this._id+"_dragClone").remove(),r="",r=this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?n.grep(this.model.pivotTableFields,function(t){return t.name==n(i.element).attr("fieldName")})[0].name:n(i.element).attr("fieldName"):i.element.text(),h=i.element.text(),t.isNullOrUndefined(this.model.pivotControl._fieldMembers)||(delete this.model.pivotControl._fieldMembers[r.toLowerCase()],delete this.model.pivotControl._fieldSelectedMembers[r.toLowerCase()]),u="",u=n(i.target).hasClass("pvtBtn")||this.element.parents(".e-pivotclient").length>0&&n(i.target).hasClass("pivotButton")?n(i.target).parents("div.e-droppable").hasClass("schemaColumn")?"column":n(i.target).parents("div.e-droppable").hasClass("schemaRow")?"row":n(i.target).parents("div.e-droppable").hasClass("schemaFilter")?"filter":n(i.target).parents("div.e-droppable").hasClass("schemaValue")?"value":"":n(i.target).hasClass("schemaColumn")?"column":n(i.target).hasClass("schemaRow")?"row":n(i.target).hasClass("schemaFilter")?"filter":n(i.target).hasClass("schemaValue")?"value":"",r.toLowerCase().indexOf("[measures]")>=0&&u!="value"&&(u=="row"||u=="column"||u=="filter")||r==this._getLocalizedLabels("Measures")&&u!="row"&&u!="column"&&(u=="value"||u=="filter")||this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&r.toLowerCase().indexOf("[measures]")<0&&u=="value"){this._createErrorDialog();i.element.removeClass("dragHover").parent().removeClass("dragHover");return}if(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl._calculatedField!=null&&u!="value"&&n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==r}).length>0){alert(this.model.pivotControl._getLocalizedLabels("CalcValue"));i.element.removeClass("dragHover").parent().removeClass("dragHover");this.element.find(".dropIndicator").removeClass("dropIndicatorHover");return}if(c=t.isNullOrUndefined(i.event)?"":this._setSplitBtnTargetPos(i.event),l={droppedFieldName:r,droppedFieldCaption:h,droppedClass:u,droppedPosition:c,isMeasuresDropped:r.toLocaleLowerCase().indexOf("measures")==0},this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(r==this._getLocalizedLabels("Measures")||r=="[Measures]")&&(e=this.model.pivotControl.model.dataSource.values[0].measures),t.Pivot.addReportItem(this.model.pivotControl.model.dataSource,l),this.model.pivotControl._calculatedField!=null&&this.model.pivotControl._calculatedField.length>0&&u!="value")for(o=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.isCalculatedField==!0&&n.formula.indexOf(r)>-1}),f=0;f<o.length;f++)this._tableTreeObj.uncheckNode(o[f].fieldName);this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl._calculatedField!=null&&this.model.pivotControl._calculatedField.length>0&&(a=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.isCalculatedField==!0}),this.model.pivotControl.model.dataSource.values=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return t.isNullOrUndefined(n.isCalculatedField)||n.isCalculatedField==!1}),n.merge(this.model.pivotControl.model.dataSource.values,a));this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(this.model.pivotControl._fieldMembers={},this.model.pivotControl._fieldSelectedMembers={},t.olap.base.clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"},this.model.pivotControl));this.model.pivotControl.element.hasClass("e-pivotclient")&&this.model.pivotControl._pivotChart&&(this.model.pivotControl._pivotChart._labelCurrentTags={});u==""&&(this._isDropAction=!0,this._tableTreeObj.element.find("li[tag='"+r+"']").removeClass("filter").find(".treeDrop,.filter").remove(),t.isNullOrUndefined(e)?this._tableTreeObj.uncheckNode(this._tableTreeObj.element.find("li[tag='"+r+"']")):(s=this,n.grep(e,function(n){s._tableTreeObj.uncheckNode(s._tableTreeObj.element.find("li[tag='"+n.fieldName+"']"))})),this._isDropAction=!1);this._refreshPivotButtons();this.model.pivotControl.refreshControl();this._setPivotBtnWidth()},_refreshPivotButtons:function(){this.model.layout=="normal"?(this.element.find(".axisTable .schemaFilter").html(this._createPivotButtons(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.filters:JSON.parse(this.model.pivotControl.getOlapReport()).Filters,"filter")),this.element.find(".axisTable .schemaRow").html(this._createPivotButtons(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.rows:JSON.parse(this.model.pivotControl.getOlapReport()).PivotRows,"row")),this.element.find(".axisTable .schemaColumn").html(this._createPivotButtons(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.columns:JSON.parse(this.model.pivotControl.getOlapReport()).PivotColumns,"column")),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.dataSource.values.length>0&&!t.isNullOrUndefined(this.model.pivotControl.model.dataSource.values[0].measures)&&this.model.pivotControl.model.dataSource.values[0].measures.length>0&&(this.model.pivotControl.model.dataSource.values[0].axis=="columns"?this.element.find(".axisTable .schemaColumn").append(this._createPivotButtons([{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}],"column")):this.model.pivotControl.model.dataSource.values[0].axis=="rows"&&this.element.find(".axisTable .schemaRow").append(this._createPivotButtons([{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}],"row"))),this.element.find(".axisTable .schemaValue").html(this._createPivotButtons(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.values:JSON.parse(this.model.pivotControl.getOlapReport()).PivotCalculations,"values"))):(this.element.find(".axisTable .schemaFilter").html(this._createPivotButtons1("filters",this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.filters:JSON.parse(this.model.pivotControl.getOlapReport()).Filters)),this.element.find(".axisTable .schemaRow").html(this._createPivotButtons1("rows",this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.rows:JSON.parse(this.model.pivotControl.getOlapReport()).PivotRows)),this.element.find(".axisTable .schemaColumn").html(this._createPivotButtons1("columns",this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.columns:JSON.parse(this.model.pivotControl.getOlapReport()).PivotColumns)),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.dataSource.values.length>0&&!t.isNullOrUndefined(this.model.pivotControl.model.dataSource.values[0].measures)&&this.model.pivotControl.model.dataSource.values[0].measures.length>0&&(this.model.pivotControl.model.dataSource.values[0].axis=="columns"?this.element.find(".axisTable .schemaColumn").append(this._createPivotButtons1("columns",[{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}])):this.model.pivotControl.model.dataSource.values[0].axis=="rows"&&this.element.find(".axisTable .schemaRow").append(this._createPivotButtons1("rows",[{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}]))),this.element.find(".axisTable .schemaValue").html(this._createPivotButtons1("values",this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.dataSource.values:JSON.parse(this.model.pivotControl.getOlapReport()).PivotCalculations)));this.model.enableDragDrop&&this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button,enableRTL:this.model.enableRTL}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped:this._clientOnPvtBtnDropped,this),helper:t.proxy(function(t){if(t.sender.target.className.indexOf("e-btn")>-1){var i=n(t.sender.target).clone().attr("id",this._id+"_dragClone").appendTo("body");return n("#"+this._id+"_dragClone").removeAttr("style").height(n(t.sender.target).height()),i}return!1},this)});this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.pivotControl.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne&&this.element.find(".pvtBtn").css("max-width",this.element.find(".schemaColumn").width()-this.element.find(".removeClientPivotBtn").width()-6);this._createContextMenu();this._setSplitButtonTitle();this.element.parents(".e-pivotclient").length>0||this._setPivotBtnWidth()},_setSplitButtonTitle:function(){var i,r,f,u;if(this.element.find(".pvtBtn").length>0&&this._tableTreeObj!=null)for(i=0;i<this.element.find(".pvtBtn").length;i++)r=this.element.find(".pvtBtn:eq("+i+")").attr("fieldname"),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?(f=this._tableTreeObj.element.find("li[tag='"+r+"']").parents("li:eq(0)").find("a:eq(0)").text(),u=this.element.find(".pvtBtn:eq("+i+")").text(),r.toLowerCase().indexOf("measures")>=0?this.element.find(".pvtBtn:eq("+i+")").attr("title",u):this.element.find(".pvtBtn:eq("+i+")").attr("title",f+" - "+u)):this.element.find(".pvtBtn:eq("+i+")").attr("title",n.grep(this.model.pivotTableFields,function(n){return n.name==r})[0].caption)},_createPivotButtons1:function(r,u){var c="",f,e,h;if(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode)for(r=="values"&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(u=n.map(u,function(n){return n.measures})),f=0;f<u.length;f++){var a=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?"":u[f].fieldName,o=n.grep(this.model.pivotTableFields,function(n){return n.name==u[f].fieldName}),s=n.grep(this.model.pivotTableFields,function(n){return n.name==u[f]});if(o.length>0&&(o=o[0].caption),s.length>0&&(s=s[0].caption),e="",n(this.element).parents(".e-pivotclient").length>0){var l=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?!0:!1,v=l?"":t.PivotAnalysis.getMembers(u[f].fieldName),y=u[f].filterItems!=null&&u[f].filterItems.values.length>0||!t.isNullOrUndefined(u[f].advancedFilter)&&u[f].advancedFilter.length>0?"filtered":"";r=="filters"&&(y=="filtered"?e=t.Pivot._getFilterState(l,v,u[f],this.model.pivotControl):l?(t.olap._mdxParser.getAllMember(this.model.pivotControl.model.dataSource,u[f].fieldName,this.model.pivotControl),e=this.model.pivotControl._allMember):e=this.model.pivotControl._getLocalizedLabels("All"))}c+=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("button.pvtBtn#pivotButton"+a,(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?(u[f].fieldCaption!=i?u[f].fieldCaption:u[f].fieldName)||u[f]:o||s)+(r=="filters"&&e!=""?" ("+e+")":""),{},{fieldName:u[f].fieldName||u[f],axis:r})[0].outerHTML+t.buildTag("span."+(this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?"removeClientPivotBtn":"removePivotBtn"),{},{display:this.model.layout!=t.PivotSchemaDesigner.Layouts.OneByOne?"none":"inline-block"}).addClass("e-icon")[0].outerHTML).attr("tag",r+":"+u[f].fieldName||u[f])[0].outerHTML}else for(f=0;f<u.length;f++)e="",n(this.element).parents(".e-pivotclient").length>0&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(h=t.isNullOrUndefined(this.model.pivotControl._tempFilterData)?[]:n.map(this.model.pivotControl._tempFilterData,function(n){return n[u[f].DimensionHeader]}),r=="filters"&&(e=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl.model.enableAdvancedFilter&&this.model.pivotControl._getAdvancedFilterInfo(u[f].Tag).length>0?this.model.pivotControl._getAdvancedFilterInfo(u[f].Tag)[0].value1:h.length>0&&this.model.pivotControl._fieldMembers[u[f].DimensionHeader]?this.model.pivotControl._fieldMembers[u[f].DimensionHeader].length-h.length==1?this.model.pivotControl._fieldMembers[u[f].DimensionHeader].filter(function(n){if(h.indexOf(n)==-1)return n}):this.model.pivotControl._getLocalizedLabels("MultipleItems"):this.model.pivotControl._getLocalizedLabels("All"))),c+=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("button.pvtBtn#pivotButton"+(u[f].FieldHeader||u[f].FieldName||u[f].DimensionHeader||u[f].DimensionName||u[f].Name),(u[f].FieldHeader||u[f].FieldName||u[f].DimensionHeader||u[f].DimensionName||u[f].Name)+(r=="filters"&&e!=""?" ("+e+")":""),{},{fieldName:u[f].fieldName||u[f].FieldHeader||u[f].DimensionHeader||u[f].DimensionName||u[f].Name||u[f],fieldCaption:u[f].FieldHeader||u[f].FieldName||u[f].DimensionName||u[f].DimensionHeader,axis:r})[0].outerHTML+t.buildTag("span."+(this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?"removeClientPivotBtn":"removePivotBtn"),{},{display:this.model.layout!=t.PivotSchemaDesigner.Layouts.OneByOne?"none":"inline-block"}).addClass("e-icon")[0].outerHTML).attr("tag",r+":"+(u[f].FieldName||u[f].FieldHeader||u[f].DimensionHeader||u[f].DimensionName||u[f].Name||u[f]))[0].outerHTML;return c},_pvtBtnDropped:function(r){var s,h,tt,a,l,it,w,b,f,k,d,rt,g,o,ut,nt,et;if(this.element.find(".dropIndicator").removeClass("dropIndicatorHover"),n(r.element).parent().removeClass("dragHover"),n(r.element).removeClass("dragHover"),n("#"+this._id+"_dragClone").remove(),s="",this._isDragging=!1,n(this.element).parents(".e-pivotclient").length>0&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot){n(r.target).hasClass("pivotButton")&&(r.target=r.target.childNodes[1]);var u=n(r.target).attr("class")?r.target.className.indexOf("e-droppable")>=0?r.target.className.split(" ")[0]:r.target.className.split(" ")[0]=="pvtBtn"?n(r.target).parents("div.e-droppable").attr("class").split(" ")[0]:"":"",e=r.element.attr("fieldcaption")||r.element.attr("fieldname"),a,ft=r.element.parent().attr("tag").split(":")[1],h=t.isNullOrUndefined(r.event)?"":this._setSplitBtnTargetPos(r.event);for(o=0;o<this.model.pivotTableFields.length;o++)if(this.model.pivotTableFields[o].name==e){this.model.pivotTableFields[o].isSelected=!0;s=this.model.pivotTableFields[o];break}try{a=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(ot){a=this.model.pivotControl.getOlapReport()}t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show();l=JSON.stringify({action:this.model.pivotControl.model.enableDeferUpdate?"nodeDroppedDeferUpdate":"nodeDropped",args:JSON.stringify({droppedFieldCaption:e,droppedFieldName:ft,headerTag:s,dropAxis:u,droppedPosition:h,currentReport:a}),customObject:JSON.stringify(this.model.pivotControl.model.customObject)});this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,l,this._pvtNodeDroppedSuccess);return}this.model.pivotControl._isUpdateRequired=!0;this._isDragging=!1;var c=null,v="",e,u,y=y=r.element.find("~ .filtered").length>0?!0:!1,p=!1;if(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap)c=t.isNullOrUndefined(r.target.className)?r.target:r.target.className.indexOf("pvtBtn")>-1?n(r.target).parents(".e-droppable")[0]:r.target.className.indexOf("e-droppable")?r.target:r.target[0].tagName.toLowerCase()=="td"?r.target.children(":last")[0]:r.target,t.isNullOrUndefined(c.className)?(v=c.hasClass("schemaColumn")?"Categorical":c.hasClass("schemaRow")?"Series":c.hasClass("schemaFilter")?"Slicer":"",this._droppedClass=u=c.hasClass("schemaColumn")?"schemaColumn":c.hasClass("schemaRow")?"schemaRow":c.hasClass("schemaFilter")?"schemaFilter":c.hasClass("schemaValue")?"schemaValue":""):(v=c.className.split(" ")[0]=="schemaColumn"?"Categorical":c.className.split(" ")[0]=="schemaRow"?"Series":c.className.split(" ")[0]=="schemaFilter"?"Slicer":"",u=c.className.split(" ")[0]),v==""&&r.element.parent().attr("tag").toLowerCase().indexOf("[measures]")>-1&&(v=this.element.find(".schemaRow .pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").length>0?"Series":"Categorical"),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?e=s=n(r.element.parent()[0]).attr("tag").split(":")[1]:s=n(r.element.parent()[0]).attr("tag");else for(u=t.isNullOrUndefined(r.target.className)?n(r.target).hasClass("schemaColumn")?"schemaColumn":n(r.target).hasClass("schemaRow")?"schemaRow":n(r.target).hasClass("schemaFilter")?"schemaFilter":n(r.target).hasClass("schemaValue")?"schemaValue":"":r.target.className.indexOf("e-droppable")>=0?r.target.className.split(" ")[0]:r.target.className.split(" ")[0]=="pvtBtn"?n(r.target).parents("div.e-droppable").attr("class").split(" ")[0]:"",e=this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?n.grep(this.model.pivotTableFields,function(n){return n.caption==r.element.text()})[0].name:r.element.text(),s,y=r.element.find("~ .filterIndicator").length>0?!0:!1,p=r.element.find("~ span:eq(0) span.descending").length>0?!0:!1,o=0;o<this.model.pivotTableFields.length;o++)this.model.pivotTableFields[o].name==e&&(this.model.pivotTableFields[o].isSelected=!0,s=this.model.pivotTableFields[o]);if(this._dataModel=="Olap"&&(s.split(":")[1].toLocaleUpperCase()=="MEASURES"&&(u!="schemaColumn"||u!="schemaRow")&&(u=="schemaFilter"||u=="schemaValue")||s.toUpperCase().indexOf("[MEASURES]")>-1&&u!="schemaValue"&&(u=="schemaRow"||u=="schemaColumn"||u=="schemaFilter")||s.toUpperCase().indexOf("[MEASURES]")==-1&&u=="schemaValue"))return this._createErrorDialog(),!1;if(u=="schemaValue"||u=="schemaRow"||u=="schemaColumn"||u=="schemaFilter"){if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._dataModel=="Pivot"&&u!="schemaValue"&&(n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==e}).length>0||n.grep(JSON.parse(this.model.pivotControl.getOlapReport()).PivotCalculations,function(n){return n.FieldHeader==e&&n.CalculationType==8}).length>0)){this.model.pivotControl._createErrorDialog(this.model.pivotControl._getLocalizedLabels("CalcValue"),this.model.pivotControl._getLocalizedLabels("Warning"));return}h=t.isNullOrUndefined(r.event)?"":this._setSplitBtnTargetPos(r.event);try{a=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(ot){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(a=this.model.pivotControl.getOlapReport())}if(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(this.model.pivotControl.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"}),it=u=="schemaFilter"&&this.model.pivotControl._getNodeByUniqueName(e)!=null&&this.model.pivotControl._getNodeByUniqueName(e).find(".namedSetCDB").length>0,w=n(r.element.parent()).attr("tag").split(":")[0]=="Columns"&&this._droppedClass=="schemaColumn"&&s.toLowerCase()=="measures"||n(r.element.parent()).attr("tag").split(":")[0]=="Rows"&&this._droppedClass=="schemaRow"&&s.toLowerCase()=="measures",w||it||e.toLowerCase().indexOf("[measures]")>=0&&u!="schemaValue"||u=="schemaValue"&&!(e.toLowerCase().indexOf("[measures]")>=0)||u=="schemaFilter"&&e.toLowerCase().indexOf("measures")>=0)return pschemaDesignerWaitingPopup.hide(),w||this._createErrorDialog(),r.Cancel;if(e.toLowerCase().indexOf("measures")>=0&&!(e.toLowerCase().indexOf("[measures]")>=0))return n(r.element.parent().parent()).remove(),this.model.pivotControl.model.dataSource.values[0].axis=u=="schemaRow"?"rows":u=="schemaColumn"?"columns":"columns",this._createPivotButton({fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")},u=="schemaRow"?"row":u=="schemaColumn"?"column":"column","","",h),t.olap.base.getJSONData({action:"nodeDropped"},this.model.pivotControl.model.dataSource,this.model.pivotControl),pschemaDesignerWaitingPopup.hide(),this._setPivotBtnWidth(),!1}if(this.model.pivotControl._dataModel=="Pivot"&&u!="schemaValue"&&n.grep(this.model.pivotControl._calculatedField,function(n){return n.name==e}).length>0){alert(this.model.pivotControl._getLocalizedLabels("CalcValue"));return}if(n(r.element.parent().parent()).remove(),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)this.model.pivotControl.model.enableDeferUpdate||t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show(),this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left}),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?(tt=this._currentCubeName+"--"+s+"--"+v+"--"+h,this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject}),l=JSON.stringify({action:"nodeDropped",dropType:"SplitButton",nodeInfo:tt,currentReport:a,gridLayout:this.model.pivotControl.model.layout,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),this.model.pivotControl.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,l.replace("nodeDropped","nodeDroppedDeferUpdate"),this._droppedSuccess):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,l,this._droppedSuccess)):(this._createPivotButton(e,u=="schemaRow"?"row":u=="schemaColumn"?"column":u=="schemaFilter"?"filter":u=="schemaValue"?"value":"",y,p,h),!t.isNullOrUndefined(this.model.pivotControl._calculatedField)&&this.model.pivotControl._calculatedField.length>0&&u!="schemaValue"&&this.model.pivotControl._calculatedFieldNodeRemove(s),this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.pivotControl.model.customObject}),b="",b=t.Pivot._getFilterParams(u,this._tempFilterData,e),l=JSON.stringify({action:"nodeDropped",dropAxis:u+"::"+h,filterParams:b,headerTag:JSON.stringify(s),sortedHeaders:this.model.pivotControl._ascdes,currentReport:a,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}),successMethod=this.model.pivotControl._renderControlSuccess,this.model.pivotControl.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,l.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtNodeDroppedSuccess),t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.nodeDropped,l,this._pvtNodeDroppedSuccess));else{if(f=this.model.pivotControl._getDroppedItem(e),k={},f.length>0&&(k=f[0].isNamedSets!=i?{fieldName:f[0].fieldName,fieldCaption:f[0].fieldCaption,isNamedSets:f[0].isNamedSets}:{fieldName:f[0].fieldName,fieldCaption:f[0].fieldCaption}),d=u=="schemaRow"?"row":u=="schemaColumn"?"column":u=="schemaFilter"?"filter":u=="schemaValue"?"value":"",this._createPivotButton(k,d,y,p,h),n.isNumeric(h)?u=="schemaRow"?this.model.pivotControl.model.dataSource.rows.splice(h,0,f[0]):u=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.splice(h,0,f[0]):u=="schemaValue"?this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.pivotControl.model.dataSource.values[0].measures.splice(h,0,f[0]):this.model.pivotControl.model.dataSource.values.splice(h,0,f[0]):this.model.pivotControl.model.dataSource.filters.splice(h,0,f[0]):u=="schemaRow"?this.model.pivotControl.model.dataSource.rows.push(f[0]):u=="schemaColumn"?this.model.pivotControl.model.dataSource.columns.push(f[0]):u=="schemaValue"?this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?this.model.pivotControl.model.dataSource.values[0].measures.push(f[0]):this.model.pivotControl.model.dataSource.values.push(f[0]):this.model.pivotControl.model.dataSource.filters.push(f[0]),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl._calculatedField.length>0&&u!="schemaValue"){for(rt=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return t.isNullOrUndefined(n.isCalculatedField)||n.isCalculatedField==!1||n.isCalculatedField==!0&&n.formula.indexOf(f[0].fieldName)==-1}),g=n.grep(this.model.pivotControl.model.dataSource.values,function(n){return n.isCalculatedField==!0&&n.formula.indexOf(f[0].fieldName)>-1}),o=0;o<g.length;o++)this._tableTreeObj.uncheckNode(g[o].fieldName);this.model.pivotControl.model.dataSource.values=rt}this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(ut=this.model.pivotControl.model.dataSource.values[0].axis=="columns"?"Columns:":"Rows:",nt=this.element.find("div[tag='"+ut+"Measures']:first"),nt.appendTo(nt.parent()),et=r.element.attr("axis").toLowerCase(),this.model.pivotControl.model.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"nodeDropped"}));this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.show(),t.olap.base.getJSONData({action:"nodeDropped"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(this._trigger("fieldItemDropped",{axis:d,fieldItem:f}),this.model.pivotControl.model.editCellsInfo={},this.model.pivotControl._populatePivotGrid())}}else this._removePvtBtn(r);this._setPivotBtnWidth()},_createErrorDialog:function(){if(t.Pivot.openPreventPanel(this),this.element.find(".errorDialog").length==0){var i=t.buildTag("div.errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent",this._getLocalizedLabels("AlertMsg"))[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK")[0].outerHTML)[0].outerHTML).attr("title",this._getLocalizedLabels("Warning"))[0].outerHTML;this.element.append(i);this.element.find(".errorDialog").ejDialog({target:"#"+this._id,enableResize:!1,enableRTL:this.model.enableRTL,width:"400px",close:t.proxy(t.Pivot.closePreventPanel,this)});this._errorDialog=this.element.find(".errorDialog").data("ejDialog");n("#"+this._errorDialog._id+"_wrapper").css({left:"10%",top:"50%"});this.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(this._errOKBtnClick,this)});this.element.find(".e-dialog .e-close").attr("title",this._getLocalizedLabels("Close"))}else this._errorDialog.open()},_errOKBtnClick:function(){t.Pivot.closePreventPanel(this);this._errorDialog._ejDialog.find("div.e-dialog-icon").trigger("click")},_hideSchemaDesigner:function(){n("#PivotSchemaDesigner").animate({left:"-"+n("#"+this._id).width()+"px"},500,function(){});this.element.find(".collapseSchema").addClass("expandSchema").removeClass("collapseSchema")},_showSchemaDesigner:function(){n("#PivotSchemaDesigner").animate({left:"5px"});this.element.find(".expandSchema").addClass("collapseSchema").removeClass("expandSchema")},_reSizeHandler:function(){var f,e,c,i,o,r,u,s,h;this.model.pivotControl&&(f=n("#"+this._id).width(),this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?(oclientProxy.model.isResponsive&&oclientProxy.element.find("div.axisTable").css("width","50%"),this.element.find(".axisTd1, .axisTd2").css({width:"100%"}),oclientProxy.model.isResponsive||(e=oclientProxy.element.find("#PivotSchemaDesigner").width()/2,oclientProxy.element.find("div.fieldTable").width(e-6),oclientProxy.element.find("div.axisTable").width(e-5))):(this.element.find("div.axisTable").width(f),c=(f-2)/2,this.element.find(".axisTd1, .axisTd2").css({width:c})),i=t.PivotSchemaDesigner.Layouts.OneByOne==this.model.layout?oclientProxy.element.find(".controlPanel").height()-15:25/100*n("#"+this._id).height(),this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne&&(i=this.element.find(".cubelists").length>0?i-this.element.find(".cubelists").height()-6:i+5),this.element.find("div.schemaFieldTree,div.fieldTable").height(i),n(this.element).parents(".e-pivotclient").length>0||(n("#"+this._id).height()<450&&n("#"+this._id).css("min-height","450px"),n("#"+this._id).width()<240&&n("#"+this._id).css("min-width","240px")),u=n(this.element).parents(".e-pivotclient").length>0?oclientProxy.element.find(".controlPanel").height()-10:n("#"+this._id).height()+20,s=t.PivotSchemaDesigner.Layouts.OneByOne==this.model.layout?0:this.element.find("table.headerTable").height()+this.element.find("div.fieldTable").height()+this.element.find("div.centerDiv").height()+this.element.find("div.centerHead").height(),o=this.model.pivotControl==null||this.model.pivotControl.element.hasClass("e-pivotclient")||this.model.pivotControl.model.operationalMode!=t.PivotGrid.OperationalMode.ServerMode?t.PivotSchemaDesigner.Layouts.OneByOne==this.model.layout?u:u-(s+80):u-(s+105),this.element.find("div.axisTable").height(o),r=o/(this.model.layout==t.PivotSchemaDesigner.Layouts.OneByOne?4:2),this.element.find(".axisTd1,.axisTd2").css({height:r}),n(this.element).parents(".e-pivotclient").length>0&&(oclientProxy.element.find(".schemaColumn, .schemaValue").height(r-28),oclientProxy.element.find(".schemaRow, .schemaFilter").height(r-28)),this._setPivotBtnWidth(),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(h=n(".schemaFieldTree ul>li div").width(),n(n(".e-pivotschemadesigner .schemaFieldTree.e-treeview .e-text")).each(function(){var t=(h-50)/h*100;n(this).width(t.toString()+"%")})))},_clientDialogBtnClick:function(i){var e=[],l=[],b=this._selectedFieldName,s={},w=this,c,a,v,r,y,p,f,h,u;if(this.element.find(".e-dialog, .clientDialog").hide(),this.element.find("#preventDiv").remove(),i.model.text.toLowerCase()!="cancel"){if(this.model.pivotControl._waitingPopup.show(),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap){this.model.pivotControl.element.hasClass("e-pivotclient")&&!t.isNullOrUndefined(this.model.pivotControl._pivotChart)&&(this.model.pivotControl._pivotChart._labelCurrentTags={});t.olap.base.clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"filtering"},this.model.pivotControl);this._memberTreeObj=t.Pivot.updateTreeView(this);var f=this._selectedFieldName,h=this.model.pivotControl.model.dataSource,o={};if(this.model.pivotControl._currentReportItems=n.map(this.model.pivotControl._currentReportItems,function(n){return n.fieldName==f&&(t.isNullOrUndefined(n.dataSrc)||n.dataSrc.cube==h.cube&&n.dataSrc.reportName==h.reportName)&&(o=n.filterItems,n.filterItems=w._memberTreeObj.dataSource()),n}),s=t.Pivot.getNodesState(this._memberTreeObj),(n(this.element).parents(".e-pivotclient").length>0||this.model.pivotControl.model.enableGroupingBar)&&(c=t.Pivot._getEditorMember(f.toLocaleLowerCase(),this.model.pivotControl,!0),this.model.pivotControl._fieldSelectedMembers[f.toLocaleLowerCase()]=n.map(this.model.pivotControl._fieldMembers[f.toLocaleLowerCase()],function(n){if(!n.checked)return n}).length==0?"All":c!="All"&&c!="multiple"?c:this.model.pivotControl._getLocalizedLabels("MultipleItems")),this.model.pivotControl.model.enableMemberEditorPaging){for(this.model.pivotControl._memberPageSettings.filterCollection=n.grep(this.model.pivotControl._memberPageSettings.filterCollection,function(n){if(v!=n.pageNo)return n}),this.model.pivotControl._memberPageSettings.filterCollection.push({pageNo:this.model.pivotControl._memberPageSettings.currentMemeberPage,memberTreeObj:n.extend({},this._memberTreeObj)}),r=0;r<this.model.pivotControl._memberPageSettings.filterCollection.length;r++)a=this.model.pivotControl._memberPageSettings.filterCollection[r],o=n.grep(o,function(n){if(a.pageNo!=n.pageNo)return n});if(v=this.model.pivotControl._memberPageSettings.currentMemeberPage,n.merge(this.model.pivotControl._memberPageSettings.filterCollection,o),this.model.pivotControl._memberPageSettings.filterCollection)for(r=0;r<this.model.pivotControl._memberPageSettings.filterCollection.length;r++)s.selectedNodes=s.selectedNodes+t.Pivot.getNodesState(this.model.pivotControl._memberPageSettings.filterCollection[r].memberTreeObj).selectedNodes}if(u=t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource,this._dataModel).item,e=n.map(s.selectedNodes.split("::"),function(n){return{Id:n.split("||")[0],tag:n.split("||")[1],parentId:n.split("||")[2]}}),!t.isNullOrUndefined(this.model.pivotControl._selectedNodes))for(r=0;r<this.model.pivotControl._selectedNodes.length;r++)y=this.model.pivotControl._selectedNodes[r],p=n.map(e,function(n){if(y.tag==n.tag)return n}),p.length==0&&e.push(this.model.pivotControl._selectedNodes[r]);t.isNullOrUndefined(u)||(u.advancedFilter=[],u.filterItems={filterType:"include",values:t.Pivot.removeParentSelectedNodes(e)},this._selectedTreeNode=this.element.find(".schemaFieldTree").find("li[tag='"+u.fieldName+"']"),n(this._selectedTreeNode).parents("li:eq(0) span:eq(0)").hasClass("hierarchyCDB")&&(this._selectedTreeNode=n(this._selectedTreeNode).parents("li:eq(0)")),s.unSelectedNodes!=""?(this.model.pivotControl.model.dataSource=t.olap.base.clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"filtering"},this.model.pivotControl),n(this._selectedTreeNode).find(".filter").length<=0&&(n(n(this._selectedTreeNode).find(".e-text")[0]).after(t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filtered").addClass("filter")[0].outerHTML),this.element.find(".pivotButton:contains('"+this._selectedFieldName+"') .filter").addClass("filtered"),this.element.find(".pvtBtn[fieldname='"+this._selectedFieldName+"']").parent().find(".filter").addClass("filtered"))):this.model.pivotControl._unSelectedNodes?(this.model.pivotControl.model.dataSource=t.olap.base.clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"filtering"},this.model.pivotControl),n(this._selectedTreeNode).find(".filter").length<=0&&(n(n(this._selectedTreeNode).find(".e-text")[0]).after(t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filtered").addClass("filter")[0].outerHTML),this.element.find(".pivotButton:contains('"+this._selectedFieldName+"') .filter").addClass("filtered"),this.element.find(".pvtBtn[fieldname='"+this._selectedFieldName+"']").parent().find(".filter").addClass("filtered"))):(this.element.find(".pvtBtn[fieldname='"+this._selectedFieldName+"']").parent().find(".filter").removeClass("filtered"),this._selectedTreeNode.find(".filter").remove(),delete u.filterItems));this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&(f=this._selectedFieldName,h=this.model.pivotControl.model.dataSource,this.model.pivotControl._currentReportItems=n.map(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName!=f&&(t.isNullOrUndefined(n.dataSrc)||n.dataSrc.cube==h.cube&&n.dataSrc.reportName==h.reportName))return n}),o=this.model.pivotControl.model.enableMemberEditorPaging?n.extend([],this.model.pivotControl._memberPageSettings.filterCollection):n.extend([],this._memberTreeObj.dataSource()),this.model.pivotControl._currentReportItems.push({filterItems:o,fieldName:f,dataSrc:this.model.pivotControl.model.dataSource,pageSettings:this._memberCount}));t.olap.base.getJSONData({action:"filtering"},this.model.pivotControl.model.dataSource,this.model.pivotControl)}else t.PivotAnalysis._valueSorting=null,jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:checked"),function(n,t){t.value!="All"&&e.push(t.value)}),jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:not(:checked)"),function(n,t){l.push(t.value=t.value=="(blank)"?"":t.value)}),this._selectedFieldName&&(u=u=t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource,this._dataModel).item,u&&(u.advancedFilter=[])),this._pivotFilterItems(e,l),this.model.pivotControl.refreshControl();this._refreshPivotButtons();this.model.pivotControl._isMemberPageFilter=!0}},_pivotFilterItems:function(i,r){var h=this.model.pivotControl.model.dataSource[this._selectedFieldAxis],e=t.PivotAnalysis.getMembers(this._selectedFieldName),o,f,u,s;for(jQuery.each(e,function(n,t){t!=null&&t.toString().replace(/^\s+|\s+$/gm,"")||jQuery.each(r,function(n,i){i.toString().replace(/^\s+|\s+$/gm,"")||(r[n]=t)})}),o=this._selectedFieldName,f=n.grep(h,function(n){return n.fieldName==o}),u=0;u<f.length;u++)f[u].filterItems=i.length==e.length?null:{filterType:t.PivotAnalysis.FilterType.Exclude,values:r};r.length>0&&this.element.find(".schemaFieldTree li[id='"+this._selectedFieldName+"']").find(".filter").length<=0?(s=t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML,this.element.find(".schemaFieldTree li[id='"+this._selectedFieldName+"']").find(".e-text").after(s),this.element.find(".pvtBtn[fieldname='"+this._selectedFieldName+"']").parent().find(".filter").addClass("filtered")):r.length==0&&(this.element.find(".pvtBtn[fieldname='"+this._selectedFieldName+"']").parent().find(".filter").removeClass("filtered"),this.element.find(".schemaFieldTree li[id='"+this._selectedFieldName+"']").find(".filter").remove())},_dialogBtnClick:function(r){var c,w,d,a,f,g,b,nt,s,p,u,it,l,rt;if(t.Pivot.closePreventPanel(this),this.element.find(".e-dialog, .clientDialog").hide(),!this._isFiltered)return!1;if(this.model.pivotControl._isUpdateRequired=!0,this.model.pivotControl!=null&&(this.model.pivotControl._memberTreeObj=this._memberTreeObj),this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(r.model.text.toLowerCase()=="cancel")return;c=[];w=[];this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?(d=this._selectedMember,this.model.pivotControl._currentReportItems=n.grep(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()!=d.toLocaleLowerCase())return n}),this._memberTreeObj=t.Pivot.updateTreeView(this),this.model.pivotControl._currentReportItems.push({filterItems:n.extend([],this._memberTreeObj.dataSource()),fieldName:this._selectedMember}),c=n.map(this.model.pivotControl._getSelectedNodes().split("::"),function(n){return{Id:n.split("||")[0],tag:n.split("||")[1],parentId:n.split("||")[2]}}),a=this._selectedMember!=i?this._selectedMember.toLocaleLowerCase():this._selectedMember.toLocaleLowerCase(),f=n.map(this.model.pivotControl.model.dataSource.columns,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()==a)return n}),f.length==0&&(f=n.map(this.model.pivotControl.model.dataSource.rows,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()==a)return n})),f.length==0&&(f=n.map(this.model.pivotControl.model.dataSource.filters,function(n){if(n.fieldName!=i&&n.fieldName.toLocaleLowerCase()==a)return n})),f.length>0&&(this._getUnSelectedNodes()!=""&&(this.model.pivotControl.model.dataSource=this.model.pivotControl._clearDrilledItems(this.model.pivotControl.model.dataSource,{action:"filtering"})),f[0].advancedFilter=[],f[0].filterItems={filterType:"include",values:this.model.pivotControl._removeSelectedNodes(c)},this._selectedTreeNode=this.element.find(".schemaFieldTree").find("li[tag='"+f[0].fieldName+"']"),n(this._selectedTreeNode).parents("li:eq(0)").children().children("span").hasClass("hierarchyCDB")&&(this._selectedTreeNode=n(n(this._selectedTreeNode).parents("li:eq(0)"))),this._getUnSelectedNodes()==""?(this._selectedTreeNode.find(".filter").remove(),this.element.find(".pvtBtn[fieldname='"+this._selectedMember+"']").parent().find(".filter").removeClass("filtered"),delete f[0].filterItems):n(n(this._selectedTreeNode)).find(".filter").length<=0&&(n(n(this._selectedTreeNode).find(".e-text")[0]).after(t.buildTag("span.e-icon").attr("role","button").attr("aria-label","filtered").addClass("filter")[0].outerHTML),this.element.find(".pvtBtn[fieldname='"+this._selectedMember+"']").parent().find(".filter").addClass("filtered"))),t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show(),t.olap.base.getJSONData({action:"filtering"},this.model.pivotControl.model.dataSource,this.model.pivotControl)):(t.PivotAnalysis._valueSorting=null,jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:checked"),function(n,t){t.value!="All"&&c.push(t.value)}),jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:not(:checked)"),function(n,t){w.push(t.value=t.value=="(blank)"?"":t.value)}),this.element.find(".e-dialog, .clientDialog").hide(),this.model.pivotControl._pivotFilterItems(c,w),this.model.pivotControl.model.editCellsInfo={},this.model.pivotControl._populatePivotGrid())}else{if(g="",nt=this.element.find(".editorTreeView :input.nodecheckbox"),r.model.text.toLowerCase()!="cancel"){var h=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?g=this._getUnSelectedNodes()+"FILTERED"+this.model.pivotControl._getSelectedNodes(this._curFilteredAxis=="schemaFilter"?!0:!1):this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),v=!1,e=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?h:this._curFilteredAxis+"::"+this._curFilteredText+"::FILTERED",o=this._curFilteredText,k=[],y={};if(b=this._getUnSelectedNodes()!=""?!0:!1,this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot){for(t.isNullOrUndefined(this.model.pivotControl._fieldMembers[o])&&(n(this.element).parents(".e-pivotclient").length>0||this.model.pivotControl.model.enableGroupingBar)&&(this.model.pivotControl._fieldMembers[o]=t.Pivot._getEditorMember(nt,this.model.pivotControl,!0)),u=0;u<h.length;u++)k.push(n(h[u].parentElement).siblings("a").text());for(y[o]=k,s=this.element.parents(".e-pivotclient").length>0?this.model.pivotControl._tempFilterData:this._tempFilterData,t.isNullOrUndefined(s)&&(s=[]),u=0;u<s.length;u++)t.isNullOrUndefined(s[u][o])||(s[u][o]=k,v=!0);if(v||s.push(y),this._tempFilterData=this.model.pivotControl._tempFilterData=s,(t.isNullOrUndefined(this._curFilteredAxis)||this._curFilteredAxis!="")&&this._curFilteredAxis!="schemaValue")for(u=0;u<h.length;u++)e+="##"+n(h[u].parentElement).siblings("a").text()}else{for(this.model.pivotControl.model.enableGroupingBar&&(p=t.Pivot._getEditorMember(o,this.model.pivotControl,!0),this.model.pivotControl._fieldSelectedMembers[o]=n.map(this.model.pivotControl._fieldMembers[o],function(n){if(!n.checked)return n}).length==0?"All":p!="All"&&p!="multiple"?p:this.model.pivotControl._getLocalizedLabels("MultipleItems")),y[this._curFilteredText]=e,t.isNullOrUndefined(this.model.pivotControl._tempFilterData)&&(this.model.pivotControl._tempFilterData=[]),u=0;u<this.model.pivotControl._tempFilterData.length;u++)t.isNullOrUndefined(this.model.pivotControl._tempFilterData[u][this._curFilteredText])||(this.model.pivotControl._tempFilterData[u][this._curFilteredText]=e,v=!0);v||this.model.pivotControl._tempFilterData.push(y)}var tt=this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?this._curFilteredText:this._curFilteredText.split(".")[1],ut=this._getSortedHeaders(),ft=this.model.layout=="excel"?this.element.find(".schemaFieldTree li:contains('"+this._curFilteredText+"')"):this.element.find("."+this._curFilteredAxis+" .pivotButton:contains("+this._curFilteredText+") .filterBtn");if((this.model.layout=="excel"||this.model.layout=="normal")&&(n(this._selectedTreeNode).parents("li:eq(0)").children().children("span").hasClass("hierarchyCDB")&&(this._selectedTreeNode=n(n(this._selectedTreeNode).parents("li:eq(0)"))),b&&n(n(this._selectedTreeNode)).find(".filter").length<=0?(it=t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML,n(n(this._selectedTreeNode).find(".e-text")[0]).after(it),this.element.find(".pvtBtn:contains('"+tt+"')").parent().find(".filter").addClass("filtered")):b||(n(this._selectedTreeNode).find(".filter").remove(),this.element.find(".pvtBtn:contains('"+tt+"')").parent().find(".filter").removeClass("filtered")),this._curFilteredAxis==""))return!1;this.model.pivotControl.model.enableGroupingBar&&(n.each(this.model.pivotControl.element.find(".pivotButton .filter"),function(t,i){n(i).removeClass("filtered")}),(this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?h.length>0:h.split("FILTERED::")[0].length>0)&&this.model.pivotControl.element.find("#pivotButton"+this._curFilteredText.split(".")[0]).next().addClass("filtered"));try{l=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(et){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(l=this.model.pivotControl.getOlapReport())}this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.pivotControl.model.customObject});rt=this.model.pivotControl.model.customObject!={}&&e!=""?JSON.stringify({action:"filtering",filterParams:e,sortedHeaders:this.model.pivotControl._ascdes,currentReport:l,gridLayout:this.model.pivotControl.model.layout,customObject:JSON.stringify(this.model.pivotControl.model.customObject)}):this.model.pivotControl.model.customObject!={}?JSON.stringify({action:"filtering",currentReport:l,customObject:serializedCustomObject}):e!=""?JSON.stringify({action:"filtering",filterParams:e,sortedHeaders:this.model.pivotControl._ascdes,currentReport:l}):JSON.stringify({action:"filtering"});t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.show();this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.model.pivotControl.model.enableDeferUpdate?(this.model.pivotControl._filterUpdate.push(e),t.isNullOrUndefined(this.model.pivotControl._waitingPopup)||this.model.pivotControl._waitingPopup.hide(),this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.filtering,rt,this._filterElementSuccess)}this._selectedTreeNode=null;this._refreshPivotButtons()}},_beforeNodeExpand:function(n){t.Pivot.getChildNodes(n,this._selectedFieldName,this.model.pivotControl._currentReportItems,this.model.pivotControl.model.dataSource,this)},_nodeExpand:function(n){this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&this.model.pivotControl._nodeExpand(n)},_nodeStateModifiedSuccess:function(n){this.model.pivotControl._isUpdateRequired=!0;n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject});this.model.pivotControl.model.enableDeferUpdate?this.model.pivotControl._deferUpdateSuccess(n):this.model.pivotControl._renderControlSuccess(n);this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_pvtNodeDroppedSuccess:function(r){r[0]!=i?r[2]!=null&&r[2]!=i&&(this.model.customObject=r[2].Value):r.d!=i?(r.d[2]!=null&&r.d[2]!=i&&(this.model.customObject=r.d[2].Value),r.d[0].Key=="PivotReport"&&this.model.pivotControl.setOlapReport(r.d[0].Value)):(r.customObject!=null&&r.customObject!=i&&(this.model.customObject=r.customObject),this.model.pivotControl.setOlapReport(r.PivotReport));this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject});this.model.pivotControl.model.enableDeferUpdate?this.model.pivotControl._deferUpdateSuccess(r):n(this.element).parents(".e-pivotclient").length>0&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?this.model.pivotControl.refreshControl(r):this.model.pivotControl._renderControlSuccess(r);this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_pvtBtnDroppedSuccess:function(n){n[0]!=i?n[2]!=null&&n[2]!=i&&(this.model.customObject=n[2].Value):n.d!=i?n.d[2]!=null&&n.d[2]!=i&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=i&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.customObject});this.model.pivotControl._renderControlSuccess(n);this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_filterElementSuccess:function(r){if(n(this.element).parents(".e-pivotclient").length>0){if(!t.isNullOrUndefined(r.d)){var u={};u.PivotReport=r.d[0].Value;u.GridJSON=r.d[1].Value;u.ChartJSON=r.d[2].Value;r=u}this.model.pivotControl._renderClientControls(r)}else r[0]!=i?r[2]!=null&&r[2]!=i&&(this.model.customObject=r[2].Value):r.d!=i?r.d[2]!=null&&r.d[2]!=i&&(this.model.customObject=r.d[2].Value):r.customObject!=null&&r.customObject!=i&&(this.model.customObject=r.customObject),this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.customObject}),this.model.pivotControl._renderControlSuccess(r);this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_fetchChildNodeSuccess:function(r){var u,f,e;r.length>1&&r[0]!=i?(u=JSON.parse(r[0].Value),r[1]!=null&&r[1]!=i&&(this.model.customObject=r[1].Value)):r.d!=i?(u=JSON.parse(r.d[0].Value),r.d[1]!=null&&r.d[1]!=i&&(this.model.customObject=r.d[1].Value)):(u=JSON.parse(r.ChildNodes),r.customObject!=null&&r.customObject!=i&&(this.model.customObject=r.customObject));e={id:"id",parentId:"pid",hasChild:"hasChildren",text:"name",isChecked:"checkedStatus"};f=n(this.pNode).parents("li").length>1?n(this.pNode).parents("li").first():n(this.pNode).parents("li");n(n(f).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1});this._memberTreeObj._createSubNodesWhenLoadOnDemand(u,this.pNode,e);n.each(n(f).children().find("li"),function(n,t){t.setAttribute("tag",u[n].tag)});this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"memberExpanded",element:this.element,customObject:this.model.customObject});this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_fetchMemberSuccess:function(n){n[0]!=i&&n.length>0?(this._currentMembers=n[0].Value,n[1]!=null&&n[1]!=i&&(this.model.customObject=n[1].Value)):n.d!=i&&n.d.length>0?(this._currentMembers=n.d[0].Value,n.d[1]!=null&&n.d[1]!=i&&(this.model.customObject=n.d[1].Value)):n!=i&&n.length>0?(this._currentMembers=n.EditorTreeInfo,n!=null&&n.customObject!=i&&(this.model.customObject=n.customObject)):n!=i&&(this._currentMembers=n.EditorTreeInfo,n!=null&&n.customObject!=i&&(this.model.customObject=n.customObject));this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.customObject});this._createDialog(this._dialogHead,this._currentMembers);this.model.pivotControl._waitingPopup&&this.model.pivotControl._waitingPopup.hide();this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style");t.isNullOrUndefined(this.element.find(".e-dialog .e-text:visible").first())||this.element.find(".e-dialog .e-text:visible").first().attr("tabindex","-1").focus().addClass("hoverCell")},_droppedSuccess:function(r){var u=null;this.model.pivotControl.model.enableDeferUpdate?u=this._removeButtonDeferUpdate==!1?t.isNullOrUndefined(r.OlapReport)?JSON.parse(r.d[0].Value):JSON.parse(r.OlapReport):u=t.isNullOrUndefined(r.OlapReport)?r.d[0].Value:r.OlapReport:(!t.isNullOrUndefined(r[0])&&r.length>0?(u=JSON.parse(r[1].Value),r[2]!=null&&r[2]!=i&&(this.model.customObject=r[2].Value)):!t.isNullOrUndefined(r.d)&&r.d.length>0?(u=n(this.element).parents(".e-pivotclient").length>0&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?JSON.parse(n.grep(r.d,function(n){return n.Key=="PivotReport"})[0].Value):JSON.parse(r.d[1].Value),r.d[2]!=null&&r.d[2]!=i&&(this.model.customObject=r.d[2].Value)):t.isNullOrUndefined(r)||t.isNullOrUndefined(r.OlapReport)?t.isNullOrUndefined(r)||t.isNullOrUndefined(r.PivotReport)||(u=JSON.parse(r.PivotReport)):u=JSON.parse(r.OlapReport),r.customObject!=null&&r.customObject!=i&&(this.model.customObject=r.customObject));this._removeButtonDeferUpdate==!1&&(this.element.find(".axisTable .pivotButton").remove(),this._setPivotRows(u.PivotRows),this._setPivotColumns(u.PivotColumns),this._setPivotCalculations(u.PivotCalculations),this._setFilters(u.Filters),this.model.pivotControl.setOlapReport(JSON.stringify(u)),this.element.find(".axisTable .schemaFilter").append(this._createPivotButtons(this.model.filters,"filter")),this.element.find(".axisTable .schemaRow").append(this._createPivotButtons(this.model.pivotRows,"row")),this.element.find(".axisTable .schemaColumn").append(this._createPivotButtons(this.model.pivotColumns,"column")),this.element.find(".axisTable .schemaValue").append(this._createPivotButtons(this.model.pivotCalculations,"values")),this.model.enableDragDrop&&this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button,enableRTL:this.model.enableRTL}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped:this._clientOnPvtBtnDropped,this),helper:t.proxy(function(t){if(n(t.element).addClass("dragHover"),t.sender.target.className.indexOf("e-btn")>-1){var i=n(t.sender.target).clone().attr("id",this._id+"_dragClone").appendTo("body");return n("#"+this._id+"_dragClone").removeAttr("style").height(n(t.sender.target).height()),i}return!1},this)}),this._unWireEvents(),this._wireEvents());this.model.pivotControl.model.enableDeferUpdate?(t.isNullOrUndefined(this.model.pivotControl._ogridWaitingPopup)||this.model.pivotControl._ogridWaitingPopup.hide(),t.isNullOrUndefined(r.OlapReport)?(this.model.pivotControl.setOlapReport(r.d[0].Value),n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=i&&this.model.pivotControl._pagerObj.initPagerProperties(JSON.parse(r.d[2].Value),JSON.parse(r.d[1].Value))):(this.model.pivotControl.setOlapReport(r.OlapReport),r.HeaderCounts!=i&&n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=i&&this.model.pivotControl._pagerObj.initPagerProperties(JSON.parse(r.HeaderCounts),JSON.parse(r.PageSettings))),this._removeButtonDeferUpdate=!1,this.model.pivotControl._deferUpdateSuccess(r)):n(this.element).parents(".e-pivotclient").length>0&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?this.model.pivotControl.refreshControl(r):this.model.pivotControl._renderControlSuccess(r);this.model.afterServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("afterServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject});this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style");this._createContextMenu();this._setPivotBtnWidth()},_removePvtBtn:function(i){var e,u,o,f,s,r;this.model.pivotControl._waitingPopup.show();n(i.element).length>0?(e=n(i.element).parent().attr("tag").split(":")[1],u=n(i.element).parent().attr("tag")):(e=n(i.target).parent().attr("tag").split(":")[1],u=n(i.target).parent().attr("tag"));try{o=JSON.parse(this.model.pivotControl.getOlapReport()).Report}catch(h){t.isNullOrUndefined(this.model.pivotControl.getOlapReport)||(o=this.model.pivotControl.getOlapReport())}if(o==""&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap&&(o=this.model.pivotControl.model.dataSource),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap)if(f=u.indexOf("[Measures]")>-1||u.indexOf("[")>-1?u.split(":")[1]:this.model.pivotControl._getNodeUniqueName(u),f=f.indexOf("<>")?f.replace("<>","."):f,f=="[Measures]"){if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)t.Pivot.removeReportItem(this.model.pivotControl.model.dataSource,e,e.toLocaleLowerCase().indexOf("measures")==0),this.model.pivotControl.refreshControl(),this.refreshControl();else if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode){for(n(i.element).length>0?n(i.element).parent().parent().remove():n(i.target).parent().parent().remove(),r=0;r<this.model.pivotCalculations.length&&u.indexOf(this._getLocalizedLabels("Measures"))>-1;r++)f=this.model.pivotCalculations[r].Tag,this._isMeasureBtnRemove=!0,selectedTreeNode=this.model.pivotControl._getNodeByUniqueName(f),this._tableTreeObj.uncheckNode(selectedTreeNode);this.element.find(".schemaNoClick").addClass("freeze").width(n(this.element).width()).height(n(this.element).height()).css({top:n(this.element).offset().top,left:n(this.element).offset().left});this.model.beforeServiceInvoke!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&this._trigger("beforeServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.pivotControl.model.customObject});s=JSON.stringify({action:"removeButton",headerInfo:u,currentReport:o,customObject:JSON.stringify(this.model.pivotControl.model.customObject),gridLayout:this.model.pivotControl.model.layout});u.indexOf("[Measures]")<0&&u.indexOf("Measures")>=0&&this.element.find(".schemaValue .pivotButton").remove();this.model.pivotControl.model.enableDeferUpdate?(this._removeButtonDeferUpdate=!0,this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,s.replace("removeButton","removeButtonDeferUpdate"),this._droppedSuccess),this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")):this.doAjaxPost("POST",this.model.pivotControl.model.url+"/"+this.model.serviceMethods.removeButton,s,this._pvtBtnDroppedSuccess)}}else selectedTreeNode=this.model.pivotControl._getNodeByUniqueName(f),this._tableTreeObj.uncheckNode(selectedTreeNode);else if(this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(t.PivotAnalysis._valueSorting=null,e=n(i.element).length>0?n(i.element).parent().find(".pvtBtn").attr("fieldname"):n(i.target).parent().find(".pvtBtn").attr("fieldname"),this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap){if(u.split(":")[1].toLowerCase()=="measures"){for(this.model.pivotControl._ogridWaitingPopup.show(),this.element.find("div[tag='"+u+"']").remove(),r=0;r<this.model.pivotControl.model.dataSource.values[0].measures.length;r++)this._nodeCheck=!0,selectedTreeNode=this._tableTreeObj.element.find("li[tag='"+this.model.pivotControl.model.dataSource.values[0].measures[r].fieldName+"']"),this._tableTreeObj.uncheckNode(selectedTreeNode),this.element.find("div[tag='values:"+this.model.pivotControl.model.dataSource.values[0].measures[r].fieldName+"']").remove();this.model.pivotControl.model.dataSource.values[0].measures=[];t.olap.base.getJSONData({action:"removeButton"},this.model.pivotControl.model.dataSource,this.model.pivotControl)}if(selectedTreeNode=this._tableTreeObj.element.find("li[tag='"+e+"']"),selectedTreeNode.length>1)for(r=0;r<selectedTreeNode.length;r++)this._tableTreeObj.isNodeChecked(selectedTreeNode[r])&&(selectedTreeNode=selectedTreeNode[r])}else selectedTreeNode=this._tableTreeObj.element.find("li[id="+e+"]");this._tableTreeObj.uncheckNode(selectedTreeNode)}else selectedTreeNode=this._tableTreeObj.element.find("li:contains('"+e+"')"),this._tableTreeObj.uncheckNode(selectedTreeNode)},_createDialog:function(i,r){var s,g,h,c,e,l,y,p,u,it,a,w;this.element.find(".e-dialog, .clientDialog").remove();var v,f,b="",k="",d="",o=this.model.pivotControl&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode&&this.model.pivotControl.model.enableAdvancedFilter||this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode&&this.model.pivotControl.model.dataSource.enableAdvancedFilter&&t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource,this._dataModel).axis!="filters"&&t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource,this._dataModel).axis!="values"&&!t.isNullOrUndefined(t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource,this._dataModel).item)?!0:!1;o&&(s=JSON.parse(r),s[0].name="(Select All)",v=this._selectedFieldName,this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Olap?(f=n.map(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName==v)return n.dropdownData}),f.length==0&&(f=n.map(this._tableTreeObj.element.find("li[tag ='"+this._selectedFieldName+"'] li"),function(t){return{value:n(t).attr("tag"),text:n(t).find("a").text()}}))):f=[{value:this._selectedFieldName,text:this._selectedFieldName}]:this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Olap?(f=s.splice(s.length-1,1),f=JSON.parse(f[0].levels)):f=[{value:this._curFilteredText,text:this._curFilteredText}],r=JSON.stringify(s),b=t.buildTag("div.ddlGroupWrap",this._getLocalizedLabels("SelectField")+":"+t.buildTag("input#GroupLabelDrop.groupLabelDrop").attr("type","text")[0].outerHTML,{})[0].outerHTML,k=t.buildTag("ul.filterElementTag")[0].outerHTML,g=t.Pivot.createAdvanceFilterTag({action:"filterTag"},this));d=t.buildTag("div.memberSearchEditorDiv",t.buildTag("input#searchEditorTreeView.searchEditorTreeView").attr("type","text")[0].outerHTML,{padding:this.model.pivotControl.model.enableAdvancedFilter?"5px 5px 0px 9px":0})[0].outerHTML;var rt=t.buildTag("div#EditorDiv.editorDiv",b+k+t.buildTag("div",d+t.buildTag("div.memberEditorDiv",t.buildTag("div#editorTreeView.editorTreeView")[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML+"<\/br>",ut=t.buildTag("div",t.buildTag("button#OKBtn.dialogOKBtn",this._getLocalizedLabels("OK"))[0].outerHTML+t.buildTag("button#CancelBtn.dialogCancelBtn",this._getLocalizedLabels("Cancel"))[0].outerHTML,{float:"right",margin:(!t.isNullOrUndefined(r)&&n.parseJSON(r).length>=this.model.pivotControl.model.memberEditorPageSize?"10px":"-5px ")+" "+(o?" 5px ":" 0px ")+" 6px 0px"})[0].outerHTML,ft=t.buildTag("div",t.buildTag("div#NextpageDiv.nextPageDiv",t.buildTag("div.e-icon e-media-backward_01 firstPage",{})[0].outerHTML+t.buildTag("div.e-icon e-arrowhead-left prevPage",{})[0].outerHTML+t.buildTag("input.memberCurrentPage#memberCurrentPage",{},{width:"20px",height:"10px"})[0].outerHTML+t.buildTag("span.memberPageCount#memberPageCount")[0].outerHTML+t.buildTag("div.e-icon e-arrowhead-right nextPage",{})[0].outerHTML+t.buildTag("div.e-icon e-media-forward_01 lastPage",{})[0].outerHTML)[0].outerHTML)[0].outerHTML,et=t.buildTag("div#clientDialog.clientDialog",rt+(!t.isNullOrUndefined(r)&&this.model.pivotControl.model.enableMemberEditorPaging&&(n.parseJSON(r).length>=this.model.pivotControl.model.memberEditorPageSize||this.model.pivotControl.model.memberEditorPageSize<this.model.pivotControl._memberPageSettings.endPage)?ft:"")+ut,{opacity:"1"}).attr("title",i)[0].outerHTML,r=JSON.parse(r),h;for(u=0;u<r.length;u++)r[u].name!=null&&r[u].name.toString().replace(/^\s+|\s+$/gm,"")||(r[u].name="(blank)",r[u].id="(blank)");if(this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?!t.isNullOrUndefined(this.model.pivotControl._fieldMembers):!t.isNullOrUndefined(this._tempFilterData)){if(this.model.pivotControl.model.analysisMode==t.PivotGrid.AnalysisMode.Olap&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)for(u=0;u<Object.keys(this.model.pivotControl._fieldMembers).length;u++)t.isNullOrUndefined(this.model.pivotControl._fieldMembers[this._curFilteredText])||(h=n.map(this.model.pivotControl._fieldMembers[this._curFilteredText],function(n){if(!n.checked)return n.name}));else for(u=0;u<this._tempFilterData.length;u++)t.isNullOrUndefined(this._tempFilterData[u][i])||(h=this._tempFilterData[u][i]);if(!t.isNullOrUndefined(h))for(u=0;u<h.length;u++)for(c=0;c<r.length;c++)h[u]==r[c].name&&(r[c].checkedStatus=!1)}for(n(et).appendTo("#"+this._id),this.model.pivotControl.model.enableMemberEditorPaging&&(r.length>=this.model.pivotControl.model.memberEditorPageSize||this.model.pivotControl.model.memberEditorPageSize<this.model.pivotControl._memberPageSettings.endPage)&&(this.element.find(".prevPage, .firstPage").addClass("disabled"),this.element.find(".nextPage, .lastPage").addClass("enabled"),e=this._memberCount/this.model.pivotControl.model.memberEditorPageSize,e!=Math.round(e)&&(e=parseInt(e)+1),this.element.find(".memberPageCount").html("/ "+e),this.element.find(".memberCurrentPage").val(this.model.pivotControl._memberPageSettings.currentMemeberPage),this.model.pivotControl._memberPageSettings.currentMemeberPage>1?this.element.find(".prevPage, .firstPage").removeClass("disabled").addClass("enabled"):this.element.find(".prevPage, .firstPage").removeClass("enabled").addClass("disabled"),this.model.pivotControl._memberPageSettings.currentMemeberPage==parseInt(this.element.find(".memberPageCount").text().split("/")[1].trim())?this.element.find(".nextPage, .lastPage").removeClass("enabled").addClass("disabled"):this.element.find(".nextPage, .lastPage").removeClass("disabled").addClass("enabled"),this.element.find(".nextPageDiv .disabled").css("opacity","0.5")),this.element.find("#searchEditorTreeView").ejMaskEdit({name:"inputbox",width:"100%",inputMode:t.InputMode.Text,watermarkText:this._getLocalizedLabels("Search")+" "+i,maskFormat:"",textAlign:this.model.enableRTL?"right":"left",change:t.proxy(t.Pivot._searchTreeNodes,this)}),this.element.find(".editorTreeView").ejTreeView({showCheckbox:!0,loadOnDemand:!0,enableRTL:this.model.enableRTL,beforeDelete:function(){return!1},height:n(".memberEditorDiv").height(),fields:{id:"id",text:"name",isChecked:"checkedStatus",hasChild:"hasChildren",dataSource:r}}),o&&(this.element.find(".filterElementTag").ejMenu({fields:{dataSource:g,id:"id",parentId:"parentId",text:"text",spriteCssClass:"spriteCssClass"},menuType:t.MenuType.NormalMenu,width:"100%",enableRTL:this.model.enableRTL,orientation:t.Orientation.Vertical,click:t.proxy(this._filterElementClick,this)}),this.element.find(".groupLabelDrop").ejDropDownList({width:"99%",enableRTL:this.model.enableRTL,dataSource:f,fields:{id:"id",text:"text",value:"value"},change:t.proxy(this._groupLabelChange,this),create:function(){n(this.wrapper.find(".e-input")).focus(function(){n(this).blur()})}}),l=t.isNullOrUndefined(this._selectedLevel)?"":this._selectedLevel,l=n.map(f,function(n){if(n.value.toLowerCase()==l.toLowerCase())return n.text}),y=this.element.find(".groupLabelDrop").data("ejDropDownList"),y.selectItemByText(l.length>0?l[0]:y.model.dataSource[0].text),this.element.find(".memberEditorDiv").addClass("advancedFilter")),p=this.element.find(".editorTreeView").find("li"),u=0;u<p.length;u++)p[u].setAttribute("tag",r[u].tag);this.element.find(".dialogOKBtn, .dialogCancelBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this._clientDialogBtnClick:this._dialogBtnClick,this)});this._dialogOKBtnObj=this.element.find(".dialogOKBtn").data("ejButton");this._memberTreeObj=this.element.find(".editorTreeView").data("ejTreeView");var nt=this.element.find(".editorTreeView li:gt(0)"),tt=n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)"),ot=n(nt).find(":input.nodecheckbox:not(:checked)");ot.length>0&&n(tt).removeClass("e-checkmark").addClass("e-stop");!t.isNullOrUndefined(this.model.pivotControl._unSelectedNodes)&&this.model.pivotControl._isMemberPageFilter&&(it=this.model.pivotControl._unSelectedNodes,n.map(nt,function(t){var i=t;n.map(it,function(t){n(i).attr("tag")==t.tag&&(n(n(i).find("div .e-chkbox-small > span > span:eq(0)")).removeClass("e-checkmark"),n(tt).removeClass("e-checkmark").addClass("e-stop"))})}));this.element.find(".clientDialog").ejDialog({width:o?"auto":265,target:"#"+this._id,enableResize:!1,enableRTL:this.model.enableRTL,close:t.proxy(t.Pivot.closePreventPanel,this)});this.element.find(".clientDialog").next(".e-scrollbar").hide();this.element.find(".e-dialog .e-close").attr("title",this._getLocalizedLabels("Close"));o&&(this.element.find("#clientDialog_wrapper").addClass("advancedFilterDlg"),this.element.find("#clientDialog_wrapper").css("min-width","265px"),this._droppedClass!="schemaFilter"&&(this.element.find(".clientDialog").css("padding","0px").parents().parents().find(".e-titlebar").remove(),a=t.Pivot.getReportItemByFieldName(v,this.model.pivotControl.model.dataSource).item,a&&a.sortOrder&&a.sortOrder!=t.olap.SortOrder.None&&(w=a.sortOrder==t.olap.SortOrder.Descending?"desc":"asc",t.isNullOrUndefined(w)||w=="asc"?this.element.find(".clientDialog .ascImage").addClass("selectedSort"):this.element.find(".clientDialog .descImage").addClass("selectedSort"))));this._memberTreeObj.model.nodeCheck=t.proxy(this._nodeCheckChanges,this);this._memberTreeObj.model.nodeUncheck=t.proxy(this._nodeCheckChanges,this);this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?this._memberTreeObj.model.beforeExpand=t.proxy(this._beforeNodeExpand,this):this._memberTreeObj.model.nodeClick=t.proxy(this._nodeExpand,this);this._memberTreeObj.element.find(".e-plus").length==0&&this._memberTreeObj.element.find(".e-item").css("padding","0px");this._isFiltered=!1;this.model.pivotControl._isMemberPageFilter=!1;t.isNullOrUndefined(pschemaDesignerWaitingPopup)||pschemaDesignerWaitingPopup.hide()},_filterElementClick:function(r){var u,s,c,h,f,l,e,o;if(this.model.pivotControl._selectedField=this._selectedFieldName,this.model.pivotControl&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode)return this.model.pivotControl._selectedField=this.model.pivotControl._curFilteredText=this._curFilteredText,this.model.pivotControl._curFilteredAxis=this._curFilteredAxis,this.model.pivotControl._filterElementClick(r,this),!1;if(n(r.element).attr("id")=="clearAllFilters"?this._clearAllFilter(r):n(r.element).attr("id")=="clearSorting"?this.model.pivotControl._clearSorting(r):(n(r.element).attr("id")=="ascOrder"||n(r.element).attr("id")=="descOrder")&&this._sortField(r),!n(r.element).parent().hasClass("filterElementTag")){if(u=this._selectedFieldName,this._filterAction=t.isNullOrUndefined(r.element)?r.menuId=="valueFilterBtn"?"valueFiltering":r.menuId=="labelFilterBtn"?"labelFiltering":"":n(r.element).parents("li:eq(0)#valueFilterBtn").length==0?"labelFiltering":"valueFiltering",s=this.element.find(".groupLabelDrop").data("ejDropDownList"),this._selectedLevelUniqueName=s.getSelectedValue(),this.element.find(".e-dialog, .filterDialog, #preventDiv").remove(),n.trim(r.text)==n.trim(this._getLocalizedLabels("ClearFilter")))return this._clearFilter(u,this._selectedLevelUniqueName,this.model.pivotControl.model.dataSource),this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(t.PivotAnalysis._valueFilterArray=n.grep(t.PivotAnalysis._valueFilterArray,function(n){if(n.fieldName!=i&&n.fieldName.toLowerCase()!=u.toLowerCase())return n}),this.model.pivotControl.refreshControl()):t.olap.base.getJSONData({action:"advancedfiltering"},this.model.pivotControl.model.dataSource,this.model.pivotControl),!1;c=!1;h=this._selectedLevelUniqueName;this.model.pivotControl&&(this.model.pivotControl._selectedLevelUniqueName=this._selectedLevelUniqueName);f=this._getAdvancedFiltervalue(u,this._selectedLevelUniqueName);l="";f=n(r.element).find(".activeFilter").length>0&&f.length>0?f[0].values:[""];e=t.Pivot.getReportItemByFieldName(u,this.model.pivotControl.model.dataSource).item;o=[];e&&e.advancedFilter&&(o=n.map(e.advancedFilter,function(n){if(n.name!=i&&n.name.toLowerCase()!=h)return n}));t.Pivot.createAdvanceFilterTag({action:this._filterAction=="labelFiltering"?"labelFilterDlg":"valueFilterDlg",selectedArgs:r,filterInfo:o},this)}},_getAdvancedFiltervalue:function(r,u){var f=t.Pivot.getReportItemByFieldName(r,this.model.pivotControl.model.dataSource,"XMLA").item,e=[];return f.advancedFilter&&(e=n.map(f.advancedFilter,function(n){if(n.name!=i&&n.name.toLocaleLowerCase()==u.toLowerCase())return n})),e},_filterOptionChanged:function(i){var r=this._getAdvancedFiltervalue(this._selectedFieldName,this._selectedLevelUniqueName),u;r=r.length>0?r[0].advancedFilterType=="label"&&i.value.replace(/ /g,"")==r[0].labelFilterOperator?r[0].values:r[0].advancedFilterType=="value"&&i.value.replace(/ /g,"")==r[0].valueFilterOperator?r[0].values:[""]:[""];u=this.element.find(".filterValuesTd")[0];i.value.toLowerCase().indexOf("between")>=0&&n(u).html("<input type='text' id='filterValue1' class='filterValues' value='"+r[0]+"' style='display:inline'/> <span>and<\/span> <input type='text' id='filterValue2' value='"+(t.isNullOrUndefined(r[1])?"":r[1])+"' class='filterValues' style='display:inline' /> <\/br>");i.value.toLowerCase().indexOf("between")<0&&n(u).html("<input type='text' id='filterValue1' class='filterValues' value='"+r[0]+"' style='display:inline'/>")},_filterElementOkBtnClick:function(){var o=this.element.find(".filterOptions")[0].value,u=[this.element.find("#filterValue1")[0].value],f=[],e=this._selectedFieldName,s=this._selectedLevelUniqueName.toLowerCase(),r;if(this._filterAction=="valueFiltering"){if(!(!isNaN(parseFloat(u[0]))&&isFinite(u[0]))||this._measureDDL.getSelectedValue()=="")return;this.element.find("#filterValue2")[0]!=i?","+u.push(this.element.find("#filterValue2")[0].value):u}this.element.find(".e-dialog").remove();r=t.Pivot.getReportItemByFieldName(e,this.model.pivotControl.model.dataSource).item;r&&(delete r.filterItems,r.advancedFilter&&(f=n.map(r.advancedFilter,function(n){if(n.name!=i&&n.name.toLocaleLowerCase()!=s.toLowerCase())return n})),this._filterAction.toLowerCase()=="labelfiltering"?f.push({name:this._selectedLevelUniqueName,labelFilterOperator:o.replace(/ /g,""),advancedFilterType:t.olap.AdvancedFilterType.LabelFilter,values:u}):f.push({name:this._selectedLevelUniqueName,valueFilterOperator:o.replace(/ /g,""),advancedFilterType:t.olap.AdvancedFilterType.ValueFilter,values:u,measure:this._measureDDL.getSelectedValue()}),this.model.pivotControl._currentReportItems=n.grep(this.model.pivotControl._currentReportItems,function(n){if(n.fieldName!=e)return n}),r.advancedFilter=f);this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(t.PivotAnalysis._valueFilterArray=n.grep(t.PivotAnalysis._valueFilterArray,function(n){if(n.fieldName!=i&&n.fieldName.toLowerCase()!=e.toLowerCase())return n}),this._filterAction!="valueFiltering"||t.isNullOrUndefined(r)||t.PivotAnalysis._valueFilterArray.push(r),this.model.pivotControl.refreshControl()):t.olap.base.getJSONData({action:"advancedfiltering"},this.model.pivotControl.model.dataSource,this.model.pivotControl)},_groupLabelChange:function(i){var r=this.element.find(".filterElementTag").data("ejMenu"),u,o,y,f,s,p,h;if(r.disableItemByID("labelClearFilter"),r.disableItemByID("valueClearFilter"),r.disableItemByID("clearAllFilters"),r.disableItemByID("clearSorting"),this.model.pivotControl&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode)return this.model.pivotControl._selectedLevelUniqueName=i.selectedValue,u=[],o=t.buildTag("span.filterState").addClass("e-icon").attr("aria-label","filter state")[0].outerHTML,this.model.pivotControl._excelFilterInfo.length>0&&(s=this.model.pivotControl._selectedLevelUniqueName,y=this.model.pivotControl._selectedFieldName,u=n.map(this.model.pivotControl._excelFilterInfo,function(n){if(n.hierarchyUniqueName==y&&n.levelUniqueName==s)return{action:n.action,operator:n.operator,value1:n.value1}})),this.element.find(".filterElementTag .activeFilter,.filterState").remove(),this.element.find("#labelClearFilter ,#valueClearFilter").css("opacity","0.5").attr("disable",!0),u.length>0&&!t.isNullOrUndefined(u[0].operator)?(f=u[0].action=="valuefiltering"?"valueFilterBtn":"labelFilterBtn",f=="labelFilterBtn"?r.enableItemByID("labelClearFilter"):r.enableItemByID("valueClearFilter"),r.enableItemByID("clearAllFilters"),this.element.find("#"+f+" a:eq(0)").append(o),this.element.find("#"+f+" #labelClearFilter").removeAttr("style disable"),this.element.find("#"+f+" #valueClearFilter").removeAttr("style disable"),u[0].operator.replace(/ /g,"")=="BottomCount"?this.element.find("#"+f+" li#"+u[0].operator.replace(/ /g,"").replace("Bottom","top")+" a").append(n(t.buildTag("span.activeFilter e-icon")[0].outerHTML)):this.element.find("#"+f+" li#"+u[0].operator.replace(/ /g,"")+" a").append(n(t.buildTag("span.activeFilter e-icon")[0].outerHTML))):this._getUnSelectedNodes()!=""&&this.element.find(".memberEditorDiv").before("<div class='filterState e-icon' style='top:126px;position:absolute;visibility:hidden'  />"),this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&(h=this.element.find("#clearAllFilters a").children().clone(),this.element.find("#clearAllFilters a").text(this._getLocalizedLabels("ClearFilter")+' from "'+i.text+'"').append(h),s=this.model.pivotControl._curFilteredText,p=n.grep(this.model.pivotControl._ascdes.split("##"),function(n){if(n==s)return n}),p.length>0?(this.element.find(".descImage").addClass("selectedSort"),r.enableItemByID("clearSorting")):this.element.find(".ascImage").addClass("selectedSort")),!1;var e=this,b=this.element.find(".groupLabelDrop").length>0?this.element.find(".groupLabelDrop").data("ejDropDownList"):[],c=e._getAdvancedFiltervalue(e._selectedFieldName,b.getSelectedValue()),r=this.element.find(".filterElementTag").data("ejMenu"),l=t.Pivot.getReportItemByFieldName(e._selectedFieldName,e.model.pivotControl.model.dataSource).item,o=t.buildTag("span.filterState").addClass("e-icon").attr("aria-label","filter state")[0].outerHTML,w=t.buildTag("span.activeFilter").addClass("e-icon")[0].outerHTML,a=t.Pivot.getReportItemByFieldName(e._selectedFieldName,e.model.pivotControl.model.dataSource).item,v;a&&(a.sortOrder&&a.sortOrder!=t.olap.SortOrder.None?(v=a.sortOrder==t.olap.SortOrder.Descending?"desc":"asc",t.isNullOrUndefined(v)||v=="asc"?this.element.find(".clientDialog .ascImage").addClass("selectedSort"):(this.element.find(".clientDialog .descImage").addClass("selectedSort"),r.enableItemByID("clearSorting"))):this.element.find("#clearSorting").css("opacity","0.5").attr("disabled","disabled"));this.element.find("#clearAllFilters").css("opacity","0.5").attr("disabled","disabled");this.element.find(".filterState,.activeFilter").remove();h=this.element.find("#clearAllFilters a").children().clone();this.element.find("#clearAllFilters a").text(this._getLocalizedLabels("ClearFilter")+' from "'+i.text+'"').append(h);c.length>0?(c[0].advancedFilterType==t.olap.AdvancedFilterType.LabelFilter?(this.element.find("#labelFilterBtn a:eq(0)").append(o),this.element.find("#labelFilterBtn .clearFilter").css("opacity","1").removeAttr("disabled"),this.element.find("#labelFilterBtn li#"+c[0].labelFilterOperator+" a").append(w),r.enableItemByID("labelClearFilter")):(this.element.find("#valueFilterBtn a:eq(0)").append(o),this.element.find("#valueFilterBtn .clearFilter").css("opacity","1").removeAttr("disabled"),this.element.find("#valueFilterBtn li#"+c[0].valueFilterOperator+" a").append(w),r.enableItemByID("valueClearFilter")),r.enableItemByID("clearAllFilters"),this.element.find("#clearAllFilters").css("opacity","1").removeAttr("disabled")):(l.length>0&&l[0].filterItems||this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&l&&l.filterItems)&&(this.element.find(".memberEditorDiv").before(o),this.element.find(".filterState").addClass("memberFilter").css("visibility","hidden"),this.element.find("#clearAllFilters").css("opacity","1").removeAttr("disabled"))},_clearAllFilter:function(){var r,u;t.Pivot.closePreventPanel(this);this.element.find(".e-dialog").remove();this._clearFilter(this._selectedFieldName,this._selectedLevelUniqueName,this.model.pivotControl.model.dataSource);r=t.Pivot.getReportItemByFieldName(this._selectedFieldName,this.model.pivotControl.model.dataSource);r&&r.item&&r.item.filterItems&&(r.item.filterItems.values=[]);this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot?(u=this._selectedFieldName,t.PivotAnalysis._valueFilterArray=n.grep(t.PivotAnalysis._valueFilterArray,function(n){if(n.fieldName!=i&&n.fieldName.toLowerCase()!=u.toLowerCase())return n}),this.model.pivotControl.refreshControl()):t.olap.base.getJSONData({action:"advancedfiltering"},this.model.pivotControl.model.dataSource,this.model.pivotControl)},_clearFilter:function(r,u,f){var e=t.Pivot.getReportItemByFieldName(r,f);e.item&&e.item.advancedFilter&&(u=this.model.pivotControl&&this.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Pivot&&this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ClientMode?r:u,e.item.advancedFilter=n.map(e.item.advancedFilter,function(n){if(n.name!=i&&n.name.toLowerCase()!=u.toLowerCase())return n}))},_createPivotButton:function(i,r,u,f,e){var c="",l="",o,p,w;if(u&&(c="filtered"),f&&(l="descending"),o=r=="row"?".schemaRow":r=="column"?".schemaColumn":r=="value"?".schemaValue":".schemaFilter",this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)var h=r=="column"?"Columns":r=="row"?"Rows":r=="filter"?"Slicers":"values",a=(r=="column"||r=="row")&&this.model.layout!="excel"&&this._dataModel!="Olap"&&this._dataModel!="XMLA"?t.buildTag("span.sorting e-icon "+l).attr("role","button").attr("aria-label","sort").attr("aria-expanded","false")[0].outerHTML:"",v=(r=="column"||r=="row"||r=="filter")&&this.model.layout!="excel"&&i.fieldCaption!="Measures"?t.buildTag("span.filter e-icon "+c).attr("role","button").attr("aria-label","filter")[0].outerHTML:"",y=this.model.layout!="excel"?t.buildTag("span.removeBtn e-icon").attr("role","button").attr("aria-label","remove")[0].outerHTML:"",s=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("div.pvtBtnDiv",t.buildTag("button.pvtBtn#pivotButton"+i.fieldName,this.model.pivotControl._dataModel!="XMLA"?n.grep(this.model.pivotTableFields,function(n){return n.name==i.fieldName})[0].caption:i.fieldCaption,{},{fieldName:i.fieldName,axis:h})[0].outerHTML+v+a+y).attr("tag",h+":"+i.fieldName)[0].outerHTML).attr("tag",h+":"+i.fieldName)[0].outerHTML;else var h=r=="column"?"Columns":r=="row"?"Rows":r=="filter"?"Slicers":"values",a=(r=="column"||r=="row")&&this.model.layout!="excel"&&this._dataModel!="Olap"&&this._dataModel!="XMLA"?t.buildTag("span.sorting e-icon "+l).attr("role","button").attr("aria-label","sort").attr("aria-expanded","false")[0].outerHTML:"",v=(r=="column"||r=="row"||r=="filter")&&this.model.layout!="excel"&&i.fieldCaption!="Measures"?t.buildTag("span.filter e-icon "+c).attr("role","button").attr("aria-label","filter")[0].outerHTML:"",y=this.model.layout!="excel"?t.buildTag("span.removeBtn e-icon").attr("role","button").attr("aria-label","remove")[0].outerHTML:"",s=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("div.pvtBtnDiv",t.buildTag("button.pvtBtn#pivotButton"+i,this._dataModel=="Pivot"?i:i=="Measures"?i:t.isNullOrUndefined(i.fieldCaption)?i.split(".")[1]:i.fieldCaption)[0].outerHTML+v+a+y).attr("tag",h+":"+i)[0].outerHTML).attr("tag",h+":"+(t.isNullOrUndefined(i.fieldName)?i:i.fieldName))[0].outerHTML;typeof e=="number"&&n(this.element.find(o+" .pivotButton")[e]).length>0?r=="row"?n(this.element.find(".schemaRow .pivotButton")[e]).before(s):r=="column"?n(this.element.find(".schemaColumn .pivotButton")[e]).before(s):r=="value"?n(this.element.find(".schemaValue .pivotButton")[e]).before(s):r=="filter"?n(this.element.find(".schemaFilter .pivotButton")[e]).before(s):"":r=="row"?this.element.find(".schemaRow").append(s):r=="column"?this.element.find(".schemaColumn").append(s):r=="value"?this.element.find(".schemaValue").append(s):r=="filter"?this.element.find(".schemaFilter").append(s):"";p=typeof e!="number"&&e==""?" .pivotButton .pvtBtn:last":" .pivotButton .pvtBtn:eq("+e+")";this.model.enableDragDrop&&this.element.find(o+p).ejButton({size:"normal",type:t.ButtonType.Button,enableRTL:this.model.enableRTL}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this.model.pivotControl.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._pvtBtnDropped:this._clientOnPvtBtnDropped,this),helper:t.proxy(function(t){if(n(t.element).addClass("dragHover"),t.sender.target.className.indexOf("e-btn")>-1){var i=n(t.sender.target).clone().attr("id",this._id+"_dragClone").appendTo("body");return n("#"+this._id+"_dragClone").removeAttr("style").height(n(t.sender.target).height()),i}return!1},this)});this.element.find(o+" .pivotButton .filterBtn:last").ejButton({size:"normal",enableRTL:this.model.enableRTL,type:t.ButtonType.Button,contentType:"imageonly",prefixIcon:"filter"});this.element.find(o+" .pivotButton input:last").ejToggleButton({size:"normal",enableRTL:this.model.enableRTL,contentType:"imageonly",defaultPrefixIcon:"ascending",activePrefixIcon:"descending",click:t.proxy(this._sortBtnClick,this)});f&&(this.element.find(o+" .pivotButton:contains("+i+") span:eq(0) span").removeClass("ascending").addClass("descending"),this.element.find(o+" .pivotButton:contains("+i+") span:eq(0) button").addClass("e-active"));this.model.pivotControl._dataModel=="XMLA"&&this.element.find(".pivotButton[tag*=':Measures']").length>0&&(w=n(o+" .pivotButton[tag*=':Measures']"),n(o).append(w));this.element.find(".dropIndicator").removeClass("dropIndicatorHover");this._createContextMenu()},_createContextMenu:function(){var r=this.element.find(".pivotButton"),i;this.model.pivotControl!=null&&(i=t.buildTag("ul.pivotTreeContextMenu#pivotTreeContextMenu",t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToFilter"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToRow"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToColumn"))[0].outerHTML)[0].outerHTML+t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("AddToValues"))[0].outerHTML)[0].outerHTML)[0].outerHTML,n(this.element).append(i),n("#pivotTreeContextMenu").ejMenu({menuType:t.MenuType.ContextMenu,enableRTL:this.model.enableRTL,openOnClick:!1,contextMenuTarget:r,click:t.proxy(this._contextClick,this),beforeOpen:t.proxy(this._onContextOpen,this),close:t.proxy(t.Pivot.closePreventPanel,this)}))},_createPivotButtons:function(r,u){var o,e,l,f;if(!t.isNullOrUndefined(r)){if(o="",e=u=="column"?"Columns":u=="row"?"Rows":u=="filter"?"Slicers":"",this.model.pivotControl!=null&&this.model.pivotControl.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)for(e=u=="column"?"Columns":u=="row"?"Rows":u=="filter"?"Slicers":"values",e=="values"&&this.model.pivotControl._dataModel=="XMLA"&&(r=n.map(r,function(n){return n.measures})),f=0;f<r.length;f++){var a=this.model.pivotControl._dataModel=="XMLA"||this.model.pivotControl._dataModel=="Olap"?"":t.isNullOrUndefined(r[f].filterItems)?"":"filtered",v=this.model.pivotControl._dataModel=="XMLA"||this.model.pivotControl._dataModel=="Olap"?"":r[f].sortOrder==t.PivotAnalysis.SortOrder.Descending?"descending":"",y=this.model.pivotControl._dataModel=="XMLA"?"":r[f].fieldName,s=(u=="column"||u=="row")&&this.model.layout!="excel"&&this.model.pivotControl._dataModel!="Olap"&&this.model.pivotControl._dataModel!="XMLA"?t.buildTag("span.sorting e-icon "+v).attr("role","button").attr("aria-label","sort").attr("aria-expanded","false")[0].outerHTML:"",h=(u=="column"||u=="row"||u=="filter")&&this.model.layout!="excel"&&r[f].fieldCaption!="Measures"?t.buildTag("span.filter e-icon "+a).attr("role","button").attr("aria-label","filter")[0].outerHTML:"",c=this.model.layout!="excel"?t.buildTag("span.removeBtn e-icon").attr("role","button").attr("aria-label","remove")[0].outerHTML:"";o+=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("div.pvtBtnDiv",t.buildTag("button.pvtBtn#pivotButton"+y,this.model.pivotControl._dataModel=="XMLA"?(r[f].fieldCaption!=i?r[f].fieldCaption:r[f].fieldName)||r[f]:n.grep(this.model.pivotTableFields,function(n){return n.name==r[f].fieldName})[0].caption||n.grep(this.model.pivotTableFields,function(n){return n.name==r[f]})[0].caption,{},{fieldName:r[f].fieldName||r[f],axis:e})[0].outerHTML+h+s+c).attr("tag",e+":"+r[f].fieldName||r[f])[0].outerHTML).attr("tag",e+":"+r[f].fieldName||r[f])[0].outerHTML}else for(e==""&&u=="values"&&(l=this.element.find(".pivotButton:contains("+this._getLocalizedLabels("Measures")+")").length>0?this.element.find(".pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").parent()[0].className.split(" ")[0]:"schemaColumn",e=l=="schemaColumn"?"Columns":"Rows"),f=0;f<r.length;f++){r[f].FieldHeader=r[f].FieldHeader=="Measures"?this._getLocalizedLabels("Measures"):r[f].FieldHeader;var s=(u=="column"||u=="row")&&this.model.layout!="excel"&&this._dataModel!="Olap"&&this._dataModel!="XMLA"?t.buildTag("span.sorting e-icon ").attr("role","button").attr("aria-label","sort").attr("aria-expanded","false")[0].outerHTML:"",h=(u=="column"||u=="row"||u=="filter")&&this.model.layout!="excel"&&r[f].FieldHeader!="Measures"?t.buildTag("span.filter e-icon").attr("role","button").attr("aria-label","filter")[0].outerHTML:"",c=this.model.layout!="excel"?t.buildTag("span.removeBtn e-icon").attr("role","button").attr("aria-label","remove")[0].outerHTML:"";o+=t.buildTag("div.pivotButton",t.buildTag("div.dropIndicator")[0].outerHTML+t.buildTag("div.pvtBtnDiv",t.buildTag("button.pvtBtn#pivotButton"+r[f].FieldHeader||r[f].FieldName||r[f].Name||r[f].DimensionName,r[f].FieldHeader||r[f].FieldName||r[f].Name||r[f].DimensionName)[0].outerHTML+h+s+c).attr("tag",e+":"+r[f].Tag)[0].outerHTML).attr("tag",e+":"+r[f].Tag)[0].outerHTML}return this._createContextMenu(),o}},_setSplitBtnTargetPos:function(r){var s="",e,u,f,o;if(r.event!=i&&r.event.type=="touchend"?(u=r.event.originalEvent.target!=null?n(r.event.originalEvent.target).parents(".pivotButton"):n(r.event.originalEvent.srcElement).parents(".pivotButton"),f=r.event.originalEvent.target!=null?r.event.originalEvent.target.className:r.event.originalEvent.srcElement.className):(u=t.isNullOrUndefined(r.originalEvent)?n(r.target).parents(".pivotButton"):r.originalEvent.target!=null?n(r.originalEvent.target).parents(".pivotButton"):n(r.originalEvent.srcElement).parents(".pivotButton"),f=t.isNullOrUndefined(r.originalEvent)?n(r.target).attr("class")?n(r.target).attr("class"):"":r.originalEvent.target!=null&&n(r.originalEvent.target).attr("class")?n(r.originalEvent.target).attr("class"):n(r.originalEvent.srcElement).attr("class")?n(r.originalEvent.srcElement).attr("class"):""),this._droppedClass=u.length>0?n(u[0]).parent()[0].className.split(" ")[0]:f.split(" ")[0],u[0]||f!=i&&f!=null&&jQuery.type(f)=="string"&&f.indexOf("pivotButton")>-1)for(u=u[0]?u[0]:r.originalEvent.target!=null?r.originalEvent.target:r.originalEvent.srcElement,e=r.event!=i&&r.event.type=="touchend"?r.target:this._droppedClass!=null&&this._droppedClass!=i&&this._droppedClass!=""?this.element.find("."+this._droppedClass)[0]:u.parentNode,e=n(e).children(".pivotButton"),o=0;o<e.length;o++)n(e[o]).attr("tag")==n(u).attr("tag")&&(s=o);return s},_getUnSelectedNodes:function(){for(var r,f=this.element.find(".editorTreeView")[0],u="",i=n(f).find(":input.nodecheckbox:not(:checked)"),t=0;t<i.length;t++)n(i[t].parentElement).find("span:nth-child(1)").attr("class").indexOf("e-chk-act")>-1||n(i[t].parentElement).attr("aria-checked")=="mixed"||(r=n(i[t]).parents("li:eq(0)"),u+="::"+r[0].id+"||"+n(r).attr("tag"));return u},_getSelectedNodes:function(t){var o,s,e,r,i;if(t){var h=this.element.find(".editorTreeView")[0].childNodes[0],f=[],u=n(h).children();for(r=0;r<u.length;r++){if(i=u[r],o={caption:n(i.firstChild).find("a").text(),parentId:i.parentElement.parentElement.className.indexOf("editorTreeView")>-1?"None":n(i).parents()[1].id,id:i.id,checked:n(i).find(":input.nodecheckbox")[0].checked||n(i).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:n(i.firstChild).find(".e-minus").length>0?!0:!1,childNodes:[],tag:n(i).attr("tag")},n(i).find("ul:first").children().length>0)for(s=n(i).find("ul:first").children(),e=0;e<s.length;e++)o.childNodes.push(this._getNodeInfo(s[e]));f.push(o)}return JSON.stringify(f)}var h=n(".editorTreeView"),f="",u=n(h).find(":input.nodecheckbox");for(r=0;r<u.length;r++)(u[r].checked||n(u[r].parentElement).attr("aria-checked")=="mixed")&&(i=n(u[r]).parents("li:eq(0)"),f+="::"+i[0].id+"||"+n(i).attr("tag"));return f},_getNodeInfo:function(t){var u={caption:n(t.firstChild).find("a").text(),parentId:t.parentElement.parentElement.className.indexOf("editorTreeView")>-1?"None":n(t).parents()[1].id,id:t.id,checked:n(t).find(":input.nodecheckbox")[0].checked||n(t).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:n(t.firstChild).find(".e-minus").length>0?!0:!1,childNodes:[],tag:n(t).attr("tag")},r,i;if(n(t).find("ul:first").children().length>0)for(r=n(t).find("ul:first").children(),i=0;i<r.length;i++)u.childNodes.push(this._getNodeInfo(r[i]));return u},doAjaxPost:function(r,u,f,e,o,s){this.model.pivotControl.model.editCellsInfo={};var h,c,l,a=!0;f.XMLA==i?(h="application/json; charset=utf-8",c="json",l=n.proxy(e,this)):(h="text/xml",c="xml",f=f.XMLA,l=n.proxy(e,this,s),a=!t.isNullOrUndefined(s)&&s.action!="loadFieldElements"?!0:!1);n.ajax({type:r,url:u,contentType:h,dataType:c,async:a,data:f,success:l,complete:n.proxy(o,this),error:function(){this.model.pivotControl._ogridWaitingPopup.hide()}})}});t.PivotSchemaDesigner.Locale={};t.PivotSchemaDesigner.Locale["en-US"]={Sort:"Sort",Search:"Search",SelectField:"select Field",LabelFilterLabel:"Show the items for which the label",ValueFilterLabel:"Show the items for which",LabelFilters:"Label Filters  ",BeginsWith:"Begins With",DoesNotBeginsWith:"Not Begins With",EndsWith:"Ends With",DoesNotEndsWith:"Not Ends With",Contains:"Contains",DoesNotContains:"Not Contains",ValueFilters:"Value Filters",ClearFilter:"Clear Filter",Equals:"Equals",DoesNotEquals:"Not Equals",GreaterThan:"Greater Than",GreaterThanOrEqualTo:"Greater Than Or Equal To",LessThan:"Less Than",LessThanOrEqualTo:"Less Than Or Equal To",Between:"Between",NotBetween:"Not Between",Top10:"Top Count",GreaterThan:"Greater Than",IsGreaterThan:"Is Greater Than",IsGreaterThanOrEqualTo:"Is Greater Than Or Equal To",IsLessThan:"Is Less Than",IsLessThanOrEqualTo:"Is Less Than Or Equal To",ClearFilter:"Clear Filter",SelectField:"Select field",Measures:"Measures",Warning:"Warning",AlertMsg:"The field you are moving cannot be placed in that area of the report",Goal:"Goal",Status:"Status",Trend:"Trend",Value:"value",AddToFilter:"Add to Filter",AddToRow:"Add to Row",AddToColumn:"Add to Column",AddToValues:"Add to Value",PivotTableFieldList:"PivotTable Field List",ChooseFieldsToAddToReport:"Choose fields to add to report:",DragFieldBetweenAreasBelow:"Drag fields between areas below:",ReportFilter:"Filters",ColumnLabel:"Columns",RowLabel:"Rows",Values:"Values",DeferLayoutUpdate:"Defer Layout Update",Update:"Update",OK:"OK",Cancel:"Cancel",Close:"Close"};t.PivotSchemaDesigner.Layouts={Excel:"excel",Normal:"normal",OneByOne:"onebyone"}})(jQuery,Syncfusion)});
