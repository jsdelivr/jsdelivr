!function(i){"use strict";var t=-1,n={onVisible:function(i){var t=n.isSupported();if(!t||!n.hidden())return i(),t;var e=n.change(function(){n.hidden()||(n.unbind(e),i())});return e},change:function(i){if(!n.isSupported())return!1;t+=1;var e=t;return n._callbacks[e]=i,n._listen(),e},unbind:function(i){delete n._callbacks[i]},afterPrerendering:function(i){var t=n.isSupported(),e="prerender";if(!t||e!=n.state())return i(),t;var r=n.change(function(t,c){e!=c&&(n.unbind(r),i())});return r},hidden:function(){return!(!n._doc.hidden&&!n._doc.webkitHidden)},state:function(){return n._doc.visibilityState||n._doc.webkitVisibilityState||"visible"},isSupported:function(){return!(!n._doc.visibilityState&&!n._doc.webkitVisibilityState)},_doc:document||{},_callbacks:{},_change:function(i){var t=n.state();for(var e in n._callbacks)n._callbacks[e].call(n._doc,i,t)},_listen:function(){if(!n._init){var i="visibilitychange";n._doc.webkitVisibilityState&&(i="webkit"+i);var t=function(){n._change.apply(n,arguments)};n._doc.addEventListener?n._doc.addEventListener(i,t):n._doc.attachEvent(i,t),n._init=!0}}};"undefined"!=typeof module&&module.exports?module.exports=n:i.Visibility=n}(this);
