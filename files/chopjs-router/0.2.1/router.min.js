$ch.define("router",function(){"use strict";var a=function(a){return"[object Array]"===Object.prototype.toString.call(a)},b=!1,c=!1,d=$$CHOP._afterLoadView;$$CHOP._afterLoadView=function(){d(),e()};var e=function(){c&&(c=!1,$$CHOP.router.navigate())};window.onhashchange=function(){$$CHOP.router.navigate()},$$CHOP.router={},$$CHOP.router={routes:{},mode:"hash",root:"/",getFragment:function(){var a=window.location.href.match(/#(.*)$/),b=a?a[1]:"";return this.clearSlashes(b)},clearSlashes:function(a){return a.toString().replace(/\/$/,"").replace(/^\//,"")},add:function(a){if(void 0===a)throw new Error("$ch.router.add requires a parameter.");var d,f;for(var g in a)a.hasOwnProperty(g)&&(d=g,f=a[g],this.routes[d]=f);return""!==this.getFragment()&&b===!1&&(c=!0),e(),!0},remove:function(b){return b&&(a(b)||(b=[b]),b.forEach(function(a){delete this.routes[a]})),this},flush:function(){return this.routes={},this.mode="hash",this.root="/",this},navigate:function(a){if(void 0!==a){var b=a.match(/^\/.*/);b||(a="/"+a),window.location.href.match(/#(.*)$/),window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+a}for(var c=this.getFragment(a),d={},e=Object.keys(this.routes),f=0,g=e.length;f!==g;++f){var h=e[f];h=h.replace(/:\w+/g,".+");var i=new RegExp("^"+h+"$"),j=c.match(i);if(null!==j){var k=e[f],l=[],m=k.match(/:\w+/g);if(null!==m){var n,o,p=k.split("/");for(n=0,o=m.length;n!==o;++n){var q=m[n],r=p.indexOf(q),s=q.replace(/:/,"");-1!==r&&void 0===d[s]&&(l.push(r),d[s]="")}p=c.split("/");var t=Object.keys(d);for(n=0,o=l.length;n!==o;++n){var u=l[n];d[t[n]]=p[u]}}}}e=Object.keys(this.routes);for(var v=0;v!==e.length;++v){var w=e[v],x=e[v];if(void 0!==w){w=w.replace(/\//g,"\\/"),w=w.replace(/:\w+/g,".+");var y=new RegExp(w);null!==c.match(y)&&this.routes[x](d)}}return this}}});