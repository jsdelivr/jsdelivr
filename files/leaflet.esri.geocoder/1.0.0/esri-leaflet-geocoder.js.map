{"version":3,"file":"esri-leaflet-geocoder.js","sources":["../src/EsriLeafletGeocoding.js","../src/Tasks/Geocode.js","../src/Tasks/ReverseGeocode.js","../src/Tasks/Suggest.js","../src/Services/Geocoding.js","../src/Controls/Geosearch.js","../src/Providers/ArcgisOnlineGeocoder.js","../src/Providers/FeatureLayer.js","../src/Providers/GeocodeService.js","../src/Providers/MapService.js"],"names":["protocol","window","location","EsriLeafletGeocoding","WorldGeocodingService","Tasks","Services","Controls","L","esri","Geocoding","Esri","Geocode","Task","extend","path","params","outSr","forStorage","outFields","maxLocations","setters","address","neighborhood","city","subregion","region","postal","country","text","category","token","key","fields","initialize","options","url","prototype","call","this","within","bounds","latLngBounds","bbox","Util","boundsToExtent","nearby","latlng","radius","latLng","lng","lat","distance","Math","min","max","run","callback","context","searchExtent","request","error","response","processor","_processFindResponse","_processFindAddressCandidatesResponse","results","undefined","i","locations","length","extentToBounds","extent","push","name","score","feature","attributes","Score","LatLng","geometry","y","x","properties","candidates","candidate","geocode","ReverseGeocode","outSR","language","result","reverseGeocode","Suggest","pad","center","getCenter","ne","getNorthWest","distanceTo","suggest","Service","includes","Mixin","Events","reverse","console","warn","geocoding","Geosearch","Control","position","zoomToResult","useMapBounds","collapseAfterResult","expanded","allowMultipleResults","useArcgisWorldGeocoder","providers","placeholder","title","setOptions","geocoder","Providers","ArcGISOnline","maxResults","_pendingSuggestions","_geocode","provider","activeRequests","allResults","bind","concat","_boundsFromResults","fire","_map","fitBounds","DomUtil","removeClass","_input","clear","blur","_searchBounds","_suggest","addClass","createCallback","suggestions","value","_suggestions","innerHTML","style","display","_lastRender","nodes","parentElement","removeChild","k","_renderSuggestions","getBounds","getZoom","currentGroup","maxHeight","getSize","offsetTop","_wrapper","list","header","suggestion","label","create","textContent","innerText","suggestionItem","magicKey","nullIsland","LatLngBounds","isValid","equals","scrollWheelZoom","enabled","enable","onAdd","map","attributionControl","addAttribution","DomEvent","addListener","e","focus","target","srcElement","selectedPosition","querySelectorAll","selected","keyCode","preventDefault","previousItem","nextItem","abort","id","_EsriLeafletCallbacks","limitExecByInterval","which","_lastValue","disableClickPropagation","disable","onRemove","removeAttribution","geosearch","shift","isCollection","FeatureLayer","bufferRadius","formatSuggestion","searchFields","query","where","_buildQuery","returnGeometry","intersects","idField","raw","objectIdFieldName","count","features","slice","featureIds","_featureBounds","queryString","field","join","geojson","geoJson","type","Circle","GeocodeService","MapService","layers","displayFieldName","layerName","_getIdFields","find","layer","layerId","_idFields","_layerNames","_displayFields","featureId","split","contains","_layerMetadataCallback","layerid","metadata","displayField","get"],"mappings":"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","sourcesContent":["var protocol = window.location.protocol === 'https:' ? 'https:' : 'http:';\n\nvar EsriLeafletGeocoding = {\n  WorldGeocodingService: protocol + '//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/',\n  Tasks: {},\n  Services: {},\n  Controls: {}\n};\n\n// attach to the L.esri global if we can\nif(typeof window !== 'undefined' && window.L && window.L.esri) {\n  window.L.esri.Geocoding = EsriLeafletGeocoding;\n}\n\n// We do not have an 'Esri' variable e.g loading this file directly from source define 'Esri'\nif(!Esri){\n  var Esri = window.L.esri;\n}","EsriLeafletGeocoding.Tasks.Geocode = Esri.Tasks.Task.extend({\n  path: 'find',\n\n  params : {\n    outSr: 4326,\n    forStorage: false,\n    outFields: '*',\n    maxLocations: 20\n  },\n\n  setters: {\n    'address': 'address',\n    'neighborhood': 'neighborhood',\n    'city': 'city',\n    'subregion': 'subregion',\n    'region': 'region',\n    'postal': 'postal',\n    'country': 'country',\n    'text': 'text',\n    'category': 'category[]',\n    'token' : 'token',\n    'key': 'magicKey',\n    'fields': 'outFields[]',\n    'forStorage': 'forStorage',\n    'maxLocations': 'maxLocations'\n  },\n\n  initialize: function(options){\n    options = options || {};\n    options.url = options.url || EsriLeafletGeocoding.WorldGeocodingService;\n    Esri.Tasks.Task.prototype.initialize.call(this, options);\n  },\n\n  within: function(bounds){\n    bounds = L.latLngBounds(bounds);\n    this.params.bbox = Esri.Util.boundsToExtent(bounds);\n    return this;\n  },\n\n  nearby: function(latlng, radius){\n    latlng = L.latLng(latlng);\n    this.params.location = latlng.lng + ',' + latlng.lat;\n    this.params.distance = Math.min(Math.max(radius, 2000), 50000);\n    return this;\n  },\n\n  run: function(callback, context){\n    this.path = (this.params.text) ? 'find' : 'findAddressCandidates';\n\n    if(this.path === 'findAddressCandidates' && this.params.bbox) {\n      this.params.searchExtent = this.params.bbox;\n      delete this.params.bbox;\n    }\n\n    return this.request(function(error, response){\n      var processor = (this.path === 'find') ? this._processFindResponse : this._processFindAddressCandidatesResponse;\n      var results = (!error) ? processor(response) : undefined;\n      callback.call(context, error, { results: results }, response);\n    }, this);\n  },\n\n  _processFindResponse: function(response){\n    var results = [];\n\n    for (var i = 0; i < response.locations.length; i++) {\n      var location = response.locations[i];\n      var bounds = Esri.Util.extentToBounds(location.extent);\n\n      results.push({\n        text: location.name,\n        bounds: bounds,\n        score: location.feature.attributes.Score,\n        latlng: new L.LatLng(location.feature.geometry.y, location.feature.geometry.x),\n        properties: location.feature.attributes\n      });\n    }\n\n    return results;\n  },\n\n  _processFindAddressCandidatesResponse: function(response){\n    var results = [];\n\n    for (var i = 0; i < response.candidates.length; i++) {\n      var candidate = response.candidates[i];\n      var bounds = Esri.Util.extentToBounds(candidate.extent);\n\n      results.push({\n        text: candidate.address,\n        bounds: bounds,\n        score: candidate.score,\n        latlng: new L.LatLng(candidate.location.y, candidate.location.x),\n        properties: candidate.attributes\n      });\n    }\n\n    return results;\n  }\n\n});\n\nEsriLeafletGeocoding.Tasks.geocode = function(options){\n  return new EsriLeafletGeocoding.Tasks.Geocode(options);\n};","EsriLeafletGeocoding.Tasks.ReverseGeocode = Esri.Tasks.Task.extend({\n  path: 'reverseGeocode',\n\n  params : {\n    outSR: 4326\n  },\n\n  setters: {\n    'distance': 'distance',\n    'language': 'language'\n  },\n\n  initialize: function(options){\n    options = options || {};\n    options.url = options.url || EsriLeafletGeocoding.WorldGeocodingService;\n    Esri.Tasks.Task.prototype.initialize.call(this, options);\n  },\n\n  latlng: function (latlng) {\n    latlng = L.latLng(latlng);\n    this.params.location = latlng.lng + ',' + latlng.lat;\n    return this;\n  },\n\n  run: function(callback, context){\n    return this.request(function(error, response){\n      var result;\n\n      if(!error){\n        result = {\n          latlng: new L.LatLng(response.location.y, response.location.x),\n          address: response.address\n        };\n      } else {\n        result = undefined;\n      }\n\n      callback.call(context, error, result, response);\n    }, this);\n  }\n});\n\nEsriLeafletGeocoding.Tasks.reverseGeocode = function(options){\n  return new EsriLeafletGeocoding.Tasks.ReverseGeocode(options);\n};","EsriLeafletGeocoding.Tasks.Suggest = Esri.Tasks.Task.extend({\n  path: 'suggest',\n\n  params : {},\n\n  setters: {\n    text: 'text',\n    category: 'category'\n  },\n\n  initialize: function(options){\n    options = options || {};\n\n    options.url = options.url || EsriLeafletGeocoding.WorldGeocodingService;\n    Esri.Tasks.Task.prototype.initialize.call(this, options);\n  },\n\n  within: function(bounds){\n    bounds = L.latLngBounds(bounds);\n    bounds = bounds.pad(0.5);\n    var center = bounds.getCenter();\n    var ne = bounds.getNorthWest();\n    this.params.location = center.lng + ',' + center.lat;\n    this.params.distance = Math.min(Math.max(center.distanceTo(ne), 2000), 50000);\n    this.params.searchExtent = L.esri.Util.boundsToExtent(bounds);\n    return this;\n  },\n\n  nearby: function(latlng, radius){\n    latlng = L.latLng(latlng);\n    this.params.location = latlng.lng + ',' + latlng.lat;\n    this.params.distance = Math.min(Math.max(radius, 2000), 50000);\n    return this;\n  },\n\n  run: function(callback, context){\n    return this.request(function(error, response){\n      callback.call(context, error, response, response);\n    }, this);\n  }\n\n});\n\nEsriLeafletGeocoding.Tasks.suggest = function(options){\n  return new EsriLeafletGeocoding.Tasks.Suggest(options);\n};","EsriLeafletGeocoding.Services.Geocoding = Esri.Services.Service.extend({\n\n  includes: L.Mixin.Events,\n\n  initialize: function(options){\n    options = options || {};\n    options.url = options.url || EsriLeafletGeocoding.WorldGeocodingService;\n    Esri.Services.Service.prototype.initialize.call(this, options);\n  },\n\n  geocode: function(){\n    return new EsriLeafletGeocoding.Tasks.Geocode(this);\n  },\n\n  reverse: function(){\n    return new EsriLeafletGeocoding.Tasks.ReverseGeocode(this);\n  },\n\n  suggest: function(){\n    if(this.options.url !== EsriLeafletGeocoding.WorldGeocodingService && console && console.warn){\n      console.warn('Only the ArcGIS Online World Geocoder supports suggestions');\n      return;\n    }\n    return new EsriLeafletGeocoding.Tasks.Suggest(this);\n  }\n});\n\nEsriLeafletGeocoding.Services.geocoding = function(options){\n  return new EsriLeafletGeocoding.Services.Geocoding(options);\n};","EsriLeafletGeocoding.Controls.Geosearch = L.Control.extend({\n  includes: L.Mixin.Events,\n  options: {\n    position: 'topleft',\n    zoomToResult: true,\n    useMapBounds: 12,\n    collapseAfterResult: true,\n    expanded: false,\n    forStorage: false,\n    allowMultipleResults: true,\n    useArcgisWorldGeocoder: true,\n    providers: [],\n    placeholder: 'Search for places or addresses',\n    title: 'Location Search'\n  },\n\n  initialize: function (options) {\n    L.Util.setOptions(this, options);\n\n    if(this.options.useArcgisWorldGeocoder){\n      var geocoder = new EsriLeafletGeocoding.Controls.Geosearch.Providers.ArcGISOnline();\n      this.options.providers.push(geocoder);\n    }\n\n    if(this.options.maxResults){\n      for (var i = 0; i < this.options.providers.length; i++) {\n        this.options.providers[i].options.maxResults = this.options.maxResults;\n      }\n    }\n\n    this._pendingSuggestions = [];\n  },\n\n  _geocode: function(text, key, provider){\n    var activeRequests = 0;\n    var allResults = [];\n    var bounds;\n\n    var callback = L.Util.bind(function(error, results){\n      activeRequests--;\n\n      if(results){\n        allResults = allResults.concat(results);\n      }\n\n      if(activeRequests <= 0){\n        bounds = this._boundsFromResults(allResults);\n\n        this.fire('results', {\n          results: allResults,\n          bounds: bounds,\n          latlng: (bounds) ? bounds.getCenter() : undefined,\n          text: text\n        });\n\n        if(this.options.zoomToResult && bounds){\n          this._map.fitBounds(bounds);\n        }\n\n        L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\n\n        this.fire('load');\n\n        this.clear();\n\n        this._input.blur();\n      }\n    }, this);\n\n    if(key){\n      activeRequests++;\n      provider.results( text, key, this._searchBounds(), callback);\n    } else {\n      for (var i = 0; i < this.options.providers.length; i++) {\n        activeRequests++;\n        this.options.providers[i].results(text, key, this._searchBounds(), callback);\n      }\n    }\n  },\n\n  _suggest: function(text){\n    L.DomUtil.addClass(this._input, 'geocoder-control-loading');\n    var activeRequests = this.options.providers.length;\n\n    var createCallback = L.Util.bind(function(text, provider){\n      return L.Util.bind(function(error, suggestions){\n        var i;\n\n        activeRequests = activeRequests - 1;\n\n        if(this._input.value < 2) {\n          this._suggestions.innerHTML = '';\n          this._suggestions.style.display = 'none';\n          return;\n        }\n\n        if(suggestions){\n          for (i = 0; i < suggestions.length; i++) {\n            suggestions[i].provider = provider;\n          }\n        }\n\n        if(provider._lastRender !== text && provider.nodes) {\n          for (i = 0; i < provider.nodes.length; i++) {\n            if(provider.nodes[i].parentElement){\n              this._suggestions.removeChild(provider.nodes[i]);\n            }\n          }\n\n          provider.nodes = [];\n        }\n\n        if(suggestions.length && this._input.value === text) {\n          if(provider.nodes){\n            for (var k = 0; k < provider.nodes.length; k++) {\n              if(provider.nodes[k].parentElement){\n                this._suggestions.removeChild(provider.nodes[k]);\n              }\n            }\n          }\n\n          provider._lastRender = text;\n          provider.nodes = this._renderSuggestions(suggestions);\n        }\n\n        if(activeRequests === 0) {\n          L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\n        }\n      }, this);\n    }, this);\n\n    this._pendingSuggestions = [];\n\n    for (var i = 0; i < this.options.providers.length; i++) {\n      var provider = this.options.providers[i];\n      var request = provider.suggestions(text, this._searchBounds(), createCallback(text, provider));\n      this._pendingSuggestions.push(request);\n    }\n  },\n\n  _searchBounds: function(){\n    if(this.options.useMapBounds === false) {\n      return null;\n    }\n\n    if(this.options.useMapBounds === true) {\n      return this._map.getBounds();\n    }\n\n    if(this.options.useMapBounds <= this._map.getZoom()) {\n      return this._map.getBounds();\n    }\n\n    return null;\n  },\n\n  _renderSuggestions: function(suggestions){\n    var currentGroup;\n    this._suggestions.style.display = 'block';\n\n    // set the maxHeight of the suggestions box to\n    // map height\n    // - suggestions offset (distance from top of suggestions to top of control)\n    // - control offset (distance from top of control to top of map)\n    // - 10 (extra padding)\n    this._suggestions.style.maxHeight = (this._map.getSize().y - this._suggestions.offsetTop - this._wrapper.offsetTop - 10) + 'px';\n\n    var nodes = [];\n    var list;\n    var header;\n    for (var i = 0; i < suggestions.length; i++) {\n      var suggestion = suggestions[i];\n      if(!header && this.options.providers.length > 1 && currentGroup !== suggestion.provider.options.label){\n        header = L.DomUtil.create('span', 'geocoder-control-header', this._suggestions);\n        header.textContent = suggestion.provider.options.label;\n        header.innerText = suggestion.provider.options.label;\n        currentGroup = suggestion.provider.options.label;\n        nodes.push(header);\n      }\n\n      if(!list){\n        list = L.DomUtil.create('ul', 'geocoder-control-list', this._suggestions);\n      }\n\n      var suggestionItem = L.DomUtil.create('li', 'geocoder-control-suggestion', list);\n\n      suggestionItem.innerHTML = suggestion.text;\n      suggestionItem.provider = suggestion.provider;\n      suggestionItem['data-magic-key'] = suggestion.magicKey;\n    }\n\n    nodes.push(list);\n    return nodes;\n  },\n\n  _boundsFromResults: function(results){\n    if(!results.length){\n      return;\n    }\n\n    var nullIsland = new L.LatLngBounds([0,0], [0,0]);\n    var bounds = new L.LatLngBounds();\n\n    for (var i = results.length - 1; i >= 0; i--) {\n      var result = results[i];\n\n      // make sure bounds are valid and not 0,0. sometimes bounds are incorrect or not present\n      if(result.bounds.isValid() && !result.bounds.equals(nullIsland)){\n        bounds.extend(result.bounds);\n      }\n\n      // ensure that the bounds include the results center point\n      bounds.extend(result.latlng);\n    }\n\n    return bounds;\n  },\n\n  clear: function(){\n    this._suggestions.innerHTML = '';\n    this._suggestions.style.display = 'none';\n    this._input.value = '';\n\n    if(this.options.collapseAfterResult){\n      this._input.placeholder = '';\n      L.DomUtil.removeClass(this._wrapper, 'geocoder-control-expanded');\n    }\n\n    if(!this._map.scrollWheelZoom.enabled() && this._map.options.scrollWheelZoom){\n      this._map.scrollWheelZoom.enable();\n    }\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n\n    if (map.attributionControl) {\n      map.attributionControl.addAttribution('Geocoding by Esri');\n    }\n\n    this._wrapper = L.DomUtil.create('div', 'geocoder-control ' + ((this.options.expanded) ? ' ' + 'geocoder-control-expanded'  : ''));\n    this._input = L.DomUtil.create('input', 'geocoder-control-input leaflet-bar', this._wrapper);\n    this._input.title = this.options.title;\n\n    this._suggestions = L.DomUtil.create('div', 'geocoder-control-suggestions leaflet-bar', this._wrapper);\n\n    L.DomEvent.addListener(this._input, 'focus', function(e){\n      this._input.placeholder = this.options.placeholder;\n      L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n    }, this);\n\n    L.DomEvent.addListener(this._wrapper, 'click', function(e){\n      L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n      this._input.focus();\n    }, this);\n\n    L.DomEvent.addListener(this._suggestions, 'mousedown', function(e){\n      var suggestionItem = e.target || e.srcElement;\n      this._geocode(suggestionItem.innerHTML, suggestionItem['data-magic-key'], suggestionItem.provider);\n      this.clear();\n    }, this);\n\n    L.DomEvent.addListener(this._input, 'blur', function(e){\n      this.clear();\n    }, this);\n\n    L.DomEvent.addListener(this._input, 'keydown', function(e){\n      L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n\n      var list = this._suggestions.querySelectorAll('.' + 'geocoder-control-suggestion');\n      var selected = this._suggestions.querySelectorAll('.' + 'geocoder-control-selected')[0];\n      var selectedPosition;\n\n      for (var i = 0; i < list.length; i++) {\n        if(list[i] === selected){\n          selectedPosition = i;\n          break;\n        }\n      }\n\n      switch(e.keyCode){\n      case 13:\n        if(selected){\n          this._geocode(selected.innerHTML, selected['data-magic-key'], selected.provider);\n          this.clear();\n        } else if(this.options.allowMultipleResults){\n          this._geocode(this._input.value, undefined);\n          this.clear();\n        } else {\n          L.DomUtil.addClass(list[0], 'geocoder-control-selected');\n        }\n        L.DomEvent.preventDefault(e);\n        break;\n      case 38:\n        if(selected){\n          L.DomUtil.removeClass(selected, 'geocoder-control-selected');\n        }\n\n        var previousItem = list[selectedPosition-1];\n\n        if(selected && previousItem) {\n          L.DomUtil.addClass(previousItem, 'geocoder-control-selected');\n        } else {\n          L.DomUtil.addClass(list[list.length-1], 'geocoder-control-selected');\n        }\n        L.DomEvent.preventDefault(e);\n        break;\n      case 40:\n        if(selected){\n          L.DomUtil.removeClass(selected, 'geocoder-control-selected');\n        }\n\n        var nextItem = list[selectedPosition+1];\n\n        if(selected && nextItem) {\n          L.DomUtil.addClass(nextItem, 'geocoder-control-selected');\n        } else {\n          L.DomUtil.addClass(list[0], 'geocoder-control-selected');\n        }\n        L.DomEvent.preventDefault(e);\n        break;\n      default:\n        // when the input changes we should cancel all pending suggestion requests if possible to avoid result collisions\n        for (var x = 0; x < this._pendingSuggestions.length; x++) {\n          var request = this._pendingSuggestions[x];\n          if(request && request.abort && !request.id){\n            request.abort();\n          //work around an Esri Leaflet bug. Remove for 1.0.0/RC.2\n          } else if(request.id && window._EsriLeafletCallbacks[request.id].abort) {\n            window._EsriLeafletCallbacks[request.id].abort();\n          }\n        }\n        break;\n      }\n    }, this);\n\n    L.DomEvent.addListener(this._input, 'keyup', L.Util.limitExecByInterval(function(e){\n      var key = e.which || e.keyCode;\n      var text = (e.target || e.srcElement).value;\n\n      // require at least 2 characters for suggestions\n      if(text.length < 2) {\n        this._suggestions.innerHTML = '';\n        this._suggestions.style.display = 'none';\n        L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\n        return;\n      }\n\n      // if this is the escape key it will clear the input so clear suggestions\n      if(key === 27){\n        this._suggestions.innerHTML = '';\n        this._suggestions.style.display = 'none';\n        return;\n      }\n\n      // if this is NOT the up/down arrows or enter make a suggestion\n      if(key !== 13 && key !== 38 && key !== 40){\n        if(this._input.value !== this._lastValue){\n          this._lastValue = this._input.value;\n          this._suggest(text);\n        }\n      }\n    }, 50, this), this);\n\n    L.DomEvent.disableClickPropagation(this._wrapper);\n\n    // when mouse moves over suggestions disable scroll wheel zoom if its enabled\n    L.DomEvent.addListener(this._suggestions, 'mouseover', function(e){\n      if(map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom){\n        map.scrollWheelZoom.disable();\n      }\n    });\n\n    // when mouse moves leaves suggestions enable scroll wheel zoom if its disabled\n    L.DomEvent.addListener(this._suggestions, 'mouseout', function(e){\n      if(!map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom){\n        map.scrollWheelZoom.enable();\n      }\n    });\n\n    return this._wrapper;\n  },\n\n  onRemove: function (map) {\n    map.attributionControl.removeAttribution('Geocoding by Esri');\n  }\n});\n\nEsriLeafletGeocoding.Controls.geosearch = function(options){\n  return new EsriLeafletGeocoding.Controls.Geosearch(options);\n};\n\nEsriLeafletGeocoding.Controls.Geosearch.Providers = {};","EsriLeafletGeocoding.Controls.Geosearch.Providers.ArcGISOnline = EsriLeafletGeocoding.Services.Geocoding.extend({\n  options: {\n    label: 'Places and Addresses',\n    maxResults: 5\n  },\n\n  suggestions: function(text, bounds, callback){\n    var request = this.suggest().text(text);\n\n    if(bounds){\n      request.within(bounds);\n    }\n\n    return request.run(function(error, results, response){\n      var suggestions = [];\n      if(!error){\n        while(response.suggestions.length && suggestions.length <= (this.options.maxResults - 1)){\n          var suggestion = response.suggestions.shift();\n          if(!suggestion.isCollection){\n            suggestions.push({\n              text: suggestion.text,\n              magicKey: suggestion.magicKey\n            });\n          }\n        }\n      }\n      callback(error, suggestions);\n    }, this);\n  },\n\n  results: function(text, key, bounds, callback){\n    var request = this.geocode().text(text);\n\n    if(key){\n      request.key(key);\n    } else {\n      request.maxLocations(this.options.maxResults);\n    }\n\n    if(bounds){\n      request.within(bounds);\n    }\n\n    if(this.options.forStorage){\n      request.forStorage(true);\n    }\n\n    return request.run(function(error, response){\n      callback(error, response.results);\n    }, this);\n  }\n});","EsriLeafletGeocoding.Controls.Geosearch.Providers.FeatureLayer = L.esri.Services.FeatureLayer.extend({\n  options: {\n    label: 'Feature Layer',\n    maxResults: 5,\n    bufferRadius: 1000,\n    formatSuggestion: function(feature){\n      return feature.properties[this.options.searchFields[0]];\n    }\n  },\n  initialize: function(url, options){\n    L.esri.Services.FeatureLayer.prototype.initialize.call(this, url, options);\n    L.Util.setOptions(this, options);\n    if(typeof this.options.searchFields === 'string'){\n      this.options.searchFields = [this.options.searchFields];\n    }\n  },\n  suggestions: function(text, bounds, callback){\n    var query = this.query().where(this._buildQuery(text))\n                            .returnGeometry(false);\n\n    if(bounds){\n      query.intersects(bounds);\n    }\n\n    if(this.options.idField){\n      query.fields([this.options.idField].concat(this.options.searchFields));\n    }\n\n    var request = query.run(function(error, results, raw){\n      if(error){\n        callback(error, []);\n      } else {\n        this.options.idField = raw.objectIdFieldName;\n        var suggestions = [];\n        var count = Math.min(results.features.length, this.options.maxResults);\n        for (var i = 0; i < count; i++) {\n          var feature = results.features[i];\n          suggestions.push({\n            text: this.options.formatSuggestion.call(this, feature),\n            magicKey: feature.id\n          });\n        }\n        callback(error, suggestions.slice(0, this.options.maxResults).reverse());\n      }\n    }, this);\n\n    return request;\n  },\n  results: function(text, key, bounds, callback){\n    var query = this.query();\n\n    if(key){\n      query.featureIds([key]);\n    } else {\n      query.where(this._buildQuery(text));\n    }\n\n    if(bounds){\n      query.within(bounds);\n    }\n\n    return query.run(L.Util.bind(function(error, features){\n      var results = [];\n      for (var i = 0; i < features.features.length; i++) {\n        var feature = features.features[i];\n        if(feature){\n          var bounds = this._featureBounds(feature);\n\n          var result = {\n            latlng: bounds.getCenter(),\n            bounds: bounds,\n            text: this.options.formatSuggestion.call(this, feature),\n            properties: feature.properties\n          };\n\n          results.push(result);\n        }\n      }\n      callback(error, results);\n    }, this));\n  },\n  _buildQuery: function(text){\n    var queryString = [];\n\n    for (var i = this.options.searchFields.length - 1; i >= 0; i--) {\n      var field = this.options.searchFields[i];\n      queryString.push(field + ' LIKE \\'%' + text + '%\\'');\n    }\n\n    return queryString.join(' OR ');\n  },\n  _featureBounds: function(feature){\n    var geojson = L.geoJson(feature);\n    if(feature.geometry.type === 'Point'){\n      var center = geojson.getBounds().getCenter();\n      return new L. Circle(center, this.options.bufferRadius).getBounds();\n    } else {\n      return geojson.getBounds();\n    }\n  }\n});\n","EsriLeafletGeocoding.Controls.Geosearch.Providers.GeocodeService = EsriLeafletGeocoding.Services.Geocoding.extend({\n  options: {\n    label: 'Geocode Server',\n    maxResults: 5\n  },\n\n  suggestions: function(text, bounds, callback){\n    callback(undefined, []);\n    return false;\n  },\n\n  results: function(text, key, bounds, callback){\n    var request = this.geocode().text(text);\n\n    request.maxLocations(this.options.maxResults);\n\n    if(bounds){\n      request.within(bounds);\n    }\n\n    return request.run(function(error, response){\n      callback(error, response.results);\n    }, this);\n  }\n});","EsriLeafletGeocoding.Controls.Geosearch.Providers.MapService = L.esri.Services.MapService.extend({\n  options: {\n    layers: [0],\n    label: 'Map Service',\n    bufferRadius: 1000,\n    maxResults: 5,\n    formatSuggestion: function(feature){\n      return feature.properties[feature.displayFieldName] + ' <small>' + feature.layerName + '</small>';\n    }\n  },\n  initialize: function(url, options){\n    L.esri.Services.MapService.prototype.initialize.call(this, url, options);\n    this._getIdFields();\n  },\n  suggestions: function(text, bounds, callback){\n    var request = this.find().text(text).fields(this.options.searchFields).returnGeometry(false).layers(this.options.layers);\n\n    return request.run(function(error, results, raw){\n      var suggestions = [];\n      if(!error){\n        var count = Math.min(this.options.maxResults, results.features.length);\n        raw.results = raw.results.reverse();\n        for (var i = 0; i < count; i++) {\n          var feature = results.features[i];\n          var result = raw.results[i];\n          var layer = result.layerId;\n          var idField = this._idFields[layer];\n          feature.layerId = layer;\n          feature.layerName = this._layerNames[layer];\n          feature.displayFieldName = this._displayFields[layer];\n          if(idField){\n            suggestions.push({\n              text: this.options.formatSuggestion.call(this, feature),\n              magicKey: result.attributes[idField] + ':' + layer\n            });\n          }\n        }\n      }\n      callback(error, suggestions.reverse());\n    }, this);\n  },\n  results: function(text, key, bounds, callback){\n    var results = [];\n    var request;\n\n    if(key){\n      var featureId = key.split(':')[0];\n      var layer = key.split(':')[1];\n      request = this.query().layer(layer).featureIds(featureId);\n    } else {\n      request = this.find().text(text).fields(this.options.searchFields).contains(false).layers(this.options.layers);\n    }\n\n    return request.run(function(error, features, response){\n      if(!error){\n        if(response.results){\n          response.results = response.results.reverse();\n        }\n        for (var i = 0; i < features.features.length; i++) {\n          var feature = features.features[i];\n          layer = (layer) ? layer : response.results[i].layerId;\n          if(feature && layer !== undefined) {\n            var bounds = this._featureBounds(feature);\n            var idField = this._idFields[layer];\n            feature.layerId = layer;\n            feature.layerName = this._layerNames[layer];\n            feature.displayFieldName = this._displayFields[layer];\n            var result = {\n              latlng: bounds.getCenter(),\n              bounds: bounds,\n              text: this.options.formatSuggestion.call(this, feature),\n              properties: feature.properties\n            };\n            results.push(result);\n          }\n        }\n      }\n      callback(error, results.reverse());\n    }, this);\n  },\n  _featureBounds: function(feature){\n    var geojson = L.geoJson(feature);\n    if(feature.geometry.type === 'Point'){\n      var center = geojson.getBounds().getCenter();\n      return new L. Circle(center, this.options.bufferRadius).getBounds();\n    } else {\n      return geojson.getBounds();\n    }\n  },\n  _layerMetadataCallback: function(layerid){\n    return L.Util.bind(function(error, metadata){\n      this._displayFields[layerid] = metadata.displayField;\n      this._layerNames[layerid] = metadata.name;\n      for (var i = 0; i < metadata.fields.length; i++) {\n        var field = metadata.fields[i];\n        if(field.type === 'esriFieldTypeOID'){\n          this._idFields[layerid] = field.name;\n          break;\n        }\n      }\n    }, this);\n  },\n  _getIdFields: function(){\n    this._idFields = {};\n    this._displayFields = {};\n    this._layerNames = {};\n    for (var i = 0; i < this.options.layers.length; i++) {\n      var layer = this.options.layers[i];\n      this.get(layer, {}, this._layerMetadataCallback(layer));\n    }\n  }\n});"]}