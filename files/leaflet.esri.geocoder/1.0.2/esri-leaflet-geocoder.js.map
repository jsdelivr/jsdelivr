{"version":3,"file":"esri-leaflet-geocoder.js","sources":["../src/EsriLeafletGeocoding.js","../src/Tasks/Geocode.js","../src/Tasks/ReverseGeocode.js","../src/Tasks/Suggest.js","../src/Services/Geocoding.js","../src/Controls/Geosearch.js","../src/Providers/ArcgisOnlineGeocoder.js","../src/Providers/FeatureLayer.js","../src/Providers/GeocodeService.js","../src/Providers/MapService.js"],"names":["protocol","window","location","EsriLeafletGeocoding","WorldGeocodingService","Tasks","Services","Controls","L","esri","Geocoding","Esri","Geocode","Task","extend","path","params","outSr","forStorage","outFields","maxLocations","setters","address","neighborhood","city","subregion","region","postal","country","text","category","token","key","fields","initialize","options","url","prototype","call","this","within","bounds","latLngBounds","bbox","Util","boundsToExtent","nearby","latlng","radius","latLng","lng","lat","distance","Math","min","max","run","callback","context","searchExtent","request","error","response","processor","_processFindResponse","_processFindAddressCandidatesResponse","results","undefined","i","locations","length","extent","extentToBounds","push","name","score","feature","attributes","Score","LatLng","geometry","y","x","properties","candidates","candidate","geocode","ReverseGeocode","outSR","language","result","reverseGeocode","Suggest","pad","center","getCenter","ne","getNorthWest","distanceTo","suggest","Service","includes","Mixin","Events","_confirmSuggestSupport","reverse","metadata","capabilities","supportsSuggest","geocoding","Geosearch","Control","position","zoomToResult","useMapBounds","collapseAfterResult","expanded","allowMultipleResults","useArcgisWorldGeocoder","providers","placeholder","title","mapAttribution","setOptions","geocoder","Providers","ArcGISOnline","maxResults","_pendingSuggestions","_geocode","provider","activeRequests","allResults","bind","concat","_boundsFromResults","fire","_map","fitBounds","DomUtil","removeClass","_input","clear","blur","_searchBounds","_suggest","addClass","createCallback","suggestions","value","_suggestions","innerHTML","style","display","_lastRender","nodes","parentElement","removeChild","k","_renderSuggestions","getBounds","getZoom","currentGroup","maxHeight","getSize","offsetTop","_wrapper","list","header","suggestion","label","create","textContent","innerText","suggestionItem","magicKey","nullIsland","LatLngBounds","isValid","equals","scrollWheelZoom","enabled","enable","onAdd","map","attributionControl","addAttribution","DomEvent","addListener","e","focus","target","srcElement","selectedPosition","querySelectorAll","selected","keyCode","preventDefault","previousItem","nextItem","abort","id","_EsriLeafletCallbacks","limitExecByInterval","which","_lastValue","disableClickPropagation","disable","onRemove","removeAttribution","geosearch","shift","isCollection","FeatureLayer","FeatureLayerService","bufferRadius","formatSuggestion","searchFields","cleanUrl","query","where","_buildQuery","returnGeometry","intersects","idField","raw","objectIdFieldName","count","features","slice","featureIds","_featureBounds","queryString","field","join","geojson","geoJson","type","Circle","GeocodeService","MapService","layers","displayFieldName","layerName","_getIdFields","find","layer","layerId","_idFields","_layerNames","_displayFields","featureId","split","contains","_layerMetadataCallback","layerid","displayField","get"],"mappings":"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","sourcesContent":["var protocol = window.location.protocol === 'https:' ? 'https:' : 'http:';\n\nvar EsriLeafletGeocoding = {\n  WorldGeocodingService: protocol + '//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/',\n  Tasks: {},\n  Services: {},\n  Controls: {}\n};\n\n// attach to the L.esri global if we can\nif(typeof window !== 'undefined' && window.L && window.L.esri) {\n  window.L.esri.Geocoding = EsriLeafletGeocoding;\n}\n\n// We do not have an 'Esri' variable e.g loading this file directly from source define 'Esri'\nif(!Esri){\n  var Esri = window.L.esri;\n}","EsriLeafletGeocoding.Tasks.Geocode = Esri.Tasks.Task.extend({\n  path: 'find',\n\n  params : {\n    outSr: 4326,\n    forStorage: false,\n    outFields: '*',\n    maxLocations: 20\n  },\n\n  setters: {\n    'address': 'address',\n    'neighborhood': 'neighborhood',\n    'city': 'city',\n    'subregion': 'subregion',\n    'region': 'region',\n    'postal': 'postal',\n    'country': 'country',\n    'text': 'text',\n    'category': 'category[]',\n    'token' : 'token',\n    'key': 'magicKey',\n    'fields': 'outFields[]',\n    'forStorage': 'forStorage',\n    'maxLocations': 'maxLocations'\n  },\n\n  initialize: function(options){\n    options = options || {};\n    options.url = options.url || EsriLeafletGeocoding.WorldGeocodingService;\n    Esri.Tasks.Task.prototype.initialize.call(this, options);\n  },\n\n  within: function(bounds){\n    bounds = L.latLngBounds(bounds);\n    this.params.bbox = Esri.Util.boundsToExtent(bounds);\n    return this;\n  },\n\n  nearby: function(latlng, radius){\n    latlng = L.latLng(latlng);\n    this.params.location = latlng.lng + ',' + latlng.lat;\n    this.params.distance = Math.min(Math.max(radius, 2000), 50000);\n    return this;\n  },\n\n  run: function(callback, context){\n    this.path = (this.params.text) ? 'find' : 'findAddressCandidates';\n\n    if(this.path === 'findAddressCandidates' && this.params.bbox) {\n      this.params.searchExtent = this.params.bbox;\n      delete this.params.bbox;\n    }\n\n    return this.request(function(error, response){\n      var processor = (this.path === 'find') ? this._processFindResponse : this._processFindAddressCandidatesResponse;\n      var results = (!error) ? processor(response) : undefined;\n      callback.call(context, error, { results: results }, response);\n    }, this);\n  },\n\n  _processFindResponse: function(response){\n    var results = [];\n\n    for (var i = 0; i < response.locations.length; i++) {\n      var location = response.locations[i];\n      var bounds;\n      if (location.extent) {\n        bounds = Esri.Util.extentToBounds(location.extent);\n      }\n\n      results.push({\n        text: location.name,\n        bounds: bounds,\n        score: location.feature.attributes.Score,\n        latlng: new L.LatLng(location.feature.geometry.y, location.feature.geometry.x),\n        properties: location.feature.attributes\n      });\n    }\n\n    return results;\n  },\n\n  _processFindAddressCandidatesResponse: function(response){\n    var results = [];\n\n    for (var i = 0; i < response.candidates.length; i++) {\n      var candidate = response.candidates[i];\n      var bounds = Esri.Util.extentToBounds(candidate.extent);\n\n      results.push({\n        text: candidate.address,\n        bounds: bounds,\n        score: candidate.score,\n        latlng: new L.LatLng(candidate.location.y, candidate.location.x),\n        properties: candidate.attributes\n      });\n    }\n\n    return results;\n  }\n\n});\n\nEsriLeafletGeocoding.Tasks.geocode = function(options){\n  return new EsriLeafletGeocoding.Tasks.Geocode(options);\n};","EsriLeafletGeocoding.Tasks.ReverseGeocode = Esri.Tasks.Task.extend({\n  path: 'reverseGeocode',\n\n  params : {\n    outSR: 4326\n  },\n\n  setters: {\n    'distance': 'distance',\n    'language': 'language'\n  },\n\n  initialize: function(options){\n    options = options || {};\n    options.url = options.url || EsriLeafletGeocoding.WorldGeocodingService;\n    Esri.Tasks.Task.prototype.initialize.call(this, options);\n  },\n\n  latlng: function (latlng) {\n    latlng = L.latLng(latlng);\n    this.params.location = latlng.lng + ',' + latlng.lat;\n    return this;\n  },\n\n  run: function(callback, context){\n    return this.request(function(error, response){\n      var result;\n\n      if(!error){\n        result = {\n          latlng: new L.LatLng(response.location.y, response.location.x),\n          address: response.address\n        };\n      } else {\n        result = undefined;\n      }\n\n      callback.call(context, error, result, response);\n    }, this);\n  }\n});\n\nEsriLeafletGeocoding.Tasks.reverseGeocode = function(options){\n  return new EsriLeafletGeocoding.Tasks.ReverseGeocode(options);\n};","EsriLeafletGeocoding.Tasks.Suggest = Esri.Tasks.Task.extend({\n  path: 'suggest',\n\n  params : {},\n\n  setters: {\n    text: 'text',\n    category: 'category'\n  },\n\n  initialize: function(options){\n    options = options || {};\n\n    options.url = options.url || EsriLeafletGeocoding.WorldGeocodingService;\n    Esri.Tasks.Task.prototype.initialize.call(this, options);\n  },\n\n  within: function(bounds){\n    bounds = L.latLngBounds(bounds);\n    bounds = bounds.pad(0.5);\n    var center = bounds.getCenter();\n    var ne = bounds.getNorthWest();\n    this.params.location = center.lng + ',' + center.lat;\n    this.params.distance = Math.min(Math.max(center.distanceTo(ne), 2000), 50000);\n    this.params.searchExtent = L.esri.Util.boundsToExtent(bounds);\n    return this;\n  },\n\n  nearby: function(latlng, radius){\n    latlng = L.latLng(latlng);\n    this.params.location = latlng.lng + ',' + latlng.lat;\n    this.params.distance = Math.min(Math.max(radius, 2000), 50000);\n    return this;\n  },\n\n  run: function(callback, context){\n    return this.request(function(error, response){\n      callback.call(context, error, response, response);\n    }, this);\n  }\n\n});\n\nEsriLeafletGeocoding.Tasks.suggest = function(options){\n  return new EsriLeafletGeocoding.Tasks.Suggest(options);\n};","EsriLeafletGeocoding.Services.Geocoding = Esri.Services.Service.extend({\n\n  includes: L.Mixin.Events,\n\n  initialize: function(options){\n    options = options || {};\n    options.url = options.url || EsriLeafletGeocoding.WorldGeocodingService;\n    Esri.Services.Service.prototype.initialize.call(this, options);\n    this._confirmSuggestSupport();\n  },\n\n  geocode: function(){\n    return new EsriLeafletGeocoding.Tasks.Geocode(this);\n  },\n\n  reverse: function(){\n    return new EsriLeafletGeocoding.Tasks.ReverseGeocode(this);\n  },\n\n  suggest: function(){\n    // requires either the Esri World Geocoding Service or a 10.3 ArcGIS Server Geocoding Service that supports suggest.\n    return new EsriLeafletGeocoding.Tasks.Suggest(this);\n  },\n\n  _confirmSuggestSupport: function(){\n    this.metadata(function(error, response) {\n      if (response.capabilities && response.capabilities.includes('Suggest')) {\n        this.options.supportsSuggest = true;\n      }\n      else {\n        this.options.supportsSuggest = false;\n      }\n    }, this);\n  }\n});\n\nEsriLeafletGeocoding.Services.geocoding = function(options){\n  return new EsriLeafletGeocoding.Services.Geocoding(options);\n};\n","EsriLeafletGeocoding.Controls.Geosearch = L.Control.extend({\n  includes: L.Mixin.Events,\n  options: {\n    position: 'topleft',\n    zoomToResult: true,\n    useMapBounds: 12,\n    collapseAfterResult: true,\n    expanded: false,\n    forStorage: false,\n    allowMultipleResults: true,\n    useArcgisWorldGeocoder: true,\n    providers: [],\n    placeholder: 'Search for places or addresses',\n    title: 'Location Search',\n    mapAttribution: 'Geocoding by Esri'\n  },\n\n  initialize: function (options) {\n    L.Util.setOptions(this, options);\n\n    if(this.options.useArcgisWorldGeocoder){\n      var geocoder = new EsriLeafletGeocoding.Controls.Geosearch.Providers.ArcGISOnline();\n      this.options.providers.push(geocoder);\n    }\n\n    if(this.options.maxResults){\n      for (var i = 0; i < this.options.providers.length; i++) {\n        this.options.providers[i].options.maxResults = this.options.maxResults;\n      }\n    }\n\n    this._pendingSuggestions = [];\n  },\n\n  _geocode: function(text, key, provider){\n    var activeRequests = 0;\n    var allResults = [];\n    var bounds;\n\n    var callback = L.Util.bind(function(error, results){\n      activeRequests--;\n\n      if(results){\n        allResults = allResults.concat(results);\n      }\n\n      if(activeRequests <= 0){\n        bounds = this._boundsFromResults(allResults);\n\n        this.fire('results', {\n          results: allResults,\n          bounds: bounds,\n          latlng: (bounds) ? bounds.getCenter() : undefined,\n          text: text\n        });\n\n        if(this.options.zoomToResult && bounds){\n          this._map.fitBounds(bounds);\n        }\n\n        L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\n\n        this.fire('load');\n\n        this.clear();\n\n        this._input.blur();\n      }\n    }, this);\n\n    if(key){\n      activeRequests++;\n      provider.results( text, key, this._searchBounds(), callback);\n    } else {\n      for (var i = 0; i < this.options.providers.length; i++) {\n        activeRequests++;\n        this.options.providers[i].results(text, key, this._searchBounds(), callback);\n      }\n    }\n  },\n\n  _suggest: function(text){\n    L.DomUtil.addClass(this._input, 'geocoder-control-loading');\n    var activeRequests = this.options.providers.length;\n\n    var createCallback = L.Util.bind(function(text, provider){\n      return L.Util.bind(function(error, suggestions){\n        var i;\n\n        activeRequests = activeRequests - 1;\n\n        if(this._input.value < 2) {\n          this._suggestions.innerHTML = '';\n          this._suggestions.style.display = 'none';\n          return;\n        }\n\n        if(suggestions){\n          for (i = 0; i < suggestions.length; i++) {\n            suggestions[i].provider = provider;\n          }\n        }\n\n        if(provider._lastRender !== text && provider.nodes) {\n          for (i = 0; i < provider.nodes.length; i++) {\n            if(provider.nodes[i].parentElement){\n              this._suggestions.removeChild(provider.nodes[i]);\n            }\n          }\n\n          provider.nodes = [];\n        }\n\n        if(suggestions.length && this._input.value === text) {\n          if(provider.nodes){\n            for (var k = 0; k < provider.nodes.length; k++) {\n              if(provider.nodes[k].parentElement){\n                this._suggestions.removeChild(provider.nodes[k]);\n              }\n            }\n          }\n\n          provider._lastRender = text;\n          provider.nodes = this._renderSuggestions(suggestions);\n        }\n\n        if(activeRequests === 0) {\n          L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\n        }\n      }, this);\n    }, this);\n\n    this._pendingSuggestions = [];\n\n    for (var i = 0; i < this.options.providers.length; i++) {\n      var provider = this.options.providers[i];\n      var request = provider.suggestions(text, this._searchBounds(), createCallback(text, provider));\n      this._pendingSuggestions.push(request);\n    }\n  },\n\n  _searchBounds: function(){\n    if(this.options.useMapBounds === false) {\n      return null;\n    }\n\n    if(this.options.useMapBounds === true) {\n      return this._map.getBounds();\n    }\n\n    if(this.options.useMapBounds <= this._map.getZoom()) {\n      return this._map.getBounds();\n    }\n\n    return null;\n  },\n\n  _renderSuggestions: function(suggestions){\n    var currentGroup;\n    this._suggestions.style.display = 'block';\n\n    // set the maxHeight of the suggestions box to\n    // map height\n    // - suggestions offset (distance from top of suggestions to top of control)\n    // - control offset (distance from top of control to top of map)\n    // - 10 (extra padding)\n    this._suggestions.style.maxHeight = (this._map.getSize().y - this._suggestions.offsetTop - this._wrapper.offsetTop - 10) + 'px';\n\n    var nodes = [];\n    var list;\n    var header;\n    for (var i = 0; i < suggestions.length; i++) {\n      var suggestion = suggestions[i];\n      if(!header && this.options.providers.length > 1 && currentGroup !== suggestion.provider.options.label){\n        header = L.DomUtil.create('span', 'geocoder-control-header', this._suggestions);\n        header.textContent = suggestion.provider.options.label;\n        header.innerText = suggestion.provider.options.label;\n        currentGroup = suggestion.provider.options.label;\n        nodes.push(header);\n      }\n\n      if(!list){\n        list = L.DomUtil.create('ul', 'geocoder-control-list', this._suggestions);\n      }\n\n      var suggestionItem = L.DomUtil.create('li', 'geocoder-control-suggestion', list);\n\n      suggestionItem.innerHTML = suggestion.text;\n      suggestionItem.provider = suggestion.provider;\n      suggestionItem['data-magic-key'] = suggestion.magicKey;\n    }\n\n    nodes.push(list);\n    return nodes;\n  },\n\n  _boundsFromResults: function(results){\n    if(!results.length){\n      return;\n    }\n\n    var nullIsland = new L.LatLngBounds([0,0], [0,0]);\n    var bounds = new L.LatLngBounds();\n\n    for (var i = results.length - 1; i >= 0; i--) {\n      var result = results[i];\n\n      // make sure bounds are valid and not 0,0. sometimes bounds are incorrect or not present\n      if(result.bounds && result.bounds.isValid() && !result.bounds.equals(nullIsland)){\n        bounds.extend(result.bounds);\n      }\n\n      // ensure that the bounds include the results center point\n      bounds.extend(result.latlng);\n    }\n\n    return bounds;\n  },\n\n  clear: function(){\n    this._suggestions.innerHTML = '';\n    this._suggestions.style.display = 'none';\n    this._input.value = '';\n\n    if(this.options.collapseAfterResult){\n      this._input.placeholder = '';\n      L.DomUtil.removeClass(this._wrapper, 'geocoder-control-expanded');\n    }\n\n    if(!this._map.scrollWheelZoom.enabled() && this._map.options.scrollWheelZoom){\n      this._map.scrollWheelZoom.enable();\n    }\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n\n    // Add geocoding attribution to map. Using World Geocode Service requires default attribution.\n    if (map.attributionControl) {\n      if (this.options.useArcgisWorldGeocoder) {\n        map.attributionControl.addAttribution('Geocoding by Esri');\n      } else {\n        map.attributionControl.addAttribution(this.options.mapAttribution);\n      }\n    }\n\n    this._wrapper = L.DomUtil.create('div', 'geocoder-control ' + ((this.options.expanded) ? ' ' + 'geocoder-control-expanded'  : ''));\n    this._input = L.DomUtil.create('input', 'geocoder-control-input leaflet-bar', this._wrapper);\n    this._input.title = this.options.title;\n\n    this._suggestions = L.DomUtil.create('div', 'geocoder-control-suggestions leaflet-bar', this._wrapper);\n\n    L.DomEvent.addListener(this._input, 'focus', function(e){\n      this._input.placeholder = this.options.placeholder;\n      L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n    }, this);\n\n    L.DomEvent.addListener(this._wrapper, 'click', function(e){\n      L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n      this._input.focus();\n    }, this);\n\n    L.DomEvent.addListener(this._suggestions, 'mousedown', function(e){\n      var suggestionItem = e.target || e.srcElement;\n      this._geocode(suggestionItem.innerHTML, suggestionItem['data-magic-key'], suggestionItem.provider);\n      this.clear();\n    }, this);\n\n    L.DomEvent.addListener(this._input, 'blur', function(e){\n      this.clear();\n    }, this);\n\n    L.DomEvent.addListener(this._input, 'keydown', function(e){\n      L.DomUtil.addClass(this._wrapper, 'geocoder-control-expanded');\n\n      var list = this._suggestions.querySelectorAll('.' + 'geocoder-control-suggestion');\n      var selected = this._suggestions.querySelectorAll('.' + 'geocoder-control-selected')[0];\n      var selectedPosition;\n\n      for (var i = 0; i < list.length; i++) {\n        if(list[i] === selected){\n          selectedPosition = i;\n          break;\n        }\n      }\n\n      switch(e.keyCode){\n      case 13:\n        if(selected){\n          this._geocode(selected.innerHTML, selected['data-magic-key'], selected.provider);\n          this.clear();\n        } else if(this.options.allowMultipleResults){\n          this._geocode(this._input.value, undefined);\n          this.clear();\n        } else {\n          L.DomUtil.addClass(list[0], 'geocoder-control-selected');\n        }\n        L.DomEvent.preventDefault(e);\n        break;\n      case 38:\n        if(selected){\n          L.DomUtil.removeClass(selected, 'geocoder-control-selected');\n        }\n\n        var previousItem = list[selectedPosition-1];\n\n        if(selected && previousItem) {\n          L.DomUtil.addClass(previousItem, 'geocoder-control-selected');\n        } else {\n          L.DomUtil.addClass(list[list.length-1], 'geocoder-control-selected');\n        }\n        L.DomEvent.preventDefault(e);\n        break;\n      case 40:\n        if(selected){\n          L.DomUtil.removeClass(selected, 'geocoder-control-selected');\n        }\n\n        var nextItem = list[selectedPosition+1];\n\n        if(selected && nextItem) {\n          L.DomUtil.addClass(nextItem, 'geocoder-control-selected');\n        } else {\n          L.DomUtil.addClass(list[0], 'geocoder-control-selected');\n        }\n        L.DomEvent.preventDefault(e);\n        break;\n      default:\n        // when the input changes we should cancel all pending suggestion requests if possible to avoid result collisions\n        for (var x = 0; x < this._pendingSuggestions.length; x++) {\n          var request = this._pendingSuggestions[x];\n          if(request && request.abort && !request.id){\n            request.abort();\n          //work around an Esri Leaflet bug. Remove for 1.0.0/RC.2\n          } else if(request.id && window._EsriLeafletCallbacks[request.id].abort) {\n            window._EsriLeafletCallbacks[request.id].abort();\n          }\n        }\n        break;\n      }\n    }, this);\n\n    L.DomEvent.addListener(this._input, 'keyup', L.Util.limitExecByInterval(function(e){\n      var key = e.which || e.keyCode;\n      var text = (e.target || e.srcElement).value;\n\n      // require at least 2 characters for suggestions\n      if(text.length < 2) {\n        this._suggestions.innerHTML = '';\n        this._suggestions.style.display = 'none';\n        L.DomUtil.removeClass(this._input, 'geocoder-control-loading');\n        return;\n      }\n\n      // if this is the escape key it will clear the input so clear suggestions\n      if(key === 27){\n        this._suggestions.innerHTML = '';\n        this._suggestions.style.display = 'none';\n        return;\n      }\n\n      // if this is NOT the up/down arrows or enter make a suggestion\n      if(key !== 13 && key !== 38 && key !== 40){\n        if(this._input.value !== this._lastValue){\n          this._lastValue = this._input.value;\n          this._suggest(text);\n        }\n      }\n    }, 50, this), this);\n\n    L.DomEvent.disableClickPropagation(this._wrapper);\n\n    // when mouse moves over suggestions disable scroll wheel zoom if its enabled\n    L.DomEvent.addListener(this._suggestions, 'mouseover', function(e){\n      if(map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom){\n        map.scrollWheelZoom.disable();\n      }\n    });\n\n    // when mouse moves leaves suggestions enable scroll wheel zoom if its disabled\n    L.DomEvent.addListener(this._suggestions, 'mouseout', function(e){\n      if(!map.scrollWheelZoom.enabled() && map.options.scrollWheelZoom){\n        map.scrollWheelZoom.enable();\n      }\n    });\n\n    return this._wrapper;\n  },\n\n  onRemove: function (map) {\n    map.attributionControl.removeAttribution('Geocoding by Esri');\n  }\n});\n\nEsriLeafletGeocoding.Controls.geosearch = function(options){\n  return new EsriLeafletGeocoding.Controls.Geosearch(options);\n};\n\nEsriLeafletGeocoding.Controls.Geosearch.Providers = {};\n","EsriLeafletGeocoding.Controls.Geosearch.Providers.ArcGISOnline = EsriLeafletGeocoding.Services.Geocoding.extend({\n  options: {\n    label: 'Places and Addresses',\n    maxResults: 5\n  },\n\n  suggestions: function(text, bounds, callback){\n    var request = this.suggest().text(text);\n\n    if(bounds){\n      request.within(bounds);\n    }\n\n    return request.run(function(error, results, response){\n      var suggestions = [];\n      if(!error){\n        while(response.suggestions.length && suggestions.length <= (this.options.maxResults - 1)){\n          var suggestion = response.suggestions.shift();\n          if(!suggestion.isCollection){\n            suggestions.push({\n              text: suggestion.text,\n              magicKey: suggestion.magicKey\n            });\n          }\n        }\n      }\n      callback(error, suggestions);\n    }, this);\n  },\n\n  results: function(text, key, bounds, callback){\n    var request = this.geocode().text(text);\n\n    if(key){\n      request.key(key);\n    } else {\n      request.maxLocations(this.options.maxResults);\n    }\n\n    if(bounds){\n      request.within(bounds);\n    }\n\n    if(this.options.forStorage){\n      request.forStorage(true);\n    }\n\n    return request.run(function(error, response){\n      callback(error, response.results);\n    }, this);\n  }\n});","EsriLeafletGeocoding.Controls.Geosearch.Providers.FeatureLayer = L.esri.Services.FeatureLayerService.extend({\n  options: {\n    label: 'Feature Layer',\n    maxResults: 5,\n    bufferRadius: 1000,\n    formatSuggestion: function(feature){\n      return feature.properties[this.options.searchFields[0]];\n    }\n  },\n  initialize: function(options){\n    options.url = L.esri.Util.cleanUrl(options.url);\n    L.esri.Services.FeatureLayerService.prototype.initialize.call(this, options);\n    L.Util.setOptions(this, options);\n    if(typeof this.options.searchFields === 'string'){\n      this.options.searchFields = [this.options.searchFields];\n    }\n  },\n  suggestions: function(text, bounds, callback){\n    var query = this.query().where(this._buildQuery(text))\n                            .returnGeometry(false);\n\n    if(bounds){\n      query.intersects(bounds);\n    }\n\n    if(this.options.idField){\n      query.fields([this.options.idField].concat(this.options.searchFields));\n    }\n\n    var request = query.run(function(error, results, raw){\n      if(error){\n        callback(error, []);\n      } else {\n        this.options.idField = raw.objectIdFieldName;\n        var suggestions = [];\n        var count = Math.min(results.features.length, this.options.maxResults);\n        for (var i = 0; i < count; i++) {\n          var feature = results.features[i];\n          suggestions.push({\n            text: this.options.formatSuggestion.call(this, feature),\n            magicKey: feature.id\n          });\n        }\n        callback(error, suggestions.slice(0, this.options.maxResults).reverse());\n      }\n    }, this);\n\n    return request;\n  },\n  results: function(text, key, bounds, callback){\n    var query = this.query();\n\n    if(key){\n      query.featureIds([key]);\n    } else {\n      query.where(this._buildQuery(text));\n    }\n\n    if(bounds){\n      query.within(bounds);\n    }\n\n    return query.run(L.Util.bind(function(error, features){\n      var results = [];\n      for (var i = 0; i < features.features.length; i++) {\n        var feature = features.features[i];\n        if(feature){\n          var bounds = this._featureBounds(feature);\n\n          var result = {\n            latlng: bounds.getCenter(),\n            bounds: bounds,\n            text: this.options.formatSuggestion.call(this, feature),\n            properties: feature.properties\n          };\n\n          results.push(result);\n        }\n      }\n      callback(error, results);\n    }, this));\n  },\n  _buildQuery: function(text){\n    var queryString = [];\n\n    for (var i = this.options.searchFields.length - 1; i >= 0; i--) {\n      var field = this.options.searchFields[i];\n      queryString.push(field + ' LIKE \\'%' + text + '%\\'');\n    }\n\n    return queryString.join(' OR ');\n  },\n  _featureBounds: function(feature){\n    var geojson = L.geoJson(feature);\n    if(feature.geometry.type === 'Point'){\n      var center = geojson.getBounds().getCenter();\n      return new L. Circle(center, this.options.bufferRadius).getBounds();\n    } else {\n      return geojson.getBounds();\n    }\n  }\n});\n","EsriLeafletGeocoding.Controls.Geosearch.Providers.GeocodeService = EsriLeafletGeocoding.Services.Geocoding.extend({\n  options: {\n    label: 'Geocode Server',\n    maxResults: 5\n  },\n\n  suggestions: function(text, bounds, callback){\n\n    if (this.options.supportsSuggest) {\n      var request = this.suggest().text(text);\n      if(bounds){\n        request.within(bounds);\n      }\n\n      return request.run(function(error, results, response){\n        var suggestions = [];\n        if(!error){\n          while(response.suggestions.length && suggestions.length <= (this.options.maxResults - 1)){\n            var suggestion = response.suggestions.shift();\n            if(!suggestion.isCollection){\n              suggestions.push({\n                text: suggestion.text,\n                magicKey: suggestion.magicKey\n              });\n            }\n          }\n        }\n        callback(error, suggestions);\n      }, this);\n    }\n\n    else {\n      callback(undefined, []);\n      return false;\n    }\n  },\n\n  results: function(text, key, bounds, callback){\n    var request = this.geocode().text(text);\n\n    request.maxLocations(this.options.maxResults);\n\n    if(bounds){\n      request.within(bounds);\n    }\n\n    return request.run(function(error, response){\n      callback(error, response.results);\n    }, this);\n  }\n});","EsriLeafletGeocoding.Controls.Geosearch.Providers.MapService = L.esri.Services.MapService.extend({\n  options: {\n    layers: [0],\n    label: 'Map Service',\n    bufferRadius: 1000,\n    maxResults: 5,\n    formatSuggestion: function(feature){\n      return feature.properties[feature.displayFieldName] + ' <small>' + feature.layerName + '</small>';\n    }\n  },\n  initialize: function(options){\n    L.esri.Services.MapService.prototype.initialize.call(this, options);\n    this._getIdFields();\n  },\n  suggestions: function(text, bounds, callback){\n    var request = this.find().text(text).fields(this.options.searchFields).returnGeometry(false).layers(this.options.layers);\n\n    return request.run(function(error, results, raw){\n      var suggestions = [];\n      if(!error){\n        var count = Math.min(this.options.maxResults, results.features.length);\n        raw.results = raw.results.reverse();\n        for (var i = 0; i < count; i++) {\n          var feature = results.features[i];\n          var result = raw.results[i];\n          var layer = result.layerId;\n          var idField = this._idFields[layer];\n          feature.layerId = layer;\n          feature.layerName = this._layerNames[layer];\n          feature.displayFieldName = this._displayFields[layer];\n          if(idField){\n            suggestions.push({\n              text: this.options.formatSuggestion.call(this, feature),\n              magicKey: result.attributes[idField] + ':' + layer\n            });\n          }\n        }\n      }\n      callback(error, suggestions.reverse());\n    }, this);\n  },\n  results: function(text, key, bounds, callback){\n    var results = [];\n    var request;\n\n    if(key){\n      var featureId = key.split(':')[0];\n      var layer = key.split(':')[1];\n      request = this.query().layer(layer).featureIds(featureId);\n    } else {\n      request = this.find().text(text).fields(this.options.searchFields).contains(false).layers(this.options.layers);\n    }\n\n    return request.run(function(error, features, response){\n      if(!error){\n        if(response.results){\n          response.results = response.results.reverse();\n        }\n        for (var i = 0; i < features.features.length; i++) {\n          var feature = features.features[i];\n          layer = (layer) ? layer : response.results[i].layerId;\n          if(feature && layer !== undefined) {\n            var bounds = this._featureBounds(feature);\n            var idField = this._idFields[layer];\n            feature.layerId = layer;\n            feature.layerName = this._layerNames[layer];\n            feature.displayFieldName = this._displayFields[layer];\n            var result = {\n              latlng: bounds.getCenter(),\n              bounds: bounds,\n              text: this.options.formatSuggestion.call(this, feature),\n              properties: feature.properties\n            };\n            results.push(result);\n          }\n        }\n      }\n      callback(error, results.reverse());\n    }, this);\n  },\n  _featureBounds: function(feature){\n    var geojson = L.geoJson(feature);\n    if(feature.geometry.type === 'Point'){\n      var center = geojson.getBounds().getCenter();\n      return new L. Circle(center, this.options.bufferRadius).getBounds();\n    } else {\n      return geojson.getBounds();\n    }\n  },\n  _layerMetadataCallback: function(layerid){\n    return L.Util.bind(function(error, metadata){\n      this._displayFields[layerid] = metadata.displayField;\n      this._layerNames[layerid] = metadata.name;\n      for (var i = 0; i < metadata.fields.length; i++) {\n        var field = metadata.fields[i];\n        if(field.type === 'esriFieldTypeOID'){\n          this._idFields[layerid] = field.name;\n          break;\n        }\n      }\n    }, this);\n  },\n  _getIdFields: function(){\n    this._idFields = {};\n    this._displayFields = {};\n    this._layerNames = {};\n    for (var i = 0; i < this.options.layers.length; i++) {\n      var layer = this.options.layers[i];\n      this.get(layer, {}, this._layerMetadataCallback(layer));\n    }\n  }\n});"]}