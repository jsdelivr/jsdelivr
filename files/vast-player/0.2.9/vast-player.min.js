!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.VASTPlayer=a()}}(function(){var a;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=a("./lib/VASTPlayer")},{"./lib/VASTPlayer":5}],2:[function(a,b,c){"use strict";function d(a,b,c){b.on(a,function(){for(var b=[],d=arguments.length;d--;)b[d]=arguments[d];c.emit.apply(c,[a].concat(b))})}function e(a,b,c){c.forEach(function(c){b.listeners(c).length>0&&d(c,a,b)}),b.on("newListener",function(e){c.indexOf(e)>-1&&b.listeners(e).length<1&&d(e,a,b)})}function f(a){this.events=a.slice(),this.__private__={target:null,source:null}}f.prototype.from=function(a){return this.__private__.source=a,this.__private__.target&&e(a,this.__private__.target,this.events),this},f.prototype.to=function(a){return this.__private__.target=a,this.__private__.source&&e(this.__private__.source,a,this.events),this},b.exports=f},{}],3:[function(a,b,c){"use strict";function d(a){var b=this;e.call(this,Math.floor(a.duration||0)),this.video=a,[g.PLAYING,g.PAUSE,g.TIMEUPDATE].forEach(function(c){return a.addEventListener(c,function(){return b.tick()},!1)})}var e=a("./VideoTracker"),f=a("util").inherits,g=a("./enums/HTML_MEDIA_EVENTS");f(d,e),d.prototype._getState=function(){return{playing:!this.video.paused,currentTime:this.video.currentTime}},b.exports=d},{"./VideoTracker":7,"./enums/HTML_MEDIA_EVENTS":8,util:25}],4:[function(a,b,c){"use strict";function d(a){return a}function e(a,b){(a||[]).forEach(function(a){(new Image).src=b(a)})}function f(a,b){this.pixels=a.reduce(function(a,b){return(a[b.event]||(a[b.event]=[])).push(b.uri),a},{}),this.__private__={mapper:b||d}}var g=a("./enums/VPAID_EVENTS");f.prototype.track=function(a){function b(a,b,g){function h(a){return f((b||d)(a))}return function(){(!g||g())&&e(c[a],h)}}var c=this.pixels,f=this.__private__.mapper,h=a.adVolume;a.on(g.AdSkipped,b("skip")),a.on(g.AdStarted,b("creativeView")),a.on(g.AdVolumeChange,b("unmute",null,function(){return 0===h&&a.adVolume>0})),a.on(g.AdVolumeChange,b("mute",null,function(){return h>0&&0===a.adVolume})),a.on(g.AdImpression,b("impression")),a.on(g.AdVideoStart,b("start")),a.on(g.AdVideoFirstQuartile,b("firstQuartile")),a.on(g.AdVideoMidpoint,b("midpoint")),a.on(g.AdVideoThirdQuartile,b("thirdQuartile")),a.on(g.AdVideoComplete,b("complete")),a.on(g.AdClickThru,b("clickThrough")),a.on(g.AdUserAcceptInvitation,b("acceptInvitationLinear")),a.on(g.AdUserMinimize,b("collapse")),a.on(g.AdUserClose,b("closeLinear")),a.on(g.AdPaused,b("pause")),a.on(g.AdPlaying,b("resume")),a.on(g.AdError,b("error",function(a){return a.replace(/\[ERRORCODE\]/g,901)})),a.on(g.AdVolumeChange,function(){h=a.adVolume})},b.exports=f},{"./enums/VPAID_EVENTS":10}],5:[function(a,b,c){"use strict";function d(){var a,b,c,e,f={},g=arguments.length;for(a=0;g>a;a++){b=arguments[a]||{};for(c in b)e=b[c],void 0===f[c]&&(f[c]=e),"object"==typeof e&&(f[c]=d(f[c],e))}return f}function e(a){return a}function f(){return new Error("VASTPlayer not ready.")}function g(a){return function(){var b=this,c=this.__private__.player;return this.ready?c[a].apply(c,arguments).then(function(){return b}):s.reject(f())}}function h(a){return{get:function(){if(!this.ready)throw f();return this.__private__.player[a]},set:function(b){if(!this.ready)throw f();return this.__private__.player[a]=b}}}function i(a,b){var c=this;j.call(this),this.__private__={container:a,config:d(b,{vast:{resolveWrappers:!0,maxRedirects:5},tracking:{mapper:e}}),vast:null,ready:!1,player:null},this.on(q.AdClickThru,function(a,b,d){var e=a||c.vast.get("ads[0].creatives[0].videoClicks.clickThrough");d&&e&&window.open(e)})}var j=a("events").EventEmitter,k=a("util").inherits,l=a("vastacular").VAST,m=a("./players/JavaScriptVPAID"),n=a("./players/FlashVPAID"),o=a("./players/HTMLVideo"),p=a("./enums/MIME"),q=a("./enums/VPAID_EVENTS"),r=a("./EventProxy"),s=a("lie"),t=a("./PixelReporter");k(i,j),Object.defineProperties(i.prototype,{container:{get:function(){return this.__private__.container}},config:{get:function(){return this.__private__.config}},vast:{get:function(){return this.__private__.vast}},ready:{get:function(){return this.__private__.ready}},adRemainingTime:h("adRemainingTime"),adDuration:h("adDuration"),adVolume:h("adVolume")}),i.prototype.load=function(a){var b=this,c=this.config.vast;return l.fetch(a,c).then(function(a){var c=function(){var c=a.filter("ads[0].creatives[0].mediaFiles",function(a){return(a.type===p.JAVASCRIPT||"application/x-javascript"===a.type)&&"VPAID"===a.apiFramework}),d=a.filter("ads[0].creatives[0].mediaFiles",function(a){return a.type===p.FLASH&&"VPAID"===a.apiFramework}),e=a.filter("ads[0].creatives[0].mediaFiles",function(){return!0});return c.length>0?{player:new m(b.container),mediaFiles:c}:d.length>0?{player:new n(b.container,i.vpaidSWFLocation),mediaFiles:d}:{player:new o(b.container),mediaFiles:e}}(),d=a.get("ads[0].creatives[0].parameters"),e=[].concat(a.map("ads[0].impressions",function(a){return{event:"impression",uri:a.uri}}),a.map("ads[0].errors",function(a){return{event:"error",uri:a}}),a.get("ads[0].creatives[0].trackingEvents"),a.map("ads[0].creatives[0].videoClicks.clickTrackings",function(a){return{event:"clickThrough",uri:a}})),f=c.player,g=c.mediaFiles,h=new r(q),j=new t(e,b.config.tracking.mapper);return h.from(f).to(b),b.__private__.vast=a,b.__private__.player=f,f.load(g,d).then(function(){j.track(f)})}).then(function(){return b.__private__.ready=!0,b.emit("ready"),b}).catch(function(a){throw b.emit("error",a),a})},i.prototype.startAd=g("startAd"),i.prototype.stopAd=g("stopAd"),i.prototype.pauseAd=g("pauseAd"),i.prototype.resumeAd=g("resumeAd"),i.vpaidSWFLocation="https://cdn.jsdelivr.net/vast-player/0.2.9/vast-player--vpaid.swf",b.exports=i},{"./EventProxy":2,"./PixelReporter":4,"./enums/MIME":9,"./enums/VPAID_EVENTS":10,"./players/FlashVPAID":12,"./players/HTMLVideo":13,"./players/JavaScriptVPAID":14,events:18,lie:26,util:25,vastacular:30}],6:[function(a,b,c){"use strict";function d(a){var b=a.split(".").map(parseFloat);this.string=a,this.major=b[0],this.minor=b[1],this.patch=b[2],Object.freeze(this)}d.prototype.toString=function(){return this.string},b.exports=d},{}],7:[function(a,b,c){"use strict";function d(a,b){b.fired[a]||(b.emit(a),b.fired[a]=!0)}function e(a){f.apply(this,arguments),this.duration=a,this.seconds=Array.apply([],new Array(a)).map(function(){return!1}),this.fired=[h.AdVideoStart,h.AdVideoFirstQuartile,h.AdVideoMidpoint,h.AdVideoThirdQuartile,h.AdVideoComplete].reduce(function(a,b){return a[b]=!1,a},{})}var f=a("events").EventEmitter,g=a("util").inherits,h=a("./enums/VPAID_EVENTS");g(e,f),e.prototype.tick=function(){function a(a){var c=f[a-1];return b.slice(0,c).every(function(a){return a===!0})}var b=this.seconds,c=this._getState(),e=Math.round(c.currentTime)-1,f=[1,2,3,4].map(function(a){return Math.floor(this.duration/4*a)},this);c.playing&&(d(h.AdVideoStart,this),e>-1&&(this.seconds[e]=!0)),a(1)&&d(h.AdVideoFirstQuartile,this),a(2)&&d(h.AdVideoMidpoint,this),a(3)&&d(h.AdVideoThirdQuartile,this),a(4)&&d(h.AdVideoComplete,this)},b.exports=e},{"./enums/VPAID_EVENTS":10,events:18,util:25}],8:[function(a,b,c){"use strict";var d=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","interruptbegin","interruptend","loadeddata","loadedmetadata","loadstart","mozaudioavailable","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"];d.forEach(function(a){this[a.toUpperCase()]=a},d),Object.freeze(d),b.exports=d},{}],9:[function(a,b,c){var d={JAVASCRIPT:"application/javascript",FLASH:"application/x-shockwave-flash"};Object.freeze(d),b.exports=d},{}],10:[function(a,b,c){"use strict";var d=["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"];d.forEach(function(a){d[a]=a}),Object.freeze(d),b.exports=d},{}],11:[function(a,b,c){"use strict";var d=a("./window"),e=document.createElement("video"),f=a("./enums/MIME");c.isDesktop=!/Android|Silk|Mobile|PlayBook/.test(d.navigator.userAgent),c.canPlay=function(a){var b=d.navigator.mimeTypes,c=d.ActiveXObject;switch(a){case f.FLASH:try{return new c("ShockwaveFlash.ShockwaveFlash")?2:0}catch(a){return b&&b[f.FLASH]?2:0}return 0;case f.JAVASCRIPT:case"application/x-javascript":return 2;default:if(e.canPlayType)switch(e.canPlayType(a)){case"probably":return 2;case"maybe":return 1;default:return 0}}return 0},Object.freeze(c)},{"./enums/MIME":9,"./window":17}],12:[function(a,b,c){"use strict";function d(a,b){e.apply(this,arguments),this.swfURI=b,this.object=null}var e=a("./VPAID"),f=a("util").inherits,g=a("lie"),h=a("../uuid"),i=a("querystring"),j=a("../enums/VPAID_EVENTS"),k=a("../VPAIDVersion");f(d,e),d.prototype.load=function(a,b){var c=this,d=a[0].uri,e=a[0].bitrate;return new g(function(a,f){function g(a){c.container.removeChild(l),c.api=null,c.object=null,delete window[m],a&&f(a)}var l=document.createElement("object"),m="vast_player__"+h(20),n=i.stringify({vpaidURI:d,eventCallback:m});l.type="application/x-shockwave-flash",l.data=c.swfURI+"?"+n,l.style.display="block",l.style.width="100%",l.style.height="100%",l.style.border="none",l.style.opacity="0",l.innerHTML=['<param name="movie" value="'+c.swfURI+'">','<param name="flashvars" value="'+n+'">','<param name="quality" value="high">','<param name="play" value="false">','<param name="loop" value="false">','<param name="wmode" value="opaque">','<param name="scale" value="noscale">','<param name="salign" value="lt">','<param name="allowScriptAccess" value="always">'].join("\n"),c.object=l,window[m]=function(a){switch(a.type){case j.AdClickThru:return c.emit(a.type,a.url,a.Id,a.playerHandles);case j.AdInteraction:case j.AdLog:return c.emit(a.type,a.Id);case j.AdError:return c.emit(a.type,a.message);default:return c.emit(a.type)}},c.once("VPAIDInterfaceReady",function(){var a=l.getBoundingClientRect(),d=c.vpaidVersion=new k(l.handshakeVersion("2.0"));return d.major>2?f(new Error("VPAID version "+d+" is not supported.")):(c.on("VPAIDInterfaceResize",function(){var a=l.getBoundingClientRect();c.resizeAd(a.width,a.height,"normal")}),void l.initAd(a.width,a.height,"normal",e,b,null))}),c.once(j.AdLoaded,function(){c.api=l,l.style.opacity="1",a(c)}),c.once(j.AdError,function(a){g(new Error(a))}),c.once(j.AdStopped,g),c.container.appendChild(l)})},b.exports=d},{"../VPAIDVersion":6,"../enums/VPAID_EVENTS":10,"../uuid":16,"./VPAID":15,lie:26,querystring:23,util:25}],13:[function(a,b,c){"use strict";function d(a,b,c){return a.addEventListener(b,c,!1)}function e(a,b,c){return a.removeEventListener(b,c,!1)}function f(a,b,c){return d(a,b,function d(){return e(a,b,d),c.apply(this,arguments)})}function g(a,b){function c(){return new Error("The <video> has not been loaded.")}return function(){if(!this.video){if(b)return l.reject(c());throw c()}return a.apply(this,arguments)}}function h(a,b){var c=b.width,d=a.map(function(a){return{mediaFile:a,playability:m(a.type)}}).filter(function(a){return a.playability>0}).sort(n("-playability","-mediaFile.bitrate")),e=d.map(function(a){return Math.abs(c-a.mediaFile.width)}),f=d[e.indexOf(Math.min.apply(Math,e))];return!f||f.playability<1?null:f.mediaFile}function i(a){this.container=a,this.video=null,this.__private__={hasPlayed:!1}}var j=a("events").EventEmitter,k=a("util").inherits,l=a("lie"),m=a("../environment").canPlay,n=a("sort-by"),o=a("../enums/VPAID_EVENTS"),p=a("../enums/HTML_MEDIA_EVENTS"),q=a("../HTMLVideoTracker"),r=a("../EventProxy");k(i,j),Object.defineProperties(i.prototype,{adRemainingTime:{get:g(function(){return this.video.duration-this.video.currentTime})},adDuration:{get:g(function(){return this.video.duration})},adVolume:{get:g(function(){return this.video.volume}),set:g(function(a){this.video.volume=a})}}),i.prototype.load=function(a){var b=this;return new l(function(c,e){var g=document.createElement("video"),i=h(a,b.container.getBoundingClientRect());return i?(g.setAttribute("webkit-playsinline",!0),g.src=i.uri,g.preload="auto",g.style.display="block",g.style.width="100%",g.style.height="100%",g.style.objectFit="contain",f(g,p.LOADEDMETADATA,function(){var a=new q(g),e=new r(o);e.from(a).to(b),b.video=g,c(b),b.emit(o.AdLoaded),d(g,p.DURATIONCHANGE,function(){b.emit(o.AdDurationChange)}),d(g,p.VOLUMECHANGE,function(){b.emit(o.AdVolumeChange)})}),f(g,p.ERROR,function(){var a=g.error;b.emit(o.AdError,a.message),e(a)}),f(g,p.PLAYING,function(){b.__private__.hasPlayed=!0,b.emit(o.AdImpression)}),f(g,p.ENDED,function(){b.stopAd()}),d(g,"click",function(){b.emit(o.AdClickThru,null,null,!0)}),void b.container.appendChild(g)):e(new Error("There are no playable <MediaFile>s."))})},i.prototype.startAd=g(function(){var a=this,b=this.video;return this.__private__.hasPlayed?l.reject(new Error("The ad has already been started.")):new l(function(c){return f(b,p.PLAYING,function(){c(a),a.emit(o.AdStarted)}),b.play()})},!0),i.prototype.stopAd=g(function(){return this.container.removeChild(this.video),this.emit(o.AdStopped),l.resolve(this)},!0),i.prototype.pauseAd=g(function(){var a=this,b=this.video;return this.video.paused?l.resolve(this):new l(function(c){return f(b,p.PAUSE,function(){c(a),a.emit(o.AdPaused)}),b.pause()})},!0),i.prototype.resumeAd=g(function(){var a=this,b=this.video;return this.__private__.hasPlayed?this.video.paused?new l(function(c){return f(b,p.PLAY,function(){c(a),a.emit(o.AdPlaying)}),b.play()}):l.resolve(this):l.reject(new Error("The ad has not been started yet."))},!0),b.exports=i},{"../EventProxy":2,"../HTMLVideoTracker":3,"../enums/HTML_MEDIA_EVENTS":8,"../enums/VPAID_EVENTS":10,"../environment":11,events:18,lie:26,"sort-by":28,util:25}],14:[function(a,b,c){"use strict";function d(){f.apply(this,arguments),this.frame=null}var e=a("util").inherits,f=a("./VPAID"),g=a("lie"),h=a("../enums/VPAID_EVENTS"),i=a("../environment").isDesktop,j=a("../VPAIDVersion");e(d,f),d.prototype.load=function(a,b){var c=this,d=a[0].uri,e=a[0].bitrate;return new g(function(a,f){function g(a){c.container.removeChild(k),c.frame=null,c.api=null,a&&f(a)}var k=document.createElement("iframe"),l=document.createElement("script"),m=document.createElement("video");k.src="about:blank",k.style.width="100%",k.style.height="100%",k.style.display="block",k.style.opacity="0",k.style.border="none",m.setAttribute("webkit-playsinline","true"),m.style.display="block",m.style.width="100%",m.style.height="100%",m.style.objectFit="contain",c.container.appendChild(k),k.contentWindow.document.open(),k.contentWindow.document.close(),k.contentWindow.document.body.style.margin="0",c.frame=k,l.src=d,l.onload=function(){function d(){var a=k.getBoundingClientRect();c.resizeAd(a.width,a.height,"normal")}var l=k.contentWindow.getVPAIDAd(),n=k.getBoundingClientRect(),o=k.contentWindow.document.body,p=c.vpaidVersion=new j(l.handshakeVersion("2.0"));return p.major>2?f(new Error("VPAID version "+p+" is not supported.")):(k.contentWindow.addEventListener("resize",d,!1),h.forEach(function(a){return l.subscribe(function(){for(var b=new Array(arguments.length),d=arguments.length;d--;)b[d]=arguments[d];return c.emit.apply(c,[a].concat(b))},a)}),c.once(h.AdLoaded,function(){k.style.opacity="1",c.api=l,a(c)}),c.once(h.AdError,function(a){g(new Error(a))}),c.once(h.AdStopped,g),void l.initAd(n.width,n.height,"normal",e,{AdParameters:b},{slot:o,videoSlot:m,videoSlotCanAutoPlay:i}))},l.onerror=function(){g(new Error("Failed to load MediaFile ["+d+"]."))},k.contentWindow.document.body.appendChild(m),k.contentWindow.document.head.appendChild(l)})},b.exports=d},{"../VPAIDVersion":6,"../enums/VPAID_EVENTS":10,"../environment":11,"./VPAID":15,lie:26,util:25}],15:[function(a,b,c){"use strict";function d(a,b){return function(){function c(){return new Error("Ad has not been loaded.")}function d(){return f[a].apply(f,e)}var e=arguments,f=this.api,g=this;if(!b){if(!f)throw c();return d()}return new h(function(a,e){return f?(g.once(b,function(){a(g)}),d()):e(c())})}}function e(a){this.container=a,this.api=null,this.vpaidVersion=null}var f=a("util").inherits,g=a("events").EventEmitter,h=a("lie"),i=a("../enums/VPAID_EVENTS");f(e,g),Object.defineProperties(e.prototype,{adLinear:{get:d("getAdLinear")},adWidth:{get:d("getAdWidth")},adHeight:{get:d("getAdHeight")},adExpanded:{get:d("getAdExpanded")},adSkippableState:{get:d("getAdSkippableState")},adRemainingTime:{get:d("getAdRemainingTime")},adDuration:{get:d("getAdDuration")},adVolume:{get:d("getAdVolume"),set:d("setAdVolume")},adCompanions:{get:d("getAdCompanions")},adIcons:{get:d("getAdIcons")}}),e.prototype.load=function(){throw new Error("VPAID subclass must implement load() method.")},e.prototype.resizeAd=d("resizeAd",i.AdSizeChange),e.prototype.startAd=d("startAd",i.AdStarted),e.prototype.stopAd=d("stopAd",i.AdStopped),e.prototype.pauseAd=d("pauseAd",i.AdPaused),e.prototype.resumeAd=d("resumeAd",i.AdPlaying),e.prototype.expandAd=d("expandAd",i.AdExpandedChange),e.prototype.collapseAd=d("collapseAd",i.AdExpandedChange),e.prototype.skipAd=d("skipAd",i.AdSkipped),b.exports=e},{"../enums/VPAID_EVENTS":10,events:18,lie:26,util:25}],16:[function(a,b,c){"use strict";var d="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e=d.length;b.exports=function(a){for(var b="";a--;)b+=d.charAt(Math.floor(Math.random()*e));return b}},{}],17:[function(a,b,c){b.exports=window},{}],18:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],19:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],20:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h&&h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],21:[function(a,b,c){"use strict";function d(a,b){return Object.prototype.hasOwnProperty.call(a,b)}b.exports=function(a,b,c,f){b=b||"&",c=c||"=";var g={};if("string"!=typeof a||0===a.length)return g;var h=/\+/g;a=a.split(b);var i=1e3;f&&"number"==typeof f.maxKeys&&(i=f.maxKeys);var j=a.length;i>0&&j>i&&(j=i);for(var k=0;j>k;++k){var l,m,n,o,p=a[k].replace(h,"%20"),q=p.indexOf(c);q>=0?(l=p.substr(0,q),m=p.substr(q+1)):(l=p,m=""),n=decodeURIComponent(l),o=decodeURIComponent(m),d(g,n)?e(g[n])?g[n].push(o):g[n]=[g[n],o]:g[n]=o}return g};var e=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},{}],22:[function(a,b,c){"use strict";function d(a,b){if(a.map)return a.map(b);for(var c=[],d=0;d<a.length;d++)c.push(b(a[d],d));return c}var e=function(a){switch(typeof a){case"string":return a;case"boolean":return a?"true":"false";case"number":return isFinite(a)?a:"";default:return""}};b.exports=function(a,b,c,h){return b=b||"&",c=c||"=",null===a&&(a=void 0),"object"==typeof a?d(g(a),function(g){var h=encodeURIComponent(e(g))+c;return f(a[g])?d(a[g],function(a){return h+encodeURIComponent(e(a))}).join(b):h+encodeURIComponent(e(a[g]))}).join(b):h?encodeURIComponent(e(h))+c+encodeURIComponent(e(a)):""};var f=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},g=Object.keys||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}},{}],23:[function(a,b,c){"use strict";c.decode=c.parse=a("./decode"),c.encode=c.stringify=a("./encode")},{"./decode":21,"./encode":22}],24:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],25:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(a){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":24,_process:20,inherits:19}],26:[function(a,b,c){"use strict";function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(b){return p.reject(a,b)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;return a&&"object"==typeof a&&"function"==typeof b?function(){b.apply(a,arguments)}:void 0}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){
var c={};try{c.value=a(b),c.status="success"}catch(a){c.status="error",c.value=a}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a("immediate"),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=c=e,e.prototype.catch=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){var e=this.state===r?a:b;g(c,e,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},c.resolve=k,c.reject=l,c.all=m,c.race=n},{immediate:27}],27:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||"undefined"==typeof a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(a,b,c){var d,e,f=a("object-path");e=function(a){var b=1;return"-"===a[0]&&(b=-1,a=a.substr(1)),function(c,d){var e;return f.get(c,a)<f.get(d,a)&&(e=-1),f.get(c,a)>f.get(d,a)&&(e=1),f.get(c,a)===f.get(d,a)&&(e=0),e*b}},d=function(){var a=arguments;return function(b,c){for(var d=a.length,f=0,g=0;0===f&&d>g;)f=e(a[g])(b,c),g++;return f}},b.exports=d},{"object-path":29}],29:[function(b,c,d){!function(b,d){"use strict";"object"==typeof c&&"object"==typeof c.exports?c.exports=d():"function"==typeof a&&a.amd?a([],d):b.objectPath=d()}(this,function(){"use strict";function a(a){if(!a)return!0;if(f(a)&&0===a.length)return!0;for(var b in a)if(l.call(a,b))return!1;return!0}function b(a){return k.call(a)}function c(a){return"number"==typeof a||"[object Number]"===b(a)}function d(a){return"string"==typeof a||"[object String]"===b(a)}function e(a){return"object"==typeof a&&"[object Object]"===b(a)}function f(a){return"object"==typeof a&&"number"==typeof a.length&&"[object Array]"===b(a)}function g(a){return"boolean"==typeof a||"[object Boolean]"===b(a)}function h(a){var b=parseInt(a);return b.toString()===a?b:a}function i(b,e,f,g){if(c(e)&&(e=[e]),a(e))return b;if(d(e))return i(b,e.split("."),f,g);var j=h(e[0]);if(1===e.length){var k=b[j];return void 0!==k&&g||(b[j]=f),k}return void 0===b[j]&&(c(j)?b[j]=[]:b[j]={}),i(b[j],e.slice(1),f,g)}function j(b,e){if(c(e)&&(e=[e]),!a(b)){if(a(e))return b;if(d(e))return j(b,e.split("."));var g=h(e[0]),i=b[g];if(1===e.length)void 0!==i&&(f(b)?b.splice(g,1):delete b[g]);else if(void 0!==b[g])return j(b[g],e.slice(1));return b}}var k=Object.prototype.toString,l=Object.prototype.hasOwnProperty,m={};return m.ensureExists=function(a,b,c){return i(a,b,c,!0)},m.set=function(a,b,c,d){return i(a,b,c,d)},m.insert=function(a,b,c,d){var e=m.get(a,b);d=~~d,f(e)||(e=[],m.set(a,b,e)),e.splice(d,0,c)},m.empty=function(b,h){if(a(h))return b;if(!a(b)){var i,j;if(!(i=m.get(b,h)))return b;if(d(i))return m.set(b,h,"");if(g(i))return m.set(b,h,!1);if(c(i))return m.set(b,h,0);if(f(i))i.length=0;else{if(!e(i))return m.set(b,h,null);for(j in i)l.call(i,j)&&delete i[j]}}},m.push=function(a,b){var c=m.get(a,b);f(c)||(c=[],m.set(a,b,c)),c.push.apply(c,Array.prototype.slice.call(arguments,2))},m.coalesce=function(a,b,c){for(var d,e=0,f=b.length;f>e;e++)if(void 0!==(d=m.get(a,b[e])))return d;return c},m.get=function(b,e,f){if(c(e)&&(e=[e]),a(e))return b;if(a(b))return f;if(d(e))return m.get(b,e.split("."),f);var g=h(e[0]);return 1===e.length?void 0===b[g]?f:b[g]:m.get(b[g],e.slice(1),f)},m.del=function(a,b){return j(a,b)},m})},{}],30:[function(a,b,c){c.VAST=a("./lib/VAST")},{"./lib/VAST":31}],31:[function(a,b,c){"use strict";function d(){}function e(a){n({description:null,survey:null},a)}function f(){}function g(a){n({trackingEvents:[],parameters:null,videoClicks:null},a),(a.mediaFiles||[]).forEach(function(a){n({id:null,bitrate:null,scalable:null,maintainAspectRatio:null,apiFramework:null},a)})}function h(a){a.companions.forEach(function(a){n({expandedWidth:null,expandedHeight:null,apiFramework:null,trackingEvents:[],clickThrough:null,altText:null,parameters:null},a)})}function i(a){n({trackingEvents:[]},a),a.ads.forEach(function(a){n({id:null,expandedWidth:null,expandedHeight:null,scalable:null,maintainAspectRatio:null,minSuggestedDuration:null,apiFramework:null,clickThrough:null,parameters:null},a)})}function j(a){m(a,this,!0),this.ads.forEach(function(a){n({system:{version:null},errors:[]},a),a.creatives.forEach(function(a){n({id:null,sequence:null,adID:null},a),t[a.type](a)}),s[a.type](a)}),this.__private__={wrappers:[],inlines:[]}}var k=a("lie"),l=a("superagent"),m=a("./utils/copy"),n=a("./utils/defaults"),o=a("./utils/extend"),p=a("./utils/nodeify_promise"),q=Array.prototype.push,r=a("./xml_from_vast"),s={inline:e,wrapper:f},t={linear:g,companions:h,nonLinear:i};Object.defineProperties(j.prototype,{wrappers:{get:function(){var a=this.__private__.wrappers;return a.length=0,q.apply(a,this.filter("ads",function(a){return"wrapper"===a.type})),a}},inlines:{get:function(){var a=this.__private__.inlines;return a.length=0,q.apply(a,this.filter("ads",function(a){return"inline"===a.type})),a}}}),j.prototype.get=function(a){var b=(a||"").match(/[^\[\]\.]+/g)||[];return b.reduce(function(a,b){return(a||void 0)&&a[b]},this)},j.prototype.set=function(a,b){function c(a,b){switch(a.input.charAt(b)){case".":return Object;case"[":return Array;case"]":return c(a,b+1);default:return null}}var d=function(){for(var b,d=/[^\[\]\.]+/g,e=[];b=d.exec(a);)e.push({token:b[0],type:c(b,b.index+b[0].length)});return e}(),e=d.pop(),f=d.reduce(function(a,b){return a[b.token]||(a[b.token]=new b.type)},this);if(!a)throw new Error("prop must be specified.");return f[e.token]=b},j.prototype.map=function(a,b){var c=this.get(a)||[],d=c.length,e=[];if(!(c instanceof Array))return e;for(var f=0;d>f;f++)e.push(b.call(this,c[f],f,c));return e},j.prototype.filter=function(a,b){var c=this.get(a)||[],d=c.length,e=[];if(!(c instanceof Array))return e;for(var f=0;d>f;f++)b.call(this,c[f],f,c)&&e.push(c[f]);return e},j.prototype.find=function(a,b){var c=this.get(a)||[],d=c.length;if(c instanceof Array)for(var e=0;d>e;e++)if(b.call(this,c[e],e,c))return c[e]},j.prototype.toPOJO=function(){var a=JSON.parse(JSON.stringify(this));return delete a.__private__,a},j.prototype.copy=function(){return new this.constructor(this.toPOJO())},j.prototype.resolveWrappers=function(){function a(a,b){function c(a){return function(b){return b.type===a}}function d(a){return{linear:a.filter(c("linear")),companions:a.filter(c("companions")),nonLinear:a.filter(c("nonLinear"))}}var e=d(a.creatives);return n(a.impressions,b.impressions),n(a.errors,b.errors),b.creatives.forEach(function(a){n(e[a.type].shift()||{},a)}),q.apply(b.creatives,"wrapper"!==b.type?[]:["linear","companions","nonLinear"].reduce(function(a,b){return a.concat(e[b])},[])),b}var b=isNaN(arguments[0])?1/0:arguments[0],c="function"==typeof arguments[0]?arguments[0]:arguments[1],d=this.constructor,e=this;return 0===b?k.reject(new Error("Too many redirects were made.")):p(k.all(this.map("wrappers",function(a){return k.resolve(l.get(a.vastAdTagURI)).then(function(b){return{wrapper:a,response:d.pojoFromXML(b.text).ads}})})).then(function(b){var c=b.map(function(a){return a.wrapper}),f=b.map(function(a){return a.response});return new d(o(e.toPOJO(),{ads:e.map("ads",function(b){var d=c.indexOf(b),e=c[d],g=f[d];return g?g.map(a.bind(null,e)):[b]}).reduce(function(a,b){return a.concat(b)})}))}).then(function(a){return a.get("wrappers.length")>0?a.resolveWrappers(b-1):a}),c)},j.prototype.toXML=function(){var a=this.validate();if(!a.valid)throw new Error("VAST is invalid: "+a.reasons.join(", "));return r(this)},j.prototype.validate=function(){function a(a,b){a||g.push(b)}function b(b){a(f.get(b),b+" is required")}function c(b){a(f.get(b+".length")>0,b+" must contain at least one value")}function e(a,d){d.exists.map(a).forEach(b),d.atLeastOne.map(a).forEach(c)}var f=this,g=[],h={inline:function(a){var b={linear:function(a){e(a,{exists:["duration"],atLeastOne:["mediaFiles"]})},companions:function(a){f.get(a("companions")).forEach(function(b,c){function d(b){return a("companions["+c+"]."+b)}e(d,{exists:[],atLeastOne:["resources"]})})},nonLinear:function(a){f.get(a("ads")).forEach(function(b,c){function d(b){return a("ads["+c+"]."+b)}e(d,{exists:[],atLeastOne:["resources"]})})}};e(a,{exists:["title"],atLeastOne:["creatives"]}),f.get(a("creatives")).forEach(function(c,f){function g(b){return a("creatives["+f+"]."+b)}e(g,{exists:["type"],atLeastOne:[]}),(b[c.type]||d)(g)})},wrapper:function(a){e(a,{exists:["vastAdTagURI"],atLeastOne:[]})}};return e(function(a){return a},{exists:[],atLeastOne:["ads"]}),this.get("ads").forEach(function(a,b){function c(a){return"ads["+b+"]."+a}e(c,{exists:["type","system.name"],atLeastOne:["impressions"]}),(h[a.type]||d)(c)}),{valid:0===g.length,reasons:0===g.length?null:g}},j.pojoFromXML=a("./pojo_from_xml"),j.fetch=function(a){var b="object"==typeof arguments[1]?arguments[1]||{}:{},c="function"==typeof arguments[2]?arguments[2]:arguments[1],d=this;return p(k.resolve(l.get(a).set(b.headers||{})).then(function(a){var c=new d(d.pojoFromXML(a.text));return b.resolveWrappers?c.resolveWrappers(b.maxRedirects):c}),c)},b.exports=j},{"./pojo_from_xml":32,"./utils/copy":34,"./utils/defaults":35,"./utils/extend":36,"./utils/nodeify_promise":37,"./xml_from_vast":44,lie:26,superagent:45}],32:[function(a,b,c){"use strict";function d(a){return a[0]||{attributes:{}}}function e(a){var b=a.find("StaticResource,IFrameResource,HTMLResource");return b.map(function(a){return{type:a.tag.replace(/Resource$/,"").toLowerCase(),creativeType:a.attributes.creativeType,data:a.value}})}function f(a){var b=d(a.find("Duration")),c=a.find("Tracking"),e=d(a.find("AdParameters")),f=a.find("VideoClicks")[0],g=a.find("MediaFile");return{type:"linear",duration:l(b.value)||void 0,trackingEvents:c.map(function(a){return{event:a.attributes.event,uri:a.value}}),parameters:e.value,videoClicks:f&&function(){var a=d(f.find("ClickThrough")),b=f.find("ClickTracking"),c=f.find("CustomClick");return{clickThrough:a.value,clickTrackings:b.map(function(a){return a.value}),customClicks:c.map(function(a){return{id:a.attributes.id,uri:a.value}})}}(),mediaFiles:g.map(function(a){var b=a.attributes;return{id:b.id,delivery:b.delivery,type:b.type,uri:a.value,bitrate:p(b.bitrate),width:p(b.width),height:p(b.height),scalable:m(b.scalable),maintainAspectRatio:m(b.maintainAspectRatio),apiFramework:b.apiFramework}})}}function g(a){var b=a.find("Companion");return{type:"companions",companions:b.map(function(a){var b=a.find("Tracking"),c=d(a.find("CompanionClickThrough")),f=d(a.find("AltText")),g=d(a.find("AdParameters"));return{id:a.attributes.id,width:p(a.attributes.width),height:p(a.attributes.height),expandedWidth:p(a.attributes.expandedWidth),expandedHeight:p(a.attributes.expandedHeight),apiFramework:a.attributes.apiFramework,resources:e(a),trackingEvents:b.map(function(a){return{event:a.attributes.event,uri:a.value}}),clickThrough:c.value,altText:f.value,parameters:g.value}})}}function h(a){var b=a.find("NonLinear"),c=a.find("Tracking");return{type:"nonLinear",ads:b.map(function(a){var b=d(a.find("NonLinearClickThrough")),c=d(a.find("AdParameters"));return{id:a.attributes.id,width:p(a.attributes.width),height:p(a.attributes.height),expandedWidth:p(a.attributes.expandedWidth),expandedHeight:p(a.attributes.expandedHeight),scalable:m(a.attributes.scalable),maintainAspectRatio:m(a.attributes.maintainAspectRatio),minSuggestedDuration:l(a.attributes.minSuggestedDuration)||void 0,apiFramework:a.attributes.apiFramework,resources:e(a),clickThrough:b.value,parameters:c.value}}),trackingEvents:c.map(function(a){return{event:a.attributes.event,uri:a.value}})}}function i(a){var b=d(a.find("AdTitle")),c=d(a.find("Description")),e=d(a.find("Survey"));return{type:"inline",title:b.value,description:c.value,survey:e.value}}function j(a){var b=d(a.find("VASTAdTagURI"));return{type:"wrapper",vastAdTagURI:b.value}}var k=a("./utils/parse_xml"),l=a("./utils/timestamp_to_seconds"),m=a("./utils/string_to_boolean"),n=a("./utils/extend"),o=a("./utils/trim_object"),p=a("./utils/numberify"),q={linear:f,companions:g,nonLinear:h},r={inline:i,wrapper:j};b.exports=function(a){var b=k(a);if(!b("VAST")[0])throw new Error("["+a+"] is not a valid VAST document.");return o({version:d(b("VAST")).attributes.version,ads:b("Ad").map(function(a){var b=d(a.find("Wrapper,InLine")).tag.toLowerCase(),c=d(a.find("AdSystem")),e=a.find("Error"),f=a.find("Impression"),g=a.find("Creative");return n({id:a.attributes.id,system:{name:c.value,version:c.attributes.version},errors:e.map(function(a){return a.value}),impressions:f.map(function(a){return{uri:a.value,id:a.attributes.id}}),creatives:g.map(function(a){var b=function(){var b=d(a.find("Linear,CompanionAds,NonLinearAds"));switch(b.tag){case"Linear":return"linear";case"CompanionAds":return"companions";case"NonLinearAds":return"nonLinear"}}();return n({id:a.attributes.id,sequence:p(a.attributes.sequence),adID:a.attributes.AdID},q[b](a))})},r[b](a))})},!0)}},{"./utils/extend":36,"./utils/numberify":38,"./utils/parse_xml":39,"./utils/string_to_boolean":41,"./utils/timestamp_to_seconds":42,"./utils/trim_object":43}],33:[function(a,b,c){"use strict";function d(a){return null!==a&&void 0!==a}function e(a){return void 0!==a?String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function f(a){for(var b="";a--;)b+=" ";return b}function g(a){var b=void 0!==a?function(a){for(var b,c,d=[],e=/]]>/g,f=0;b=e.exec(a);)c=b.index+2,d.push(b.input.substring(f,c)),f=c;return d.push(a.substring(f,a.length)),d}(String(a)):[""];return b.reduce(function(a,b){return a+"<![CDATA["+b+"]]>"},"")}function h(a){return a.cdata?g(a.value):e(a.value)}function i(a,b,c){var g=a.tag,j=a.attributes||{},k=Object.keys(j),l=a.children||[],m=a.value,n=l.length>0,o=k.every(function(a){return d(j[a])})&&k.length>0,p=d(m)||n||o,q=f(b),r="<"+g+Object.keys(j).reduce(function(a,b){return c&&!d(j[b])?a:a+" "+b+'="'+e(j[b])+'"'},"")+">",s="</"+g+">";return!c||p||a.required?n?[q+r].concat(a.children.reduce(function(a,d){return a.concat(i(d,b+4,c))},[]),[q+s]):[q+r+h(a)+s]:[]}b.exports=function(a,b){return['<?xml version="1.0" encoding="UTF-8"?>'].concat(i(a,0,b)).join("\n")}},{}],34:[function(a,b,c){"use strict";function d(a,b,c){return Object.keys(a).reduce(function(b,d){return b[d]=c?f(a[d],null,!0):a[d],b},b||{})}function e(a,b,c){var d=b||[];return g.apply(d,c?a.map(function(a){return f(a,null,!0)}):a),d}function f(a){var b=("object"==typeof arguments[1]||null)&&arguments[1],c="boolean"==typeof arguments[1]?arguments[1]:arguments[2];return Object(a)!==a?a:a instanceof Array?e(a,b,c):d(a,b,c)}var g=Array.prototype.push;b.exports=f},{}],35:[function(a,b,c){"use strict";function d(a){return Object(a)===a}function e(a){return a instanceof Array}var f=Array.prototype.push;b.exports=function a(b,c){return[b,c].every(e)?(f.apply(c,b.filter(function(a){return c.indexOf(a)<0})),c):Object.keys(b).reduce(function(c,e){var f=[b[e],c[e]];return f.every(d)&&a(b[e],c[e]),e in c||(c[e]=b[e]),c},c)}},{}],36:[function(a,b,c){"use strict";b.exports=function(){var a=Array.prototype.slice.call(arguments);return a.reduce(function(a,b){return Object.keys(b||{}).reduce(function(a,c){return a[c]=b[c],a},a)},{})}},{}],37:[function(a,b,c){"use strict";b.exports=function(a,b){return"function"!=typeof b?a:(a.then(function(a){b(null,a)},function(a){b(a)}),a)}},{}],38:[function(a,b,c){"use strict";b.exports=function(a){return/string|number|boolean/.test(typeof a)?isNaN(a)?void 0:Number(a):void 0}},{}],39:[function(a,b,c){"use strict";function d(a){var b=a.childElementCount>0;return{tag:a.tagName,value:b?null:a.textContent,attributes:h.call(a.attributes,function(a,b){return a[b.name]=b.value,a},{}),find:function(b){return e(a.querySelectorAll(b))},children:function(){return g.call(a.childNodes,function(a){return a instanceof Element}).map(d)}}}function e(a){return f.call(a,d)}var f=Array.prototype.map,g=Array.prototype.filter,h=Array.prototype.reduce,i=new DOMParser;b.exports=function(a){var b=i.parseFromString(a,"application/xml");return function(a){return e(b.querySelectorAll(a))}}},{}],40:[function(a,b,c){"use strict";function d(a){return(a>9?"":"0")+a.toString()}b.exports=function(a){return Number(a)!==a?null:[Math.floor(a/60/60),Math.floor(a/60%60),Math.floor(a%60%60)].map(d).join(":")}},{}],41:[function(a,b,c){"use strict";b.exports=function(a){switch((a||"").toLowerCase()){case"true":return!0;case"false":return!1}}},{}],42:[function(a,b,c){"use strict";b.exports=function(a){var b=(a||"").match(/^(\d\d):(\d\d):(\d\d)$/);return b&&b.slice(1,4).map(parseFloat).reduce(function(a,b,c){var d=Math.pow(60,Math.abs(c-2));return a+b*d},0)}},{}],43:[function(a,b,c){"use strict";b.exports=function a(b,c){return Object(b)!==b?b:Object.keys(b).reduce(function(d,e){return c&&b[e]instanceof Array?d[e]=b[e].filter(function(a){return void 0!==a}).map(function(b){return a(b,!0)}):c&&b[e]instanceof Object?d[e]=a(b[e],!0):void 0!==b[e]&&(d[e]=b[e]),d},{})}},{}],44:[function(a,b,c){"use strict";function d(a){return{tag:"TrackingEvents",children:a.map(function(a){return{tag:"Tracking",attributes:{event:a.event},value:a.uri,cdata:!0}})}}function e(a){return a.map(function(a){return{tag:function(a){switch(a){case"static":return"StaticResource";case"iframe":return"IFrameResource";case"html":return"HTMLResource"}}(a.type),attributes:{creativeType:a.creativeType},value:a.data,cdata:!0}})}function f(a){return{tag:"AdParameters",value:a.parameters}}function g(a){return{tag:"Linear",children:[{tag:"Duration",value:j(a.duration)},d(a.trackingEvents),f(a)].concat(a.videoClicks?[{tag:"VideoClicks",children:[{tag:"ClickThrough",value:a.videoClicks.clickThrough,cdata:!0}].concat(a.videoClicks.clickTrackings.map(function(a){return{tag:"ClickTracking",value:a,cdata:!0}}),a.videoClicks.customClicks.map(function(a){return{tag:"CustomClick",attributes:{id:a.id},value:a.uri,cdata:!0}}))}]:[],[{tag:"MediaFiles",children:a.mediaFiles.map(function(a){return{tag:"MediaFile",attributes:{id:a.id,width:a.width,height:a.height,bitrate:a.bitrate,type:a.type,delivery:a.delivery,scalable:a.scalable,maintainAspectRatio:a.maintainAspectRatio,apiFramework:a.apiFramework},value:a.uri,cdata:!0}})}])}}function h(a){return{tag:"CompanionAds",children:a.companions.map(function(a){return{tag:"Companion",attributes:{id:a.id,width:a.width,height:a.height,expandedWidth:a.expandedWidth,expandedHeight:a.expandedHeight,apiFramework:a.apiFramework},children:e(a.resources).concat([d(a.trackingEvents),{tag:"CompanionClickThrough",value:a.clickThrough,cdata:!0},{tag:"AltText",value:a.altText},f(a)])}})}}function i(a){return{tag:"NonLinearAds",children:a.ads.map(function(a){return{tag:"NonLinear",attributes:{id:a.id,width:a.width,height:a.height,expandedWidth:a.expandedWidth,expandedHeight:a.expandedHeight,scalable:a.scalable,maintainAspectRatio:a.maintainAspectRatio,minSuggestedDuration:j(a.minSuggestedDuration),apiFramework:a.apiFramework},children:e(a.resources).concat([{tag:"NonLinearClickThrough",value:a.clickThrough,cdata:!0},f(a)])}}).concat([d(a.trackingEvents)])}}var j=a("./utils/seconds_to_timestamp"),k=a("./utils/compile_xml"),l={linear:g,companions:h,nonLinear:i};b.exports=function(a){return k({tag:"VAST",attributes:{version:a.get("version")},children:a.map("ads",function(a){return{tag:"Ad",attributes:{id:a.id},children:[{tag:function(){switch(a.type){case"inline":return"InLine";case"wrapper":return"Wrapper"}}(),children:[{tag:"AdSystem",attributes:{version:a.system.version},value:a.system.name},{tag:"AdTitle",value:a.title},{tag:"Description",value:a.description},{tag:"Survey",value:a.survey,cdata:!0},{tag:"VASTAdTagURI",value:a.vastAdTagURI,cdata:!0}].concat(a.errors.map(function(a){return{tag:"Error",value:a,cdata:!0}}),a.impressions.map(function(a){return{tag:"Impression",value:a.uri,cdata:!0,attributes:{id:a.id}}}),[{tag:"Creatives",children:a.creatives.map(function(a){return{tag:"Creative",attributes:{id:a.id,sequence:a.sequence,AdID:a.adID},children:[function(b){return l[b](a)}(a.type)]}}),required:!0}])}]}})},!0)}},{"./utils/compile_xml":33,"./utils/seconds_to_timestamp":40}],45:[function(a,b,c){function d(){}function e(a){var b={}.toString.call(a);switch(b){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function f(a){return a===Object(a)}function g(a){if(!f(a))return a;var b=[];for(var c in a)null!=a[c]&&h(b,c,a[c]);return b.join("&")}function h(a,b,c){return Array.isArray(c)?c.forEach(function(c){h(a,b,c)}):void a.push(encodeURIComponent(b)+"="+encodeURIComponent(c))}function i(a){for(var b,c,d={},e=a.split("&"),f=0,g=e.length;g>f;++f)c=e[f],b=c.split("="),d[decodeURIComponent(b[0])]=decodeURIComponent(b[1]);return d}function j(a){var b,c,d,e,f=a.split(/\r?\n/),g={};f.pop();for(var h=0,i=f.length;i>h;++h)c=f[h],b=c.indexOf(":"),d=c.slice(0,b).toLowerCase(),e=u(c.slice(b+1)),g[d]=e;return g}function k(a){return/[\/+]json\b/.test(a)}function l(a){return a.split(/ *; */).shift()}function m(a){return t(a.split(/ *; */),function(a,b){var c=b.split(/ *= */),d=c.shift(),e=c.shift();return d&&e&&(a[d]=e),a},{})}function n(a,b){b=b||{},this.req=a,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"==typeof this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=j(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function o(a,b){var c=this;s.call(this),this._query=this._query||[],this.method=a,this.url=b,this.header={},this._header={},this.on("end",function(){var a=null,b=null;try{b=new n(c)}catch(b){return a=new Error("Parser is unable to parse the response"),a.parse=!0,a.original=b,a.rawResponse=c.xhr&&c.xhr.responseText?c.xhr.responseText:null,c.callback(a)}if(c.emit("response",b),a)return c.callback(a,b);if(b.status>=200&&b.status<300)return c.callback(a,b);var d=new Error(b.statusText||"Unsuccessful HTTP response");d.original=a,d.response=b,d.status=b.status,c.callback(d,b)})}function p(a,b){return"function"==typeof b?new o("GET",a).end(b):1==arguments.length?new o("GET",a):new o(a,b)}function q(a,b){var c=p("DELETE",a);return b&&c.end(b),c}var r,s=a("emitter"),t=a("reduce");r="undefined"!=typeof window?window:"undefined"!=typeof self?self:this,p.getXHR=function(){if(!(!r.XMLHttpRequest||r.location&&"file:"==r.location.protocol&&r.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}return!1};var u="".trim?function(a){return a.trim()}:function(a){return a.replace(/(^\s*|\s*$)/g,"")};p.serializeObject=g,p.parseString=i,p.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},p.serialize={"application/x-www-form-urlencoded":g,"application/json":JSON.stringify},p.parse={"application/x-www-form-urlencoded":i,"application/json":JSON.parse},n.prototype.get=function(a){return this.header[a.toLowerCase()]},n.prototype.setHeaderProperties=function(a){var b=this.header["content-type"]||"";this.type=l(b);var c=m(b);for(var d in c)this[d]=c[d]},n.prototype.parseBody=function(a){var b=p.parse[this.type];return b&&a&&(a.length||a instanceof Object)?b(a):null},n.prototype.setStatusProperties=function(a){1223===a&&(a=204);var b=a/100|0;this.status=this.statusCode=a,this.statusType=b,this.info=1==b,this.ok=2==b,this.clientError=4==b,this.serverError=5==b,this.error=4==b||5==b?this.toError():!1,this.accepted=202==a,this.noContent=204==a,this.badRequest=400==a,this.unauthorized=401==a,this.notAcceptable=406==a,this.notFound=404==a,this.forbidden=403==a},n.prototype.toError=function(){var a=this.req,b=a.method,c=a.url,d="cannot "+b+" "+c+" ("+this.status+")",e=new Error(d);return e.status=this.status,e.method=b,e.url=c,e},p.Response=n,s(o.prototype),o.prototype.use=function(a){return a(this),this},o.prototype.timeout=function(a){return this._timeout=a,this},o.prototype.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},o.prototype.abort=function(){return this.aborted?void 0:(this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this)},o.prototype.set=function(a,b){if(f(a)){for(var c in a)this.set(c,a[c]);return this}return this._header[a.toLowerCase()]=b,this.header[a]=b,this},o.prototype.unset=function(a){return delete this._header[a.toLowerCase()],delete this.header[a],this},o.prototype.getHeader=function(a){return this._header[a.toLowerCase()]},o.prototype.type=function(a){return this.set("Content-Type",p.types[a]||a),this},o.prototype.parse=function(a){return this._parser=a,this},o.prototype.accept=function(a){return this.set("Accept",p.types[a]||a),this},o.prototype.auth=function(a,b){var c=btoa(a+":"+b);return this.set("Authorization","Basic "+c),this},o.prototype.query=function(a){return"string"!=typeof a&&(a=g(a)),a&&this._query.push(a),this},o.prototype.field=function(a,b){return this._formData||(this._formData=new r.FormData),this._formData.append(a,b),this},o.prototype.attach=function(a,b,c){return this._formData||(this._formData=new r.FormData),this._formData.append(a,b,c||b.name),this},o.prototype.send=function(a){var b=f(a),c=this.getHeader("Content-Type");if(b&&f(this._data))for(var d in a)this._data[d]=a[d];else"string"==typeof a?(c||this.type("form"),c=this.getHeader("Content-Type"),"application/x-www-form-urlencoded"==c?this._data=this._data?this._data+"&"+a:a:this._data=(this._data||"")+a):this._data=a;return!b||e(a)?this:(c||this.type("json"),this)},o.prototype.callback=function(a,b){var c=this._callback;this.clearTimeout(),c(a,b)},o.prototype.crossDomainError=function(){var a=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");a.crossDomain=!0,a.status=this.status,a.method=this.method,a.url=this.url,this.callback(a)},o.prototype.timeoutError=function(){var a=this._timeout,b=new Error("timeout of "+a+"ms exceeded");b.timeout=a,this.callback(b)},o.prototype.withCredentials=function(){return this._withCredentials=!0,this},o.prototype.end=function(a){var b=this,c=this.xhr=p.getXHR(),f=this._query.join("&"),g=this._timeout,h=this._formData||this._data;this._callback=a||d,c.onreadystatechange=function(){if(4==c.readyState){var a;try{a=c.status}catch(b){a=0}if(0==a){if(b.timedout)return b.timeoutError();if(b.aborted)return;return b.crossDomainError()}b.emit("end")}};var i=function(a){a.total>0&&(a.percent=a.loaded/a.total*100),a.direction="download",b.emit("progress",a)};this.hasListeners("progress")&&(c.onprogress=i);try{c.upload&&this.hasListeners("progress")&&(c.upload.onprogress=i)}catch(a){}if(g&&!this._timer&&(this._timer=setTimeout(function(){b.timedout=!0,b.abort()},g)),f&&(f=p.serializeObject(f),this.url+=~this.url.indexOf("?")?"&"+f:"?"+f),c.open(this.method,this.url,!0),this._withCredentials&&(c.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof h&&!e(h)){var j=this.getHeader("Content-Type"),l=this._parser||p.serialize[j?j.split(";")[0]:""];!l&&k(j)&&(l=p.serialize["application/json"]),l&&(h=l(h))}for(var m in this.header)null!=this.header[m]&&c.setRequestHeader(m,this.header[m]);return this.emit("request",this),c.send("undefined"!=typeof h?h:null),this},o.prototype.then=function(a,b){return this.end(function(c,d){c?b(c):a(d)})},p.Request=o,p.get=function(a,b,c){var d=p("GET",a);return"function"==typeof b&&(c=b,b=null),b&&d.query(b),c&&d.end(c),d},p.head=function(a,b,c){var d=p("HEAD",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},p.del=q,p.delete=q,p.patch=function(a,b,c){var d=p("PATCH",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},p.post=function(a,b,c){var d=p("POST",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},p.put=function(a,b,c){var d=p("PUT",a);return"function"==typeof b&&(c=b,b=null),b&&d.send(b),c&&d.end(c),d},b.exports=p},{emitter:46,reduce:47}],46:[function(a,b,c){function d(a){return a?e(a):void 0}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}b.exports=d,d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+a]=this._callbacks["$"+a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){this.off(a,c),b.apply(this,arguments)}return c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks["$"+a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],47:[function(a,b,c){b.exports=function(a,b,c){for(var d=0,e=a.length,f=3==arguments.length?c:a[d++];e>d;)f=b.call(null,f,a[d],++d,a);
return f}},{}]},{},[1])(1)});