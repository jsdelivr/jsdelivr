/*!***************************************************
 * jmHighlight
 * Version 2.4.0
 * Copyright (c) 2014-2015, Julian Motz
 * For the full copyright and license information, 
 * please view the LICENSE file that was distributed 
 * with this source code.
 *****************************************************/
(function(h,e){"function"===typeof define&&define.amd?define(["jquery"],function(c,d){return e(c,d)}):"object"===typeof exports?e(require("jquery"),h):e(h.jQuery,h)})(this,function(h,e){function c(a,b,k){this.options=d.extend({},{debug:!1,log:e.console,element:"span",className:"highlight",filter:[],separateWordSearch:!1,diacritics:!0},k);"object"!==typeof this.options.log&&(this.options.log={debug:function(){}});this.keyword="string"===typeof b?b:"";this.$elements=d();a instanceof d&&0<a.length&&
(this.$elements=a.add(a.find("*")),a=this.getFilteredElements(),0!=a&&(this.$elements=a));return this}var d=h;c.prototype.diacritics="a\u00c0\u00c1\u00c2\u00c3\u00c4\u00c5\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5\u0100\u0101\u0105\u0104 c\u00c7\u00e7\u0107\u0106\u010d\u010c d\u0111\u0110\u010f\u010e e\u00c8\u00c9\u00ca\u00cb\u00e8\u00e9\u00ea\u00eb\u011b\u011a\u0112\u0113\u0119\u0118 i\u00cc\u00cd\u00ce\u00cf\u00ec\u00ed\u00ee\u00ef\u012a\u012b l\u0142\u0141 n\u00d1\u00f1\u0148\u0147\u0144\u0143 o\u00d2\u00d3\u00d4\u00d5\u00d5\u00d6\u00d8\u00f2\u00f3\u00f4\u00f5\u00f6\u00f8\u014c\u014d r\u0159\u0158 s\u0160\u0161\u015b\u015a t\u0165\u0164 u\u00d9\u00da\u00db\u00dc\u00f9\u00fa\u00fb\u00fc\u016f\u016e\u016a\u016b y\u0178\u00ff\u00fd\u00dd z\u017d\u017e\u017c\u017b\u017a\u0179".split(" ");
c.prototype.getFilteredElements=function(){var a=this.options.filter;if("object"!==typeof a||0==this.$elements instanceof d||"[object Array]"!=Object.prototype.toString.call(a))return!1;var b=this.$elements;return b=b.filter(function(){for(var b=d(this),l=!1,f=0,g=a.length;f<g;f++)b.is(a[f])&&(l=!0);return l?!1:!0})};c.prototype.getTextNodes=function(a){var b=[];if(0==a instanceof d||0==a.length)return b;a.each(function(){d(this).contents().filter(function(){return 3==this.nodeType?!0:!1}).each(function(){b.push(this)})});
return b};c.prototype.getKeywordRegexp=function(a){a="string"!==typeof a?this.keyword:a;return"string"!==typeof a||""==a?a:this.options.diacritics?this.getDiacriticRegex(a):a};c.prototype.getDiacriticRegex=function(a){if("undefined"===typeof a)return a;for(var b=a.split(""),k=[],d=0,f=b.length;d<f;d++)for(var g=b[d],c=0,h=this.diacritics.length;c<h;c++){var e=this.diacritics[c];-1==e.indexOf(g)||-1<k.indexOf(e)||(a=a.replace(new RegExp("["+e+"]","gmi"),"["+e+"]"),k.push(e))}return a};c.prototype.highlight=
function(a){var b="string"!==typeof a?this.keyword:a;if(""==b)return!0;if(0==this.$elements.length)return this.options.debug&&this.options.log.debug("No search context provided"),!1;this.$elements=this.$elements.filter("*:not([data-jmHighlight])");a=this.options.separateWordSearch;if("boolean"===typeof a&&a&&(a=b.split(" "),1<a.length)){this.options.debug&&this.options.log.debug("Highlighting keywords separately");for(var b=0,d=a.length;b<d;b++)if(!this.highlight(a[b]))return!1;return!0}this.options.debug&&
(this.options.log.debug("Highlighting keyword '"+b+"' in elements:"),this.options.log.debug(this.$elements));a=this.getKeywordRegexp(b);for(var b=new RegExp(a,"mi"),d=this.getTextNodes(this.$elements),c=0,f=d.length;c<f;c++){var g=d[c];if("object"===typeof g&&"string"===typeof g.nodeValue&&""!=g.nodeValue.trim()&&!1!==b.test(g.nodeValue)){this.options.debug&&this.options.log.debug("Regex: '"+a+"'. Node value: '"+g.nodeValue+"'");var e="<"+this.options.element+" class='"+this.options.className+"' data-jmHighlight='true'>",
h="</"+this.options.element+">";null!=g.parentNode&&(g.parentNode.innerHTML=g.parentNode.innerHTML.replace(new RegExp("((?![^<]*>)"+a+")","gim"),e+"$1"+h))}}return!0};c.prototype.removeHighlight=function(){if(0==this.$elements.length)return this.options.debug&&this.options.log.debug("No search context provided"),!1;this.options.debug&&("string"===typeof this.keyword&&""!=this.keyword?this.options.log.debug("Removing highlighting with keyword: '"+this.keyword+"'"):this.options.log.debug("Removing highlighting"));
var a=new RegExp(this.getKeywordRegexp(),"mi"),b=this.options.element+"[data-jmHighlight]."+this.options.className,c=this,e=this.$elements.filter(b);this.options.debug&&(this.options.log.debug(b),this.options.log.debug(e));e.each(function(){var b=d(this);if(a.test(b.text()))c.appendTextNodes(b,e);else return!0});return!0};c.prototype.appendTextNodes=function(a,b){if(0==a instanceof d||0==a.length)return!1;var c=a.first()[0],e=c.previousSibling,c=c.nextSibling,f=d(e),g=d(c),h=!1;0<f.length&&(3==e.nodeType?
(e.nodeValue+=a.text(),a.remove()):b instanceof d&&0<b.length&&b.is(f)?(f.replaceWith(a.text()+f.text()),a.remove()):a.replaceWith(a.text()),h=!0);0<g.length&&(3==c.nodeType?0==f.length?(c.nodeValue=a.text()+c.nodeValue,a.remove()):(c.nodeValue=f.text()+c.nodeValue,f.remove()):b instanceof d&&0<b.length&&b.is(g)?0==f.length?(g.replaceWith(g.text()+a.text()),a.remove()):(g.replaceWith(f.text()+g.text()),f.remove()):0==f.length&&a.replaceWith(a.text()),h=!0);0==h&&a.replaceWith(a.text());return!0};
d.fn.jmHighlight=function(a,b){return(new c(d(this),a,b)).highlight()};d.fn.jmRemoveHighlight=function(a,b){return(new c(d(this),b,a)).removeHighlight()}});
