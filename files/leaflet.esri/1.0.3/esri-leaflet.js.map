{"version":3,"sources":["../src/EsriLeaflet.js","../src/Util.js","../src/Request.js","../src/Services/Service.js","../src/Services/FeatureLayerService.js","../src/Services/MapService.js","../src/Services/ImageService.js","../src/Tasks/Task.js","../src/Tasks/Query.js","../src/Tasks/Find.js","../src/Tasks/Identify.js","../src/Tasks/IdentifyImage.js","../src/Tasks/IdentifyFeatures.js","../src/Layers/BasemapLayer.js","../src/Layers/RasterLayer.js","../src/Layers/DynamicMapLayer.js","../src/Layers/ImageMapLayer.js","../src/Layers/TiledMapLayer.js","../src/Layers/FeatureLayer/FeatureGrid.js","../src/Layers/FeatureLayer/FeatureManager.js","../src/Layers/FeatureLayer/FeatureLayer.js","../src/Controls/Logo.js"],"names":["EsriLeaflet","VERSION","Layers","Services","Controls","Tasks","Util","Support","CORS","window","XMLHttpRequest","pointerEvents","document","documentElement","style","L","esri","clone","obj","target","i","hasOwnProperty","pointsEqual","a","b","length","closeRing","coordinates","push","ringIsClockwise","ringToTest","pt2","total","rLength","pt1","vertexIntersectsVertex","a1","a2","b1","b2","uaT","ubT","uB","ua","ub","arrayIntersectsArray","j","coordinatesContainPoint","point","contains","l","coordinatesContainCoordinates","outer","inner","intersects","convertRingsToGeoJSON","rings","x","outerRing","hole","outerRings","holes","r","ring","slice","polygon","uncontainedHoles","pop","contained","reverse","type","orientRings","poly","output","shift","flattenMultiPolygonRings","raf","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","msRequestAnimationFrame","cb","setTimeout","extentToBounds","extent","sw","LatLng","ymin","xmin","ne","ymax","xmax","LatLngBounds","boundsToExtent","bounds","latLngBounds","getSouthWest","lng","lat","getNorthEast","spatialReference","wkid","arcgisToGeojson","arcgis","idAttribute","geojson","y","points","paths","geometry","attributes","properties","id","OBJECTID","FID","geojsonToArcGIS","result","features","geometries","responseToFeatureCollection","response","objectIdField","objectIdFieldName","fields","name","featureCollection","results","cleanUrl","url","replace","isArcgisOnline","test","geojsonTypeToArcGIS","geoJsonType","arcgisGeometryType","bind","warn","message","console","serialize","params","data","f","key","value","param","Object","prototype","toString","call","JSON","stringify","join","valueOf","encodeURIComponent","createRequest","callback","context","httpRequest","onerror","e","onreadystatechange","falseFn","error","code","readyState","parse","responseText","callbacks","_EsriLeafletCallbacks","Request","request","paramString","requestLength","open","send","get","JSONP","setRequestHeader","post","XMLHTTP","callbackId","script","DomUtil","create","body","src","responseType","abort","_callback","Service","Class","extend","includes","Mixin","Events","options","proxy","useCors","initialize","this","_requestQueue","_authenticating","setOptions","path","_request","metadata","authenticate","token","_runQueue","method","fire","wrappedCallback","_createServiceCallback","apply","service","FeatureLayerService","query","Query","addFeature","feature","addResults","undefined","updateFeature","updateResults","deleteFeature","objectIds","deleteResults","deleteFeatures","ids","featureLayerService","MapService","identify","identifyFeatures","find","Find","mapService","ImageService","IdentifyImage","imageService","Task","generateSetter","endpoint","_service","setters","setter","offset","limit","precision","featureIds","returnGeometry","where","outSr","outFields","within","_setGeometry","spatialRel","overlaps","nearby","latlng","radius","latLng","geometryType","units","distance","inSr","string","between","start","end","time","simplify","map","factor","mapWidth","Math","abs","getBounds","getWest","getEast","maxAllowableOffset","getSize","orderBy","fieldName","order","orderByFields","run","_cleanParams","_trapSQLerrors","count","returnCountOnly","returnIdsOnly","returnExtentOnly","pixelSize","layer","getLatLng","GeoJSON","getLayers","toGeoJSON","text","sr","layers","dynamicLayers","returnZ","returnM","gdbVersion","layerDefs","Identify","setMosaicRule","setRenderingRule","setPixelSize","returnCatalogItems","at","getMosaicRule","mosaicRule","getRenderingRule","renderingRule","getPixelSize","_responseToGeoJSON","location","catalogItems","catalogItemVisibilities","geoJSON","pixel","crs","objectId","Values","values","catalogItemVisibility","identifyImage","IdentifyFeatures","tolerance","on","size","imageDisplay","mapExtent","layerDef","layerId","tileProtocol","protocol","BasemapLayer","TileLayer","statics","TILES","Streets","urlTemplate","attributionUrl","hideLogo","logoPosition","minZoom","maxZoom","subdomains","attribution","Topographic","Oceans","OceansLabels","NationalGeographic","DarkGray","DarkGrayLabels","Gray","GrayLabels","Imagery","ImageryLabels","ImageryTransportation","ShadedRelief","ShadedReliefLabels","Terrain","TerrainLabels","config","Error","tileOptions","_getAttributionData","_logo","Logo","position","onAdd","_hasEsriLogo","addTo","_updateMapAttribution","onRemove","_container","removeControl","off","getAttribution","attributions","_attributions","c","contributors","contributor","coverageAreas","coverageArea","southWest","bbox","northEast","score","zoomMin","zoomMax","sort","_map","attributionControl","newAttributions","zoom","getZoom","match","substr","attributionElement","querySelector","innerHTML","maxWidth","basemapLayer","RasterLayer","opacity","_update","limitExecByInterval","updateInterval","split","bboxSR","imageSR","_currentImage","_bounds","equals","addLayer","removeLayer","_popup","_getPopupData","_resetPopupState","bindPopup","fn","popupOptions","_shouldRenderPopup","_lastClick","popup","_popupFunction","unbindPopup","closePopup","removeFrom","bringToFront","bringToBack","getOpacity","setOpacity","getTimeRange","from","to","setTimeRange","_renderImage","image","ImageOverlay","once","newImage","oldImage","_animatingZoom","_panTransition","_inProgress","_buildExportParams","_requestExport","_renderPopup","content","setLatLng","setContent","openOn","_propagateEvent","DynamicMapLayer","timeOptions","format","transparent","getDynamicLayers","setDynamicLayers","setLayers","getLayerDefs","setLayerDefs","getTimeOptions","setTimeOptions","identifyRequest","project","_northEast","_southWest","top","latLngToLayerPoint","bottom","dpi","href","getParamString","dynamicMapLayer","ImageMapLayer","setPixelType","pixelType","getPixelType","setBandIds","bandIds","isArray","getBandIds","setNoData","noData","noDataInterpretation","getNoData","getNoDataInterpretation","interpolation","compressionQuality","imageMapLayer","TiledMapLayer","zoomOffsetAllowance","correctZoomLevels","MercatorZoomLevels","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","tileUrl","getTileUrl","tilePoint","template","s","_getSubdomain","z","_lodMap","latestWkid","arcgisLODs","tileInfo","lods","correctResolutions","arcgisLOD","ci","correctRes","_withinPercentage","resolution","level","tokenQs","percentage","diff","tiledMapLayer","FeatureGrid","cellSize","addEventListener","getEvents","_reset","removeEventListener","_removeCells","events","viewreset","moveend","zoomend","_onZoom","hasLayer","_cells","_activeCells","_cellsToLoad","_cellsTotal","_resetWrap","infinite","_getCellSize","wrapLng","_wrapLng","floor","ceil","wrapLat","_wrapLat","getPixelBounds","cellPadding","topLeft","min","subtract","divideBy","max","cellBounds","add","_removeOtherCells","_addCells","coords","queue","center","getCenter","Point","cellsToLoad","distanceTo","_addCell","_cellCoordsToBounds","nwPoint","multiplyBy","sePoint","nw","unproject","wrap","se","_cellCoordsToKey","_keyToCellCoords","kArr","parseInt","_removeCell","cell","cellLeave","_wrapCoords","cellEnter","createCell","wrapNum","BinarySearchIndex","FeatureManager","timeField","timeFilterMode","simplifyFactor","oidCheck","_startTimeIndex","_endTimeIndex","_timeIndex","_cache","_currentSnapshot","_activeRequests","_pendingRequests","_requestFeatures","_buildQuery","exceededTransferLimit","_removed","_addFeatures","_postProcessFeatures","_cacheKey","_buildTimeIndexes","createLayers","setWhere","oldSnapshot","newSnapshot","pendingRequests","mostRecentError","requestCallback","removeLayers","addLayers","getWhere","oldFrom","oldTo","_filterExistingFeatures","refresh","redraw","eachFeature","_redraw","newFrom","newTo","layersToRemove","_getFeaturesInTimeRange","layersToAdd","indexOf","shouldRemoveLayer","splice","search","startTimes","endTimes","concat","startTimeEntries","endTimeEntries","Date","bulkAdd","timeEntries","_featureWithinTimeRange","date","startDate","endDate","_getMetadata","_metadata","_query","currentIndex","currentElement","resultIndex","minIndex","maxIndex","round","dirty","startIndex","endIndex","items","FeatureLayer","EVENTS","cacheLayers","_layers","_leafletIds","_key","random","_zooming","createNewLayer","geometryToLayer","pointToLayer","coordsToLatLng","_updateLayer","latlngs","coordsToLatLngs","setLatLngs","newLayer","_originalStyle","setStyle","_leaflet_id","_popupOptions","onEachFeature","resetStyle","permanent","cacheKey","cellKey","mapBounds","removable","setFeatureStyle","defaultOptions","Path","fill","popupContent","groupLayers","gLayer","getFeature","setIcon","getIcon","updatedIcon","icon","getStyle","updatedStyle","featureLayer","Control","marginTop","marginLeft","marginBottom","marginRight","div","_adjustLogo","_size","newSize","mapSize","logo"],"mappings":"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","file":"esri-leaflet.js","sourcesContent":["var EsriLeaflet = { //jshint ignore:line\n  VERSION: '1.0.3',\n  Layers: {},\n  Services: {},\n  Controls: {},\n  Tasks: {},\n  Util: {},\n  Support: {\n    CORS: !!(window.XMLHttpRequest && 'withCredentials' in new XMLHttpRequest()),\n    pointerEvents: document.documentElement.style.pointerEvents === ''\n  }\n};\n\nif(typeof window !== 'undefined' && window.L){\n  window.L.esri = EsriLeaflet;\n}\n","(function(EsriLeaflet){\n\n  // normalize request animation frame\n  var raf = window.requestAnimationFrame ||\n     window.webkitRequestAnimationFrame ||\n     window.mozRequestAnimationFrame ||\n     window.msRequestAnimationFrame ||\n     function(cb) { return window.setTimeout(cb, 1000 / 60); };\n\n  // shallow object clone for feature properties and attributes\n  // from http://jsperf.com/cloning-an-object/2\n  function clone(obj) {\n    var target = {};\n    for (var i in obj) {\n      if (obj.hasOwnProperty(i)) {\n        target[i] = obj[i];\n      }\n    }\n    return target;\n  }\n\n  // checks if 2 x,y points are equal\n  function pointsEqual(a, b) {\n    for (var i = 0; i < a.length; i++) {\n      if (a[i] !== b[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  // checks if the first and last points of a ring are equal and closes the ring\n  function closeRing(coordinates) {\n    if (!pointsEqual(coordinates[0], coordinates[coordinates.length - 1])) {\n      coordinates.push(coordinates[0]);\n    }\n    return coordinates;\n  }\n\n  // determine if polygon ring coordinates are clockwise. clockwise signifies outer ring, counter-clockwise an inner ring\n  // or hole. this logic was found at http://stackoverflow.com/questions/1165647/how-to-determine-if-a-list-of-polygon-\n  // points-are-in-clockwise-order\n  function ringIsClockwise(ringToTest) {\n    var total = 0,i = 0;\n    var rLength = ringToTest.length;\n    var pt1 = ringToTest[i];\n    var pt2;\n    for (i; i < rLength - 1; i++) {\n      pt2 = ringToTest[i + 1];\n      total += (pt2[0] - pt1[0]) * (pt2[1] + pt1[1]);\n      pt1 = pt2;\n    }\n    return (total >= 0);\n  }\n\n  // ported from terraformer.js https://github.com/Esri/Terraformer/blob/master/terraformer.js#L504-L519\n  function vertexIntersectsVertex(a1, a2, b1, b2) {\n    var uaT = (b2[0] - b1[0]) * (a1[1] - b1[1]) - (b2[1] - b1[1]) * (a1[0] - b1[0]);\n    var ubT = (a2[0] - a1[0]) * (a1[1] - b1[1]) - (a2[1] - a1[1]) * (a1[0] - b1[0]);\n    var uB  = (b2[1] - b1[1]) * (a2[0] - a1[0]) - (b2[0] - b1[0]) * (a2[1] - a1[1]);\n\n    if ( uB !== 0 ) {\n      var ua = uaT / uB;\n      var ub = ubT / uB;\n\n      if ( 0 <= ua && ua <= 1 && 0 <= ub && ub <= 1 ) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // ported from terraformer.js https://github.com/Esri/Terraformer/blob/master/terraformer.js#L521-L531\n  function arrayIntersectsArray(a, b) {\n    for (var i = 0; i < a.length - 1; i++) {\n      for (var j = 0; j < b.length - 1; j++) {\n        if (vertexIntersectsVertex(a[i], a[i + 1], b[j], b[j + 1])) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  // ported from terraformer.js https://github.com/Esri/Terraformer/blob/master/terraformer.js#L470-L480\n  function coordinatesContainPoint(coordinates, point) {\n    var contains = false;\n    for(var i = -1, l = coordinates.length, j = l - 1; ++i < l; j = i) {\n      if (((coordinates[i][1] <= point[1] && point[1] < coordinates[j][1]) ||\n           (coordinates[j][1] <= point[1] && point[1] < coordinates[i][1])) &&\n          (point[0] < (coordinates[j][0] - coordinates[i][0]) * (point[1] - coordinates[i][1]) / (coordinates[j][1] - coordinates[i][1]) + coordinates[i][0])) {\n        contains = !contains;\n      }\n    }\n    return contains;\n  }\n\n  // ported from terraformer-arcgis-parser.js https://github.com/Esri/terraformer-arcgis-parser/blob/master/terraformer-arcgis-parser.js#L106-L113\n  function coordinatesContainCoordinates(outer, inner){\n    var intersects = arrayIntersectsArray(outer, inner);\n    var contains = coordinatesContainPoint(outer, inner[0]);\n    if(!intersects && contains){\n      return true;\n    }\n    return false;\n  }\n\n  // do any polygons in this array contain any other polygons in this array?\n  // used for checking for holes in arcgis rings\n  // ported from terraformer-arcgis-parser.js https://github.com/Esri/terraformer-arcgis-parser/blob/master/terraformer-arcgis-parser.js#L117-L172\n  function convertRingsToGeoJSON(rings){\n    var outerRings = [];\n    var holes = [];\n    var x; // iterator\n    var outerRing; // current outer ring being evaluated\n    var hole; // current hole being evaluated\n\n    // for each ring\n    for (var r = 0; r < rings.length; r++) {\n      var ring = closeRing(rings[r].slice(0));\n      if(ring.length < 4){\n        continue;\n      }\n      // is this ring an outer ring? is it clockwise?\n      if(ringIsClockwise(ring)){\n        var polygon = [ ring ];\n        outerRings.push(polygon); // push to outer rings\n      } else {\n        holes.push(ring); // counterclockwise push to holes\n      }\n    }\n\n    var uncontainedHoles = [];\n\n    // while there are holes left...\n    while(holes.length){\n      // pop a hole off out stack\n      hole = holes.pop();\n\n      // loop over all outer rings and see if they contain our hole.\n      var contained = false;\n      for (x = outerRings.length - 1; x >= 0; x--) {\n        outerRing = outerRings[x][0];\n        if(coordinatesContainCoordinates(outerRing, hole)){\n          // the hole is contained push it into our polygon\n          outerRings[x].push(hole);\n          contained = true;\n          break;\n        }\n      }\n\n      // ring is not contained in any outer ring\n      // sometimes this happens https://github.com/Esri/esri-leaflet/issues/320\n      if(!contained){\n        uncontainedHoles.push(hole);\n      }\n    }\n\n    // if we couldn't match any holes using contains we can try intersects...\n    while(uncontainedHoles.length){\n      // pop a hole off out stack\n      hole = uncontainedHoles.pop();\n\n      // loop over all outer rings and see if any intersect our hole.\n      var intersects = false;\n      for (x = outerRings.length - 1; x >= 0; x--) {\n        outerRing = outerRings[x][0];\n        if(arrayIntersectsArray(outerRing, hole)){\n          // the hole is contained push it into our polygon\n          outerRings[x].push(hole);\n          intersects = true;\n          break;\n        }\n      }\n\n      if(!intersects) {\n        outerRings.push([hole.reverse()]);\n      }\n    }\n\n    if(outerRings.length === 1){\n      return {\n        type: 'Polygon',\n        coordinates: outerRings[0]\n      };\n    } else {\n      return {\n        type: 'MultiPolygon',\n        coordinates: outerRings\n      };\n    }\n  }\n\n  // This function ensures that rings are oriented in the right directions\n  // outer rings are clockwise, holes are counterclockwise\n  // used for converting GeoJSON Polygons to ArcGIS Polygons\n  function orientRings(poly){\n    var output = [];\n    var polygon = poly.slice(0);\n    var outerRing = closeRing(polygon.shift().slice(0));\n    if(outerRing.length >= 4){\n      if(!ringIsClockwise(outerRing)){\n        outerRing.reverse();\n      }\n\n      output.push(outerRing);\n\n      for (var i = 0; i < polygon.length; i++) {\n        var hole = closeRing(polygon[i].slice(0));\n        if(hole.length >= 4){\n          if(ringIsClockwise(hole)){\n            hole.reverse();\n          }\n          output.push(hole);\n        }\n      }\n    }\n\n    return output;\n  }\n\n  // This function flattens holes in multipolygons to one array of polygons\n  // used for converting GeoJSON Polygons to ArcGIS Polygons\n  function flattenMultiPolygonRings(rings){\n    var output = [];\n    for (var i = 0; i < rings.length; i++) {\n      var polygon = orientRings(rings[i]);\n      for (var x = polygon.length - 1; x >= 0; x--) {\n        var ring = polygon[x].slice(0);\n        output.push(ring);\n      }\n    }\n    return output;\n  }\n\n  // convert an extent (ArcGIS) to LatLngBounds (Leaflet)\n  EsriLeaflet.Util.extentToBounds = function(extent){\n    var sw = new L.LatLng(extent.ymin, extent.xmin);\n    var ne = new L.LatLng(extent.ymax, extent.xmax);\n    return new L.LatLngBounds(sw, ne);\n  };\n\n  // convert an LatLngBounds (Leaflet) to extent (ArcGIS)\n  EsriLeaflet.Util.boundsToExtent = function(bounds) {\n    bounds = L.latLngBounds(bounds);\n    return {\n      'xmin': bounds.getSouthWest().lng,\n      'ymin': bounds.getSouthWest().lat,\n      'xmax': bounds.getNorthEast().lng,\n      'ymax': bounds.getNorthEast().lat,\n      'spatialReference': {\n        'wkid' : 4326\n      }\n    };\n  };\n\n  EsriLeaflet.Util.arcgisToGeojson = function (arcgis, idAttribute){\n    var geojson = {};\n\n    if(typeof arcgis.x === 'number' && typeof arcgis.y === 'number'){\n      geojson.type = 'Point';\n      geojson.coordinates = [arcgis.x, arcgis.y];\n    }\n\n    if(arcgis.points){\n      geojson.type = 'MultiPoint';\n      geojson.coordinates = arcgis.points.slice(0);\n    }\n\n    if(arcgis.paths) {\n      if(arcgis.paths.length === 1){\n        geojson.type = 'LineString';\n        geojson.coordinates = arcgis.paths[0].slice(0);\n      } else {\n        geojson.type = 'MultiLineString';\n        geojson.coordinates = arcgis.paths.slice(0);\n      }\n    }\n\n    if(arcgis.rings) {\n      geojson = convertRingsToGeoJSON(arcgis.rings.slice(0));\n    }\n\n    if(arcgis.geometry || arcgis.attributes) {\n      geojson.type = 'Feature';\n      geojson.geometry = (arcgis.geometry) ? EsriLeaflet.Util.arcgisToGeojson(arcgis.geometry) : null;\n      geojson.properties = (arcgis.attributes) ? clone(arcgis.attributes) : null;\n      if(arcgis.attributes) {\n        geojson.id =  arcgis.attributes[idAttribute] || arcgis.attributes.OBJECTID || arcgis.attributes.FID;\n      }\n    }\n\n    return geojson;\n  };\n\n  // GeoJSON -> ArcGIS\n  EsriLeaflet.Util.geojsonToArcGIS = function(geojson, idAttribute){\n    idAttribute = idAttribute || 'OBJECTID';\n    var spatialReference = { wkid: 4326 };\n    var result = {};\n    var i;\n\n    switch(geojson.type){\n    case 'Point':\n      result.x = geojson.coordinates[0];\n      result.y = geojson.coordinates[1];\n      result.spatialReference = spatialReference;\n      break;\n    case 'MultiPoint':\n      result.points = geojson.coordinates.slice(0);\n      result.spatialReference = spatialReference;\n      break;\n    case 'LineString':\n      result.paths = [geojson.coordinates.slice(0)];\n      result.spatialReference = spatialReference;\n      break;\n    case 'MultiLineString':\n      result.paths = geojson.coordinates.slice(0);\n      result.spatialReference = spatialReference;\n      break;\n    case 'Polygon':\n      result.rings = orientRings(geojson.coordinates.slice(0));\n      result.spatialReference = spatialReference;\n      break;\n    case 'MultiPolygon':\n      result.rings = flattenMultiPolygonRings(geojson.coordinates.slice(0));\n      result.spatialReference = spatialReference;\n      break;\n    case 'Feature':\n      if(geojson.geometry) {\n        result.geometry = EsriLeaflet.Util.geojsonToArcGIS(geojson.geometry, idAttribute);\n      }\n      result.attributes = (geojson.properties) ? clone(geojson.properties) : {};\n      if(geojson.id){\n        result.attributes[idAttribute] = geojson.id;\n      }\n      break;\n    case 'FeatureCollection':\n      result = [];\n      for (i = 0; i < geojson.features.length; i++){\n        result.push(EsriLeaflet.Util.geojsonToArcGIS(geojson.features[i], idAttribute));\n      }\n      break;\n    case 'GeometryCollection':\n      result = [];\n      for (i = 0; i < geojson.geometries.length; i++){\n        result.push(EsriLeaflet.Util.geojsonToArcGIS(geojson.geometries[i], idAttribute));\n      }\n      break;\n    }\n\n    return result;\n  };\n\n  EsriLeaflet.Util.responseToFeatureCollection = function(response, idAttribute){\n    var objectIdField;\n\n    if(idAttribute){\n      objectIdField = idAttribute;\n    } else if(response.objectIdFieldName){\n      objectIdField = response.objectIdFieldName;\n    } else if(response.fields) {\n      for (var j = 0; j <= response.fields.length - 1; j++) {\n        if(response.fields[j].type === 'esriFieldTypeOID') {\n          objectIdField = response.fields[j].name;\n          break;\n        }\n      }\n    } else {\n      objectIdField = 'OBJECTID';\n    }\n\n    var featureCollection = {\n      type: 'FeatureCollection',\n      features: []\n    };\n    var features = response.features || response.results;\n    if(features.length){\n      for (var i = features.length - 1; i >= 0; i--) {\n        featureCollection.features.push(EsriLeaflet.Util.arcgisToGeojson(features[i], objectIdField));\n      }\n    }\n\n    return featureCollection;\n  };\n\n    // trim url whitespace and add a trailing slash if needed\n  EsriLeaflet.Util.cleanUrl = function(url){\n    //trim leading and trailing spaces, but not spaces inside the url\n    url = url.replace(/^\\s+|\\s+$|\\A\\s+|\\s+\\z/g, '');\n\n    //add a trailing slash to the url if the user omitted it\n    if(url[url.length-1] !== '/'){\n      url += '/';\n    }\n\n    return url;\n  };\n\n  EsriLeaflet.Util.isArcgisOnline = function(url){\n    /* hosted feature services can emit geojson natively.\n    our check for 'geojson' support will need to be revisted\n    once the functionality makes its way to ArcGIS Server*/\n    return (/\\.arcgis\\.com.*?FeatureServer/g).test(url);\n  };\n\n  EsriLeaflet.Util.geojsonTypeToArcGIS = function (geoJsonType) {\n    var arcgisGeometryType;\n    switch (geoJsonType) {\n    case 'Point':\n      arcgisGeometryType = 'esriGeometryPoint';\n      break;\n    case 'MultiPoint':\n      arcgisGeometryType = 'esriGeometryMultipoint';\n      break;\n    case 'LineString':\n      arcgisGeometryType = 'esriGeometryPolyline';\n      break;\n    case 'MultiLineString':\n      arcgisGeometryType = 'esriGeometryPolyline';\n      break;\n    case 'Polygon':\n      arcgisGeometryType = 'esriGeometryPolygon';\n      break;\n    case 'MultiPolygon':\n      arcgisGeometryType = 'esriGeometryPolygon';\n      break;\n    }\n    return arcgisGeometryType;\n  };\n\n  EsriLeaflet.Util.requestAnimationFrame = L.Util.bind(raf, window);\n\n  EsriLeaflet.Util.warn = function (message) {\n    if(console && console.warn) {\n      console.warn(message);\n    }\n  };\n\n})(EsriLeaflet);","(function(EsriLeaflet){\n\n  var callbacks = 0;\n\n  window._EsriLeafletCallbacks = {};\n\n  function serialize(params){\n    var data = '';\n\n    params.f = params.f || 'json';\n\n    for (var key in params){\n      if(params.hasOwnProperty(key)){\n        var param = params[key];\n        var type = Object.prototype.toString.call(param);\n        var value;\n\n        if(data.length){\n          data += '&';\n        }\n\n        if (type === '[object Array]'){\n          value = (Object.prototype.toString.call(param[0]) === '[object Object]') ? JSON.stringify(param) : param.join(',');\n        } else if (type === '[object Object]') {\n          value = JSON.stringify(param);\n        } else if (type === '[object Date]'){\n          value = param.valueOf();\n        } else {\n          value = param;\n        }\n\n        data += encodeURIComponent(key) + '=' + encodeURIComponent(value);\n      }\n    }\n\n    return data;\n  }\n\n  function createRequest(callback, context){\n    var httpRequest = new XMLHttpRequest();\n\n    httpRequest.onerror = function(e) {\n      httpRequest.onreadystatechange = L.Util.falseFn;\n\n      callback.call(context, {\n        error: {\n          code: 500,\n          message: 'XMLHttpRequest error'\n        }\n      }, null);\n    };\n\n    httpRequest.onreadystatechange = function(){\n      var response;\n      var error;\n\n      if (httpRequest.readyState === 4) {\n        try {\n          response = JSON.parse(httpRequest.responseText);\n        } catch(e) {\n          response = null;\n          error = {\n            code: 500,\n            message: 'Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error.'\n          };\n        }\n\n        if (!error && response.error) {\n          error = response.error;\n          response = null;\n        }\n\n        httpRequest.onerror = L.Util.falseFn;\n\n        callback.call(context, error, response);\n      }\n    };\n\n    return httpRequest;\n  }\n\n  // AJAX handlers for CORS (modern browsers) or JSONP (older browsers)\n  EsriLeaflet.Request = {\n    request: function(url, params, callback, context){\n      var paramString = serialize(params);\n      var httpRequest = createRequest(callback, context);\n      var requestLength = (url + '?' + paramString).length;\n\n      // request is less then 2000 characters and the browser supports CORS, make GET request with XMLHttpRequest\n      if(requestLength <= 2000 && L.esri.Support.CORS){\n        httpRequest.open('GET', url + '?' + paramString);\n        httpRequest.send(null);\n\n      // request is less more then 2000 characters and the browser supports CORS, make POST request with XMLHttpRequest\n      } else if (requestLength > 2000 && L.esri.Support.CORS){\n        httpRequest.open('POST', url);\n        httpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n        httpRequest.send(paramString);\n\n      // request is less more then 2000 characters and the browser does not support CORS, make a JSONP request\n      } else if(requestLength <= 2000 && !L.esri.Support.CORS){\n        return L.esri.Request.get.JSONP(url, params, callback, context);\n\n      // request is longer then 2000 characters and the browser does not support CORS, log a warning\n      } else {\n        EsriLeaflet.Util.warn('a request to ' + url + ' was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy http://esri.github.io/esri-leaflet/api-reference/request.html');\n        return;\n      }\n\n      return httpRequest;\n    },\n\n    post: {\n      XMLHTTP: function (url, params, callback, context) {\n        var httpRequest = createRequest(callback, context);\n        httpRequest.open('POST', url);\n        httpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n        httpRequest.send(serialize(params));\n\n        return httpRequest;\n      }\n    },\n\n    get: {\n      CORS: function (url, params, callback, context) {\n        var httpRequest = createRequest(callback, context);\n\n        httpRequest.open('GET', url + '?' + serialize(params), true);\n        httpRequest.send(null);\n\n        return httpRequest;\n      },\n      JSONP: function(url, params, callback, context){\n        var callbackId = 'c' + callbacks;\n\n        params.callback = 'window._EsriLeafletCallbacks.' + callbackId;\n\n        var script = L.DomUtil.create('script', null, document.body);\n        script.type = 'text/javascript';\n        script.src = url + '?' +  serialize(params);\n        script.id = callbackId;\n\n        window._EsriLeafletCallbacks[callbackId] = function(response){\n          if(window._EsriLeafletCallbacks[callbackId] !== true){\n            var error;\n            var responseType = Object.prototype.toString.call(response);\n\n            if(!(responseType === '[object Object]' || responseType === '[object Array]')){\n              error = {\n                error: {\n                  code: 500,\n                  message: 'Expected array or object as JSONP response'\n                }\n              };\n              response = null;\n            }\n\n            if (!error && response.error) {\n              error = response;\n              response = null;\n            }\n\n            callback.call(context, error, response);\n            window._EsriLeafletCallbacks[callbackId] = true;\n          }\n        };\n\n        callbacks++;\n\n        return {\n          id: callbackId,\n          url: script.src,\n          abort: function(){\n            window._EsriLeafletCallbacks._callback[callbackId]({\n              code: 0,\n              message: 'Request aborted.'\n            });\n          }\n        };\n      }\n    }\n  };\n\n  // choose the correct AJAX handler depending on CORS support\n  EsriLeaflet.get = (EsriLeaflet.Support.CORS) ? EsriLeaflet.Request.get.CORS : EsriLeaflet.Request.get.JSONP;\n\n  // always use XMLHttpRequest for posts\n  EsriLeaflet.post = EsriLeaflet.Request.post.XMLHTTP;\n\n  // expose a common request method the uses GET\\POST based on request length\n  EsriLeaflet.request = EsriLeaflet.Request.request;\n\n})(EsriLeaflet);","EsriLeaflet.Services.Service = L.Class.extend({\n\n  includes: L.Mixin.Events,\n\n  options: {\n    proxy: false,\n    useCors: EsriLeaflet.Support.CORS\n  },\n\n  initialize: function (options) {\n    options = options || {};\n    this._requestQueue = [];\n    this._authenticating = false;\n    L.Util.setOptions(this, options);\n    this.options.url = EsriLeaflet.Util.cleanUrl(this.options.url);\n  },\n\n  get: function (path, params, callback, context) {\n    return this._request('get', path, params, callback, context);\n  },\n\n  post: function (path, params, callback, context) {\n    return this._request('post', path, params, callback, context);\n  },\n\n  request: function (path, params, callback, context) {\n    return this._request('request', path, params, callback, context);\n  },\n\n  metadata: function (callback, context) {\n    return this._request('get', '', {}, callback, context);\n  },\n\n  authenticate: function(token){\n    this._authenticating = false;\n    this.options.token = token;\n    this._runQueue();\n    return this;\n  },\n\n  _request: function(method, path, params, callback, context){\n    this.fire('requeststart', {\n      url: this.options.url + path,\n      params: params,\n      method: method\n    });\n\n    var wrappedCallback = this._createServiceCallback(method, path, params, callback, context);\n\n    if (this.options.token) {\n      params.token = this.options.token;\n    }\n\n    if (this._authenticating) {\n      this._requestQueue.push([method, path, params, callback, context]);\n      return;\n    } else {\n      var url = (this.options.proxy) ? this.options.proxy + '?' + this.options.url + path : this.options.url + path;\n\n      if((method === 'get' || method === 'request') && !this.options.useCors){\n        return EsriLeaflet.Request.get.JSONP(url, params, wrappedCallback);\n      } else {\n        return EsriLeaflet[method](url, params, wrappedCallback);\n      }\n    }\n  },\n\n  _createServiceCallback: function(method, path, params, callback, context){\n    return L.Util.bind(function(error, response){\n\n      if (error && (error.code === 499 || error.code === 498)) {\n        this._authenticating = true;\n\n        this._requestQueue.push([method, path, params, callback, context]);\n\n        // fire an event for users to handle and re-authenticate\n        this.fire('authenticationrequired', {\n          authenticate: L.Util.bind(this.authenticate, this)\n        });\n\n        // if the user has access to a callback they can handle the auth error\n        error.authenticate = L.Util.bind(this.authenticate, this);\n      }\n\n      callback.call(context, error, response);\n\n      if(error) {\n        this.fire('requesterror', {\n          url: this.options.url + path,\n          params: params,\n          message: error.message,\n          code: error.code,\n          method: method\n        });\n      } else {\n        this.fire('requestsuccess', {\n          url: this.options.url + path,\n          params: params,\n          response: response,\n          method: method\n        });\n      }\n\n      this.fire('requestend', {\n        url: this.options.url + path,\n        params: params,\n        method: method\n      });\n    }, this);\n  },\n\n  _runQueue: function(){\n    for (var i = this._requestQueue.length - 1; i >= 0; i--) {\n      var request = this._requestQueue[i];\n      var method = request.shift();\n      this[method].apply(this, request);\n    }\n    this._requestQueue = [];\n  }\n\n});\n\nEsriLeaflet.Services.service = function(params){\n  return new EsriLeaflet.Services.Service(params);\n};\n","EsriLeaflet.Services.FeatureLayerService = EsriLeaflet.Services.Service.extend({\n\n  options: {\n    idAttribute: 'OBJECTID'\n  },\n\n  query: function(){\n    return new EsriLeaflet.Tasks.Query(this);\n  },\n\n  addFeature: function(feature, callback, context) {\n    delete feature.id;\n\n    feature = EsriLeaflet.Util.geojsonToArcGIS(feature);\n\n    return this.post('addFeatures', {\n      features: [feature]\n    }, function(error, response){\n      var result = (response && response.addResults) ? response.addResults[0] : undefined;\n      if(callback){\n        callback.call(context, error || response.addResults[0].error, result);\n      }\n    }, context);\n  },\n\n  updateFeature: function(feature, callback, context) {\n    feature = EsriLeaflet.Util.geojsonToArcGIS(feature, this.options.idAttribute);\n\n    return this.post('updateFeatures', {\n      features: [feature]\n    }, function(error, response){\n      var result = (response && response.updateResults) ? response.updateResults[0] : undefined;\n      if(callback){\n        callback.call(context, error || response.updateResults[0].error, result);\n      }\n    }, context);\n  },\n\n  deleteFeature: function(id, callback, context) {\n    return this.post('deleteFeatures', {\n      objectIds: id\n    }, function(error, response){\n      var result = (response && response.deleteResults) ? response.deleteResults[0] : undefined;\n      if(callback){\n        callback.call(context, error || response.deleteResults[0].error, result);\n      }\n    }, context);\n  },\n\n  deleteFeatures: function(ids, callback, context) {\n    return this.post('deleteFeatures', {\n      objectIds: ids\n    }, function(error, response){\n      // pass back the entire array\n      var result = (response && response.deleteResults) ? response.deleteResults : undefined;\n      if(callback){\n        callback.call(context, error || response.deleteResults[0].error, result);\n      }\n    }, context);\n  }\n});\n\nEsriLeaflet.Services.featureLayerService = function(options) {\n  return new EsriLeaflet.Services.FeatureLayerService(options);\n};\n","EsriLeaflet.Services.MapService = EsriLeaflet.Services.Service.extend({\n\n  identify: function () {\n    return new EsriLeaflet.Tasks.identifyFeatures(this);\n  },\n\n  find: function () {\n    return new EsriLeaflet.Tasks.Find(this);\n  },\n\n  query: function () {\n    return new EsriLeaflet.Tasks.Query(this);\n  }\n\n});\n\nEsriLeaflet.Services.mapService = function(params){\n  return new EsriLeaflet.Services.MapService(params);\n};","EsriLeaflet.Services.ImageService = EsriLeaflet.Services.Service.extend({\n\n  query: function () {\n    return new EsriLeaflet.Tasks.Query(this);\n  },\n\n  identify: function() {\n    return new EsriLeaflet.Tasks.IdentifyImage(this);\n  }\n});\n\nEsriLeaflet.Services.imageService = function(params){\n  return new EsriLeaflet.Services.ImageService(params);\n};","EsriLeaflet.Tasks.Task = L.Class.extend({\n\n  options: {\n    proxy: false,\n    useCors: EsriLeaflet.Support.CORS\n  },\n\n  //Generate a method for each methodName:paramName in the setters for this task.\n  generateSetter: function(param, context){\n    return L.Util.bind(function(value){\n      this.params[param] = value;\n      return this;\n    }, context);\n  },\n\n  initialize: function(endpoint){\n    // endpoint can be either a url (and options) for an ArcGIS Rest Service or an instance of EsriLeaflet.Service\n    if(endpoint.request && endpoint.options){\n      this._service = endpoint;\n      L.Util.setOptions(this, endpoint.options);\n    } else {\n      L.Util.setOptions(this, endpoint);\n      this.options.url = L.esri.Util.cleanUrl(endpoint.url);\n    }\n\n    // clone default params into this object\n    this.params = L.Util.extend({}, this.params || {});\n\n    // generate setter methods based on the setters object implimented a child class\n    if(this.setters){\n      for (var setter in this.setters){\n        var param = this.setters[setter];\n        this[setter] = this.generateSetter(param, this);\n      }\n    }\n  },\n\n  token: function(token){\n    if(this._service){\n      this._service.authenticate(token);\n    } else {\n      this.params.token = token;\n    }\n    return this;\n  },\n\n  request: function(callback, context){\n    if(this._service){\n      return this._service.request(this.path, this.params, callback, context);\n    } else {\n      return this._request('request', this.path, this.params, callback, context);\n    }\n  },\n\n  _request: function(method, path, params, callback, context){\n    var url = (this.options.proxy) ? this.options.proxy + '?' + this.options.url + path : this.options.url + path;\n    if((method === 'get' || method === 'request') && !this.options.useCors){\n      return EsriLeaflet.Request.get.JSONP(url, params, callback, context);\n    } else{\n      return EsriLeaflet[method](url, params, callback, context);\n    }\n  }\n});","EsriLeaflet.Tasks.Query = EsriLeaflet.Tasks.Task.extend({\n  setters: {\n    'offset': 'offset',\n    'limit': 'limit',\n    'fields': 'outFields',\n    'precision': 'geometryPrecision',\n    'featureIds': 'objectIds',\n    'returnGeometry': 'returnGeometry',\n    'token': 'token'\n  },\n\n  path: 'query',\n\n  params: {\n    returnGeometry: true,\n    where: '1=1',\n    outSr: 4326,\n    outFields: '*'\n  },\n\n  within: function(geometry){\n    this._setGeometry(geometry);\n    this.params.spatialRel = 'esriSpatialRelContains'; // will make code read layer within geometry, to the api this will reads geometry contains layer\n    return this;\n  },\n\n  intersects: function(geometry){\n    this._setGeometry(geometry);\n    this.params.spatialRel = 'esriSpatialRelIntersects';\n    return this;\n  },\n\n  contains: function(geometry){\n    this._setGeometry(geometry);\n    this.params.spatialRel = 'esriSpatialRelWithin'; // will make code read layer contains geometry, to the api this will reads geometry within layer\n    return this;\n  },\n\n  // crosses: function(geometry){\n  //   this._setGeometry(geometry);\n  //   this.params.spatialRel = 'esriSpatialRelCrosses';\n  //   return this;\n  // },\n\n  // touches: function(geometry){\n  //   this._setGeometry(geometry);\n  //   this.params.spatialRel = 'esriSpatialRelTouches';\n  //   return this;\n  // },\n\n  overlaps: function(geometry){\n    this._setGeometry(geometry);\n    this.params.spatialRel = 'esriSpatialRelOverlaps';\n    return this;\n  },\n\n  // only valid for Feature Services running on ArcGIS Server 10.3 or ArcGIS Online\n  nearby: function(latlng, radius){\n    latlng = L.latLng(latlng);\n    this.params.geometry = [latlng.lng, latlng.lat];\n    this.params.geometryType = 'esriGeometryPoint';\n    this.params.spatialRel = 'esriSpatialRelIntersects';\n    this.params.units = 'esriSRUnit_Meter';\n    this.params.distance = radius;\n    this.params.inSr = 4326;\n    return this;\n  },\n\n  where: function(string){\n    // instead of converting double-quotes to single quotes, pass as is, and provide a more informative message if a 400 is encountered\n    this.params.where = string;\n    return this;\n  },\n\n  between: function(start, end){\n    this.params.time = [start.valueOf(), end.valueOf()];\n    return this;\n  },\n\n  simplify: function(map, factor){\n    var mapWidth = Math.abs(map.getBounds().getWest() - map.getBounds().getEast());\n    this.params.maxAllowableOffset = (mapWidth / map.getSize().y) * factor;\n    return this;\n  },\n\n  orderBy: function(fieldName, order){\n    order = order || 'ASC';\n    this.params.orderByFields = (this.params.orderByFields) ? this.params.orderByFields + ',' : '';\n    this.params.orderByFields += ([fieldName, order]).join(' ');\n    return this;\n  },\n\n  run: function(callback, context){\n    this._cleanParams();\n\n    // if the service is hosted on arcgis online request geojson directly\n    if(EsriLeaflet.Util.isArcgisOnline(this.options.url)){\n      this.params.f = 'geojson';\n\n      return this.request(function(error, response){\n        this._trapSQLerrors(error);\n        callback.call(context, error, response, response);\n      }, this);\n\n    // otherwise convert it in the callback then pass it on\n    } else {\n      return this.request(function(error, response){\n        this._trapSQLerrors(error);\n        callback.call(context, error, (response && EsriLeaflet.Util.responseToFeatureCollection(response)), response);\n      }, this);\n    }\n  },\n\n  count: function(callback, context){\n    this._cleanParams();\n    this.params.returnCountOnly = true;\n    return this.request(function(error, response){\n      callback.call(this, error, (response && response.count), response);\n    }, context);\n  },\n\n  ids: function(callback, context){\n    this._cleanParams();\n    this.params.returnIdsOnly = true;\n    return this.request(function(error, response){\n      callback.call(this, error, (response && response.objectIds), response);\n    }, context);\n  },\n\n  // only valid for Feature Services running on ArcGIS Server 10.3 or ArcGIS Online\n  bounds: function(callback, context){\n    this._cleanParams();\n    this.params.returnExtentOnly = true;\n    return this.request(function(error, response){\n      callback.call(context, error, (response && response.extent && EsriLeaflet.Util.extentToBounds(response.extent)), response);\n    }, context);\n  },\n\n  // only valid for image services\n  pixelSize: function(point){\n    point = L.point(point);\n    this.params.pixelSize = [point.x,point.y];\n    return this;\n  },\n\n  // only valid for map services\n  layer: function(layer){\n    this.path = layer + '/query';\n    return this;\n  },\n\n  _trapSQLerrors: function(error){\n    if (error){\n      if (error.code === '400'){\n        EsriLeaflet.Util.warn('one common syntax error in query requests is encasing string values in double quotes instead of single quotes');\n      }\n    }\n  },\n\n  _cleanParams: function(){\n    delete this.params.returnIdsOnly;\n    delete this.params.returnExtentOnly;\n    delete this.params.returnCountOnly;\n  },\n\n  _setGeometry: function(geometry) {\n    this.params.inSr = 4326;\n\n    // convert bounds to extent and finish\n    if ( geometry instanceof L.LatLngBounds ) {\n      // set geometry + geometryType\n      this.params.geometry = EsriLeaflet.Util.boundsToExtent(geometry);\n      this.params.geometryType = 'esriGeometryEnvelope';\n      return;\n    }\n\n    // convert L.Marker > L.LatLng\n    if(geometry.getLatLng){\n      geometry = geometry.getLatLng();\n    }\n\n    // convert L.LatLng to a geojson point and continue;\n    if (geometry instanceof L.LatLng) {\n      geometry = {\n        type: 'Point',\n        coordinates: [geometry.lng, geometry.lat]\n      };\n    }\n\n    // handle L.GeoJSON, pull out the first geometry\n    if ( geometry instanceof L.GeoJSON ) {\n      //reassign geometry to the GeoJSON value  (we are assuming that only one feature is present)\n      geometry = geometry.getLayers()[0].feature.geometry;\n      this.params.geometry = EsriLeaflet.Util.geojsonToArcGIS(geometry);\n      this.params.geometryType = EsriLeaflet.Util.geojsonTypeToArcGIS(geometry.type);\n    }\n\n    // Handle L.Polyline and L.Polygon\n    if (geometry.toGeoJSON) {\n      geometry = geometry.toGeoJSON();\n    }\n\n    // handle GeoJSON feature by pulling out the geometry\n    if ( geometry.type === 'Feature' ) {\n      // get the geometry of the geojson feature\n      geometry = geometry.geometry;\n    }\n\n    // confirm that our GeoJSON is a point, line or polygon\n    if ( geometry.type === 'Point' ||  geometry.type === 'LineString' || geometry.type === 'Polygon') {\n      this.params.geometry = EsriLeaflet.Util.geojsonToArcGIS(geometry);\n      this.params.geometryType = EsriLeaflet.Util.geojsonTypeToArcGIS(geometry.type);\n      return;\n    }\n\n    // warn the user if we havn't found a\n    /* global console */\n    EsriLeaflet.Util.warn('invalid geometry passed to spatial query. Should be an L.LatLng, L.LatLngBounds or L.Marker or a GeoJSON Point Line or Polygon object');\n\n    return;\n  }\n});\n\nEsriLeaflet.Tasks.query = function(params){\n  return new EsriLeaflet.Tasks.Query(params);\n};","EsriLeaflet.Tasks.Find = EsriLeaflet.Tasks.Task.extend({\n  setters: {\n    // method name > param name\n    'contains': 'contains',\n    'text': 'searchText',\n    'fields': 'searchFields', // denote an array or single string\n    'spatialReference': 'sr',\n    'sr': 'sr',\n    'layers': 'layers',\n    'returnGeometry': 'returnGeometry',\n    'maxAllowableOffset': 'maxAllowableOffset',\n    'precision': 'geometryPrecision',\n    'dynamicLayers': 'dynamicLayers',\n    'returnZ' : 'returnZ',\n    'returnM' : 'returnM',\n    'gdbVersion' : 'gdbVersion',\n    'token' : 'token'\n  },\n\n  path: 'find',\n\n  params: {\n    sr: 4326,\n    contains: true,\n    returnGeometry: true,\n    returnZ: true,\n    returnM: false\n  },\n\n  layerDefs: function (id, where) {\n    this.params.layerDefs = (this.params.layerDefs) ? this.params.layerDefs + ';' : '';\n    this.params.layerDefs += ([id, where]).join(':');\n    return this;\n  },\n\n  simplify: function(map, factor){\n    var mapWidth = Math.abs(map.getBounds().getWest() - map.getBounds().getEast());\n    this.params.maxAllowableOffset = (mapWidth / map.getSize().y) * factor;\n    return this;\n  },\n\n  run: function (callback, context) {\n    return this.request(function(error, response){\n      callback.call(context, error, (response && EsriLeaflet.Util.responseToFeatureCollection(response)), response);\n    }, context);\n  }\n});\n\nEsriLeaflet.Tasks.find = function (params) {\n  return new EsriLeaflet.Tasks.Find(params);\n};","EsriLeaflet.Tasks.Identify = EsriLeaflet.Tasks.Task.extend({\n  path: 'identify',\n\n  between: function(start, end){\n    this.params.time = [start.valueOf(), end.valueOf()];\n    return this;\n  }\n});\n","EsriLeaflet.Tasks.IdentifyImage = EsriLeaflet.Tasks.Identify.extend({\n  setters: {\n    'setMosaicRule': 'mosaicRule',\n    'setRenderingRule': 'renderingRule',\n    'setPixelSize': 'pixelSize',\n    'returnCatalogItems': 'returnCatalogItems',\n    'returnGeometry': 'returnGeometry'\n  },\n\n  params: {\n    returnGeometry: false\n  },\n\n  at: function(latlng){\n    latlng = L.latLng(latlng);\n    this.params.geometry = JSON.stringify({\n      x: latlng.lng,\n      y: latlng.lat,\n      spatialReference:{\n        wkid: 4326\n      }\n    });\n    this.params.geometryType = 'esriGeometryPoint';\n    return this;\n  },\n\n  getMosaicRule: function() {\n    return this.params.mosaicRule;\n  },\n\n  getRenderingRule: function() {\n    return this.params.renderingRule;\n  },\n\n  getPixelSize: function() {\n    return this.params.pixelSize;\n  },\n\n  run: function (callback, context){\n    return this.request(function(error, response){\n      callback.call(context, error, (response && this._responseToGeoJSON(response)), response);\n    }, this);\n  },\n\n  // get pixel data and return as geoJSON point\n  // populate catalog items (if any)\n  // merging in any catalogItemVisibilities as a propery of each feature\n  _responseToGeoJSON: function(response) {\n    var location = response.location;\n    var catalogItems = response.catalogItems;\n    var catalogItemVisibilities = response.catalogItemVisibilities;\n    var geoJSON =  {\n      'pixel': {\n        'type': 'Feature',\n        'geometry': {\n          'type': 'Point',\n          'coordinates': [location.x, location.y]\n        },\n        'crs': {\n          'type': 'EPSG',\n          'properties': {\n            'code': location.spatialReference.wkid\n          }\n        },\n        'properties': {\n          'OBJECTID': response.objectId,\n          'name': response.name,\n          'value': response.value\n        },\n        'id': response.objectId\n      }\n    };\n    if (response.properties && response.properties.Values) {\n      geoJSON.pixel.properties.values = response.properties.Values;\n    }\n    if (catalogItems && catalogItems.features) {\n      geoJSON.catalogItems = EsriLeaflet.Util.responseToFeatureCollection(catalogItems);\n      if (catalogItemVisibilities && catalogItemVisibilities.length === geoJSON.catalogItems.features.length) {\n        for (var i = catalogItemVisibilities.length - 1; i >= 0; i--) {\n          geoJSON.catalogItems.features[i].properties.catalogItemVisibility = catalogItemVisibilities[i];\n        }\n      }\n    }\n    return geoJSON;\n  }\n\n});\n\nEsriLeaflet.Tasks.identifyImage = function(params){\n  return new EsriLeaflet.Tasks.IdentifyImage(params);\n};","EsriLeaflet.Tasks.IdentifyFeatures = EsriLeaflet.Tasks.Identify.extend({\n  setters: {\n    'layers': 'layers',\n    'precision': 'geometryPrecision',\n    'tolerance': 'tolerance',\n    'returnGeometry': 'returnGeometry'\n  },\n\n  params: {\n    sr: 4326,\n    layers: 'all',\n    tolerance: 3,\n    returnGeometry: true\n  },\n\n  on: function(map){\n    var extent = EsriLeaflet.Util.boundsToExtent(map.getBounds());\n    var size = map.getSize();\n    this.params.imageDisplay = [size.x, size.y, 96];\n    this.params.mapExtent = [extent.xmin, extent.ymin, extent.xmax, extent.ymax];\n    return this;\n  },\n\n  at: function(latlng){\n    latlng = L.latLng(latlng);\n    this.params.geometry = [latlng.lng, latlng.lat];\n    this.params.geometryType = 'esriGeometryPoint';\n    return this;\n  },\n\n  layerDef: function (id, where){\n    this.params.layerDefs = (this.params.layerDefs) ? this.params.layerDefs + ';' : '';\n    this.params.layerDefs += ([id, where]).join(':');\n    return this;\n  },\n\n  simplify: function(map, factor){\n    var mapWidth = Math.abs(map.getBounds().getWest() - map.getBounds().getEast());\n    this.params.maxAllowableOffset = (mapWidth / map.getSize().y) * (1 - factor);\n    return this;\n  },\n\n  run: function (callback, context){\n    return this.request(function(error, response){\n      // immediately invoke with an error\n      if(error) {\n        callback.call(context, error, undefined, response);\n        return;\n\n      // ok no error lets just assume we have features...\n      } else {\n        var featureCollection = EsriLeaflet.Util.responseToFeatureCollection(response);\n        response.results = response.results.reverse();\n        for (var i = 0; i < featureCollection.features.length; i++) {\n          var feature = featureCollection.features[i];\n          feature.layerId = response.results[i].layerId;\n        }\n        callback.call(context, undefined, featureCollection, response);\n      }\n    });\n  }\n});\n\nEsriLeaflet.Tasks.identifyFeatures = function(params){\n  return new EsriLeaflet.Tasks.IdentifyFeatures(params);\n};","(function(EsriLeaflet){\n\n  var tileProtocol = (window.location.protocol !== 'https:') ? 'http:' : 'https:';\n\n  EsriLeaflet.Layers.BasemapLayer = L.TileLayer.extend({\n    statics: {\n      TILES: {\n        Streets: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}',\n          attributionUrl: 'https://static.arcgis.com/attribution/World_Street_Map',\n          options: {\n            hideLogo: false,\n            logoPosition: 'bottomright',\n            minZoom: 1,\n            maxZoom: 19,\n            subdomains: ['server', 'services'],\n            attribution: 'Esri'\n          }\n        },\n        Topographic: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}',\n          attributionUrl: 'https://static.arcgis.com/attribution/World_Topo_Map',\n          options: {\n            hideLogo: false,\n            logoPosition: 'bottomright',\n            minZoom: 1,\n            maxZoom: 19,\n            subdomains: ['server', 'services'],\n            attribution: 'Esri'\n          }\n        },\n        Oceans: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}',\n          attributionUrl: 'https://static.arcgis.com/attribution/Ocean_Basemap',\n          options: {\n            hideLogo: false,\n            logoPosition: 'bottomright',\n            minZoom: 1,\n            maxZoom: 16,\n            subdomains: ['server', 'services'],\n            attribution: 'Esri'\n          }\n        },\n        OceansLabels: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: true,\n            logoPosition: 'bottomright',\n            //pane: 'esri-label',\n            minZoom: 1,\n            maxZoom: 16,\n            subdomains: ['server', 'services']\n          }\n        },\n        NationalGeographic: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: false,\n            logoPosition: 'bottomright',\n            minZoom: 1,\n            maxZoom: 16,\n            subdomains: ['server', 'services'],\n            attribution: 'Esri'\n          }\n        },\n        DarkGray: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: false,\n            logoPosition: 'bottomright',\n            minZoom: 1,\n            maxZoom: 16,\n            subdomains: ['server', 'services'],\n            attribution: 'Esri, DeLorme, HERE'\n          }\n        },\n        DarkGrayLabels: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: true,\n            logoPosition: 'bottomright',\n            //pane: 'esri-label',\n            minZoom: 1,\n            maxZoom: 16,\n            subdomains: ['server', 'services']\n          }\n        },\n        Gray: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: false,\n            logoPosition: 'bottomright',\n            minZoom: 1,\n            maxZoom: 16,\n            subdomains: ['server', 'services'],\n            attribution: 'Esri, NAVTEQ, DeLorme'\n          }\n        },\n        GrayLabels: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: true,\n            logoPosition: 'bottomright',\n            //pane: 'esri-label',\n            minZoom: 1,\n            maxZoom: 16,\n            subdomains: ['server', 'services']\n          }\n        },\n        Imagery: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: false,\n            logoPosition: 'bottomright',\n            minZoom: 1,\n            maxZoom: 19,\n            subdomains: ['server', 'services'],\n            attribution: 'Esri, DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community'\n          }\n        },\n        ImageryLabels: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: true,\n            logoPosition: 'bottomright',\n            //pane: 'esri-label',\n            minZoom: 1,\n            maxZoom: 19,\n            subdomains: ['server', 'services']\n          }\n        },\n        ImageryTransportation: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}',\n          //pane: 'esri-label',\n          options: {\n            hideLogo: true,\n            logoPosition: 'bottomright',\n            minZoom: 1,\n            maxZoom: 19,\n            subdomains: ['server', 'services']\n          }\n        },\n        ShadedRelief: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: false,\n            logoPosition: 'bottomright',\n            minZoom: 1,\n            maxZoom: 13,\n            subdomains: ['server', 'services'],\n            attribution: 'Esri, NAVTEQ, DeLorme'\n          }\n        },\n        ShadedReliefLabels: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: true,\n            logoPosition: 'bottomright',\n            //pane: 'esri-label',\n            minZoom: 1,\n            maxZoom: 12,\n            subdomains: ['server', 'services']\n          }\n        },\n        Terrain: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: false,\n            logoPosition: 'bottomright',\n            minZoom: 1,\n            maxZoom: 13,\n            subdomains: ['server', 'services'],\n            attribution: 'Esri, USGS, NOAA'\n          }\n        },\n        TerrainLabels: {\n          urlTemplate: tileProtocol + '//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}',\n          options: {\n            hideLogo: true,\n            logoPosition: 'bottomright',\n            //pane: 'esri-label',\n            minZoom: 1,\n            maxZoom: 13,\n            subdomains: ['server', 'services']\n          }\n        }\n      }\n    },\n    initialize: function(key, options){\n      var config;\n\n      // set the config variable with the appropriate config object\n      if (typeof key === 'object' && key.urlTemplate && key.options){\n        config = key;\n      } else if(typeof key === 'string' && EsriLeaflet.BasemapLayer.TILES[key]){\n        config = EsriLeaflet.BasemapLayer.TILES[key];\n      } else {\n        throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of \"Streets\", \"Topographic\", \"Oceans\", \"OceansLabels\", \"NationalGeographic\", \"Gray\", \"GrayLabels\", \"DarkGray\", \"DarkGrayLabels\", \"Imagery\", \"ImageryLabels\", \"ImageryTransportation\", \"ShadedRelief\", \"ShadedReliefLabels\", \"Terrain\" or \"TerrainLabels\"');\n      }\n\n      // merge passed options into the config options\n      var tileOptions = L.Util.extend(config.options, options);\n\n      // call the initialize method on L.TileLayer to set everything up\n      L.TileLayer.prototype.initialize.call(this, config.urlTemplate, L.Util.setOptions(this, tileOptions));\n\n      // if this basemap requires dynamic attribution set it up\n      if(config.attributionUrl){\n        this._getAttributionData(config.attributionUrl);\n      }\n      this._logo = new EsriLeaflet.Controls.Logo({\n        position: this.options.logoPosition\n      });\n    },\n    onAdd: function(map){\n      if(!this.options.hideLogo && !map._hasEsriLogo){\n        this._logo.addTo(map);\n        map._hasEsriLogo = true;\n      }\n\n      // if(this.options.pane && EsriLeaflet.Support.pointerEvents){\n      //   this._initPane();\n      // }\n\n      L.TileLayer.prototype.onAdd.call(this, map);\n\n      map.on('moveend', this._updateMapAttribution, this);\n    },\n    onRemove: function(map){\n      // check to make sure the logo hasn't already been removed\n      if(!map._hasEsriLogo && this._logo && this._logo._container){\n        map.removeControl(this._logo);\n        map._hasEsriLogo = false;\n      }\n\n      L.TileLayer.prototype.onRemove.call(this, map);\n\n      map.off('moveend', this._updateMapAttribution, this);\n    },\n    getAttribution:function(){\n      var attribution = '<span class=\"esri-attributions\" style=\"line-height:14px; vertical-align: -3px; text-overflow:ellipsis; white-space:nowrap; overflow:hidden; display:inline-block;\">' + this.options.attribution + '</span>'/* + logo*/;\n      return attribution;\n    },\n    // _initPane: function(){\n    //   if(!this._map.getPane(this.options.pane)){\n    //     var pane = this._map.createPane(this.options.pane);\n    //     pane.style.pointerEvents = 'none';\n    //     pane.style.zIndex = 5;\n    //   }\n    // },\n    _getAttributionData: function(url){\n      L.esri.Request.get.JSONP(url, {}, L.Util.bind(function(error, attributions){\n        this._attributions = [];\n\n        for (var c = 0; c < attributions.contributors.length; c++) {\n          var contributor = attributions.contributors[c];\n          for (var i = 0; i < contributor.coverageAreas.length; i++) {\n            var coverageArea = contributor.coverageAreas[i];\n            var southWest = new L.LatLng(coverageArea.bbox[0], coverageArea.bbox[1]);\n            var northEast = new L.LatLng(coverageArea.bbox[2], coverageArea.bbox[3]);\n            this._attributions.push({\n              attribution: contributor.attribution,\n              score: coverageArea.score,\n              bounds: new L.LatLngBounds(southWest, northEast),\n              minZoom: coverageArea.zoomMin,\n              maxZoom: coverageArea.zoomMax\n            });\n          }\n        }\n\n        this._attributions.sort(function(a, b){\n          return b.score - a.score;\n        });\n\n        this._updateMapAttribution();\n      }, this));\n    },\n    _updateMapAttribution: function(){\n      if(this._map && this._map.attributionControl && this._attributions){\n        var newAttributions = '';\n        var bounds = this._map.getBounds();\n        var zoom = this._map.getZoom();\n\n        for (var i = 0; i < this._attributions.length; i++) {\n          var attribution = this._attributions[i];\n          var text = attribution.attribution;\n          if(!newAttributions.match(text) && bounds.intersects(attribution.bounds) && zoom >= attribution.minZoom && zoom <= attribution.maxZoom) {\n            newAttributions += (', ' + text);\n          }\n        }\n        newAttributions = newAttributions.substr(2);\n        var attributionElement = this._map.attributionControl._container.querySelector('.esri-attributions');\n        attributionElement.innerHTML = newAttributions;\n        attributionElement.style.maxWidth =  (this._map.getSize().x * 0.65) + 'px';\n        this.fire('attributionupdated', {\n          attribution: newAttributions\n        });\n      }\n    }\n  });\n\n  EsriLeaflet.BasemapLayer = EsriLeaflet.Layers.BasemapLayer;\n\n  EsriLeaflet.Layers.basemapLayer = function(key, options){\n    return new EsriLeaflet.Layers.BasemapLayer(key, options);\n  };\n\n  EsriLeaflet.basemapLayer = function(key, options){\n    return new EsriLeaflet.Layers.BasemapLayer(key, options);\n  };\n\n})(EsriLeaflet);","EsriLeaflet.Layers.RasterLayer =  L.Class.extend({\n  includes: L.Mixin.Events,\n\n  options: {\n    opacity: 1,\n    position: 'front',\n    f: 'image'\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n\n    this._update = L.Util.limitExecByInterval(this._update, this.options.updateInterval, this);\n\n    if (map.options.crs && map.options.crs.code) {\n      var sr = map.options.crs.code.split(':')[1];\n      this.options.bboxSR = sr;\n      this.options.imageSR = sr;\n    }\n\n    map.on('moveend', this._update, this);\n\n    // if we had an image loaded and it matches the\n    // current bounds show the image otherwise remove it\n    if(this._currentImage && this._currentImage._bounds.equals(this._map.getBounds())){\n      map.addLayer(this._currentImage);\n    } else if(this._currentImage) {\n      this._map.removeLayer(this._currentImage);\n      this._currentImage = null;\n    }\n\n    this._update();\n\n    if(this._popup){\n      this._map.on('click', this._getPopupData, this);\n      this._map.on('dblclick', this._resetPopupState, this);\n    }\n  },\n\n  bindPopup: function(fn, popupOptions){\n    this._shouldRenderPopup = false;\n    this._lastClick = false;\n    this._popup = L.popup(popupOptions);\n    this._popupFunction = fn;\n    if(this._map){\n      this._map.on('click', this._getPopupData, this);\n      this._map.on('dblclick', this._resetPopupState, this);\n    }\n    return this;\n  },\n\n  unbindPopup: function(){\n    if(this._map){\n      this._map.closePopup(this._popup);\n      this._map.off('click', this._getPopupData, this);\n      this._map.off('dblclick', this._resetPopupState, this);\n    }\n    this._popup = false;\n    return this;\n  },\n\n  onRemove: function (map) {\n    if (this._currentImage) {\n      this._map.removeLayer(this._currentImage);\n    }\n\n    if(this._popup){\n      this._map.off('click', this._getPopupData, this);\n      this._map.off('dblclick', this._resetPopupState, this);\n    }\n\n    this._map.off('moveend', this._update, this);\n    this._map = null;\n  },\n\n  addTo: function(map){\n    map.addLayer(this);\n    return this;\n  },\n\n  removeFrom: function(map){\n    map.removeLayer(this);\n    return this;\n  },\n\n  bringToFront: function(){\n    this.options.position = 'front';\n    if(this._currentImage){\n      this._currentImage.bringToFront();\n    }\n    return this;\n  },\n\n  bringToBack: function(){\n    this.options.position = 'back';\n    if(this._currentImage){\n      this._currentImage.bringToBack();\n    }\n    return this;\n  },\n\n  getAttribution: function () {\n    return this.options.attribution;\n  },\n\n  getOpacity: function(){\n    return this.options.opacity;\n  },\n\n  setOpacity: function(opacity){\n    this.options.opacity = opacity;\n    this._currentImage.setOpacity(opacity);\n    return this;\n  },\n\n  getTimeRange: function(){\n    return [this.options.from, this.options.to];\n  },\n\n  setTimeRange: function(from, to){\n    this.options.from = from;\n    this.options.to = to;\n    this._update();\n    return this;\n  },\n\n  metadata: function(callback, context){\n    this._service.metadata(callback, context);\n    return this;\n  },\n\n  authenticate: function(token){\n    this._service.authenticate(token);\n    return this;\n  },\n\n  _renderImage: function(url, bounds){\n    if(this._map){\n      // create a new image overlay and add it to the map\n      // to start loading the image\n      // opacity is 0 while the image is loading\n      var image = new L.ImageOverlay(url, bounds, {\n        opacity: 0\n      }).addTo(this._map);\n\n      // once the image loads\n      image.once('load', function(e){\n        var newImage = e.target;\n        var oldImage = this._currentImage;\n\n        // if the bounds of this image matches the bounds that\n        // _renderImage was called with and we have a map with the same bounds\n        // hide the old image if there is one and set the opacity\n        // of the new image otherwise remove the new image\n        if(newImage._bounds.equals(bounds) && newImage._bounds.equals(this._map.getBounds())){\n          this._currentImage = newImage;\n\n          if(this.options.position === 'front'){\n            this.bringToFront();\n          } else {\n            this.bringToBack();\n          }\n\n          if(this._map && this._currentImage._map){\n            this._currentImage.setOpacity(this.options.opacity);\n          } else {\n            this._currentImage._map.removeLayer(this._currentImage);\n          }\n\n          if(oldImage && this._map) {\n            this._map.removeLayer(oldImage);\n          }\n\n          if(oldImage && oldImage._map){\n            oldImage._map.removeLayer(oldImage);\n          }\n        } else {\n          this._map.removeLayer(newImage);\n        }\n\n        this.fire('load', {\n          bounds: bounds\n        });\n\n      }, this);\n\n      this.fire('loading', {\n        bounds: bounds\n      });\n    }\n  },\n\n  _update: function () {\n    if(!this._map){\n      return;\n    }\n\n    var zoom = this._map.getZoom();\n    var bounds = this._map.getBounds();\n\n    if(this._animatingZoom){\n      return;\n    }\n\n    if (this._map._panTransition && this._map._panTransition._inProgress) {\n      return;\n    }\n\n    if (zoom > this.options.maxZoom || zoom < this.options.minZoom) {\n      if (this._currentImage) {\n        this._currentImage._map.removeLayer(this._currentImage);\n      }\n      return;\n    }\n    var params = this._buildExportParams();\n\n    this._requestExport(params, bounds);\n  },\n\n  // TODO: refactor these into raster layer\n  _renderPopup: function(latlng, error, results, response){\n    latlng = L.latLng(latlng);\n    if(this._shouldRenderPopup && this._lastClick.equals(latlng)){\n      //add the popup to the map where the mouse was clicked at\n      var content = this._popupFunction(error, results, response);\n      if (content) {\n        this._popup.setLatLng(latlng).setContent(content).openOn(this._map);\n      }\n    }\n  },\n\n  _resetPopupState: function(e){\n    this._shouldRenderPopup = false;\n    this._lastClick = e.latlng;\n  },\n\n  // from https://github.com/Leaflet/Leaflet/blob/v0.7.2/src/layer/FeatureGroup.js\n  // @TODO remove at Leaflet 0.8\n  _propagateEvent: function (e) {\n    e = L.extend({\n      layer: e.target,\n      target: this\n    }, e);\n    this.fire(e.type, e);\n  }\n});\n","EsriLeaflet.Layers.DynamicMapLayer = EsriLeaflet.Layers.RasterLayer.extend({\n\n  options: {\n    updateInterval: 150,\n    layers: false,\n    layerDefs: false,\n    timeOptions: false,\n    format: 'png24',\n    transparent: true,\n    f: 'json'\n  },\n\n  initialize: function (options) {\n    options.url = EsriLeaflet.Util.cleanUrl(options.url);\n    this._service = new EsriLeaflet.Services.MapService(options);\n    this._service.on('authenticationrequired requeststart requestend requesterror requestsuccess', this._propagateEvent, this);\n    if ((options.proxy || options.token) && options.f !== 'json'){\n      options.f = 'json';\n    }\n    L.Util.setOptions(this, options);\n  },\n\n  getDynamicLayers: function(){\n    return this.options.dynamicLayers;\n  },\n\n  setDynamicLayers: function(dynamicLayers){\n    this.options.dynamicLayers = dynamicLayers;\n    this._update();\n    return this;\n  },\n\n  getLayers: function(){\n    return this.options.layers;\n  },\n\n  setLayers: function(layers){\n    this.options.layers = layers;\n    this._update();\n    return this;\n  },\n\n  getLayerDefs: function(){\n    return this.options.layerDefs;\n  },\n\n  setLayerDefs: function(layerDefs){\n    this.options.layerDefs = layerDefs;\n    this._update();\n    return this;\n  },\n\n  getTimeOptions: function(){\n    return this.options.timeOptions;\n  },\n\n  setTimeOptions: function(timeOptions){\n    this.options.timeOptions = timeOptions;\n    this._update();\n    return this;\n  },\n\n  query: function(){\n    return this._service.query();\n  },\n\n  identify: function(){\n    return this._service.identify();\n  },\n\n  find: function(){\n    return this._service.find();\n  },\n\n  _getPopupData: function(e){\n    var callback = L.Util.bind(function(error, featureCollection, response) {\n      if(error) { return; } // we really can't do anything here but authenticate or requesterror will fire\n      setTimeout(L.Util.bind(function(){\n        this._renderPopup(e.latlng, error, featureCollection, response);\n      }, this), 300);\n    }, this);\n\n    var identifyRequest = this.identify().on(this._map).at(e.latlng);\n\n    if(this.options.layers){\n      identifyRequest.layers('visible:' + this.options.layers.join(','));\n    } else {\n      identifyRequest.layers('visible');\n    }\n\n    identifyRequest.run(callback);\n\n    // set the flags to show the popup\n    this._shouldRenderPopup = true;\n    this._lastClick = e.latlng;\n  },\n\n  _buildExportParams: function () {\n    var bounds = this._map.getBounds();\n    var size = this._map.getSize();\n    var ne = this._map.options.crs.project(bounds._northEast);\n    var sw = this._map.options.crs.project(bounds._southWest);\n\n    //ensure that we don't ask ArcGIS Server for a taller image than we have actual map displaying\n    var top = this._map.latLngToLayerPoint(bounds._northEast);\n    var bottom = this._map.latLngToLayerPoint(bounds._southWest);\n\n    if (top.y > 0 || bottom.y < size.y){\n      size.y = bottom.y - top.y;\n    }\n\n    var params = {\n      bbox: [sw.x, sw.y, ne.x, ne.y].join(','),\n      size: size.x + ',' + size.y,\n      dpi: 96,\n      format: this.options.format,\n      transparent: this.options.transparent,\n      bboxSR: this.options.bboxSR,\n      imageSR: this.options.imageSR\n    };\n\n    if(this.options.dynamicLayers){\n      params.dynamicLayers = this.options.dynamicLayers;\n    }\n\n    if(this.options.layers){\n      params.layers = 'show:' + this.options.layers.join(',');\n    }\n\n    if(this.options.layerDefs){\n      params.layerDefs = JSON.stringify(this.options.layerDefs);\n    }\n\n    if(this.options.timeOptions){\n      params.timeOptions = JSON.stringify(this.options.timeOptions);\n    }\n\n    if(this.options.from && this.options.to){\n      params.time = this.options.from.valueOf() + ',' + this.options.to.valueOf();\n    }\n\n    if(this._service.options.token) {\n      params.token = this._service.options.token;\n    }\n\n    return params;\n  },\n\n  _requestExport: function (params, bounds) {\n    if(this.options.f === 'json'){\n      this._service.request('export', params, function(error, response){\n        if(error) { return; } // we really can't do anything here but authenticate or requesterror will fire\n        this._renderImage(response.href, bounds);\n      }, this);\n    } else {\n      params.f = 'image';\n      this._renderImage(this.options.url + 'export' + L.Util.getParamString(params), bounds);\n    }\n  }\n});\n\nEsriLeaflet.DynamicMapLayer = EsriLeaflet.Layers.DynamicMapLayer;\n\nEsriLeaflet.Layers.dynamicMapLayer = function(options){\n  return new EsriLeaflet.Layers.DynamicMapLayer(options);\n};\n\nEsriLeaflet.dynamicMapLayer = function(options){\n  return new EsriLeaflet.Layers.DynamicMapLayer(options);\n};\n","EsriLeaflet.Layers.ImageMapLayer = EsriLeaflet.Layers.RasterLayer.extend({\n\n  options: {\n    updateInterval: 150,\n    format: 'jpgpng',\n    transparent: true,\n    f: 'json'\n  },\n\n  query: function(){\n    return this._service.query();\n  },\n\n  identify: function(){\n    return this._service.identify();\n  },\n\n  initialize: function (options) {\n    options.url = EsriLeaflet.Util.cleanUrl(options.url);\n    this._service = new EsriLeaflet.Services.ImageService(options);\n    this._service.on('authenticationrequired requeststart requestend requesterror requestsuccess', this._propagateEvent, this);\n    L.Util.setOptions(this, options);\n  },\n\n  setPixelType: function (pixelType) {\n    this.options.pixelType = pixelType;\n    this._update();\n    return this;\n  },\n\n  getPixelType: function () {\n    return this.options.pixelType;\n  },\n\n  setBandIds: function (bandIds) {\n    if (L.Util.isArray(bandIds)) {\n      this.options.bandIds = bandIds.join(',');\n    } else {\n      this.options.bandIds = bandIds.toString();\n    }\n    this._update();\n    return this;\n  },\n\n  getBandIds: function () {\n    return this.options.bandIds;\n  },\n\n  setNoData: function (noData, noDataInterpretation) {\n    if (L.Util.isArray(noData)) {\n      this.options.noData = noData.join(',');\n    } else {\n      this.options.noData = noData.toString();\n    }\n    if (noDataInterpretation) {\n      this.options.noDataInterpretation = noDataInterpretation;\n    }\n    this._update();\n    return this;\n  },\n\n  getNoData: function () {\n    return this.options.noData;\n  },\n\n  getNoDataInterpretation: function () {\n    return this.options.noDataInterpretation;\n  },\n\n  setRenderingRule: function(renderingRule) {\n    this.options.renderingRule = renderingRule;\n    this._update();\n  },\n\n  getRenderingRule: function() {\n    return this.options.renderingRule;\n  },\n\n  setMosaicRule: function(mosaicRule) {\n    this.options.mosaicRule = mosaicRule;\n    this._update();\n  },\n\n  getMosaicRule: function() {\n    return this.options.mosaicRule;\n  },\n\n  _getPopupData: function(e){\n    var callback = L.Util.bind(function(error, results, response) {\n      if(error) { return; } // we really can't do anything here but authenticate or requesterror will fire\n      setTimeout(L.Util.bind(function(){\n        this._renderPopup(e.latlng, error, results, response);\n      }, this), 300);\n    }, this);\n\n    var identifyRequest = this.identify().at(e.latlng);\n\n    // set mosaic rule for identify task if it is set for layer\n    if (this.options.mosaicRule) {\n      identifyRequest.setMosaicRule(this.options.mosaicRule);\n      // @TODO: force return catalog items too?\n    }\n\n    // @TODO: set rendering rule? Not sure,\n    // sometimes you want raw pixel values\n    // if (this.options.renderingRule) {\n    //   identifyRequest.setRenderingRule(this.options.renderingRule);\n    // }\n\n    identifyRequest.run(callback);\n\n    // set the flags to show the popup\n    this._shouldRenderPopup = true;\n    this._lastClick = e.latlng;\n  },\n\n  _buildExportParams: function () {\n    var bounds = this._map.getBounds();\n    var size = this._map.getSize();\n    var ne = this._map.options.crs.project(bounds._northEast);\n    var sw = this._map.options.crs.project(bounds._southWest);\n\n    var params = {\n      bbox: [sw.x, sw.y, ne.x, ne.y].join(','),\n      size: size.x + ',' + size.y,\n      format: this.options.format,\n      transparent: this.options.transparent,\n      bboxSR: this.options.bboxSR,\n      imageSR: this.options.imageSR\n    };\n\n    if (this.options.from && this.options.to) {\n      params.time = this.options.from.valueOf() + ',' + this.options.to.valueOf();\n    }\n\n    if (this.options.pixelType) {\n      params.pixelType = this.options.pixelType;\n    }\n\n    if (this.options.interpolation) {\n      params.interpolation = this.options.interpolation;\n    }\n\n    if (this.options.compressionQuality) {\n      params.compressionQuality = this.options.compressionQuality;\n    }\n\n    if (this.options.bandIds) {\n      params.bandIds = this.options.bandIds;\n    }\n\n    if (this.options.noData) {\n      params.noData = this.options.noData;\n    }\n\n    if (this.options.noDataInterpretation) {\n      params.noDataInterpretation = this.options.noDataInterpretation;\n    }\n\n    if (this._service.options.token) {\n      params.token = this._service.options.token;\n    }\n\n    if(this.options.renderingRule) {\n      params.renderingRule = JSON.stringify(this.options.renderingRule);\n    }\n\n    if(this.options.mosaicRule) {\n      params.mosaicRule = JSON.stringify(this.options.mosaicRule);\n    }\n\n    return params;\n  },\n\n  _requestExport: function (params, bounds) {\n    if (this.options.f === 'json') {\n      this._service.request('exportImage', params, function(error, response){\n        if(error) { return; } // we really can't do anything here but authenticate or requesterror will fire\n        this._renderImage(response.href, bounds);\n      }, this);\n    } else {\n      params.f = 'image';\n      this._renderImage(this.options.url + 'exportImage' + L.Util.getParamString(params), bounds);\n    }\n  }\n});\n\nEsriLeaflet.ImageMapLayer = EsriLeaflet.Layers.ImageMapLayer;\n\nEsriLeaflet.Layers.imageMapLayer = function (options) {\n  return new EsriLeaflet.Layers.ImageMapLayer(options);\n};\n\nEsriLeaflet.imageMapLayer = function (options) {\n  return new EsriLeaflet.Layers.ImageMapLayer(options);\n};\n","EsriLeaflet.Layers.TiledMapLayer = L.TileLayer.extend({\n  options: {\n    zoomOffsetAllowance: 0.1,\n    correctZoomLevels: true\n  },\n\n  statics: {\n    MercatorZoomLevels: {\n      '0':156543.03392799999,\n      '1':78271.516963999893,\n      '2':39135.758482000099,\n      '3':19567.879240999901,\n      '4':9783.9396204999593,\n      '5':4891.9698102499797,\n      '6':2445.9849051249898,\n      '7':1222.9924525624899,\n      '8':611.49622628138002,\n      '9':305.74811314055802,\n      '10':152.874056570411,\n      '11':76.437028285073197,\n      '12':38.218514142536598,\n      '13':19.109257071268299,\n      '14':9.5546285356341496,\n      '15':4.7773142679493699,\n      '16':2.38865713397468,\n      '17':1.1943285668550501,\n      '18':0.59716428355981699,\n      '19':0.29858214164761698,\n      '20':0.14929107082381,\n      '21':0.07464553541191,\n      '22':0.0373227677059525,\n      '23':0.0186613838529763\n    }\n  },\n\n  initialize: function(options){\n    options.url = EsriLeaflet.Util.cleanUrl(options.url);\n    options = L.Util.setOptions(this, options);\n\n    // set the urls\n    //this.url = L.esri.Util.cleanUrl(url);\n    this.tileUrl = L.esri.Util.cleanUrl(options.url) + 'tile/{z}/{y}/{x}';\n    this._service = new L.esri.Services.MapService(options);\n    this._service.on('authenticationrequired requeststart requestend requesterror requestsuccess', this._propagateEvent, this);\n\n    //if this is looking at the AGO tiles subdomain insert the subdomain placeholder\n    if(this.tileUrl.match('://tiles.arcgisonline.com')){\n      this.tileUrl = this.tileUrl.replace('://tiles.arcgisonline.com', '://tiles{s}.arcgisonline.com');\n      options.subdomains = ['1', '2', '3', '4'];\n    }\n\n    if(this.options.token) {\n      this.tileUrl += ('?token=' + this.options.token);\n    }\n\n    // init layer by calling TileLayers initialize method\n    L.TileLayer.prototype.initialize.call(this, this.tileUrl, options);\n  },\n\n  getTileUrl: function (tilePoint) {\n    return L.Util.template(this.tileUrl, L.extend({\n      s: this._getSubdomain(tilePoint),\n      z: this._lodMap[tilePoint.z] || tilePoint.z, // try lod map first, then just defualt to zoom level\n      x: tilePoint.x,\n      y: tilePoint.y\n    }, this.options));\n  },\n\n  onAdd: function(map){\n    if (!this._lodMap && this.options.correctZoomLevels) {\n      this._lodMap = {}; // make sure we always have an lod map even if its empty\n      this.metadata(function(error, metadata) {\n        if(!error) {\n          var sr = metadata.spatialReference.latestWkid || metadata.spatialReference.wkid;\n\n          if (sr === 102100 || sr === 3857) {\n            //create the zoom level data\n            var arcgisLODs = metadata.tileInfo.lods;\n            var correctResolutions = EsriLeaflet.Layers.TiledMapLayer.MercatorZoomLevels;\n\n            for(var i = 0; i < arcgisLODs.length; i++) {\n              var arcgisLOD = arcgisLODs[i];\n              for(var ci in correctResolutions) {\n                var correctRes = correctResolutions[ci];\n\n                if(this._withinPercentage(arcgisLOD.resolution, correctRes, this.options.zoomOffsetAllowance)) {\n                  this._lodMap[ci] = arcgisLOD.level;\n                  break;\n                }\n              }\n            }\n          } else {\n            EsriLeaflet.Util.warn('L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet http://esri.github.io/esri-leaflet/examples/non-mercator-projection.html');\n          }\n        }\n\n        L.TileLayer.prototype.onAdd.call(this, map);\n      }, this);\n    } else {\n      L.TileLayer.prototype.onAdd.call(this, map);\n    }\n  },\n\n  metadata: function(callback, context){\n    this._service.metadata(callback, context);\n    return this;\n  },\n\n  identify: function(){\n    return this._service.identify();\n  },\n\n  authenticate: function(token){\n    var tokenQs = '?token=' + token;\n    this.tileUrl = (this.options.token) ? this.tileUrl.replace(/\\?token=(.+)/g, tokenQs) : this.tileUrl + tokenQs;\n    this.options.token = token;\n    this._service.authenticate(token);\n    return this;\n  },\n\n  // from https://github.com/Leaflet/Leaflet/blob/v0.7.2/src/layer/FeatureGroup.js\n  // @TODO remove at Leaflet 0.8\n  _propagateEvent: function (e) {\n    e = L.extend({\n      layer: e.target,\n      target: this\n    }, e);\n    this.fire(e.type, e);\n  },\n\n  _withinPercentage: function (a, b, percentage) {\n    var diff = Math.abs((a/b) - 1);\n    return diff < percentage;\n  }\n});\n\nL.esri.TiledMapLayer = L.esri.Layers.tiledMapLayer;\n\nL.esri.Layers.tiledMapLayer = function(options){\n  return new L.esri.Layers.TiledMapLayer(options);\n};\n\nL.esri.tiledMapLayer = function(options){\n  return new L.esri.Layers.TiledMapLayer(options);\n};\n","EsriLeaflet.Layers.FeatureGrid = L.Class.extend({\n\n  includes: L.Mixin.Events,\n\n  options: {\n    cellSize: 512,\n    updateInterval: 150\n  },\n\n  initialize: function (options) {\n    options = L.setOptions(this, options);\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n    this._update = L.Util.limitExecByInterval(this._update, this.options.updateInterval, this);\n\n    // @TODO remove for leaflet 0.8\n    this._map.addEventListener(this.getEvents(), this);\n\n    this._reset();\n    this._update();\n  },\n\n  onRemove: function(){\n    this._map.removeEventListener(this.getEvents(), this);\n    this._removeCells();\n  },\n\n  getEvents: function () {\n    var events = {\n      viewreset: this._reset,\n      moveend: this._update,\n      zoomend : this._onZoom\n    };\n\n    return events;\n  },\n\n  addTo: function(map){\n    map.addLayer(this);\n    return this;\n  },\n\n  removeFrom: function(map){\n    map.removeLayer(this);\n    return this;\n  },\n\n  _onZoom : function () {\n    var zoom = this._map.getZoom();\n\n    if (zoom > this.options.maxZoom ||\n        zoom < this.options.minZoom) {\n      this.removeFrom(this._map);\n      this._map.addEventListener('zoomend', this.getEvents().zoomend, this);\n    } else if (!this._map.hasLayer(this)) {\n      this._map.removeEventListener('zoomend', this.getEvents().zoomend, this);\n      this.addTo(this._map);\n    }\n\n  },\n\n  _reset: function () {\n    this._removeCells();\n\n    this._cells = {};\n    this._activeCells = {};\n    this._cellsToLoad = 0;\n    this._cellsTotal = 0;\n\n    // @TODO enable at Leaflet 0.8\n    // this._cellNumBounds = this._getCellNumBounds();\n\n    this._resetWrap();\n  },\n\n  _resetWrap: function () {\n    var map = this._map,\n        crs = map.options.crs;\n\n    if (crs.infinite) { return; }\n\n    var cellSize = this._getCellSize();\n\n    if (crs.wrapLng) {\n      this._wrapLng = [\n        Math.floor(map.project([0, crs.wrapLng[0]]).x / cellSize),\n        Math.ceil(map.project([0, crs.wrapLng[1]]).x / cellSize)\n      ];\n    }\n\n    if (crs.wrapLat) {\n      this._wrapLat = [\n        Math.floor(map.project([crs.wrapLat[0], 0]).y / cellSize),\n        Math.ceil(map.project([crs.wrapLat[1], 0]).y / cellSize)\n      ];\n    }\n  },\n\n  _getCellSize: function () {\n    return this.options.cellSize;\n  },\n\n  _update: function () {\n    if (!this._map) { return; }\n\n    var bounds = this._map.getPixelBounds(),\n        zoom = this._map.getZoom(),\n        cellSize = this._getCellSize(),\n        cellPadding = [cellSize/2,cellSize/2];\n        // cellPadding = [0,0]\n\n    if (zoom > this.options.maxZoom ||\n        zoom < this.options.minZoom) { return; }\n\n    // cell coordinates range for the current view\n    var topLeft = bounds.min.subtract(cellPadding).divideBy(cellSize).floor();\n    topLeft.x = Math.max(topLeft.x, 0);\n    topLeft.y = Math.max(topLeft.y, 0);\n\n    var cellBounds = L.bounds(topLeft, bounds.max.add(cellPadding).divideBy(cellSize).floor());\n\n    // remove any present cells that are off the specified bounds\n    this._removeOtherCells(cellBounds);\n    this._addCells(cellBounds);\n  },\n\n  _addCells: function (bounds) {\n    var queue = [],\n        center = bounds.getCenter(),\n        zoom = this._map.getZoom();\n\n    var j, i, coords;\n    // create a queue of coordinates to load cells from\n    for (j = bounds.min.y; j <= bounds.max.y; j++) {\n      for (i = bounds.min.x; i <= bounds.max.x; i++) {\n        coords = new L.Point(i, j);\n        coords.z = zoom;\n\n        // @TODO enable at Leaflet 0.8\n        // if (this._isValidCell(coords)) {\n        //   queue.push(coords);\n        // }\n\n        queue.push(coords);\n      }\n    }\n    var cellsToLoad = queue.length;\n\n    if (cellsToLoad === 0) { return; }\n\n    this._cellsToLoad += cellsToLoad;\n    this._cellsTotal += cellsToLoad;\n\n    // sort cell queue to load cells in order of their distance to center\n    queue.sort(function (a, b) {\n      return a.distanceTo(center) - b.distanceTo(center);\n    });\n\n    for (i = 0; i < cellsToLoad; i++) {\n      this._addCell(queue[i]);\n    }\n  },\n\n  // @TODO enable at Leaflet 0.8\n  // _isValidCell: function (coords) {\n  //   var crs = this._map.options.crs;\n\n  //   if (!crs.infinite) {\n  //     // don't load cell if it's out of bounds and not wrapped\n  //     var bounds = this._cellNumBounds;\n  //     if (\n  //       (!crs.wrapLng && (coords.x < bounds.min.x || coords.x > bounds.max.x)) ||\n  //       (!crs.wrapLat && (coords.y < bounds.min.y || coords.y > bounds.max.y))\n  //     ) {\n  //       return false;\n  //     }\n  //   }\n\n  //   if (!this.options.bounds) {\n  //     return true;\n  //   }\n\n  //   // don't load cell if it doesn't intersect the bounds in options\n  //   var cellBounds = this._cellCoordsToBounds(coords);\n  //   return L.latLngBounds(this.options.bounds).intersects(cellBounds);\n  // },\n\n  // converts cell coordinates to its geographical bounds\n  _cellCoordsToBounds: function (coords) {\n    var map = this._map,\n        cellSize = this.options.cellSize,\n\n        nwPoint = coords.multiplyBy(cellSize),\n        sePoint = nwPoint.add([cellSize, cellSize]),\n\n        // @TODO for Leaflet 0.8\n        // nw = map.wrapLatLng(map.unproject(nwPoint, coords.z)),\n        // se = map.wrapLatLng(map.unproject(sePoint, coords.z));\n\n        nw = map.unproject(nwPoint, coords.z).wrap(),\n        se = map.unproject(sePoint, coords.z).wrap();\n\n    return new L.LatLngBounds(nw, se);\n  },\n\n  // converts cell coordinates to key for the cell cache\n  _cellCoordsToKey: function (coords) {\n    return coords.x + ':' + coords.y;\n  },\n\n  // converts cell cache key to coordiantes\n  _keyToCellCoords: function (key) {\n    var kArr = key.split(':'),\n        x = parseInt(kArr[0], 10),\n        y = parseInt(kArr[1], 10);\n\n    return new L.Point(x, y);\n  },\n\n  // remove any present cells that are off the specified bounds\n  _removeOtherCells: function (bounds) {\n    for (var key in this._cells) {\n      if (!bounds.contains(this._keyToCellCoords(key))) {\n        this._removeCell(key);\n      }\n    }\n  },\n\n  _removeCell: function (key) {\n    var cell = this._activeCells[key];\n    if(cell){\n      delete this._activeCells[key];\n\n      if (this.cellLeave) {\n        this.cellLeave(cell.bounds, cell.coords);\n      }\n\n      this.fire('cellleave', {\n        bounds: cell.bounds,\n        coords: cell.coords\n      });\n    }\n  },\n\n  _removeCells: function(){\n    for (var key in this._cells) {\n      var bounds = this._cells[key].bounds;\n      var coords = this._cells[key].coords;\n\n      if (this.cellLeave) {\n        this.cellLeave(bounds, coords);\n      }\n\n      this.fire('cellleave', {\n        bounds: bounds,\n        coords: coords\n      });\n    }\n  },\n\n  _addCell: function (coords) {\n\n    // wrap cell coords if necessary (depending on CRS)\n    this._wrapCoords(coords);\n\n    // generate the cell key\n    var key = this._cellCoordsToKey(coords);\n\n    // get the cell from the cache\n    var cell = this._cells[key];\n    // if this cell should be shown as isnt active yet (enter)\n\n    if (cell && !this._activeCells[key]) {\n      if (this.cellEnter) {\n        this.cellEnter(cell.bounds, coords);\n      }\n\n      this.fire('cellenter', {\n        bounds: cell.bounds,\n        coords: coords\n      });\n\n      this._activeCells[key] = cell;\n    }\n\n    // if we dont have this cell in the cache yet (create)\n    if (!cell) {\n      cell = {\n        coords: coords,\n        bounds: this._cellCoordsToBounds(coords)\n      };\n\n      this._cells[key] = cell;\n      this._activeCells[key] = cell;\n\n      if(this.createCell){\n        this.createCell(cell.bounds, coords);\n      }\n\n      this.fire('cellcreate', {\n        bounds: cell.bounds,\n        coords: coords\n      });\n    }\n  },\n\n  _wrapCoords: function (coords) {\n    coords.x = this._wrapLng ? L.Util.wrapNum(coords.x, this._wrapLng) : coords.x;\n    coords.y = this._wrapLat ? L.Util.wrapNum(coords.y, this._wrapLat) : coords.y;\n  }\n\n  // get the global cell coordinates range for the current zoom\n  // @TODO enable at Leaflet 0.8\n  // _getCellNumBounds: function () {\n  //   // @TODO for Leaflet 0.8\n  //   // var bounds = this._map.getPixelWorldBounds(),\n  //   //     size = this._getCellSize();\n  //   //\n  //   // return bounds ? L.bounds(\n  //   //     bounds.min.divideBy(size).floor(),\n  //   //     bounds.max.divideBy(size).ceil().subtract([1, 1])) : null;\n  // }\n\n});","(function(EsriLeaflet){\n\n  EsriLeaflet.Layers.FeatureManager = EsriLeaflet.Layers.FeatureGrid.extend({\n\n    /**\n     * Options\n     */\n\n    options: {\n      where: '1=1',\n      fields: ['*'],\n      from: false,\n      to: false,\n      timeField: false,\n      timeFilterMode: 'server',\n      simplifyFactor: 0,\n      precision: 6\n    },\n\n    /**\n     * Constructor\n     */\n\n    initialize: function (options) {\n      EsriLeaflet.Layers.FeatureGrid.prototype.initialize.call(this, options);\n\n      options.url = EsriLeaflet.Util.cleanUrl(options.url);\n      options = L.setOptions(this, options);\n\n      this._service = new EsriLeaflet.Services.FeatureLayerService(options);\n\n      //use case insensitive regex to look for common fieldnames used for indexing\n      /*global console */\n      if (this.options.fields[0] !== '*'){\n        var oidCheck = false;\n        for (var i = 0; i < this.options.fields.length; i++){\n          if (this.options.fields[i].match(/^(OBJECTID|FID|OID|ID)$/i)){\n            oidCheck = true;\n          }\n        }\n        if (oidCheck === false) {\n          EsriLeaflet.Util.warn('no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.');\n        }\n      }\n\n      // Leaflet 0.8 change to new propagation\n      this._service.on('authenticationrequired requeststart requestend requesterror requestsuccess', function (e) {\n        e = L.extend({\n          target: this\n        }, e);\n        this.fire(e.type, e);\n      }, this);\n\n      if(this.options.timeField.start && this.options.timeField.end){\n        this._startTimeIndex = new BinarySearchIndex();\n        this._endTimeIndex = new BinarySearchIndex();\n      } else if(this.options.timeField){\n        this._timeIndex = new BinarySearchIndex();\n      }\n\n      this._cache = {};\n      this._currentSnapshot = []; // cache of what layers should be active\n      this._activeRequests = 0;\n      this._pendingRequests = [];\n    },\n\n    /**\n     * Layer Interface\n     */\n\n    onAdd: function(map){\n      return EsriLeaflet.Layers.FeatureGrid.prototype.onAdd.call(this, map);\n    },\n\n    onRemove: function(map){\n      return EsriLeaflet.Layers.FeatureGrid.prototype.onRemove.call(this, map);\n    },\n\n    getAttribution: function () {\n      return this.options.attribution;\n    },\n\n    /**\n     * Feature Managment\n     */\n\n    createCell: function(bounds, coords){\n      this._requestFeatures(bounds, coords);\n    },\n\n    _requestFeatures: function(bounds, coords, callback){\n      this._activeRequests++;\n\n      // our first active request fires loading\n      if(this._activeRequests === 1){\n        this.fire('loading', {\n          bounds: bounds\n        });\n      }\n\n      this._buildQuery(bounds).run(function(error, featureCollection, response){\n        if(response && response.exceededTransferLimit){\n          this.fire('drawlimitexceeded');\n        }\n\n        // no error, features\n        if(!error && featureCollection && featureCollection.features.length && !this._removed){\n          // schedule adding features until the next animation frame\n          EsriLeaflet.Util.requestAnimationFrame(L.Util.bind(function(){\n            this._addFeatures(featureCollection.features, coords);\n            this._postProcessFeatures(bounds);\n          }, this));\n        }\n\n        // no error, no features\n        if (!error && featureCollection && !featureCollection.features.length) {\n          this._postProcessFeatures(bounds);\n        }\n\n        if(callback){\n          callback.call(this, error, featureCollection);\n        }\n      }, this);\n    },\n\n    _postProcessFeatures: function (bounds) {\n      //deincriment the request counter now that we have processed features\n      this._activeRequests--;\n\n      // if there are no more active requests fire a load event for this view\n      if(this._activeRequests <= 0){\n        this.fire('load', {\n          bounds: bounds\n        });\n      }\n    },\n\n    _cacheKey: function (coords){\n      return coords.z + ':' + coords.x + ':' +coords.y;\n    },\n\n    _addFeatures: function(features, coords){\n      var key = this._cacheKey(coords);\n      this._cache[key] = this._cache[key] || [];\n\n      for (var i = features.length - 1; i >= 0; i--) {\n        var id = features[i].id;\n        this._currentSnapshot.push(id);\n        this._cache[key].push(id);\n        /*\n        should we refactor the code in FeatureManager.setWhere()\n        so that we can reuse it to make sure that we remove features\n        on the client that are removed from the service?\n        */\n\n      }\n\n      if(this.options.timeField){\n        this._buildTimeIndexes(features);\n      }\n\n      var zoom = this._map.getZoom();\n\n      if (zoom > this.options.maxZoom ||\n          zoom < this.options.minZoom) { return; }\n\n      this.createLayers(features);\n    },\n\n    _buildQuery: function(bounds){\n      var query = this._service.query()\n                      .intersects(bounds)\n                      .where(this.options.where)\n                      .fields(this.options.fields)\n                      .precision(this.options.precision);\n\n      if(this.options.simplifyFactor){\n        query.simplify(this._map, this.options.simplifyFactor);\n      }\n\n      if(this.options.timeFilterMode === 'server' && this.options.from && this.options.to){\n        query.between(this.options.from, this.options.to);\n      }\n\n      return query;\n    },\n\n    /**\n     * Where Methods\n     */\n\n    setWhere: function(where, callback, context){\n\n      this.options.where = (where && where.length) ? where : '1=1';\n\n      var oldSnapshot = [];\n      var newSnapshot = [];\n      var pendingRequests = 0;\n      var mostRecentError = null;\n      var requestCallback = L.Util.bind(function(error, featureCollection){\n        pendingRequests--;\n\n        if(error) {\n          mostRecentError = error;\n        }\n\n        if(featureCollection){\n          for (var i = featureCollection.features.length - 1; i >= 0; i--) {\n            newSnapshot.push(featureCollection.features[i].id);\n          }\n        }\n\n        if(pendingRequests <= 0) {\n          this._currentSnapshot = newSnapshot;\n          // delay adding features until the next animation frame\n          EsriLeaflet.Util.requestAnimationFrame(L.Util.bind(function() {\n            this.removeLayers(oldSnapshot);\n            this.addLayers(newSnapshot);\n            if(callback) {\n              callback.call(context, mostRecentError);\n            }\n          }, this));\n        }\n      }, this);\n\n      for (var i = this._currentSnapshot.length - 1; i >= 0; i--) {\n        oldSnapshot.push(this._currentSnapshot[i]);\n      }\n\n      for(var key in this._activeCells){\n        pendingRequests++;\n        var coords = this._keyToCellCoords(key);\n        var bounds = this._cellCoordsToBounds(coords);\n        this._requestFeatures(bounds, key, requestCallback);\n      }\n\n      return this;\n    },\n\n    getWhere: function(){\n      return this.options.where;\n    },\n\n    /**\n     * Time Range Methods\n     */\n\n    getTimeRange: function(){\n      return [this.options.from, this.options.to];\n    },\n\n    setTimeRange: function(from, to, callback, context){\n      var oldFrom = this.options.from;\n      var oldTo = this.options.to;\n      var pendingRequests = 0;\n      var mostRecentError = null;\n      var requestCallback = L.Util.bind(function(error){\n        if(error){\n          mostRecentError = error;\n        }\n\n        this._filterExistingFeatures(oldFrom, oldTo, from, to);\n\n        pendingRequests--;\n\n        if(callback && pendingRequests <= 0){\n          callback.call(context, mostRecentError);\n        }\n      }, this);\n\n      this.options.from = from;\n      this.options.to = to;\n\n      this._filterExistingFeatures(oldFrom, oldTo, from, to);\n\n      if(this.options.timeFilterMode === 'server') {\n        for(var key in this._activeCells){\n          pendingRequests++;\n          var coords = this._keyToCellCoords(key);\n          var bounds = this._cellCoordsToBounds(coords);\n          this._requestFeatures(bounds, key, requestCallback);\n        }\n      }\n    },\n\n    refresh: function(){\n      for(var key in this._activeCells){\n        var coords = this._keyToCellCoords(key);\n        var bounds = this._cellCoordsToBounds(coords);\n        this._requestFeatures(bounds, key);\n      }\n\n      if(this.redraw){\n        this.once('load', function(){\n          this.eachFeature(function(layer){\n            this._redraw(layer.feature.id);\n          }, this);\n        }, this);\n      }\n    },\n\n    _filterExistingFeatures: function (oldFrom, oldTo, newFrom, newTo) {\n      var layersToRemove = (oldFrom && oldTo) ? this._getFeaturesInTimeRange(oldFrom, oldTo) : this._currentSnapshot;\n      var layersToAdd = this._getFeaturesInTimeRange(newFrom, newTo);\n\n      if(layersToAdd.indexOf){\n        for (var i = 0; i < layersToAdd.length; i++) {\n          var shouldRemoveLayer = layersToRemove.indexOf(layersToAdd[i]);\n          if(shouldRemoveLayer >= 0){\n            layersToRemove.splice(shouldRemoveLayer, 1);\n          }\n        }\n      }\n\n      // schedule adding features until the next animation frame\n      EsriLeaflet.Util.requestAnimationFrame(L.Util.bind(function(){\n        this.removeLayers(layersToRemove);\n        this.addLayers(layersToAdd);\n      }, this));\n    },\n\n    _getFeaturesInTimeRange: function(start, end){\n      var ids = [];\n      var search;\n\n      if(this.options.timeField.start && this.options.timeField.end){\n        var startTimes = this._startTimeIndex.between(start, end);\n        var endTimes = this._endTimeIndex.between(start, end);\n        search = startTimes.concat(endTimes);\n      } else {\n        search = this._timeIndex.between(start, end);\n      }\n\n      for (var i = search.length - 1; i >= 0; i--) {\n        ids.push(search[i].id);\n      }\n\n      return ids;\n    },\n\n    _buildTimeIndexes: function(geojson){\n      var i;\n      var feature;\n      if(this.options.timeField.start && this.options.timeField.end){\n        var startTimeEntries = [];\n        var endTimeEntries = [];\n        for (i = geojson.length - 1; i >= 0; i--) {\n          feature = geojson[i];\n          startTimeEntries.push( {\n            id: feature.id,\n            value: new Date(feature.properties[this.options.timeField.start])\n          });\n          endTimeEntries.push( {\n            id: feature.id,\n            value: new Date(feature.properties[this.options.timeField.end])\n          });\n        }\n        this._startTimeIndex.bulkAdd(startTimeEntries);\n        this._endTimeIndex.bulkAdd(endTimeEntries);\n      } else {\n        var timeEntries = [];\n        for (i = geojson.length - 1; i >= 0; i--) {\n          feature = geojson[i];\n          timeEntries.push( {\n            id: feature.id,\n            value: new Date(feature.properties[this.options.timeField])\n          });\n        }\n\n        this._timeIndex.bulkAdd(timeEntries);\n      }\n    },\n\n    _featureWithinTimeRange: function(feature){\n      if(!this.options.from || !this.options.to){\n        return true;\n      }\n\n      var from = +this.options.from.valueOf();\n      var to = +this.options.to.valueOf();\n\n      if(typeof this.options.timeField === 'string'){\n        var date = +feature.properties[this.options.timeField];\n        return (date >= from) && (date <= to);\n      }\n\n      if(this.options.timeField.start &&  this.options.timeField.end){\n        var startDate = +feature.properties[this.options.timeField.start];\n        var endDate = +feature.properties[this.options.timeField.end];\n        return ((startDate >= from) && (startDate <= to)) || ((endDate >= from) && (endDate <= to));\n      }\n    },\n\n    /**\n     * Service Methods\n     */\n\n    authenticate: function(token){\n      this._service.authenticate(token);\n      return this;\n    },\n\n    metadata: function(callback, context){\n      this._service.metadata(callback, context);\n      return this;\n    },\n\n    query: function(){\n      return this._service.query();\n    },\n\n    _getMetadata: function(callback){\n      if(this._metadata){\n        var error;\n        callback(error, this._metadata);\n      } else {\n        this.metadata(L.Util.bind(function(error, response) {\n          this._metadata = response;\n          callback(error, this._metadata);\n        }, this));\n      }\n    },\n\n    addFeature: function(feature, callback, context){\n      this._getMetadata(L.Util.bind(function(error, metadata){\n        this._service.addFeature(feature, L.Util.bind(function(error, response){\n          if(!error){\n            // assign ID from result to appropriate objectid field from service metadata\n            feature.properties[metadata.objectIdField] = response.objectId;\n\n            // we also need to update the geojson id for createLayers() to function\n            feature.id = response.objectId;\n            this.createLayers([feature]);\n          }\n\n          if(callback){\n            callback.call(context, error, response);\n          }\n        }, this));\n      }, this));\n    },\n\n    updateFeature: function(feature, callback, context){\n      this._service.updateFeature(feature, function(error, response){\n        if(!error){\n          this.removeLayers([feature.id], true);\n          this.createLayers([feature]);\n        }\n\n        if(callback){\n          callback.call(context, error, response);\n        }\n      }, this);\n    },\n\n    deleteFeature: function(id, callback, context){\n      this._service.deleteFeature(id, function(error, response){\n        if(!error && response.objectId){\n          this.removeLayers([response.objectId], true);\n        }\n\n        if(callback){\n          callback.call(context, error, response);\n        }\n      }, this);\n    },\n\n    deleteFeatures: function(ids, callback, context){\n      return this._service.deleteFeatures(ids, function(error, response){\n        if(!error && response.length > 0){\n          for (var i=0; i<response.length; i++){\n            this.removeLayers([response[i].objectId], true);\n          }\n        }\n\n        if(callback){\n          callback.call(context, error, response);\n        }\n      }, this);\n    }\n  });\n\n  /**\n   * Temporal Binary Search Index\n   */\n\n  function BinarySearchIndex(values) {\n    this.values = values || [];\n  }\n\n  BinarySearchIndex.prototype._query = function(query){\n    var minIndex = 0;\n    var maxIndex = this.values.length - 1;\n    var currentIndex;\n    var currentElement;\n    var resultIndex;\n\n    while (minIndex <= maxIndex) {\n      resultIndex = currentIndex = (minIndex + maxIndex) / 2 | 0;\n      currentElement = this.values[Math.round(currentIndex)];\n      if (+currentElement.value < +query) {\n        minIndex = currentIndex + 1;\n      } else if (+currentElement.value > +query) {\n        maxIndex = currentIndex - 1;\n      } else {\n        return currentIndex;\n      }\n    }\n\n    return ~maxIndex;\n  };\n\n  BinarySearchIndex.prototype.sort = function(){\n    this.values.sort(function(a, b) {\n      return +b.value - +a.value;\n    }).reverse();\n    this.dirty = false;\n  };\n\n  BinarySearchIndex.prototype.between = function(start, end){\n    if(this.dirty){\n      this.sort();\n    }\n\n    var startIndex = this._query(start);\n    var endIndex = this._query(end);\n\n    if(startIndex === 0 && endIndex === 0){\n      return [];\n    }\n\n    startIndex = Math.abs(startIndex);\n    endIndex = (endIndex < 0) ? Math.abs(endIndex): endIndex + 1;\n\n    return this.values.slice(startIndex, endIndex);\n  };\n\n  BinarySearchIndex.prototype.bulkAdd = function(items){\n    this.dirty = true;\n    this.values = this.values.concat(items);\n  };\n\n})(EsriLeaflet);\n","EsriLeaflet.Layers.FeatureLayer = EsriLeaflet.Layers.FeatureManager.extend({\n\n  statics: {\n    EVENTS: 'click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose'\n  },\n\n  options: {\n    cacheLayers: true\n  },\n\n  /**\n   * Constructor\n   */\n\n  initialize: function (options) {\n    EsriLeaflet.Layers.FeatureManager.prototype.initialize.call(this, options);\n\n    options = L.setOptions(this, options);\n\n    this._layers = {};\n    this._leafletIds = {};\n    this._key = 'c'+(Math.random() * 1e9).toString(36).replace('.', '_');\n  },\n\n  /**\n   * Layer Interface\n   */\n\n  onAdd: function(map){\n    map.on('zoomstart zoomend', function(e){\n      this._zooming = (e.type === 'zoomstart');\n    }, this);\n    this._removed = false;\n\n    return EsriLeaflet.Layers.FeatureManager.prototype.onAdd.call(this, map);\n  },\n\n  onRemove: function(map){\n    this._removed = true;\n    for (var i in this._layers) {\n      map.removeLayer(this._layers[i]);\n    }\n\n    return EsriLeaflet.Layers.FeatureManager.prototype.onRemove.call(this, map);\n  },\n\n  createNewLayer: function(geojson){\n    // @TODO Leaflet 0.8\n    //newLayer = L.GeoJSON.geometryToLayer(geojson, this.options);\n    return L.GeoJSON.geometryToLayer(geojson, this.options.pointToLayer, L.GeoJSON.coordsToLatLng, this.options);\n  },\n\n  _updateLayer: function(layer, geojson){\n    // convert the geojson coordinates into a Leaflet LatLng array/nested arrays\n    // pass it to setLatLngs to update layer geometries\n    var latlngs = [];\n    var coordsToLatLng = this.options.coordsToLatLng || L.GeoJSON.coordsToLatLng;\n\n    // copy new attributes, if present\n    if (geojson.properties) {\n      layer.feature.properties = geojson.properties;\n    }\n\n    switch(geojson.geometry.type){\n      case 'Point':\n        latlngs = L.GeoJSON.coordsToLatLng(geojson.geometry.coordinates);\n        layer.setLatLng(latlngs);\n        break;\n      case 'LineString':\n        latlngs = L.GeoJSON.coordsToLatLngs(geojson.geometry.coordinates, 0, coordsToLatLng);\n        layer.setLatLngs(latlngs);\n        break;\n      case 'MultiLineString':\n        latlngs = L.GeoJSON.coordsToLatLngs(geojson.geometry.coordinates, 1, coordsToLatLng);\n        layer.setLatLngs(latlngs);\n        break;\n      case 'Polygon':\n        latlngs = L.GeoJSON.coordsToLatLngs(geojson.geometry.coordinates, 1, coordsToLatLng);\n        layer.setLatLngs(latlngs);\n        break;\n      case 'MultiPolygon':\n        latlngs = L.GeoJSON.coordsToLatLngs(geojson.geometry.coordinates, 2, coordsToLatLng);\n        layer.setLatLngs(latlngs);\n        break;\n    }\n  },\n\n  /**\n   * Feature Management Methods\n   */\n\n  createLayers: function(features){\n    for (var i = features.length - 1; i >= 0; i--) {\n\n      var geojson = features[i];\n\n      var layer = this._layers[geojson.id];\n      var newLayer;\n\n      if(layer && !this._map.hasLayer(layer)){\n        this._map.addLayer(layer);\n      }\n\n      // update geomerty if neccessary\n      if (layer && (layer.setLatLngs || layer.setLatLng)) {\n        this._updateLayer(layer, geojson);\n      }\n\n\n      if(!layer){\n        newLayer =  this.createNewLayer(geojson);\n        newLayer.feature = geojson;\n\n        if (this.options.style) {\n          newLayer._originalStyle = this.options.style;\n        }\n\n        // circleMarker check\n        else if (newLayer.setStyle) {\n          newLayer._originalStyle = newLayer.options;\n        }\n\n        newLayer._leaflet_id = this._key + '_' + geojson.id;\n\n        this._leafletIds[newLayer._leaflet_id] = geojson.id;\n\n        // bubble events from layers to this\n        // @TODO Leaflet 0.8\n        // newLayer.addEventParent(this);\n\n        newLayer.on(EsriLeaflet.Layers.FeatureLayer.EVENTS, this._propagateEvent, this);\n\n        // bind a popup if we have one\n        if(this._popup && newLayer.bindPopup){\n          newLayer.bindPopup(this._popup(newLayer.feature, newLayer), this._popupOptions);\n        }\n\n        if(this.options.onEachFeature){\n          this.options.onEachFeature(newLayer.feature, newLayer);\n        }\n\n        // cache the layer\n        this._layers[newLayer.feature.id] = newLayer;\n\n        // style the layer\n        this.resetStyle(newLayer.feature.id);\n\n        this.fire('createfeature', {\n          feature: newLayer.feature\n        });\n\n        // add the layer if it is within the time bounds or our layer is not time enabled\n        if(!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson)) ){\n          this._map.addLayer(newLayer);\n        }\n      }\n    }\n  },\n\n  addLayers: function(ids){\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var layer = this._layers[ids[i]];\n      if(layer){\n        this.fire('addfeature', {\n          feature: layer.feature\n        });\n        this._map.addLayer(layer);\n      }\n    }\n  },\n\n  removeLayers: function(ids, permanent){\n    for (var i = ids.length - 1; i >= 0; i--) {\n      var id = ids[i];\n      var layer = this._layers[id];\n      if(layer){\n        this.fire('removefeature', {\n          feature: layer.feature,\n          permanent: permanent\n        });\n        this._map.removeLayer(layer);\n      }\n      if(layer && permanent){\n        delete this._layers[id];\n      }\n    }\n  },\n\n  cellEnter: function(bounds, coords){\n    if(!this._zooming){\n      EsriLeaflet.Util.requestAnimationFrame(L.Util.bind(function(){\n        var cacheKey = this._cacheKey(coords);\n        var cellKey = this._cellCoordsToKey(coords);\n        var layers = this._cache[cacheKey];\n        if(this._activeCells[cellKey] && layers){\n          this.addLayers(layers);\n        }\n      }, this));\n    }\n  },\n\n  cellLeave: function(bounds, coords){\n    if(!this._zooming){\n      EsriLeaflet.Util.requestAnimationFrame(L.Util.bind(function(){\n        var cacheKey = this._cacheKey(coords);\n        var cellKey = this._cellCoordsToKey(coords);\n        var layers = this._cache[cacheKey];\n        var mapBounds = this._map.getBounds();\n        if(!this._activeCells[cellKey] && layers){\n          var removable = true;\n\n          for (var i = 0; i < layers.length; i++) {\n            var layer = this._layers[layers[i]];\n            if(layer && layer.getBounds && mapBounds.intersects(layer.getBounds())){\n              removable = false;\n            }\n          }\n\n          if(removable){\n            this.removeLayers(layers, !this.options.cacheLayers);\n          }\n\n          if(!this.options.cacheLayers && removable){\n            delete this._cache[cacheKey];\n            delete this._cells[cellKey];\n            delete this._activeCells[cellKey];\n          }\n        }\n      }, this));\n    }\n  },\n\n  /**\n   * Styling Methods\n   */\n\n  resetStyle: function (id) {\n    var layer = this._layers[id];\n\n    if(layer){\n      this.setFeatureStyle(layer.feature.id, layer._originalStyle);\n    }\n\n    return this;\n  },\n\n  setStyle: function (style) {\n    this.options.style = style;\n    this.eachFeature(function (layer) {\n      this.setFeatureStyle(layer.feature.id, style);\n    }, this);\n    return this;\n  },\n\n  setFeatureStyle: function (id, style) {\n    var layer = this._layers[id];\n\n    if (typeof style === 'function') {\n      style = style(layer.feature);\n    }\n\n    if (!style && !layer.defaultOptions) {\n      style = L.Path.prototype.options;\n      style.fill = true; //not set by default\n    }\n\n    if (layer && layer.setStyle) {\n      layer.setStyle(style);\n    }\n\n    return this;\n  },\n\n  /**\n   * Popup Methods\n   */\n\n  bindPopup: function (fn, options) {\n    this._popup = fn;\n    this._popupOptions = options;\n    for (var i in this._layers) {\n      var layer = this._layers[i];\n      var popupContent = this._popup(layer.feature, layer);\n      layer.bindPopup(popupContent, options);\n    }\n    return this;\n  },\n\n  unbindPopup: function () {\n    this._popup =  false;\n    for (var i in this._layers) {\n      var layer = this._layers[i];\n      if (layer.unbindPopup) {\n        layer.unbindPopup();\n      } else if (layer.getLayers) {\n        var groupLayers = layer.getLayers();\n        for (var j in groupLayers) {\n          var gLayer = groupLayers[j];\n          gLayer.unbindPopup();\n        }\n      }\n    }\n    return this;\n  },\n\n  /**\n   * Utility Methods\n   */\n\n  eachFeature: function (fn, context) {\n    for (var i in this._layers) {\n      fn.call(context, this._layers[i]);\n    }\n    return this;\n  },\n\n  getFeature: function (id) {\n    return this._layers[id];\n  },\n\n  bringToBack: function () {\n    this.eachFeature(function (layer) {\n      if(layer.bringToBack) {\n        layer.bringToBack();\n      }\n    });\n  },\n\n  bringToFront: function () {\n    this.eachFeature(function (layer) {\n      if(layer.bringToFront) {\n        layer.bringToFront();\n      }\n    });\n  },\n\n  redraw: function (id) {\n    if (id) {\n      this._redraw(id);\n    }\n    return this;\n  },\n\n  _redraw: function(id) {\n    var layer = this._layers[id];\n    var geojson = layer.feature;\n\n    // if this looks like a marker\n    if (layer && layer.setIcon && this.options.pointToLayer) {\n      // update custom symbology, if necessary\n      if (this.options.pointToLayer){\n        var getIcon = this.options.pointToLayer(geojson, L.latLng(geojson.geometry.coordinates[1], geojson.geometry.coordinates[0]));\n        var updatedIcon = getIcon.options.icon;\n        layer.setIcon(updatedIcon);\n      }\n    }\n\n    // looks like a vector marker (circleMarker)\n    if (layer && layer.setStyle && this.options.pointToLayer) {\n      var getStyle = this.options.pointToLayer(geojson, L.latLng(geojson.geometry.coordinates[1], geojson.geometry.coordinates[0]));\n      var updatedStyle = getStyle.options;\n      this.setFeatureStyle(geojson.id, updatedStyle);\n    }\n\n    // looks like a path (polygon/polyline)\n    if(layer && layer.setStyle && this.options.style) {\n      this.resetStyle(geojson.id);\n    }\n  },\n\n  // from https://github.com/Leaflet/Leaflet/blob/v0.7.2/src/layer/FeatureGroup.js\n  // @TODO remove at Leaflet 0.8\n  _propagateEvent: function (e) {\n    e.layer = this._layers[this._leafletIds[e.target._leaflet_id]];\n    e.target = this;\n    this.fire(e.type, e);\n  }\n});\n\nEsriLeaflet.FeatureLayer = EsriLeaflet.Layers.FeatureLayer;\n\nEsriLeaflet.Layers.featureLayer = function(options){\n  return new EsriLeaflet.Layers.FeatureLayer(options);\n};\n\nEsriLeaflet.featureLayer = function(options){\n  return new EsriLeaflet.Layers.FeatureLayer(options);\n};\n","EsriLeaflet.Controls.Logo = L.Control.extend({\n  options: {\n    position: 'bottomright',\n    marginTop: 0,\n    marginLeft: 0,\n    marginBottom: 0,\n    marginRight: 0\n  },\n\n  onAdd: function () {\n    var div = L.DomUtil.create('div', 'esri-leaflet-logo');\n    div.style.marginTop = this.options.marginTop;\n    div.style.marginLeft = this.options.marginLeft;\n    div.style.marginBottom = this.options.marginBottom;\n    div.style.marginRight = this.options.marginRight;\n    div.innerHTML = this._adjustLogo(this._map._size);\n\n    this._map.on('resize', function(e){\n      div.innerHTML = this._adjustLogo(e.newSize);\n    }, this);\n\n    return div;\n  },\n\n  _adjustLogo: function (mapSize) {\n    if (mapSize.x <= 600 || mapSize.y <= 600){\n      return '<a href=\"https://developers.arcgis.com\" style=\"border: none;\"><img src=\"https://js.arcgis.com/3.13/esri/images/map/logo-sm.png\" alt=\"Powered by Esri\" style=\"border: none;\"></a>';\n    }\n    else {\n      return '<a href=\"https://developers.arcgis.com\" style=\"border: none;\"><img src=\"https://js.arcgis.com/3.13/esri/images/map/logo-med.png\" alt=\"Powered by Esri\" style=\"border: none;\"></a>';\n    }\n  }\n\n});\n\nEsriLeaflet.Controls.logo = function(options){\n  return new L.esri.Controls.Logo(options);\n};\n"]}