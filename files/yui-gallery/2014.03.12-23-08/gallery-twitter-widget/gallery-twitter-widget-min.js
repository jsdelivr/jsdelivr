YUI.add("gallery-twitter-widget",function(e){var c=/@(\w+)/g,b=/((?:https?|s?ftp|ssh)\:\/\/[^"\s<>]*[^.,;'">\:\s<>\)\]\!])/g,d=/#(\w+)/g,a;a=e.Base.create("Twitter",e.Widget,[],{PHOTO_TEMPLATE:'<div class="twitter-photo"><a href="{url}"><img src="{profile_image_url}"></a></div>',ENTRY_TEMPLATE:'<div class="twitter-update">{img}'+'<div class="twitter-entry"><div class="writer">{userTplt}</div>{text} {time}</div>'+"</div>",TIME_TEMPLATE:'<span class="twitter-timestamp">{relativeTime}</span>',USER_TEMPLATE:'<a href="{url}" class="twitter-username">{username}</a>',TITLE_TEMPLATE:'<h3 class="twitter-title">{title} {user}</h3>',interval:null,initializer:function(f){this.publish({data:{defaultFn:this._defDataFn},error:{defaultFn:this._defErrorFn}});this._initJSONPRequest();this.after({usernameChange:this._refreshJSONPRequest,countChange:this._refreshJSONPRequest});},_initJSONPRequest:function(){var f=this.get("key"),h={count:this.get("count"),d:(new Date()).getTime(),key:this.get("isQuery")?f:"from:"+f},g=e.Lang.sub(a.SEARCH_API_URI,h).replace("#","%23");this._jsonpHandle=new e.JSONPRequest(g,{on:{success:this._handleJSONPResponse,failure:this._defErrorFn},context:this});},_refreshJSONPRequest:function(){this._initJSONPRequest();this.syncUI();},renderUI:function(){this.get("contentBox").append('<div class="yui3-twitter-hdr"></div><div class="yui3-twitter-bdy"><ul class="twitter-updates'+(this.get("showPhoto")?" photo":"")+'"></ul></div><div class="yui3-twitter-ftr"><div class="img">&nbsp;</div></div>');if(this.get("hideSkin")){this.get("boundingBox").addClass("noskin");}},bindUI:function(){this.after("usernameChange",this.syncUI);this.after("countChange",this.syncUI);this.after("stringsChange",this.syncUI);this.after("refreshSecondsChange",this._updateInterval);},syncUI:function(){this._uiUpdateTitle();this.update();this._updateInterval();},_uiUpdateTitle:function(){var f=this.get("contentBox").one(".yui3-twitter-hdr"),j=f.one(".twitter-status-title"),i,g,h;if(this.get("includeTitle")){g=this.get("key");h=this.get("isQuery");i=e.Lang.sub(this.TITLE_TEMPLATE,{title:this.get("strings.title"),user:e.Lang.sub(this.USER_TEMPLATE,{username:h?g:"@"+g,url:h?a.TREND_URL+g.replace("#","%23"):a.PROFILE_URL+g})});if(j){j.replace(i);}else{f.prepend(i);}}else{if(j){j.remove();}}},update:function(){this._jsonpHandle.send();},_handleJSONPResponse:function(f){if(e.Lang.isObject(f)){this.fire("data",{data:f});}else{this.fire("error");}},_defDataFn:function(f){this.get("contentBox").removeClass("twitter-error");this._printEntries(f.data);},_printEntries:function(h){var g=this.get("contentBox"),f=this._createEntries(h);g.one(".twitter-updates").setContent("<li>"+f.join("</li><li>")+"</li>");},_createEntries:function(k){var f=[],j=k.results||k,h;for(h=j.length-1;h>=0;--h){j[h].relativeTime=e.toRelativeTime(new Date(Date.parse(j[h].created_at.replace(/\+\d+/,""))));var g=k.results?j[h].from_user:j[h].user.screen_name;j[h].url=a.PROFILE_URL+g;j[h].username=g;f[h]=this._createEntry(j[h]);}return f;},_createEntry:function(j){var i=this.get("showTime");var h=e.Lang.sub(this.ENTRY_TEMPLATE,j).replace(b,'<a href="$1">$1</a>').replace(c,'<a class="twitter-acct" href="'+a.PROFILE_URL+'$1">@$1</a>').replace(d,'<a class="twitter-hash" href="'+a.TREND_URL+'%23$1"/>#$1</a>'),k=this.get("showTime")?e.Lang.sub(this.TIME_TEMPLATE,j):"",g=this.get("showHandle")?e.Lang.sub(this.USER_TEMPLATE,j):"",f=this.get("showPhoto")?e.Lang.sub(this.PHOTO_TEMPLATE,j):"";return e.Lang.sub(h,{img:f,userTplt:g,time:k});},_defErrorFn:function(){this.get("contentBox").one("ul.twitter-updates").addClass("twitter-error").setContent("<li><em>"+this.get("strings.error")+"</em></li>");},_updateInterval:function(){if(this.interval){this.interval.cancel();}this.interval=e.later(this.get("refreshSeconds")*1000,this,this.update,null,true);}},{PROFILE_URL:"https://twitter.com/#!/",TREND_URL:"https://twitter.com/#!/search/",SEARCH_API_URI:"http://search.twitter.com/search.json?q={key}&count={count}&d={d}&callback={callback}",ATTRS:{key:{},isQuery:{value:false,validator:e.Lang.isBoolean},count:{value:10,validator:e.Lang.isNumber},refreshSeconds:{value:300,validator:e.Lang.isNumber},strings:{value:{title:"Latest Updates",error:"Oops!  We had some trouble connecting to Twitter :("}},showPhoto:{value:true,validator:e.Lang.isBoolean},showHandle:{value:true,validator:e.Lang.isBoolean},includeTitle:{value:true,validator:e.Lang.isBoolean},hideSkin:{value:false,validator:e.Lang.isBoolean},showTime:{value:true,validator:e.Lang.isBoolean}}});e.namespace("Twitter").Status=a;},"gallery-2012.11.07-21-32",{requires:["widget-base","substitute","gallery-torelativetime","jsonp","base-build"],skinnable:true});