/*
	Matreshka v1.5.0 (2015-12-25)
	JavaScript Framework by Andrey Gubanov
	Released under the MIT license
	More info: http://matreshka.io
*/

!function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca;b=function(){var a=function(a){return!!a&&("[object Arguments]"===a.toString()||"object"==typeof a&&null!==a&&"length"in a&&"callee"in a)},b="undefined"!=typeof document?document.documentMode:null,c=8==b;if(b&&8>b)throw Error("Internet Explorer "+b+" doesn't support Class function");var d=function(b,e){var f,g,h=b.constructor!==Object?b.constructor:function EmptyConstructor(){},i=b["extends"]=b["extends"]||b.extend,j=i&&i.prototype,k=b["implements"]=b["implements"]||b.implement,l={};if(f=h,delete b.extend,delete b.implement,j){for(g in j)l[g]="function"==typeof j[g]?function(b){return function(c,d){return d=a(d)?d:Array.prototype.slice.call(arguments,1),b.apply(c,d)}}(j[g]):j[g];l.constructor=function(b){return function(c,d){return d=a(d)?d:Array.prototype.slice.call(arguments,1),b.apply(c,d)}}(j.constructor)}if(c?(b.prototype=null,b.constructor=null,h=function(){
if(this instanceof h){var a,b=new XDomainRequest;for(a in h.prototype)"constructor"!==a&&(b[a]=h.prototype[a]);return b.hasOwnProperty=h.prototype.hasOwnProperty,f.apply(b,arguments),b}f.apply(this,arguments)},b.constructor=h,h.prototype=h.fn=b,h.parent=l,i&&d.IEInherits(h,i)):(b.constructor=h,h.prototype=h.fn=b,h.parent=l,i&&d.inherits(h,i)),k&&k.validate(h.prototype),h.same=function(){return function(){return h.apply(this,arguments)}},e&&"object"==typeof e)for(g in e)h[g]=e[g];return this instanceof d?new h:h};return d.inherits=function(a,b){var c,d=a.prototype,e=function(){};e.prototype=b.prototype,a.prototype=new e,a.prototype.constructor=a;for(c in d)a.prototype[c]=d[c];"undefined"!=typeof Symbol&&d[Symbol.iterator]&&(a.prototype[Symbol.iterator]=d[Symbol.iterator]),a.prototype.instanceOf=function(a){return this instanceof a}},d.IEInherits=function(a,b){for(var c,d=a.prototype.hasOwnProperty,e=a.prototype.constructor,f=Object.prototype.hasOwnProperty;b;)c=c||b.prototype.hasOwnProperty,
a.prototype=function(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d}(b.prototype,a.prototype),b=b.prototype&&b.prototype["extends"]&&b.prototype["extends"].prototype;d!==f?a.prototype.hasOwnProperty=d:c!==f&&(a.prototype.hasOwnProperty=c),a.prototype.constructor=e,a.prototype.instanceOf=function(b){for(var c=a;c;){if(c===b)return!0;c=c.prototype["extends"]}return!1}},d.Interface=function Interface(a,b){var c,d,e={},f=function(a){return"object"==typeof a&&null!==a&&"length"in a};if(a instanceof Interface){for(d in a.propsMap)e[d]=1;c=f(b)?b:[].slice.call(arguments,1)}else c=f(a)?a:arguments;for(d=0;d<c.length;d++)e[c[d]]=1;this.propsMap=e,this.validate=function(a){for(d in this.propsMap)if("function"!=typeof a[d])throw Error('Interface error: Method "'+d+'" is not implemented in '+(a.constructor.name||a.name||"given")+" prototype")}},d.isXDR=c,d}(),c={},d=function(a){var b=function(a,b){var c,d;if(a)for(c=1;c<arguments.length;c++)if(b=arguments[c])for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);
return a},c={extend:b,trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},randomString:function(){return((new Date).getTime()-new Date(2013,4,3).getTime()).toString(36)+Math.floor(1679616*Math.random()).toString(36)},toArray:function(a,b){var c,d=[],e=a.length;for(b=b||0,c=b;e>c;c++)d[c-b]=a[c];return d},debounce:function(a,b,c){var d;return"number"!=typeof b&&(c=b,b=0),function(){var e=arguments,f=this;clearTimeout(d),d=setTimeout(function(){a.apply(c||f,e)},b||0)}},each:function(a,b,c){if(a){if(a.isMK&&"function"==typeof a.each)a.each(b,c);else if("length"in a)[].forEach.call(a,b,c);else for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a);return a}},delay:function(a,b,c,d){return"object"==typeof c&&(d=c,c=0),setTimeout(function(){b.call(d||a)},c||0),a},deepFind:function(a,b){var c,d="string"==typeof b?b.split("."):b,e=a;for(c=0;c<d.length;++c){if("undefined"==typeof e[d[c]])return void 0;e=e[d[c]]}return e},noop:function(){}};return b(a,c),c}(c),e=function(a){return"undefined"==typeof Symbol?"mk-"+a.randomString():Symbol("matreshka");
}(d),f=function(a){var b,c=function(a,b,c){for(var d,e,f=a.length,g=0,h=0,i=[];f>h;h++)e=a[h],b?(d=new FileReader,d.onloadend=function(a){e.readerResult=d.result,i[g++]=e,g==f&&c(i)},d[b](e)):(i[g++]=e,g==f&&c(i))},d="undefined"!=typeof document&&8==document.documentMode?"keyup paste":"input";return a.binders=b={innerHTML:function(){return{on:d,getValue:function(){return this.innerHTML},setValue:function(a){this.innerHTML=null===a?"":a+""}}},innerText:function(){return{on:d,getValue:function(){return this.textContent||this.innerText},setValue:function(a){this["textContent"in this?"textContent":"innerText"]=null===a?"":a+""}}},className:function(a){var b,c=0===a.indexOf("!");return c&&(a=a.replace("!","")),{on:null,getValue:function(){return b=this.classList.contains(a),c?!b:!!b},setValue:function(b){this.classList.toggle(a,c?!b:!!b)}}},property:function(a){return{on:null,getValue:function(){return this[a]},setValue:function(b){try{this[a]=b}catch(c){}}}},attribute:function(a){return{on:null,
getValue:function(){return this.getAttribute(a)},setValue:function(b){this.setAttribute(a,b)}}},dataset:function(a){function toDashed(a){return"data-"+a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}return{on:null,getValue:function(){var b=this;return b.dataset?b.dataset[a]:b.getAttribute(toDashed(a))},setValue:function(b){var c=this;c.dataset?c.dataset[a]=b:c.setAttribute(toDashed(a),b)}}},textarea:function(){return b.input("text")},progress:function(){return b.input()},input:function(a,b){var c;switch(a){case"checkbox":return{on:"click keyup",getValue:function(){return this.checked},setValue:function(a){this.checked=a}};case"radio":return{on:"click keyup",getValue:function(){return this.value},setValue:function(a){this.checked=this.value==a}};case"submit":case"button":case"image":case"reset":return{};case"hidden":c=null;break;case"file":c="change";break;case"text":case"password":c=d;break;default:c="input"}return{on:c,getValue:function(){return this.value},setValue:function(a){
this.value=a}}},output:function(){return{getValue:function(){var a=this;return a.value||a.textContent||a.innerText},setValue:function(a){var b=this;b["form"in b?"value":"textContent"in b?"textContent":"innerText"]=null===a?"":a+""}}},select:function(a){var b;return a?{on:"change",getValue:function(){return[].slice.call(this.options).filter(function(a){return a.selected}).map(function(a){return a.value})},setValue:function(a){for(a="string"==typeof a?[a]:a,b=this.options.length-1;b>=0;b--)this.options[b].selected=~a.indexOf(this.options[b].value)}}:{on:"change",getValue:function(){return this.value},setValue:function(a){var c,d=this;if(d.value=a,!a)for(c=d.options,b=c.length-1;b>=0;b--)c[b].value||(c[b].selected=!0)}}},display:function(a){return a="undefined"==typeof a?!0:a,{on:null,getValue:function(){var b=this,c=b.style.display||(window.getComputedStyle?getComputedStyle(b,null).getPropertyValue("display"):b.currentStyle.display),d="none"==c;return a?!d:!!d},setValue:function(b){this.style.display=a?b?"":"none":b?"none":"";
}}},file:function(a){if("undefined"==typeof FileReader)throw Error("FileReader is not supported by this browser");if(a&&(a="readAs"+a[0].toUpperCase()+a.slice(1),!FileReader.prototype[a]))throw Error(a+" is not supported by FileReader");return{on:function(b){var d=function(){var d=this.files;d.length?c(d,a,function(a){b(a)}):b([])};this.addEventListener("change",d)},getValue:function(a){var b=a.domEvent||[];return this.multiple?b:b[0]||null}}},style:function(a){return{getValue:function(){var b=this;return b.style[a]||(window.getComputedStyle?getComputedStyle(b,null).getPropertyValue(a):b.currentStyle[a])},setValue:function(b){this.style[a]=b}}}},b.visibility=b.display,b.html=b.innerHTML,b.text=b.innerText,b.prop=b.property,b.attr=b.attribute,b}(c),g=function(){function DOMTokenList(a){this.el=a;for(var b=a.className.replace(/^\s+|\s+$/g,"").split(/\s+/),c=0;c<b.length;c++)d.call(this,b[c])}function defineElementGetter(a,b,c){Object.defineProperty?Object.defineProperty(a,b,{get:c}):a.__defineGetter__(b,c);
}if("undefined"!=typeof window){var a=function(a,b){return"boolean"==typeof b?this[b?"add":"remove"](a):this[this.contains(a)?"remove":"add"](a),this.contains(a)};if(window.DOMTokenList){var b=document.createElement("a");b.classList.toggle("x",!1),b.className&&(window.DOMTokenList.prototype.toggle=a)}if(!("undefined"==typeof window.Element||"classList"in document.documentElement)){var c=Array.prototype,d=c.push,e=c.splice,f=c.join;DOMTokenList.prototype={add:function(a){this.contains(a)||(d.call(this,a),this.el.className=this.toString())},contains:function(a){return-1!=this.el.className.indexOf(a)},item:function(a){return this[a]||null},remove:function(a){if(this.contains(a)){for(var b=0;b<this.length&&this[b]!=a;b++);e.call(this,b,1),this.el.className=this.toString()}},toString:function(){return f.call(this," ")},toggle:a},window.DOMTokenList=DOMTokenList,defineElementGetter(Element.prototype,"classList",function(){return new DOMTokenList(this)})}}}(),h=function(){"undefined"!=typeof window&&!function(a,b,c,d){
b[c]||(Element.prototype[c]=a[c]=b[c]=function(b,c,d){return(d=this).attachEvent("on"+b,function(b){b=b||a.event,b.target=b.target||b.srcElement,b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},b.which=b.button?2===b.button?3:4===b.button?2:b.button:b.keyCode,c.call(d,b)})},Element.prototype[d]=a[d]=b[d]=function(a,b){return this.detachEvent("on"+a,b)})}(window,document,"addEventListener","removeEventListener")}(),i=function(){if("undefined"!=typeof window){var a,b="classList",c=/\.(.+)/,d={},e=0;return a=function(a,b,c,d,e,f,g,h,i){return i=function(a,b){return new i.i(a,b)},i.i=function(d,f){c.push.apply(this,d?d.nodeType||d==a?[d]:""+d===d?/</.test(d)?((e=b.createElement(f||"div")).innerHTML=d,e.children):(f&&i(f)[0]||b).querySelectorAll(d):/f/.test(typeof d)?/c/.test(b.readyState)?d():i(b).on("DOMContentLoaded",d):"length"in d?d:[d]:c)},i.extend=function(a){for(g=arguments,e=1;e<g.length;e++)if(h=g[e])for(f in h)a[f]=h[f];
return a},i.fn=i.i.fn=i.i.prototype=c,c.is=function(a){return e=this[0],f=!!e&&(e.matches||e["webkit"+d]||e["moz"+d]||e["ms"+d]||e["o"+d]),!!f&&f.call(e,a)},i}(window,document,[],"MatchesSelector"),a.extend(a.fn,{on:function(b,f,g){var h,i,j,k,l,m,n,o,p,q,r,s=this;for("function"==typeof f&&(g=f,f=null),f&&(h=function(b){var c,d="x"+String(Math.random()).split(".")[1],e=this;e.setAttribute(d,d),c="["+d+'="'+d+'"] '+f,a(b.target).is(c+","+c+" *")&&g.call(e,b),e.removeAttribute(d)}),b=b.split(/\s/),p=0;p<b.length;p++)for(i=b[p].split(c),j=i[1],i=i[0],q=0;q<s.length;q++){for(k=s[q],l=k.b$=k.b$||++e,m=d[i+l]=d[i+l]||[],o=!1,r=0;r<m.length;r++)if(n=m[r],g==n.handler&&(!f||f==n.selector)){o=!0;break}o||(m.push({delegate:h,handler:g,namespace:j,selector:f}),k.addEventListener(i,h||g,!1))}return s},off:function(a,b,e){var f,g,h,i,j,k,l,m,n=this;for("function"==typeof b&&(e=b,b=null),a=a.split(/\s/),k=0;k<a.length;k++)for(f=a[k].split(c),g=f[1],f=f[0],l=0;l<n.length;l++)if(h=n[l],i=d[f+h.b$])for(m=0;m<i.length;m++)j=i[m],
e&&e!=j.handler&&e!=j.delegate||g&&g!=j.namespace||b&&b!=j.selector||(h.removeEventListener(f,j.delegate||j.handler),i.splice(m--,1));else g||b||h.removeEventListener(f,e);return n},hasClass:function(a){return!!this[0]&&this[0][b].contains(a)},addClass:function(a){return this.forEach(function(c){var d=c[b];d.add.apply(d,a.split(/\s/))}),this},removeClass:function(a){return this.forEach(function(c){var d=c[b];d.remove.apply(d,a.split(/\s/))}),this},toggleClass:function(a,c){return this.forEach(function(d){var e=d[b];"boolean"!=typeof c&&(c=!e.contains(a)),e[c?"add":"remove"].apply(e,a.split(/\s/))}),this},add:function(b){var c,d,f,g=a(this),h={};for(b=a(b),f=0;f<g.length;f++)d=g[f],c=d.b$=d.b$||++e,h[c]=1;for(f=0;f<b.length;f++)d=b[f],c=d.b$=d.b$||++e,h[c]||(h[c]=1,g.push(d));return g},not:function(b){var c,d,e=a(this);for(b=a(b),d=0;d<b.length;d++)~(c=e.indexOf(b[d]))&&e.splice(c,1);return e},find:function(b){var c=a();return this.forEach(function(d){c=c.add(a(b,d))}),c}}),a.parseHTML=function(b){
var c,d,e,f=document.createElement("div"),g={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_:[0,"",""]};for(b=b.replace(/^\s+|\s+$/g,""),g.optgroup=g.option,g.tbody=g.tfoot=g.colgroup=g.caption=g.thead,g.th=g.td,e=/<([\w:]+)/.exec(b),c=e&&g[e[1]]||g._,f.innerHTML=c[1]+b+c[2],d=c[0];d--;)f=f.children[0];return a(f.childNodes)},a.create=function create(a,b){var c,d,e,f;if("object"==typeof a&&(b=a,a=b.tagName),c=document.createElement(a),b)for(d in b)if(f=b[d],"attributes"==d&&"object"==typeof f)for(e in f)f.hasOwnProperty(e)&&c.setAttribute(e,f[e]);else{if("tagName"==d)continue;if("children"==d&&f)for(e=0;e<f.length;e++)c.appendChild(create(f[e]));else if("object"==typeof c[d]&&null!==c[d]&&"object"==typeof b)for(e in f)f.hasOwnProperty(e)&&(c[d][e]=f[e]);else c[d]=f;
}return c},function(a,b,c,d,e,f){var g,h=a.createElement("div").children;try{[].push.apply([],h)}catch(i){g=!0}return g=g||"function"==typeof h||a.documentMode<9,g&&(f=b.i[d="prototype"],b.i=function(g,h){for(e=g?g&&g.nodeType||g==window?[g]:"string"==typeof g?/</.test(g)?((c=a.createElement("div")).innerHTML=g,c.children):(h&&b(h)[0]||a).querySelectorAll(g):!/f/.test(typeof g)||g[0]||g[0].nodeType?g:/c/.test(a.readyState)?g():!function r(b){/in/.test(a.readyState)?setTimeout(r,9,b):b()}(g):f,d=[],c=e?e.length:0;c--;d[c]=e[c]);f.push.apply(this,d)},b.i[d]=f,f.is=function(a){var b,c=this[0],d=c.parentNode.querySelectorAll(a);for(b=0;b<d.length;b++)if(d[b]===c)return!0;return!1}),b}(document,a),a}}(),j=function(a){if("undefined"!=typeof window){var b,c="on off is hasClass addClass removeClass toggleClass add not find".split(/\s+/),d="function"==typeof window.$?window.$:null,e=!0;if(d){for(b=0;b<c.length;b++)if(!d.prototype[c[b]]){e=!1;break}d.parseHTML||(e=!1)}else e=!1;return e?d:a}}(i),
k=function(a,b,c){var d=function(){return[]};a.$=c||d,a.$b=a.balalaika=a.bQuery=a.bquery=b||d,a.useAs$=function(b){return a.$=this.$=c=b}}(c,i,j),l="undefined"!=typeof document&&8==document.documentMode,m=function(a,b,c){var d=a.initMK=function(a){return a[b]||Object.defineProperty(a,b,{value:{events:{},special:{},id:"mk"+Math.random()},enumerable:c,configurable:c,writable:c}),a};return function(a){return a._initMK?a._initMK():d(a),a}}(c,e,l),n=function(a,b,c){a._defineSpecial=function(d,e,f){if(!d||"object"!=typeof d||!d[b])return d;var g=d[b].special[e];return g||(g=d[b].special[e]={$nodes:a.$(),value:d[e],getter:null,setter:null,mediator:null},f||"sandbox"==e||Object.defineProperty(d,e,{configurable:!0,enumerable:!c,get:function(){return g.getter?g.getter.call(d):g.value},set:function(b){g.setter?g.setter.call(d,b):a.set(d,e,b,{fromSetter:!0})}})),g}}(c,e,l),o=function(a,b){var c,d,e;c=a.define=function(a,b,d){if(!a||"object"!=typeof a)return a;var e;if("object"==typeof b){for(e in b)c(a,e,b[e]);
return a}return Object.defineProperty(a,b,d),a},d=a.defineGetter=function(c,e,f){if(!c||"object"!=typeof c)return c;b(c);var g,h;if("object"==typeof e){for(g in e)e.hasOwnProperty(g)&&d(c,g,e[g]);return c}return h=a._defineSpecial(c,e),h.getter=function(){return f.call(c,{value:h.value,key:e,self:c})},c},e=a.defineSetter=function(c,d,f){if(!c||"object"!=typeof c)return c;b(c);var g;if("object"==typeof d){for(g in d)d.hasOwnProperty(g)&&e(c,g,d[g]);return c}return a._defineSpecial(c,d).setter=function(a){return f.call(c,a,{value:a,key:d,self:c})},c}}(c,m),p=function(a,b,c,d){a.linkProps=function(e,f,g,h,i){function getEvtName(a){var b,c;return a.length>1?(c=a.length-1,b=a.slice(0,c).join(".")+"@_rundependencies:"+a[c]):b="_rundependencies:"+a,b}if(!e||"object"!=typeof e)return e;c(e);var j,k,l,m,n,o,p,q,r=typeof i;if(q=function(c){var o=[],p=c._protect;if(!p){p=c._protect=c._protect||{};for(m in i)c[m]=i[m]}if(!(f+e[b].id in p)){if("object"==typeof g[0])for(m=0;m<g.length;m+=2)for(j=g[m],
l="string"==typeof g[m+1]?g[m+1].split(/\s/):g[m+1],n=0;n<l.length;n++)o.push(d.deepFind(j,l[n]));else for(m=0;m<g.length;m++)k=g[m],j=e,o.push(d.deepFind(j,k));p[f+e[b].id]=1,a._defineSpecial(e,f,i.hideProperty),a.set(e,f,h.apply(e,o),c)}},g="string"==typeof g?g.split(/\s+/):g,"boolean"==r&&(p=i),"object"!=r&&(i={}),"boolean"==r&&(i.setOnInit=p),i.fromDependency=!0,h=h||function(a){return a},q=i.debounce?d.debounce(q):q,"object"==typeof g[0])for(m=0;m<g.length;m+=2)for(j=c(g[m]),l="string"==typeof g[m+1]?g[m+1].split(/\s/):g[m+1],n=0;n<l.length;n++)o=l[n].split("."),a[o.length>1?"on":"_fastAddListener"](j,getEvtName(o),q);else for(m=0;m<g.length;m++)k=g[m],j=e,o=k.split("."),a[o.length>1?"on":"_fastAddListener"](j,getEvtName(o),q);return i.setOnInit!==!1&&q.call("object"==typeof g[0]?g[0]:e,{key:"object"==typeof g[0]?g[1]:g[0]}),e}}(c,e,m,d),q=function(a,b){a.mediate=function(c,d,e){if(!c||"object"!=typeof c)return c;b(c);var f,g,h=typeof d;if("object"==h&&!(d instanceof Array)){for(f in d)d.hasOwnProperty(f)&&a.mediate(c,f,d[f]);
return c}for(d="string"==h?d.split(/\s/):d,f=0;f<d.length;f++)(function(b){g=a._defineSpecial(c,b),g.mediator=function(a){return e.call(c,a,g.value,b,c)},a.set(c,b,g.mediator(g.value),{fromMediator:!0})})(d[f]);return c},a.setClassFor=function(c,d,e,f){if(!c||"object"!=typeof c)return c;b(c);var g,h=typeof d;if("object"==h&&!(d instanceof Array)){for(g in d)d.hasOwnProperty(g)&&a.setClassFor(c,g,d[g],e);return c}for(d="string"==h?d.split(/\s/):d,f=f||function(a,b){var c;if(a.isMKArray)a.recreate(b);else if(a.isMKObject)a.jset(b);else for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},g=0;g<d.length;g++)a.mediate(c,d[g],function(a,b,d){var g;return b&&(b.instanceOf?b.instanceOf(e):b instanceof e)?(f.call(c,b,a,d),g=b):g=new e(a,c,d),g});return c}}(c,m),r=function(a,b){var c;a.get=function(a,b){return a&&a[b]},c=a.set=function(d,e,f,g){if(!d||"object"!=typeof d)return d;var h,i,j,k,l,m,n,o=typeof e,p=Number.isNaN||function(a){return"number"==typeof a&&isNaN(a)};if("undefined"==o)return d;if("object"==o){
for(l in e)e.hasOwnProperty(l)&&c(d,l,e[l],f);return d}if(!d[b]||!d[b].special||!d[b].special[e])return d[e]=f,d;if(h=d[b].special[e],i=d[b].events,j=h.value,k=!h.mediator||f===j||g&&(g.skipMediator||g.fromMediator)?f:h.mediator(f,j,e,d),m={value:k,previousValue:j,key:e,node:h.$nodes[0]||null,$nodes:h.$nodes,self:d},g&&"object"==typeof g)for(l in g)m[l]=g[l];return n=(k!==j||m.force)&&!m.silent,n&&(i["beforechange:"+e]&&a._fastTrigger(d,"beforechange:"+e,m),i.beforechange&&a._fastTrigger(d,"beforechange",m)),h.value=k,(k!==j||m.force||m.forceHTML||k!==f&&!p(k))&&(m.silentHTML||i["_runbindings:"+e]&&a._fastTrigger(d,"_runbindings:"+e,m)),n&&(i["change:"+e]&&a._fastTrigger(d,"change:"+e,m),i.change&&a._fastTrigger(d,"change",m)),k===j&&!m.force&&!m.forceHTML||m.skipLinks||i["_rundependencies:"+e]&&a._fastTrigger(d,"_rundependencies:"+e,m),d},a.remove=function(c,d,e){if(!c||"object"!=typeof c)return null;var f,g,h=String(d).split(/\s/),i={keys:h};if(e&&"object"==typeof e)for(g in e)i[g]=e[g];
for(g=0;g<h.length;g++)if(d=h[g],f=d in c){i.key=d,i.value=c[d];try{delete c[d]}catch(j){}c[b]&&(a.unbindNode(c,d),a.off(c,"change:"+d+" beforechange:"+d+" _runbindings:"+d+" _rundependencies:"+d),delete c[b].special[d],i.silent||(a._fastTrigger(c,"delete",i),a._fastTrigger(c,"delete:"+d,i)))}return c}}(c,e),s=function(a,b,c,d){var e,f;e=a.defaultBinders=[function(b){var c,d=b.tagName,e=a.binders;return"INPUT"==d?c=e.input(b.type):"TEXTAREA"==d?c=e.textarea():"SELECT"==d?c=e.select(b.multiple):"PROGRESS"==d?c=e.progress():"OUTPUT"==d&&(c=e.output()),c}],f=a.lookForBinder=function(a){var b,c,d=e;for(c=0;c<d.length;c++)if(b=d[c].call(a,a))return b},a.bindOptionalNode=function(a,b,c,d,e){return"object"==typeof b?h(a,b,c,d,!0):h(a,b,c,d,e,!0),a};var g=a.bindSandbox=function(d,e,f,g){var h,i,j,k=a.$(e);if(d[b]||c(d),!k.length){if(g)return d;throw Error('Binding error: node is missing for "'+key+'".'+("string"==typeof e?' The selector is "'+e+'"':""))}if(i=a._defineSpecial(d,"sandbox"),i.$nodes=i.$nodes.length?i.$nodes.add(k):k,
d.isMK&&(d.$sandbox=k,d.sandbox=k[0],d.$nodes.sandbox=i.$nodes,d.nodes.sandbox=i.$nodes[0]),!f||!f.silent){if(h={key:"sandbox",$nodes:k,node:k[0]||null},f)for(j in f)h[j]=f[j];a._fastTrigger(d,"bind:sandbox",h),a._fastTrigger(d,"bind",h)}return d},h=a.bindNode=function(e,i,j,k,l,m){function initBinding(c){var g,h={self:e,key:i,$nodes:o,node:c};if(null===k)g={};else if(y=f(c)){if(k)for(r in k)y[r]=k[r];g=y}else g=k||{};if(g.initialize){w={value:s.value};for(r in h)w[r]=h[r];g.initialize.call(c,w)}if(g.setValue&&(x=function(a){var d=e[b].special[i].value,f=a&&"string"==typeof a.onChangeValue&&"number"==typeof d?d+"":d;if(!a||a.changedNode!=c||a.onChangeValue!=f){w={value:d};for(r in h)w[r]=h[r];g.setValue.call(c,d,w)}},l.debounce&&(x=d.debounce(x)),a._fastAddListener(e,"_runbindings:"+i,x,null,{node:c}),!n&&x()),g.getValue&&(n&&l.assignDefaultValue!==!1||l.assignDefaultValue===!0)){z={fromNode:!0};for(r in l)z[r]=l[r];a.set(e,i,g.getValue.call(c,h),z)}g.getValue&&g.on&&(v={node:c,on:g.on,
instance:e,key:i,mkHandler:x,handler:function(b){if(!v.removed){var d,f,j=e[i],k={value:j,domEvent:b,originalEvent:b.originalEvent||b,preventDefault:function(){b.preventDefault()},stopPropagation:function(){b.stopPropagation()},which:b.which,target:b.target};for(f in h)k[f]=h[f];d=g.getValue.call(c,k),d!==j&&a.set(e,i,d,{fromNode:!0,changedNode:c,onChangeValue:d})}}},a.domEvents.add(v))}if(!e||"object"!=typeof e)return e;if("sandbox"==i)return g(e,j,l,m);e[b]||c(e);var n,o,p,q,r,s,t,u,v,w,x,y,z,A="undefined"!=typeof window?window:null;if(i instanceof Array){for(q=0;q<i.length;q++)h(e,i[q][0],i[q][1],i[q][2]||l,j);return e}if("string"==typeof i&&~i.indexOf(" ")&&(p=i.split(/\s+/),p.length>1)){for(q=0;q<p.length;q++)h(e,p[q],j,k,l,m);return e}if("object"==typeof i){for(q in i)i.hasOwnProperty(q)&&h(e,q,i[q],j,k,l);return e}if(j&&2==j.length&&j!==A&&!j[1].nodeName&&(j[1].setValue||j[1].getValue))return h(e,i,j[0],j[1],k,m);if(o=a._getNodes(e,j),!o.length){if(m)return e;throw Error('Binding error: node is missing for "'+i+'".'+("string"==typeof j?' The selector is "'+j+'"':""));
}if((!l||l.deep!==!1)&&~i.indexOf("."))return t=i.split("."),u=function(b){var c=b&&b.value;if(!c){c=e;for(var d=0;d<t.length-1;d++)c=c[t[d]]}h(c,t[t.length-1],o,k,b,m),b&&b.previousValue&&a.unbindNode(b.previousValue,t[t.length-1],o)},a._delegateListener(e,t.slice(0,t.length-2).join("."),"change:"+t[t.length-2],u),u(),e;for(l=l||{},s=a._defineSpecial(e,i),n="undefined"==typeof s.value,s.$nodes=s.$nodes.length?s.$nodes.add(o):o,e.isMK&&(e.$nodes[i]=s.$nodes,e.nodes[i]=s.$nodes[0]),q=0;q<o.length;q++)initBinding(o[q]);if(!l.silent){z={key:i,$nodes:o,node:o[0]||null};for(q in l)z[q]=l[q];a._fastTrigger(e,"bind:"+i,z),a._fastTrigger(e,"bind",z)}return e}}(c,e,m,d),t=function(a,b,c){var d=a.unbindNode=function(e,f,g,h){if(!e||"object"!=typeof e)return e;c(e);var i,j,k,l,m,n,o=typeof f,p=e[b].special[f];if(f instanceof Array){for(k=0;k<f.length;k++)h=g,d(e,f[k][0],f[k][1]||h,h);return e}if("string"==o&&(j=f.split(/\s/),j.length>1)){for(k=0;k<j.length;k++)d(e,j[k],g,h);return e}if(l=f.indexOf("."),
~l){m=f.split(".");var q=e;for(k=0;k<m.length-1;k++)q=q[m[k]];return a._undelegateListener(e,m.slice(0,m.length-2),"change:"+m[m.length-2]),d(q,m[m.length-1],g,h),e}if(null===f){for(f in e[b].special)e[b].special.hasOwnProperty(f)&&d(e,f,g,h);return e}if("object"==o){for(k in f)f.hasOwnProperty(k)&&d(e,k,f[k],g);return e}if(!g)return p&&p.$nodes?d(e,f,p.$nodes,h):e;if(2==g.length&&!g[1].nodeName&&(g[1].setValue||g[1].getValue||g[1].on))return d(e,f,g[0],h);if(!p)return e;for(i=a._getNodes(e,g),k=0;k<i.length;k++)a.domEvents.remove({key:f,node:i[k],instance:e}),p.$nodes=p.$nodes.not(i[k]),function(b){a._removeListener(e,"_runbindings:"+f,null,null,{node:b,howToRemove:function(a,b){return a.node==b.node}})}(i[k]);if(e.isMK&&(e.$nodes[f]=p.$nodes,e.nodes[f]=p.$nodes[0]||null,"sandbox"==f&&(e.sandbox=p.$nodes[0]||null,e.$sandbox=p.$nodes)),!h||!h.silent){n={key:f,$nodes:i,node:i[0]||null};for(k in h)n[k]=h[k];a._fastTrigger(e,"unbind:"+f,n),a._fastTrigger(e,"unbind",n)}return e}}(c,e,m),u=function(a,b,c,d){
a.parserBrackets={left:"{{",right:"}}"};a.parseBindings=function(d,e){function initLink(b,c,e){var f={};for(o=0;o<c.length;o++)f[c[o]]=new RegExp(j+c[o]+k,"g");a.linkProps(d,b,c,function(){var a,b=e;for(a=0;a<c.length;a++)b=b.replace(f[c[a]],arguments[a]);return b},{hideProperty:!0,setOnInit:!0})}var f=a.$,g=a.parserBrackets,h=g.left,i=g.right,j=h.replace(/(\[|\(|\?)/g,"\\$1"),k=i.replace(/(\]|\)|\?)/g,"\\$1"),l=new RegExp(j+"(.+?)"+k,"g"),m=new RegExp("^"+j+"(.+?)"+k+"$","g");if(!d||"object"!=typeof d)return f();if("string"==typeof e){if(e=f.parseHTML(e.replace(/^\s+|\s+$/g,"")),!~e.indexOf(h))return e}else if(e)e=f(e);else if(e=d[b]&&d[b].special&&d[b].special.sandbox&&d[b].special.sandbox.$nodes,!e||!e.length)return d;c(d);var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=[],E=0;for(o=0;o<e.length;o++)if(q=e[o],!q.outerHTML||~q.outerHTML.indexOf(h)||~q.outerHTML.indexOf(encodeURI(h))){for(n=q.getElementsByTagName("*"),p=0;p<n.length;p++)D[E++]=n[p];D[E++]=q}if(!D.length)return f();for(p=0;p<D.length;p++)if(q=D[p],
"TEXTAREA"!=q.tagName)for(o=0;o<q.childNodes.length;o++)if(A=q.childNodes[o],y=A.previousSibling,3==A.nodeType&&~A.nodeValue.indexOf(h)){z=A.nodeValue.replace(l,'<span mk-html="$1"></span>');try{y?y.insertAdjacentHTML("afterend",z):q.insertAdjacentHTML("afterbegin",z)}catch(F){B=document.body,y?(B.appendChild(y),y.insertAdjacentHTML("afterend",z),B.removeChild(y)):(B.appendChild(q),q.insertAdjacentHTML("afterbegin",z),B.removeChild(q))}q.removeChild(A)}for(o=0;o<e.length;o++)for(n=e[o].querySelectorAll("[mk-html]"),p=0;p<n.length;p++)D[E++]=n[p];for(o=0;o<D.length;o++)for(q=D[o],r=q.getAttribute("mk-html"),r&&(q.removeAttribute("mk-html"),a.bindNode(d,r,q,{setValue:function(a){this.innerHTML=a}})),s=q.attributes,p=0;p<s.length;p++)t=s[p],u=t.value,v=t.name,C=u.match(l),C&&(w=C.map(function(a){return a.replace(l,"$1")}),1==w.length&&m.test(u)?x=w[0]:(x=a.randomString(),initLink(x,w,u)),("value"==v&&"checkbox"!=q.type||"checked"==v&&"checkbox"==q.type)&&a.lookForBinder(q)?(q.setAttribute(v,""),
a.bindNode(d,x,q)):a.bindNode(d,x,q,a.binders.attr(v)));return e}}(c,e,m,d),v=function(a,b,c,d){function selectNodes(c,d){var e,f,g,h,i,j,k,l,m,n=a.$();if(!c||!c[b])return n;for(d=d.split(","),i=0;i<d.length;i++)if(h=d[i],e=/\s*:bound\(([^(]*)\)\s*([\S\s]*)\s*|\s*:sandbox\s*([\S\s]*)\s*/.exec(h)){if(m=void 0!==e[3]?"sandbox":e[1],l=void 0!==e[3]?e[3]:e[2],f=c[b].special[m]&&c[b].special[m].$nodes,!f||!f.length)continue;if(l)if(0===l.indexOf(">"))for(j=0;j<f.length;j++)g=f[j],k=a.randomString(),g.setAttribute(k,k),n=n.add($("["+k+'="'+k+'"]'+l,g)),g.removeAttribute(k);else n=n.add(f.find(l));else n=n.add(f)}else n=n.add(h);return n}var e,f,g;e=a.selectAll=function(c,d){var e;return c&&c[b]&&"string"==typeof d?/:sandbox|:bound\(([^(]*)\)/.test(d)?selectNodes(c,d):(e=c&&c[b]&&c[b].special,e=e&&e.sandbox&&e.sandbox.$nodes,e&&e.find(d)):a.$()},a.select=function(c,d){var e;return c&&c[b]&&"string"==typeof d?/:sandbox|:bound\(([^(]*)\)/.test(d)?selectNodes(c,d)[0]||null:(e=c&&c[b]&&c[b].special,
e=e&&e.sandbox&&e.sandbox.$nodes&&e.sandbox.$nodes[0],e&&e.querySelector(d)):a.$()},f=a.boundAll=function(e,g){var h,i,j,k,l=a.$;if(!e||"object"!=typeof e)return l();if(g&&~g.indexOf("."))return i=g.split("."),g=i.splice(-1)[0],f(d.deepFind(e,i),g);if(c(e),h=e[b].special,g=g?g:"sandbox",i="string"==typeof g?g.split(/\s+/):g,i.length<=1)return i[0]in h?h[i[0]].$nodes:l();for(j=l(),k=0;k<i.length;k++)j=j.add(h[i[k]].$nodes);return j},a.$bound=function(a,b){return f(a,b)},g=a.bound=function(a,e){var f,h,i;if(!a||"object"!=typeof a)return null;if(e&&~e.indexOf("."))return h=e.split("."),e=h.splice(-1)[0],g(d.deepFind(a,h),e);if(c(a),f=a[b].special,e=e?e:"sandbox",h="string"==typeof e?e.split(/\s+/):e,h.length<=1)return h[0]in f?f[h[0]].$nodes[0]||null:null;for(i=0;i<h.length;i++)if(h[i]in f&&f[h[i]].$nodes.length)return f[h[i]].$nodes[0];return null},a._getNodes=function(b,c){return"string"==typeof c&&!/</.test(c)&&/:sandbox|:bound\(([^(]*)\)/.test(c)?selectNodes(b,c):a.$(c)}}(c,e,m,d),w=/([^\:\:]+)(::([^\(\)]+)?(\((.*)\))?)?/,
x=function(a,b,c,d){var e=function(a,b,c){var d,e=document;if(e.createEvent)d=e.createEvent("Event"),d.initEvent(b,!0,!0),d.mkArgs=c,a.dispatchEvent(d);else if("undefined"==typeof Event||a.fireEvent){if(!a.fireEvent)throw Error("Cannot trigger DOM event");d=e.createEventObject(),d.mkArgs=c,a.fireEvent("on"+b,d)}else d=new Event(b,{bubbles:!0,cancelable:!0}),d.mkArgs=c,a.dispatchEvent(d);return d};a.trigger=function(f,g){var h,i,j,k,l,m,n,o,p,q,r,s=f&&"object"==typeof f&&f[b]&&f[b].events;if(g&&s)for(h=c.toArray(arguments,2),g=g.split(/\s/),i=0;i<g.length;i++)if(n=g[i],~n.indexOf("::")){if(o=d.exec(n),p=f[b].special[o[3]||"sandbox"],p=p&&p.$nodes,q=a.$(),r=o[5])for(j=0;j<p.length;j++)q=q.add(p.find(r));else q=p;for(j=0;j<q.length;j++)e(q[i],o[1],h)}else if(l=s[n])for(j=-1,k=l.length;++j<k;)(m=l[j]).callback.apply(m.ctx,h);return f},a._fastTrigger=function(a,c,d){var e,f,g,h=a[b].events[c];if(h)for(e=-1,f=h.length;++e<f;)(g=h[e]).callback.call(g.ctx,d)}}(c,e,d,w),y=function(a,b,c){var d=a.on=function(e,f,g,h,i,j){
if(!e)return e;b(e);var k,l,m,n,o;if("object"==typeof f&&!(f instanceof Array)){for(l in f)f.hasOwnProperty(l)&&d(e,l,f[l],g,h);return e}if(!g)throw Error('callback is not a function for event(s) "'+f+'"');for(f=f instanceof Array?f:c.trim(f).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),"boolean"!=typeof h&&"undefined"!=typeof h&&(k=i,i=h,h=k),l=0;l<f.length;l++)m=f[l],o=m.lastIndexOf("@"),~o?(n=m.slice(0,o),n?~n.indexOf("@")&&(n=n.replace(/([^@]*)@/g,function(a,b){return(b||"*")+"."}).replace(/\.$/,".*")||"*"):n="*",m=m.slice(o+1),a._delegateListener(e,n,m,g,i||e,j)):a._addListener(e,m,g,i,j);return h===!0&&g.call(i||e,{triggeredOnInit:!0}),e}}(c,m,d),z=function(a,b,c,d){var e=a.off=function(b,f,g,h){if(!b||"object"!=typeof b||!b[d])return b;var i,j,k,l;if("object"==typeof f&&!(f instanceof Array)){for(i in f)f.hasOwnProperty(i)&&e(b,i,f[i],g);return b}if(!f&&!g&&!h&&b[d])return b[d].events={},b;if(f=c.trim(f).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),"object"!=typeof b)return b;for(i=0;i<f.length;i++)l=f[i],
k=l.lastIndexOf("@"),~k?(j=l.slice(0,k),l=l.slice(k+1).replace(/@/g,"."),a._undelegateListener(b,j,l,g,h)):a._removeListener(b,l,g,h);return b}}(c,m,d,e),A=/_rundependencies:|_runbindings:|change:/,B=function(a,b,c,d,e){var f;a._fastAddListener=function(b,e,f,g,h){var i=b[c].events,j=i[e]||(i[e]=[]);return j.push({callback:f,context:g,ctx:g||b,name:e,node:h&&h.node}),d.test(e)&&a._defineSpecial(b,e.replace(d,"")),b},f=a._addListener=function(f,g,h,i,j){if(!f||"object"!=typeof f)return!1;b(f);var k,l,m,n,o=i||f,p=f[c].events,q=p[g]||(p[g]=[]),r=q.length,s={callback:h,context:i,ctx:o,name:g};for(k=0;r>k;k++)if(l=q[k],(l.callback==h||l.callback==h._callback)&&l.context==i)return!1;if(j){m={};for(k in j)m[k]=j[k];for(k in s)m[k]=s[k]}else m=s;return q.push(m),n=e.exec(g),n&&n[2]?a._addDOMListener(f,n[3]||"sandbox",n[1],n[5],h,o,m):d.test(g)&&a._defineSpecial(f,g.replace(d,"")),a._fastTrigger(f,"addevent:"+g,m),a._fastTrigger(f,"addevent",m),!0}}(c,m,e,A,w),C=function(a,b){a._removeListener=function(c,d,e,f,g){
if(!c||"object"!=typeof c||!c[b]||!c[b].events)return c;var h,i,j,k,l,m=c[b].events[d]||[],n=c[b].events[d]=[],o=/([^\:\:]+)(::([^\(\)]+)(\((.*)\))?)?/,p=0,q=m.length;if(g=g||{},j=o.exec(d),j&&j[2])a._removeDOMListener(c,j[3],j[1],j[5],e,f);else{for(i=0;q>i;i++)h=m[i],k=h.howToRemove||g.howToRemove,(k?!k(h,g):e&&e!==h.callback&&e._callback!==h.callback||f&&f!==h.context)?n[p++]=h:(l={name:d,callback:h.callback,context:h.context},a._fastTrigger(c,"removeevent:"+d,l),a._fastTrigger(c,"removeevent",l));n.length||delete c[b].events[d]}return c}}(c,e),D=function(a,b,c,d){var e=a._delegateTreeListener=function(b,c,d,g,h,i){if(!b||"object"!=typeof b)return b;var j;return j=function(a){var j=b[a.key];j&&(f(j,c,d,g,h,i),e(j,c,d,g,h,i))},each(b,function(a){f(a,c,d,g,h,i),e(a,c,d,g,h,i)}),j._callback=g,a._addListener(b,"change",j,h,i),b},f=a._delegateListener=function(e,g,h,i,j,k){if(!e||"object"!=typeof e)return e;b(e);var l,m=/([^\.]+)\.(.*)/.exec(g),n=m?m[1]:g;g=m?m[2]:"",k=k||{},n?"*"==n?e.isMKArray?(l=function(a){
(a&&a.added?a.added:e).forEach(function(a){a&&f(a,g,h,i,j,k)})},l._callback=i,a._addListener(e,"add",l,j,k),l()):e.isMKObject&&(l=function(a){var b=e[a.key];b&&a&&a.key in e[c].keys&&f(b,g,h,i,j,k)},e.each(function(a){f(a,g,h,i,j,k)}),l._callback=i,a._addListener(e,"change",l,j,k)):(l=function(b){if(!b||!b._silent){var l,m,o,p=e[n],q=!0;if(k.path=g,k.previousValue=b&&b.previousValue||k.previousValue&&k.previousValue[n],b&&b.previousValue&&b.previousValue[c]&&a._undelegateListener(b.previousValue,g,h,i,j,k),"object"==typeof p&&p&&f(p,g,h,i,j,k),d.test(h)&&(l=h.replace(d,""),!g&&k.previousValue&&k.previousValue[l]!==p[l])){if(o=k.previousValue[c].events[h])for(m=0;m<o.length;m++)o[m].path===g&&(q=!1);q&&a.set(p,l,p[l],{force:!0,previousValue:k.previousValue[l],previousObject:k.previousValue,_silent:!0})}}},l._callback=i,a._addListener(e,"change:"+n,l,j,k),l()):a._addListener(e,h,i,j,k)}}(c,m,e,A),E=function(a,b){var c=a._undelegateListener=function(d,e,f,g,h,i){if(!d||"object"!=typeof d)return d;
var j,k,l=/([^\.]+)\.(.*)/.exec(e),m=l?l[1]:e,n=e;if(e=l?l[2]:"",m)if("*"==m){if(d.isMKArray){if(g)c(d,e,"add",g,h,i);else for(j=d[b].events.add||[],k=0;k<j.length;k++)j[k].path==n&&c(d,e,"add",j[k].callback);d.forEach(function(a){a&&c(a,e,f,g,h)})}else if(d.isMKObject){if(g)c(d,e,"change",g,h);else for(j=d[b].events.change||[],k=0;k<j.length;k++)j[k].path==n&&c(d,e,"change",j[k].callback);d.each(function(a){a&&c(a,e,f,g,h)})}}else{if(g)a._removeListener(d,"change:"+m,g,h,i);else for(j=d[b].events["change:"+m]||[],k=0;k<j.length;k++)j[k].path==n&&a._removeListener(d,"change:"+m,j[k].callback);"object"==typeof d[m]&&c(d[m],e,f,g,h,i)}else a._removeListener(d,f,g,h,i)}}(c,e),F=function(a,b){var c={};a.domEvents={add:function(d){var e=a.$;d.node&&("function"==typeof d.on?d.on.call(d.node,d.handler):e(d.node).on(d.on.split(/\s+/).join(".mk ")+".mk",d.handler)),(c[d.instance[b].id]=c[d.instance[b].id]||[]).push(d)},remove:function(d){var e,f,g=c[d.instance[b].id],h=a.$;if(g)for(f=0;f<g.length;f++)e=g[f],
e.node===d.node&&(e.mkHandler&&a._removeListener(d.instance,"_runbindings:"+d.key,e.mkHandler),"string"==typeof e.on&&h(d.node).off(e.on+".mk",e.handler),e.removed=!0,c[d.instance[b].id].splice(f--,1))}}}(c,e),G=function(a,b,c){a._addDOMListener=function(d,e,f,g,h,i,j){if(!d||"object"!=typeof d)return d;b(d),g=g||null,j=j||{};var k=function(b){var c=this,f=a.$,g=f(c),j=b.originalEvent?b.originalEvent.mkArgs:b.mkArgs,k={self:d,node:c,$nodes:g,key:e,domEvent:b,originalEvent:b.originalEvent||b,preventDefault:function(){b.preventDefault()},stopPropagation:function(){b.stopPropagation()},which:b.which,target:b.target};h.apply(i,j?j:[k])},l=f+"."+d[c].id+e,m=function(a){a&&a.$nodes&&a.$nodes.on(l,g,k)},n=function(a){a&&a.$nodes&&a.$nodes.off(l,g,k)};return k._callback=h,a._defineSpecial(d,e),m._callback=n._callback=h,a._addListener(d,"bind:"+e,m,i,j)&&a._addListener(d,"unbind:"+e,n,i,j)&&m({$nodes:d[c].special[e]&&d[c].special[e].$nodes}),d}}(c,m,e),H=function(a,b){a._removeDOMListener=function(c,d,e,f,g,h,i){
return c&&"object"==typeof c&&c[b]&&c[b].events?(f=f||null,i=i||{},d&&c[b].special[d]&&(c[b].special[d].$nodes.off(e+"."+c[b].id+d,f,g),a._removeListener(c,"bind:"+d,g,h,i),a._removeListener(c,"unbind:"+d,g,h,i)),c):c}}(c,e),I=function(a,b){var c=a.once=function(d,e,f,g,h){var i;if(!d||"object"!=typeof d)return d;if("object"==typeof e){for(i in e)e.hasOwnProperty(i)&&c(d,i,e[i],f,g);return d}if(!f)throw Error('callback is not function for event "'+e+'"');for(b(d),e=e.split(/\s+/),i=0;i<e.length;i++)!function(b){var c=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}(f);c._callback=f,a.on(d,b,c,g)}(e[i]);return d}}(c,m),J=function(a,b,c){var d=a.onDebounce=function(b,e,f,g,h,i,j){if(!b||"object"!=typeof b)return b;var k,l;if("object"==typeof e){for(l in e)e.hasOwnProperty(l)&&d(b,l,e[l],f,g,h,i);return b}return"number"!=typeof g&&(j=i,i=h,h=g,g=0),k=c.debounce(f,g),k._callback=f,a.on(b,e,k,h,i,j)}}(c,m,d),K=function(a,b){return a.sym=b,a}(c,e),
L=function(a,b){return{isMK:!0,on:function(b,c,d,e,f){return a.on(this,b,c,d,e,f)},onDebounce:function(b,c,d,e,f,g){return a.onDebounce(this,b,c,d,e,f,g)},once:function(b,c,d){return a.once(this,b,c,d)},off:function(b,c,d){return a.off(this,b,c,d)},trigger:function(){var b=a.toArray(arguments);return b.unshift(this),a.trigger.apply(a,b)},bindNode:function(b,c,d,e,f){return a.bindNode(this,b,c,d,e,f)},bindOptionalNode:function(b,c,d,e){return a.bindOptionalNode(this,b,c,d,e)},bindSandbox:function(b,c){return a.bindSandbox(this,b,c)},unbindNode:function(b,c,d){return a.unbindNode(this,b,c,d)},boundAll:function(b){return a.boundAll(this,b)},$bound:function(b){return a.boundAll(this,b)},bound:function(b){return a.bound(this,b)},selectAll:function(b){return a.selectAll(this,b)},$:function(b){return a.selectAll(this,b)},select:function(b){return a.select(this,b)},eq:function(a){return"object"==typeof a&&null!==a&&this[b]&&a[b]&&this[b].id==a[b].id},defineGetter:function(b,c){return a.defineGetter(this,b,c);
},defineSetter:function(b,c){return a.defineSetter(this,b,c)},mediate:function(b,c){return a.mediate(this,b,c)},setClassFor:function(b,c,d){return a.setClassFor(this,b,c,d)},linkProps:function(b,c,d,e){return a.linkProps(this,b,c,d,e)},get:function(a){return this[a]},set:function(b,c,d){return a.set(this,b,c,d)},remove:function(b,c){return a.remove(this,b,c)},define:function(b,c){return a.define(this,b,c)},delay:function(b,c,d){return a.delay(this,b,c,d)},parseBindings:function(b){return a.parseBindings(this,b)},_initMK:function(){var c=this;return c[b]?c:(a.initMK(c),c.nodes={},c.$nodes={},c.sandbox=null,c.$sandbox=a.$(),c)},toString:function(){return"[object Matreshka]"},constructor:function Matreshka(){return this._initMK()}}}(K,e),M=function(a){return{version:"dev",Class:a,isXDR:a.isXDR}}(b),N=function(a,b,c,d){if(!a)throw Error("Class function is missing");if(![].forEach)throw Error("Internet Explorer 8 requires to use es5-shim: https://github.com/es-shims/es5-shim");d.to=function(a){
var b,c;if("object"==typeof a)if("length"in a){for(b=[],c=0;c<a.length;c++)b[c]=e.to(a[c]);b=(new e.Array).recreate(b)}else{b={};for(c in a)a.hasOwnProperty(c)&&(b[c]=e.to(a[c]));b=new e.Object(b)}else b=a;return b};var e=a(c);return b.extend(e.Matreshka=e.prototype.Matreshka=e,b,d)}(b,K,L,M),O=function(a,b){return{keys:function(){var b,c=this._initMK(),d=c[a].keys,e=[];for(b in d)d.hasOwnProperty(b)&&e.push(b);return e},toObject:function(){var b,c=this._initMK(),d={},e=c[a].keys;for(b in e)e.hasOwnProperty(b)&&(d[b]=c[b]);return d},toNative:function(){return this.toObject()},toJSON:function(){var b,c=this._initMK(),d={},e=c[a].keys;for(b in e)e.hasOwnProperty(b)&&(d[b]=c[b]&&c[b].toJSON?c[b].toJSON():c[b]);return d},keyOf:function(b){var c,d=this._initMK(),e=d[a].keys;for(c in e)if(e.hasOwnProperty(c))if(b&&b.isMK){if(b.eq(d[c]))return c}else if(b===d[c])return c;return null},jset:function(c,d,e){var f,g=this._initMK(),h=typeof c;if("undefined"==h)return g;if(c&&"object"==h){c=c.toJSON?c.toJSON():c;
for(f in c)g[a].keys[f]=1,b._defineSpecial(g,f),g.set(f,c[f],d);return g}return g[a].keys[c]=1,b._defineSpecial(g,c),g.set(c,d,e)},addDataKeys:function(c){var d,e=this._initMK(),f=arguments;if(!f.length||!c)return e;for(c=f.length>1?f:c instanceof Array?c:b.trim(c).split(/\s+/),d=0;d<c.length;d++)e[a].keys[c[d]]||(e[a].keys[c[d]]=1,b._defineSpecial(e,c[d]),b._fastTrigger(e,"modify",{key:c[d],value:e[c[d]]}));return e},removeDataKeys:function(c){var d,e,f=this._initMK(),g=arguments;if(!g.length||!c)return f;for(c=g.length>1?g:c instanceof Array?c:b.trim(c).split(/\s+/),d=0;d<c.length;d++)f[a].keys[c[d]]&&(delete f[a].keys[c[d]],e={key:c[d],value:f[c[d]]},b._fastTrigger(f,"remove",e),b._fastTrigger(f,"modify",e));return f},each:function(b,c){var d,e=this._initMK();for(d in e[a].keys)e[a].keys.hasOwnProperty(d)&&b.call(c,e[d],d,e);return e}}}(e,N),P=function(){var a=this,b=a.keys(),c=0;return{next:function(){return c>b.length-1?{done:!0}:{done:!1,value:a[b[c++]]}}}},Q="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",
R=function(a,b,c,d){if(!a)throw new Error("Matreshka is missing");var e=a.sym,f={"extends":a,isMKObject:!0,renderer:null,constructor:function MatreshkaObject(a){return this.jset(a)},_initMK:function(){var b,c=this;return c[e]?c:(a.prototype._initMK.call(c,arguments),c[e].keys={},a._fastAddListener(c,"addevent:modify",function(d){b||(a._fastAddListener(c,"change",function(b){b&&b.key in c[e].keys&&!b.silent&&a._fastTrigger(c,"modify",b)}),a._fastAddListener(c,"delete",function(b){b&&b.key in c[e].keys&&(delete c[e].keys[b.key],b.silent||(a._fastTrigger(c,"remove",b),a._fastTrigger(c,"modify",b)))}),b=!0)}),c)},hasOwnProperty:function(a){return this._initMK()[e].keys.hasOwnProperty(a)}};return a.extend(f,b),f[c]=d,a.Object=a.Class(f)}(N,O,P,Q),S=function(a,b,c){var d=function(d,e,f){if(e&&"object"==typeof e&&d.renderIfPossible&&!f.dontRender){e[a]||b(e);var g,h,i,j,k,l,m=d[a].id,n=e.renderer||d.itemRenderer,o=n===e.renderer?e:d,p=e[a].arraysNodes=e[a].arraysNodes||{},q=p[m];if(n){if(f.moveSandbox&&(q=c.bound(e,["sandbox"]))&&(p[m]=q),
q&&f.forceRerender){for(j=c.boundAll(e,["sandbox"]),k=0;k<j.length;k++)if(q==j[k]){c.unbindNode(e,"sandbox",q);break}q=p[m]=null}if(!q){if("function"==typeof n&&(n=n.call(o,e)),"string"!=typeof n||/<|{{/.test(n))h=n;else{if(h=c._getNodes(o,n),!(h=h&&h[0]))throw Error("renderer node is missing: "+n);h=h.innerHTML}if("string"==typeof h){if(g=c.$.parseHTML(c.trim(h)),g.length>1){for(l=document.createElement("span"),k=0;k<g.length;k++)l.appendChild(g[k]);g=g=c.$(l)}d.useBindingsParser!==!1&&c.parseBindings(e,g)}else g=c.$(h);if(!g.length)throw Error("renderer node is missing");e.bindRenderedAsSandbox!==!1&&c.bindNode(e,"sandbox",g),q=g[0],p[m]=q,f.silent||(i={node:q,$nodes:g,self:e,parentArray:d},e.onRender&&e.onRender(i),d.onItemRender&&d.onItemRender(e,i),c._fastTrigger(e,"render",i),e[a].events.afterrender&&setTimeout(function(){c._fastTrigger(e,"afterrender",i)},0))}return q}}};return function(b,c){var e,f,g,h,i=b[a],j=i.id,k=b.length,l=c.added,m=c.removed,n=l&&l.length,o=m&&m.length,p=i.special.container||i.special.sandbox;
if(p=p&&p.$nodes,p=p&&p[0],!p)return b;switch(c.method){case"push":for(g=k-n;k>g;g++)(e=d(b,b[g],c))&&p.appendChild(e);break;case"unshift":for(g=n-1;g+1;g--)(e=d(b,b[g],c))&&(p.firstChild?p.insertBefore(e,p.firstChild):p.appendChild(e));break;case"pull":case"pop":case"shift":for(g=0;o>g;g++)h=m[g],e=h&&h[a]&&h[a].arraysNodes&&h[a].arraysNodes[j],e&&p.removeChild(e);break;case"sort":case"reverse":for(g=0;k>g;g++)h=b[g],(e=h&&h[a]&&h[a].arraysNodes[j])&&p.appendChild(e);break;case"rerender":if(c.forceRerender)for(g=0;k>g;g++)h=b[g],e=h&&h[a]&&h[a].arraysNodes&&h[a].arraysNodes[j],e&&p.removeChild(e);for(g=0;k>g;g++)(e=d(b,b[g],c))&&p.appendChild(e);break;case"recreate":for(g=0;o>g;g++)h=m[g],e=h&&h[a]&&h[a].arraysNodes&&h[a].arraysNodes[j],e&&p.removeChild(e);for(g=0;k>g;g++)(e=d(b,b[g],c))&&p.appendChild(e);break;case"splice":for(f=b[c.args[0]<0?k+c.args[0]-n+o-1:c.args[0]-1],f=f&&f[a],f=f&&f.arraysNodes,f=f&&f[j],f=f&&f.nextSibling,f=f||p.firstChild,g=0;n>g;g++)(e=d(b,l[g],c))&&p.insertBefore(e,f);
for(g=0;o>g;g++)h=m[g],e=h&&h[a]&&h[a].arraysNodes&&h[a].arraysNodes[j],e&&p.removeChild(e)}return b}}(e,m,N),T=function(a,b,c){return function(d,e,f){var g,h=e.added,i=e.removed,j=d[b].events,k=e.method,l=h.length||i.length||"sort"==k||"reverse"==k;if(!e.silent){if(f&&j[f]&&a._fastTrigger(d,f,e),h.length&&(j.add&&a._fastTrigger(d,"add",e),j.addone))for(g=0;g<h.length;g++)a._fastTrigger(d,"addone",{self:d,added:h[g]});if(i.length&&(j.remove&&a._fastTrigger(d,"remove",e),j.removeone))for(g=0;g<i.length;g++)a._fastTrigger(d,"removeone",{self:d,removed:i[g]});l&&j.modify&&a._fastTrigger(d,"modify",e)}l&&!e.dontRender&&c(d,e)}}(N,e,S),U=function(a){return a?function(a){var b,c,d=this,e=d.length,f=a&&a.isMK;for(b=0;e>b;b++)if(c=d[b],f?a.eq(c):a===c)return b;return-1}:Array.prototype.indexOf}(l),V=function(a){return a?function(a){var b,c,d=this,e=d.length,f=a&&a.isMK;for(b=e-1;b>=0;b--)if(c=d[b],f?a.eq(c):a===c)return b;return-1}:Array.prototype.lastIndexOf}(l),W=function(a,b){b=b||[];var c,d=a.length-b.length;
for(c=0;c<b.length;c++)a[c]=b[c];for(c=0;d>c;c++)a.remove(c+b.length,{silent:!0});return a.length=b.length,a},X=function(a,b,c,d,e,f,g){function createMethod(c,e){var f,h;switch(c){case"forEach":return function(){var a=this;return i[c].apply(b?j(a):a,arguments),a};case"map":case"filter":case"slice":return function(){var d=this;return a.Array.from(i[c].apply(b?j(d):d,arguments))};case"every":case"some":case"reduce":case"reduceRight":case"join":return function(){var a=this;return i[c].apply(b?j(a):a,arguments)};case"sort":case"reverse":return function(){if(this.length<=1)return k;var a,k=this._initMK(),l=arguments,m=j(l),n=e?l[l.length-1]||{}:{},o=j(k);e&&m.pop(),b?(o=j(k),a=i[c].apply(o,m),g(k,o)):a=i[c].apply(k,m),h={returns:a,args:m,originalArgs:l,method:c,self:k,added:[],removed:[]};for(f in n)h[f]=n[f];return d(k,h,c),k};case"pop":case"shift":return function(){if(this.length){var a,k,l,m,n=this._initMK(),o=arguments,p=j(o),q=e?o[o.length-1]||{}:{};e&&p.pop(),b?(a=j(n),k=i[c].apply(a,p),
g(n,a)):k=i[c].apply(n,p),h={returns:k,args:p,originalArgs:o,method:c,self:n,added:l=[],removed:m=[k]};for(f in q)h[f]=q[f];return d(n,h,c),k}};case"push":case"unshift":return function(){var a,k,l,m,n=this._initMK(),o=arguments,p=j(o),q=e?o[o.length-1]||{}:{},r=n.length;if(e&&p.pop(),!p.length)return r;if(!q.skipMediator&&"function"==typeof n._itemMediator)for(f=0;f<p.length;f++)p[f]=n._itemMediator.call(n,p[f],"push"==c?f+r:f);b?(a=j(n),k=i[c].apply(a,p),g(n,a)):k=i[c].apply(n,p),h={returns:k,args:p,originalArgs:o,method:c,self:n,added:l=p,removed:m=[]};for(f in q)h[f]=q[f];return d(n,h,c),k};case"splice":return function(){var k,l,m,n=this._initMK(),o=arguments,p=j(o),q=e?o[o.length-1]||{}:{},r=n.length,s=p[0],t=j(p,2);if(s=0>s?r+s:s,e&&p.pop(),!q.skipMediator&&"function"==typeof n._itemMediator)for(f=2;f<p.length;f++)p[f]=n._itemMediator.call(n,p[f],s+f-2);if(b?(k=j(n),l=i[c].apply(k,p),g(n,k)):l=i[c].apply(n,p),m=l,t.length||m.length){h={returns:l,args:p,originalArgs:o,method:c,self:n,
added:t,removed:m};for(f in q)h[f]=q[f];d(n,h,c)}return a.Array.from(l)}}}var h={},i=Array.prototype,j=c.toArray;return"push pop unshift shift sort reverse splice map filter slice every some reduce reduceRight forEach join".split(" ").forEach(function(a){h[a]=createMethod(a)}),"push pop unshift shift sort reverse splice".split(" ").forEach(function(a){h[a+"_"]=createMethod(a,1)}),h.each=h.forEach,h.concat=function(){var b,c,d,e=arguments,f=this.toArray();for(c=0;c<e.length;c++)if(b=e[c],b instanceof Array||b instanceof a.Array||b&&b.instanceOf&&b.instanceOf(a.Array))for(d=0;d<b.length;d++)f.push(b[d]);return a.Array.from(f)},h.toString=function(){return this.toArray().join(",")},h.indexOf=e,h.lastIndexOf=f,h}(N,l,d,T,U,V,W),Y=function(a){return{of:function(){var b,c=new a.Array,d=arguments;for(c.length=d.length,b=0;b<d.length;b++)c[b]=d[b];return c},from:function(b,c,d){var e,f=new a.Array;for(f.length=b.length,e=0;e<b.length;e++)f[e]=c?c.call(d,b[e],e,b):b[e];return f}}}(N),Z=function(a,b,c,d,e,f,g){
return{mediateItem:function(a){var b,c=this,d=c.length;for(c._itemMediator=a,b=0;d>b;b++)c[b]=a.call(c,c[b],b);return c},recreate:function(b,c){function update(a,b){var c;if(a.isMKArray)a.recreate(b);else if(a.isMKObject)a.jset(b);else for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}b=b||[];var e,g,h,i,j,k,l,m,n=this._initMK(),o=b.length,p=n.length-o,q=n.toArray(),r=n.trackBy;if(c=c||{},r)if(j={},"$index"==r)for(g=0;o>g;g++)b[g]=n[g]?update(n[g],b[g]):b[g];else{for(g=0;g<n.length;g++)j[n[g][r]]=n[g];for(g=0;o>g;g++)b[g][r]in j&&(b[g]=update(j[b[g][r]],b[g]))}if(n._itemMediator&&!c.skipMediator){for(e=[],g=0;o>g;g++)e[g]=n._itemMediator.call(n,b[g],g);b=e}for(g=0;o>g;g++)n[g]=b[g];for(g=0;p>g;g++){try{delete n[g+o]}catch(s){}delete n[a].special[g+o]}if(n.length=o,c.silent&&c.dontRender)return n;if(m=n.toArray(),m.length)for(l=[],h=0,g=0;g<q.length;g++)~f.call(m,q[g])||(l[h++]=q[g]);else l=q;if(q.length)for(k=[],h=0,g=0;g<m.length;g++)~f.call(q,m[g])||(k[h++]=m[g]);else k=m;i={added:k,
removed:l,was:q,now:m,method:"recreate",self:n};for(g in c)i[g]=c[g];return d(n,i,"recreate"),n},toArray:function(){var a,b=this,c=[],d=b.length;for(c=[],a=0;d>a;a++)c[a]=b[a];return c},toNative:function(){return this.toArray()},rerender:function(a){var b,d={method:"rerender"};if(a&&"object"==typeof a)for(b in a)d[b]=a[b];return c(this,d)},toJSON:function(){var a,b=this,c=[],d=b.length;for(a=0;d>a;a++)b[a]&&b[a].toJSON?c.push(b[a].toJSON()):c.push(b[a]);return c},pull:function(a,b){var c,f,g,h,i=this._initMK(),j=i.toArray(),k=a,l=typeof a;if("number"!=l&&"string"!=l&&(a=i.indexOf(a),!~a))return null;if(c=j.splice(a,1)[0]||null){b=b||{},e(i,j,b),g={returns:c,args:[k],method:"pull",self:i,added:[],removed:f=c?[c]:[]};for(h in b)g[h]=b[h];d(i,g,"pull")}return c},restore:function(c,d){var e,f,h,i,j,k,l,m,n=this._initMK(),o=n[a],p=o.id,q=n.Model;if(c?e=b._getNodes(n,c):(h=o.special.container||o.special.sandbox,h=h&&h.$nodes,h=h&&h[0],e=h&&h.children),e&&e.length){for(m=[],i=0;i<e.length;i++)f=e[i],
j=q?new q:{},g(j),k=j[a].arraysNodes={},k[p]=f,j.bindRenderedAsSandbox!==!1&&b.bindNode(j,"sandbox",f),d&&d.silent||(l={node:f,$nodes:b.$(f),self:j,parentArray:n},j.onRender&&j.onRender(l),n.onItemRender&&n.onItemRender(j,l),b._fastTrigger(j,"render",l)),m[i]=j;n.recreate(m,d)}return n}}}(e,N,S,T,W,U,m),_=function(){var a=this,b=0;return{next:function(){return b>a.length-1?{done:!0}:{done:!1,value:a[b++]}}}},aa=function(a,b,c,d,e,f,g,h,i){if(!a)throw new Error("Matreshka is missing");var j={"extends":a,isMKArray:!0,length:0,itemRenderer:null,renderIfPossible:!0,Model:null,constructor:function MatreshkaArray(a){var b,c=this._initMK(),d=arguments.length;if(1==d&&"number"==typeof a)c.length=a;else{for(b=0;d>b;b++)c[b]=arguments[b];c.length=arguments.length}return c},_initMK:function(){var c,d=this;if(d[b])return d;if("Model"in d&&null!==d.Model&&"function"!=typeof d.Model)throw Error('Only function or null are valid values for Model, not "'+typeof d.Model+'"');return c=function(){var a=d.Model;
a&&d.mediateItem(function(b,c){return b&&(b.instanceOf?b.instanceOf(a):b instanceof a)?b:new a(b&&b.toJSON?b.toJSON():b,d,c)})},a.prototype._initMK.call(d),a._fastAddListener(d,"change:Model",c),a._fastAddListener(d,"change:itemRenderer",function(a){d.rerender({forceRerender:a&&"forceRerender"in a?a.forceRerender:!0})}),c(),d},toJSON:function(){var a,b=this,c=[],d=b.length;for(a=0;d>a;a++)b[a]&&b[a].toJSON?c[a]=b[a].toJSON():c[a]=b[a];return c},hasOwnProperty:function(a){return"length"==a||a<this.length&&a>=0}};return a.extend(j,c,e),j[i]=h,a.Array=a.Class(j),a.extend(a.Array,d),a.Array}(N,e,X,Y,Z,T,S,_,Q),ba=function(a,b,c,d){return a}(N,R,aa),ca=function(a){return a}(ba),ca.version="1.5.0",function(){var b="define";"undefined"!=typeof a&&("function"==typeof define&&define.amd?(a[b]&&(a[b]("matreshka",function(){return ca}),a[b]("bquery",function(){return ca.$b}),a[b]("balalaika",function(){return ca.$b}),a[b]("xclass",function(){return ca.Class}),a[b]("matreshka-magic",function(){return matreshka_magic;
})),define(function(){return ca})):"object"==typeof exports?module.exports=ca:(a.Matreshka=a.MK=ca,a.$b=ca.$b,a.Class=ca.Class))}()}("undefined"!=typeof window?window:Function("return this")());
//# sourceMappingURL=matreshka.min.map