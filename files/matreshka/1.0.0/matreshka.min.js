/*
	Matreshka v1.0.0 (2015-03-22)
	JavaScript Framework by Andrey Gubanov
	Released under the MIT license
	More info: http://matreshka.io
*/

!function(a,b){"function"==typeof define&&define.amd?define("xclass",b):a.Class=b()}(this,function(){var a=function(a){return!!a&&("[object Arguments]"===a.toString()||"object"==typeof a&&null!==a&&"length"in a&&"callee"in a)},b=function(){var a,b,c=-1;return"Microsoft Internet Explorer"==navigator.appName&&(a=navigator.userAgent,b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!=b.exec(a)&&(c=parseFloat(RegExp.$1))),c}(),c=document.documentMode,d=8===c,e="Internet Explorer "+b+" doesn't support Class function";if(~b&&8>b)throw Error(e);if(8>c)throw Error(e+'. Switch your "Document Mode" to "Standards"');var f=function(b){var c=i=b.constructor!==Object?b.constructor:function(){},e=b["extends"]=b["extends"]||b.extend,g=e&&e.prototype,h=b["implements"]=b["implements"]||b.implement,i=c,j={};if(delete b.extend,delete b.implement,g){for(var k in g)j[k]="function"==typeof g[k]?function(b){return function(c,d){return d=a(d)?d:Array.prototype.slice.call(arguments,1),b.apply(c,d)}}(g[k]):g[k];j.constructor=function(b){return function(c,d){return d=a(d)?d:Array.prototype.slice.call(arguments,1),b.apply(c,d)}}(g.constructor)}return d?(b.prototype=null,b.constructor=null,c=function(){if(this instanceof c){var a=new XDomainRequest;for(var b in c.prototype)"constructor"!==b&&(a[b]=c.prototype[b]);return a.hasOwnProperty=c.prototype.hasOwnProperty,i.apply(a,arguments),a}i.apply(this,arguments)},b.constructor=c,c.prototype=c.fn=b,c.parent=j,e&&f.IEInherits(c,e)):(b.constructor=c,c.prototype=c.fn=b,c.parent=j,e&&f.inherits(c,e)),h&&h.validate(c.prototype),c.same=function(){return function(){return c.apply(this,arguments)}},this instanceof f?new c:c};return f.inherits=function(a,b){var c=a.prototype,d=function(){};d.prototype=b.prototype,a.prototype=new d,a.prototype.constructor=a;for(var e in c)a.prototype[e]=c[e];"undefined"!=typeof Symbol&&c[Symbol.iterator]&&(a.prototype[Symbol.iterator]=c[Symbol.iterator]),a.prototype.instanceOf=function(a){return this instanceof a}},f.IEInherits=function(a,b){for(var c,d=a.prototype.hasOwnProperty,e=a.prototype.constructor,f=Object.prototype.hasOwnProperty;b;)c=c||b.prototype.hasOwnProperty,a.prototype=function(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d}(b.prototype,a.prototype),b=b.prototype&&b.prototype["extends"]&&b.prototype["extends"].prototype;d!==f?a.prototype.hasOwnProperty=d:c!==f&&(a.prototype.hasOwnProperty=c),a.prototype.constructor=e,a.prototype.instanceOf=function(b){for(var c=a;c;){if(c===b)return!0;c=c.prototype["extends"]}return!1}},f.Interface=function g(a,b){var c,d={},e=function(a){return"object"==typeof a&&null!==a&&"length"in a};if(a instanceof g){for(var f in a.propsMap)d[f]=1;c=e(b)?b:[].slice.call(arguments,1)}else c=e(a)?a:arguments;for(f=0;f<c.length;f++)d[c[f]]=1;this.propsMap=d,this.validate=function(a){for(var b in this.propsMap)if("function"!=typeof a[b])throw Error('[Class.Interface] Method "'+b+'" is not implemented in '+(a.constructor.name||a.name||"given")+" prototype")}},f.isXDR=d,f}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/polyfills/addeventlistener",b):b()}(this,function(){!function(a,b,c,d){b[c]||(Element.prototype[c]=a[c]=b[c]=function(b,c,d){return(d=this).attachEvent("on"+b,function(b){var b=b||a.event;b.target=b.target||b.srcElement,b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},b.which=b.button?2===b.button?3:4===b.button?2:b.button:b.keyCode,c.call(d,b)})},Element.prototype[d]=a[d]=b[d]=function(a,b){return this.detachEvent("on"+a,b)})}(window,document,"addEventListener","removeEventListener")}),function(a,b){"function"==typeof define&&define.amd?define("balalaika",["matreshka_dir/polyfills/addeventlistener"],b):a.$b=b()}(this,function(){return function(a,b,c,d,e,f,g,h,i,j,k,l){return l=function(a,b){return new l.i(a,b)},l.i=function(d,e){c.push.apply(this,d?d.nodeType||d==a?[d]:""+d===d?/</.test(d)?((h=b.createElement(e||"div")).innerHTML=d,h.children):(e&&l(e)[0]||b).querySelectorAll(d):/f/.test(typeof d)?/c/.test(b.readyState)?d():l(b).on("DOMContentLoaded",d):d:c)},l.i[k="prototype"]=(l.extend=function(a){for(j=arguments,h=1;h<j.length;h++)if(k=j[h])for(i in k)a[i]=k[i];return a})(l.fn=l[k]=c,{on:function(a,b){return a=a.split(d),this.map(function(c){(d[h=a[0]+(c.b$=c.b$||++e)]=d[h]||[]).push([b,a[1]]),c["add"+f](a[0],b)}),this},off:function(a,b){return a=a.split(d),k="remove"+f,this.map(function(c){if(j=d[a[0]+c.b$],h=j&&j.length)for(;i=j[--h];)b&&b!=i[0]||a[1]&&a[1]!=i[1]||(c[k](a[0],i[0]),j.splice(h,1));else!a[1]&&c[k](a[0],b)}),this},is:function(a){return h=this[0],i=!!h&&(h.matches||h["webkit"+g]||h["moz"+g]||h["ms"+g]),!!i&&i.call(h,a)}}),l}(window,document,[],/\.(.+)/,0,"EventListener","MatchesSelector")}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/polyfills/classlist",b):b()}(this,function(){function a(a){this.el=a;for(var b=a.className.replace(/^\s+|\s+$/g,"").split(/\s+/),c=0;c<b.length;c++)f.call(this,b[c])}function b(a,b,c){Object.defineProperty?Object.defineProperty(a,b,{get:c}):a.__defineGetter__(b,c)}var c=function(a,b){return"boolean"==typeof b?this[b?"add":"remove"](a):this[this.contains(a)?"remove":"add"](a),this.contains(a)};if(window.DOMTokenList){var d=document.createElement("a");d.classList.toggle("x",!1),d.className&&(window.DOMTokenList.prototype.toggle=c)}if(!("undefined"==typeof window.Element||"classList"in document.documentElement)){var e=Array.prototype,f=e.push,g=e.splice,h=e.join;a.prototype={add:function(a){this.contains(a)||(f.call(this,a),this.el.className=this.toString())},contains:function(a){return-1!=this.el.className.indexOf(a)},item:function(a){return this[a]||null},remove:function(a){if(this.contains(a)){for(var b=0;b<this.length&&this[b]!=a;b++);g.call(this,b,1),this.el.className=this.toString()}},toString:function(){return h.call(this," ")},toggle:c},window.DOMTokenList=a,b(Element.prototype,"classList",function(){return new a(this)})}}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/balalaika-extended",["balalaika","matreshka_dir/polyfills/classlist"],b):b(a.$b)}(this,function(a){var b,c,d="classList";if(!a)throw new Error("Balalaika is missing");return b=a.fn.on,c=a.fn.off,a.extend(a.fn,{on:function(a,c){return a.split(/\s/).forEach(function(a){b.call(this,a,c)},this),this},off:function(a,b){return a.split(/\s/).forEach(function(a){c.call(this,a,b)},this),this},hasClass:function(a){return!!this[0]&&this[0][d].contains(a)},addClass:function(a){return this.forEach(function(b){var c=b[d];c.add.apply(c,a.split(/\s/))}),this},removeClass:function(a){return this.forEach(function(b){var c=b[d];c.remove.apply(c,a.split(/\s/))}),this},toggleClass:function(a,b){return this.forEach(function(c){var e=c[d];"boolean"!=typeof b&&(b=!e.contains(a)),e[b?"add":"remove"].apply(e,a.split(/\s/))}),this},add:function(b){var c=a(this),d=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c};b=a(b).slice(),[].push.apply(c,b);for(var e=c.length-b.length;e<c.length;e++)([].indexOf?c.indexOf(c[e]):d(c,c[e]))!==e&&c.splice(e--,1);return c},find:function(b){var c=a();return this.forEach(function(d){c=c.add(a(b,d))}),c}}),a.parseHTML=function(b){var c,d,e=document.createElement("div"),f={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_:[0,"",""]};for(b=b.replace(/^\s+|\s+$/g,""),f.optgroup=f.option,f.tbody=f.tfoot=f.colgroup=f.caption=f.thead,f.th=f.td,c=f[/<([\w:]+)/.exec(b)[1]]||f._,e.innerHTML=c[1]+b+c[2],d=c[0];d--;)e=e.children[0];return a(e.children)},a.create=function(b,c){var d,e,f=document.createElement(b);if(c)for(d in c)if("attributes"==d&&"object"==typeof c[d])for(e in c[d])c[d].hasOwnProperty(e)&&f.setAttribute(e,c[d][e]);else f[d]=f[d]&&"object"==typeof c?a.extend(f[d]||{},c[d]):c[d];return f},function(a,b,c,d,e,f){var g,h=a.createElement("div").children;try{[].push.apply([],h)}catch(i){g=!0}return g=g||"function"==typeof h||a.documentMode<9,g&&(f=b.i[d="prototype"],b.i=function(g,h){for(e=g?g&&g.nodeType||g==window?[g]:"string"==typeof g?/</.test(g)?((c=a.createElement("div")).innerHTML=g,c.children):(h&&b(h)[0]||a).querySelectorAll(g):!/f/.test(typeof g)||g[0]||g[0].nodeType?g:/c/.test(a.readyState)?g():!function i(b){/in/(a.readyState)?setTimeout(i,9,b):b()}(g):f,d=[],c=e?e.length:0;c--;d[c]=e[c]);f.push.apply(this,d)},b.i[d]=f,f.is=function(a){var b,c=this[0],d=c.parentNode.querySelectorAll(a);for(b=0;b<d.length;b++)if(d[b]===c)return!0;return!1}),b}(document,a),a}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/dollar-lib",["matreshka_dir/balalaika-extended"],b):a.__DOLLAR_LIB=b(a.$b)}(this,function(a){var b,c="on off is hasClass addClass removeClass toggleClass add find".split(/\s+/),d="function"==typeof $?$:null,e=!0;if(d){for(b=0;b<c.length;b++)if(!d.prototype[c[b]]){e=!1;break}d.parseHTML||(e=!1)}else e=!1;return e?d:a}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/binders",b):a.__MK_BINDERS=b()}(this,function(){var a,b=function(a){return{on:null,getValue:null,setValue:a}};return a={innerHTML:function(){return b(function(a){this.innerHTML=null===a?"":a+""})},className:function(a){var c=!a.indexOf("!");return c&&(a=a.replace("!","")),b(function(b){this.classList.toggle(a,c?!b:!!b)})},property:function(a){return b(function(b){this[a]=b})},attribute:function(a){return b(function(b){this.setAttribute(a,b)})},textarea:function(){return a.input("text")},input:function(a){var b;switch(a){case"checkbox":return{on:"click keyup",getValue:function(){return this.checked},setValue:function(a){this.checked=a}};case"radio":return{on:"click keyup",getValue:function(){return this.value},setValue:function(a){this.checked=this.value==a}};case"submit":case"button":case"image":case"reset":return{};case"hidden":b="";break;case"text":case"email":case"password":case"tel":case"url":b="keyup paste";break;case"search":b="input paste";break;case"date":case"datetime":case"datetime-local":case"month":case"time":case"week":case"file":case"range":case"color":b="change";break;default:b="keyup paste change"}return{on:b,getValue:function(){return this.value},setValue:function(a){this.value!=a&&(this.value=a)}}},select:function(a){var b;return a?{on:"change",getValue:function(){return slice.call(this.options).filter(function(a){return a.selected}).map(function(a){return a.value})},setValue:function(a){for(a="string"==typeof a?[a]:a,b=this.options.length-1;b>=0;b--)this.options[b].selected=~a.indexOf(this.options[b].value)}}:{on:"change",getValue:function(){return this.value},setValue:function(a){if(this.value=a,!a)for(b=this.options.length-1;b>=0;b--)this.options[b].value||(this.options[b].selected=!0)}}},visibility:function(a){return a="undefined"==typeof a?!0:a,b(function(b){this.style.display=a?b?"":"none":b?"none":""})}}}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/matreshka-core",["xclass","balalaika","matreshka_dir/dollar-lib","matreshka_dir/binders"],b):a.MK=a.Matreshka=b(a.Class,a.$b,a.__DOLLAR_LIB,a.__MK_BINDERS)}(this,function(a,b,c,d){if(!a)throw Error("Class function is missing");if(![].forEach)throw Error("If you're using Internet Explorer 8 you should use es5-shim: https://github.com/kriskowal/es5-shim");var e="v0.3-rc.37",f={list:{},add:function(a){a.node&&("function"==typeof a.on?a.on.call(a.node,a.handler):c(a.node).on(a.on.split(/\s/).join(".mk ")+".mk",a.handler)),(this.list[a.instance.__id]=this.list[a.instance.__id]||[]).push(a)},rem:function(a){var b,d,e=this.list[a.instance.__id];if(e)for(d=0;d<e.length;d++)b=e[d],b.node===a.node&&(b.mkHandler&&a.instance.off("_runbindings:"+a.key,b.mkHandler),c(a.node).off(b.on+".mk",b.handler),this.list[a.instance.__id].splice(d--,1))}},g=[].slice,h=function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},i=function(a,b){var d,e,f,g=c();return b.replace(/:sandbox/g,":bound(sandbox)").split(",").forEach(function(b){(d=/:bound\(([^(]*)\)(.*)/.exec(h(b)))?(e=a.$bound(d[1]),(f=h(d[2]))?0==f.indexOf(">")?l(e,function(a){var b=j.randomString();a.setAttribute(b,b),g=g.add(c("["+b+'="'+b+'"]'+f,a)),a.removeAttribute(b)}):g=g.add(e.find(f)):g=g.add(e)):g=g.add(b)}),g},j=a({isMK:!0,isMKInitialized:!1,on:function(a,b,c,d,e){if(!b)throw Error('callback is not function for event(s) "'+a+'"');var f,g,i=this._initMK();for(a=a instanceof Array?a:h(a).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),"boolean"!=typeof c&&"undefined"!=typeof c&&(f=d,d=c,c=f),g=0;g<a.length;g++)i._on(a[g],b,d,e);return c===!0&&b.call(d||i,{triggeredOnInit:!0}),i},onDebounce:function(a,b,c,d,e,f){var g;return"number"!=typeof c&&(f=e,e=d,d=c,c=0),g=j.debounce(b,c),g._callback=b,this.on(a,g,d,e,f)},_on:function(a,b,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r=a.indexOf("@"),s=this._initMK(),t=d||s,u=/^(.*?)\((.*)\)/;return~r?(k=a.slice(0,r),a=a.slice(r+1),l=function(c){var e,f=s[k];f&&f.isMK&&(e=function(a){a&&a.private||b.apply(this,arguments)},e._callback=b,f.on(a,e,t)),c&&c.previousValue&&c.previousValue.isMK&&c.previousValue.off(a,b,d)},l._callback=b,s.on("change:"+k,l,!0,s,a)):(a=a.replace("::(","::sandbox("),f=a.replace(/\(.+\)/,""),i=s.__events[f]||(s.__events[f]=[]),j={callback:b,context:d,ctx:t,xtra:e},i.some(function(a){return a.callback==j.callback&&a.callback._callback==j.callback&&a.context==j.context})||(i.push(j),a.indexOf("change:")||s.makeSpecial(a.replace("change:","")),p=a.split("::"),q=p[0],k=p[1],k&&((h=u.exec(k))&&(g=j.selector=h[2],k=h[1]),o=function(a){var d,e,f=this,h=c(f),i=function(){b.call(t,{self:s,node:f,$nodes:h,key:k,domEvent:a,originalEvent:a.originalEvent||a,preventDefault:function(){a.preventDefault()},stopPropagation:function(){a.stopPropagation()},which:a.which,target:a.target})};g?(e="x"+String(Math.random()).split(".")[1],f.setAttribute(e,e),d="["+e+'="'+e+'"] '+g,c(a.target).is(d+","+d+" *")&&i(),f.removeAttribute(e)):i()},m=function(a){var b=a&&a.$nodes||s.__special[k]&&s.__special[k].$nodes,c=q+"."+s.__id+k;b&&b.on(c,o)},n=function(a){a.$nodes&&a.$nodes.off(q+"."+s.__id+k,o)},m._callback=n._callback=b,s._on("bind:"+k,m),m(),s._on("unbind:"+k,n)))),s},once:function(a,b,c){if(!b)throw Error('callback is not function for event "'+a+'"');var d,e=this._initMK();for(a=a.split(/\s/),d=0;d<a.length;d++)!function(a){var d=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}}(b);d._callback=b,e.on(a,d,c)}(a[d]);return this},off:function(a,b,c){var d,e=this._initMK();if(!a&&!b&&!c)return e.events={},e;for(a=h(a).replace(/\s+/g," ").split(/\s(?![^(]*\))/g),d=0;d<a.length;d++)e._off(a[d],b,c);return e},_off:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=a.indexOf("@"),n=this._initMK(),o=/^(.*?)\((.*)\)/;if(~m){if(i=a.slice(0,m),a=a.slice(m+1),b)n.off("change:"+i,b,c);else for(h=n.__events["change:"+i]||[],l=0;l<h.length;l++)h[l].xtra===a&&n.off("change:"+i,h[l].callback);n[i]&&n[i].isMK&&n[i].off(a,b,c)}else if(h=n.__events[a]){if(n.__events[a]=f=[],b||c)for(l=0;l<h.length;l++)g=h[l],(b&&b!==g.callback&&b!==g.callback._callback||c&&c!==g.context)&&f.push(g);f.length||delete n.__events[a],j=a.split("::"),k=j[0],i=j[1],i&&n.__special[i]&&((e=o.exec(i))&&(d=g.selector=e[2],i=e[1]),n.__special[i].$nodes.off(k+"."+n.__id+i),n.off("bind:"+i,b),n.off("unbind:"+i,b))}return n},trigger:function(a){var b,c,d=this._initMK();if(a)for(b=g.call(arguments),a=a.split(/\s/),c=0;c<a.length;c++)b=b.slice(),b[0]=a[c],d._trigger.apply(d,b);return d},_trigger:function(a){var b,c,d=this._initMK(),e=d.__events[a];return a&&e&&(b=g.call(arguments,1),c=function(a,b){for(var c,d=-1,e=a.length;++d<e;)(c=a[d]).callback.apply(c.ctx,b||[])},c(e,b)),d},bindNode:function(a,b,c,d,e){var g,h,i,l,m=this._initMK(),n="undefined"==typeof m[a];if(a instanceof Array){for(i=0;i<a.length;i++)m.bindNode(a[i][0],a[i][1],a[i][2]||d,b);return m}if("string"==typeof a&&(h=a.split(/\s/),h.length>1)){for(i=0;i<h.length;i++)m.bindNode(h[i],b,c,d);return m}if("object"==typeof a){for(i in a)a.hasOwnProperty(i)&&m.bindNode(i,a[i],b,c,d);return m}if(d=d||{},l=m.makeSpecial(a),g=m._getNodes(b),!g.length){if(e)return m;throw Error('Missed bound element for key "'+a+'"')}return l.$nodes=l.$nodes.add(g),"sandbox"==a&&(m.$sandbox=l.$nodes,m.sandbox=l.$nodes[0]),j.each(g,function(b){var e,h=null!==c?k("sandbox"==a?{}:j.lookForBinder(b)||{},c):{},i={self:m,key:a,$nodes:g,node:b};h.initialize&&h.initialize.call(b,k({value:l.value},i)),h.setValue&&(e=function(c){var d=m[a];(c.changedNode!=b||c.onChangeValue!==d)&&h.setValue.call(b,d,k({value:d},i))},m.on("_runbindings:"+a,e,!n)),n&&h.getValue&&d.assignDefaultValue!==!1&&m.set(a,h.getValue.call(b,i),k({fromNode:!0},d)),h.getValue&&h.on&&f.add({node:b,on:h.on,instance:m,key:a,mkHandler:e,handler:function(c){var d=m[a],e=h.getValue.call(b,k({value:d,domEvent:c,originalEvent:c.originalEvent||c,preventDefault:function(){c.preventDefault()},stopPropagation:function(){c.stopPropagation()},which:c.which,target:c.target},i));e!==d&&m.set(a,e,{fromNode:!0,changedNode:b,onChangeValue:e})}})}),d.silent||m._trigger("bind:"+a,k({key:a,$nodes:g,node:g[0]||null},d)),m},bindOptionalNode:function(a,b,c,d){var e=this;return"object"==typeof a?e.bindNode(a,b,c,!0):e.bindNode(a,b,c,d,!0),e},unbindNode:function(a,b,c){var d,e,g,h=this._initMK(),i=typeof a;if(a instanceof Array){for(g=0;g<a.length;g++)c=b,h.unbindNode(a[g][0],a[g][1]||c,c);return h}if("string"==i&&(e=a.split(/\s/),e.length>1)){for(g=0;g<e.length;g++)h.unbindNode(e[g],b,c);return h}if("object"==i&&null!==a){for(g in a)a.hasOwnProperty(g)&&h.unbindNode(g,a[g],b);return h}if(null===a){for(a in h.__special)h.__special.hasOwnProperty(a)&&h.unbindNode(a,b,c);return h}return b?(d=h._getNodes(b),j.each(d,function(a){f.rem({node:a,instance:h})},h),c&&c.silent||h._trigger("unbind:"+a,k({key:a,$nodes:d,node:d[0]||null},c)),h):h.__special[a]&&h.__special[a].$nodes?h.unbindNode(a,h.__special[a].$nodes,c):h},boundAll:function(a){var b,d,e,f=this._initMK(),g=f.__special;if(a=a?a:"sandbox",b="string"==typeof a?a.split(/\s/):a,b.length<=1)return b[0]in g?g[b[0]].$nodes:c();for(d=c(),e=0;e<b.length;e++)d=d.add(g[b[e]].$nodes);return d},$bound:function(a){return this.boundAll(a)},bound:function(a){var b,c,d=this._initMK(),e=d.__special;if(a=a?a:"sandbox",b="string"==typeof a?a.split(/\s/):a,b.length<=1)return b[0]in e?e[b[0]].$nodes[0]||null:null;for(c=0;c<b.length;c++)if(b[c]in e&&e[b[c]].$nodes.length)return e[b[c]].$nodes[0];return null},selectAll:function(a){var b=this._initMK();return/:sandbox|:bound\(([^(]*)\)/.test(a)?i(b,a):b.$bound("sandbox").find(a)},$:function(a){return this.selectAll(a)},select:function(a){return this.selectAll(a)[0]||null},_getNodes:function(a){return"string"==typeof a&&!/</.test(a)&&/:sandbox|:bound\(([^(]*)\)/.test(a)?i(this._initMK(),a):c(a)},makeSpecial:function(a){var b=this._initMK(),d=b.__special[a];return d||(d=b.__special[a]={$nodes:c(),value:b[a],getter:function(){return d.value},setter:function(c){b.set(a,c,{fromSetter:!0})},mediator:null},Object.defineProperty(b,a,{configurable:!0,get:function(){return d.getter.call(b)},set:function(a){d.setter.call(b,a)}})),d},eq:function(a){return"object"==typeof a&&null!==a&&this.__id==a.__id},defineGetter:function(a,b){var c,d,e=this._initMK();if("object"==typeof a){for(d in a)a.hasOwnProperty(d)&&e.defineGetter(d,a[d]);return e}return c=e.makeSpecial(a),c.getter=function(){return b.call(e,{value:c.value,key:a,self:e})},e},defineSetter:function(a,b){var c,d=this._initMK();if("object"==typeof a){for(c in a)a.hasOwnProperty(c)&&d.defineSetter(c,a[c]);return d}return d.makeSpecial(a).setter=function(c){return b.call(d,c,{value:c,key:a,self:d})},d},mediate:function(a,b){var c,d,e=this._initMK(),f=typeof a;if("object"==f&&!(a instanceof Array)){for(c in a)a.hasOwnProperty(c)&&e.mediate(c,a[c]);return e}for(a="string"==f?a.split(/\s/):a,c=0;c<a.length;c++)(function(a){d=e.makeSpecial(a),d.mediator=function(c){return b.call(e,c,d.value,a,e)},e.set(a,d.mediator(d.value),{fromMediator:!0})})(a[c]);return e},linkProps:function(a,b,c,d){var e,f,g,h,i,b="string"==typeof b?b.split(/\s/):b,j=function(d){var j=[],m=d._protect=d._protect||d.key+this.__id;if(m!==a+l.__id){if("object"==typeof b[0])for(h=0;h<b.length;h+=2)for(e=b[h],g="string"==typeof b[h+1]?b[h+1].split(/\s/):b[h+1],i=0;i<g.length;i++)j.push(e[g[i]]);else for(h=0;h<b.length;h++)f=b[h],e=l,j.push(e[f]);l.set(a,c.apply(l,j),k({},d,{fromDependency:!0}))}},l=this._initMK();if(c=c||function(a){return a},"object"==typeof b[0])for(h=0;h<b.length;h+=2)for(e=b[h]._initMK(),g="string"==typeof b[h+1]?b[h+1].split(/\s/):b[h+1],i=0;i<g.length;i++)e.makeSpecial(g[i]),e.on("_rundependencies:"+g[i],j);else for(h=0;h<b.length;h++)f=b[h],e=this,e.makeSpecial(f),e.on("_rundependencies:"+f,j);return d!==!1&&j.call("object"==typeof b[0]?b[0]:this,{key:"object"==typeof b[0]?b[1]:b[0]}),this},get:function(a){return this[a]},set:function(a,b,c){var d,e,f,g,h=this,i=typeof a,j=Number.isNaN||function(a){return"number"==typeof a&&j(a)};if("undefined"==i)return h;if("object"==i){for(g in a)a.hasOwnProperty(g)&&h.set(g,a[g],b);return h}return h.__special&&h.__special[a]?(d=h.__special[a],e=d.value,c=c||{},f=!d.mediator||b===e||c.skipMediator||c.fromMediator?b:d.mediator.call(h,b,e,a,h),d.value=f,(f!==e||c.force||c.forceHTML||f!==b&&!j(f))&&(c=k({},c,{value:f,previousValue:e,key:a,node:d.$nodes[0]||null,$nodes:d.$nodes,self:h}),c.silentHTML||h._trigger("_runbindings:"+a,c)),f===e&&!c.force||c.silent||h._trigger("change:"+a,c)._trigger("change",c),f===e&&!c.force&&!c.forceHTML||c.skipLinks||h._trigger("_rundependencies:"+a,c),h):(h[a]=b,h)},remove:function(a,b){var c,d,e=this._initMK(),f=String(a).split(/\s/);for(b=k({keys:f},b),d=0;d<f.length;d++)if(c=f[d]in e){b.key=f[d],b.value=e[f[d]],e.unbindNode(f[d]).off("change:"+f[d]),delete e.__special[f[d]];try{delete e[f[d]]}catch(g){}b&&b.silent||e._trigger("delete",b)._trigger("delete:"+f[d],b)}return e},define:function(a,b){var c=this;if("object"==typeof a){for(var d in a)c.define(d,a[d]);return c}return Object.defineProperty(c,a,b),c},delay:function(a,b,c){var d=this;return"object"==typeof b&&(c=b,b=0),setTimeout(function(){a.call(c||d)},b||0),d},_parseBindings:function(a){var b=this._initMK(),d="string"==typeof a?j.$.parseHTML(a.replace(/^\s+|\s+$/g,"")):c(a),e=d.find("*").add(d);return j.each(e,function(a){!function b(a){"TEXTAREA"!==a.tagName&&j.each(a.childNodes,function(c){var d,e=c.previousSibling;3==c.nodeType&&~c.nodeValue.indexOf("{{")?(d=c.nodeValue.replace(/{{([^}]*)}}/g,'<mk-bind mk-html="$1"></mk-bind>'),e?e.insertAdjacentHTML("afterend",d):a.insertAdjacentHTML("afterbegin",d),a.removeChild(c)):1==c.nodeType&&b(c)})}(a)}),e=d.find("*").add(d),j.each(e,function(a){var c=a.getAttribute("mk-html");c&&(b.bindNode(c,a,j.binders.innerHTML()),a.removeAttribute("mk-html")),j.each(a.attributes,function(c){var d,e,f=h(c.value),g=c.name;~f.indexOf("{{")&&(d=f.match(/{{[^}]*}}/g).map(function(a){return a.replace(/{{(.*)}}/,"$1")}),1==d.length&&/^{{[^}]*}}$/g.test(f)?e=d[0]:(e=j.randomString(),b.linkProps(e,d,function(){var a=f;return d.forEach(function(c){a=a.replace(new RegExp("{{"+c+"}}","g"),b[c])}),a})),("value"==g&&"checkbox"!=a.type||"checked"==g&&"checkbox"==a.type)&&j.lookForBinder(a)?b.bindNode(e,a):b.bindNode(e,a,j.binders.attribute(g)))})},b),d},_initMK:function(){var a=this;return a.isMKInitialized||k(a,{isMKInitialized:!0,Matreshka:j,sandbox:null,__id:"mk"+j.randomString(),__events:{},__special:{}}),a},toString:function(){return"[object Matreshka]"},constructor:function(){this._initMK()},getAnswerToTheUltimateQuestionOfLifeTheUniverseAndEverything:function(){this.delay(function(){alert(42)},236682e12)}}),k=j.extend=function(a,b){var c,d;if(a)for(c=1;c<arguments.length;c++)if(b=arguments[c])for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return a},l=j.each=function(a,b,c){if(a){if("length"in a)[].forEach.call(a,b,c);else for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a);return a}};return k(j,{binders:d,version:e,defaultBinders:[],Class:a,$:c,$b:b,useAs$:function(a){return j.$=c=a},isXDR:a.isXDR,noop:function(){},debounce:function(a,b,c){var d;return"number"!=typeof b&&(c=b,b=0),function(){var e=arguments,f=this;clearTimeout(d),d=setTimeout(function(){a.apply(c||f,e)},b||0)}},randomString:function(){return((new Date).getTime()-new Date(2013,4,3).getTime()).toString(36)+Math.floor(1679616*Math.random()).toString(36)},lookForBinder:function(a){var b,c,d=j.defaultBinders;for(c=0;c<d.length;c++)if(b=d[c].call(a,a))return b}}),j.defaultBinders.push(function(a){var b;return"INPUT"==a.tagName?b=d.input(a.type):"TEXTAREA"==a.tagName?b=d.textarea():"SELECT"==a.tagName&&(b=d.select(a.multiple)),b}),j}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/matreshka-object",["matreshka_dir/matreshka-core"],b):b(a.MK)}(this,function(a){if(!a)throw new Error("Matreshka is missing");var b,c={"extends":a,isMKObject:!0,renderer:null,constructor:function(a){this.jset(a)},keys:function(){var a,b=this,c=[];for(a in b._keys)b._keys.hasOwnProperty(a)&&c.push(a);return c},_initMK:function(){var b=this;return b.isMKInitialized?b:(a.Object.parent._initMK(b,arguments),b.set("_keys",{})._on("delete",function(a){a&&a.silent||b._trigger("modify",a)})._on("change",function(a){a&&a.key in b._keys&&!a.silent&&b._trigger("modify",a)}))},_on:function(b,c,d,e){var f,g=this._initMK();return 0==b.indexOf("@")?(b=b.slice(1),f=function(a){var e=g[a.key];e&&e.isMK&&a&&a.key in g._keys&&e._on(b,c,d||g)},g.each(function(a){a&&a.isMK&&a._on(b,c,d||g)},g),f._callback=c,g._on("change",f,g,b)):a.prototype._on.call(g,b,c,d,e),this},_off:function(b,c,d){var e=this._initMK();if(0==b.indexOf("@")){if(b=b.slice(1),c)e.off("change",c,d);else{events=e.__events.change||[];for(var f=0;f<events.length;f++)events[f].xtra==b&&e.off("change",events[f].callback)}e.each(function(a){a.isMK&&a.off(b,c,d)},e)}else a.prototype._off.call(e,b,c,d);return this},hasOwnProperty:function(a){return this._initMK()._keys.hasOwnProperty(a)},toObject:function(){var a,b=this._initMK(),c={},d=b._keys;for(a in d)d.hasOwnProperty(a)&&(c[a]=b[a]);return c},toNative:function(){return this.toObject()},toJSON:function(){var a=this._initMK(),b={},c=a._keys;for(var d in c)c.hasOwnProperty(d)&&(b[d]=a[d]&&a[d].toJSON?a[d].toJSON():a[d]);return b},keyOf:function(a){var b,c=this._initMK(),d=c._keys;for(b in d)if(d.hasOwnProperty(b))if(a&&a.isMK){if(a.eq(c[b]))return b}else if(a===c[b])return b;return null},jset:function(a,c,d){var e=this._initMK(),f=typeof a;if("undefined"==f)return e;if("object"==f){a=a.toJSON?a.toJSON():a;for(b in a)e.jset(b,a[b],c);return e}return e._keys[a]=1,e.makeSpecial(a),e.set(a,c,d)},remove:function(b,c){return this.removeDataKeys(b),a.Object.parent.remove(this,b,c)},addDataKeys:function(a){var c=this._initMK();if(!arguments.length)return c;for(a=arguments.length>1?arguments:a instanceof Array?a:String(a).split(/\s/),b=0;b<a.length;b++)c._keys[a[b]]=1,c.makeSpecial(a[b]);return c},removeDataKeys:function(a){var c=this._initMK();if(!arguments.length)return c;for(a=arguments.length>1?arguments:a instanceof Array?a:String(a).split(/\s/),b=0;b<a.length;b++)delete c._keys[a[b]];return c},each:function(a,b){var c,d=this._initMK();for(c in d._keys)d._keys.hasOwnProperty(c)&&a.call(b,d[c],c,d);return d}};return c["undefined"!=typeof Symbol?Symbol.iterator:"@@iterator"]=function(){var a=this,b=a.keys(),c=0;return{next:function(){return c>b.length-1?{done:!0}:{done:!1,value:a[b[c++]]}}}},a.Object=a.Class(c)}),function(a,b){"function"==typeof define&&define.amd?define("matreshka_dir/matreshka-array",["matreshka_dir/matreshka-core"],b):b(a.MK)}(this,function(a){if(!a)throw new Error("Matreshka is missing");var b=Array.prototype,c=b.slice,d=1,e=2,f=3,g=4,h=5,i=6,j={silent:!0,dontRender:!0,skipMediator:!0},k=function(a,b){if(a.length!=b.length)return!1;for(var c=0,d=a.length;d>c;c++)if(a[c]&&a[c].isMK&&a[c].eq(b[c])||a[c]!==b[c])return!1;return!0},l=a.isXDR?function(a){var b,c,d=this,e=a&&a.isMK;for(b=0;b<d.length;b++)if(c=d[b],e?a.eq(c):a===c)return b;return-1}:b.indexOf,m=a.isXDR?function(a){var b,c,d=this,e=a&&a.isMK;for(b=d.length-1;b>=0;b--)if(c=d[b],e?a.eq(c):a===c)return b;return-1}:b.lastIndexOf,n=function(l,m,n){var o;return l==d?function(){return b[m].apply(this.toArray(),arguments),this}:l==e?function(){return(new a.Array).recreate(b[m].apply(this.toArray(),arguments),j)}:l==f?function(){return b[m].apply(this.toArray(),arguments)}:l==g?function(){var d=this,e=arguments,f=c.call(e,0,n?-1:e.length),g=n?e[e.length-1]||{}:{},h=d.toArray(),i=b[m].apply(h,f);return k(d,h)||(d.recreate(h,j),g=a.extend({returns:i,args:f,originalArgs:c.call(e),method:m,self:d},g),g.silent||d._trigger(m,g),g.dontRender||d.processRendering(g)),d}:l==h?function(){var d,e=this,f=arguments,g=c.call(f,0,n?-1:f.length),h=n?f[f.length-1]||{}:{},i=e.toArray();if(!h.skipMediator&&"function"==typeof e._itemMediator&&("unshift"==m||"push"==m))for(o=0;o<g.length;o++)g[o]=e._itemMediator.call(e,g[o],o);return d=b[m].apply(i,g),k(e,i)||(e.recreate(i,j),h=a.extend({returns:d,args:g,originalArgs:c.call(f),method:m,self:e},h),h.silent||e._trigger(m,h),h.dontRender||e.processRendering(h)),d}:l==i?function(){var d,e=this,f=arguments,g=c.call(f,0,n?-1:f.length),h=n?f[f.length-1]||{}:{},i=e.toArray();if(!h.skipMediator&&"function"==typeof e._itemMediator)for(o=2;o<g.length;o++)g[o]=e._itemMediator.call(e,g[o],o);return d=b[m].apply(i,g),k(e,i)||(e.recreate(i,j),h=a.extend({returns:d,args:g,originalArgs:c.call(f),method:m,self:e},h),h.silent||e._trigger(m,h),h.dontRender||e.processRendering(h)),(new a.Array).recreate(d,j)}:void 0},o={"extends":a,isMKArray:!0,length:0,itemRenderer:null,renderIfPossible:!0,useBindingsParser:!1,Model:null,constructor:function(a){var b,c=this._initMK(),d=arguments.length;if(1==d&&"number"==typeof a)c.length=a;else{for(b=0;d>b;b++)c[b]=arguments[b];c.length=arguments.length}},mediateItem:function(a){var b,c=this;for(c._itemMediator=a,b=0;b<c.length;b++)c[b]=a.call(c,c[b],b);return c},_on:function(b,c,d,e){var f,g=this._initMK();return 0==b.indexOf("@")?(b=b.slice(1),f=function(a){(a&&a.added?a.added:g).forEach(function(a){a&&a.isMK&&a._on(b,c,d||g)})},f._callback=c,g._on("add",f,g,b),f.call(d||g)):a.prototype._on.call(g,b,c,d,e),this},_off:function(b,c,d){var e,f,g=this._initMK();if(0==b.indexOf("@")){if(b=b.slice(1),c)g.off("add",c,d);else for(e=g.__events.add||[],f=0;f<e.length;f++)e[f].xtra==b&&g.off("add",e[f].callback);g.forEach(function(a){a.isMK&&a.off(b,c,d)},g)}else a.prototype._off.call(g,b,c,d);return this},recreate:function(b,c){b=b||[];var d,e,f,g,h,i=this,j=i.length-b.length,k=i.toNative();if(c=c||{},i._itemMediator&&!c.skipMediator){for(d=[],e=0;e<b.length;e++)d[e]=i._itemMediator.call(i,b[e],e);b=d}for(e=0;e<b.length;e++)i[e]=b[e];for(e=0;j>e;e++)i.remove(e+b.length,{silent:!0});return i.length=b.length,h=i.toNative(),g=k.length?k.filter(function(a){return!~l.call(h,a)}):[],f=h.length?h.filter(function(a){return!~l.call(k,a)}):[],c=a.extend({added:f,removed:g,was:k,now:h,method:"recreate",self:i},c),c.silent||(f.length&&i._trigger("add",c),g.length&&i._trigger("remove",c),(f.length||g.length)&&i._trigger("recreate",c)),c.dontRender||i.processRendering(c),i},toArray:function(){var a,b,d=this._initMK();try{return c.call(d)}catch(e){for(a=[],b=0;b<d.length;b++)a[b]=d[b];return a}},toNative:function(){return this.toArray()},_initMK:function(){var b=this;return b.isMKInitialized?b:a.prototype._initMK.call(b).on("change:Model",function(){var a=b.Model;a&&b.mediateItem(function(c){return c&&c.isMK&&c.instanceOf(a)?c:new a(c&&c.toJSON?c.toJSON():c,b)})},!0).on("pull pop shift splice",function(c){c&&c.returns&&("splice"==c.method?c.returns.length&&b._trigger("remove",a.extend({removed:c.returns},c)):b._trigger("remove",a.extend({removed:[c.returns]},c)))
}).on("push unshift splice",function(d){var e;d&&d.args&&d.args.length&&("splice"==d.method?(e=c.call(d.args,2),e&&e.length&&b._trigger("add",a.extend({added:e},d))):b._trigger("add",a.extend({added:d.args},d)))}).on("add remove sort reverse",function(a){a.added=a.added||[],a.removed=a.removed||[],b._trigger("modify",a)}).on("add",function(a){var b=this,c=a&&a.added;c&&b.__events.addone&&c.forEach(function(a){b._trigger("addone",{self:b,added:a})})}).on("remove",function(a){var b=this,c=a&&a.removed;c&&b.__events.removeone&&c.forEach(function(a){b._trigger("removeone",{self:b,removed:a})})})},_renderOne:function(b,c){var d,e,f=this,g=f.__id,h=b.renderer||f.itemRenderer,i=h===b.renderer?b:f,j=b.bound(g);if(b[g]||(b[g]=f),(j=c.moveSandbox&&b.bound("sandbox"))&&b.bindNode(g,j),!j){if("function"==typeof h&&(h=h.call(i,b)),"string"!=typeof h||~h.indexOf("<")||~h.indexOf("{{"))e=h;else{if(e=i._getNodes(h),!(e=e&&e[0]))throw Error("renderer node is missing: "+h);e=e.innerHTML}d=f.useBindingsParser?b._parseBindings(e):"string"==typeof e?a.$.parseHTML(e.replace(/^\s+|\s+$/g,"")):a.$(e),b.bindRenderedAsSandbox!==!1&&d.length&&b.bindNode("sandbox",d),b.bindNode(g,d),b._trigger("render",{node:d[0],$nodes:d,self:b,parentArray:f}),j=d[0]}return j},processRendering:function(a){var b,c,d=this,e=d.__id,f=f=d.bound("container")||d.bound(),g=function(a){if(a&&a.isMK){var b=a.bound(e);return a.remove(e,{silent:!0}),b}},h=function(b){return b&&b.isMK&&d.renderIfPossible&&f&&!a.dontRender&&(d.itemRenderer||b&&b.renderer)&&d._renderOne(b,a)};switch(a.method){case"push":for(c=d.length-a.args.length;c<d.length;c++)(b=h(d[c]))&&f.appendChild(b);break;case"pull":case"pop":case"shift":(b=g(a.returns))&&b.parentNode.removeChild(b);break;case"unshift":for(c=a.args.length-1;c+1;c--)(b=h(d[c]))&&(f.children?f.insertBefore(b,f.firstChild):f.appendChild(b));break;case"sort":case"reverse":for(c=0;c<d.length;c++)(b=d[c].bound(e))&&f.appendChild(b);break;case"rerender":for(c=0;c<d.length;c++)(b=h(d[c]))&&f.appendChild(b);break;case"splice":for(c=0;c<a.returns.length;c++)(b=g(a.returns[c]))&&b.parentNode.removeChild(b);for(c=0;c<d.length;c++)(b=h(d[c]))&&f.appendChild(b);break;case"recreate":for(c=0;c<a.removed.length;c++)(b=g(a.removed[c]))&&f.removeChild(b);for(c=0;c<d.length;c++)(b=h(d[c]))&&f.appendChild(b)}return d},rerender:function(){return this.processRendering({method:"rerender"})},hasOwnProperty:function(a){return"length"==a||a<this.length&&a>=0},toJSON:function(){for(var a=[],b=0;b<this.length;b++)a.push(this[b]&&this[b].toJSON?this[b].toJSON():this[b]);return a},concat:function(){var b,c,d,e=arguments,f=this.toArray();for(c=0;c<e.length;c++)if(b=e[c],b instanceof Array||b&&b.instanceOf&&b.instanceOf(a.Array))for(d=0;d<b.length;d++)f.push(b[c]);return(new a.Array).recreate(f)},pull:function(b,c){var d,e=this,f=e.toArray(),g=b,h=typeof b;return"number"==h||"string"==h||(b=e.indexOf(b),~b)?(d=f.splice(b,1)[0]||null,k(f,e)||(c=c||{},e.recreate(f,j),c=a.extend({returns:d,args:[g],method:"pull",self:e},c),c.silent||e._trigger("pull",c),e.processRendering(c)),d):null},push:n(h,"push"),pop:n(h,"pop"),unshift:n(h,"unshift"),shift:n(h,"shift"),sort:n(g,"sort"),reverse:n(g,"reverse"),splice:n(i,"splice"),push_:n(h,"push",!0),pop_:n(h,"pop",!0),unshift_:n(h,"unshift",!0),shift_:n(h,"shift",!0),sort_:n(g,"sort",!0),reverse_:n(g,"reverse",!0),splice_:n(i,"splice",!0),map:n(e,"map"),filter:n(e,"filter"),slice:n(e,"slice"),every:n(f,"every"),some:n(f,"some"),reduce:n(f,"reduce"),reduceRight:n(f,"reduceRight"),forEach:n(d,"forEach"),each:n(d,"forEach"),toString:n(f,"toString"),join:n(f,"join"),indexOf:l,lastIndexOf:m};return o["undefined"!=typeof Symbol?Symbol.iterator:"@@iterator"]=function(){var a=this,b=0;return{next:function(){return b>a.length-1?{done:!0}:{done:!1,value:a[b++]}}}},a.Array=a.Class(o)}),"function"==typeof define&&define.amd&&define("matreshka",["matreshka_dir/matreshka-core","matreshka_dir/matreshka-object","matreshka_dir/matreshka-array"],function(a){return a}),"function"==typeof define&&define.amd?define(["matreshka"],function(a){return a}):"object"==typeof exports&&(module.exports=Matreshka);
//# sourceMappingURL=matreshka.min.map