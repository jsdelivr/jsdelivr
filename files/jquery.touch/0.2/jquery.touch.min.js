/* jquery.touch.js v0.2 | (c) n33 | n33.co | MIT licensed */
(function(k){function d(c,a){this.settings=k.extend(m,a);this.element=c;this.inDrag=this.inTap=!1;this.tapScrollTop=this.timerTapAndHold=this.timerTap=this.dragStart=this.tapStart=null;this.mouseDown=!1;this.ey=this.ex=this.y=this.x=null;this.taps=0;"ontouchstart"in window&&(this.settings.useMouse=!1);this.init()}var l=k(document),m={useMouse:!0,dragThreshold:10,dragDelay:200,swipeThreshold:30,tapDelay:250,tapAndHoldDelay:750,allowDefault:{swipe:!1,drag:!1}};d.prototype.init=function(){var c=this;
c.element.on("touchstart",function(a){c.doStart(a,a.originalEvent.touches[0].pageX,a.originalEvent.touches[0].pageY)}).on("touchmove",function(a){c.doMove(a,a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY)}).on("touchend",function(a){c.doEnd(a,a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY)});c.settings.useMouse&&(c.mouseDown=!1,c.element.on("mousedown",function(a){c.mouseDown=!0;c.doStart(a,a.pageX,a.pageY)}).on("mousemove",function(a){c.mouseDown&&
c.doMove(a,a.pageX,a.pageY)}).on("mouseup",function(a){c.doEnd(a,a.pageX,a.pageY);c.mouseDown=!1}))};d.prototype.uses=function(c){var a=k._data(this.element[0],"events");switch(c){case "swipe":return a.hasOwnProperty(c)||a.hasOwnProperty("swipeUp")||a.hasOwnProperty("swipeDown")||a.hasOwnProperty("swipeLeft")||a.hasOwnProperty("swipeRight");case "drag":return a.hasOwnProperty(c)||a.hasOwnProperty("dragStart")||a.hasOwnProperty("dragEnd");case "tapAndHold":case "doubleTap":return a.hasOwnProperty(c);
case "tap":return a.hasOwnProperty(c)||a.hasOwnProperty("doubleTap")||a.hasOwnProperty("tapAndHold")}return!1};d.prototype.scrolled=function(){return this.tapScrollTop!=l.scrollTop()};d.prototype.cancel=function(c){this.taps=0;this.inDrag=this.inTap=!1;this.dragStart=this.tapStart=null;c&&(this.mouseDown=!1)};d.prototype.doStart=function(c,a,e){var b=this,f=b.element.offset();c.stopPropagation();(b.uses("swipe")&&!b.settings.allowDefault.swipe||b.uses("drag")&&!b.settings.allowDefault.drag)&&c.preventDefault();
b.uses("tapAndHold")&&b.element.css("-webkit-touch-callout","none").css("-webkit-user-select","none");b.x=a;b.y=e;b.ex=a-f.left;b.ey=e-f.top;b.tapStart=Date.now();b.tapScrollTop=l.scrollTop();window.clearTimeout(b.timerTap);b.timerTap=window.setTimeout(function(){b.inTap&&0<b.taps&&(b.element.trigger(2==b.taps?"doubleTap":"tap",{taps:b.taps,x:b.x,y:b.y,ex:b.ex,ey:b.ey,duration:Date.now()-b.tapStart}),b.cancel());b.timerTap=null},b.settings.tapDelay);b.uses("tapAndHold")&&(window.clearTimeout(b.timerTapAndHold),
b.timerTapAndHold=window.setTimeout(function(){b.inTap&&(b.element.trigger("tapAndHold",{x:b.x,y:b.y,ex:b.ex,ey:b.ey,duration:Date.now()-b.tapStart}),b.cancel());b.timerTapAndHold=null},b.settings.tapAndHoldDelay));b.inTap=!0};d.prototype.doMove=function(c,a,e){var b=this.element.offset(),f=(Math.abs(this.x-a)+Math.abs(this.y-e))/2;c.stopPropagation();(this.uses("swipe")&&!this.settings.allowDefault.swipe||this.uses("drag")&&!this.settings.allowDefault.drag)&&c.preventDefault();this.scrolled()?this.cancel():
this.inDrag?this.element.trigger("drag",{x:a,y:e,ex:a-b.left,ey:e-b.top}):f>this.settings.dragThreshold&&(Date.now()-this.tapStart<this.settings.dragDelay?this.cancel():(this.cancel(),this.inDrag=!0,this.dragStart=Date.now(),this.uses("drag")&&c.preventDefault(),this.element.trigger("dragStart",{x:a,y:e,ex:a-b.left,ey:e-b.top})))};d.prototype.doEnd=function(c,a,e){var b=this.element.offset(),f=Math.abs(this.x-a),d=Math.abs(this.y-e),h,g;c.stopPropagation();if(this.scrolled())this.cancel();else if(this.inTap){if(this.taps++,
!this.timerTap||1==this.taps&&!this.uses("doubleTap")||2==this.taps&&this.uses("doubleTap"))this.element.trigger(2==this.taps?"doubleTap":"tap",{taps:this.taps,x:this.x,y:this.y,ex:this.ex,ey:this.ey,duration:Date.now()-this.tapStart}),this.cancel()}else if(this.inDrag){g=Date.now()-this.dragStart;c=Math.sqrt(Math.pow(Math.abs(this.x-a),2)+Math.pow(Math.abs(this.y-e),2));h=c/g;this.element.trigger("dragEnd",{start:{x:this.x,y:this.y,ex:this.ex,ey:this.ey},end:{x:a,y:e,ex:a-b.left,ey:e-b.top},distance:c,
duration:g,velocity:h});if(f>this.settings.swipeThreshold||d>this.settings.swipeThreshold)this.element.trigger("swipe",{distance:c,duration:g,velocity:h}),f>d?(h=f/g,a<this.x?this.element.trigger("swipeLeft",{distance:f,duration:g,velocity:h}):this.element.trigger("swipeRight",{distance:f,duration:g,velocity:h})):d>f&&(h=d/g,e<this.y?this.element.trigger("swipeUp",{distance:d,duration:g,velocity:h}):this.element.trigger("swipeDown",{distance:d,duration:g,velocity:h}));this.inDrag=!1}};k.fn.enableTouch=
function(c){var a;if(1<this.length)for(a=0;a<this.length;a++)k(this[a]).enableTouch();a=k(this);c=new d(a,c);a.get(0)._touch=c;return a}})(jQuery);
