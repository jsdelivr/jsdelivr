/** UI-Router Extras v.0.1.2 Module: sticky http://christopherthielen.github.io/ui-router-extras/ - MIT License */
!function(e,t){"use strict";function n(t,n){var r=n,a=r.inheritParams,i=(r.objectKeys,r.protoKeys),o=r.forEach,s=r.map,c={},l={},f=!1;this.registerStickyState=function(e){l[e.name]=e},this.enableDebug=this.debugMode=function(t){return e.isDefined(t)&&(f=t),f},this.$get=["$rootScope","$state","$stateParams","$injector","$log",function(t,n,r,l,v){function d(){var t={};return e.forEach(c,function(e,n){for(var r=m(e),a=0;a<r.length;a++){var i=r[a].parent;t[i.name]=t[i.name]||[],t[i.name].push(e)}t[""]&&(t.__inactives=t[""])}),t}function p(){var e={};return o(c,function(t){o(t.path,function(n){n!==t&&(e[n.name]=e[n.name]||[],e[n.name].push(t))})}),e}function m(e){var t=[];if(!e)return t;do e.sticky&&t.push(e),e=e.parent;while(e);return t.reverse(),t}function g(e,t,n,r){if(r)return"reload";var a=c[e.self.name];if(!a)return"enter";if(e.self===n)return"reload";var i=$(e.ownParams,t,a.locals.globals.$stateParams);return i?"reactivate":"reload"}function h(e,t){var n=c[e.name];if(!n)return null;if(!t)return n;var r=$(e.ownParams,t,n.locals.globals.$stateParams);return r?n:null}function $(e,t,n){return"function"==typeof e.$$equals?e.$$equals(t,n):x(t,n,e)}function x(t,n,r){if(!e.isArray(r)&&e.isObject(r)&&(r=i(r,["$$keys","$$values","$$equals","$$validates","$$new","$$parent"])),!r){r=[];for(var a in t)r.push(a)}for(var o=0;o<r.length;o++){var s=r[o];if(t[s]!=n[s])return!1}return!0}function b(e){var t=e.fromState.path,i=e.toState.path,o=e.toParams,s=0,u=i[s];for(e.options&&e.options.inherit&&(o=e.toParams=a(r,o||{},n.$current,e.toState));u&&u===t[s]&&$(u.ownParams,o,e.fromParams);)u=i[++s];return{keep:s,retained:t.slice(0,s),exiting:t.slice(s),entering:i.slice(s)}}var E={getInactiveStates:function(){return s(c,e.identity)},getInactiveStatesByParent:function(){return d()},processTransition:function(t){function n(e){return function(t){return-1===e.indexOf(t)}}function r(e,t){return e.concat(t)}function a(e){return function(t){return t[e]}}function i(e){return function(t){return t.type===e}}function o(e){return function(t){return t.parent===e}}function u(e){return!e.sticky}var l,f,v,d=b(t),m=s(c,e.identity),h=d.keep,$=n(d.entering),x=d.exiting[0]&&d.exiting[0].sticky&&d.entering.length>0;f=d.exiting.map(function(e){var t=-1!==d.entering.indexOf(e),n=x&&!t?"inactivate":"exit";return{type:n,state:e}});var E=t.options&&!!t.options.reload;v=d.entering.map(function(e){var n=g(e,t.toParams,t.reloadStateTree,E);return E=E||"reload"===n,{type:n,state:e}});var S=d.entering.map(function(e){return m.filter(o(e.parent))}).reduce(r,[]).filter($).filter(u).concat(m.filter(o(t.toState))),P=p(),y=S.map(function(e){return P[e.name]}).filter(e.isDefined).reduce(r,[]).concat(S).sort(function(e,t){return e.name.split(".").length-t.name.split(".").length}),k=f.filter(i("exit")).map(a("state")).concat(y);return l=m.filter(n(k)).filter(n(d.entering)).concat(f.filter(i("inactivate")).map(a("state"))),{keep:h,enter:new Array(h).concat(v.map(a("type"))),exit:new Array(h).concat(f.map(a("type"))),inactives:l,reactivatingStates:v.filter(i("reactivate")).map(a("state")),orphans:y}},stateInactivated:function(e){c[e.self.name]=e,e.self.status="inactive",e.self.onInactivate&&l.invoke(e.self.onInactivate,e.self,e.locals.globals)},stateReactivated:function(e){c[e.self.name]&&delete c[e.self.name],e.self.status="entered",e.self.onReactivate&&l.invoke(e.self.onReactivate,e.self,e.locals.globals)},stateExiting:function(t,n,r){var a={};e.forEach(n,function(e){a[e.self.name]=!0}),e.forEach(c,function(n,r){!a[r]&&n.includes[t.name]&&(f&&v.debug("Exiting "+r+" because it's a substate of "+t.name+" and wasn't found in ",a),n.self.onExit&&l.invoke(n.self.onExit,n.self,n.locals.globals),e.forEach(n.locals,function(e,t){delete u.locals[t]}),n.locals=null,n.self.status="exited",delete c[r])}),r&&l.invoke(r,t.self,t.locals.globals),t.locals=null,t.self.status="exited",delete c[t.self.name]},stateEntering:function(e,t,n,r){var a=h(e);if(a&&(r||!h(e,t))){var i=e.locals;this.stateExiting(a),e.locals=i}e.self.status="entered",n&&l.invoke(n,e.self,e.locals.globals)},reset:function(r,a){function i(e){E.reset(e)}if("*"===r)return e.forEach(E.getInactiveStates(),i),!0;var o=n.get(r);if(!o)return!1;var s=h(o,a);return s?(E.stateExiting(s),t.$broadcast("$viewContentLoading"),!0):!1}};return E}]}function r(e){return{resolve:{},locals:{globals:o&&o.locals&&o.locals.globals},views:{},self:{},params:{},ownParams:f.hasParamSet?{$$equals:function(){return!0}}:[],surrogateType:e}}e.module("ct.ui.router.extras.sticky",["ct.ui.router.extras.core"]);var a=e.module("ct.ui.router.extras.sticky");n.$inject=["$stateProvider","uirextras_coreProvider"],a.provider("$stickyState",n);var i,o,s,u,c=[],l={},f={hasParamSet:!1};e.module("ct.ui.router.extras.sticky").run(["$stickyState",function(e){i=e}]),e.module("ct.ui.router.extras.sticky").config(["$provide","$stateProvider","$stickyStateProvider","$urlMatcherFactoryProvider","uirextras_coreProvider",function(n,a,v,d,p){function m(t,n,r){function a(e,t,n){return e[t]?e[t].toUpperCase()+": "+n.self.name:"("+n.self.name+")"}var o=E(r.inactives,function(e){return e.self.name}),s=E(n.toState.path,function(e,t){return a(r.enter,t,e)}),u=E(n.fromState.path,function(e,t){return a(r.exit,t,e)}),c=n.fromState.self.name+": "+e.toJson(n.fromParams)+":  -> "+n.toState.self.name+": "+e.toJson(n.toParams);t.debug("------------------------------------------------------"),t.debug("   Current transition: ",c),t.debug("Before transition, inactives are:   : ",E(i.getInactiveStates(),function(e){return e.self.name})),t.debug("After transition,  inactives will be: ",o),t.debug("Transition will exit:  ",u),t.debug("Transition will enter: ",s)}function g(e,t,n){e.debug("Current state: "+t.self.name+", inactive states: ",E(i.getInactiveStates(),function(e){return e.self.name}));for(var r=function(e,t){return"'"+t+"' ("+e.$$state.name+")"},a=function(e,t){return"globals"!=t&&"resolve"!=t},o=function(e){var t=E(S(e.locals,a),r).join(", ");return"("+(e.self.name?e.self.name:"root")+".locals"+(t.length?": "+t:"")+")"},s=o(t),u=t.parent;u&&u!==t;)""===u.self.name&&(s=o(n.$current.path[0])+" / "+s),s=o(u)+" / "+s,t=u,u=t.parent;e.debug("Views: "+s)}var h=p,$=h.internalStates,x=h.inherit,b=(h.inheritParams,h.forEach),E=h.map,S=h.filterObj;f.hasParamSet=!!d.ParamSet,u=e.extend(new r("__inactives"),{self:{name:"__inactives"}}),o=s=t,c=[],p.onStateRegistered(function(e){e.self.sticky===!0&&v.registerStickyState(e.self)});var P;n.decorator("$state",["$delegate","$log","$q",function(n,a,p){return o=n.$current,$[""]=o,o.parent=u,u.parent=t,u.locals=x(l,u.locals),o.locals=x(u.locals,o.locals),delete u.locals.globals,P=n.transitionTo,n.transitionTo=function(t,h,x){function S(t){var n=e.extend(new r("reactivate_phase1"),{locals:t.locals});return n.self=e.extend({},t.self),n}function y(t){var n=e.extend(new r("reactivate_phase2"),t),a=n.self.onEnter;return n.resolve={},n.views={},n.self.onEnter=function(){n.locals=t.locals,i.stateReactivated(t)},L.addRestoreFunction(function(){t.self.onEnter=a}),n}function k(e){var t=new r("inactivate");t.self=e.self;var n=e.self.onExit;return t.self.onExit=function(){i.stateInactivated(e)},L.addRestoreFunction(function(){e.self.onExit=n}),t}function w(e,t){var n=e.self.onEnter;return e.self.onEnter=function(){i.stateEntering(e,t,n)},L.addRestoreFunction(function(){e.self.onEnter=n}),e}function F(e,t){var n=e.self.onEnter;return e.self.onEnter=function(){i.stateEntering(e,t,n,!0)},L.addRestoreFunction(function(){e.self.onEnter=n}),e}function R(e){var t=e.self.onExit;return e.self.onExit=function(){i.stateExiting(e,J,t)},L.addRestoreFunction(function(){e.self.onExit=t}),e}var T=v.debugMode();u.locals||(u.locals=o.locals);var _=c.length;s&&(s(),T&&a.debug("Restored paths from pending transition"));var I,j,O,q,A=n.$current,C=n.params,M=x&&x.relative||n.$current,D=n.get(t,M),B=[],J=[];h=h||{},arguments[1]=h;var K=function(){},L=function(){I&&(U.path=I,I=null),j&&(A.path=j,j=null),e.forEach(L.restoreFunctions,function(e){e()}),L=K,s=null,c.splice(_,1)};if(L.restoreFunctions=[],L.addRestoreFunction=function(e){this.restoreFunctions.push(e)},D){var U=$[D.name];if(U){I=U.path,j=A.path;var V=x&&x.reload||!1,z=V&&(V===!0?I[0].self:n.get(V,M));x&&V&&V!==!0&&delete x.reload;var G={toState:U,toParams:h||{},fromState:A,fromParams:C||{},options:x,reloadStateTree:z};if(c.push(G),s=L,z){G.toParams.$$uirouterextrasreload=Math.random();var H=z.$$state().params,N=z.$$state().ownParams;if(f.hasParamSet){var Q=new d.Param("$$uirouterextrasreload");H.$$uirouterextrasreload=N.$$uirouterextrasreload=Q,L.restoreFunctions.push(function(){delete H.$$uirouterextrasreload,delete N.$$uirouterextrasreload})}else H.push("$$uirouterextrasreload"),N.push("$$uirouterextrasreload"),L.restoreFunctions.push(function(){H.length=H.length-1,N.length=N.length-1})}O=i.processTransition(G),T&&m(a,G,O);var W=U.path.slice(0,O.keep),X=A.path.slice(0,O.keep);e.forEach(u.locals,function(e,t){-1!=t.indexOf("@")&&delete u.locals[t]});var Y=function(e){return function(t,n){-1!==n.indexOf("@")&&(e[n]=t)}};b(O.inactives,function(e){b(e.locals,Y(u.locals))}),b(O.reactivatingStates,function(e){b(e.locals,Y(l))}),L.addRestoreFunction(function(){b(l,function(e,t){delete l[t]})}),e.forEach(O.enter,function(e,t){var n,r=U.path[t];"reactivate"===e?(n=S(r),W.push(n),X.push(n),B.push(y(r)),q=r):"reload"===e?(W.push(F(r)),q=r):"enter"===e&&W.push(w(r))}),e.forEach(O.exit,function(e,t){var n=A.path[t];"inactivate"===e?(X.push(k(n)),J.push(n)):"exit"===e&&(X.push(R(n)),J.push(n))}),B.length&&e.forEach(B,function(e){W.push(e)});var Z=O.orphans;X=X.concat(E(Z,function(e){return R(e)})),J=J.concat(Z),A.path=X,U.path=W;var ee=function(e){return(e.surrogateType?e.surrogateType+":":"")+e.self.name};T&&a.debug("SurrogateFromPath: ",E(X,ee)),T&&a.debug("SurrogateToPath:   ",E(W,ee))}}var te=P.apply(n,arguments);return te.then(function(e){return L(),T&&g(a,$[e.name],n),e.status="active",e},function(e){return L(),T&&"transition prevented"!==e.message&&"transition aborted"!==e.message&&"transition superseded"!==e.message&&(a.debug("transition failed",e),a.debug(e.stack)),p.reject(e)})},n}])}])}(angular);