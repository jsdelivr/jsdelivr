/*!
* Qoopido.js library v3.6.5, 2015-7-1
* https://github.com/dlueth/qoopido.js
* (c) 2015 Dirk Lueth
* Dual licensed under MIT and GPL
*/
!function(e){window.qoopido.register("asset",e,["./emitter","./transport/xhr","./promise/defer","./function/unique/uuid"])}(function(e,o,t,r,i,n){"use strict";function u(e){h.push(e),1===h.length&&a()}function a(){c(h[0]).then(function(){h.splice(0,1)&&h.length>=1&&a()},function(){h.splice(0,1)&&h.length>=1&&a()})}function c(e){var o=s[e._uuid],t=o.dfd,r=o.url;return d.get(r,null,v).then(function(i){var u=i.data,a=o.id,c=o.version,l=o.storage;e.emit("loaded",r,a,c,u),l&&(n.cookie=o.cookie+"="+encodeURIComponent(c)+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/",localStorage[l.version]=c,localStorage[l.value]=u,e.emit("stored",r,a,c,u,l.version,l.value)),t.resolve(localStorage[l.value])},function(){t.reject()})}var l,s={},d=e["transport/xhr"],v={cache:!0},f=e["promise/defer"],g=e["function/unique/uuid"],p=new RegExp("/","g"),h=[];return l=e.emitter.extend({_uuid:null,_constructor:function(e,o,t){var r=this,i=g(),n=s[i]={dfd:new f,url:e};l._parent._constructor.call(r),r._uuid=i,o&&t&&(n.id=o,n.version=t,n.cookie=encodeURIComponent("qoopido[asset]["+o.replace(p,"][")+"]"),n.storage={version:"@"+o,value:"Â©"+o})},fetch:function(){var e=this,o=s[e._uuid],t=o.dfd,r=o.url,i=o.id,n=o.version,a=o.storage,c=a&&a.version&&localStorage[a.version];if(c&&c>=n){var l=localStorage[o.storage.value];e.emit("hit",r,i,n,l),t.resolve(l)}else e.emit("miss",r,i,n),u(e);return t.promise},clear:function(){var e=this,o=s[e._uuid],t=o.storage;return t&&(n.cookie=o.cookie+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",delete localStorage[t.version],delete localStorage[t.value],e.emit("cleared",o.url,o.id,o.version)),e}})},window,document);