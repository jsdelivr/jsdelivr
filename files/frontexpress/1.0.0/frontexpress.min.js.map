{"version":3,"file":null,"sources":["lib/application.js","lib/methods.js","lib/requester.js","lib/settings.js","lib/middleware.js","lib/router.js","lib/frontexpress.js"],"sourcesContent":["/**\n * Module dependencies.\n * @private\n */\n\nimport HTTP_METHODS from './methods';\nimport Settings from './settings';\nimport Router, {Route} from './router';\nimport Middleware from './middleware';\n\n\n/**\n * Application class.\n */\n\nexport default class Application {\n\n\n    /**\n     * Initialize the application.\n     *\n     *   - setup default configuration\n     *\n     * @private\n     */\n\n    constructor() {\n        this.routers = [];\n        this.isDOMLoaded = false;\n        this.isDOMReady = false;\n        this.settings = new Settings();\n    }\n\n\n    /**\n     * Assign `setting` to `val`, or return `setting`'s value.\n     *\n     *    app.set('foo', 'bar');\n     *    app.set('foo');\n     *    // => \"bar\"\n     *\n     * @param {String} setting\n     * @param {*} [val]\n     * @return {app} for chaining\n     * @public\n     */\n\n    set(...args) {\n        // get behaviour\n        if (args.length === 1) {\n            return this.settings.get([args]);\n        }\n\n        // set behaviour\n        const [name, value] = args;\n        this.settings.set(name, value);\n\n        return this;\n    }\n\n\n    /**\n     * Listen for DOM initialization and history state changes.\n     *\n     * The callback function is called once the DOM has\n     * the `document.readyState` equals to 'interactive'.\n     *\n     *    app.listen(()=> {\n     *        console.log('App is listening requests');\n     *        console.log('DOM is ready!');\n     *    });\n     *\n     *\n     * @param {Function} callback\n     * @public\n     */\n\n    listen(callback) {\n        window.onbeforeunload = () => {\n            this._callMiddlewareMethod('exited');\n        };\n\n        window.onpopstate = (event) => {\n            if (event.state) {\n                const {request, response} = event.state;\n                const currentRoutes = this._routes(request.uri, request.method);\n\n                this._callMiddlewareMethod('entered', currentRoutes, request);\n                this._callMiddlewareMethod('updated', currentRoutes, request, response);\n            }\n        };\n\n        document.onreadystatechange = () => {\n            const request = {method: 'GET', uri: window.location.pathname + window.location.search};\n            const response = {status: 200, statusText: 'OK'};\n            const currentRoutes = this._routes();\n            // DOM state\n            if (document.readyState === 'loading' && !this.isDOMLoaded) {\n                this.isDOMLoaded = true;\n                this._callMiddlewareMethod('entered', currentRoutes, request);\n            } else if (document.readyState === 'interactive' && !this.isDOMReady) {\n                if (!this.isDOMLoaded) {\n                    this.isDOMLoaded = true;\n                    this._callMiddlewareMethod('entered', currentRoutes, request);\n                }\n                this.isDOMReady = true;\n                this._callMiddlewareMethod('updated', currentRoutes, request, response);\n                if (callback) {\n                    callback(request, response);\n                }\n            }\n        };\n    }\n\n\n    /**\n     * Returns a new `Router` instance for the _uri_.\n     * See the Router api docs for details.\n     *\n     *    app.route('/');\n     *    // =>  new Router instance\n     *\n     * @param {String} uri\n     * @return {Router} for chaining\n     *\n     * @public\n     */\n\n    route(uri) {\n        const router = new Router(uri);\n        this.routers.push(router);\n        return router;\n    }\n\n\n    /**\n     * Use the given middleware function or object, with optional _uri_.\n     * Default _uri_ is \"/\".\n     *\n     *    // middleware function will be applied on path \"/\"\n     *    app.use((req, res, next) => {console.log('Hello')});\n     *\n     *    // middleware object will be applied on path \"/\"\n     *    app.use(new Middleware());\n     *\n     * @param {String} uri\n     * @param {Middleware|Function} middleware object or function\n     * @return {app} for chaining\n     *\n     * @public\n     */\n\n    use(...args) {\n        let {baseUri, router, middleware} = toParameters(args);\n        if (router) {\n            router.baseUri = baseUri;\n        } else if (middleware) {\n            router = new Router(baseUri);\n            for (const method of HTTP_METHODS) {\n                router[method.toLowerCase()](middleware);\n            }\n        } else {\n            throw new TypeError('method takes at least a middleware or a router');\n        }\n        this.routers.push(router);\n\n        return this;\n    }\n\n\n    /**\n     * Gather routes from all routers filtered by _uri_ and HTTP _method_.\n     * See Router#routes() documentation for details.\n     *\n     * @private\n     */\n\n    _routes(uri=window.location.pathname + window.location.search, method='GET') {\n        const currentRoutes = [];\n        for (const router of this.routers) {\n            currentRoutes.push(...router.routes(uri, method));\n        }\n\n        return currentRoutes;\n    }\n\n\n    /**\n     * Call `Middleware` method or middleware function on _currentRoutes_.\n     *\n     * @private\n     */\n\n    _callMiddlewareMethod(meth, currentRoutes, request, response) {\n        if (meth === 'exited') {\n            // currentRoutes, request, response params not needed\n            for (const router of this.routers) {\n                for (const route of router.visited()) {\n                    if (route.middleware.exited) {\n                        route.middleware.exited(route.visited);\n                        route.visited = null;\n                    }\n                }\n            }\n            return;\n        }\n\n        for (const route of currentRoutes) {\n            if (meth === 'updated') {\n                route.visited = request;\n            }\n\n            if (route.middleware[meth]) {\n                route.middleware[meth](request, response);\n                if (route.middleware.next && !route.middleware.next()) {\n                    break;\n                }\n            } else if (meth !== 'entered') {\n                // calls middleware method\n                let breakMiddlewareLoop = true;\n                const next = () => {\n                    breakMiddlewareLoop = false;\n                };\n                route.middleware(request, response, next);\n                if (breakMiddlewareLoop) {\n                    break;\n                }\n            }\n        }\n    }\n\n\n    /**\n     * Make an ajax request. Manage History#pushState if history object set.\n     *\n     * @private\n     */\n\n    _fetch(request, resolve, reject) {\n        let {method, uri, headers, data, history} = request;\n\n        const httpMethodTransformer = this.get(`http ${method} transformer`);\n        if (httpMethodTransformer) {\n            uri = httpMethodTransformer.uri ? httpMethodTransformer.uri({uri, headers, data}) : uri;\n            headers = httpMethodTransformer.headers ? httpMethodTransformer.headers({uri, headers, data}) : headers;\n            data = httpMethodTransformer.data ? httpMethodTransformer.data({uri, headers, data}) : data;\n        }\n\n        // calls middleware exited method\n        this._callMiddlewareMethod('exited');\n\n        // gathers all routes impacted by the uri\n        const currentRoutes = this._routes(uri, method);\n\n        // calls middleware entered method\n        this._callMiddlewareMethod('entered', currentRoutes, request);\n\n        // invokes http request\n        this.settings.get('http requester').fetch(request,\n            (req, res) => {\n                if (history) {\n                    window.history.pushState({request: req, response: res}, history.title, history.uri);\n                }\n                this._callMiddlewareMethod('updated', currentRoutes, req, res);\n                if (resolve) {\n                    resolve(req, res);\n                }\n            },\n            (req, res) => {\n                this._callMiddlewareMethod('failed', currentRoutes, req, res);\n                if (reject) {\n                    reject(req, res);\n                }\n            });\n    }\n}\n\nHTTP_METHODS.reduce((reqProto, method) => {\n\n\n    /**\n     * Use the given middleware function or object, with optional _uri_ on\n     * HTTP methods: get, post, put, delete...\n     * Default _uri_ is \"/\".\n     *\n     *    // middleware function will be applied on path \"/\"\n     *    app.get((req, res, next) => {console.log('Hello')});\n     *\n     *    // middleware object will be applied on path \"/\" and\n     *    app.get(new Middleware());\n     *\n     *    // get a setting value\n     *    app.set('foo', 'bar');\n     *    app.get('foo');\n     *    // => \"bar\"\n     *\n     * @param {String} uri or setting\n     * @param {Middleware|Function} middleware object or function\n     * @return {app} for chaining\n     * @public\n     */\n\n    const middlewareMethodName = method.toLowerCase();\n    reqProto[middlewareMethodName] = function(...args) {\n        let {baseUri, middleware, which} = toParameters(args);\n        if (middlewareMethodName === 'get' && typeof which === 'string') {\n            return this.settings.get(which);\n        }\n        if (!middleware) {\n            throw new TypeError(`method takes a middleware ${middlewareMethodName === 'get' ? 'or a string' : ''}`);\n        }\n        const router = new Router();\n        router[middlewareMethodName](baseUri, middleware);\n\n        this.routers.push(router);\n\n        return this;\n    };\n\n    /**\n     * Ajax request (get, post, put, delete...).\n     *\n     *   // HTTP GET method\n     *   httpGet('/route1');\n     *\n     *   // HTTP GET method\n     *   httpGet({uri: '/route1', data: {'p1': 'val1'});\n     *   // uri invoked => /route1?p1=val1\n     *\n     *   // HTTP GET method with browser history management\n     *   httpGet({uri: '/api/users', history: {state: {foo: \"bar\"}, title: 'users page', uri: '/view/users'});\n     *\n     *   Samples above can be applied on other HTTP methods.\n     *\n     * @param {String|Object} uri or object containing uri, http headers, data, history\n     * @param {Function} success callback\n     * @param {Function} failure callback\n     * @public\n     */\n    const httpMethodName = 'http'+method.charAt(0).toUpperCase() + method.slice(1).toLowerCase();\n    reqProto[httpMethodName] = function(request, resolve, reject) {\n        let {uri, headers, data, history} = request;\n        if (!uri) {\n            uri = request;\n        }\n        return this._fetch({\n            uri,\n            method,\n            headers,\n            data,\n            history\n        }, resolve, reject);\n    };\n\n    return reqProto;\n}, Application.prototype);\n\n\nexport function toParameters(args) {\n    let baseUri, middleware, router, which;\n    if (args && args.length > 0) {\n        if (args.length === 1) {\n            [which,] = args;\n        } else {\n            [baseUri, which,] = args;\n        }\n\n        if (which instanceof Router) {\n            router = which;\n        } else if ((which instanceof Middleware) || (typeof which === 'function')) {\n            middleware = which;\n        }\n    }\n    return {baseUri, middleware, router, which};\n}\n","/**\n * HTTP method list\n * @private\n */\n\n export default ['GET', 'POST', 'PUT', 'DELETE'];\n // not supported yet\n // HEAD', 'CONNECT', 'OPTIONS', 'TRACE', 'PATCH';\n","/**\n * Module dependencies.\n * @private\n */\n\nexport default class Requester {\n\n    /**\n     * Make an ajax request.\n     *\n     * @param {Object} request\n     * @param {Function} success callback\n     * @param {Function} failure callback\n     * @private\n     */\n\n    fetch(request, resolve, reject) {\n        const {method, uri, headers, data} = request;\n\n        const success = (responseText) => {\n            resolve(\n                request,\n                {\n                    status: 200,\n                    statusText: 'OK',\n                    responseText\n                }\n            );\n        };\n\n        const fail = ({status, statusText, errorThrown}) => {\n            reject(\n                request,\n                {\n                    status,\n                    statusText,\n                    errorThrown,\n                    errors: `HTTP ${status} ${statusText?statusText:''}`\n                }\n            );\n        };\n\n        const xmlhttp = new XMLHttpRequest();\n        xmlhttp.onreadystatechange = () => {\n            if (xmlhttp.readyState === 4) {\n                if (xmlhttp.status === 200) {\n                    success(xmlhttp.responseText);\n                } else {\n                    fail({status: xmlhttp.status, statusText: xmlhttp.statusText});\n                }\n            }\n        };\n        try {\n            xmlhttp.open(method, uri, true);\n            if (headers) {\n                for (const header of Object.keys(headers)) {\n                    xmlhttp.setRequestHeader(header, headers[header]);\n                }\n            }\n            if (data) {\n                xmlhttp.send(data);\n            } else {\n                xmlhttp.send();\n            }\n        } catch (errorThrown) {\n            fail({errorThrown});\n        }\n    }\n}\n","/**\n * Module dependencies.\n * @private\n */\n\nimport Requester from './requester';\n\n\n/**\n * Settings object.\n * @private\n */\n\nexport default class Settings {\n\n\n    /**\n     * Initialize the settings.\n     *\n     *   - setup default configuration\n     *\n     * @private\n     */\n\n    constructor() {\n        // default settings\n        this.settings = {\n            'http requester': new Requester(),\n\n            'http GET transformer': {\n                uri({uri, headers, data}) {\n                    if (!data) {\n                        return uri;\n                    }\n                    let [uriWithoutAnchor, anchor] = [uri, ''];\n                    const match = /^(.*)(#.*)$/.exec(uri);\n                    if (match) {\n                        [,uriWithoutAnchor, anchor] = /^(.*)(#.*)$/.exec(uri);\n                    }\n                    uriWithoutAnchor = Object.keys(data).reduce((gUri, d, index) => {\n                        gUri += `${(index === 0 && gUri.indexOf('?') === -1)?'?':'&'}${d}=${data[d]}`;\n                        return gUri;\n                    }, uriWithoutAnchor);\n                    return uriWithoutAnchor + anchor;\n                }\n            }\n        };\n\n        this.rules = {\n            'http requester': (requester) => {\n                if(typeof requester.fetch !== 'function') {\n                    throw new TypeError('setting http requester has no fetch method');\n                }\n            }\n        };\n    }\n\n\n    /**\n     * Assign `setting` to `val`\n     *\n     * @param {String} setting\n     * @param {*} [val]\n     * @private\n     */\n\n    set(name, value) {\n        const checkRules = this.rules[name];\n        if (checkRules) {\n            checkRules(value);\n        }\n        this.settings[name] = value;\n    }\n\n\n    /**\n     * Return `setting`'s value.\n     *\n     * @param {String} setting\n     * @private\n     */\n\n    get(name) {\n        return this.settings[name];\n    }\n};\n","/**\n * Middleware object.\n * @public\n */\n\nexport default class Middleware {\n\n\n    /**\n     * Middleware initialization\n     *\n     * @param {String} middleware name\n     */\n\n    constructor(name='') {\n        this.name = name;\n    }\n\n    /**\n     * Invoked by the app before an ajax request is sent or\n     * during the DOM loading (document.readyState === 'loading').\n     * See Application#_callMiddlewareEntered documentation for details.\n     *\n     * Override this method to add your custom behaviour\n     *\n     * @param {Object} request\n     * @public\n     */\n\n    // entered(request) { }\n\n\n    /**\n     * Invoked by the app before a new ajax request is sent or before the DOM is unloaded.\n     * See Application#_callMiddlewareExited documentation for details.\n     *\n     * Override this method to add your custom behaviour\n     *\n     * @param {Object} request\n     * @public\n     */\n\n    // exited(request) { }\n\n\n    /**\n     * Invoked by the app after an ajax request has responded or on DOM ready\n     * (document.readyState === 'interactive').\n     * See Application#_callMiddlewareUpdated documentation for details.\n     *\n     * Override this method to add your custom behaviour\n     *\n     * @param {Object} request\n     * @param {Object} response\n     * @public\n     */\n\n    // updated(request, response) { }\n\n\n    /**\n     * Invoked by the app when an ajax request has failed.\n     *\n     * Override this method to add your custom behaviour\n     *\n     * @param {Object} request\n     * @param {Object} response\n     * @public\n     */\n    // failed(request, response) { }\n\n\n    /**\n     * Allow the hand over to the next middleware object or function.\n     *\n     * Override this method and return `false` to break execution of\n     * middleware chain.\n     *\n     * @return {Boolean} `true` by default\n     *\n     * @public\n     */\n\n    next() {\n        return true;\n    }\n}\n","/**\n * Module dependencies.\n * @private\n */\n\nimport HTTP_METHODS from './methods';\nimport {toParameters} from './application';\nimport Middleware from './middleware';\n\n\n/**\n * Route object.\n * @private\n */\n\nexport class Route {\n\n\n    /**\n     * Initialize the route.\n     *\n     * @private\n     */\n\n    constructor(router, uriPart, method, middleware) {\n        this.router = router;\n        this.uriPart = uriPart;\n        this.method = method;\n        this.middleware = middleware;\n        this.visited = false;\n    }\n\n\n    /**\n     * Return route's uri.\n     *\n     * @private\n     */\n\n    get uri() {\n        if (!this.uriPart && !this.method) {\n            return undefined;\n        }\n\n        if (this.uriPart instanceof RegExp) {\n            return this.uriPart;\n        }\n\n        if (this.router.baseUri instanceof RegExp) {\n            return this.router.baseUri;\n        }\n\n        if (this.router.baseUri) {\n            const baseUri = this.router.baseUri.trim();\n            if (this.uriPart) {\n                return ( baseUri + this.uriPart.trim()).replace(/\\/{2,}/, '/');\n            }\n            return baseUri;\n        }\n\n        return this.uriPart;\n    }\n}\n\n\n/**\n * Router object.\n * @public\n */\n\nconst error_middleware_message = 'method takes at least a middleware';\nexport default class Router {\n\n\n    /**\n     * Initialize the router.\n     *\n     * @private\n     */\n\n    constructor(uri) {\n        this._baseUri = uri;\n        this._routes = [];\n    }\n\n\n    /**\n     * Do some checks and set _baseUri.\n     *\n     * @private\n     */\n\n    set baseUri(uri) {\n        if (!uri) {\n            return;\n        }\n\n        if (!this._baseUri) {\n            this._baseUri = uri;\n            return;\n        }\n\n        if (typeof this._baseUri !== typeof uri) {\n            throw new TypeError('router cannot mix regexp and uri');\n        }\n    }\n\n\n    /**\n     * Return router's _baseUri.\n     *\n     * @private\n     */\n\n    get baseUri() {\n        return this._baseUri;\n    }\n\n\n    /**\n     * Add a route to the router.\n     *\n     * @private\n     */\n\n    _add(route) {\n        this._routes.push(route);\n        return this;\n    }\n\n\n    /**\n     * Gather routes from routers filtered by _uri_ and HTTP _method_.\n     *\n     * @private\n     */\n\n    routes(uri, method) {\n        return this._routes.filter((route) => {\n            if (route.method && route.method !== method) {\n                return false;\n            }\n\n            if (!route.uri || !uri) {\n                return true;\n            }\n\n            //remove query string from uri to test\n            //remove anchor from uri to test\n            const match = /^(.*)\\?.*#.*|(.*)(?=\\?|#)|(.*[^\\?#])$/.exec(uri);\n            const baseUriToCheck = match[1] || match[2] || match[3];\n\n            if (route.uri instanceof RegExp) {\n                return baseUriToCheck.match(route.uri);\n            }\n\n            return route.uri === baseUriToCheck;\n        });\n    }\n\n\n    /**\n     * Gather visited routes from routers.\n     *\n     * @private\n     */\n\n    visited() {\n        return this._routes.filter(route => route.visited);\n    }\n\n\n    /**\n     * Use the given middleware function or object on this router.\n     *\n     *    // middleware function\n     *    router.use((req, res, next) => {console.log('Hello')});\n     *\n     *    // middleware object\n     *    router.use(new Middleware());\n     *\n     * @param {Middleware|Function} middleware object or function\n     * @return {Router} for chaining\n     *\n     * @public\n     */\n\n    use(middleware) {\n        if (!(middleware instanceof Middleware) && (typeof middleware !== 'function') ) {\n            throw new TypeError(error_middleware_message);\n        }\n\n        this._add(new Route(this, undefined, undefined, middleware));\n\n        return this;\n    }\n\n\n    /**\n     * Use the given middleware function or object on this router for\n     * all HTTP methods.\n     *\n     *    // middleware function\n     *    router.all((req, res, next) => {console.log('Hello')});\n     *\n     *    // middleware object\n     *    router.all(new Middleware());\n     *\n     * @param {Middleware|Function} middleware object or function\n     * @return {Router} for chaining\n     *\n     * @public\n     */\n\n    all(...args) {\n        const {middleware} = toParameters(args);\n        if (!middleware) {\n            throw new TypeError(error_middleware_message);\n        }\n\n        for (const method of HTTP_METHODS) {\n            this[method.toLowerCase()](...args);\n        }\n        return this;\n    }\n}\n\nfor (const method of HTTP_METHODS) {\n\n\n    /**\n     * Use the given middleware function or object, with optional _uri_ on\n     * HTTP methods: get, post, put, delete...\n     * Default _uri_ is \"/\".\n     *\n     *    // middleware function will be applied on path \"/\"\n     *    router.get((req, res, next) => {console.log('Hello')});\n     *\n     *    // middleware object will be applied on path \"/\" and\n     *    router.get(new Middleware());\n     *\n     *    // middleware function will be applied on path \"/user\"\n     *    router.post('/user', (req, res, next) => {console.log('Hello')});\n     *\n     *    // middleware object will be applied on path \"/user\" and\n     *    router.post('/user', new Middleware());\n     *\n     * @param {String} uri\n     * @param {Middleware|Function} middleware object or function\n     * @return {Router} for chaining\n     * @public\n     */\n\n    const methodName = method.toLowerCase();\n    Router.prototype[methodName] = function(...args) {\n        const {baseUri, middleware} = toParameters(args);\n        if (!middleware) {\n            throw new TypeError(error_middleware_message);\n        }\n\n        if (baseUri && this._baseUri && this._baseUri instanceof RegExp) {\n            throw new TypeError('router cannot mix uri/regexp');\n        }\n\n        this._add(new Route(this, baseUri, method, middleware));\n\n        return this;\n    };\n}\n","/**\n * Module dependencies.\n */\n\nimport Application from './application';\nimport Router from './router';\nimport Middleware from './middleware';\n\n\n/**\n * Create a frontexpress application.\n *\n * @return {Function}\n * @api public\n */\n\nconst frontexpress = () => new Application();\n\n/**\n * Expose Router, Middleware constructors.\n */\nfrontexpress.Router = (baseUri) => new Router(baseUri);\nfrontexpress.Middleware = Middleware;\n\nexport default frontexpress;\n"],"names":["toParameters","args","baseUri","middleware","router","which","length","Router","Middleware","Requester","request","resolve","reject","method","uri","headers","data","success","responseText","fail","status","statusText","errorThrown","xmlhttp","XMLHttpRequest","onreadystatechange","readyState","open","Object","keys","header","setRequestHeader","send","Settings","settings","uriWithoutAnchor","anchor","match","exec","reduce","gUri","d","index","indexOf","rules","requester","fetch","TypeError","name","value","checkRules","this","Route","uriPart","visited","RegExp","trim","replace","error_middleware_message","_baseUri","_routes","route","push","filter","baseUriToCheck","_add","undefined","HTTP_METHODS","toLowerCase","babelHelpers.typeof","methodName","prototype","Application","routers","isDOMLoaded","isDOMReady","get","set","callback","onbeforeunload","_callMiddlewareMethod","onpopstate","event","state","response","currentRoutes","_this","window","location","pathname","search","document","routes","meth","next","breakMiddlewareLoop","exited","history","httpMethodTransformer","req","res","pushState","title","reqProto","middlewareMethodName","httpMethodName","charAt","toUpperCase","slice","_fetch","frontexpress"],"mappings":"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"}