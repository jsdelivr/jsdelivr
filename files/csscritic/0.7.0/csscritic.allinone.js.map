{"version":3,"sources":["node_modules/grunt-browserify/node_modules/browserify/node_modules/browser-pack/_prelude.js","build/csscritic.umd.js","build/csscritic.concat.css","node_modules/ayepromise/ayepromise.js","node_modules/imagediff/imagediff.js","node_modules/rasterizehtml/dist/rasterizeHTML.js","node_modules/imagediff/browser/canvas.js","node_modules/cssify/browser.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/url/url.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/punycode/punycode.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/is-array/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/decode.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/encode.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/ieee754/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib/b64.js","node_modules/inlineresources/src/inline.js","node_modules/rasterizehtml/node_modules/xmlserializer/lib/serializer.js","node_modules/inlineresources/src/util.js","node_modules/inlineresources/src/inlineImage.js","node_modules/inlineresources/src/inlineScript.js","node_modules/inlineresources/src/inlineCss.js","node_modules/inlineresources/src/cssSupport.js","node_modules/inlineresources/src/backgroundValueParser.js","node_modules/inlineresources/node_modules/css-font-face-src/lib/index.js","node_modules/inlineresources/node_modules/cssom/lib/index.js","node_modules/inlineresources/node_modules/cssom/lib/CSSStyleDeclaration.js","node_modules/inlineresources/node_modules/cssom/lib/CSSRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSStyleRule.js","node_modules/inlineresources/node_modules/cssom/lib/MediaList.js","node_modules/inlineresources/node_modules/cssom/lib/CSSMediaRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSImportRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSFontFaceRule.js","node_modules/inlineresources/node_modules/cssom/lib/StyleSheet.js","node_modules/inlineresources/node_modules/cssom/lib/CSSStyleSheet.js","node_modules/inlineresources/node_modules/cssom/lib/CSSKeyframesRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSKeyframeRule.js","node_modules/inlineresources/node_modules/cssom/lib/MatcherList.js","node_modules/inlineresources/node_modules/cssom/lib/CSSDocumentRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSValue.js","node_modules/inlineresources/node_modules/cssom/lib/CSSValueExpression.js","node_modules/inlineresources/node_modules/cssom/lib/parse.js","node_modules/inlineresources/node_modules/cssom/lib/clone.js","node_modules/inlineresources/node_modules/css-font-face-src/lib/grammar/index.js","node_modules/inlineresources/node_modules/css-font-face-src/lib/util.js"],"names":["root","factory","define","amd","ayepromise","imagediff","rasterizeHTML","returnExportsGlobal","exports","module","require","this","csscriticLib","main","regression","reporting","util","storage","selectionFilter","currentComponentLabel","testCases","component","componentLabel","supportUrlAsOnlyTestCaseInput","testCase","url","add","augmentedTestCase","clone","undefined","push","fetchStartingComparisons","all","map","readReferenceImage","then","referenceImageRecord","referenceImage","image","viewport","selectComparisons","configuredComparisons","configuredComparison","selected","isComparisonSelected","reportConfiguredComparisons","comparisonSelection","selection","isSelected","doReportConfiguredComparison","executeTestCase","startingComparison","compare","comparison","doReportComparison","execute","allPassed","startingComp","selectedComparisons","filter","comparisons","hasTestSuitePassed","doReportTestSuite","renderer","toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux","workAroundFirefoxResourcesSporadicallyMissing","htmlImage","diff","workAroundBrowserIssues","pageImage","workAroundTransparencyIssueInFirefox","compareRenderingAndReference","isEqual","adaptedHtmlImage","equal","comparisonResult","textualStatus","renderErrors","result","status","loadPageAndCompare","render","hover","active","width","height","renderResult","errors","viewportFallback","fallbackWidth","fallbackHeight","reporters","addReporter","reporter","testCaseIsResizable","attachPageAcceptHelpers","viewportWidth","viewportHeight","resizePageImage","acceptPage","storeReferenceImage","reportingMethod","reportSelectedComparison","reportComparisonStarting","reportDeselectedComparison","reportingFunc","reportComparison","passed","reportTestSuite","success","getDataURIForImage","canvas","window","document","createElement","context","getContext","naturalWidth","naturalHeight","drawImage","toDataURL","getImageForUrl","defer","Image","onload","resolve","onerror","reject","src","promise","getUncachableURL","delimiter","indexOf","Date","now","ajax","xhr","XMLHttpRequest","response","open","send","e","loadAsBlob","responseType","loadBlobAsText","blob","reader","FileReader","target","readAsText","loadBlobAsDataURI","readAsDataURL","excludeKeys","theMap","Array","prototype","slice","call","arguments","newMap","Object","keys","forEach","key","serializeMap","serializationEntries","sort","join","object","i","theClone","hasOwnProperty","successfulPromise","value","dataUri","nonPassingTestCases","length","functionReturnValues","pendingFunctionCalls","resolvedValues","functionCallResolved","idx","returnValue","basicHTMLReporter","reporterUtil","escapeValue","toString","replace","RegExp","template","templateStr","values","_","param","elementFor","htmlString","tmp","insertAdjacentHTML","firstChild","cssPixelValue","pxValue","parseInt","registerResizeHandler","element","handler","style","onmouseup","newWidth","newHeight","getOrCreateBody","reporterId","reportBody","getElementById","getElementsByTagName","appendChild","createPageCanvasContainer","withCaption","currentPageSection","currentPageResizableCanvas","currentPageImageContainer","caption","querySelector","classList","oldImage","updatedImage","removeChild","createReferenceImageContainer","referenceSection","referenceImageContainer","createAcceptHint","parameters","acceptHint","acceptButton","onclick","createSaveHint","className","prefix","buttonCaption","postfix","createUpdateHint","makeUnsortedList","items","lis","createErroneousResourceWarning","createErrorMsg","createDifferenceCanvasContainer","differenceCanvasSection","differenceCanvasContainer","differenceCanvas","getDifferenceCanvas","highlightedDifferenceCanvas","getHighlightedDifferenceCanvas","failed","referenceMissing","error","createStatus","getOrCreateDivWithId","id","tooltip","emptyNode","node","hasChildNodes","lastChild","addMouseOverHandlerForPreview","entry","onmouseover","event","display","top","pageY","left","pageX","onmousemove","onmouseout","fillEntry","testCaseParameters","createRunningEntry","addFinalEntry","runningNode","padNumber","number","renderMilliseconds","time","seconds","Math","floor","milliSeconds","createTimer","timeStarted","stop","timeTaken","showTimeTaken","timer","timeTakenNode","getElementsByClassName","textContent","showBrowserWarningIfNeeded","supportsReadingHtmlFromCanvas","supported","BasicHTMLReporter","runningComparisonEntries","createComparisonEntry","getComparisonEntry","basicHTMLReporterUtil","callback","svg","getImageData","encodeURIComponent","canvasForImageCanvas","imageData","putImageData","diffPageImages","imageA","imageB","align","differenceImageData","scale","byte","normalize","log","data","browserRenderer","jobQueue","queue","cache","getOrCreateJobQueue","extractErrorMessages","msg","logErrorToConsole","console","doRenderHtml","drawOptions","cacheBucket","executeJs","executeJsTimeout","baseUrl","drawHTML","html","renderHtmlFromBlob","content","loadImageFromBlob","domstorage","localStorage","buildKey","serializedParameters","uri","dataObj","alert","referenceImageUri","setItem","JSON","stringify","parseStoredItem","dataObjString","Error","parse","failedPromise","getItem","img","fallbackFilter","windowLocation","storageKey","fullDescription","desc","sessionStorage","filterFor","reload","filterForComponent","clearFilter","removeItem","indexeddbstorage","createDb","db","createObjectStore","keyPath","getDb","request","indexedDB","onsuccess","onupgradeneeded","imageUri","transaction","objectStore","put","reference","close","get","busy","runJob","job","func","nextInQueue","shift","constructJob","migratetoindexeddbstorage","domStorage","indexedDbStorage","fallbackToDomStorageAndMigrate","niceReporter","pageNavigationHandlingFallback","packageVersion","originalTitle","findElementIn","container","elementClassName","escapeId","headerClassName","timeTakenClassName","progressBarClassName","statusTextClassName","createContainer","parentContainer","showHeader","header","updateStatusInDocumentTitle","totalCount","doneCount","title","timeTakenInMillis","setOutcomeOnHeader","successful","progressBarPendingClassName","testDescription","comparisonKey","addTickToProgressBar","linkTarget","progressBar","clickableTickTemplate","deactivatedTickTemplate","tickTemplate","tick","install","markTickDone","renderErrorCount","tickElement","remove","singularPlural","singularForm","pluralForm","statusTotalText","selectedCount","totalContent","total","statusIssueText","issueCount","issueContent","doneContent","doneWithoutErrors","issues","acceptAllClassName","acceptAllButton","showAcceptAllButtonIfNeccessary","acceptableEntries","statusText","button","acceptableEntry","acceptComparison","setAttribute","installFallbackClearSelectionHandler","preventDefault","updateStatusBar","runAllUrl","clearFilterUrl","runAll","innerHTML","installFallbackComponentSelectionHandler","addComponentHeading","filterUrl","filterUrlForComponent","headlineElement","headline","runningComparisonClassName","imageContainerClassName","errorContainerClassName","imageWrapper","wrapper","serializeValue","installFallbackSelectionHandler","addComparison","titleLinkClassName","filterUrlFor","imageContainer","titleLink","embossChanges","d","canvasForImage","addImageDiff","imageForDiff","acceptClassName","changedImageContainer","changedImageContainerClassName","outerChangedImageContainer","showComparisonWithDiff","pageAsIframe","testCaseUrl","iframe","showComparisonWithRenderedPage","addEventListener","showComparisonWithoutReference","sameOriginWarning","showComparisonWithError","errorMsg","errorContainer","showRenderErrors","listElement","li","updateComparisonStatus","browserIssueChecked","NiceReporter","outerContainer","containerElement","lastComponentLabel","progressTickElements","acceptableComparisons","body","registerComparison","comparisonElement","fakeTargetClassName","clearFakeActiveClass","previousTargets","querySelectorAll","elem","triggerFakeActiveClass","targetElement","scrollTo","scrollIntoView","globalNavigationHandlingInstalled","installGlobalNavigationHandling","onpopstate","state","targetLink","href","targetId","substr","history","pushState","urlQueryFilter","filterParam","parseUrlSearch","search","paramString","split","keyValue","equalsIdx","serializeKeyValuePair","pair","getFilterValue","filterKeyValue","entryPair","pop","decodeURIComponent","existingQueryParams","queryPart","queryParams","csscritic","installCallChain","self","apply","startsWith","str","needsFallback","location","migrateToIndexedDbStorage","queryFilter","css","once","wasCalled","wrappedFunction","getThenableIfExists","obj","aThenHandler","onFulfilled","onRejected","doHandlerCall","setTimeout","TypeError","callFulfilled","callRejected","handle","FULFILLED","PENDING","REJECTED","outcome","thenHandlers","doSettle","settledState","doFulfill","doReject","registerThenHandler","thenHandler","safelyResolveThenable","thenable","onceWrapper","transparentlyResolveThenablesAndSettle","fail","name","definition","Canvas","message","getCanvas","clearRect","createImageData","getCanvasRef","isImage","isType","TYPE_IMAGE","isCanvas","TYPE_CANVAS","isContext","TYPE_CONTEXT","isImageData","TYPE_IMAGE_DATA","UNDEFINED","isImageType","type","match","copyImageData","newImageData","newData","toImageData","toImageDataFromImage","toImageDataFromCanvas","toImageDataFromContext","toCanvas","equalWidth","a","b","equalHeight","equalDimensions","tolerance","aData","bData","abs","options","diffEqual","diffUnequal","c","cData","offsets","rowOffset","columnOffset","row","column","j","max","checkType","imageDataToPNG","outputFile","base64Data","decodedImage","Function","Buffer","writeFile","jasmine","previous","toBeImageData","actual","toImageDiffEqual","expected","div","overflow","createCanvas","noConflict","a0","b1","c2","d3","xmlserializer","inlineresources","uniqueIdList","joinUrl","relUrl","getConstantUniqueIdFor","isObject","parseOptionalParameters","args","proxies","monkeyPatchInstanceMethod","methodName","proxyFunc","originalFunc","baseUrlRespectingXhr","XHRObject","xhrConstructor","originalOpen","method","joinedUrl","concat","finishNotifyingXhr","totalXhrCount","doneXhrCount","waitingForPendingToClose","checkAllRequestsFinished","pendingXhrCount","originalSend","waitForRequestsToFinish","documentUtil","asArray","arrayLike","addClassNameRecursively","parentNode","ownerDocument","changeCssRule","rule","newRuleText","styleSheet","parentStyleSheet","ruleIdx","cssRules","insertRule","deleteRule","updateRuleSelector","updatedSelector","styleDefinitions","cssText","newRule","cssRulesToText","reduce","rewriteStyleContent","styleElement","sheet","matchingSimpleSelectorsRegex","simpleSelectorList","replaceSimpleSelectorsBy","doc","caseInsensitiveReplaceFunc","selectorRegex","matchingRules","selectorText","test","newSelector","prefixMatch","selectorMatch","rewriteCssSelectorWith","oldSelector","lowercaseCssTypeSelectors","matchingTagNames","toLowerCase","findHtmlOnlyNodeNames","currentTagName","treeWalker","createTreeWalker","NodeFilter","SHOW_ELEMENT","htmlNodeNames","nonHtmlNodeNames","nextNode","currentNode","tagName","namespaceURI","documentHelper","fakeHover","hoverSelector","fakeHoverClass","fakeActive","activeSelector","fakeActiveClass","fakeFocus","focusSelector","fakeFocusClass","persistInputValues","inputs","textareas","isCheckable","input","checked","removeAttribute","textarea","rewriteTagNameSelectorsToLowerCase","browser","theWindow","createHiddenElement","visibility","position","executeJavascript","documentElement","outerHTML","iframeErrorsMessages","timeout","doResolve","contentDocument","waitForJavaScriptToRun","finishNotifyXhrProxy","contentWindow","baseUrlXhrProxy","resourceType","write","createHiddenSandboxedIFrame","sandbox","createIframeWithSizeAtZoomLevel1","zoom","scaledViewportWidth","scaledViewportHeight","calculateZoomedContentSizeAndRoundUp","actualViewport","requestedWidth","requestedHeight","calculateContentSize","selector","originalWidth","originalHeight","rootFontSize","rect","contentSize","actualViewportWidth","scrollWidth","clientWidth","actualViewportHeight","scrollHeight","clientHeight","getBoundingClientRect","getComputedStyle","fontSize","calculateDocumentContentSize","size","clip","addHTMLTagAttributes","htmlTagSubstitute","elementSubstitute","attribute","attributeMatch","exec","helperDoc","implementation","createHTMLDocument","attributes","parseHTML","isParseError","parsedDocument","p","DOMParser","errorneousParse","parseFromString","parsererrorNS","getElementsByTagNameNS","failOnParseError","validateXHTML","xhtml","lastCacheDate","doDocumentLoad","ajaxRequest","augmentedUrl","responseXML","err","loadDocument","svg2image","checkForBlobsResult","urlForSvg","useBlobs","URL","createObjectURL","Blob","cleanUpUrl","revokeObjectURL","simpleForeignObjectSvg","supportsReadingObjectFromCanvas","readingBackFromCanvasBenefitsFromOldSchoolDataUris","blobUrl","supportsReadingFromBlobs","s","supportsBlobBuilding","checkBlobSupport","doesBenefit","checkForBlobs","buildImageUrl","renderSvg","resetEventHandlers","cleanUp","imageUrl","document2svg","zoomedElementSizingAttributes","zoomFactor","closestScaledWith","closestScaledHeight","offsetX","offsetY","round","x","y","workAroundCollapsingMarginsAcrossSVGElementInWebKitLike","workAroundSafariSometimesNotShowingExternalResources","externalResourcesRequired","serializeAttributes","getSvgForDocument","serializeToString","drawDocumentAsSvg","focus","rasterize","generalDrawError","drawSvgAsImg","drawImageOnCanvas","doDraw","operateJavaScriptOnDocument","inlineOptions","inlineScripts","inlineReferences","drawResult","getViewportSize","defaultWidth","defaultHeight","constructOptions","params","drawDocument","optionalArguments","workAroundFirefoxNotLoadingStylesheetStyles","replaceChild","extendedOptions","drawURL","workaround","customDocument","createStyleSheet","ownerNode","head","createTextNode","byUrl","link","rel","Url","protocol","slashes","auth","host","port","hostname","hash","query","pathname","path","urlParse","parseQueryString","slashesDenoteHost","u","urlFormat","isString","format","urlResolve","source","relative","urlResolveObject","resolveObject","arg","isNull","isNullOrUndefined","punycode","protocolPattern","portPattern","delims","unwise","autoEscape","nonHostChars","hostEndingChars","hostnameMaxLen","hostnamePartPattern","hostnamePartStart","unsafeProtocol","javascript","javascript:","hostlessProtocol","slashedProtocol","http","https","ftp","gopher","file","http:","https:","ftp:","gopher:","file:","querystring","rest","trim","proto","lowerProto","hostEnd","hec","atSign","lastIndexOf","parseHost","ipv6Hostname","hostparts","l","part","newpart","k","charCodeAt","validParts","notHost","bit","unshift","domainArray","newOut","encode","h","ae","esc","escape","qm","charAt","relPath","isSourceAbs","isRelAbs","mustEndAbs","removeAllDots","srcPath","psychotic","authInHost","last","hasTrailingSlash","up","splice","isAbsolute","subject","encoding","noZero","base64clean","byteLength","isArray","kMaxLength","RangeError","buf","TYPED_ARRAY_SUPPORT","_augment","Uint8Array","_isBuffer","_set","isArrayish","isBuffer","readUInt8","hexWrite","string","offset","Number","remaining","strLen","isNaN","utf8Write","charsWritten","blitBuffer","utf8ToBytes","asciiWrite","asciiToBytes","binaryWrite","base64Write","base64ToBytes","utf16leWrite","utf16leToBytes","base64Slice","start","end","base64","fromByteArray","utf8Slice","res","min","decodeUtf8Char","String","fromCharCode","asciiSlice","ret","binarySlice","hexSlice","len","out","toHex","utf16leSlice","bytes","checkOffset","ext","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","ieee754","writeDouble","stringtrim","INVALID_BASE64_RE","n","byteArray","hi","lo","toByteArray","dst","unitSize","SlowBuffer","INSPECT_MAX_BYTES","poolSize","ArrayBuffer","arr","foo","subarray","isEncoding","list","totalLength","pos","item","copy","parent","loweredCase","equals","inspect","set","v","writeUInt8","isFinite","swap","toJSON","_arr","sliceLen","newBuf","readUInt16LE","readUInt16BE","readUInt32LE","readUInt32BE","readInt8","readInt16LE","val","readInt16BE","readInt32LE","readInt32BE","readFloatLE","read","readFloatBE","readDoubleLE","readDoubleBE","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","target_start","fill","toArrayBuffer","buffer","BP","constructor","_get","toLocaleString","array","fn","mapDomain","regexSeparators","ucs2decode","extra","output","counter","ucs2encode","stringFromCharCode","basicToDigit","codePoint","base","digitToBasic","digit","flag","adapt","delta","numPoints","firstTime","damp","baseMinusTMin","tMax","skew","decode","basic","index","oldi","w","t","baseMinusT","inputLength","initialN","bias","initialBias","maxInt","tMin","handledCPCount","basicLength","m","q","currentValue","handledCPCountPlusOne","qMinusT","toUnicode","domain","regexPunycode","toASCII","regexNonASCII","freeExports","freeModule","freeGlobal","global","not-basic","invalid-input","version","ucs2","nodeType","prop","qs","sep","eq","regexp","maxKeys","kstr","vstr","xs","f","stringifyPrimitive","objectKeys","ks","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","pow","rt","LN2","lookup","elt","code","PLUS","SLASH","NUMBER","UPPER","LOWER","b64ToByteArray","b64","L","placeHolders","Arr","uint8ToBase64","uint8","num","tripletToBase64","temp","extraBytes","base64js","inlineImage","inlineScript","inlineCss","cssSupport","getUrlBasePath","parameterHashFunction","memoizeFunctionOnCaching","memoize","requestExternalsForStylesheet","styleContent","alreadyLoadedCssUrls","rulesForCssText","loadCSSImportsForRules","cssImportResult","loadAndInlineCSSResourcesForRules","cssResourcesResult","hasChanges","loadAndInlineCssForStyle","processExternals","childNodes","nodeValue","cloneArray","getCssStyleElements","styles","loadAndInlineStyles","allErrors","getDocumentBaseUrl","substituteLinkWithInlineStyle","oldLinkNode","styleNode","insertBefore","requestStylesheetAndInlineResources","hasChangesFromPathAdjustment","adjustPathsOfCssResources","loadLinkedCSS","cssHref","documentBaseUrl","ajaxOptions","processStylesheet","getCssStylesheetLinks","links","loadAndInlineCssLinks","loadAndInlineImages","inline","loadAndInlineScript","inlineFuncs","removeInvalidCharacters","serializeAttributeValue","serializeTextContent","serializeAttribute","attr","getTagName","serializeNamespace","nodeHasXmlnsAttr","attrs","serializeChildren","childNode","nodeTreeToXHTML","serializeTag","serializeText","text","serializeComment","serializeCDATA","nodeName","baseURI","nodeList","isDataUri","promises","pendingPromiseCount","collectAndReportErrors","overrideMimeType","mimeType","binaryAjax","binaryContent","detectMimeType","substring","getDataURIForImageURL","base64Content","btoa","constantUniqueIdFor","hasher","memo","retValue","argumentHash","funcHash","encodeImageAsDataURI","documentBase","dataURI","filterExternalImages","images","filterInputsForImageType","toArray","imageInputs","externalImages","loadLinkedScript","script","escapeClosingTags","substituteExternalScriptWithInline","scriptNode","jsCode","removeNamedItem","getScripts","scripts","backgroundValueParser","fontFaceSrcValueParser","updateCssPropertyValue","property","setProperty","getPropertyPriority","findBackgroundImageRules","CSSRule","STYLE_RULE","getPropertyValue","findBackgroundDeclarations","rules","backgroundDeclarations","findFontFaceRules","FONT_FACE_RULE","findCSSImportRules","IMPORT_RULE","findExternalBackgroundUrls","parsedBackground","matchIndices","backgroundLayer","findExternalFontFaceUrls","parsedFontFaceSources","sourceIndices","sourceItem","backgroundRules","change","declaration","backgroundValue","externalBackgroundIndices","backgroundLayerIndex","relativeUrl","serialize","externalFontFaceUrlIndices","fontFaceSrcDeclaration","fontFaceUrlIndex","changeFontFaceRuleSrc","cssUrl","exchangeRule","substituteRule","newCssRules","fulfilledPromise","loadAndInlineCSSImport","cssHrefRelativeToDoc","unquoteString","externalCssRules","rulesToInline","moreErrors","loadAndInlineBackgroundImages","externalBackgroundLayerIndices","iterateOverRulesAndInlineBackgroundImages","cssHasChanges","loadAndInlineFontFace","srcDeclarationValue","urlIndex","fontSrc","iterateOverRulesAndInlineFontFace","cssom","quotedUrl","doubleQuoteRegex","singleQuoteRegex","rulesForCssTextFromBrowser","browserHasBackgroundImageUrlIssue","newSrc","trimCSSWhitespace","whitespaceRegex","extractCssUrl","urlRegex","sliceBackgroundDeclaration","backgroundDeclarationText","outerRepeatedMatch","functionParamRegexS","valueRegexS","simpleSingularBackgroundRegexS","simpleBackgroundRegexS","simpleSingularBackgroundRegex","backgroundLayers","getValues","singularBackgroundDeclaration","repeatedMatch","valueRegex","backgroundValues","findBackgroundImageUrlInValues","backgroundLayerValues","urlMatch","preUrl","postUrl","grammar","SyntaxError","fontFaceSourceValue","itemValue","local","CSSStyleDeclaration","CSSStyleRule","MediaList","CSSMediaRule","CSSImportRule","CSSFontFaceRule","StyleSheet","CSSStyleSheet","CSSKeyframesRule","CSSKeyframeRule","MatcherList","CSSDocumentRule","CSSValue","CSSValueExpression","CSSOM","parentRule","_importants","priority","removeProperty","prevValue","getPropertyCSSValue","getPropertyShorthand","isPropertyImplicit",{"end":{"file":"?","comments_before":[],"nlb":false,"endpos":2540,"endcol":12,"endline":112,"pos":2533,"col":5,"line":112,"value":"cssText","type":"name"},"start":{"file":"?","comments_before":[],"nlb":false,"endpos":2540,"endcol":12,"endline":112,"pos":2533,"col":5,"line":112,"value":"cssText","type":"name"},"name":"cssText"},"properties","dummyRule","MEDIA_RULE","PAGE_RULE","WEBKIT_KEYFRAMES_RULE","WEBKIT_KEYFRAME_RULE","defineProperty","ruleText","character","SIGNIFICANT_WHITESPACE","styleRule","mediaText","appendMedium","medium","deleteMedium","media","cssTexts","cssRule","_vendorPrefix","keyText","matcherText","appendMatcher","matcher","deleteMatcher","_getConstructorName","Exception","token","_token","_idx","info","expression","paren","_parseJSComment","_parseJSRexExp","_parseJSString","nextChar","endIdx","commentEndChar","startIdx","_findMatchedIdx","before","legalRegx","isLegal","some","reg","NOT_FOUND","matched","nextNewLineIdx","mediaRule","importRule","fontFaceRule","keyframesRule","documentRule","atRule","importRule-begin","atBlock","documentRule-begin","currentScope","atKeyframesRegExp","parseError","lines","lineCount","charCount","line","__starts","lastIndex","matchKeyframes","__ends","stylesheet","cloned","RULE_TYPES",1,4,8,9,"rulesLength","ruleClone","styleClone","styleLength","peg$subclass","child","ctor","found","peg$computePosDetails","advance","details","startPos","endPos","ch","seenCR","peg$cachedPos","peg$cachedPosDetails","peg$fail","peg$maxFailPos","peg$currPos","peg$maxFailExpected","peg$buildException","cleanupExpected","description","buildMessage","stringEscape","hex","toUpperCase","expectedDesc","foundDesc","expectedDescs","posDetails","peg$parsestart","s0","s1","peg$parsesourceEntries","peg$FAILED","peg$reportedPos","peg$c1","s2","s3","s4","s5","peg$parsesourceEntry","peg$parsewhitespace","peg$c3","peg$silentFails","peg$c4","peg$c5","peg$c2","peg$c6","peg$parseurlEntry","peg$parselocalEntry","peg$parseurl","peg$parseformat","peg$c7","peg$c8","peg$c9","peg$c10","peg$parsevalue","peg$c11","peg$c12","peg$c13","peg$c14","peg$c15","peg$c16","peg$c17","peg$c18","peg$c19","peg$c20","peg$c21","peg$c22","peg$c23","peg$result","peg$startRuleFunctions","peg$startRuleFunction","chars","extractValue","startRule"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], function (ayepromise, imagediff, rasterizeHTML) {\n      return (root.returnExportsGlobal = factory(ayepromise, imagediff, rasterizeHTML));\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like enviroments that support module.exports,\n    // like Node.\n    module.exports = factory(require(\"ayepromise\"),\n      require(\"imagediff\"),\n      require(\"rasterizehtml\"),\n      require(\"../build/csscritic.concat.css\"));\n  } else {\n    root['csscritic'] = factory();\n  }\n}(this, function (ayepromise, imagediff, rasterizeHTML) {\n\n    var csscriticLib = {};\n\n    csscriticLib.main = function (regression, reporting, util, storage, selectionFilter) {\n        \"use strict\";\n\n        var module = {};\n\n        var testCases = [],\n            currentComponentLabel;\n\n\n        module.component = function (componentLabel) {\n            currentComponentLabel = componentLabel;\n        };\n\n\n        var supportUrlAsOnlyTestCaseInput = function (testCase) {\n            if (typeof testCase === 'string') {\n                return {\n                    url: testCase\n                };\n            }\n            return testCase;\n        };\n\n        module.add = function (testCase) {\n            var augmentedTestCase = util.clone(supportUrlAsOnlyTestCaseInput(testCase));\n\n            if (currentComponentLabel && augmentedTestCase.component === undefined) {\n                augmentedTestCase.component = currentComponentLabel;\n            }\n\n            testCases.push(augmentedTestCase);\n        };\n\n\n        var fetchStartingComparisons = function (testCases) {\n            return util.all(testCases.map(function (testCase) {\n                return storage.readReferenceImage(testCase)\n                    .then(function (referenceImageRecord) {\n                        return {\n                            testCase: testCase,\n                            referenceImage: referenceImageRecord.image,\n                            viewport: referenceImageRecord.viewport\n                        };\n                    }, function () {\n                        // no referenceImage found\n                        return {\n                            testCase: testCase\n                        };\n                    });\n            }));\n        };\n\n        var selectComparisons = function (configuredComparisons) {\n            return configuredComparisons.map(function (configuredComparison) {\n                return {\n                    configuredComparison: configuredComparison,\n                    selected: !selectionFilter || selectionFilter.isComparisonSelected(configuredComparison)\n                };\n            });\n        };\n\n        var reportConfiguredComparisons = function (comparisonSelection) {\n            return util.all(comparisonSelection.map(function (selection) {\n                var isSelected = selection.selected;\n                return reporting.doReportConfiguredComparison(selection.configuredComparison, isSelected);\n            }));\n        };\n\n        var executeTestCase = function (startingComparison) {\n            return regression.compare(startingComparison).then(function (comparison) {\n                return reporting.doReportComparison(comparison).then(function () {\n                    return comparison;\n                });\n            });\n        };\n\n        module.execute = function () {\n            var comparisonSelection, allPassed;\n\n            return fetchStartingComparisons(testCases)\n                .then(function (startingComp) {\n                    comparisonSelection = selectComparisons(startingComp);\n\n                    return reportConfiguredComparisons(comparisonSelection);\n                })\n                .then(function () {\n                    var selectedComparisons = comparisonSelection.filter(function (selection) {\n                        return selection.selected;\n                    }).map(function (selection) {\n                        return selection.configuredComparison;\n                    });\n\n                    return util.all(selectedComparisons.map(\n                        executeTestCase\n                    ));\n                })\n                .then(function (comparisons) {\n                    allPassed = util.hasTestSuitePassed(comparisons);\n                })\n                .then(function () {\n                    return reporting.doReportTestSuite(allPassed);\n                })\n                .then(function () {\n                    return allPassed;\n                });\n        };\n\n        return module;\n    };\n\n    csscriticLib.regression = function (renderer, util, imagediff) {\n        \"use strict\";\n\n        var module = {};\n\n        var toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux = 1;\n\n        var workAroundFirefoxResourcesSporadicallyMissing = function (htmlImage, referenceImage) {\n            if (referenceImage) {\n                // This does nothing meaningful for us, but seems to trigger Firefox to load any missing resources.\n                imagediff.diff(htmlImage, referenceImage);\n            }\n        };\n\n        var workAroundBrowserIssues = function (pageImage, referenceImage) {\n            workAroundFirefoxResourcesSporadicallyMissing(pageImage, referenceImage);\n\n            return util.workAroundTransparencyIssueInFirefox(pageImage);\n        };\n\n        var compareRenderingAndReference = function (pageImage, referenceImage) {\n            var isEqual;\n\n            return workAroundBrowserIssues(pageImage, referenceImage).then(function (adaptedHtmlImage) {\n                if (referenceImage) {\n                    isEqual = imagediff.equal(\n                        adaptedHtmlImage,\n                        referenceImage,\n                        toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux\n                    );\n                    return isEqual ? \"passed\" : \"failed\";\n                } else {\n                    return \"referenceMissing\";\n                }\n            });\n        };\n\n        var comparisonResult = function (textualStatus, testCase, viewport, renderErrors, pageImage, referenceImage) {\n            var result = {\n                status: textualStatus,\n                testCase: testCase,\n                viewport: util.clone(viewport),\n                renderErrors: renderErrors\n            };\n\n            if (pageImage) {\n                result.pageImage = pageImage;\n            }\n            if (referenceImage) {\n                result.referenceImage = referenceImage;\n            }\n            return result;\n        };\n\n        var loadPageAndCompare = function (testCase, viewport, referenceImage) {\n            return renderer.render({\n                url: testCase.url,\n                hover: testCase.hover,\n                active: testCase.active,\n                width: viewport.width,\n                height: viewport.height\n            }).then(function (renderResult) {\n                return compareRenderingAndReference(renderResult.image, referenceImage).then(function (textualStatus) {\n                    return comparisonResult(textualStatus,\n                                            testCase,\n                                            viewport,\n                                            renderResult.errors,\n                                            renderResult.image,\n                                            referenceImage);\n                });\n            }, function () {\n                return comparisonResult(\"error\",\n                                        testCase,\n                                        viewport,\n                                        []);\n            });\n        };\n\n        var viewportFallback = function (testCase) {\n            var fallbackWidth = 800,\n                fallbackHeight = 100;\n            return {\n                width: testCase.width || fallbackWidth,\n                height: testCase.height || fallbackHeight\n            };\n        };\n\n        module.compare = function (startingComparison) {\n            var viewport = startingComparison.viewport;\n\n            if (startingComparison.referenceImage === undefined) {\n                viewport = viewportFallback(startingComparison.testCase);\n            }\n\n            return loadPageAndCompare(startingComparison.testCase, viewport, startingComparison.referenceImage);\n        };\n\n        return module;\n    };\n\n    csscriticLib.reporting = function (renderer, storage, util) {\n        \"use strict\";\n\n        var module = {};\n\n        var reporters = [];\n\n        module.addReporter = function (reporter) {\n            reporters.push(reporter);\n        };\n\n        var testCaseIsResizable = function (testCase) {\n            return testCase.width === undefined && testCase.height === undefined;\n        };\n\n        var attachPageAcceptHelpers = function (comparison) {\n            var viewportWidth, viewportHeight;\n\n            if (comparison.pageImage) {\n                viewportWidth = comparison.viewport.width;\n                viewportHeight = comparison.viewport.height;\n\n                if (testCaseIsResizable(comparison.testCase)) {\n                    comparison.resizePageImage = function (width, height) {\n                        viewportWidth = width;\n                        viewportHeight = height;\n\n                        return renderer.render({\n                            url: comparison.testCase.url,\n                            hover: comparison.testCase.hover,\n                            active: comparison.testCase.active,\n                            width: width,\n                            height: height\n                        }).then(function (renderResult) {\n                            comparison.pageImage = renderResult.image;\n                            return renderResult.image;\n                        });\n                    };\n                }\n                comparison.acceptPage = function () {\n                    storage.storeReferenceImage(comparison.testCase, comparison.pageImage, {\n                        width: viewportWidth,\n                        height: viewportHeight\n                    });\n                };\n            }\n        };\n\n        var reportingMethod = function (reporter, isSelected) {\n            if (isSelected) {\n                if (reporter.reportSelectedComparison) {\n                    return reporter.reportSelectedComparison;\n                } else {\n                    // legacy method name\n                    return reporter.reportComparisonStarting;\n                }\n            } else {\n                return reporter.reportDeselectedComparison;\n            }\n        };\n\n        module.doReportConfiguredComparison = function (configuredComparison, isSelected) {\n            return util.all(reporters.map(function (reporter) {\n                var reportingFunc = reportingMethod(reporter, isSelected);\n                if (reportingFunc) {\n                    return reportingFunc(configuredComparison);\n                }\n            }));\n        };\n\n        module.doReportComparison = function (comparison) {\n            var result = util.clone(comparison);\n\n            attachPageAcceptHelpers(result);\n\n            return util.all(reporters.map(function (reporter) {\n                if (reporter.reportComparison) {\n                    return reporter.reportComparison(result);\n                }\n            }));\n        };\n\n        module.doReportTestSuite = function (passed) {\n            return util.all(reporters.map(function (reporter) {\n                if (reporter.reportTestSuite) {\n                    return reporter.reportTestSuite({success: passed});\n                }\n            }));\n        };\n\n        return module;\n    };\n\n    csscriticLib.util = function () {\n        \"use strict\";\n\n        var module = {};\n\n        module.getDataURIForImage = function (image) {\n            var canvas = window.document.createElement(\"canvas\"),\n                context = canvas.getContext(\"2d\");\n\n            canvas.width = image.naturalWidth;\n            canvas.height = image.naturalHeight;\n\n            context.drawImage(image, 0, 0);\n\n            return canvas.toDataURL(\"image/png\");\n        };\n\n        module.getImageForUrl = function (url) {\n            var defer = ayepromise.defer(),\n                image = new window.Image();\n\n            image.onload = function () {\n                defer.resolve(image);\n            };\n            image.onerror = function () {\n                defer.reject();\n            };\n            image.src = url;\n\n            return defer.promise;\n        };\n\n        var getUncachableURL = function (url) {\n            var delimiter;\n            if (url.indexOf(\"?\") < 0) {\n                delimiter = \"?\";\n            } else {\n                delimiter = \"&\";\n            }\n            return url + delimiter + \"_=\" + Date.now();\n        };\n\n        module.ajax = function (url) {\n            var defer = ayepromise.defer(),\n                xhr = new XMLHttpRequest();\n\n            xhr.onload = function () {\n                if (xhr.status === 200 || xhr.status === 0) {\n                    defer.resolve(xhr.response);\n                } else {\n                    defer.reject();\n                }\n            };\n\n            xhr.onerror = function () {\n                defer.reject();\n            };\n\n            try {\n                xhr.open('get', getUncachableURL(url), true);\n                xhr.send();\n            } catch (e) {\n                defer.reject();\n            }\n\n            return defer.promise;\n        };\n\n        module.loadAsBlob = function (url) {\n            var defer = ayepromise.defer(),\n                xhr = new XMLHttpRequest();\n\n            xhr.onload = function () {\n                if (xhr.status === 200 || xhr.status === 0) {\n                    defer.resolve(xhr.response);\n                } else {\n                    defer.reject();\n                }\n            };\n\n            xhr.onerror = function () {\n                defer.reject();\n            };\n\n            try {\n                xhr.open('get', getUncachableURL(url), true);\n                xhr.responseType = 'blob';\n                xhr.send();\n            } catch (e) {\n                defer.reject();\n            }\n\n            return defer.promise;\n        };\n\n        module.loadBlobAsText = function (blob) {\n            var defer = ayepromise.defer(),\n                reader = new FileReader();\n\n            reader.onload = function (e) {\n                defer.resolve(e.target.result);\n            };\n\n            reader.onerror = function () {\n                defer.reject();\n            };\n\n            reader.readAsText(blob);\n\n            return defer.promise;\n        };\n\n        module.loadBlobAsDataURI = function (blob) {\n            var defer = ayepromise.defer(),\n                reader = new FileReader();\n\n            reader.onload = function (e) {\n                defer.resolve(e.target.result);\n            };\n\n            reader.onerror = function () {\n                defer.reject();\n            };\n\n            reader.readAsDataURL(blob);\n\n            return defer.promise;\n\n        };\n\n        // excludeKeys(theMap, excludeKey...)\n        module.excludeKeys = function (theMap) {\n            var excludeKeys = Array.prototype.slice.call(arguments, 1),\n                newMap = {};\n\n            Object.keys(theMap).forEach(function (key) {\n                if (excludeKeys.indexOf(key) === -1) {\n                    newMap[key] = theMap[key];\n                }\n            });\n\n            return newMap;\n        };\n\n        module.serializeMap = function (theMap) {\n            var serializationEntries = [],\n                keys = Object.keys(theMap);\n\n            keys.sort();\n            keys.forEach(function (key) {\n                serializationEntries.push(key + '=' + theMap[key]);\n            });\n            return serializationEntries.join(',');\n        };\n\n        module.clone = function (object) {\n            var theClone = {},\n                i;\n            for (i in object) {\n                if (object.hasOwnProperty(i)) {\n                   theClone[i] = object[i];\n                }\n            }\n            return theClone;\n        };\n\n        var successfulPromise = function (value) {\n            var defer = ayepromise.defer();\n            defer.resolve(value);\n            return defer.promise;\n        };\n\n        module.workAroundTransparencyIssueInFirefox = function (image) {\n            // Work around bug https://bugzilla.mozilla.org/show_bug.cgi?id=790468 where the content of a canvas\n            //   drawn to another one will be slightly different if transparency is involved.\n            // Here the reference image has been drawn to a canvas once (to serialize it to localStorage), while the\n            //   image of the newly rendered page hasn't.  Solution: apply the same transformation to the second image, too.\n            var dataUri;\n            try {\n                dataUri = module.getDataURIForImage(image);\n            } catch (e) {\n                // Fallback for Chrome & Safari\n                return successfulPromise(image);\n            }\n\n            return module.getImageForUrl(dataUri);\n        };\n\n        module.hasTestSuitePassed = function (comparisons) {\n            var nonPassingTestCases = comparisons.filter(function (comparison) {\n                    return comparison.status !== \"passed\";\n                }),\n                allPassed = nonPassingTestCases.length === 0;\n\n            return allPassed;\n        };\n\n        module.all = function (functionReturnValues) {\n            var defer = ayepromise.defer(),\n                pendingFunctionCalls = functionReturnValues.length,\n                resolvedValues = [];\n\n            var functionCallResolved = function (value, idx) {\n                pendingFunctionCalls -= 1;\n                resolvedValues[idx] = value;\n\n                if (pendingFunctionCalls === 0) {\n                    defer.resolve(resolvedValues);\n                }\n            };\n\n            if (functionReturnValues.length === 0) {\n                defer.resolve([]);\n                return defer.promise;\n            }\n\n            functionReturnValues.forEach(function (returnValue, idx) {\n                if (returnValue && returnValue.then) {\n                    returnValue.then(function (result) {\n                        functionCallResolved(result, idx);\n                    }, function (e) {\n                        defer.reject(e);\n                    });\n                } else {\n                    functionCallResolved(returnValue, idx);\n                }\n            });\n            return defer.promise;\n        };\n\n        return module;\n    };\n\n    csscriticLib.basicHTMLReporter = function (util, reporterUtil, document) {\n        \"use strict\";\n\n        var module = {};\n\n        // our very own templating implementation\n\n        var escapeValue = function (value) {\n            return value.toString()\n                .replace(/&/g, '&amp;')\n                .replace(new RegExp('<'), '&lt;', 'g') // work around https://github.com/cburgmer/inlineresources/issues/2\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&apos;');\n        };\n\n        var template = function (templateStr, values) {\n            return templateStr.replace(/\\{\\{(\\w+)\\}\\}/g, function (_, param) {\n                var value = values[param] || '';\n                return escapeValue(value);\n            });\n        };\n\n        var elementFor = function (htmlString) {\n            var tmp = document.createElement('body');\n            tmp.insertAdjacentHTML('beforeend', htmlString);\n            return tmp.firstChild;\n        };\n\n        // other stuff\n\n        var cssPixelValue = function (pxValue) {\n            return parseInt(pxValue, 10);\n        };\n\n        var registerResizeHandler = function (element, handler) {\n            var width = cssPixelValue(element.style.width),\n                height = cssPixelValue(element.style.height);\n\n            element.onmouseup = function () {\n                var newWidth = cssPixelValue(element.style.width),\n                    newHeight = cssPixelValue(element.style.height);\n                if (width !== newWidth || height !== newHeight) {\n                    width = newWidth;\n                    height = newHeight;\n                    handler(width, height);\n                }\n            };\n        };\n\n        var getOrCreateBody = function () {\n            var reporterId = \"csscritic_basichtmlreporter\",\n                reportBody = document.getElementById(reporterId);\n\n            if (reportBody === null) {\n                reportBody = elementFor(template('<div id=\"{{reporterId}}\"><div class=\"timeTaken\"></div></div>', {\n                    reporterId: reporterId\n                }));\n\n                document.getElementsByTagName(\"body\")[0].appendChild(reportBody);\n            }\n\n            return reportBody;\n        };\n\n        // content building\n\n        var createPageCanvasContainer = function (result, withCaption) {\n            var caption = '',\n                currentPageSection, currentPageResizableCanvas, currentPageImageContainer;\n\n            if (withCaption) {\n                caption = '<span class=\"caption\">Page</span>';\n            }\n\n            currentPageSection = elementFor(template(\n                '<div class=\"currentPageSection\">' +\n                caption +\n                '<div class=\"currentPageResizableCanvas\" style=\"width: {{width}}px; height: {{height}}px;\">' +\n                '<div class=\"currentPageImageContainer\"></div>' +\n                '</div>' +\n                '</div>', {\n                width: result.pageImage.width,\n                height: result.pageImage.height\n            }));\n\n            currentPageResizableCanvas = currentPageSection.querySelector('.currentPageResizableCanvas');\n            currentPageImageContainer = currentPageSection.querySelector('.currentPageImageContainer');\n\n            currentPageImageContainer.appendChild(result.pageImage);\n\n            if (result.resizePageImage) {\n                currentPageSection.classList.add('resizable');\n\n                registerResizeHandler(currentPageResizableCanvas, function (width, height) {\n                    var oldImage = result.pageImage;\n\n                    result.resizePageImage(width, height).then(function (updatedImage) {\n                        currentPageResizableCanvas.style.width = updatedImage.width + \"px\";\n                        currentPageResizableCanvas.style.height = updatedImage.height + \"px\";\n\n                        currentPageImageContainer.removeChild(oldImage);\n                        currentPageImageContainer.appendChild(updatedImage);\n                    });\n                });\n            }\n\n            return currentPageSection;\n        };\n\n        var createReferenceImageContainer = function (result) {\n            var referenceSection = elementFor(\n                    '<div class=\"referenceSection\">' +\n                    '<span class=\"caption\">Reference</span>' +\n                    '<div class=\"referenceImageContainer\">' +\n                    '</div>' +\n                    '</div>'\n                );\n\n            var referenceImageContainer = referenceSection.querySelector('.referenceImageContainer');\n            referenceImageContainer.appendChild(result.referenceImage);\n\n            return referenceSection;\n        };\n\n        var createAcceptHint = function (result, parameters) {\n            var acceptHint = elementFor(template(\n                    '<div class=\"{{className}}\">' +\n                    '{{prefix}}' +\n                    '<button>{{buttonCaption}}</button>' +\n                    '{{postfix}}' +\n                    '</div>',\n                    parameters\n                ));\n\n            var acceptButton = acceptHint.querySelector('button');\n\n            acceptButton.onclick = function () {\n                result.acceptPage();\n                acceptHint.classList.add('finished');\n            };\n            return acceptHint;\n        };\n\n        var createSaveHint = function (result) {\n            return createAcceptHint(result, {\n                className: 'saveHint',\n                prefix: '',\n                buttonCaption: 'Accept the rendered page',\n                postfix: 'and save this as later reference.'\n            });\n        };\n\n        var createUpdateHint = function (result) {\n            return createAcceptHint(result, {\n                className: 'updateHint',\n                prefix: 'You can',\n                buttonCaption: 'accept the rendered page',\n                postfix: 'thus making it the new reference.'\n            });\n        };\n\n        var makeUnsortedList = function (items) {\n            var lis = items.map(function (value) {\n                return template('<li>{{value}}</li>', {\n                    value: value\n                });\n            });\n\n            return '<ul>' + lis.join('\\n') + '</ul>';\n        };\n\n        var createErroneousResourceWarning = function (result) {\n            return elementFor('<div class=\"loadErrors\">' +\n                'Had the following errors rendering the page:' +\n                makeUnsortedList(result.renderErrors) +\n                'Make sure that resource paths lie within the same origin as this document.' +\n                '</div>'\n            );\n        };\n\n        var createErrorMsg = function (comparison) {\n            return elementFor(template(\n                '<div class=\"errorMsg\">' +\n                \"The page '{{url}}' could not be rendered. Make sure the path lies within the same origin as this document.\" +\n                '</div>', {\n                url: comparison.testCase.url\n            }));\n        };\n\n        var createDifferenceCanvasContainer = function (result) {\n            var differenceCanvasSection = elementFor(\n                    '<div class=\"differenceCanvasSection\"><div class=\"differenceCanvasContainer\"></div></div>'\n                ),\n                differenceCanvasContainer = differenceCanvasSection.querySelector('.differenceCanvasContainer'),\n                differenceCanvas = reporterUtil.getDifferenceCanvas(result.pageImage, result.referenceImage),\n                highlightedDifferenceCanvas = reporterUtil.getHighlightedDifferenceCanvas(result.pageImage, result.referenceImage);\n\n            differenceCanvas.className = \"differenceCanvas\";\n            differenceCanvasContainer.appendChild(differenceCanvas);\n\n            highlightedDifferenceCanvas.className = \"highlightedDifferenceCanvas\";\n            differenceCanvasContainer.appendChild(highlightedDifferenceCanvas);\n\n            return differenceCanvasSection;\n        };\n\n        var textualStatus = {\n            passed: 'passed',\n            failed: 'failed',\n            referenceMissing: 'missing reference',\n            error: 'error'\n        };\n\n        var createStatus = function (result) {\n            return elementFor(template('<span class=\"status\">{{status}}</span>', {\n                status: textualStatus[result.status]\n            }));\n        };\n\n        var getOrCreateDivWithId = function (id) {\n            var tooltip = document.getElementById(id);\n\n            if (!tooltip) {\n                tooltip = elementFor(template('<div id=\"{{id}}\" style=\"display: none; position: absolute;\"></div>', {\n                    id: id\n                }));\n                document.getElementsByTagName(\"body\")[0].appendChild(tooltip);\n            }\n\n            return tooltip;\n        };\n\n        var emptyNode = function (node) {\n            while (node.hasChildNodes()) {\n                node.removeChild(node.lastChild);\n            }\n        };\n\n        var addMouseOverHandlerForPreview = function (entry, result) {\n            entry.onmouseover = function (event) {\n                var tooltip = getOrCreateDivWithId(\"csscritic_basichtmlreporter_tooltip\"),\n                    image = result.referenceImage;\n\n                emptyNode(tooltip);\n                tooltip.style.display = \"block\";\n                tooltip.style.top = event.pageY + 10 + \"px\";\n                tooltip.style.left = event.pageX + 10 + \"px\";\n\n                tooltip.appendChild(image);\n            };\n\n            entry.onmousemove = function (event) {\n                var tooltip = getOrCreateDivWithId(\"csscritic_basichtmlreporter_tooltip\");\n\n                tooltip.style.top = event.pageY + 10 + \"px\";\n                tooltip.style.left = event.pageX + 10 + \"px\";\n            };\n\n            entry.onmouseout = function () {\n                var tooltip = getOrCreateDivWithId(\"csscritic_basichtmlreporter_tooltip\");\n\n                tooltip.style.display = \"none\";\n            };\n        };\n\n        var fillEntry = function (entry, comparison) {\n            entry.className += \" \" + comparison.status;\n\n            entry.appendChild(createStatus(comparison));\n\n            if (comparison.renderErrors && comparison.renderErrors.length) {\n                entry.appendChild(createErroneousResourceWarning(comparison));\n            }\n\n            if (comparison.status === \"failed\") {\n                entry.appendChild(createDifferenceCanvasContainer(comparison));\n                entry.appendChild(createPageCanvasContainer(comparison, true));\n                entry.appendChild(createReferenceImageContainer(comparison));\n                entry.appendChild(createUpdateHint(comparison));\n            } else if (comparison.status === \"referenceMissing\") {\n                entry.appendChild(createSaveHint(comparison));\n                entry.appendChild(createPageCanvasContainer(comparison));\n            } else if (comparison.status === \"error\") {\n                entry.appendChild(createErrorMsg(comparison));\n            } else if (comparison.status === \"passed\") {\n                addMouseOverHandlerForPreview(entry, comparison);\n            }\n        };\n\n        var testCaseParameters = function (comparison) {\n            var parameters = util.excludeKeys(comparison.testCase, 'url'),\n                keys = Object.keys(parameters);\n\n            if (!keys.length) {\n                return '';\n            }\n            keys.sort();\n\n            return '<dl class=\"parameters\">' +\n                keys.map(function (key) {\n                    return template('<dt>{{key}}</dt><dd>{{value}}</dd>', {\n                        key: key,\n                        value: parameters[key]\n                    });\n                }).join('\\n') +\n                '</dl>';\n        };\n\n        var createRunningEntry = function (comparison) {\n            return elementFor(template(\n                '<div class=\"comparison running\">' +\n                '<a href=\"{{url}}\" class=\"pageUrl\">{{url}}</a>' +\n                testCaseParameters(comparison) +\n                '</div>', {\n                url: comparison.testCase.url\n            }));\n        };\n\n        var addFinalEntry = function (comparison, runningNode) {\n            runningNode.className = runningNode.className.replace(\" running\", \"\");\n            fillEntry(runningNode, comparison);\n        };\n\n        var padNumber = function (number, length) {\n            number += '';\n            while (number.length < length) {\n                number = \"0\" + number;\n            }\n            return number;\n        };\n\n        var renderMilliseconds = function (time) {\n            var seconds = Math.floor(time / 1000),\n                milliSeconds = time % 1000;\n            return seconds + '.' + padNumber(milliSeconds, 3);\n        };\n\n        var createTimer = function () {\n            var timeStarted = Date.now();\n\n            return {\n                stop: function () {\n                    var timeTaken = (timeStarted === null) ? 0 : Date.now() - timeStarted;\n                    return timeTaken;\n                }\n            };\n        };\n\n        var showTimeTaken = function (timer) {\n            var reportBody = getOrCreateBody(),\n                timeTaken = (timer === null) ? 0 : timer.stop(),\n                timeTakenNode = reportBody.getElementsByClassName(\"timeTaken\")[0];\n\n            timeTakenNode.textContent = \"finished in \" + renderMilliseconds(timeTaken) + \"s\";\n        };\n\n        var showBrowserWarningIfNeeded = function () {\n            reporterUtil.supportsReadingHtmlFromCanvas(function (supported) {\n                if (supported) {\n                    return;\n                }\n\n                getOrCreateBody().appendChild(elementFor(\n                    '<div class=\"browserWarning\">' +\n                    'Your browser is currently not supported, ' +\n                    'as it does not support reading rendered HTML from the canvas ' +\n                    '(<a href=\"https://code.google.com/p/chromium/issues/detail?id=294129\">Chrome #294129</a>, ' +\n                    '<a href=\"https://bugs.webkit.org/show_bug.cgi?id=17352\">Safari #17352</a>). How about trying Firefox?' +\n                    '</div>'\n                ));\n            });\n        };\n\n        module.BasicHTMLReporter = function () {\n            var runningComparisonEntries = {},\n                timer = null;\n\n            showBrowserWarningIfNeeded();\n\n            var createComparisonEntry = function (comparison) {\n                var key = util.serializeMap(comparison.testCase),\n                    node = createRunningEntry(comparison);\n\n                getOrCreateBody().appendChild(node);\n\n                runningComparisonEntries[key] = node;\n\n                return node;\n            };\n\n            var getComparisonEntry = function (comparison) {\n                var key = util.serializeMap(comparison.testCase);\n\n                return runningComparisonEntries[key];\n            };\n\n            return {\n                reportComparisonStarting: function (comparison) {\n                    if (timer === null) {\n                        timer = createTimer();\n                    }\n\n                    createComparisonEntry(comparison);\n                },\n                reportComparison: function (comparison) {\n                    var node = getComparisonEntry(comparison);\n\n                    addFinalEntry(comparison, node);\n                },\n                reportTestSuite: function () {\n                    showTimeTaken(timer);\n                }\n            };\n        };\n\n        return module;\n    };\n\n    csscriticLib.basicHTMLReporterUtil = function () {\n        \"use strict\";\n\n        var module = {};\n\n        module.supportsReadingHtmlFromCanvas = function (callback) {\n            var canvas = document.createElement(\"canvas\"),\n                svg = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"1\" height=\"1\"><foreignObject></foreignObject></svg>',\n                image = new Image();\n\n            image.onload = function () {\n                var context = canvas.getContext(\"2d\");\n                try {\n                    context.drawImage(image, 0, 0);\n                    // This will fail in Chrome & Safari\n                    context.getImageData(0, 0, 1, 1);\n                } catch (e) {\n                    callback(false);\n                    // Firefox throws a 'NS_ERROR_NOT_AVAILABLE' if the SVG is faulty\n                    return false;\n                }\n                callback(true);\n            };\n            image.src = \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(svg);\n        };\n\n        var canvasForImageCanvas = function (imageData) {\n            var canvas = document.createElement(\"canvas\"),\n                context;\n\n            canvas.height = imageData.height;\n            canvas.width  = imageData.width;\n\n            context = canvas.getContext(\"2d\");\n            context.putImageData(imageData, 0, 0);\n\n            return canvas;\n        };\n\n        var diffPageImages = function (imageA, imageB) {\n            return imagediff.diff(imageA, imageB, {align: 'top'});\n        };\n\n        module.getDifferenceCanvas = function (imageA, imageB) {\n            var differenceImageData = diffPageImages(imageA, imageB);\n\n            return canvasForImageCanvas(differenceImageData);\n        };\n\n        var scale = function (byte) {\n            var normalize = Math.log(256);\n\n            return Math.floor(255 * Math.log(byte + 1) / normalize);\n        };\n\n        module.getHighlightedDifferenceCanvas = function (imageA, imageB) {\n            var differenceImageData = diffPageImages(imageA, imageB);\n\n            for (var i = 0; i < differenceImageData.data.length; i++) {\n                if (i % 4 < 3) {\n                    differenceImageData.data[i] = scale(differenceImageData.data[i]);\n                }\n            }\n\n            return canvasForImageCanvas(differenceImageData);\n        };\n\n        return module;\n    };\n\n\n    csscriticLib.browserRenderer = function (util, jobQueue, rasterizeHTML) {\n        \"use strict\";\n\n        var module = {};\n\n        var cache = {};\n\n        var queue;\n\n        var getOrCreateJobQueue = function () {\n            if (!queue) {\n                queue = jobQueue();\n            }\n            return queue;\n        };\n\n        var extractErrorMessages = function (errors) {\n            return errors.map(function (error) {\n                return error.msg;\n            });\n        };\n\n        var logErrorToConsole = function (e) {\n            console.error(e);\n\n            throw e;\n        };\n\n        var doRenderHtml = function (parameters) {\n            var drawOptions = {\n                    cache: 'repeated',\n                    cacheBucket: cache,\n                    width: parameters.width,\n                    height: parameters.height,\n                    executeJs: true,\n                    executeJsTimeout: 50,\n                    baseUrl: parameters.baseUrl\n                };\n            if (parameters.hover) {\n                drawOptions.hover = parameters.hover;\n            }\n            if (parameters.active) {\n                drawOptions.active = parameters.active;\n            }\n\n            return rasterizeHTML.drawHTML(parameters.html, drawOptions).then(function (result) {\n                var renderErrors = extractErrorMessages(result.errors);\n\n                return {\n                    image: result.image,\n                    errors: renderErrors\n                };\n            }, logErrorToConsole);\n        };\n\n        var renderHtmlFromBlob = function (blob, parameters) {\n            return util.loadBlobAsText(blob).then(function (content) {\n                return doRenderHtml({\n                    html: content,\n                    baseUrl: parameters.url,\n                    width: parameters.width,\n                    height: parameters.height,\n                    hover: parameters.hover,\n                    active: parameters.active\n                });\n            });\n        };\n\n        var loadImageFromBlob = function (blob, parameters) {\n            return util.loadBlobAsDataURI(blob)\n                .then(util.getImageForUrl)\n                .then(function (image) {\n                    return {\n                        image: image,\n                        errors: []\n                    };\n                }, function () {\n                    // It's not an image, so it must be a HTML page\n                    return renderHtmlFromBlob(blob, parameters);\n                });\n        };\n\n        module.render = function (parameters) {\n            // Execute render jobs one after another to stabilise rendering (especially JS execution).\n            // Also provides a more fluid response. Performance seems not to be affected.\n            return getOrCreateJobQueue().execute(function () {\n                return util.loadAsBlob(parameters.url)\n                    .then(function (blob) {\n                        return loadImageFromBlob(blob, parameters);\n                    });\n            });\n        };\n\n        return module;\n    };\n\n    csscriticLib.domstorage = function (util, localStorage) {\n        \"use strict\";\n\n        var module = {};\n\n        var buildKey = function (testCase) {\n            var testCaseParameters = util.excludeKeys(testCase, 'url'),\n                serializedParameters = util.serializeMap(testCaseParameters),\n                key = testCase.url;\n\n            if (serializedParameters) {\n                key += ',' + serializedParameters;\n            }\n\n            return key;\n        };\n\n        var successfulPromise = function () {\n            var defer = ayepromise.defer();\n            defer.resolve();\n            return defer.promise;\n        };\n\n        module.storeReferenceImage = function (testCase, pageImage, viewport) {\n            var uri, dataObj, key;\n\n            try {\n                uri = util.getDataURIForImage(pageImage);\n            } catch (e) {\n                window.alert(\"An error occurred reading the canvas. Are you sure you are using Firefox?\\n\" + e);\n                throw e;\n            }\n            dataObj = {\n                referenceImageUri: uri,\n                viewport: {\n                    width: viewport.width,\n                    height: viewport.height\n                }\n            };\n\n            key = buildKey(testCase);\n\n            localStorage.setItem(key, JSON.stringify(dataObj));\n\n            return successfulPromise();\n        };\n\n        var parseStoredItem = function (dataObjString) {\n            var dataObj;\n\n            if (! dataObjString) {\n                throw new Error(\"No data supplied\");\n            }\n\n            dataObj = JSON.parse(dataObjString);\n\n            if (!dataObj.referenceImageUri) {\n                throw new Error(\"No reference image found\");\n            }\n\n            return dataObj;\n        };\n\n        var failedPromise = function () {\n            var defer = ayepromise.defer();\n            defer.reject();\n            return defer.promise;\n        };\n\n        module.readReferenceImage = function (testCase) {\n            var key = buildKey(testCase),\n                dataObj;\n\n            try {\n                dataObj = parseStoredItem(localStorage.getItem(key));\n            } catch (e) {\n                return failedPromise();\n            }\n\n            return util.getImageForUrl(dataObj.referenceImageUri).then(function (img) {\n                var viewport = dataObj.viewport || {\n                    width: img.width,\n                    height: img.height\n                };\n\n                return {\n                    image: img,\n                    viewport: viewport\n                };\n            });\n        };\n\n        return module;\n    };\n\n    csscriticLib.fallbackFilter = function (windowLocation) {\n        \"use strict\";\n\n        var module = {};\n\n        var storageKey = 'csscriticFallbackFilter';\n\n        var fullDescription = function (testCase) {\n            return testCase.component ? testCase.component + ' ' + testCase.desc : testCase.desc;\n        };\n\n        module.isComparisonSelected = function (comparison) {\n            var filter = sessionStorage.getItem(storageKey);\n\n            if (!filter) {\n                return true;\n            }\n\n            if (comparison.testCase.desc && fullDescription(comparison.testCase) === filter) {\n                return true;\n            }\n            if (comparison.testCase.component && comparison.testCase.component === filter) {\n                return true;\n            }\n\n            return !filter || comparison.testCase.url === filter;\n        };\n\n        module.filterFor = function (testCase) {\n            var filter;\n\n            if (testCase.desc) {\n                filter = fullDescription(testCase);\n            } else {\n                filter = testCase.url;\n            }\n            sessionStorage.setItem(storageKey, filter);\n\n            windowLocation.reload();\n        };\n\n        module.filterForComponent = function (componentLabel) {\n            sessionStorage.setItem(storageKey, componentLabel);\n\n            windowLocation.reload();\n        };\n\n        module.clearFilter = function () {\n            sessionStorage.removeItem(storageKey);\n\n            windowLocation.reload();\n        };\n\n        return module;\n    };\n\n    csscriticLib.indexeddbstorage = function (util) {\n        \"use strict\";\n\n        var module = {};\n\n        var createDb = function(db) {\n            db.createObjectStore('references', { keyPath: \"testCase\" });\n        };\n\n        var getDb = function () {\n            var defer = ayepromise.defer(),\n                request = indexedDB.open('csscritic', 1);\n\n            request.onsuccess = function (event) {\n                var db = event.target.result;\n                defer.resolve(db);\n            };\n            request.onupgradeneeded = function (event) {\n                var db = event.target.result;\n                createDb(db);\n            };\n            return defer.promise;\n        };\n\n        var buildKey = function (testCase) {\n            var testCaseParameters = util.excludeKeys(testCase, 'url'),\n                serializedParameters = util.serializeMap(testCaseParameters),\n                key = testCase.url;\n\n            if (serializedParameters) {\n                key += ',' + serializedParameters;\n            }\n\n            return key;\n        };\n\n        module.storeReferenceImage = function (testCase, referenceImage, viewport) {\n            var defer = ayepromise.defer(),\n                imageUri;\n\n            imageUri = util.getDataURIForImage(referenceImage);\n\n            var key = buildKey(testCase);\n\n            getDb().then(function (db) {\n                var request = db.transaction(['references'], 'readwrite')\n                    .objectStore('references')\n                    .put({\n                        testCase: key,\n                        reference: {\n                            imageUri: imageUri,\n                            viewport: viewport\n                        }\n                    });\n\n                request.onsuccess = function () {\n                    db.close();\n\n                    defer.resolve();\n                };\n            });\n\n            return defer.promise;\n        };\n\n        module.readReferenceImage = function (testCase) {\n            var defer = ayepromise.defer(),\n                key = buildKey(testCase);\n\n            getDb().then(function (db) {\n                var request = db.transaction(['references'])\n                    .objectStore('references')\n                    .get(key);\n\n                request.onsuccess = function () {\n                    db.close();\n\n                    if (request.result === undefined || request.result.reference === undefined || request.result.reference.imageUri === undefined) {\n                        defer.reject();\n                        return;\n                    }\n\n                    var dataObj = request.result.reference;\n\n                    util.getImageForUrl(dataObj.imageUri).then(function (img) {\n                        var viewport = dataObj.viewport || {\n                            width: img.width,\n                            height: img.height\n                        };\n\n                        defer.resolve({\n                            image: img,\n                            viewport: viewport\n                        });\n                    }, defer.reject);\n                };\n            });\n\n            return defer.promise;\n        };\n\n        return module;\n    };\n\n    csscriticLib.jobQueue = function () {\n        \"use strict\";\n\n        var module = {};\n\n        var jobQueue = [],\n            busy = false;\n\n        var runJob = function (job) {\n            var result = job.func();\n\n            job.resolve(result);\n            return result;\n        };\n\n        var nextInQueue = function () {\n            var job;\n            if (jobQueue.length > 0) {\n                busy = true;\n\n                job = jobQueue.shift();\n\n                runJob(job)\n                    .then(nextInQueue, nextInQueue);\n            } else {\n                busy = false;\n            }\n        };\n\n        var constructJob = function (func) {\n            var defer = ayepromise.defer();\n\n            return {\n                func: func,\n                resolve: defer.resolve,\n                promise: defer.promise\n            };\n        };\n\n        module.execute = function (func) {\n            var job = constructJob(func);\n\n            jobQueue.push(job);\n            if (!busy) {\n                nextInQueue();\n            }\n\n            return job.promise;\n        };\n\n        return module;\n    };\n\n    csscriticLib.migratetoindexeddbstorage = function (domStorage, indexedDbStorage) {\n        \"use strict\";\n\n        var module = {};\n\n        module.storeReferenceImage = function (testCase, referenceImage, viewport) {\n            return indexedDbStorage.storeReferenceImage(testCase, referenceImage, viewport);\n        };\n\n        var fallbackToDomStorageAndMigrate = function (testCase) {\n            return domStorage.readReferenceImage(testCase)\n                .then(function (result) {\n                    return module.storeReferenceImage(testCase, result.image, result.viewport)\n                        .then(function () {\n                            return result;\n                        });\n                });\n        };\n\n        module.readReferenceImage = function (testCase) {\n            return indexedDbStorage.readReferenceImage(testCase)\n                .then(null, function () {\n                    return fallbackToDomStorageAndMigrate(testCase);\n                });\n        };\n\n        return module;\n    };\n\n    csscriticLib.niceReporter = function (util, selectionFilter, pageNavigationHandlingFallback, rasterizeHTML, packageVersion) {\n        \"use strict\";\n\n        var module = {};\n\n        // our very own templating implementation\n\n        var escapeValue = function (value) {\n            return value.toString()\n                .replace(/&/g, '&amp;')\n                .replace(new RegExp('<'), '&lt;', 'g') // work around https://github.com/cburgmer/inlineresources/issues/2\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&apos;');\n        };\n\n        var template = function (templateStr, values) {\n            return templateStr.replace(/\\{\\{(\\w+)\\}\\}/g, function (_, param) {\n                var value = values[param] !== undefined ? values[param] : '';\n                return escapeValue(value);\n            });\n        };\n\n        var elementFor = function (htmlString) {\n            var tmp = document.createElement('body');\n            tmp.insertAdjacentHTML('beforeend', htmlString);\n            return tmp.firstChild;\n        };\n\n        var findElementIn = function (container, elementClassName) {\n            return container.querySelector('.' + elementClassName);\n        };\n\n        var escapeId = function (id) {\n            return id.replace(' ', '_', 'g');\n        };\n\n        // container\n\n        var headerClassName = 'header',\n            timeTakenClassName = 'timeTaken',\n            progressBarClassName = 'progressBar',\n            statusTextClassName = 'statusText';\n\n        var createContainer = function (parentContainer) {\n            var reportBody = elementFor('<div class=\"cssCriticNiceReporter\"></div>');\n\n            showHeader(reportBody);\n\n            parentContainer.appendChild(reportBody);\n\n            return reportBody;\n        };\n\n        var showHeader = function (container) {\n            var header = elementFor(template('<header class=\"{{headerClassName}}\">' +\n                                             '<a href=\"http://cburgmer.github.io/csscritic/\" class=\"cssCriticVersion\">' +\n                                             'CSS Critic {{packageVersion}}' +\n                                             '</a>' +\n                                             '<span class=\"{{timeTakenClassName}}\"></span>' +\n                                             '<ul class=\"{{progressBarClassName}}\"></ul>' +\n                                             '<div class=\"{{statusTextClassName}}\" class=\"statusText\"></div>' +\n                                             '</header>', {\n                                                 headerClassName: headerClassName,\n                                                 timeTakenClassName: timeTakenClassName,\n                                                 progressBarClassName: progressBarClassName,\n                                                 statusTextClassName: statusTextClassName,\n                                                 packageVersion: packageVersion\n                                             }));\n\n            container.appendChild(header);\n        };\n\n        // document title\n\n        var originalTitle;\n\n        var updateStatusInDocumentTitle = function (totalCount, doneCount) {\n            if (originalTitle === undefined) {\n                originalTitle = document.title;\n            }\n\n            document.title = \"(\" + doneCount + \"/\" + totalCount + \") \" + originalTitle;\n        };\n\n        // header\n\n        var padNumber = function (number, length) {\n            number += '';\n            while (number.length < length) {\n                number = \"0\" + number;\n            }\n            return number;\n        };\n\n        var renderMilliseconds = function (time) {\n            var seconds = Math.floor(time / 1000),\n                milliSeconds = time % 1000;\n            return seconds + '.' + padNumber(milliSeconds, 3);\n        };\n\n        var showTimeTaken = function (container, timeTakenInMillis) {\n            var timeTaken = findElementIn(container, timeTakenClassName);\n            timeTaken.textContent = \"finished in \" + renderMilliseconds(timeTakenInMillis) + \"s\";\n        };\n\n        var setOutcomeOnHeader = function (container, successful) {\n            var header = findElementIn(container, headerClassName);\n\n            header.classList.add(successful ? 'pass' : 'fail');\n        };\n\n        // progress bar\n\n        var progressBarPendingClassName = 'pending';\n\n        var testDescription = function (testCase) {\n            var component;\n            if (testCase.desc) {\n                component = testCase.component ? testCase.component + ' ' : '';\n                return component + testCase.desc;\n            } else {\n                return comparisonKey(testCase);\n            }\n        };\n\n        var addTickToProgressBar = function (container, testCase, linkTarget) {\n            var progressBar = findElementIn(container, progressBarClassName),\n                clickableTickTemplate = '<li><a href=\"#{{linkTarget}}\" title=\"{{title}}\"></a></li>',\n                deactivatedTickTemplate = '<li><a title=\"{{title}}\"></a></li>',\n                tickTemplate = linkTarget ? clickableTickTemplate : deactivatedTickTemplate;\n\n            var tick = elementFor(template(tickTemplate, {\n                linkTarget: linkTarget ? escapeId(linkTarget) : '',\n                title: testDescription(testCase)\n            }));\n            tick.classList.add(progressBarPendingClassName);\n            progressBar.appendChild(tick);\n\n            if (pageNavigationHandlingFallback) {\n                pageNavigationHandlingFallback.install(tick.querySelector('a'));\n            }\n\n            return tick;\n        };\n\n        var markTickDone = function (status, renderErrorCount, tickElement) {\n            tickElement.classList.remove(progressBarPendingClassName);\n            tickElement.classList.add(status);\n            if (renderErrorCount > 0) {\n                tickElement.classList.add('hasRenderErrors');\n            }\n        };\n\n        // status bar\n\n        var singularPlural = function (value, singularForm, pluralForm) {\n            if (value === 1) {\n                return singularForm;\n            } else {\n                return pluralForm;\n            }\n        };\n\n        var statusTotalText = function (totalCount, selectedCount) {\n            var totalContent = '{{total}} ' + singularPlural(totalCount, 'entry', 'entries') + ', ';\n            if (selectedCount < totalCount) {\n                totalContent = '{{selected}} of ' + totalContent;\n            }\n            return template('<span>' +\n                            totalContent +\n                            '</span>', {\n                total: totalCount,\n                selected: selectedCount\n            });\n        };\n\n        var statusIssueText = function (issueCount, selectedCount, doneCount) {\n            var issueContent = '{{issues}} ' + singularPlural(issueCount, 'needs', 'need') + ' some love',\n                doneContent = 'all good',\n                doneWithoutErrors = selectedCount === doneCount && issueCount === 0,\n                content = doneWithoutErrors ? doneContent : issueContent;\n            return template('<span>' +\n                            content +\n                            '</span>', {\n                                issues: issueCount\n                            });\n        };\n\n        var acceptAllClassName = 'acceptAll';\n\n        var acceptAllButton = function () {\n            return elementFor(template('<button class=\"{{acceptAllClassName}}\">... accept all (I know what I\\'m doing)</button>', {\n                acceptAllClassName: acceptAllClassName\n            }));\n        };\n\n        var showAcceptAllButtonIfNeccessary = function (container, acceptableEntries) {\n            var statusText = findElementIn(container, statusTextClassName),\n                button = statusText.querySelector('.' + acceptAllClassName);\n\n            if (acceptableEntries.length > 2) {\n                button.classList.add('active');\n                button.onclick = function () {\n                    acceptableEntries.forEach(function (acceptableEntry) {\n                        acceptableEntry.acceptPage();\n                        acceptComparison(acceptableEntry.entry);\n                    });\n\n                    button.setAttribute('disabled', 'disabled');\n                };\n            }\n        };\n\n        var installFallbackClearSelectionHandler = function (element) {\n            if (selectionFilter.clearFilter) {\n                element.onclick = function (e) {\n                    selectionFilter.clearFilter();\n                    e.preventDefault();\n                };\n            }\n        };\n\n        var updateStatusBar = function (container, totalCount, selectedCount, issueCount, doneCount) {\n            var runAllUrl = selectionFilter.clearFilterUrl ? selectionFilter.clearFilterUrl() : '#',\n                runAll = elementFor(template('<a class=\"runAll\" href=\"{{url}}\">Run all</a>', {\n                    url: runAllUrl\n                })),\n                statusText = findElementIn(container, statusTextClassName);\n\n            statusText.innerHTML = '';\n            statusText.appendChild(elementFor(statusTotalText(totalCount, selectedCount)));\n            statusText.appendChild(elementFor(statusIssueText(issueCount, selectedCount, doneCount)));\n            statusText.appendChild(acceptAllButton());\n            if (totalCount > selectedCount) {\n                installFallbackClearSelectionHandler(runAll);\n                statusText.appendChild(runAll);\n            }\n        };\n\n        // component headline\n\n        var installFallbackComponentSelectionHandler = function (element, componentLabel) {\n            if (selectionFilter.filterForComponent) {\n                element.onclick = function (e) {\n                    selectionFilter.filterForComponent(componentLabel);\n                    e.preventDefault();\n                };\n            }\n        };\n\n        var addComponentHeading = function (container, componentLabel) {\n            var filterUrl = selectionFilter.filterUrlForComponent ? selectionFilter.filterUrlForComponent(componentLabel) : '#',\n                headlineElement = elementFor(template('<h2 class=\"componentLabel\"><a href=\"{{filterUrl}}\">{{headline}}</a></h2>', {\n                    headline: componentLabel,\n                    filterUrl: filterUrl\n                }));\n\n            installFallbackComponentSelectionHandler(headlineElement, componentLabel);\n            container.appendChild(headlineElement);\n        };\n\n        // comparisons\n\n        var comparisonKey = function (testCase) {\n            var testCaseParameters = util.excludeKeys(testCase, 'url'),\n                serializedParameters = util.serializeMap(testCaseParameters),\n                key = testCase.url;\n\n            if (serializedParameters) {\n                return key + ',' + serializedParameters;\n            }\n\n            return key;\n        };\n\n        var runningComparisonClassName = 'running',\n            imageContainerClassName = 'imageContainer',\n            errorContainerClassName = 'errorText';\n\n        var imageWrapper = function (image) {\n            var wrapper = elementFor('<div class=\"imageWrapper\"></div>');\n            wrapper.appendChild(image);\n            return wrapper;\n        };\n\n        var serializeValue = function (value) {\n            if (typeof value === 'string') {\n                return \"'\" + value + \"'\";\n            }\n            return value;\n        };\n\n        var testCaseParameters = function (testCase) {\n            var parameters = util.excludeKeys(testCase, 'url', 'desc', 'component'),\n                keys = Object.keys(parameters);\n\n            if (!keys.length) {\n                return '';\n            }\n            keys.sort();\n\n            return '<dl class=\"parameters\">' +\n                keys.map(function (key) {\n                    return template('<dt>{{key}}</dt><dd>{{value}}</dd>', {\n                        key: key,\n                        value: serializeValue(parameters[key])\n                    });\n                }).join('\\n') +\n                '</dl>';\n        };\n\n        var installFallbackSelectionHandler = function (element, testCase) {\n            if (selectionFilter.filterFor) {\n                element.onclick = function (e) {\n                    selectionFilter.filterFor(testCase);\n                    e.preventDefault();\n                };\n            }\n        };\n\n        var addComparison = function (container, testCase, referenceImage, key) {\n            var titleLinkClassName = 'titleLink',\n                filterUrl = selectionFilter.filterUrlFor ? selectionFilter.filterUrlFor(testCase) : '#',\n                comparison = elementFor(template('<section class=\"comparison {{runningComparisonClassName}}\" id=\"{{id}}\">' +\n                                                 '<h3 class=\"title\">' +\n                                                 '<a class=\"{{titleLinkClassName}}\" href=\"{{filterUrl}}\">{{title}}</a> ' +\n                                                 '<a class=\"externalLink\" href=\"{{url}}\"></a>' +\n                                                 testCaseParameters(testCase) +\n                                                 '</h3>' +\n                                                 '<div class=\"{{errorContainerClassName}}\"></div>' +\n                                                 '<div><div class=\"{{imageContainerClassName}}\"></div></div>' +\n                                                 '</section>', {\n                                                     url: testCase.url,\n                                                     title: testCase.desc ? testCase.desc : testCase.url,\n                                                     filterUrl: filterUrl,\n                                                     id: escapeId(key),\n                                                     runningComparisonClassName: runningComparisonClassName,\n                                                     errorContainerClassName: errorContainerClassName,\n                                                     imageContainerClassName: imageContainerClassName,\n                                                     titleLinkClassName: titleLinkClassName\n                                                 })),\n                imageContainer = comparison.querySelector('.' + imageContainerClassName),\n                titleLink = comparison.querySelector('.' + titleLinkClassName);\n\n            if (referenceImage) {\n                imageContainer.appendChild(imageWrapper(referenceImage));\n            }\n            installFallbackSelectionHandler(titleLink, testCase);\n\n            container.appendChild(comparison);\n\n            return comparison;\n        };\n\n        var canvasForImageCanvas = function (imageData) {\n            var canvas = document.createElement(\"canvas\"),\n                context;\n\n            canvas.height = imageData.height;\n            canvas.width  = imageData.width;\n\n            context = canvas.getContext(\"2d\");\n            context.putImageData(imageData, 0, 0);\n\n            return canvas;\n        };\n\n        var diffPageImages = function (imageA, imageB) {\n            return imagediff.diff(imageA, imageB, {align: 'top'});\n        };\n\n        var embossChanges = function (imageData) {\n            var d = imageData.data,\n                i;\n            for (i = 0; i < d.length; i += 4) {\n                if (d[i] === 0 && d[i+1] === 0 && d[i+2] === 0) {\n                    d[i+3] = 0;\n                } else {\n                    d[i] = 0;\n                    d[i+1] = 0;\n                    d[i+2] = 255;\n                    d[i+3] = 255;\n                }\n            }\n            return imageData;\n        };\n\n        var getDifferenceCanvas = function (imageA, imageB) {\n            var differenceImageData = diffPageImages(imageA, imageB),\n                canvas = canvasForImageCanvas(embossChanges(differenceImageData));\n\n            canvas.classList.add('diff');\n            return canvas;\n        };\n\n        // Use a canvas for display to work around https://bugzilla.mozilla.org/show_bug.cgi?id=986403\n        var canvasForImage = function (image) {\n            var canvas = document.createElement(\"canvas\"),\n                width  = image.naturalWidth,\n                height = image.naturalHeight,\n                context;\n\n            canvas.width  = width;\n            canvas.height = height;\n\n            context = canvas.getContext(\"2d\");\n            context.drawImage(image, 0, 0, width, height);\n\n            // fix size in css so the tests will show something (canvas is not supported so far)\n            canvas.style.width = width + 'px';\n            canvas.style.height = height + 'px';\n\n            return canvas;\n        };\n\n        var addImageDiff = function (image, imageForDiff, container) {\n            var imageContainer = container.querySelector('.' + imageContainerClassName);\n\n            imageContainer.appendChild(getDifferenceCanvas(image, imageForDiff));\n        };\n\n        var acceptClassName = 'accept';\n\n        var acceptComparison = function (container) {\n            var acceptButton = container.querySelector('.' + acceptClassName);\n            acceptButton.setAttribute('disabled', 'disabled');\n            acceptButton.textContent = \"\";\n            container.classList.add('accepted');\n        };\n\n        var changedImageContainer = function (pageImage, acceptPage, container) {\n            var changedImageContainerClassName = 'changedImageContainer',\n                outerChangedImageContainer = elementFor(template('<div class=\"outerChangedImageContainer\">' +\n                                                                 '<div class=\"{{changedImageContainerClassName}}\"></div>' +\n                                                                 '<button class=\"{{acceptClassName}}\"><span>Accept</span></button>' +\n                                                                 '</div>', {\n                                                                     changedImageContainerClassName: changedImageContainerClassName,\n                                                                     acceptClassName: acceptClassName\n                                                                 })),\n                changedImageContainer = outerChangedImageContainer.querySelector('.' + changedImageContainerClassName),\n                acceptButton = outerChangedImageContainer.querySelector('button');\n\n            changedImageContainer.appendChild(imageWrapper(pageImage));\n            acceptButton.onclick = function () {\n                acceptPage();\n                acceptComparison(container);\n            };\n\n            return outerChangedImageContainer;\n        };\n\n        var showComparisonWithDiff = function (pageImage, referenceImage, acceptPage, container) {\n            addImageDiff(referenceImage, pageImage, container);\n            container.appendChild(changedImageContainer(canvasForImage(pageImage), acceptPage, container));\n        };\n\n        var pageAsIframe = function (pageImage, testCaseUrl) {\n            var iframe = document.createElement('iframe');\n            iframe.width = pageImage.width;\n            iframe.height = pageImage.height;\n            iframe.src = testCaseUrl;\n            return iframe;\n        };\n\n        var showComparisonWithRenderedPage = function (pageImage, testCaseUrl, container) {\n            var imageContainer = container.querySelector('.' + imageContainerClassName);\n\n            imageContainer.innerHTML = '';\n            imageContainer.appendChild(imageWrapper(canvasForImage(pageImage)));\n\n            imageContainer.addEventListener('dblclick', function () {\n                imageContainer.innerHTML = '';\n                imageContainer.appendChild(imageWrapper(pageAsIframe(pageImage, testCaseUrl)));\n\n                imageContainer.classList.add('realView');\n            }, false);\n        };\n\n        var showComparisonWithoutReference = function (pageImage, acceptPage, container) {\n            container.appendChild(changedImageContainer(canvasForImage(pageImage), acceptPage, container));\n        };\n\n        var sameOriginWarning = 'Make sure the path lies within the ' +\n            '<a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">' +\n            'same origin' +\n            '</a> ' +\n            'as this document.';\n\n        var showComparisonWithError = function (url, container) {\n            var errorMsg = elementFor(template('<span>' +\n                                               'The page \"{{url}}\" could not be rendered. ' +\n                                               sameOriginWarning +\n                                               '</span>', {\n                                                   url: url\n                                               })),\n                errorContainer = container.querySelector('.' + errorContainerClassName);\n            errorContainer.appendChild(errorMsg);\n        };\n\n        var showRenderErrors = function (errors, container) {\n            var errorMsg = elementFor(template('<span>' +\n                                               'Had the following errors rendering the page:' +\n                                               '<ul></ul>' +\n                                               sameOriginWarning +\n                                               '</span>')),\n                listElement = errorMsg.querySelector('ul'),\n                errorContainer = container.querySelector('.' + errorContainerClassName);\n\n            errors.map(function (error) {\n                return elementFor(template('<li>{{msg}}</li>', {msg: error}));\n            }).forEach(function (li) {\n                listElement.appendChild(li);\n            });\n\n            errorContainer.appendChild(errorMsg);\n        };\n\n        var updateComparisonStatus = function (status, container) {\n            container.classList.remove(runningComparisonClassName);\n            container.classList.add(status);\n        };\n\n        // browser warning\n\n        var supportsReadingHtmlFromCanvas = function () {\n            return rasterizeHTML.drawHTML('<b></b>').then(function (result) {\n                var canvas = document.createElement(\"canvas\"),\n                    context = canvas.getContext(\"2d\");\n                try {\n                    context.drawImage(result.image, 0, 0);\n                    // This will fail in Chrome & Safari\n                    canvas.toDataURL(\"image/png\");\n                    return true;\n                } catch (e) {\n                    return false;\n                }\n            });\n        };\n\n        var browserIssueChecked = false;\n\n        var showBrowserWarningIfNeeded = function (container) {\n            if (browserIssueChecked) {\n                return;\n            }\n            browserIssueChecked = true;\n\n            supportsReadingHtmlFromCanvas().then(function (supported) {\n                if (supported) {\n                    return;\n                }\n\n                container.appendChild(elementFor(\n                    '<div class=\"browserWarning\">' +\n                        'Your browser is currently not supported, ' +\n                        'as it does not support reading rendered HTML from the canvas ' +\n                        '(<a href=\"https://code.google.com/p/chromium/issues/detail?id=294129\">Chrome #294129</a>, ' +\n                        '<a href=\"https://bugs.webkit.org/show_bug.cgi?id=17352\">Safari #17352</a>). How about trying Firefox?' +\n                        '</div>'\n                ));\n            });\n        };\n\n        // the reporter\n\n        module.NiceReporter = function (outerContainer) {\n            var totalCount = 0,\n                selectedCount = 0,\n                doneCount = 0,\n                issueCount = 0,\n                progressTickElements = {},\n                runningComparisonEntries = {},\n                acceptableComparisons = [],\n                containerElement, timeStarted, lastComponentLabel;\n\n            var container = function () {\n                if (!containerElement) {\n                    containerElement = createContainer(outerContainer || document.body);\n                }\n                return containerElement;\n            };\n\n            var registerComparison = function () {\n                totalCount += 1;\n                if (!timeStarted) {\n                    timeStarted = Date.now();\n                }\n\n                showBrowserWarningIfNeeded(container());\n                updateStatusInDocumentTitle(totalCount, doneCount);\n                updateStatusBar(container(), totalCount, selectedCount, issueCount);\n            };\n\n            return {\n                reportDeselectedComparison: function (comparison) {\n                    registerComparison();\n\n                    addTickToProgressBar(container(), comparison.testCase);\n                },\n                reportSelectedComparison: function (comparison) {\n                    var key = comparisonKey(comparison.testCase);\n                    selectedCount += 1;\n\n                    if (comparison.testCase.component && comparison.testCase.component !== lastComponentLabel) {\n                        lastComponentLabel = comparison.testCase.component;\n                        addComponentHeading(container(), comparison.testCase.component);\n                    }\n\n                    registerComparison();\n\n                    var tickElement = addTickToProgressBar(container(), comparison.testCase, key);\n                    progressTickElements[key] = tickElement;\n\n                    var comparisonElement = addComparison(container(),\n                                                          comparison.testCase,\n                                                          comparison.referenceImage,\n                                                          key);\n                    runningComparisonEntries[key] = comparisonElement;\n                },\n                reportComparison: function (comparison) {\n                    var key = comparisonKey(comparison.testCase),\n                        tickElement = progressTickElements[key],\n                        entry = runningComparisonEntries[key];\n\n                    doneCount += 1;\n                    if (comparison.status !== 'passed') {\n                        issueCount += 1;\n                    }\n\n                    updateStatusInDocumentTitle(totalCount, doneCount);\n                    updateStatusBar(container(), totalCount, selectedCount, issueCount, doneCount);\n                    markTickDone(comparison.status, comparison.renderErrors.length, tickElement);\n\n                    if (comparison.status === 'failed') {\n                        showComparisonWithDiff(comparison.pageImage,\n                                               comparison.referenceImage,\n                                               comparison.acceptPage,\n                                               entry);\n                        acceptableComparisons.push(comparison);\n                    } else if (comparison.status === 'referenceMissing') {\n                        showComparisonWithoutReference(comparison.pageImage,\n                                                       comparison.acceptPage,\n                                                       entry);\n                        acceptableComparisons.push(comparison);\n                    } else if (comparison.status === 'passed') {\n                        showComparisonWithRenderedPage(comparison.pageImage,\n                                                       comparison.testCase.url,\n                                                       entry);\n                    } else if (comparison.status === 'error') {\n                        showComparisonWithError(comparison.testCase.url,\n                                                entry);\n                    }\n\n                    if (comparison.renderErrors.length > 0) {\n                        showRenderErrors(comparison.renderErrors, entry);\n                    }\n\n                    updateComparisonStatus(comparison.status, entry);\n                },\n                reportTestSuite: function (result) {\n                    var acceptableEntries = acceptableComparisons.map(function (comparison) {\n                        var key = comparisonKey(comparison.testCase);\n                        return {\n                            acceptPage: comparison.acceptPage,\n                            entry: runningComparisonEntries[key]\n                        };\n                    });\n\n                    showTimeTaken(container(), timeStarted ? Date.now() - timeStarted : 0);\n                    setOutcomeOnHeader(container(), result.success);\n                    showAcceptAllButtonIfNeccessary(container(), acceptableEntries);\n                }\n            };\n        };\n\n        return module;\n    };\n\n    /* Work around https://bugzilla.mozilla.org/show_bug.cgi?id=1005634\n     * Replaces anchors with inner page targets with a JavaScript navigation handling implementation.\n     */\n    csscriticLib.pageNavigationHandlingFallback = function () {\n        \"use strict\";\n\n        var module = {};\n\n        var fakeTargetClassName = 'fakeTarget';\n\n        var clearFakeActiveClass = function () {\n            var previousTargets = Array.prototype.slice.call(document.querySelectorAll('.' + fakeTargetClassName));\n            previousTargets.forEach(function (elem) {\n                elem.classList.remove(fakeTargetClassName);\n            });\n        };\n\n        var triggerFakeActiveClass = function (targetElement) {\n            targetElement.classList.add(fakeTargetClassName);\n        };\n\n        var scrollTo = function (id) {\n            var targetElement;\n\n            clearFakeActiveClass();\n            if (id) {\n                targetElement = document.getElementById(id);\n                targetElement.scrollIntoView();\n                triggerFakeActiveClass(targetElement);\n            } else {\n                window.scrollTo(0, 0);\n            }\n        };\n\n        var globalNavigationHandlingInstalled = false;\n\n        var installGlobalNavigationHandling = function () {\n            if (!globalNavigationHandlingInstalled) {\n                globalNavigationHandlingInstalled = true;\n\n                window.onpopstate = function (e) {\n                    scrollTo(e.state);\n                };\n            }\n        };\n\n        module.install = function (element) {\n            installGlobalNavigationHandling();\n\n            element.onclick = function (e) {\n                var targetLink = e.target.href,\n                    targetId = targetLink.substr(targetLink.indexOf('#')+1);\n\n                scrollTo(targetId);\n                history.pushState(targetId, targetId);\n                e.preventDefault();\n            };\n        };\n\n        return module;\n    };\n\n    csscriticLib.urlQueryFilter = function (windowLocation) {\n        \"use strict\";\n\n        var module = {};\n\n        var filterParam = 'filter';\n\n        var parseUrlSearch = function (search) {\n            var paramString = search.replace(/^\\?/, '');\n            if (!paramString) {\n                return [];\n            }\n            return paramString\n                .split('&')\n                .map(function (keyValue) {\n                    var equalsIdx = keyValue.indexOf('='),\n                        key, value;\n\n                    if (equalsIdx >= 0) {\n                        key = keyValue.substr(0, equalsIdx);\n                        value = keyValue.substr(equalsIdx + 1);\n                    } else {\n                        key = keyValue;\n                    }\n                    return {\n                        key: key,\n                        value: value\n                    };\n                });\n        };\n\n        var serializeKeyValuePair = function (pair) {\n            if (pair.value) {\n                return pair.key + '=' + pair.value;\n            }\n            return pair.key;\n        };\n\n        var getFilterValue = function () {\n            var filterKeyValue = parseUrlSearch(windowLocation.search)\n                    .filter(function (entryPair) {\n                        return entryPair.key === filterParam;\n                    })\n                    .pop();\n\n            if (filterKeyValue) {\n                return decodeURIComponent(filterKeyValue.value);\n            }\n        };\n\n        var fullDescription = function (testCase) {\n            return testCase.component ? testCase.component + ' ' + testCase.desc : testCase.desc;\n        };\n\n        var filter = getFilterValue(),\n            existingQueryParams = parseUrlSearch(windowLocation.search);\n\n        // interface towards main.js\n\n        module.isComparisonSelected = function (comparison) {\n            if (!filter) {\n                return true;\n            }\n\n            if (comparison.testCase.desc && fullDescription(comparison.testCase) === filter) {\n                return true;\n            }\n            if (comparison.testCase.component && comparison.testCase.component === filter) {\n                return true;\n            }\n            return comparison.testCase.url === filter;\n        };\n\n        // interface towards browser reporters\n\n        var queryPart = function (selection) {\n            var queryParams = existingQueryParams\n                    .filter(function (pair) {\n                        return pair.key !== filterParam;\n                    });\n            if (selection) {\n                queryParams.push({\n                    key: filterParam,\n                    value: encodeURIComponent(selection)\n                });\n            }\n\n            return '?' + queryParams.map(serializeKeyValuePair).join('&');\n        };\n\n        module.filterUrlForComponent = function (componentLabel) {\n            return queryPart(componentLabel);\n        };\n\n        module.filterUrlFor = function (testCase) {\n            if (testCase.desc) {\n                return queryPart(fullDescription(testCase));\n            }\n            return queryPart(testCase.url);\n        };\n\n        module.clearFilterUrl = function () {\n            return queryPart();\n        };\n\n        return module;\n    };\n\n    csscriticLib.packageVersion = '0.7.0';\n    /* exported csscritic */\n    var csscritic = (function () {\n        \"use strict\";\n\n        var installCallChain = function (func, self) {\n            return function chainableProxy() {\n                func.apply(null, arguments);\n                return self;\n            };\n        };\n\n        var startsWith = function (str, prefix) {\n            // PhantomJS has no startsWith\n            return str.substr(0, prefix.length) === prefix;\n        };\n\n        // Work around https://bugzilla.mozilla.org/show_bug.cgi?id=1005634\n        var needsFallback = function () {\n            return startsWith(window.location.href, 'file://');\n        };\n\n        var packageVersion = csscriticLib.packageVersion || 'dev',\n            util = csscriticLib.util();\n\n        var domStorage = csscriticLib.domstorage(util, localStorage),\n            indexedDbStorage = csscriticLib.indexeddbstorage(util),\n            migrateToIndexedDbStorage = csscriticLib.migratetoindexeddbstorage(domStorage, indexedDbStorage);\n\n        var browserRenderer = csscriticLib.browserRenderer(util, csscriticLib.jobQueue, rasterizeHTML),\n            reporting = csscriticLib.reporting(browserRenderer, migrateToIndexedDbStorage, util),\n            regression = csscriticLib.regression(browserRenderer, util, imagediff),\n            queryFilter = csscriticLib.urlQueryFilter(window.location),\n            fallbackFilter = csscriticLib.fallbackFilter(window.location);\n\n        var filter = needsFallback() ? fallbackFilter : queryFilter;\n\n        var main = csscriticLib.main(\n            regression,\n            reporting,\n            util,\n            migrateToIndexedDbStorage,\n            filter\n        );\n\n        var basicHTMLReporterUtil = csscriticLib.basicHTMLReporterUtil(),\n            basicHTMLReporter = csscriticLib.basicHTMLReporter(util, basicHTMLReporterUtil, window.document);\n\n        var pageNavigationHandlingFallback = csscriticLib.pageNavigationHandlingFallback(window.location),\n            niceReporter = csscriticLib.niceReporter(\n                util,\n                filter,\n                needsFallback() ? pageNavigationHandlingFallback : undefined,\n                rasterizeHTML,\n                packageVersion\n            );\n\n\n        var self = {};\n\n        self.add = installCallChain(main.add, self);\n        self.component = installCallChain(main.component, self);\n        self.execute = main.execute;\n\n        self.addReporter = installCallChain(reporting.addReporter, self);\n\n        self.BasicHTMLReporter = basicHTMLReporter.BasicHTMLReporter;\n        self.NiceReporter = niceReporter.NiceReporter;\n\n        return self;\n    }());\n\n    return csscritic;\n\n}));\n","var css = \"#csscritic_basichtmlreporter{font-family:sans-serif;font-size:13px}#csscritic_basichtmlreporter .timeTaken{float:right;min-height:1.5em}#csscritic_basichtmlreporter .comparison{padding:8px;margin:5px 0;clear:both;transition:background-color 1s}#csscritic_basichtmlreporter .comparison:after{content:\\\"\\\";display:block;clear:both}#csscritic_basichtmlreporter .passed.comparison{background-color:#00FF7F}#csscritic_basichtmlreporter .failed.comparison{background-color:#FE3F44}#csscritic_basichtmlreporter .referenceMissing.comparison{background-color:#FFFF73}#csscritic_basichtmlreporter .error.comparison{background-color:#BE2F33}#csscritic_basichtmlreporter .comparison .pageUrl{color:#000}#csscritic_basichtmlreporter .comparison .parameters,#csscritic_basichtmlreporter .comparison .parameters dd,#csscritic_basichtmlreporter .comparison .parameters dt{display:inline-block;margin:0}#csscritic_basichtmlreporter .comparison .parameters{margin-left:1.5em;color:#444}#csscritic_basichtmlreporter .comparison .parameters dt{font-style:italic}#csscritic_basichtmlreporter .comparison .parameters dt::after{content:\\\":\\\"}#csscritic_basichtmlreporter .comparison .parameters dd{margin-left:.5em;margin-right:.7em}#csscritic_basichtmlreporter .comparison .parameters dd::before{content:\\\"'\\\"}#csscritic_basichtmlreporter .comparison .parameters dd::after{content:\\\"',\\\"}#csscritic_basichtmlreporter .comparison .parameters dd:last-child::after{content:\\\"'\\\"}#csscritic_basichtmlreporter .comparison .status{float:right}#csscritic_basichtmlreporter .resizable .currentPageResizableCanvas{resize:both;overflow:hidden;padding:0 10px 10px 0}#csscritic_basichtmlreporter .currentPageImageContainer{width:100%;height:100%;overflow:hidden;resize:none}@media (min--moz-device-pixel-ratio:2){#csscritic_basichtmlreporter .currentPageImageContainer img{width:50%;-moz-transform:scale(2);-moz-transform-origin:0 0;transform:scale(2);transform-origin:0 0}}#csscritic_basichtmlreporter .currentPageSection,#csscritic_basichtmlreporter .referenceSection{display:inline-block;vertical-align:top;margin-right:20px}#csscritic_basichtmlreporter .currentPageImageContainer,#csscritic_basichtmlreporter .differenceCanvasContainer canvas,#csscritic_basichtmlreporter .referenceImageContainer img{border:1px solid #000}#csscritic_basichtmlreporter .currentPageImageContainer,#csscritic_basichtmlreporter .referenceImageContainer img{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAKUlEQVQ4jWNYt27df2Lwo0ePiMIMowaOGjgsDSRWIbEWjxo4auCwNBAAenk4PB4atggAAAAASUVORK5CYII=) -5px -5px}#csscritic_basichtmlreporter .differenceCanvasSection{margin:8px 0 20px}#csscritic_basichtmlreporter .differenceCanvasContainer{display:inline-block}#csscritic_basichtmlreporter .differenceCanvasContainer .highlightedDifferenceCanvas,#csscritic_basichtmlreporter .differenceCanvasContainer:hover .differenceCanvas{display:none}#csscritic_basichtmlreporter .differenceCanvasContainer:hover .highlightedDifferenceCanvas{display:block}#csscritic_basichtmlreporter .currentPageSection,#csscritic_basichtmlreporter .differenceCanvasContainer{position:relative}#csscritic_basichtmlreporter .comparison:hover .differenceCanvasContainer:after,#csscritic_basichtmlreporter .comparison:hover .resizable.currentPageSection:after{position:absolute;padding:4px;white-space:nowrap;background-color:#000;opacity:.55;color:#fff;border-radius:5px}#csscritic_basichtmlreporter .comparison:hover .differenceCanvasContainer:after{content:\\\"< Hover over difference image to highlight subtle changes\\\";margin-right:-5px;top:0;right:0;-moz-transform:translateX(100%);-ms-transform:translateX(100%);-o-transform:translateX(100%);-webkit-transform:translateX(100%);transform:translateX(100%)}#csscritic_basichtmlreporter .comparison:hover .resizable.currentPageSection:after{content:\\\"< Drag lower right corner to resize\\\";margin-right:-5px;margin-bottom:10px;bottom:0;right:0;-moz-transform:translateX(100%) translateY(100%);-ms-transform:translateX(100%) translateY(100%);-o-transform:translateX(100%) translateY(100%);-webkit-transform:translateX(100%) translateY(100%);transform:translateX(100%) translateY(100%)}#csscritic_basichtmlreporter .currentPageSection:hover:after,#csscritic_basichtmlreporter .differenceCanvasContainer:hover:after{display:none}#csscritic_basichtmlreporter .saveHint button,#csscritic_basichtmlreporter .updateHint button{font-size:inherit;font-weight:inherit;line-height:inherit;width:auto;overflow:visible;border:1px solid #AAA;border-radius:4px;background:#00FF7F;cursor:pointer;margin:0 3px;padding:1px}#csscritic_basichtmlreporter .saveHint button:hover,#csscritic_basichtmlreporter .updateHint button:hover{background-color:#0C6}#csscritic_basichtmlreporter .saveHint button:active,#csscritic_basichtmlreporter .updateHint button:active{padding:2px 0 0 2px;position:relative;top:1px}#csscritic_basichtmlreporter .errorMsg:before,#csscritic_basichtmlreporter .loadErrors:before,#csscritic_basichtmlreporter .saveHint:before,#csscritic_basichtmlreporter .updateHint:before{content:\\\"\\\";font-size:25px;padding-right:5px}#csscritic_basichtmlreporter .errorMsg,#csscritic_basichtmlreporter .loadErrors,#csscritic_basichtmlreporter .saveHint,#csscritic_basichtmlreporter .updateHint{margin:8px 0;font-weight:700}#csscritic_basichtmlreporter .finished:after{content:\\\"\\\";font-size:20px;color:#0C6;padding-left:5px}#csscritic_basichtmlreporter .caption{display:block;font-style:italic;line-height:13px;font-size:12px}#csscritic_basichtmlreporter .loadErrors ul{margin:4px 0}#csscritic_basichtmlreporter_tooltip{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAKUlEQVQ4jWNYt27df2Lwo0ePiMIMowaOGjgsDSRWIbEWjxo4auCwNBAAenk4PB4atggAAAAASUVORK5CYII=) -5px -5px;border:1px solid #000;max-width:400px}#csscritic_basichtmlreporter_tooltip img{width:100%}#csscritic_basichtmlreporter .browserWarning:before{content:\\\"\\\";font-size:25px;padding-right:5px;vertical-align:middle}#csscritic_basichtmlreporter .browserWarning{position:fixed;top:0;left:0;width:100%;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:#922;background-color:rgba(150,20,30,.85);color:#fff;font-size:120%;border:2px solid #000;padding:20px}.cssCriticNiceReporter{font-family:sans-serif;font-size:16px}.cssCriticNiceReporter a{text-decoration:none;color:inherit}.cssCriticNiceReporter button{padding:2px 10px;border-radius:3px;border:none;background-color:#00c04e;font-size:inherit;font-family:inherit}.cssCriticNiceReporter button[disabled]{background-color:#ddd}.cssCriticNiceReporter button:hover{background-color:#24d66c}.cssCriticNiceReporter button:not([disabled]):active{background-color:#4cec8d}.cssCriticNiceReporter .errorText{color:#591100;margin-bottom:1em}.cssCriticNiceReporter .errorText:not(:empty)::before{content:\\\"\\\";color:#591100;font-size:1.2rem;padding-right:5px;vertical-align:middle}.cssCriticNiceReporter .errorText ul{margin:.2em 0}.cssCriticNiceReporter .errorText a{text-decoration:underline}.cssCriticNiceReporter .header{padding:15px;transition:background-color 1s}.cssCriticNiceReporter .header.pass{background-color:#00c04e}.cssCriticNiceReporter .header.fail{background-color:#ff3100}.cssCriticNiceReporter .timeTaken{float:right;padding:.5em 0 0 1em}.cssCriticNiceReporter .statusText{display:inline-block}.cssCriticNiceReporter .statusText .runAll{display:block;margin-top:.5em;text-decoration:underline}.cssCriticNiceReporter .acceptAll{display:none;margin:-4px 0 -4px 1em}.cssCriticNiceReporter .acceptAll.active{display:inline-block}.cssCriticNiceReporter .cssCriticVersion{font-size:.7rem}.cssCriticNiceReporter .progressBar{margin:.4em 0;list-style:none;padding:0}.cssCriticNiceReporter .progressBar li{display:inline-block;margin-right:-.4rem;transition:color 1s}.cssCriticNiceReporter .progressBar a{width:0;height:0;border:.63rem solid;border-radius:50%;display:block}.cssCriticNiceReporter .progressBar .pending{color:grey}.cssCriticNiceReporter .progressBar .passed{color:#048337}.cssCriticNiceReporter .progressBar .failed{color:#b62705}.cssCriticNiceReporter .progressBar .error{color:#591100}.cssCriticNiceReporter .progressBar .referenceMissing{color:#ff0}.cssCriticNiceReporter .progressBar a:focus{outline:0}.cssCriticNiceReporter .progressBar .hasRenderErrors{position:relative}.cssCriticNiceReporter .progressBar .hasRenderErrors a::after{content:'!';color:#000;line-height:1.26rem;text-align:center;position:absolute;top:0;left:0;right:0;bottom:0}.cssCriticNiceReporter .componentLabel{margin:1.8em 0 .5em 15px;font-size:1.15rem}.cssCriticNiceReporter .componentLabel:hover{text-decoration:underline}.cssCriticNiceReporter .comparison{background-color:#f5f5f5;padding:15px;margin:4px 0}.cssCriticNiceReporter .comparison .title{font-weight:400}.cssCriticNiceReporter .comparison.fakeTarget .title,.cssCriticNiceReporter .comparison:target .title{font-weight:700}.cssCriticNiceReporter .comparison .title .titleLink:hover{text-decoration:underline}.cssCriticNiceReporter .comparison .title .externalLink{vertical-align:top;font-size:.8rem;line-height:.6em;color:#888;display:inline-block}.cssCriticNiceReporter .comparison .title .externalLink:hover{transform:scale(1.1);transform-origin:bottom left}.cssCriticNiceReporter .comparison .parameters,.cssCriticNiceReporter .comparison .parameters dd,.cssCriticNiceReporter .comparison .parameters dt{display:inline-block;margin:0}.cssCriticNiceReporter .comparison .parameters{margin-left:1.5em;color:#444}.cssCriticNiceReporter .comparison .parameters dt{font-style:italic}.cssCriticNiceReporter .comparison .parameters dt::after{content:\\\":\\\"}.cssCriticNiceReporter .comparison .parameters dd{margin-left:.5em;margin-right:.7em}.cssCriticNiceReporter .comparison .parameters dd::after{content:\\\",\\\"}.cssCriticNiceReporter .comparison .parameters dd:last-child::after{content:\\\"\\\"}.cssCriticNiceReporter .running.comparison .imageContainer{opacity:.2}.cssCriticNiceReporter .comparison .imageContainer:empty{display:none}.cssCriticNiceReporter .comparison .imageWrapper{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAKUlEQVQ4jWNYt27df2Lwo0ePiMIMowaOGjgsDSRWIbEWjxo4auCwNBAAenk4PB4atggAAAAASUVORK5CYII=) -5px -5px}.cssCriticNiceReporter .comparison canvas,.cssCriticNiceReporter .comparison img{display:block}.cssCriticNiceReporter .comparison .changedImageContainer,.cssCriticNiceReporter .comparison .imageContainer{border:1px solid #000}.cssCriticNiceReporter .comparison .outerChangedImageContainer{margin-top:4px;display:inline-block;position:relative}.cssCriticNiceReporter .comparison .imageContainer{display:inline-block}.cssCriticNiceReporter .comparison .imageContainer .diff{max-height:0;max-width:0;opacity:0}.cssCriticNiceReporter .failed.comparison .imageContainer:hover .diff{max-height:none;max-width:none;opacity:1;transition:opacity 1s}.cssCriticNiceReporter .failed.comparison .imageContainer:hover .imageWrapper{opacity:.5;transition:opacity 1s;position:absolute;top:0;left:0;right:0;bottom:0}.cssCriticNiceReporter .comparison iframe{border:none;display:block;background:0 0}.cssCriticNiceReporter .comparison .realView{border-style:dashed}.cssCriticNiceReporter .comparison .accept{vertical-align:top;position:absolute;top:0;bottom:0;right:-65px;width:50px;font-size:.7rem}.cssCriticNiceReporter .accepted.comparison .accept{font-size:1.4rem}.cssCriticNiceReporter .comparison button span{transform:rotate(-90deg);display:block}.cssCriticNiceReporter .comparison .imageContainer{opacity:1;max-height:1000000px}.cssCriticNiceReporter .accepted.comparison .imageContainer{opacity:0;max-height:0;border-width:0;transition:max-height .001s ease 1s,opacity 1s,border-width .001s ease 1s}.cssCriticNiceReporter .comparison .imageContainer{position:relative}.cssCriticNiceReporter .comparison:hover .imageContainer::after{position:absolute;top:0;right:0;transform:translateX(100%);margin-right:-8px;padding:4px;white-space:nowrap;background-color:#000;opacity:.55;color:#fff;font-size:.9rem;border-radius:5px}.cssCriticNiceReporter .failed.comparison:hover .imageContainer::after{content:\\\"< Hover over the reference image to highlight changes\\\"}.cssCriticNiceReporter .failed.comparison .imageContainer:hover::after{display:none}.cssCriticNiceReporter .passed.comparison .imageContainer:not(.realView):hover::after{content:\\\"< Double click the image to expose the DOM of the underlying page\\\"}.cssCriticNiceReporter .browserWarning::before{content:\\\"\\\";font-size:1.2rem;padding-right:5px;vertical-align:middle}.cssCriticNiceReporter .browserWarning{position:fixed;top:0;left:0;width:100%;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:rgba(182,39,5,.85);color:#fff;font-size:1.2rem;border:2px solid #000;padding:20px}\"; (require(\"./../node_modules/cssify\"))(css); module.exports = css;","// UMD header\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.ayepromise = factory();\n    }\n}(this, function () {\n    'use strict';\n\n    var ayepromise = {};\n\n    /* Wrap an arbitrary number of functions and allow only one of them to be\n       executed and only once */\n    var once = function () {\n        var wasCalled = false;\n\n        return function wrapper(wrappedFunction) {\n            return function () {\n                if (wasCalled) {\n                    return;\n                }\n                wasCalled = true;\n                wrappedFunction.apply(null, arguments);\n            };\n        };\n    };\n\n    var getThenableIfExists = function (obj) {\n        // Make sure we only access the accessor once as required by the spec\n        var then = obj && obj.then;\n\n        if (typeof obj === \"object\" && typeof then === \"function\") {\n            // Bind function back to it's object (so fan's of 'this' don't get sad)\n            return function() { return then.apply(obj, arguments); };\n        }\n    };\n\n    var aThenHandler = function (onFulfilled, onRejected) {\n        var defer = ayepromise.defer();\n\n        var doHandlerCall = function (func, value) {\n            setTimeout(function () {\n                var returnValue;\n                try {\n                    returnValue = func(value);\n                } catch (e) {\n                    defer.reject(e);\n                    return;\n                }\n\n                if (returnValue === defer.promise) {\n                    defer.reject(new TypeError('Cannot resolve promise with itself'));\n                } else {\n                    defer.resolve(returnValue);\n                }\n            }, 1);\n        };\n\n        var callFulfilled = function (value) {\n            if (onFulfilled && onFulfilled.call) {\n                doHandlerCall(onFulfilled, value);\n            } else {\n                defer.resolve(value);\n            }\n        };\n\n        var callRejected = function (value) {\n            if (onRejected && onRejected.call) {\n                doHandlerCall(onRejected, value);\n            } else {\n                defer.reject(value);\n            }\n        };\n\n        return {\n            promise: defer.promise,\n            handle: function (state, value) {\n                if (state === FULFILLED) {\n                    callFulfilled(value);\n                } else {\n                    callRejected(value);\n                }\n            }\n        };\n    };\n\n    // States\n    var PENDING = 0,\n        FULFILLED = 1,\n        REJECTED = 2;\n\n    ayepromise.defer = function () {\n        var state = PENDING,\n            outcome,\n            thenHandlers = [];\n\n        var doSettle = function (settledState, value) {\n            state = settledState;\n            // persist for handlers registered after settling\n            outcome = value;\n\n            thenHandlers.forEach(function (then) {\n                then.handle(state, outcome);\n            });\n\n            // Discard all references to handlers to be garbage collected\n            thenHandlers = null;\n        };\n\n        var doFulfill = function (value) {\n            doSettle(FULFILLED, value);\n        };\n\n        var doReject = function (error) {\n            doSettle(REJECTED, error);\n        };\n\n        var registerThenHandler = function (onFulfilled, onRejected) {\n            var thenHandler = aThenHandler(onFulfilled, onRejected);\n\n            if (state === PENDING) {\n                thenHandlers.push(thenHandler);\n            } else {\n                thenHandler.handle(state, outcome);\n            }\n\n            return thenHandler.promise;\n        };\n\n        var safelyResolveThenable = function (thenable) {\n            // Either fulfill, reject or reject with error\n            var onceWrapper = once();\n            try {\n                thenable(\n                    onceWrapper(transparentlyResolveThenablesAndSettle),\n                    onceWrapper(doReject)\n                );\n            } catch (e) {\n                onceWrapper(doReject)(e);\n            }\n        };\n\n        var transparentlyResolveThenablesAndSettle = function (value) {\n            var thenable;\n\n            try {\n                thenable = getThenableIfExists(value);\n            } catch (e) {\n                doReject(e);\n                return;\n            }\n\n            if (thenable) {\n                safelyResolveThenable(thenable);\n            } else {\n                doFulfill(value);\n            }\n        };\n\n        var onceWrapper = once();\n        return {\n            resolve: onceWrapper(transparentlyResolveThenablesAndSettle),\n            reject: onceWrapper(doReject),\n            promise: {\n                then: registerThenHandler,\n                fail: function (onRejected) {\n                    return registerThenHandler(null, onRejected);\n                }\n            }\n        };\n    };\n\n    return ayepromise;\n}));\n","// js-imagediff 1.0.3\n// (c) 2011-2012 Carl Sutherland, Humble Software\n// Distributed under the MIT License\n// For original source and documentation visit:\n// http://www.github.com/HumbleSoftware/js-imagediff\n\n(function (name, definition) {\n  var root = this;\n  if (typeof module !== 'undefined') {\n    try {\n      var Canvas = require('canvas');\n    } catch (e) {\n      throw new Error(\n        e.message + '\\n' +\n        'Please see https://github.com/HumbleSoftware/js-imagediff#cannot-find-module-canvas\\n'\n      );\n    }\n    module.exports = definition(root, name, Canvas);\n  } else if (typeof define === 'function' && typeof define.amd === 'object') {\n    define(definition);\n  } else {\n    root[name] = definition(root, name);\n  }\n})('imagediff', function (root, name, Canvas) {\n\n  var\n    TYPE_ARRAY        = /\\[object Array\\]/i,\n    TYPE_CANVAS       = /\\[object (Canvas|HTMLCanvasElement)\\]/i,\n    TYPE_CONTEXT      = /\\[object CanvasRenderingContext2D\\]/i,\n    TYPE_IMAGE        = /\\[object (Image|HTMLImageElement)\\]/i,\n    TYPE_IMAGE_DATA   = /\\[object ImageData\\]/i,\n\n    UNDEFINED         = 'undefined',\n\n    canvas            = getCanvas(),\n    context           = canvas.getContext('2d'),\n    previous          = root[name],\n    imagediff, jasmine;\n\n  // Creation\n  function getCanvas (width, height) {\n    var\n      canvas = Canvas ?\n        new Canvas() :\n        document.createElement('canvas');\n    if (width) canvas.width = width;\n    if (height) canvas.height = height;\n    return canvas;\n  }\n  function getImageData (width, height) {\n    canvas.width = width;\n    canvas.height = height;\n    context.clearRect(0, 0, width, height);\n    return context.createImageData(width, height);\n  }\n  // expost canvas module\n  function getCanvasRef() {\n    return Canvas;\n  }\n\n\n  // Type Checking\n  function isImage (object) {\n    return isType(object, TYPE_IMAGE);\n  }\n  function isCanvas (object) {\n    return isType(object, TYPE_CANVAS);\n  }\n  function isContext (object) {\n    return isType(object, TYPE_CONTEXT);\n  }\n  function isImageData (object) {\n    return !!(object &&\n      isType(object, TYPE_IMAGE_DATA) &&\n      typeof(object.width) !== UNDEFINED &&\n      typeof(object.height) !== UNDEFINED &&\n      typeof(object.data) !== UNDEFINED);\n  }\n  function isImageType (object) {\n    return (\n      isImage(object) ||\n      isCanvas(object) ||\n      isContext(object) ||\n      isImageData(object)\n    );\n  }\n  function isType (object, type) {\n    return typeof (object) === 'object' && !!Object.prototype.toString.apply(object).match(type);\n  }\n\n\n  // Type Conversion\n  function copyImageData (imageData) {\n    var\n      height = imageData.height,\n      width = imageData.width,\n      data = imageData.data,\n      newImageData, newData, i;\n\n    canvas.width = width;\n    canvas.height = height;\n    newImageData = context.getImageData(0, 0, width, height);\n    newData = newImageData.data;\n\n    for (i = imageData.data.length; i--;) {\n        newData[i] = data[i];\n    }\n\n    return newImageData;\n  }\n  function toImageData (object) {\n    if (isImage(object)) { return toImageDataFromImage(object); }\n    if (isCanvas(object)) { return toImageDataFromCanvas(object); }\n    if (isContext(object)) { return toImageDataFromContext(object); }\n    if (isImageData(object)) { return object; }\n  }\n  function toImageDataFromImage (image) {\n    var\n      height = image.height,\n      width = image.width;\n    canvas.width = width;\n    canvas.height = height;\n    context.clearRect(0, 0, width, height);\n    context.drawImage(image, 0, 0);\n    return context.getImageData(0, 0, width, height);\n  }\n  function toImageDataFromCanvas (canvas) {\n    var\n      height = canvas.height,\n      width = canvas.width,\n      context = canvas.getContext('2d');\n    return context.getImageData(0, 0, width, height);\n  }\n  function toImageDataFromContext (context) {\n    var\n      canvas = context.canvas,\n      height = canvas.height,\n      width = canvas.width;\n    return context.getImageData(0, 0, width, height);\n  }\n  function toCanvas (object) {\n    var\n      data = toImageData(object),\n      canvas = getCanvas(data.width, data.height),\n      context = canvas.getContext('2d');\n\n    context.putImageData(data, 0, 0);\n    return canvas;\n  }\n\n\n  // ImageData Equality Operators\n  function equalWidth (a, b) {\n    return a.width === b.width;\n  }\n  function equalHeight (a, b) {\n    return a.height === b.height;\n  }\n  function equalDimensions (a, b) {\n    return equalHeight(a, b) && equalWidth(a, b);\n  }\n  function equal (a, b, tolerance) {\n\n    var\n      aData     = a.data,\n      bData     = b.data,\n      length    = aData.length,\n      i;\n\n    tolerance = tolerance || 0;\n\n    if (!equalDimensions(a, b)) return false;\n    for (i = length; i--;) if (aData[i] !== bData[i] && Math.abs(aData[i] - bData[i]) > tolerance) return false;\n\n    return true;\n  }\n\n\n  // Diff\n  function diff (a, b, options) {\n    return (equalDimensions(a, b) ? diffEqual : diffUnequal)(a, b, options);\n  }\n  function diffEqual (a, b, options) {\n\n    var\n      height  = a.height,\n      width   = a.width,\n      c       = getImageData(width, height), // c = a - b\n      aData   = a.data,\n      bData   = b.data,\n      cData   = c.data,\n      length  = cData.length,\n      row, column,\n      i, j, k, v;\n\n    for (i = 0; i < length; i += 4) {\n      cData[i] = Math.abs(aData[i] - bData[i]);\n      cData[i+1] = Math.abs(aData[i+1] - bData[i+1]);\n      cData[i+2] = Math.abs(aData[i+2] - bData[i+2]);\n      cData[i+3] = Math.abs(255 - Math.abs(aData[i+3] - bData[i+3]));\n    }\n\n    return c;\n  }\n  function diffUnequal (a, b, options) {\n\n    var\n      height  = Math.max(a.height, b.height),\n      width   = Math.max(a.width, b.width),\n      c       = getImageData(width, height), // c = a - b\n      aData   = a.data,\n      bData   = b.data,\n      cData   = c.data,\n      align   = options && options.align,\n      rowOffset,\n      columnOffset,\n      row, column,\n      i, j, k, v;\n\n\n    for (i = cData.length - 1; i > 0; i = i - 4) {\n      cData[i] = 255;\n    }\n\n    // Add First Image\n    offsets(a);\n    for (row = a.height; row--;){\n      for (column = a.width; column--;) {\n        i = 4 * ((row + rowOffset) * width + (column + columnOffset));\n        j = 4 * (row * a.width + column);\n        cData[i+0] = aData[j+0]; // r\n        cData[i+1] = aData[j+1]; // g\n        cData[i+2] = aData[j+2]; // b\n        // cData[i+3] = aData[j+3]; // a\n      }\n    }\n\n    // Subtract Second Image\n    offsets(b);\n    for (row = b.height; row--;){\n      for (column = b.width; column--;) {\n        i = 4 * ((row + rowOffset) * width + (column + columnOffset));\n        j = 4 * (row * b.width + column);\n        cData[i+0] = Math.abs(cData[i+0] - bData[j+0]); // r\n        cData[i+1] = Math.abs(cData[i+1] - bData[j+1]); // g\n        cData[i+2] = Math.abs(cData[i+2] - bData[j+2]); // b\n      }\n    }\n\n    // Helpers\n    function offsets (imageData) {\n      if (align === 'top') {\n        rowOffset = 0;\n        columnOffset = 0;\n      } else {\n        rowOffset = Math.floor((height - imageData.height) / 2);\n        columnOffset = Math.floor((width - imageData.width) / 2);\n      }\n    }\n\n    return c;\n  }\n\n\n  // Validation\n  function checkType () {\n    var i;\n    for (i = 0; i < arguments.length; i++) {\n      if (!isImageType(arguments[i])) {\n        throw {\n          name : 'ImageTypeError',\n          message : 'Submitted object was not an image.'\n        };\n      }\n    }\n  }\n\n\n  // Jasmine Matchers\n  function get (element, content) {\n    element = document.createElement(element);\n    if (element && content) {\n      element.innerHTML = content;\n    }\n    return element;\n  }\n\n  jasmine = {\n\n    toBeImageData : function () {\n      return imagediff.isImageData(this.actual);\n    },\n\n    toImageDiffEqual : function (expected, tolerance) {\n\n      if (typeof (document) !== UNDEFINED) {\n        this.message = function () {\n          var\n            div     = get('div'),\n            a       = get('div', '<div>Actual:</div>'),\n            b       = get('div', '<div>Expected:</div>'),\n            c       = get('div', '<div>Diff:</div>'),\n            diff    = imagediff.diff(this.actual, expected),\n            canvas  = getCanvas(),\n            context;\n\n          canvas.height = diff.height;\n          canvas.width  = diff.width;\n\n          div.style.overflow = 'hidden';\n          a.style.float = 'left';\n          b.style.float = 'left';\n          c.style.float = 'left';\n\n          context = canvas.getContext('2d');\n          context.putImageData(diff, 0, 0);\n\n          a.appendChild(toCanvas(this.actual));\n          b.appendChild(toCanvas(expected));\n          c.appendChild(canvas);\n\n          div.appendChild(a);\n          div.appendChild(b);\n          div.appendChild(c);\n\n          return [\n            div,\n            \"Expected not to be equal.\"\n          ];\n        };\n      }\n\n      return imagediff.equal(this.actual, expected, tolerance);\n    }\n  };\n\n\n  // Image Output\n  function imageDataToPNG (imageData, outputFile, callback) {\n\n    var\n      canvas = toCanvas(imageData),\n      base64Data,\n      decodedImage;\n\n    callback = callback || Function;\n\n    base64Data = canvas.toDataURL().replace(/^data:image\\/\\w+;base64,/,\"\");\n    decodedImage = new Buffer(base64Data, 'base64');\n    require('fs').writeFile(outputFile, decodedImage, callback);\n  }\n\n\n  // Definition\n  imagediff = {\n\n    createCanvas : getCanvas,\n    createImageData : getImageData,\n    getCanvasRef: getCanvasRef,\n\n    isImage : isImage,\n    isCanvas : isCanvas,\n    isContext : isContext,\n    isImageData : isImageData,\n    isImageType : isImageType,\n\n    toImageData : function (object) {\n      checkType(object);\n      if (isImageData(object)) { return copyImageData(object); }\n      return toImageData(object);\n    },\n\n    equal : function (a, b, tolerance) {\n      checkType(a, b);\n      a = toImageData(a);\n      b = toImageData(b);\n      return equal(a, b, tolerance);\n    },\n    diff : function (a, b, options) {\n      checkType(a, b);\n      a = toImageData(a);\n      b = toImageData(b);\n      return diff(a, b, options);\n    },\n\n    jasmine : jasmine,\n\n    // Compatibility\n    noConflict : function () {\n      root[name] = previous;\n      return imagediff;\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    imagediff.imageDataToPNG = imageDataToPNG;\n  }\n\n  return imagediff;\n});\n","/*! rasterizeHTML.js - v1.0.0 - 2015-03-01\n* http://www.github.com/cburgmer/rasterizeHTML.js\n* Copyright (c) 2015 Christoph Burgmer; Licensed MIT */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module unless amdModuleId is set\n    define([\"url\",\"xmlserializer\",\"ayepromise\",\"inlineresources\"], function (a0,b1,c2,d3) {\n      return (root['rasterizeHTML'] = factory(a0,b1,c2,d3));\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(require(\"url\"),require(\"xmlserializer\"),require(\"ayepromise\"),require(\"inlineresources\"));\n  } else {\n    root['rasterizeHTML'] = factory(url,xmlserializer,ayepromise,inlineresources);\n  }\n}(this, function (url, xmlserializer, ayepromise, inlineresources) {\n\nvar util = (function (url) {\n    \"use strict\";\n\n    var module = {};\n\n    var uniqueIdList = [];\n\n    module.joinUrl = function (baseUrl, relUrl) {\n        if (!baseUrl) {\n            return relUrl;\n        }\n        return url.resolve(baseUrl, relUrl);\n    };\n\n    module.getConstantUniqueIdFor = function (element) {\n        // HACK, using a list results in O(n), but how do we hash e.g. a DOM node?\n        if (uniqueIdList.indexOf(element) < 0) {\n            uniqueIdList.push(element);\n        }\n        return uniqueIdList.indexOf(element);\n    };\n\n    module.clone = function (object) {\n        var theClone = {},\n            i;\n        for (i in object) {\n            if (object.hasOwnProperty(i)) {\n                theClone[i] = object[i];\n            }\n        }\n        return theClone;\n    };\n\n    var isObject = function (obj) {\n        return typeof obj === \"object\" && obj !== null;\n    };\n\n    var isCanvas = function (obj) {\n        return isObject(obj) &&\n            Object.prototype.toString.apply(obj).match(/\\[object (Canvas|HTMLCanvasElement)\\]/i);\n    };\n\n    // args: canvas, options\n    module.parseOptionalParameters = function (args) {\n        var parameters = {\n            canvas: null,\n            options: {}\n        };\n\n        if (args[0] == null || isCanvas(args[0])) {\n            parameters.canvas = args[0] || null;\n\n            parameters.options = module.clone(args[1]);\n        } else {\n            parameters.options = module.clone(args[0]);\n        }\n\n        return parameters;\n    };\n\n    return module;\n}(url));\n\n// Proxy objects by monkey patching\nvar proxies = (function (util, ayepromise) {\n    \"use strict\";\n\n    var module = {};\n\n    var monkeyPatchInstanceMethod = function (object, methodName, proxyFunc) {\n        var originalFunc = object[methodName];\n\n        object[methodName] = function () {\n            var args = Array.prototype.slice.call(arguments);\n\n            return proxyFunc.apply(this, [args, originalFunc]);\n        };\n\n        return originalFunc;\n    };\n\n    // Bases all XHR calls on the given base URL\n    module.baseUrlRespectingXhr = function (XHRObject, baseUrl) {\n        var xhrConstructor = function () {\n            var xhr = new XHRObject();\n\n            monkeyPatchInstanceMethod(xhr, 'open', function (args, originalOpen) {\n                var method = args.shift(),\n                    url = args.shift(),\n                    joinedUrl = util.joinUrl(baseUrl, url);\n\n                return originalOpen.apply(this, [method, joinedUrl].concat(args));\n            });\n\n            return xhr;\n        };\n\n        return xhrConstructor;\n    };\n\n    // Provides a convenient way of being notified when all pending XHR calls are finished\n    module.finishNotifyingXhr = function (XHRObject) {\n        var totalXhrCount = 0,\n            doneXhrCount = 0,\n            waitingForPendingToClose = false,\n            defer = ayepromise.defer();\n\n        var checkAllRequestsFinished = function () {\n            var pendingXhrCount = totalXhrCount - doneXhrCount;\n\n            if (pendingXhrCount <= 0 && waitingForPendingToClose) {\n                defer.resolve({totalCount: totalXhrCount});\n            }\n        };\n\n        var xhrConstructor = function () {\n            var xhr = new XHRObject();\n\n            monkeyPatchInstanceMethod(xhr, 'send', function (_, originalSend) {\n                totalXhrCount += 1;\n                return originalSend.apply(this, arguments);\n            });\n\n            xhr.addEventListener('load', function () {\n                doneXhrCount += 1;\n\n                checkAllRequestsFinished();\n            });\n\n            return xhr;\n        };\n\n        xhrConstructor.waitForRequestsToFinish = function () {\n            waitingForPendingToClose = true;\n            checkAllRequestsFinished();\n            return defer.promise;\n        };\n\n        return xhrConstructor;\n    };\n\n    return module;\n}(util, ayepromise));\n\nvar documentUtil = (function () {\n    \"use strict\";\n\n    var module = {};\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    module.addClassNameRecursively = function (element, className) {\n        element.className += ' ' + className;\n\n        if (element.parentNode !== element.ownerDocument) {\n            module.addClassNameRecursively(element.parentNode, className);\n        }\n    };\n\n    var changeCssRule = function (rule, newRuleText) {\n        var styleSheet = rule.parentStyleSheet,\n            ruleIdx = asArray(styleSheet.cssRules).indexOf(rule);\n\n        // Exchange rule with the new text\n        styleSheet.insertRule(newRuleText, ruleIdx+1);\n        styleSheet.deleteRule(ruleIdx);\n    };\n\n    var updateRuleSelector = function (rule, updatedSelector) {\n        var styleDefinitions = rule.cssText.replace(/^[^\\{]+/, ''),\n            newRule = updatedSelector + ' ' + styleDefinitions;\n\n        changeCssRule(rule, newRule);\n    };\n\n    var cssRulesToText = function (cssRules) {\n        return asArray(cssRules).reduce(function (cssText, rule) {\n            return cssText + rule.cssText;\n        }, '');\n    };\n\n    var rewriteStyleContent = function (styleElement) {\n        styleElement.textContent = cssRulesToText(styleElement.sheet.cssRules);\n    };\n\n    var matchingSimpleSelectorsRegex = function (simpleSelectorList) {\n        return '(' +\n            '(?:^|[^.#:\\\\w])' +            // start of string or not a simple selector character,\n            '|' +                          // ... or ...\n            '(?=\\\\W)' +                    // the next character parsed is not an alphabetic character (and thus a natural boundary)\n            ')' +\n            '(' +\n            simpleSelectorList.join('|') + // one out of the given simple selectors\n            ')' +\n            '(?=\\\\W|$)';                   // followed either by a non-alphabetic character or the end of the string\n    };\n\n    var replaceSimpleSelectorsBy = function (doc, simpleSelectorList, caseInsensitiveReplaceFunc) {\n        var selectorRegex = matchingSimpleSelectorsRegex(simpleSelectorList);\n\n        asArray(doc.querySelectorAll('style')).forEach(function (styleElement) {\n            var matchingRules = asArray(styleElement.sheet.cssRules).filter(function (rule) {\n                return rule.selectorText && new RegExp(selectorRegex, 'i').test(rule.selectorText);\n            });\n\n            if (matchingRules.length) {\n                matchingRules.forEach(function (rule) {\n                    var newSelector = rule.selectorText.replace(new RegExp(selectorRegex, 'gi'),\n                                                             function (_, prefixMatch, selectorMatch) {\n                        return prefixMatch + caseInsensitiveReplaceFunc(selectorMatch);\n                    });\n\n                    if (newSelector !== rule.selectorText) {\n                        updateRuleSelector(rule, newSelector);\n                    }\n                });\n\n                rewriteStyleContent(styleElement);\n            }\n        });\n    };\n\n    module.rewriteCssSelectorWith = function (doc, oldSelector, newSelector) {\n        replaceSimpleSelectorsBy(doc, [oldSelector], function () {\n            return newSelector;\n        });\n    };\n\n    module.lowercaseCssTypeSelectors = function (doc, matchingTagNames) {\n        replaceSimpleSelectorsBy(doc, matchingTagNames, function (match) {\n            return match.toLowerCase();\n        });\n    };\n\n    module.findHtmlOnlyNodeNames = function (doc) {\n        var treeWalker = doc.createTreeWalker(doc, NodeFilter.SHOW_ELEMENT),\n            htmlNodeNames = {},\n            nonHtmlNodeNames = {},\n            currentTagName;\n\n        while(treeWalker.nextNode()) {\n            currentTagName = treeWalker.currentNode.tagName.toLowerCase();\n            if (treeWalker.currentNode.namespaceURI === 'http://www.w3.org/1999/xhtml') {\n                htmlNodeNames[currentTagName] = true;\n            } else {\n                nonHtmlNodeNames[currentTagName] = true;\n            }\n        }\n\n        return Object.keys(htmlNodeNames).filter(function (tagName) {\n            return !nonHtmlNodeNames[tagName];\n        });\n    };\n\n    return module;\n}());\n\nvar documentHelper = (function (documentUtil) {\n    \"use strict\";\n\n    var module = {};\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    module.fakeHover = function (doc, hoverSelector) {\n        var elem = doc.querySelector(hoverSelector),\n            fakeHoverClass = 'rasterizehtmlhover';\n        if (! elem) {\n            return;\n        }\n\n        documentUtil.addClassNameRecursively(elem, fakeHoverClass);\n        documentUtil.rewriteCssSelectorWith(doc, ':hover', '.' + fakeHoverClass);\n    };\n\n    module.fakeActive = function (doc, activeSelector) {\n        var elem = doc.querySelector(activeSelector),\n            fakeActiveClass = 'rasterizehtmlactive';\n        if (! elem) {\n            return;\n        }\n\n        documentUtil.addClassNameRecursively(elem, fakeActiveClass);\n        documentUtil.rewriteCssSelectorWith(doc, ':active', '.' + fakeActiveClass);\n    };\n\n    module.fakeFocus = function (doc, focusSelector) {\n        var elem = doc.querySelector(focusSelector),\n            fakeFocusClass = 'rasterizehtmlfocus';\n        if (! elem) {\n            return;\n        }\n\n        documentUtil.addClassNameRecursively(elem, fakeFocusClass);\n        documentUtil.rewriteCssSelectorWith(doc, ':focus', '.' + fakeFocusClass);\n    };\n\n    module.persistInputValues = function (doc) {\n        var inputs = doc.querySelectorAll('input'),\n            textareas = doc.querySelectorAll('textarea'),\n            isCheckable = function (input) {\n                return input.type === 'checkbox' || input.type === 'radio';\n            };\n\n        asArray(inputs).filter(isCheckable)\n            .forEach(function (input) {\n                if (input.checked) {\n                    input.setAttribute('checked', '');\n                } else {\n                    input.removeAttribute('checked');\n                }\n            });\n\n        asArray(inputs).filter(function (input) { return !isCheckable(input); })\n            .forEach(function (input) {\n                input.setAttribute('value', input.value);\n            });\n\n        asArray(textareas)\n            .forEach(function (textarea) {\n                textarea.textContent = textarea.value;\n            });\n    };\n\n    module.rewriteTagNameSelectorsToLowerCase = function (doc) {\n        documentUtil.lowercaseCssTypeSelectors(doc, documentUtil.findHtmlOnlyNodeNames(doc));\n    };\n\n    return module;\n}(documentUtil));\n\nvar browser = (function (util, proxies, ayepromise, theWindow) {\n    \"use strict\";\n\n    var module = {};\n\n    var createHiddenElement = function (doc, tagName, width, height) {\n        var element = doc.createElement(tagName);\n        // 'display: none' doesn't cut it, as browsers seem to be lazy loading CSS\n        element.style.visibility = \"hidden\";\n        element.style.width = width + \"px\";\n        element.style.height = height + \"px\";\n        element.style.position = \"absolute\";\n        element.style.top = (-10000 - height) + \"px\";\n        element.style.left = (-10000 - width) + \"px\";\n        // We need to add the element to the document so that its content gets loaded\n        doc.getElementsByTagName(\"body\")[0].appendChild(element);\n        return element;\n    };\n\n    module.executeJavascript = function (doc, options) {\n        var iframe = createHiddenElement(theWindow.document, \"iframe\", options.width, options.height),\n            html = doc.documentElement.outerHTML,\n            iframeErrorsMessages = [],\n            defer = ayepromise.defer(),\n            timeout = options.executeJsTimeout || 0;\n\n        var doResolve = function () {\n            var doc = iframe.contentDocument;\n            theWindow.document.getElementsByTagName(\"body\")[0].removeChild(iframe);\n            defer.resolve({\n                document: doc,\n                errors: iframeErrorsMessages\n            });\n        };\n\n        var waitForJavaScriptToRun = function () {\n            var d = ayepromise.defer();\n            if (timeout > 0) {\n                setTimeout(d.resolve, timeout);\n            } else {\n                d.resolve();\n            }\n            return d.promise;\n        };\n\n        iframe.onload = function () {\n            waitForJavaScriptToRun()\n                .then(finishNotifyXhrProxy.waitForRequestsToFinish)\n                .then(doResolve);\n        };\n\n        var xhr = iframe.contentWindow.XMLHttpRequest,\n            finishNotifyXhrProxy = proxies.finishNotifyingXhr(xhr),\n            baseUrlXhrProxy = proxies.baseUrlRespectingXhr(finishNotifyXhrProxy, options.baseUrl);\n\n        iframe.contentDocument.open();\n        iframe.contentWindow.XMLHttpRequest = baseUrlXhrProxy;\n        iframe.contentWindow.onerror = function (msg) {\n            iframeErrorsMessages.push({\n                resourceType: \"scriptExecution\",\n                msg: msg\n            });\n        };\n\n        iframe.contentDocument.write('<!DOCTYPE html>');\n        iframe.contentDocument.write(html);\n        iframe.contentDocument.close();\n\n        return defer.promise;\n    };\n\n    var createHiddenSandboxedIFrame = function (doc, width, height) {\n        var iframe = doc.createElement('iframe');\n        iframe.style.width = width + \"px\";\n        iframe.style.height = height + \"px\";\n        // 'display: none' doesn't cut it, as browsers seem to be lazy loading content\n        iframe.style.visibility = \"hidden\";\n        iframe.style.position = \"absolute\";\n        iframe.style.top = (-10000 - height) + \"px\";\n        iframe.style.left = (-10000 - width) + \"px\";\n        // Don't execute JS, all we need from sandboxing is access to the iframe's document\n        iframe.sandbox = 'allow-same-origin';\n        return iframe;\n    };\n\n    var createIframeWithSizeAtZoomLevel1 = function (width, height, zoom) {\n        var scaledViewportWidth = Math.floor(width / zoom),\n            scaledViewportHeight = Math.floor(height / zoom);\n\n        return createHiddenSandboxedIFrame(theWindow.document, scaledViewportWidth, scaledViewportHeight);\n    };\n\n    var calculateZoomedContentSizeAndRoundUp = function (actualViewport, requestedWidth, requestedHeight, zoom) {\n        return {\n            width: Math.max(actualViewport.width * zoom, requestedWidth),\n            height: Math.max(actualViewport.height * zoom, requestedHeight)\n        };\n    };\n\n    var calculateContentSize = function (doc, selector, requestedWidth, requestedHeight, zoom) {\n            // clientWidth/clientHeight needed for PhantomJS\n        var actualViewportWidth = Math.max(doc.documentElement.scrollWidth, doc.body.clientWidth),\n            actualViewportHeight = Math.max(doc.documentElement.scrollHeight, doc.body.scrollHeight, doc.body.clientHeight),\n            top, left, originalWidth, originalHeight, rootFontSize,\n            element, rect, contentSize;\n\n        if (selector) {\n            element = doc.querySelector(selector);\n\n            if (!element) {\n                throw {\n                    message: \"Clipping selector not found\"\n                };\n            }\n\n            rect = element.getBoundingClientRect();\n\n            top = rect.top;\n            left = rect.left;\n            originalWidth = rect.width;\n            originalHeight = rect.height;\n        } else {\n            top = 0;\n            left = 0;\n            originalWidth = actualViewportWidth;\n            originalHeight = actualViewportHeight;\n        }\n\n        contentSize = calculateZoomedContentSizeAndRoundUp({\n                width: originalWidth,\n                height: originalHeight\n            },\n            requestedWidth,\n            requestedHeight,\n            zoom);\n\n        rootFontSize = theWindow.getComputedStyle(doc.documentElement).fontSize;\n\n        return {\n            left: left,\n            top: top,\n            width: contentSize.width,\n            height: contentSize.height,\n            viewportWidth: actualViewportWidth,\n            viewportHeight: actualViewportHeight,\n\n            rootFontSize: rootFontSize\n        };\n    };\n\n    module.calculateDocumentContentSize = function (doc, options) {\n        var html = doc.documentElement.outerHTML,\n            defer = ayepromise.defer(),\n            zoom = options.zoom || 1,\n            iframe;\n\n\n        iframe = createIframeWithSizeAtZoomLevel1(options.width, options.height, zoom);\n        // We need to add the element to the document so that its content gets loaded\n        theWindow.document.getElementsByTagName(\"body\")[0].appendChild(iframe);\n\n        iframe.onload = function () {\n            var doc = iframe.contentDocument,\n                size;\n\n            try {\n                size = calculateContentSize(doc, options.clip, options.width, options.height, zoom);\n\n                defer.resolve(size);\n            } catch (e) {\n                defer.reject(e);\n            } finally {\n                theWindow.document.getElementsByTagName(\"body\")[0].removeChild(iframe);\n            }\n        };\n\n        // srcdoc doesn't work in PhantomJS yet\n        iframe.contentDocument.open();\n        iframe.contentDocument.write('<!DOCTYPE html>');\n        iframe.contentDocument.write(html);\n        iframe.contentDocument.close();\n\n        return defer.promise;\n    };\n\n    var addHTMLTagAttributes = function (doc, html) {\n        var attributeMatch = /<html((?:\\s+[^>]*)?)>/im.exec(html),\n            helperDoc = theWindow.document.implementation.createHTMLDocument(''),\n            htmlTagSubstitute,\n            i, elementSubstitute, attribute;\n\n        if (!attributeMatch) {\n            return;\n        }\n\n        htmlTagSubstitute = '<div' + attributeMatch[1] + '></div>';\n        helperDoc.documentElement.innerHTML = htmlTagSubstitute;\n        elementSubstitute = helperDoc.querySelector('div');\n\n        for (i = 0; i < elementSubstitute.attributes.length; i++) {\n            attribute = elementSubstitute.attributes[i];\n            doc.documentElement.setAttribute(attribute.name, attribute.value);\n        }\n    };\n\n    module.parseHTML = function (html) {\n        // We should be using the DOMParser, but it is not supported in older browsers\n        var doc = theWindow.document.implementation.createHTMLDocument('');\n        doc.documentElement.innerHTML = html;\n\n        addHTMLTagAttributes(doc, html);\n        return doc;\n    };\n\n    var isParseError = function (parsedDocument) {\n        // http://stackoverflow.com/questions/11563554/how-do-i-detect-xml-parsing-errors-when-using-javascripts-domparser-in-a-cross\n        var p = new DOMParser(),\n            errorneousParse = p.parseFromString('<', 'text/xml'),\n            parsererrorNS = errorneousParse.getElementsByTagName(\"parsererror\")[0].namespaceURI;\n\n        if (parsererrorNS === 'http://www.w3.org/1999/xhtml') {\n            // In PhantomJS the parseerror element doesn't seem to have a special namespace, so we are just guessing here :(\n            return parsedDocument.getElementsByTagName(\"parsererror\").length > 0;\n        }\n\n        return parsedDocument.getElementsByTagNameNS(parsererrorNS, 'parsererror').length > 0;\n    };\n\n    var failOnParseError = function (doc) {\n        if (doc === null || isParseError(doc)) {\n            throw {\n                message: \"Invalid source\"\n            };\n        }\n    };\n\n    module.validateXHTML = function (xhtml) {\n        var p = new DOMParser(),\n            doc = p.parseFromString(xhtml, \"application/xml\");\n\n        failOnParseError(doc);\n    };\n\n    var lastCacheDate = null;\n\n    var getUncachableURL = function (url, cache) {\n        if (cache === 'none' || cache === 'repeated') {\n            if (lastCacheDate === null || cache !== 'repeated') {\n                lastCacheDate = Date.now();\n            }\n            return url + \"?_=\" + lastCacheDate;\n        } else {\n            return url;\n        }\n    };\n\n    var doDocumentLoad = function (url, options) {\n        var ajaxRequest = new window.XMLHttpRequest(),\n            joinedUrl = util.joinUrl(options.baseUrl, url),\n            augmentedUrl = getUncachableURL(joinedUrl, options.cache),\n            defer = ayepromise.defer(),\n            doReject = function () {\n                defer.reject({message: \"Unable to load page\"});\n            };\n\n        ajaxRequest.addEventListener(\"load\", function () {\n            if (ajaxRequest.status === 200 || ajaxRequest.status === 0) {\n                defer.resolve(ajaxRequest.responseXML);\n            } else {\n                doReject();\n            }\n        }, false);\n\n        ajaxRequest.addEventListener(\"error\", function () {\n            doReject();\n        }, false);\n\n        try {\n            ajaxRequest.open('GET', augmentedUrl, true);\n            ajaxRequest.responseType = \"document\";\n            ajaxRequest.send(null);\n        } catch (err) {\n            doReject();\n        }\n\n        return defer.promise;\n    };\n\n    module.loadDocument = function (url, options) {\n        return doDocumentLoad(url, options)\n            .then(function (doc) {\n                failOnParseError(doc);\n\n                return doc;\n            });\n    };\n\n    return module;\n}(util, proxies, ayepromise, window));\n\nvar svg2image = (function (ayepromise, window) {\n    \"use strict\";\n\n    var module = {};\n\n    var urlForSvg = function (svg, useBlobs) {\n        if (useBlobs) {\n            return URL.createObjectURL(new Blob([svg], {\"type\": \"image/svg+xml\"}));\n        } else {\n            return \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(svg);\n        }\n    };\n\n    var cleanUpUrl = function (url) {\n        if (url instanceof Blob) {\n            URL.revokeObjectURL(url);\n        }\n    };\n\n    var simpleForeignObjectSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"1\" height=\"1\"><foreignObject></foreignObject></svg>';\n\n    var supportsReadingObjectFromCanvas = function (url) {\n        var canvas = document.createElement(\"canvas\"),\n            image = new Image(),\n            defer = ayepromise.defer();\n\n        image.onload = function () {\n            var context = canvas.getContext(\"2d\");\n            try {\n                context.drawImage(image, 0, 0);\n                // This will fail in Chrome & Safari\n                canvas.toDataURL(\"image/png\");\n                defer.resolve(true);\n            } catch (e) {\n                defer.resolve(false);\n            }\n        };\n        image.onerror = defer.reject;\n        image.src = url;\n\n        return defer.promise;\n    };\n\n    var readingBackFromCanvasBenefitsFromOldSchoolDataUris = function () {\n        // Check for work around for https://code.google.com/p/chromium/issues/detail?id=294129\n        var blobUrl = urlForSvg(simpleForeignObjectSvg, true);\n        return supportsReadingObjectFromCanvas(blobUrl)\n            .then(function (supportsReadingFromBlobs) {\n                cleanUpUrl(blobUrl);\n                if (supportsReadingFromBlobs) {\n                    return false;\n                }\n                return supportsReadingObjectFromCanvas(urlForSvg(simpleForeignObjectSvg, false))\n                    .then(function (s) {\n                        return s;\n                    });\n            }, function () {\n                return false;\n            });\n    };\n\n    var supportsBlobBuilding = function () {\n        if (window.Blob) {\n            // Available as constructor only in newer builds for all browsers\n            try {\n                new Blob(['<b></b>'], { \"type\" : \"text/xml\" });\n                return true;\n            } catch (err) {}\n        }\n        return false;\n    };\n\n    var checkBlobSupport = function () {\n        var defer = ayepromise.defer();\n\n        if (supportsBlobBuilding && window.URL) {\n            readingBackFromCanvasBenefitsFromOldSchoolDataUris()\n                .then(function (doesBenefit) {\n                    defer.resolve(! doesBenefit);\n                }, function () {\n                    defer.reject();\n                });\n        } else {\n            defer.resolve(false);\n        }\n\n        return defer.promise;\n    };\n\n    var checkForBlobsResult;\n\n    var checkForBlobs = function () {\n        if (checkForBlobsResult === undefined) {\n            checkForBlobsResult = checkBlobSupport();\n        }\n\n        return checkForBlobsResult;\n    };\n\n    var buildImageUrl = function (svg) {\n        return checkForBlobs().then(function (useBlobs) {\n            return urlForSvg(svg, useBlobs);\n        });\n    };\n\n    module.renderSvg = function (svg) {\n        var url, image,\n            defer = ayepromise.defer(),\n            resetEventHandlers = function () {\n                image.onload = null;\n                image.onerror = null;\n            },\n            cleanUp = function () {\n                if (url) {\n                    cleanUpUrl(url);\n                }\n            };\n\n        image = new Image();\n        image.onload = function() {\n            resetEventHandlers();\n            cleanUp();\n\n            defer.resolve(image);\n        };\n        image.onerror = function () {\n            cleanUp();\n\n            // Webkit calls the onerror handler if the SVG is faulty\n            defer.reject();\n        };\n\n        buildImageUrl(svg).then(function (imageUrl) {\n            url = imageUrl;\n            image.src = url;\n        }, defer.reject);\n\n        return defer.promise;\n    };\n\n    return module;\n}(ayepromise, window));\n\nvar document2svg = (function (util, browser, documentHelper, xmlserializer) {\n    \"use strict\";\n\n    var module = {};\n\n    var zoomedElementSizingAttributes = function (size, zoomFactor) {\n        var closestScaledWith, closestScaledHeight,\n            offsetX, offsetY;\n\n        zoomFactor = zoomFactor || 1;\n        closestScaledWith = Math.round(size.viewportWidth);\n        closestScaledHeight = Math.round(size.viewportHeight);\n\n        offsetX = -size.left;\n        offsetY = -size.top;\n\n        var attributes = {\n             'x': offsetX,\n             'y': offsetY,\n             'width': closestScaledWith,\n             'height': closestScaledHeight\n        };\n\n        if (zoomFactor !== 1) {\n            attributes.style =\n                '-webkit-transform: scale(' + zoomFactor + '); ' +\n                '-webkit-transform-origin: 0 0; ' +\n                'transform: scale(' + zoomFactor + '); ' +\n                'transform-origin: 0 0;';\n        }\n\n        return attributes;\n    };\n\n    var workAroundCollapsingMarginsAcrossSVGElementInWebKitLike = function (attributes) {\n        var style = attributes.style || '';\n        attributes.style = style + 'float: left;';\n    };\n\n    var workAroundSafariSometimesNotShowingExternalResources = function (attributes) {\n        /* Let's hope that works some magic. The spec says SVGLoad only fires\n         * now when all externals are available.\n         * http://www.w3.org/TR/SVG/struct.html#ExternalResourcesRequired */\n        attributes.externalResourcesRequired = true;\n    };\n\n    var serializeAttributes = function (attributes) {\n        var keys = Object.keys(attributes);\n        if (!keys.length) {\n            return '';\n        }\n\n        return ' ' + keys.map(function (key) {\n            return key + '=\"' + attributes[key] + '\"';\n        }).join(' ');\n    };\n\n    module.getSvgForDocument = function (doc, size, zoomFactor) {\n        documentHelper.rewriteTagNameSelectorsToLowerCase(doc);\n\n        var xhtml = xmlserializer.serializeToString(doc);\n\n        browser.validateXHTML(xhtml);\n\n        var attributes = zoomedElementSizingAttributes(size, zoomFactor);\n\n        workAroundCollapsingMarginsAcrossSVGElementInWebKitLike(attributes);\n        workAroundSafariSometimesNotShowingExternalResources(attributes);\n\n        return (\n            '<svg xmlns=\"http://www.w3.org/2000/svg\"' +\n                ' width=\"' + size.width + '\"' +\n                ' height=\"' + size.height + '\"' +\n                ' font-size=\"' + size.rootFontSize + '\"' +\n                '>' +\n                '<foreignObject' + serializeAttributes(attributes) + '>' +\n                xhtml +\n                '</foreignObject>' +\n            '</svg>'\n        );\n    };\n\n    module.drawDocumentAsSvg = function (doc, options) {\n        if (options.hover) {\n            documentHelper.fakeHover(doc, options.hover);\n        }\n        if (options.active) {\n            documentHelper.fakeActive(doc, options.active);\n        }\n        if (options.focus) {\n            documentHelper.fakeFocus(doc, options.focus);\n        }\n\n        return browser.calculateDocumentContentSize(doc, options)\n            .then(function (size) {\n                return module.getSvgForDocument(doc, size, options.zoom);\n            });\n    };\n\n    return module;\n}(util, browser, documentHelper, xmlserializer));\n\nvar rasterize = (function (util, browser, documentHelper, document2svg, svg2image, inlineresources) {\n    \"use strict\";\n\n    var module = {};\n\n    var generalDrawError = function () {\n        return {message: \"Error rendering page\"};\n    };\n\n    var drawSvgAsImg = function (svg) {\n        return svg2image.renderSvg(svg)\n            .then(function (image) {\n                return {\n                    image: image,\n                    svg: svg\n                };\n            }, function () {\n                throw generalDrawError();\n            });\n    };\n\n    var drawImageOnCanvas = function (image, canvas) {\n        try {\n            canvas.getContext(\"2d\").drawImage(image, 0, 0);\n        } catch (e) {\n            // Firefox throws a 'NS_ERROR_NOT_AVAILABLE' if the SVG is faulty\n            throw generalDrawError();\n        }\n    };\n\n    var doDraw = function (doc, canvas, options) {\n        return document2svg.drawDocumentAsSvg(doc, options)\n            .then(drawSvgAsImg)\n            .then(function (result) {\n                if (canvas) {\n                    drawImageOnCanvas(result.image, canvas);\n                }\n\n                return result;\n            });\n    };\n\n    var operateJavaScriptOnDocument = function (doc, options) {\n        return browser.executeJavascript(doc, options)\n            .then(function (result) {\n                var document = result.document;\n                documentHelper.persistInputValues(document);\n\n                return {\n                    document: document,\n                    errors: result.errors\n                };\n            });\n    };\n\n    module.rasterize = function (doc, canvas, options) {\n        var inlineOptions;\n\n        inlineOptions = util.clone(options);\n        inlineOptions.inlineScripts = options.executeJs === true;\n\n        return inlineresources.inlineReferences(doc, inlineOptions)\n            .then(function (errors) {\n                if (options.executeJs) {\n                    return operateJavaScriptOnDocument(doc, options)\n                        .then(function (result) {\n                            return {\n                                document: result.document,\n                                errors: errors.concat(result.errors)\n                            };\n                        });\n                } else {\n                    return {\n                        document: doc,\n                        errors: errors\n                    };\n                }\n            }).then(function (result) {\n                return doDraw(result.document, canvas, options)\n                    .then(function (drawResult) {\n                        return {\n                            image: drawResult.image,\n                            svg: drawResult.svg,\n                            errors: result.errors\n                        };\n                    });\n            });\n    };\n\n    return module;\n}(util, browser, documentHelper, document2svg, svg2image, inlineresources));\n\nvar rasterizeHTML = (function (util, browser, rasterize) {\n    \"use strict\";\n\n    var module = {};\n\n    var getViewportSize = function (canvas, options) {\n        var defaultWidth = 300,\n            defaultHeight = 200,\n            fallbackWidth = canvas ? canvas.width : defaultWidth,\n            fallbackHeight = canvas ? canvas.height : defaultHeight,\n            width = options.width !== undefined ? options.width : fallbackWidth,\n            height = options.height !== undefined ? options.height : fallbackHeight;\n\n        return {\n            width: width,\n            height: height\n        };\n    };\n\n    var constructOptions = function (params) {\n        var viewport = getViewportSize(params.canvas, params.options),\n            options;\n\n        options = util.clone(params.options);\n        options.width = viewport.width;\n        options.height = viewport.height;\n\n        return options;\n    };\n\n    /**\n     * Draws a Document to the canvas.\n     * rasterizeHTML.drawDocument( document [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawDocument = function () {\n        var doc = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return rasterize.rasterize(doc, params.canvas, constructOptions(params));\n    };\n\n    var drawHTML = function (html, canvas, options) {\n        var doc = browser.parseHTML(html);\n\n        return module.drawDocument(doc, canvas, options);\n    };\n\n    /**\n     * Draws a HTML string to the canvas.\n     * rasterizeHTML.drawHTML( html [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawHTML = function () {\n        var html = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return drawHTML(html, params.canvas, params.options);\n    };\n\n    // work around https://bugzilla.mozilla.org/show_bug.cgi?id=925493\n    var workAroundFirefoxNotLoadingStylesheetStyles = function (doc, url, options) {\n        var d = document.implementation.createHTMLDocument('');\n        d.replaceChild(doc.documentElement, d.documentElement);\n\n        var extendedOptions = options ? util.clone(options) : {};\n\n        if (!options.baseUrl) {\n            extendedOptions.baseUrl = url;\n        }\n\n        return {\n            document: d,\n            options: extendedOptions\n        };\n    };\n\n    var drawURL = function (url, canvas, options) {\n        return browser.loadDocument(url, options)\n            .then(function (doc) {\n                var workaround = workAroundFirefoxNotLoadingStylesheetStyles(doc, url, options);\n                return module.drawDocument(workaround.document, canvas, workaround.options);\n            });\n    };\n\n    /**\n     * Draws a page to the canvas.\n     * rasterizeHTML.drawURL( url [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawURL = function () {\n        var url = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return drawURL(url, params.canvas, params.options);\n    };\n\n    return module;\n}(util, browser, rasterize));\n\nreturn rasterizeHTML;\n\n}));\n","\"use strict\";\n\nmodule.exports = function Canvas () {\n  return document.createElement('canvas');\n};\n","module.exports = function (css, customDocument) {\n  var doc = customDocument || document;\n  if (doc.createStyleSheet) {\n    var sheet = doc.createStyleSheet()\n    sheet.cssText = css;\n    return sheet.ownerNode;\n  } else {\n    var head = doc.getElementsByTagName('head')[0],\n        style = doc.createElement('style');\n\n    style.type = 'text/css';\n\n    if (style.styleSheet) {\n      style.styleSheet.cssText = css;\n    } else {\n      style.appendChild(doc.createTextNode(css));\n    }\n\n    head.appendChild(style);\n    return style;\n  }\n};\n\nmodule.exports.byUrl = function(url) {\n  if (document.createStyleSheet) {\n    return document.createStyleSheet(url).ownerNode;\n  } else {\n    var head = document.getElementsByTagName('head')[0],\n        link = document.createElement('link');\n\n    link.rel = 'stylesheet';\n    link.href = url;\n\n    head.appendChild(link);\n    return link;\n  }\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar punycode = require('punycode');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a puny coded representation of \"domain\".\n      // It only converts the part of the domain name that\n      // has non ASCII characters. I.e. it dosent matter if\n      // you call it with a domain that already is in ASCII.\n      var domainArray = this.hostname.split('.');\n      var newOut = [];\n      for (var i = 0; i < domainArray.length; ++i) {\n        var s = domainArray[i];\n        newOut.push(s.match(/[^A-Za-z0-9_-]/) ?\n            'xn--' + punycode.encode(s) : s);\n      }\n      this.hostname = newOut.join('.');\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  Object.keys(this).forEach(function(k) {\n    result[k] = this[k];\n  }, this);\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    Object.keys(relative).forEach(function(k) {\n      if (k !== 'protocol')\n        result[k] = relative[k];\n    });\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      Object.keys(relative).forEach(function(k) {\n        result[k] = relative[k];\n      });\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especialy happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!isNull(result.pathname) || !isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host) && (last === '.' || last === '..') ||\n      last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last == '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especialy happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!isNull(result.pathname) || !isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n\nfunction isString(arg) {\n  return typeof arg === \"string\";\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isNull(arg) {\n  return arg === null;\n}\nfunction isNullOrUndefined(arg) {\n  return  arg == null;\n}\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('is-array')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = Buffer\nexports.INSPECT_MAX_BYTES = 50\nBuffer.poolSize = 8192 // not used by this implementation\n\nvar kMaxLength = 0x3fffffff\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Note:\n *\n * - Implementation must support adding new properties to `Uint8Array` instances.\n *   Firefox 4-29 lacked support, fixed in Firefox 30+.\n *   See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *  - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *  - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *    incorrect length in some situations.\n *\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they will\n * get the Object implementation, which is slower but will work correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = (function () {\n  try {\n    var buf = new ArrayBuffer(0)\n    var arr = new Uint8Array(buf)\n    arr.foo = function () { return 42 }\n    return 42 === arr.foo() && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        new Uint8Array(1).subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n})()\n\n/**\n * Class: Buffer\n * =============\n *\n * The Buffer constructor returns instances of `Uint8Array` that are augmented\n * with function properties for all the node `Buffer` API functions. We use\n * `Uint8Array` so that square bracket notation works as expected -- it returns\n * a single octet.\n *\n * By augmenting the instances, we can avoid modifying the `Uint8Array`\n * prototype.\n */\nfunction Buffer (subject, encoding, noZero) {\n  if (!(this instanceof Buffer))\n    return new Buffer(subject, encoding, noZero)\n\n  var type = typeof subject\n\n  // Find the length\n  var length\n  if (type === 'number')\n    length = subject > 0 ? subject >>> 0 : 0\n  else if (type === 'string') {\n    if (encoding === 'base64')\n      subject = base64clean(subject)\n    length = Buffer.byteLength(subject, encoding)\n  } else if (type === 'object' && subject !== null) { // assume object is array-like\n    if (subject.type === 'Buffer' && isArray(subject.data))\n      subject = subject.data\n    length = +subject.length > 0 ? Math.floor(+subject.length) : 0\n  } else\n    throw new TypeError('must start with number, buffer, array or string')\n\n  if (this.length > kMaxLength)\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n      'size: 0x' + kMaxLength.toString(16) + ' bytes')\n\n  var buf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Preferred: Return an augmented `Uint8Array` instance for best performance\n    buf = Buffer._augment(new Uint8Array(length))\n  } else {\n    // Fallback: Return THIS instance of Buffer (created by `new`)\n    buf = this\n    buf.length = length\n    buf._isBuffer = true\n  }\n\n  var i\n  if (Buffer.TYPED_ARRAY_SUPPORT && typeof subject.byteLength === 'number') {\n    // Speed optimization -- use set if we're copying from a typed array\n    buf._set(subject)\n  } else if (isArrayish(subject)) {\n    // Treat array-ish objects as a byte array\n    if (Buffer.isBuffer(subject)) {\n      for (i = 0; i < length; i++)\n        buf[i] = subject.readUInt8(i)\n    } else {\n      for (i = 0; i < length; i++)\n        buf[i] = ((subject[i] % 256) + 256) % 256\n    }\n  } else if (type === 'string') {\n    buf.write(subject, 0, encoding)\n  } else if (type === 'number' && !Buffer.TYPED_ARRAY_SUPPORT && !noZero) {\n    for (i = 0; i < length; i++) {\n      buf[i] = 0\n    }\n  }\n\n  return buf\n}\n\nBuffer.isBuffer = function (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b))\n    throw new TypeError('Arguments must be Buffers')\n\n  var x = a.length\n  var y = b.length\n  for (var i = 0, len = Math.min(x, y); i < len && a[i] === b[i]; i++) {}\n  if (i !== len) {\n    x = a[i]\n    y = b[i]\n  }\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'binary':\n    case 'base64':\n    case 'raw':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function (list, totalLength) {\n  if (!isArray(list)) throw new TypeError('Usage: Buffer.concat(list[, length])')\n\n  if (list.length === 0) {\n    return new Buffer(0)\n  } else if (list.length === 1) {\n    return list[0]\n  }\n\n  var i\n  if (totalLength === undefined) {\n    totalLength = 0\n    for (i = 0; i < list.length; i++) {\n      totalLength += list[i].length\n    }\n  }\n\n  var buf = new Buffer(totalLength)\n  var pos = 0\n  for (i = 0; i < list.length; i++) {\n    var item = list[i]\n    item.copy(buf, pos)\n    pos += item.length\n  }\n  return buf\n}\n\nBuffer.byteLength = function (str, encoding) {\n  var ret\n  str = str + ''\n  switch (encoding || 'utf8') {\n    case 'ascii':\n    case 'binary':\n    case 'raw':\n      ret = str.length\n      break\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      ret = str.length * 2\n      break\n    case 'hex':\n      ret = str.length >>> 1\n      break\n    case 'utf8':\n    case 'utf-8':\n      ret = utf8ToBytes(str).length\n      break\n    case 'base64':\n      ret = base64ToBytes(str).length\n      break\n    default:\n      ret = str.length\n  }\n  return ret\n}\n\n// pre-set for values that may exist in the future\nBuffer.prototype.length = undefined\nBuffer.prototype.parent = undefined\n\n// toString(encoding, start=0, end=buffer.length)\nBuffer.prototype.toString = function (encoding, start, end) {\n  var loweredCase = false\n\n  start = start >>> 0\n  end = end === undefined || end === Infinity ? this.length : end >>> 0\n\n  if (!encoding) encoding = 'utf8'\n  if (start < 0) start = 0\n  if (end > this.length) end = this.length\n  if (end <= start) return ''\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'binary':\n        return binarySlice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase)\n          throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.equals = function (b) {\n  if(!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max)\n      str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  return Buffer.compare(this, b)\n}\n\n// `get` will be removed in Node 0.13+\nBuffer.prototype.get = function (offset) {\n  console.log('.get() is deprecated. Access using array indexes instead.')\n  return this.readUInt8(offset)\n}\n\n// `set` will be removed in Node 0.13+\nBuffer.prototype.set = function (v, offset) {\n  console.log('.set() is deprecated. Access using array indexes instead.')\n  return this.writeUInt8(v, offset)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new Error('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; i++) {\n    var byte = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(byte)) throw new Error('Invalid hex string')\n    buf[offset + i] = byte\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  var charsWritten = blitBuffer(utf8ToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  var charsWritten = blitBuffer(asciiToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction binaryWrite (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  var charsWritten = blitBuffer(base64ToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction utf16leWrite (buf, string, offset, length) {\n  var charsWritten = blitBuffer(utf16leToBytes(string), buf, offset, length, 2)\n  return charsWritten\n}\n\nBuffer.prototype.write = function (string, offset, length, encoding) {\n  // Support both (string, offset, length, encoding)\n  // and the legacy (string, encoding, offset, length)\n  if (isFinite(offset)) {\n    if (!isFinite(length)) {\n      encoding = length\n      length = undefined\n    }\n  } else {  // legacy\n    var swap = encoding\n    encoding = offset\n    offset = length\n    length = swap\n  }\n\n  offset = Number(offset) || 0\n  var remaining = this.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n  encoding = String(encoding || 'utf8').toLowerCase()\n\n  var ret\n  switch (encoding) {\n    case 'hex':\n      ret = hexWrite(this, string, offset, length)\n      break\n    case 'utf8':\n    case 'utf-8':\n      ret = utf8Write(this, string, offset, length)\n      break\n    case 'ascii':\n      ret = asciiWrite(this, string, offset, length)\n      break\n    case 'binary':\n      ret = binaryWrite(this, string, offset, length)\n      break\n    case 'base64':\n      ret = base64Write(this, string, offset, length)\n      break\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      ret = utf16leWrite(this, string, offset, length)\n      break\n    default:\n      throw new TypeError('Unknown encoding: ' + encoding)\n  }\n  return ret\n}\n\nBuffer.prototype.toJSON = function () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  var res = ''\n  var tmp = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    if (buf[i] <= 0x7F) {\n      res += decodeUtf8Char(tmp) + String.fromCharCode(buf[i])\n      tmp = ''\n    } else {\n      tmp += '%' + buf[i].toString(16)\n    }\n  }\n\n  return res + decodeUtf8Char(tmp)\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction binarySlice (buf, start, end) {\n  return asciiSlice(buf, start, end)\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; i++) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len;\n    if (start < 0)\n      start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0)\n      end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start)\n    end = start\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    return Buffer._augment(this.subarray(start, end))\n  } else {\n    var sliceLen = end - start\n    var newBuf = new Buffer(sliceLen, undefined, true)\n    for (var i = 0; i < sliceLen; i++) {\n      newBuf[i] = this[i + start]\n    }\n    return newBuf\n  }\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0)\n    throw new RangeError('offset is not uint')\n  if (offset + ext > length)\n    throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUInt8 = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n      ((this[offset + 1] << 16) |\n      (this[offset + 2] << 8) |\n      this[offset + 3])\n}\n\nBuffer.prototype.readInt8 = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80))\n    return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16) |\n      (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n      (this[offset + 1] << 16) |\n      (this[offset + 2] << 8) |\n      (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function (offset, noAssert) {\n  if (!noAssert)\n    checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('buffer must be a Buffer instance')\n  if (value > max || value < min) throw new TypeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new TypeError('index out of range')\n}\n\nBuffer.prototype.writeUInt8 = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = value\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; i++) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n  } else objectWriteUInt16(this, value, offset, true)\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = value\n  } else objectWriteUInt16(this, value, offset, false)\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; i++) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = value\n  } else objectWriteUInt32(this, value, offset, true)\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = value\n  } else objectWriteUInt32(this, value, offset, false)\n  return offset + 4\n}\n\nBuffer.prototype.writeInt8 = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = value\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n  } else objectWriteUInt16(this, value, offset, true)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = value\n  } else objectWriteUInt16(this, value, offset, false)\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else objectWriteUInt32(this, value, offset, true)\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert)\n    checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = value\n  } else objectWriteUInt32(this, value, offset, false)\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (value > max || value < min) throw new TypeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new TypeError('index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert)\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert)\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function (target, target_start, start, end) {\n  var source = this\n\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (!target_start) target_start = 0\n\n  // Copy 0 bytes; we're done\n  if (end === start) return\n  if (target.length === 0 || source.length === 0) return\n\n  // Fatal error conditions\n  if (end < start) throw new TypeError('sourceEnd < sourceStart')\n  if (target_start < 0 || target_start >= target.length)\n    throw new TypeError('targetStart out of bounds')\n  if (start < 0 || start >= source.length) throw new TypeError('sourceStart out of bounds')\n  if (end < 0 || end > source.length) throw new TypeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length)\n    end = this.length\n  if (target.length - target_start < end - start)\n    end = target.length - target_start + start\n\n  var len = end - start\n\n  if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < len; i++) {\n      target[i + target_start] = this[i + start]\n    }\n  } else {\n    target._set(this.subarray(start, start + len), target_start)\n  }\n}\n\n// fill(value, start=0, end=buffer.length)\nBuffer.prototype.fill = function (value, start, end) {\n  if (!value) value = 0\n  if (!start) start = 0\n  if (!end) end = this.length\n\n  if (end < start) throw new TypeError('end < start')\n\n  // Fill 0 bytes; we're done\n  if (end === start) return\n  if (this.length === 0) return\n\n  if (start < 0 || start >= this.length) throw new TypeError('start out of bounds')\n  if (end < 0 || end > this.length) throw new TypeError('end out of bounds')\n\n  var i\n  if (typeof value === 'number') {\n    for (i = start; i < end; i++) {\n      this[i] = value\n    }\n  } else {\n    var bytes = utf8ToBytes(value.toString())\n    var len = bytes.length\n    for (i = start; i < end; i++) {\n      this[i] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n/**\n * Creates a new `ArrayBuffer` with the *copied* memory of the buffer instance.\n * Added in Node 0.12. Only available in browsers that support ArrayBuffer.\n */\nBuffer.prototype.toArrayBuffer = function () {\n  if (typeof Uint8Array !== 'undefined') {\n    if (Buffer.TYPED_ARRAY_SUPPORT) {\n      return (new Buffer(this)).buffer\n    } else {\n      var buf = new Uint8Array(this.length)\n      for (var i = 0, len = buf.length; i < len; i += 1) {\n        buf[i] = this[i]\n      }\n      return buf.buffer\n    }\n  } else {\n    throw new TypeError('Buffer.toArrayBuffer not supported in this browser')\n  }\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar BP = Buffer.prototype\n\n/**\n * Augment a Uint8Array *instance* (not the Uint8Array class!) with Buffer methods\n */\nBuffer._augment = function (arr) {\n  arr.constructor = Buffer\n  arr._isBuffer = true\n\n  // save reference to original Uint8Array get/set methods before overwriting\n  arr._get = arr.get\n  arr._set = arr.set\n\n  // deprecated, will be removed in node 0.13+\n  arr.get = BP.get\n  arr.set = BP.set\n\n  arr.write = BP.write\n  arr.toString = BP.toString\n  arr.toLocaleString = BP.toString\n  arr.toJSON = BP.toJSON\n  arr.equals = BP.equals\n  arr.compare = BP.compare\n  arr.copy = BP.copy\n  arr.slice = BP.slice\n  arr.readUInt8 = BP.readUInt8\n  arr.readUInt16LE = BP.readUInt16LE\n  arr.readUInt16BE = BP.readUInt16BE\n  arr.readUInt32LE = BP.readUInt32LE\n  arr.readUInt32BE = BP.readUInt32BE\n  arr.readInt8 = BP.readInt8\n  arr.readInt16LE = BP.readInt16LE\n  arr.readInt16BE = BP.readInt16BE\n  arr.readInt32LE = BP.readInt32LE\n  arr.readInt32BE = BP.readInt32BE\n  arr.readFloatLE = BP.readFloatLE\n  arr.readFloatBE = BP.readFloatBE\n  arr.readDoubleLE = BP.readDoubleLE\n  arr.readDoubleBE = BP.readDoubleBE\n  arr.writeUInt8 = BP.writeUInt8\n  arr.writeUInt16LE = BP.writeUInt16LE\n  arr.writeUInt16BE = BP.writeUInt16BE\n  arr.writeUInt32LE = BP.writeUInt32LE\n  arr.writeUInt32BE = BP.writeUInt32BE\n  arr.writeInt8 = BP.writeInt8\n  arr.writeInt16LE = BP.writeInt16LE\n  arr.writeInt16BE = BP.writeInt16BE\n  arr.writeInt32LE = BP.writeInt32LE\n  arr.writeInt32BE = BP.writeInt32BE\n  arr.writeFloatLE = BP.writeFloatLE\n  arr.writeFloatBE = BP.writeFloatBE\n  arr.writeDoubleLE = BP.writeDoubleLE\n  arr.writeDoubleBE = BP.writeDoubleBE\n  arr.fill = BP.fill\n  arr.inspect = BP.inspect\n  arr.toArrayBuffer = BP.toArrayBuffer\n\n  return arr\n}\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-z]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction isArrayish (subject) {\n  return isArray(subject) || Buffer.isBuffer(subject) ||\n      subject && typeof subject === 'object' &&\n      typeof subject.length === 'number'\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    var b = str.charCodeAt(i)\n    if (b <= 0x7F) {\n      byteArray.push(b)\n    } else {\n      var start = i\n      if (b >= 0xD800 && b <= 0xDFFF) i++\n      var h = encodeURIComponent(str.slice(start, i+1)).substr(1).split('%')\n      for (var j = 0; j < h.length; j++) {\n        byteArray.push(parseInt(h[j], 16))\n      }\n    }\n  }\n  return byteArray\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(str)\n}\n\nfunction blitBuffer (src, dst, offset, length, unitSize) {\n  if (unitSize) length -= length % unitSize;\n  for (var i = 0; i < length; i++) {\n    if ((i + offset >= dst.length) || (i >= src.length))\n      break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction decodeUtf8Char (str) {\n  try {\n    return decodeURIComponent(str)\n  } catch (err) {\n    return String.fromCharCode(0xFFFD) // UTF 8 invalid char\n  }\n}\n","/*! http://mths.be/punycode v1.2.4 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^ -~]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /\\x2E|\\u3002|\\uFF0E|\\uFF61/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\twhile (length--) {\n\t\t\tarray[length] = fn(array[length]);\n\t\t}\n\t\treturn array;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings.\n\t * @private\n\t * @param {String} domain The domain name.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\treturn map(string.split(regexSeparators), fn).join('.');\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <http://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * http://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols to a Punycode string of ASCII-only\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name to Unicode. Only the\n\t * Punycoded parts of the domain name will be converted, i.e. it doesn't\n\t * matter if you call it on a string that has already been converted to\n\t * Unicode.\n\t * @memberOf punycode\n\t * @param {String} domain The Punycode domain name to convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(domain) {\n\t\treturn mapDomain(domain, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name to Punycode. Only the\n\t * non-ASCII parts of the domain name will be converted, i.e. it doesn't\n\t * matter if you call it with a domain that's already in ASCII.\n\t * @memberOf punycode\n\t * @param {String} domain The domain name to convert, as a Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name.\n\t */\n\tfunction toASCII(domain) {\n\t\treturn mapDomain(domain, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.2.4',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <http://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","\n/**\n * isArray\n */\n\nvar isArray = Array.isArray;\n\n/**\n * toString\n */\n\nvar str = Object.prototype.toString;\n\n/**\n * Whether or not the given `val`\n * is an array.\n *\n * example:\n *\n *        isArray([]);\n *        // > true\n *        isArray(arguments);\n *        // > false\n *        isArray('');\n *        // > false\n *\n * @param {mixed} val\n * @return {bool}\n */\n\nmodule.exports = isArray || function (val) {\n  return !! val && '[object Array]' == str.call(val);\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n","exports.read = function(buffer, offset, isLE, mLen, nBytes) {\n  var e, m,\n      eLen = nBytes * 8 - mLen - 1,\n      eMax = (1 << eLen) - 1,\n      eBias = eMax >> 1,\n      nBits = -7,\n      i = isLE ? (nBytes - 1) : 0,\n      d = isLE ? -1 : 1,\n      s = buffer[offset + i];\n\n  i += d;\n\n  e = s & ((1 << (-nBits)) - 1);\n  s >>= (-nBits);\n  nBits += eLen;\n  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8);\n\n  m = e & ((1 << (-nBits)) - 1);\n  e >>= (-nBits);\n  nBits += mLen;\n  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8);\n\n  if (e === 0) {\n    e = 1 - eBias;\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity);\n  } else {\n    m = m + Math.pow(2, mLen);\n    e = e - eBias;\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen);\n};\n\nexports.write = function(buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c,\n      eLen = nBytes * 8 - mLen - 1,\n      eMax = (1 << eLen) - 1,\n      eBias = eMax >> 1,\n      rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0),\n      i = isLE ? 0 : (nBytes - 1),\n      d = isLE ? 1 : -1,\n      s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0;\n\n  value = Math.abs(value);\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0;\n    e = eMax;\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2);\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--;\n      c *= 2;\n    }\n    if (e + eBias >= 1) {\n      value += rt / c;\n    } else {\n      value += rt * Math.pow(2, 1 - eBias);\n    }\n    if (value * c >= 2) {\n      e++;\n      c /= 2;\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0;\n      e = eMax;\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * Math.pow(2, mLen);\n      e = e + eBias;\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen);\n      e = 0;\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8);\n\n  e = (e << mLen) | m;\n  eLen += mLen;\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8);\n\n  buffer[offset + i - d] |= s * 128;\n};\n","var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n;(function (exports) {\n\t'use strict';\n\n  var Arr = (typeof Uint8Array !== 'undefined')\n    ? Uint8Array\n    : Array\n\n\tvar PLUS   = '+'.charCodeAt(0)\n\tvar SLASH  = '/'.charCodeAt(0)\n\tvar NUMBER = '0'.charCodeAt(0)\n\tvar LOWER  = 'a'.charCodeAt(0)\n\tvar UPPER  = 'A'.charCodeAt(0)\n\n\tfunction decode (elt) {\n\t\tvar code = elt.charCodeAt(0)\n\t\tif (code === PLUS)\n\t\t\treturn 62 // '+'\n\t\tif (code === SLASH)\n\t\t\treturn 63 // '/'\n\t\tif (code < NUMBER)\n\t\t\treturn -1 //no match\n\t\tif (code < NUMBER + 10)\n\t\t\treturn code - NUMBER + 26 + 26\n\t\tif (code < UPPER + 26)\n\t\t\treturn code - UPPER\n\t\tif (code < LOWER + 26)\n\t\t\treturn code - LOWER + 26\n\t}\n\n\tfunction b64ToByteArray (b64) {\n\t\tvar i, j, l, tmp, placeHolders, arr\n\n\t\tif (b64.length % 4 > 0) {\n\t\t\tthrow new Error('Invalid string. Length must be a multiple of 4')\n\t\t}\n\n\t\t// the number of equal signs (place holders)\n\t\t// if there are two placeholders, than the two characters before it\n\t\t// represent one byte\n\t\t// if there is only one, then the three characters before it represent 2 bytes\n\t\t// this is just a cheap hack to not do indexOf twice\n\t\tvar len = b64.length\n\t\tplaceHolders = '=' === b64.charAt(len - 2) ? 2 : '=' === b64.charAt(len - 1) ? 1 : 0\n\n\t\t// base64 is 4/3 + up to two characters of the original data\n\t\tarr = new Arr(b64.length * 3 / 4 - placeHolders)\n\n\t\t// if there are placeholders, only get up to the last complete 4 chars\n\t\tl = placeHolders > 0 ? b64.length - 4 : b64.length\n\n\t\tvar L = 0\n\n\t\tfunction push (v) {\n\t\t\tarr[L++] = v\n\t\t}\n\n\t\tfor (i = 0, j = 0; i < l; i += 4, j += 3) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 18) | (decode(b64.charAt(i + 1)) << 12) | (decode(b64.charAt(i + 2)) << 6) | decode(b64.charAt(i + 3))\n\t\t\tpush((tmp & 0xFF0000) >> 16)\n\t\t\tpush((tmp & 0xFF00) >> 8)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\tif (placeHolders === 2) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 2) | (decode(b64.charAt(i + 1)) >> 4)\n\t\t\tpush(tmp & 0xFF)\n\t\t} else if (placeHolders === 1) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 10) | (decode(b64.charAt(i + 1)) << 4) | (decode(b64.charAt(i + 2)) >> 2)\n\t\t\tpush((tmp >> 8) & 0xFF)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\treturn arr\n\t}\n\n\tfunction uint8ToBase64 (uint8) {\n\t\tvar i,\n\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\toutput = \"\",\n\t\t\ttemp, length\n\n\t\tfunction encode (num) {\n\t\t\treturn lookup.charAt(num)\n\t\t}\n\n\t\tfunction tripletToBase64 (num) {\n\t\t\treturn encode(num >> 18 & 0x3F) + encode(num >> 12 & 0x3F) + encode(num >> 6 & 0x3F) + encode(num & 0x3F)\n\t\t}\n\n\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])\n\t\t\toutput += tripletToBase64(temp)\n\t\t}\n\n\t\t// pad the end with zeros, but make sure to not forget the extra bytes\n\t\tswitch (extraBytes) {\n\t\t\tcase 1:\n\t\t\t\ttemp = uint8[uint8.length - 1]\n\t\t\t\toutput += encode(temp >> 2)\n\t\t\t\toutput += encode((temp << 4) & 0x3F)\n\t\t\t\toutput += '=='\n\t\t\t\tbreak\n\t\t\tcase 2:\n\t\t\t\ttemp = (uint8[uint8.length - 2] << 8) + (uint8[uint8.length - 1])\n\t\t\t\toutput += encode(temp >> 10)\n\t\t\t\toutput += encode((temp >> 4) & 0x3F)\n\t\t\t\toutput += encode((temp << 2) & 0x3F)\n\t\t\t\toutput += '='\n\t\t\t\tbreak\n\t\t}\n\n\t\treturn output\n\t}\n\n\texports.toByteArray = b64ToByteArray\n\texports.fromByteArray = uint8ToBase64\n}(typeof exports === 'undefined' ? (this.base64js = {}) : exports))\n","\"use strict\";\n\nvar util = require('./util'),\n    inlineImage = require('./inlineImage'),\n    inlineScript = require('./inlineScript'),\n    inlineCss = require('./inlineCss'),\n    cssSupport = require('./cssSupport');\n\n\nvar getUrlBasePath = function (url) {\n    return util.joinUrl(url, '.');\n};\n\nvar parameterHashFunction = function (params) {\n    // HACK JSON.stringify is poor man's hashing;\n    // same objects might not receive same result as key order is not guaranteed\n    var a = params.map(function (param, idx) {\n        // Only include options relevant for method\n        if (idx === (params.length - 1)) {\n            param = {\n                // Two different HTML pages on the same path level have the same base path, but a different URL\n                baseUrl: getUrlBasePath(param.baseUrl)\n            };\n        }\n        return JSON.stringify(param);\n    });\n    return a;\n};\n\nvar memoizeFunctionOnCaching = function (func, options) {\n    if ((options.cache !== false && options.cache !== 'none') && options.cacheBucket) {\n        return util.memoize(func, parameterHashFunction, options.cacheBucket);\n    } else {\n        return func;\n    }\n};\n\n/* Style inlining */\n\nvar requestExternalsForStylesheet = function (styleContent, alreadyLoadedCssUrls, options) {\n    var cssRules = cssSupport.rulesForCssText(styleContent);\n\n    return inlineCss.loadCSSImportsForRules(cssRules, alreadyLoadedCssUrls, options).then(function (cssImportResult) {\n        return inlineCss.loadAndInlineCSSResourcesForRules(cssRules, options).then(function (cssResourcesResult) {\n            var errors = cssImportResult.errors.concat(cssResourcesResult.errors),\n                hasChanges = cssImportResult.hasChanges || cssResourcesResult.hasChanges;\n\n            if (hasChanges) {\n                styleContent = cssSupport.cssRulesToText(cssRules);\n            }\n\n            return {\n                hasChanges: hasChanges,\n                content: styleContent,\n                errors: errors\n            };\n        });\n    });\n};\n\nvar loadAndInlineCssForStyle = function (style, options, alreadyLoadedCssUrls) {\n    var styleContent = style.textContent,\n        processExternals = memoizeFunctionOnCaching(requestExternalsForStylesheet, options);\n\n    return processExternals(styleContent, alreadyLoadedCssUrls, options).then(function (result) {\n        if (result.hasChanges) {\n            style.childNodes[0].nodeValue = result.content;\n        }\n\n        return util.cloneArray(result.errors);\n    });\n};\n\nvar getCssStyleElements = function (doc) {\n    var styles = doc.getElementsByTagName(\"style\");\n\n    return Array.prototype.filter.call(styles, function (style) {\n        return !style.attributes.type || style.attributes.type.nodeValue === \"text/css\";\n    });\n};\n\nexports.loadAndInlineStyles = function (doc, options) {\n    var styles = getCssStyleElements(doc),\n        allErrors = [],\n        alreadyLoadedCssUrls = [],\n        inlineOptions;\n\n    inlineOptions = util.clone(options);\n    inlineOptions.baseUrl = inlineOptions.baseUrl || util.getDocumentBaseUrl(doc);\n\n    return util.all(styles.map(function (style) {\n        return loadAndInlineCssForStyle(style, inlineOptions, alreadyLoadedCssUrls).then(function (errors) {\n            allErrors = allErrors.concat(errors);\n        });\n    })).then(function () {\n        return allErrors;\n    });\n};\n\n/* CSS link inlining */\n\nvar substituteLinkWithInlineStyle = function (oldLinkNode, styleContent) {\n    var parent = oldLinkNode.parentNode,\n        styleNode;\n\n    styleContent = styleContent.trim();\n    if (styleContent) {\n        styleNode = oldLinkNode.ownerDocument.createElement(\"style\");\n        styleNode.type = \"text/css\";\n        styleNode.appendChild(oldLinkNode.ownerDocument.createTextNode(styleContent));\n\n        parent.insertBefore(styleNode, oldLinkNode);\n    }\n\n    parent.removeChild(oldLinkNode);\n};\n\nvar requestStylesheetAndInlineResources = function (url, options) {\n    return util.ajax(url, options)\n        .then(function (content) {\n            var cssRules = cssSupport.rulesForCssText(content);\n\n            return {\n                content: content,\n                cssRules: cssRules\n            };\n        })\n        .then(function (result) {\n            var hasChangesFromPathAdjustment = inlineCss.adjustPathsOfCssResources(url, result.cssRules);\n\n            return {\n                content: result.content,\n                cssRules: result.cssRules,\n                hasChanges: hasChangesFromPathAdjustment\n            };\n        })\n        .then(function (result) {\n            return inlineCss.loadCSSImportsForRules(result.cssRules, [], options)\n                .then(function (cssImportResult) {\n                    return {\n                        content: result.content,\n                        cssRules: result.cssRules,\n                        hasChanges: result.hasChanges || cssImportResult.hasChanges,\n                        errors: cssImportResult.errors\n                    };\n                });\n        })\n        .then(function (result) {\n            return inlineCss.loadAndInlineCSSResourcesForRules(result.cssRules, options)\n                .then(function (cssResourcesResult) {\n                    return {\n                        content: result.content,\n                        cssRules: result.cssRules,\n                        hasChanges: result.hasChanges || cssResourcesResult.hasChanges,\n                        errors: result.errors.concat(cssResourcesResult.errors)\n                    };\n                });\n        })\n        .then(function (result) {\n            var content = result.content;\n            if (result.hasChanges) {\n                content = cssSupport.cssRulesToText(result.cssRules);\n            }\n            return {\n                content: content,\n                errors: result.errors\n            };\n        });\n};\n\nvar loadLinkedCSS = function (link, options) {\n    var cssHref = link.attributes.href.nodeValue,\n        documentBaseUrl = util.getDocumentBaseUrl(link.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBaseUrl) {\n        ajaxOptions.baseUrl = documentBaseUrl;\n    }\n\n    var processStylesheet = memoizeFunctionOnCaching(requestStylesheetAndInlineResources, options);\n\n    return processStylesheet(cssHref, ajaxOptions).then(function (result) {\n        return {\n            content: result.content,\n            errors: util.cloneArray(result.errors)\n        };\n    });\n};\n\nvar getCssStylesheetLinks = function (doc) {\n    var links = doc.getElementsByTagName(\"link\");\n\n    return Array.prototype.filter.call(links, function (link) {\n        return link.attributes.rel && link.attributes.rel.nodeValue === \"stylesheet\" &&\n            (!link.attributes.type || link.attributes.type.nodeValue === \"text/css\");\n    });\n};\n\nexports.loadAndInlineCssLinks = function (doc, options) {\n    var links = getCssStylesheetLinks(doc),\n        errors = [];\n\n    return util.all(links.map(function (link) {\n        return loadLinkedCSS(link, options).then(function(result) {\n            substituteLinkWithInlineStyle(link, result.content + \"\\n\");\n\n            errors = errors.concat(result.errors);\n        }, function (e) {\n            errors.push({\n                resourceType: \"stylesheet\",\n                url: e.url,\n                msg: \"Unable to load stylesheet \" + e.url\n            });\n        });\n    })).then(function () {\n        return errors;\n    });\n};\n\n/* Main */\n\nexports.loadAndInlineImages = inlineImage.inline;\nexports.loadAndInlineScript = inlineScript.inline;\n\nexports.inlineReferences = function (doc, options) {\n    var allErrors = [],\n        inlineFuncs = [\n            exports.loadAndInlineImages,\n            exports.loadAndInlineStyles,\n            exports.loadAndInlineCssLinks];\n\n    if (options.inlineScripts !== false) {\n        inlineFuncs.push(exports.loadAndInlineScript);\n    }\n\n    return util.all(inlineFuncs.map(function (func) {\n        return func(doc, options)\n            .then(function (errors) {\n                allErrors = allErrors.concat(errors);\n            });\n    })).then(function () {\n        return allErrors;\n    });\n};\n","var removeInvalidCharacters = function (content) {\n    // See http://www.w3.org/TR/xml/#NT-Char for valid XML 1.0 characters\n    return content.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F]/g, '');\n};\n\nvar serializeAttributeValue = function (value) {\n    return value\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&apos;');\n};\n\nvar serializeTextContent = function (content) {\n    return content\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n};\n\nvar serializeAttribute = function (attr) {\n    var value = attr.value;\n\n    return ' ' + attr.name + '=\"' + serializeAttributeValue(value) + '\"';\n};\n\nvar getTagName = function (node) {\n    var tagName = node.tagName;\n\n    // Aid in serializing of original HTML documents\n    if (node.namespaceURI === 'http://www.w3.org/1999/xhtml') {\n        tagName = tagName.toLowerCase();\n    }\n    return tagName;\n};\n\nvar serializeNamespace = function (node) {\n    var nodeHasXmlnsAttr = Array.prototype.map.call(node.attributes || node.attrs, function (attr) {\n            return attr.name;\n        })\n        .indexOf('xmlns') >= 0;\n    // Serialize the namespace as an xmlns attribute whenever the element\n    // doesn't already have one and the inherited namespace does not match\n    // the element's namespace.\n    // As a special case, always include an xmlns for html elements, in case\n    // of broken namespaceURI handling by browsers.\n    if (!nodeHasXmlnsAttr &&\n            (!node.parentNode ||\n             node.namespaceURI !== node.parentNode.namespaceURI ||\n             getTagName(node) === 'html')) {\n         return ' xmlns=\"' + node.namespaceURI + '\"';\n    } else {\n        return '';\n    }\n};\n\nvar serializeChildren = function (node) {\n    return Array.prototype.map.call(node.childNodes, function (childNode) {\n        return nodeTreeToXHTML(childNode);\n    }).join('');\n};\n\nvar serializeTag = function (node) {\n    var output = '<' + getTagName(node);\n    output += serializeNamespace(node);\n\n    Array.prototype.forEach.call(node.attributes || node.attrs, function (attr) {\n        output += serializeAttribute(attr);\n    });\n\n    if (node.childNodes.length > 0) {\n        output += '>';\n        output += serializeChildren(node);\n        output += '</' + getTagName(node) + '>';\n    } else {\n        output += '/>';\n    }\n    return output;\n};\n\nvar serializeText = function (node) {\n    var text = node.nodeValue || node.value || '';\n    return serializeTextContent(text);\n};\n\nvar serializeComment = function (node) {\n    return '<!--' +\n        node.data\n            .replace(/-/g, '&#45;') +\n        '-->';\n};\n\nvar serializeCDATA = function (node) {\n    return '<![CDATA[' + node.nodeValue + ']]>';\n};\n\nvar nodeTreeToXHTML = function (node) {\n    if (node.nodeName === '#document' ||\n        node.nodeName === '#document-fragment') {\n        return serializeChildren(node);\n    } else {\n        if (node.tagName) {\n            return serializeTag(node);\n        } else if (node.nodeName === '#text') {\n            return serializeText(node);\n        } else if (node.nodeName === '#comment') {\n            return serializeComment(node);\n        } else if (node.nodeName === '#cdata-section') {\n            return serializeCDATA(node);\n        }\n    }\n};\n\nexports.serializeToString = function (document) {\n    return removeInvalidCharacters(nodeTreeToXHTML(document));\n};\n","\"use strict\";\n\nvar url = require('url'),\n    ayepromise = require('ayepromise');\n\n\nexports.getDocumentBaseUrl = function (doc) {\n    if (doc.baseURI !== 'about:blank') {\n        return doc.baseURI;\n    }\n\n    return null;\n};\n\nexports.clone = function (object) {\n    var theClone = {},\n        i;\n    for (i in object) {\n        if (object.hasOwnProperty(i)) {\n           theClone[i] = object[i];\n        }\n    }\n    return theClone;\n};\n\nexports.cloneArray = function (nodeList) {\n    return Array.prototype.slice.apply(nodeList, [0]);\n};\n\nexports.joinUrl = function (baseUrl, relUrl) {\n    if (!baseUrl) {\n        return relUrl;\n    }\n    return url.resolve(baseUrl, relUrl);\n};\n\nexports.isDataUri = function (url) {\n    return (/^data:/).test(url);\n};\n\nexports.all = function (promises) {\n    var defer = ayepromise.defer(),\n        pendingPromiseCount = promises.length,\n        resolvedValues = [];\n\n    if (promises.length === 0) {\n        defer.resolve([]);\n        return defer.promise;\n    }\n\n    promises.forEach(function (promise, idx) {\n        promise.then(function (value) {\n            pendingPromiseCount -= 1;\n            resolvedValues[idx] = value;\n\n            if (pendingPromiseCount === 0) {\n                defer.resolve(resolvedValues);\n            }\n        }, function (e) {\n            defer.reject(e);\n        });\n    });\n    return defer.promise;\n};\n\nexports.collectAndReportErrors = function (promises) {\n    var errors = [];\n\n    return exports.all(promises.map(function (promise) {\n        return promise.fail(function (e) {\n            errors.push(e);\n        });\n    })).then(function () {\n        return errors;\n    });\n};\n\nvar lastCacheDate = null;\n\nvar getUncachableURL = function (url, cache) {\n    if (cache === false || cache === 'none' || cache === 'repeated') {\n        if (lastCacheDate === null || cache !== 'repeated') {\n            lastCacheDate = Date.now();\n        }\n        return url + \"?_=\" + lastCacheDate;\n    } else {\n        return url;\n    }\n};\n\nexports.ajax = function (url, options) {\n    var ajaxRequest = new window.XMLHttpRequest(),\n        defer = ayepromise.defer(),\n        joinedUrl = exports.joinUrl(options.baseUrl, url),\n        augmentedUrl;\n\n    var doReject = function () {\n        defer.reject({\n            msg: 'Unable to load url',\n            url: joinedUrl\n        });\n    };\n\n    augmentedUrl = getUncachableURL(joinedUrl, options.cache);\n\n    ajaxRequest.addEventListener(\"load\", function () {\n        if (ajaxRequest.status === 200 || ajaxRequest.status === 0) {\n            defer.resolve(ajaxRequest.response);\n        } else {\n            doReject();\n        }\n    }, false);\n\n    ajaxRequest.addEventListener(\"error\", doReject, false);\n\n    try {\n        ajaxRequest.open('GET', augmentedUrl, true);\n        ajaxRequest.overrideMimeType(options.mimeType);\n        ajaxRequest.send(null);\n    } catch (e) {\n        doReject();\n    }\n\n    return defer.promise;\n};\n\nexports.binaryAjax = function (url, options) {\n    var ajaxOptions = exports.clone(options);\n\n    ajaxOptions.mimeType = 'text/plain; charset=x-user-defined';\n\n    return exports.ajax(url, ajaxOptions)\n        .then(function (content) {\n            var binaryContent = \"\";\n\n            for (var i = 0; i < content.length; i++) {\n                binaryContent += String.fromCharCode(content.charCodeAt(i) & 0xFF);\n            }\n\n            return binaryContent;\n        });\n};\n\nvar detectMimeType = function (content) {\n    var startsWith = function (string, substring) {\n        return string.substring(0, substring.length) === substring;\n    };\n\n    if (startsWith(content, '<?xml') || startsWith(content, '<svg')) {\n        return 'image/svg+xml';\n    }\n    return 'image/png';\n};\n\nexports.getDataURIForImageURL = function (url, options) {\n    return exports.binaryAjax(url, options)\n        .then(function (content) {\n            var base64Content = btoa(content),\n                mimeType = detectMimeType(content);\n\n            return 'data:' + mimeType + ';base64,' + base64Content;\n        });\n};\n\nvar uniqueIdList = [];\n\nvar constantUniqueIdFor = function (element) {\n    // HACK, using a list results in O(n), but how do we hash a function?\n    if (uniqueIdList.indexOf(element) < 0) {\n        uniqueIdList.push(element);\n    }\n    return uniqueIdList.indexOf(element);\n};\n\nexports.memoize = function (func, hasher, memo) {\n    if (typeof memo !== \"object\") {\n        throw new Error(\"cacheBucket is not an object\");\n    }\n\n    return function () {\n        var args = Array.prototype.slice.call(arguments);\n\n        var argumentHash = hasher(args),\n            funcHash = constantUniqueIdFor(func),\n            retValue;\n\n        if (memo[funcHash] && memo[funcHash][argumentHash]) {\n            return memo[funcHash][argumentHash];\n        } else {\n            retValue = func.apply(null, args);\n\n            memo[funcHash] = memo[funcHash] || {};\n            memo[funcHash][argumentHash] = retValue;\n\n            return retValue;\n        }\n    };\n};\n","\"use strict\";\n\nvar util = require('./util');\n\n\nvar encodeImageAsDataURI = function (image, options) {\n    var url = image.attributes.src ? image.attributes.src.nodeValue : null,\n        documentBase = util.getDocumentBaseUrl(image.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBase) {\n        ajaxOptions.baseUrl = documentBase;\n    }\n\n    return util.getDataURIForImageURL(url, ajaxOptions)\n        .then(function (dataURI) {\n            return dataURI;\n        }, function (e) {\n            throw {\n                resourceType: \"image\",\n                url: e.url,\n                msg: \"Unable to load image \" + e.url\n            };\n        });\n};\n\nvar filterExternalImages = function (images) {\n    return images.filter(function (image) {\n        var url = image.attributes.src ? image.attributes.src.nodeValue : null;\n\n        return url !== null && !util.isDataUri(url);\n    });\n};\n\nvar filterInputsForImageType = function (inputs) {\n    return Array.prototype.filter.call(inputs, function (input) {\n        return input.type === \"image\";\n    });\n};\n\nvar toArray = function (arrayLike) {\n    return Array.prototype.slice.call(arrayLike);\n};\n\nexports.inline = function (doc, options) {\n    var images = toArray(doc.getElementsByTagName(\"img\")),\n        imageInputs = filterInputsForImageType(doc.getElementsByTagName(\"input\")),\n        externalImages = filterExternalImages(images.concat(imageInputs));\n\n    return util.collectAndReportErrors(externalImages.map(function (image) {\n        return encodeImageAsDataURI(image, options).then(function (dataURI) {\n            image.attributes.src.nodeValue = dataURI;\n        });\n    }));\n};\n","\"use strict\";\n\nvar util = require('./util');\n\n\nvar loadLinkedScript = function (script, options) {\n    var src = script.attributes.src.nodeValue,\n        documentBase = util.getDocumentBaseUrl(script.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBase) {\n        ajaxOptions.baseUrl = documentBase;\n    }\n\n    return util.ajax(src, ajaxOptions)\n        .fail(function (e) {\n            throw {\n                resourceType: \"script\",\n                url: e.url,\n                msg: \"Unable to load script \" + e.url\n            };\n        });\n};\n\nvar escapeClosingTags = function (text) {\n    // http://stackoverflow.com/questions/9246382/escaping-script-tag-inside-javascript\n    return text.replace(/<\\//g, '<\\\\/');\n};\n\nvar substituteExternalScriptWithInline = function (scriptNode, jsCode) {\n    scriptNode.attributes.removeNamedItem('src');\n    scriptNode.textContent = escapeClosingTags(jsCode);\n};\n\nvar getScripts = function (doc) {\n    var scripts = doc.getElementsByTagName(\"script\");\n\n    return Array.prototype.filter.call(scripts, function (script) {\n        return !!script.attributes.src;\n    });\n};\n\nexports.inline = function (doc, options) {\n    var scripts = getScripts(doc);\n\n    return util.collectAndReportErrors(scripts.map(function (script) {\n        return loadLinkedScript(script, options).then(function (jsCode) {\n            substituteExternalScriptWithInline(script, jsCode);\n        });\n    }));\n};\n","\"use strict\";\n\nvar ayepromise = require('ayepromise'),\n    util = require('./util'),\n    cssSupport = require('./cssSupport'),\n    backgroundValueParser = require('./backgroundValueParser'),\n    fontFaceSrcValueParser = require('css-font-face-src');\n\n\nvar updateCssPropertyValue = function (rule, property, value) {\n    rule.style.setProperty(property, value, rule.style.getPropertyPriority(property));\n};\n\nvar findBackgroundImageRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.STYLE_RULE && (rule.style.getPropertyValue('background-image') || rule.style.getPropertyValue('background'));\n    });\n};\n\nvar findBackgroundDeclarations = function (rules) {\n    var backgroundDeclarations = [];\n\n    rules.forEach(function (rule) {\n        if (rule.style.getPropertyValue('background-image')) {\n            backgroundDeclarations.push({\n                property: 'background-image',\n                value: rule.style.getPropertyValue('background-image'),\n                rule: rule\n            });\n        } else if (rule.style.getPropertyValue('background')) {\n            backgroundDeclarations.push({\n                property: 'background',\n                value: rule.style.getPropertyValue('background'),\n                rule: rule\n            });\n        }\n    });\n\n    return backgroundDeclarations;\n};\n\nvar findFontFaceRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.FONT_FACE_RULE && rule.style.getPropertyValue(\"src\");\n    });\n};\n\nvar findCSSImportRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.IMPORT_RULE && rule.href;\n    });\n};\n\nvar findExternalBackgroundUrls = function (parsedBackground) {\n    var matchIndices = [];\n\n    parsedBackground.forEach(function (backgroundLayer, i) {\n        if (backgroundLayer.url && !util.isDataUri(backgroundLayer.url)) {\n            matchIndices.push(i);\n        }\n    });\n\n    return matchIndices;\n};\n\nvar findExternalFontFaceUrls = function (parsedFontFaceSources) {\n    var sourceIndices = [];\n    parsedFontFaceSources.forEach(function (sourceItem, i) {\n        if (sourceItem.url && !util.isDataUri(sourceItem.url)) {\n            sourceIndices.push(i);\n        }\n    });\n    return sourceIndices;\n};\n\nexports.adjustPathsOfCssResources = function (baseUrl, cssRules) {\n    var backgroundRules = findBackgroundImageRules(cssRules),\n        backgroundDeclarations = findBackgroundDeclarations(backgroundRules),\n        change = false;\n\n    backgroundDeclarations.forEach(function (declaration) {\n        var parsedBackground = backgroundValueParser.parse(declaration.value),\n            externalBackgroundIndices = findExternalBackgroundUrls(parsedBackground),\n            backgroundValue;\n\n        if (externalBackgroundIndices.length > 0) {\n            externalBackgroundIndices.forEach(function (backgroundLayerIndex) {\n                var relativeUrl = parsedBackground[backgroundLayerIndex].url,\n                    url = util.joinUrl(baseUrl, relativeUrl);\n                parsedBackground[backgroundLayerIndex].url = url;\n            });\n\n            backgroundValue = backgroundValueParser.serialize(parsedBackground);\n\n            updateCssPropertyValue(declaration.rule, declaration.property, backgroundValue);\n\n            change = true;\n        }\n    });\n    findFontFaceRules(cssRules).forEach(function (rule) {\n        var fontFaceSrcDeclaration = rule.style.getPropertyValue(\"src\"),\n            parsedFontFaceSources, externalFontFaceUrlIndices;\n\n        try {\n            parsedFontFaceSources = fontFaceSrcValueParser.parse(fontFaceSrcDeclaration);\n        } catch (e) {\n            return;\n        }\n        externalFontFaceUrlIndices = findExternalFontFaceUrls(parsedFontFaceSources);\n\n        if (externalFontFaceUrlIndices.length > 0) {\n            externalFontFaceUrlIndices.forEach(function (fontFaceUrlIndex) {\n                var relativeUrl = parsedFontFaceSources[fontFaceUrlIndex].url,\n                    url = util.joinUrl(baseUrl, relativeUrl);\n\n                parsedFontFaceSources[fontFaceUrlIndex].url = url;\n            });\n\n            cssSupport.changeFontFaceRuleSrc(cssRules, rule, fontFaceSrcValueParser.serialize(parsedFontFaceSources));\n\n            change = true;\n        }\n    });\n    findCSSImportRules(cssRules).forEach(function (rule) {\n        var cssUrl = rule.href,\n            url = util.joinUrl(baseUrl, cssUrl);\n\n        cssSupport.exchangeRule(cssRules, rule, \"@import url(\" + url + \");\");\n\n        change = true;\n    });\n\n    return change;\n};\n\n/* CSS import inlining */\n\nvar substituteRule = function (cssRules, rule, newCssRules) {\n    var position = cssRules.indexOf(rule);\n\n    cssRules.splice(position, 1);\n\n    newCssRules.forEach(function (newRule, i) {\n        cssRules.splice(position + i, 0, newRule);\n    });\n};\n\nvar fulfilledPromise = function (value) {\n    var defer = ayepromise.defer();\n    defer.resolve(value);\n    return defer.promise;\n};\n\nvar loadAndInlineCSSImport = function (cssRules, rule, alreadyLoadedCssUrls, options) {\n    var url = rule.href,\n        cssHrefRelativeToDoc;\n\n    url = cssSupport.unquoteString(url);\n\n    cssHrefRelativeToDoc = util.joinUrl(options.baseUrl, url);\n\n    if (alreadyLoadedCssUrls.indexOf(cssHrefRelativeToDoc) >= 0) {\n        // Remove URL by adding empty string\n        substituteRule(cssRules, rule, []);\n        return fulfilledPromise([]);\n    } else {\n        alreadyLoadedCssUrls.push(cssHrefRelativeToDoc);\n    }\n\n    return util.ajax(url, options)\n        .then(function (cssText) {\n            var externalCssRules = cssSupport.rulesForCssText(cssText);\n\n            // Recursively follow @import statements\n            return exports.loadCSSImportsForRules(externalCssRules, alreadyLoadedCssUrls, options)\n                .then(function (result) {\n                    exports.adjustPathsOfCssResources(url, externalCssRules);\n\n                    substituteRule(cssRules, rule, externalCssRules);\n\n                    return result.errors;\n                });\n        }, function (e) {\n            throw {\n                resourceType: \"stylesheet\",\n                url: e.url,\n                msg: \"Unable to load stylesheet \" + e.url\n            };\n        });\n};\n\nexports.loadCSSImportsForRules = function (cssRules, alreadyLoadedCssUrls, options) {\n    var rulesToInline = findCSSImportRules(cssRules),\n        errors = [],\n        hasChanges = false;\n\n    return util.all(rulesToInline.map(function (rule) {\n        return loadAndInlineCSSImport(cssRules, rule, alreadyLoadedCssUrls, options).then(function (moreErrors) {\n            errors = errors.concat(moreErrors);\n\n            hasChanges = true;\n        }, function (e) {\n            errors.push(e);\n        });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\n/* CSS linked resource inlining */\n\nvar loadAndInlineBackgroundImages = function (backgroundValue, options) {\n    var parsedBackground = backgroundValueParser.parse(backgroundValue),\n        externalBackgroundLayerIndices = findExternalBackgroundUrls(parsedBackground),\n        hasChanges = false;\n\n    return util.collectAndReportErrors(externalBackgroundLayerIndices.map(function (backgroundLayerIndex) {\n        var url = parsedBackground[backgroundLayerIndex].url;\n\n        return util.getDataURIForImageURL(url, options)\n            .then(function (dataURI) {\n                parsedBackground[backgroundLayerIndex].url = dataURI;\n\n                hasChanges = true;\n            }, function (e) {\n                throw {\n                    resourceType: \"backgroundImage\",\n                    url: e.url,\n                    msg: \"Unable to load background-image \" + e.url\n                };\n            });\n    })).then(function (errors) {\n        return {\n            backgroundValue: backgroundValueParser.serialize(parsedBackground),\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar iterateOverRulesAndInlineBackgroundImages = function (cssRules, options) {\n    var rulesToInline = findBackgroundImageRules(cssRules),\n        backgroundDeclarations = findBackgroundDeclarations(rulesToInline),\n        errors = [],\n        cssHasChanges = false;\n\n    return util.all(backgroundDeclarations.map(function (declaration) {\n        return loadAndInlineBackgroundImages(declaration.value, options)\n            .then(function (result) {\n                if (result.hasChanges) {\n                    updateCssPropertyValue(declaration.rule, declaration.property, result.backgroundValue);\n\n                    cssHasChanges = true;\n                }\n\n                errors = errors.concat(result.errors);\n            });\n    })).then(function () {\n        return {\n            hasChanges: cssHasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar loadAndInlineFontFace = function (srcDeclarationValue, options) {\n    var hasChanges = false,\n        parsedFontFaceSources, externalFontFaceUrlIndices;\n\n    try {\n        parsedFontFaceSources = fontFaceSrcValueParser.parse(srcDeclarationValue);\n    } catch (e) {\n        parsedFontFaceSources = [];\n    }\n    externalFontFaceUrlIndices = findExternalFontFaceUrls(parsedFontFaceSources);\n\n    return util.collectAndReportErrors(externalFontFaceUrlIndices.map(function (urlIndex) {\n        var fontSrc = parsedFontFaceSources[urlIndex],\n            format = fontSrc.format || \"woff\";\n\n        return util.binaryAjax(fontSrc.url, options)\n            .then(function (content) {\n                var base64Content = btoa(content);\n                fontSrc.url = 'data:font/' + format + ';base64,' + base64Content;\n\n                hasChanges = true;\n            }, function (e) {\n                throw {\n                    resourceType: \"fontFace\",\n                    url: e.url,\n                    msg: \"Unable to load font-face \" + e.url\n                };\n            });\n    })).then(function (errors) {\n        return {\n            srcDeclarationValue: fontFaceSrcValueParser.serialize(parsedFontFaceSources),\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar iterateOverRulesAndInlineFontFace = function (cssRules, options) {\n    var rulesToInline = findFontFaceRules(cssRules),\n        errors = [],\n        hasChanges = false;\n\n    return util.all(rulesToInline.map(function (rule) {\n        var srcDeclarationValue = rule.style.getPropertyValue(\"src\");\n\n        return loadAndInlineFontFace(srcDeclarationValue, options).then(function (result) {\n            if (result.hasChanges) {\n                cssSupport.changeFontFaceRuleSrc(cssRules, rule, result.srcDeclarationValue);\n\n                hasChanges = true;\n            }\n\n            errors = errors.concat(result.errors);\n        });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nexports.loadAndInlineCSSResourcesForRules = function (cssRules, options) {\n    var hasChanges = false,\n        errors = [];\n\n    return util.all([iterateOverRulesAndInlineBackgroundImages, iterateOverRulesAndInlineFontFace].map(function (func) {\n        return func(cssRules, options)\n            .then(function (result) {\n                hasChanges = hasChanges || result.hasChanges;\n                errors = errors.concat(result.errors);\n            });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n","\"use strict\";\n\nvar cssom = require('cssom');\n\n\nexports.unquoteString = function (quotedUrl) {\n    var doubleQuoteRegex = /^\"(.*)\"$/,\n        singleQuoteRegex = /^'(.*)'$/;\n\n    if (doubleQuoteRegex.test(quotedUrl)) {\n        return quotedUrl.replace(doubleQuoteRegex, \"$1\");\n    } else {\n        if (singleQuoteRegex.test(quotedUrl)) {\n            return quotedUrl.replace(singleQuoteRegex, \"$1\");\n        } else {\n            return quotedUrl;\n        }\n    }\n};\n\nvar rulesForCssTextFromBrowser = function (styleContent) {\n    var doc = document.implementation.createHTMLDocument(\"\"),\n        styleElement = document.createElement(\"style\"),\n        rules;\n\n    styleElement.textContent = styleContent;\n    // the style will only be parsed once it is added to a document\n    doc.body.appendChild(styleElement);\n    rules = styleElement.sheet.cssRules;\n\n    return Array.prototype.slice.call(rules);\n};\n\nvar browserHasBackgroundImageUrlIssue = (function () {\n    // Checks for http://code.google.com/p/chromium/issues/detail?id=161644\n    var rules = rulesForCssTextFromBrowser('a{background:url(i)}');\n    return !rules.length || rules[0].cssText.indexOf('url()') >= 0;\n}());\n\nexports.rulesForCssText = function (styleContent) {\n    if (browserHasBackgroundImageUrlIssue && cssom.parse) {\n        return cssom.parse(styleContent).cssRules;\n    } else {\n        return rulesForCssTextFromBrowser(styleContent);\n    }\n};\n\nexports.cssRulesToText = function (cssRules) {\n    return cssRules.reduce(function (cssText, rule) {\n        return cssText + rule.cssText;\n    }, '');\n};\n\nexports.exchangeRule = function (cssRules, rule, newRuleText) {\n    var ruleIdx = cssRules.indexOf(rule),\n        styleSheet = rule.parentStyleSheet;\n\n    // Generate a new rule\n    styleSheet.insertRule(newRuleText, ruleIdx+1);\n    styleSheet.deleteRule(ruleIdx);\n    // Exchange with the new\n    cssRules[ruleIdx] = styleSheet.cssRules[ruleIdx];\n};\n\n// Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=443978\nexports.changeFontFaceRuleSrc = function (cssRules, rule, newSrc) {\n    var newRuleText = '@font-face { font-family: ' + rule.style.getPropertyValue(\"font-family\") + '; ';\n\n    if (rule.style.getPropertyValue(\"font-style\")) {\n        newRuleText += 'font-style: ' + rule.style.getPropertyValue(\"font-style\") + '; ';\n    }\n\n    if (rule.style.getPropertyValue(\"font-weight\")) {\n        newRuleText += 'font-weight: ' + rule.style.getPropertyValue(\"font-weight\") + '; ';\n    }\n\n    newRuleText += 'src: ' + newSrc + '}';\n    exports.exchangeRule(cssRules, rule, newRuleText);\n};\n","// Simple, stupid \"background\"/\"background-image\" value parser that just aims at exposing the image URLs\n\"use strict\";\n\nvar cssSupport = require('./cssSupport');\n\n\nvar trimCSSWhitespace = function (url) {\n    var whitespaceRegex = /^[\\t\\r\\f\\n ]*(.+?)[\\t\\r\\f\\n ]*$/;\n\n    return url.replace(whitespaceRegex, \"$1\");\n};\n\n// TODO exporting this for the sake of unit testing. Should rather test the background value parser explicitly.\nexports.extractCssUrl = function (cssUrl) {\n    var urlRegex = /^url\\(([^\\)]+)\\)/,\n        quotedUrl;\n\n    if (!urlRegex.test(cssUrl)) {\n        throw new Error(\"Invalid url\");\n    }\n\n    quotedUrl = urlRegex.exec(cssUrl)[1];\n    return cssSupport.unquoteString(trimCSSWhitespace(quotedUrl));\n};\n\nvar sliceBackgroundDeclaration = function (backgroundDeclarationText) {\n    var functionParamRegexS = \"\\\\s*(?:\\\"[^\\\"]*\\\"|'[^']*'|[^\\\\(]+)\\\\s*\",\n        valueRegexS = \"(\" + \"url\\\\(\" + functionParamRegexS + \"\\\\)\" + \"|\" + \"[^,\\\\s]+\" + \")\",\n        simpleSingularBackgroundRegexS = \"(?:\\\\s*\" + valueRegexS + \")+\",\n        simpleBackgroundRegexS = \"^\\\\s*(\" + simpleSingularBackgroundRegexS + \")\" +\n                                  \"(?:\\\\s*,\\\\s*(\" + simpleSingularBackgroundRegexS + \"))*\" +\n                                  \"\\\\s*$\",\n        simpleSingularBackgroundRegex = new RegExp(simpleSingularBackgroundRegexS, \"g\"),\n        outerRepeatedMatch,\n        backgroundLayers = [],\n        getValues = function (singularBackgroundDeclaration) {\n            var valueRegex = new RegExp(valueRegexS, \"g\"),\n                backgroundValues = [],\n                repeatedMatch;\n\n            repeatedMatch = valueRegex.exec(singularBackgroundDeclaration);\n            while (repeatedMatch) {\n                backgroundValues.push(repeatedMatch[1]);\n                repeatedMatch = valueRegex.exec(singularBackgroundDeclaration);\n            }\n            return backgroundValues;\n        };\n\n    if (backgroundDeclarationText.match(new RegExp(simpleBackgroundRegexS))) {\n        outerRepeatedMatch = simpleSingularBackgroundRegex.exec(backgroundDeclarationText);\n        while (outerRepeatedMatch) {\n            backgroundLayers.push(getValues(outerRepeatedMatch[0]));\n            outerRepeatedMatch = simpleSingularBackgroundRegex.exec(backgroundDeclarationText);\n        }\n\n        return backgroundLayers;\n    }\n    return [];\n};\n\nvar findBackgroundImageUrlInValues = function (values) {\n    var i, url;\n\n    for(i = 0; i < values.length; i++) {\n        try {\n            url = exports.extractCssUrl(values[i]);\n            return {\n                url: url,\n                idx: i\n            };\n        } catch (e) {}\n    }\n};\n\nexports.parse = function (backgroundValue) {\n    var backgroundLayers = sliceBackgroundDeclaration(backgroundValue);\n\n    return backgroundLayers.map(function (backgroundLayerValues) {\n        var urlMatch = findBackgroundImageUrlInValues(backgroundLayerValues);\n\n        if (urlMatch) {\n            return {\n                preUrl: backgroundLayerValues.slice(0, urlMatch.idx),\n                url: urlMatch.url,\n                postUrl: backgroundLayerValues.slice(urlMatch.idx+1),\n            };\n        } else {\n            return {\n                preUrl: backgroundLayerValues\n            };\n        }\n    });\n};\n\nexports.serialize = function (parsedBackground) {\n    var backgroundLayers = parsedBackground.map(function (backgroundLayer) {\n        var values = [].concat(backgroundLayer.preUrl);\n\n        if (backgroundLayer.url) {\n            values.push('url(\"' + backgroundLayer.url + '\")');\n        }\n        if (backgroundLayer.postUrl) {\n            values = values.concat(backgroundLayer.postUrl);\n        }\n\n        return values.join(' ');\n    });\n\n    return backgroundLayers.join(', ');\n};\n","var grammar = require('./grammar');\n\n\nexports.SyntaxError = function (message, offset) {\n    this.message  = message;\n    this.offset   = offset;\n};\n\nexports.parse = function (fontFaceSourceValue) {\n    try {\n        return grammar.parse(fontFaceSourceValue);\n    } catch (e) {\n        throw new exports.SyntaxError(e.message, e.offset);\n    }\n};\n\nexports.serialize = function (parsedFontFaceSources) {\n    return parsedFontFaceSources.map(function (sourceItem) {\n        var itemValue;\n\n        if (sourceItem.url) {\n            itemValue = 'url(\"' + sourceItem.url + '\")';\n            if (sourceItem.format) {\n                itemValue += ' format(\"' + sourceItem.format + '\")';\n            }\n        } else {\n            itemValue = 'local(\"' + sourceItem.local + '\")';\n        }\n        return itemValue;\n    }).join(', ');\n};\n","'use strict';\n\nexports.CSSStyleDeclaration = require('./CSSStyleDeclaration').CSSStyleDeclaration;\nexports.CSSRule = require('./CSSRule').CSSRule;\nexports.CSSStyleRule = require('./CSSStyleRule').CSSStyleRule;\nexports.MediaList = require('./MediaList').MediaList;\nexports.CSSMediaRule = require('./CSSMediaRule').CSSMediaRule;\nexports.CSSImportRule = require('./CSSImportRule').CSSImportRule;\nexports.CSSFontFaceRule = require('./CSSFontFaceRule').CSSFontFaceRule;\nexports.StyleSheet = require('./StyleSheet').StyleSheet;\nexports.CSSStyleSheet = require('./CSSStyleSheet').CSSStyleSheet;\nexports.CSSKeyframesRule = require('./CSSKeyframesRule').CSSKeyframesRule;\nexports.CSSKeyframeRule = require('./CSSKeyframeRule').CSSKeyframeRule;\nexports.MatcherList = require('./MatcherList').MatcherList;\nexports.CSSDocumentRule = require('./CSSDocumentRule').CSSDocumentRule;\nexports.CSSValue = require('./CSSValue').CSSValue;\nexports.CSSValueExpression = require('./CSSValueExpression').CSSValueExpression;\nexports.parse = require('./parse').parse;\nexports.clone = require('./clone').clone;\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration\n */\nCSSOM.CSSStyleDeclaration = function CSSStyleDeclaration(){\n\tthis.length = 0;\n\tthis.parentRule = null;\n\n\t// NON-STANDARD\n\tthis._importants = {};\n};\n\n\nCSSOM.CSSStyleDeclaration.prototype = {\n\n\tconstructor: CSSOM.CSSStyleDeclaration,\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-getPropertyValue\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set.\n\t */\n\tgetPropertyValue: function(name) {\n\t\treturn this[name] || \"\";\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @param {string} value\n\t * @param {string} [priority=null] \"important\" or null\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-setProperty\n\t */\n\tsetProperty: function(name, value, priority) {\n\t\tif (this[name]) {\n\t\t\t// Property already exist. Overwrite it.\n\t\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\t\tif (index < 0) {\n\t\t\t\tthis[this.length] = name;\n\t\t\t\tthis.length++;\n\t\t\t}\n\t\t} else {\n\t\t\t// New property.\n\t\t\tthis[this.length] = name;\n\t\t\tthis.length++;\n\t\t}\n\t\tthis[name] = value;\n\t\tthis._importants[name] = priority;\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-removeProperty\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set or the property name does not correspond to a known CSS property.\n\t */\n\tremoveProperty: function(name) {\n\t\tif (!(name in this)) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\tif (index < 0) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar prevValue = this[name];\n\t\tthis[name] = \"\";\n\n\t\t// That's what WebKit and Opera do\n\t\tArray.prototype.splice.call(this, index, 1);\n\n\t\t// That's what Firefox does\n\t\t//this[index] = \"\"\n\n\t\treturn prevValue;\n\t},\n\n\tgetPropertyCSSValue: function() {\n\t\t//FIXME\n\t},\n\n\t/**\n\t *\n\t * @param {String} name\n\t */\n\tgetPropertyPriority: function(name) {\n\t\treturn this._importants[name] || \"\";\n\t},\n\n\n\t/**\n\t *   element.style.overflow = \"auto\"\n\t *   element.style.getPropertyShorthand(\"overflow-x\")\n\t *   -> \"overflow\"\n\t */\n\tgetPropertyShorthand: function() {\n\t\t//FIXME\n\t},\n\n\tisPropertyImplicit: function() {\n\t\t//FIXME\n\t},\n\n\t// Doesn't work in IE < 9\n\tget cssText(){\n\t\tvar properties = [];\n\t\tfor (var i=0, length=this.length; i < length; ++i) {\n\t\t\tvar name = this[i];\n\t\t\tvar value = this.getPropertyValue(name);\n\t\t\tvar priority = this.getPropertyPriority(name);\n\t\t\tif (priority) {\n\t\t\t\tpriority = \" !\" + priority;\n\t\t\t}\n\t\t\tproperties[i] = name + \": \" + value + priority + \";\";\n\t\t}\n\t\treturn properties.join(\" \");\n\t},\n\n\tset cssText(cssText){\n\t\tvar i, name;\n\t\tfor (i = this.length; i--;) {\n\t\t\tname = this[i];\n\t\t\tthis[name] = \"\";\n\t\t}\n\t\tArray.prototype.splice.call(this, 0, this.length);\n\t\tthis._importants = {};\n\n\t\tvar dummyRule = CSSOM.parse('#bogus{' + cssText + '}').cssRules[0].style;\n\t\tvar length = dummyRule.length;\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\tname = dummyRule[i];\n\t\t\tthis.setProperty(dummyRule[i], dummyRule.getPropertyValue(name), dummyRule.getPropertyPriority(name));\n\t\t}\n\t}\n};\n\n\n//.CommonJS\nexports.CSSStyleDeclaration = CSSOM.CSSStyleDeclaration;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleDeclaration.js\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-cssrule-interface\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSRule\n */\nCSSOM.CSSRule = function CSSRule() {\n\tthis.parentRule = null;\n\tthis.parentStyleSheet = null;\n};\n\nCSSOM.CSSRule.STYLE_RULE = 1;\nCSSOM.CSSRule.IMPORT_RULE = 3;\nCSSOM.CSSRule.MEDIA_RULE = 4;\nCSSOM.CSSRule.FONT_FACE_RULE = 5;\nCSSOM.CSSRule.PAGE_RULE = 6;\nCSSOM.CSSRule.WEBKIT_KEYFRAMES_RULE = 8;\nCSSOM.CSSRule.WEBKIT_KEYFRAME_RULE = 9;\n\n// Obsolete in CSSOM http://dev.w3.org/csswg/cssom/\n//CSSOM.CSSRule.UNKNOWN_RULE = 0;\n//CSSOM.CSSRule.CHARSET_RULE = 2;\n\n// Never implemented\n//CSSOM.CSSRule.VARIABLES_RULE = 7;\n\nCSSOM.CSSRule.prototype = {\n\tconstructor: CSSOM.CSSRule\n\t//FIXME\n};\n\n\n//.CommonJS\nexports.CSSRule = CSSOM.CSSRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssstylerule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleRule\n */\nCSSOM.CSSStyleRule = function CSSStyleRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.selectorText = \"\";\n\tthis.style = new CSSOM.CSSStyleDeclaration;\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSStyleRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSStyleRule.prototype.constructor = CSSOM.CSSStyleRule;\nCSSOM.CSSStyleRule.prototype.type = 1;\n\nObject.defineProperty(CSSOM.CSSStyleRule.prototype, \"cssText\", {\n\tget: function() {\n\t\tvar text;\n\t\tif (this.selectorText) {\n\t\t\ttext = this.selectorText + \" {\" + this.style.cssText + \"}\";\n\t\t} else {\n\t\t\ttext = \"\";\n\t\t}\n\t\treturn text;\n\t},\n\tset: function(cssText) {\n\t\tvar rule = CSSOM.CSSStyleRule.parse(cssText);\n\t\tthis.style = rule.style;\n\t\tthis.selectorText = rule.selectorText;\n\t}\n});\n\n\n/**\n * NON-STANDARD\n * lightweight version of parse.js.\n * @param {string} ruleText\n * @return CSSStyleRule\n */\nCSSOM.CSSStyleRule.parse = function(ruleText) {\n\tvar i = 0;\n\tvar state = \"selector\";\n\tvar index;\n\tvar j = i;\n\tvar buffer = \"\";\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true\n\t};\n\n\tvar styleRule = new CSSOM.CSSStyleRule;\n\tvar selector, name, value, priority=\"\";\n\n\tfor (var character; character = ruleText.charAt(i); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\t// Squash 2 or more white-spaces in the row into 1\n\t\t\t\tswitch (ruleText.charAt(i - 1)) {\n\t\t\t\t\tcase \" \":\n\t\t\t\t\tcase \"\\t\":\n\t\t\t\t\tcase \"\\r\":\n\t\t\t\t\tcase \"\\n\":\n\t\t\t\t\tcase \"\\f\":\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbuffer += \" \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf('\"', j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow '\" is missing';\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf(\"'\", j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow \"' is missing\";\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (ruleText.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = ruleText.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tthrow new SyntaxError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && ruleText.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t} else if (state === \"name\") {\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tstate = \"selector\";\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\t}\n\t}\n\n\treturn styleRule;\n\n};\n\n\n//.CommonJS\nexports.CSSStyleRule = CSSOM.CSSStyleRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-medialist-interface\n */\nCSSOM.MediaList = function MediaList(){\n\tthis.length = 0;\n};\n\nCSSOM.MediaList.prototype = {\n\n\tconstructor: CSSOM.MediaList,\n\n\t/**\n\t * @return {string}\n\t */\n\tget mediaText() {\n\t\treturn Array.prototype.join.call(this, \", \");\n\t},\n\n\t/**\n\t * @param {string} value\n\t */\n\tset mediaText(value) {\n\t\tvar values = value.split(\",\");\n\t\tvar length = this.length = values.length;\n\t\tfor (var i=0; i<length; i++) {\n\t\t\tthis[i] = values[i].trim();\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tappendMedium: function(medium) {\n\t\tif (Array.prototype.indexOf.call(this, medium) === -1) {\n\t\t\tthis[this.length] = medium;\n\t\t\tthis.length++;\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tdeleteMedium: function(medium) {\n\t\tvar index = Array.prototype.indexOf.call(this, medium);\n\t\tif (index !== -1) {\n\t\t\tArray.prototype.splice.call(this, index, 1);\n\t\t}\n\t}\n\n};\n\n\n//.CommonJS\nexports.MediaList = CSSOM.MediaList;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssmediarule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSMediaRule\n */\nCSSOM.CSSMediaRule = function CSSMediaRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.media = new CSSOM.MediaList;\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSMediaRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSMediaRule.prototype.constructor = CSSOM.CSSMediaRule;\nCSSOM.CSSMediaRule.prototype.type = 4;\n//FIXME\n//CSSOM.CSSMediaRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSMediaRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://opensource.apple.com/source/WebCore/WebCore-658.28/css/CSSMediaRule.cpp\nObject.defineProperty(CSSOM.CSSMediaRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n      cssTexts.push(this.cssRules[i].cssText);\n    }\n    return \"@media \" + this.media.mediaText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSMediaRule = CSSOM.CSSMediaRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssimportrule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSImportRule\n */\nCSSOM.CSSImportRule = function CSSImportRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.href = \"\";\n\tthis.media = new CSSOM.MediaList;\n\tthis.styleSheet = new CSSOM.CSSStyleSheet;\n};\n\nCSSOM.CSSImportRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSImportRule.prototype.constructor = CSSOM.CSSImportRule;\nCSSOM.CSSImportRule.prototype.type = 3;\n\nObject.defineProperty(CSSOM.CSSImportRule.prototype, \"cssText\", {\n  get: function() {\n    var mediaText = this.media.mediaText;\n    return \"@import url(\" + this.href + \")\" + (mediaText ? \" \" + mediaText : \"\") + \";\";\n  },\n  set: function(cssText) {\n    var i = 0;\n\n    /**\n     * @import url(partial.css) screen, handheld;\n     *        ||               |\n     *        after-import     media\n     *         |\n     *         url\n     */\n    var state = '';\n\n    var buffer = '';\n    var index;\n    var mediaText = '';\n    for (var character; character = cssText.charAt(i); i++) {\n\n      switch (character) {\n        case ' ':\n        case '\\t':\n        case '\\r':\n        case '\\n':\n        case '\\f':\n          if (state === 'after-import') {\n            state = 'url';\n          } else {\n            buffer += character;\n          }\n          break;\n\n        case '@':\n          if (!state && cssText.indexOf('@import', i) === i) {\n            state = 'after-import';\n            i += 'import'.length;\n            buffer = '';\n          }\n          break;\n\n        case 'u':\n          if (state === 'url' && cssText.indexOf('url(', i) === i) {\n            index = cssText.indexOf(')', i + 1);\n            if (index === -1) {\n              throw i + ': \")\" not found';\n            }\n            i += 'url('.length;\n            var url = cssText.slice(i, index);\n            if (url[0] === url[url.length - 1]) {\n              if (url[0] === '\"' || url[0] === \"'\") {\n                url = url.slice(1, -1);\n              }\n            }\n            this.href = url;\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case '\"':\n          if (state === 'url') {\n            index = cssText.indexOf('\"', i + 1);\n            if (!index) {\n              throw i + \": '\\\"' not found\";\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case \"'\":\n          if (state === 'url') {\n            index = cssText.indexOf(\"'\", i + 1);\n            if (!index) {\n              throw i + ': \"\\'\" not found';\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case ';':\n          if (state === 'media') {\n            if (buffer) {\n              this.media.mediaText = buffer.trim();\n            }\n          }\n          break;\n\n        default:\n          if (state === 'media') {\n            buffer += character;\n          }\n          break;\n      }\n    }\n  }\n});\n\n\n//.CommonJS\nexports.CSSImportRule = CSSOM.CSSImportRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#css-font-face-rule\n */\nCSSOM.CSSFontFaceRule = function CSSFontFaceRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.style = new CSSOM.CSSStyleDeclaration;\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSFontFaceRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSFontFaceRule.prototype.constructor = CSSOM.CSSFontFaceRule;\nCSSOM.CSSFontFaceRule.prototype.type = 5;\n//FIXME\n//CSSOM.CSSFontFaceRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSFontFaceRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSFontFaceRule.cpp\nObject.defineProperty(CSSOM.CSSFontFaceRule.prototype, \"cssText\", {\n  get: function() {\n    return \"@font-face {\" + this.style.cssText + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSFontFaceRule = CSSOM.CSSFontFaceRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-stylesheet-interface\n */\nCSSOM.StyleSheet = function StyleSheet() {\n\tthis.parentStyleSheet = null;\n};\n\n\n//.CommonJS\nexports.StyleSheet = CSSOM.StyleSheet;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tStyleSheet: require(\"./StyleSheet\").StyleSheet,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet\n */\nCSSOM.CSSStyleSheet = function CSSStyleSheet() {\n\tCSSOM.StyleSheet.call(this);\n\tthis.cssRules = [];\n};\n\n\nCSSOM.CSSStyleSheet.prototype = new CSSOM.StyleSheet;\nCSSOM.CSSStyleSheet.prototype.constructor = CSSOM.CSSStyleSheet;\n\n\n/**\n * Used to insert a new rule into the style sheet. The new rule now becomes part of the cascade.\n *\n *   sheet = new Sheet(\"body {margin: 0}\")\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *   sheet.insertRule(\"img {border: none}\", 0)\n *   -> 0\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *\n * @param {string} rule\n * @param {number} index\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-insertRule\n * @return {number} The index within the style sheet's rule collection of the newly inserted rule.\n */\nCSSOM.CSSStyleSheet.prototype.insertRule = function(rule, index) {\n\tif (index < 0 || index > this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tvar cssRule = CSSOM.parse(rule).cssRules[0];\n\tcssRule.parentStyleSheet = this;\n\tthis.cssRules.splice(index, 0, cssRule);\n\treturn index;\n};\n\n\n/**\n * Used to delete a rule from the style sheet.\n *\n *   sheet = new Sheet(\"img{border:none} body{margin:0}\")\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *   sheet.deleteRule(0)\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *\n * @param {number} index within the style sheet's rule list of the rule to remove.\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-deleteRule\n */\nCSSOM.CSSStyleSheet.prototype.deleteRule = function(index) {\n\tif (index < 0 || index >= this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tthis.cssRules.splice(index, 1);\n};\n\n\n/**\n * NON-STANDARD\n * @return {string} serialize stylesheet\n */\nCSSOM.CSSStyleSheet.prototype.toString = function() {\n\tvar result = \"\";\n\tvar rules = this.cssRules;\n\tfor (var i=0; i<rules.length; i++) {\n\t\tresult += rules[i].cssText + \"\\n\";\n\t}\n\treturn result;\n};\n\n\n//.CommonJS\nexports.CSSStyleSheet = CSSOM.CSSStyleSheet;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleSheet.js\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframesRule\n */\nCSSOM.CSSKeyframesRule = function CSSKeyframesRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.name = '';\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSKeyframesRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSKeyframesRule.prototype.constructor = CSSOM.CSSKeyframesRule;\nCSSOM.CSSKeyframesRule.prototype.type = 8;\n//FIXME\n//CSSOM.CSSKeyframesRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframesRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframesRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframesRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n      cssTexts.push(\"  \" + this.cssRules[i].cssText);\n    }\n    return \"@\" + (this._vendorPrefix || '') + \"keyframes \" + this.name + \" { \\n\" + cssTexts.join(\"\\n\") + \"\\n}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframesRule = CSSOM.CSSKeyframesRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleDeclaration: require('./CSSStyleDeclaration').CSSStyleDeclaration\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframeRule\n */\nCSSOM.CSSKeyframeRule = function CSSKeyframeRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.keyText = '';\n\tthis.style = new CSSOM.CSSStyleDeclaration;\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSKeyframeRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSKeyframeRule.prototype.constructor = CSSOM.CSSKeyframeRule;\nCSSOM.CSSKeyframeRule.prototype.type = 9;\n//FIXME\n//CSSOM.CSSKeyframeRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframeRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframeRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframeRule.prototype, \"cssText\", {\n  get: function() {\n    return this.keyText + \" {\" + this.style.cssText + \"} \";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframeRule = CSSOM.CSSKeyframeRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.MatcherList = function MatcherList(){\n    this.length = 0;\n};\n\nCSSOM.MatcherList.prototype = {\n\n    constructor: CSSOM.MatcherList,\n\n    /**\n     * @return {string}\n     */\n    get matcherText() {\n        return Array.prototype.join.call(this, \", \");\n    },\n\n    /**\n     * @param {string} value\n     */\n    set matcherText(value) {\n        // just a temporary solution, actually it may be wrong by just split the value with ',', because a url can include ','.\n        var values = value.split(\",\");\n        var length = this.length = values.length;\n        for (var i=0; i<length; i++) {\n            this[i] = values[i].trim();\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    appendMatcher: function(matcher) {\n        if (Array.prototype.indexOf.call(this, matcher) === -1) {\n            this[this.length] = matcher;\n            this.length++;\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    deleteMatcher: function(matcher) {\n        var index = Array.prototype.indexOf.call(this, matcher);\n        if (index !== -1) {\n            Array.prototype.splice.call(this, index, 1);\n        }\n    }\n\n};\n\n\n//.CommonJS\nexports.MatcherList = CSSOM.MatcherList;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n    CSSRule: require(\"./CSSRule\").CSSRule,\n    MatcherList: require(\"./MatcherList\").MatcherList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.CSSDocumentRule = function CSSDocumentRule() {\n    CSSOM.CSSRule.call(this);\n    this.matcher = new CSSOM.MatcherList;\n    this.cssRules = [];\n};\n\nCSSOM.CSSDocumentRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSDocumentRule.prototype.constructor = CSSOM.CSSDocumentRule;\nCSSOM.CSSDocumentRule.prototype.type = 10;\n//FIXME\n//CSSOM.CSSDocumentRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSDocumentRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\nObject.defineProperty(CSSOM.CSSDocumentRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n        cssTexts.push(this.cssRules[i].cssText);\n    }\n    return \"@-moz-document \" + this.matcher.matcherText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSDocumentRule = CSSOM.CSSDocumentRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n *\n * TODO: add if needed\n */\nCSSOM.CSSValue = function CSSValue() {\n};\n\nCSSOM.CSSValue.prototype = {\n\tconstructor: CSSOM.CSSValue,\n\n\t// @see: http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n\tset cssText(text) {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Exception('DOMException: property \"cssText\" of \"' + name + '\" is readonly!');\n\t},\n\n\tget cssText() {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Exception('getter \"cssText\" of \"' + name + '\" is not implemented!');\n\t},\n\n\t_getConstructorName: function() {\n\t\tvar s = this.constructor.toString(),\n\t\t\t\tc = s.match(/function\\s([^\\(]+)/),\n\t\t\t\tname = c[1];\n\n\t\treturn name;\n\t}\n};\n\n\n//.CommonJS\nexports.CSSValue = CSSOM.CSSValue;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSValue: require('./CSSValue').CSSValue\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://msdn.microsoft.com/en-us/library/ms537634(v=vs.85).aspx\n *\n */\nCSSOM.CSSValueExpression = function CSSValueExpression(token, idx) {\n\tthis._token = token;\n\tthis._idx = idx;\n};\n\nCSSOM.CSSValueExpression.prototype = new CSSOM.CSSValue;\nCSSOM.CSSValueExpression.prototype.constructor = CSSOM.CSSValueExpression;\n\n/**\n * parse css expression() value\n *\n * @return {Object}\n *\t\t\t\t - error:\n *\t\t\t\t or\n *\t\t\t\t - idx:\n *\t\t\t\t - expression:\n *\n * Example:\n *\n * .selector {\n *\t\tzoom: expression(documentElement.clientWidth > 1000 ? '1000px' : 'auto');\n * }\n */\nCSSOM.CSSValueExpression.prototype.parse = function() {\n\tvar token = this._token,\n\t\t\tidx = this._idx;\n\n\tvar character = '',\n\t\t\texpression = '',\n\t\t\terror = '',\n\t\t\tinfo,\n\t\t\tparen = [];\n\n\n\tfor (; ; ++idx) {\n\t\tcharacter = token.charAt(idx);\n\n\t\t// end of token\n\t\tif (character == '') {\n\t\t\terror = 'css expression error: unfinished expression!';\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch(character) {\n\t\t\tcase '(':\n\t\t\t\tparen.push(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase ')':\n\t\t\t\tparen.pop(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase '/':\n\t\t\t\tif (info = this._parseJSComment(token, idx)) { // comment?\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\terror = 'css expression error: unfinished comment in expression!';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tidx = info.idx;\n\t\t\t\t\t\t// ignore the comment\n\t\t\t\t\t}\n\t\t\t\t} else if (info = this._parseJSRexExp(token, idx)) { // regexp\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else { // other\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"'\":\n\t\t\tcase '\"':\n\t\t\t\tinfo = this._parseJSString(token, idx, character);\n\t\t\t\tif (info) { // string\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else {\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (error) {\n\t\t\tbreak;\n\t\t}\n\n\t\t// end of expression\n\t\tif (paren.length == 0) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tvar ret;\n\tif (error) {\n\t\tret = {\n\t\t\terror: error\n\t\t}\n\t} else {\n\t\tret = {\n\t\t\tidx: idx,\n\t\t\texpression: expression\n\t\t}\n\t}\n\n\treturn ret;\n};\n\n\n/**\n *\n * @return {Object|false}\n *          - idx:\n *          - text:\n *          or\n *          - error:\n *          or\n *          false\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSComment = function(token, idx) {\n\tvar nextChar = token.charAt(idx + 1),\n\t\t\ttext;\n\n\tif (nextChar == '/' || nextChar == '*') {\n\t\tvar startIdx = idx,\n\t\t\t\tendIdx,\n\t\t\t\tcommentEndChar;\n\n\t\tif (nextChar == '/') { // line comment\n\t\t\tcommentEndChar = '\\n';\n\t\t} else if (nextChar == '*') { // block comment\n\t\t\tcommentEndChar = '*/';\n\t\t}\n\n\t\tendIdx = token.indexOf(commentEndChar, startIdx + 1 + 1);\n\t\tif (endIdx !== -1) {\n\t\t\tendIdx = endIdx + commentEndChar.length - 1;\n\t\t\ttext = token.substring(idx, endIdx + 1);\n\t\t\treturn {\n\t\t\t\tidx: endIdx,\n\t\t\t\ttext: text\n\t\t\t}\n\t\t} else {\n\t\t\terror = 'css expression error: unfinished comment in expression!';\n\t\t\treturn {\n\t\t\t\terror: error\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn false;\n\t}\n};\n\n\n/**\n *\n * @return {Object|false}\n *\t\t\t\t\t- idx:\n *\t\t\t\t\t- text:\n *\t\t\t\t\tor \n *\t\t\t\t\tfalse\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSString = function(token, idx, sep) {\n\tvar endIdx = this._findMatchedIdx(token, idx, sep),\n\t\t\ttext;\n\n\tif (endIdx === -1) {\n\t\treturn false;\n\t} else {\n\t\ttext = token.substring(idx, endIdx + sep.length);\n\n\t\treturn {\n\t\t\tidx: endIdx,\n\t\t\ttext: text\n\t\t}\n\t}\n};\n\n\n/**\n * parse regexp in css expression\n *\n * @return {Object|false}\n *\t\t\t\t - idx:\n *\t\t\t\t - regExp:\n *\t\t\t\t or \n *\t\t\t\t false\n */\n\n/*\n\nall legal RegExp\n \n/a/\n(/a/)\n[/a/]\n[12, /a/]\n\n!/a/\n\n+/a/\n-/a/\n* /a/\n/ /a/\n%/a/\n\n===/a/\n!==/a/\n==/a/\n!=/a/\n>/a/\n>=/a/\n</a/\n<=/a/\n\n&/a/\n|/a/\n^/a/\n~/a/\n<</a/\n>>/a/\n>>>/a/\n\n&&/a/\n||/a/\n?/a/\n=/a/\n,/a/\n\n\t\tdelete /a/\n\t\t\t\tin /a/\ninstanceof /a/\n\t\t\t new /a/\n\t\ttypeof /a/\n\t\t\tvoid /a/\n\n*/\nCSSOM.CSSValueExpression.prototype._parseJSRexExp = function(token, idx) {\n\tvar before = token.substring(0, idx).replace(/\\s+$/, \"\"),\n\t\t\tlegalRegx = [\n\t\t\t\t/^$/,\n\t\t\t\t/\\($/,\n\t\t\t\t/\\[$/,\n\t\t\t\t/\\!$/,\n\t\t\t\t/\\+$/,\n\t\t\t\t/\\-$/,\n\t\t\t\t/\\*$/,\n\t\t\t\t/\\/\\s+/,\n\t\t\t\t/\\%$/,\n\t\t\t\t/\\=$/,\n\t\t\t\t/\\>$/,\n\t\t\t\t/\\<$/,\n\t\t\t\t/\\&$/,\n\t\t\t\t/\\|$/,\n\t\t\t\t/\\^$/,\n\t\t\t\t/\\~$/,\n\t\t\t\t/\\?$/,\n\t\t\t\t/\\,$/,\n\t\t\t\t/delete$/,\n\t\t\t\t/in$/,\n\t\t\t\t/instanceof$/,\n\t\t\t\t/new$/,\n\t\t\t\t/typeof$/,\n\t\t\t\t/void$/,\n\t\t\t];\n\n\tvar isLegal = legalRegx.some(function(reg) {\n\t\treturn reg.test(before);\n\t});\n\n\tif (!isLegal) {\n\t\treturn false;\n\t} else {\n\t\tvar sep = '/';\n\n\t\t// same logic as string\n\t\treturn this._parseJSString(token, idx, sep);\n\t}\n};\n\n\n/**\n *\n * find next sep(same line) index in `token`\n *\n * @return {Number}\n *\n */\nCSSOM.CSSValueExpression.prototype._findMatchedIdx = function(token, idx, sep) {\n\tvar startIdx = idx,\n\t\t\tendIdx;\n\n\tvar NOT_FOUND = -1;\n\n\twhile(true) {\n\t\tendIdx = token.indexOf(sep, startIdx + 1);\n\n\t\tif (endIdx === -1) { // not found\n\t\t\tendIdx = NOT_FOUND;\n\t\t\tbreak;\n\t\t} else {\n\t\t\tvar text = token.substring(idx + 1, endIdx),\n\t\t\t\t\tmatched = text.match(/\\\\+$/);\n\t\t\tif (!matched || matched[0] % 2 == 0) { // not escaped\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tstartIdx = endIdx;\n\t\t\t}\n\t\t}\n\t}\n\n\t// boundary must be in the same line(js sting or regexp)\n\tvar nextNewLineIdx = token.indexOf('\\n', idx + 1);\n\tif (nextNewLineIdx < endIdx) {\n\t\tendIdx = NOT_FOUND;\n\t}\n\n\n\treturn endIdx;\n}\n\n\n\n\n//.CommonJS\nexports.CSSValueExpression = CSSOM.CSSValueExpression;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @param {string} token\n */\nCSSOM.parse = function parse(token) {\n\n\tvar i = 0;\n\n\t/**\n\t\t\"before-selector\" or\n\t\t\"selector\" or\n\t\t\"atRule\" or\n\t\t\"atBlock\" or\n\t\t\"before-name\" or\n\t\t\"name\" or\n\t\t\"before-value\" or\n\t\t\"value\"\n\t*/\n\tvar state = \"before-selector\";\n\n\tvar index;\n\tvar buffer = \"\";\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true,\n\t\t\"atRule\": true,\n\t\t\"importRule-begin\": true,\n\t\t\"importRule\": true,\n\t\t\"atBlock\": true,\n\t\t'documentRule-begin': true\n\t};\n\n\tvar styleSheet = new CSSOM.CSSStyleSheet;\n\n\t// @type CSSStyleSheet|CSSMediaRule|CSSFontFaceRule|CSSKeyframesRule|CSSDocumentRule\n\tvar currentScope = styleSheet;\n\n\t// @type CSSMediaRule|CSSKeyframesRule|CSSDocumentRule\n\tvar parentRule;\n\n\tvar selector, name, value, priority=\"\", styleRule, mediaRule, importRule, fontFaceRule, keyframesRule, keyframeRule, documentRule;\n\n\tvar atKeyframesRegExp = /@(-(?:\\w+-)+)?keyframes/g;\n\n\tvar parseError = function(message) {\n\t\tvar lines = token.substring(0, i).split('\\n');\n\t\tvar lineCount = lines.length;\n\t\tvar charCount = lines.pop().length + 1;\n\t\tvar error = new Error(message + ' (line ' + lineCount + ', char ' + charCount + ')');\n\t\terror.line = lineCount;\n\t\terror.char = charCount;\n\t\terror.styleSheet = styleSheet;\n\t\tthrow error;\n\t};\n\n\tfor (var character; character = token.charAt(i); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf('\"', index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError('Unmatched \"');\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\')\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf(\"'\", index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError(\"Unmatched '\");\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\')\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (token.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = token.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tparseError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tif (state === \"importRule-begin\") {\n\t\t\t\tbuffer += \" \";\n\t\t\t\tstate = \"importRule\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// At-rule\n\t\tcase \"@\":\n\t\t\tif (token.indexOf(\"@-moz-document\", i) === i) {\n\t\t\t\tstate = \"documentRule-begin\";\n\t\t\t\tdocumentRule = new CSSOM.CSSDocumentRule;\n\t\t\t\tdocumentRule.__starts = i;\n\t\t\t\ti += \"-moz-document\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@media\", i) === i) {\n\t\t\t\tstate = \"atBlock\";\n\t\t\t\tmediaRule = new CSSOM.CSSMediaRule;\n\t\t\t\tmediaRule.__starts = i;\n\t\t\t\ti += \"media\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@import\", i) === i) {\n\t\t\t\tstate = \"importRule-begin\";\n\t\t\t\ti += \"import\".length;\n\t\t\t\tbuffer += \"@import\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@font-face\", i) === i) {\n\t\t\t\tstate = \"fontFaceRule-begin\";\n\t\t\t\ti += \"font-face\".length;\n\t\t\t\tfontFaceRule = new CSSOM.CSSFontFaceRule;\n\t\t\t\tfontFaceRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tatKeyframesRegExp.lastIndex = i;\n\t\t\t\tvar matchKeyframes = atKeyframesRegExp.exec(token);\n\t\t\t\tif (matchKeyframes && matchKeyframes.index === i) {\n\t\t\t\t\tstate = \"keyframesRule-begin\";\n\t\t\t\t\tkeyframesRule = new CSSOM.CSSKeyframesRule;\n\t\t\t\t\tkeyframesRule.__starts = i;\n\t\t\t\t\tkeyframesRule._vendorPrefix = matchKeyframes[1]; // Will come out as undefined if no prefix was found\n\t\t\t\t\ti += matchKeyframes[0].length - 1;\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (state == \"selector\") {\n\t\t\t\t\tstate = \"atRule\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\" || state === \"atRule\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tstyleRule.style.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"atBlock\") {\n\t\t\t\tmediaRule.media.mediaText = buffer.trim();\n\t\t\t\tcurrentScope = parentRule = mediaRule;\n\t\t\t\tmediaRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t} else if (state === \"fontFaceRule-begin\") {\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tfontFaceRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tfontFaceRule.parentStyleSheet = styleSheet;\n\t\t\t\tstyleRule = fontFaceRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"keyframesRule-begin\") {\n\t\t\t\tkeyframesRule.name = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tkeyframesRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tkeyframesRule.parentStyleSheet = styleSheet;\n\t\t\t\tcurrentScope = parentRule = keyframesRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t} else if (state === \"keyframeRule-begin\") {\n\t\t\t\tstyleRule = new CSSOM.CSSKeyframeRule;\n\t\t\t\tstyleRule.keyText = buffer.trim();\n\t\t\t\tstyleRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"documentRule-begin\") {\n\t\t\t\t// FIXME: what if this '{' is in the url text of the match function?\n\t\t\t\tdocumentRule.matcher.matcherText = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tdocumentRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tcurrentScope = parentRule = documentRule;\n\t\t\t\tdocumentRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase '(':\n\t\t\tif (state === 'value') {\n\t\t\t\t// ie css expression mode\n\t\t\t\tif (buffer.trim() == 'expression') {\n\t\t\t\t\tvar info = (new CSSOM.CSSValueExpression(token, i)).parse();\n\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\tparseError(info.error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuffer += info.expression;\n\t\t\t\t\t\ti = info.idx;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tindex = token.indexOf(')', i + 1);\n\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\tparseError('Unmatched \"(\"');\n\t\t\t\t\t}\n\t\t\t\t\tbuffer += token.slice(i, index + 1);\n\t\t\t\t\ti = index;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && token.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"atRule\":\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule\":\n\t\t\t\t\timportRule = new CSSOM.CSSImportRule;\n\t\t\t\t\timportRule.parentStyleSheet = importRule.styleSheet.parentStyleSheet = styleSheet;\n\t\t\t\t\timportRule.cssText = buffer + character;\n\t\t\t\t\tstyleSheet.cssRules.push(importRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbuffer += character;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\tcase \"before-name\":\n\t\t\t\tcase \"name\":\n\t\t\t\t\tstyleRule.__ends = i + 1;\n\t\t\t\t\tif (parentRule) {\n\t\t\t\t\t\tstyleRule.parentRule = parentRule;\n\t\t\t\t\t}\n\t\t\t\t\tstyleRule.parentStyleSheet = styleSheet;\n\t\t\t\t\tcurrentScope.cssRules.push(styleRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tif (currentScope.constructor === CSSOM.CSSKeyframesRule) {\n\t\t\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"keyframeRule-begin\":\n\t\t\t\tcase \"before-selector\":\n\t\t\t\tcase \"selector\":\n\t\t\t\t\t// End of media/document rule.\n\t\t\t\t\tif (!parentRule) {\n\t\t\t\t\t\tparseError(\"Unexpected }\");\n\t\t\t\t\t}\n\t\t\t\t\tcurrentScope.__ends = i + 1;\n\t\t\t\t\t// Nesting rules aren't supported yet\n\t\t\t\t\tstyleSheet.cssRules.push(currentScope);\n\t\t\t\t\tcurrentScope = styleSheet;\n\t\t\t\t\tparentRule = null;\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tswitch (state) {\n\t\t\t\tcase \"before-selector\":\n\t\t\t\t\tstate = \"selector\";\n\t\t\t\t\tstyleRule = new CSSOM.CSSStyleRule;\n\t\t\t\t\tstyleRule.__starts = i;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-name\":\n\t\t\t\t\tstate = \"name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-value\":\n\t\t\t\t\tstate = \"value\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule-begin\":\n\t\t\t\t\tstate = \"importRule\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn styleSheet;\n};\n\n\n//.CommonJS\nexports.parse = CSSOM.parse;\n// The following modules cannot be included sooner due to the mutual dependency with parse.js\nCSSOM.CSSStyleSheet = require(\"./CSSStyleSheet\").CSSStyleSheet;\nCSSOM.CSSStyleRule = require(\"./CSSStyleRule\").CSSStyleRule;\nCSSOM.CSSImportRule = require(\"./CSSImportRule\").CSSImportRule;\nCSSOM.CSSMediaRule = require(\"./CSSMediaRule\").CSSMediaRule;\nCSSOM.CSSFontFaceRule = require(\"./CSSFontFaceRule\").CSSFontFaceRule;\nCSSOM.CSSStyleDeclaration = require('./CSSStyleDeclaration').CSSStyleDeclaration;\nCSSOM.CSSKeyframeRule = require('./CSSKeyframeRule').CSSKeyframeRule;\nCSSOM.CSSKeyframesRule = require('./CSSKeyframesRule').CSSKeyframesRule;\nCSSOM.CSSValueExpression = require('./CSSValueExpression').CSSValueExpression;\nCSSOM.CSSDocumentRule = require('./CSSDocumentRule').CSSDocumentRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule,\n\tCSSMediaRule: require(\"./CSSMediaRule\").CSSMediaRule,\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSKeyframeRule: require('./CSSKeyframeRule').CSSKeyframeRule,\n\tCSSKeyframesRule: require('./CSSKeyframesRule').CSSKeyframesRule\n};\n///CommonJS\n\n\n/**\n * Produces a deep copy of stylesheet  the instance variables of stylesheet are copied recursively.\n * @param {CSSStyleSheet|CSSOM.CSSStyleSheet} stylesheet\n * @nosideeffects\n * @return {CSSOM.CSSStyleSheet}\n */\nCSSOM.clone = function clone(stylesheet) {\n\n\tvar cloned = new CSSOM.CSSStyleSheet;\n\n\tvar rules = stylesheet.cssRules;\n\tif (!rules) {\n\t\treturn cloned;\n\t}\n\n\tvar RULE_TYPES = {\n\t\t1: CSSOM.CSSStyleRule,\n\t\t4: CSSOM.CSSMediaRule,\n\t\t//3: CSSOM.CSSImportRule,\n\t\t//5: CSSOM.CSSFontFaceRule,\n\t\t//6: CSSOM.CSSPageRule,\n\t\t8: CSSOM.CSSKeyframesRule,\n\t\t9: CSSOM.CSSKeyframeRule\n\t};\n\n\tfor (var i=0, rulesLength=rules.length; i < rulesLength; i++) {\n\t\tvar rule = rules[i];\n\t\tvar ruleClone = cloned.cssRules[i] = new RULE_TYPES[rule.type];\n\n\t\tvar style = rule.style;\n\t\tif (style) {\n\t\t\tvar styleClone = ruleClone.style = new CSSOM.CSSStyleDeclaration;\n\t\t\tfor (var j=0, styleLength=style.length; j < styleLength; j++) {\n\t\t\t\tvar name = styleClone[j] = style[j];\n\t\t\t\tstyleClone[name] = style[name];\n\t\t\t\tstyleClone._importants[name] = style.getPropertyPriority(name);\n\t\t\t}\n\t\t\tstyleClone.length = style.length;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('keyText')) {\n\t\t\truleClone.keyText = rule.keyText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('selectorText')) {\n\t\t\truleClone.selectorText = rule.selectorText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('mediaText')) {\n\t\t\truleClone.mediaText = rule.mediaText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('cssRules')) {\n\t\t\truleClone.cssRules = clone(rule).cssRules;\n\t\t}\n\t}\n\n\treturn cloned;\n\n};\n\n//.CommonJS\nexports.clone = CSSOM.clone;\n///CommonJS\n","module.exports = (function() {\n  /*\n   * Generated by PEG.js 0.8.0.\n   *\n   * http://pegjs.majda.cz/\n   */\n\n  function peg$subclass(child, parent) {\n    function ctor() { this.constructor = child; }\n    ctor.prototype = parent.prototype;\n    child.prototype = new ctor();\n  }\n\n  function SyntaxError(message, expected, found, offset, line, column) {\n    this.message  = message;\n    this.expected = expected;\n    this.found    = found;\n    this.offset   = offset;\n    this.line     = line;\n    this.column   = column;\n\n    this.name     = \"SyntaxError\";\n  }\n\n  peg$subclass(SyntaxError, Error);\n\n  function parse(input) {\n    var options = arguments.length > 1 ? arguments[1] : {},\n\n        peg$FAILED = {},\n\n        peg$startRuleFunctions = { start: peg$parsestart },\n        peg$startRuleFunction  = peg$parsestart,\n\n        peg$c0 = [],\n        peg$c1 = function() { return []},\n        peg$c2 = peg$FAILED,\n        peg$c3 = \",\",\n        peg$c4 = { type: \"literal\", value: \",\", description: \"\\\",\\\"\" },\n        peg$c5 = function(x, xs) { return [x].concat(xs); },\n        peg$c6 = function(entry) { return [entry]; },\n        peg$c7 = function(url, format) { return {url: url, format: format}; },\n        peg$c8 = function(url) { return {url: url}; },\n        peg$c9 = \"url(\",\n        peg$c10 = { type: \"literal\", value: \"url(\", description: \"\\\"url(\\\"\" },\n        peg$c11 = \")\",\n        peg$c12 = { type: \"literal\", value: \")\", description: \"\\\")\\\"\" },\n        peg$c13 = function(value) { return value; },\n        peg$c14 = \"format(\",\n        peg$c15 = { type: \"literal\", value: \"format(\", description: \"\\\"format(\\\"\" },\n        peg$c16 = \"local(\",\n        peg$c17 = { type: \"literal\", value: \"local(\", description: \"\\\"local(\\\"\" },\n        peg$c18 = function(value) { return {local: value}; },\n        peg$c19 = /^[^)]/,\n        peg$c20 = { type: \"class\", value: \"[^)]\", description: \"[^)]\" },\n        peg$c21 = function(chars) { return util.extractValue(chars.join(\"\")); },\n        peg$c22 = /^[ \\t\\r\\n\\f]/,\n        peg$c23 = { type: \"class\", value: \"[ \\\\t\\\\r\\\\n\\\\f]\", description: \"[ \\\\t\\\\r\\\\n\\\\f]\" },\n\n        peg$currPos          = 0,\n        peg$reportedPos      = 0,\n        peg$cachedPos        = 0,\n        peg$cachedPosDetails = { line: 1, column: 1, seenCR: false },\n        peg$maxFailPos       = 0,\n        peg$maxFailExpected  = [],\n        peg$silentFails      = 0,\n\n        peg$result;\n\n    if (\"startRule\" in options) {\n      if (!(options.startRule in peg$startRuleFunctions)) {\n        throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n      }\n\n      peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n    }\n\n    function text() {\n      return input.substring(peg$reportedPos, peg$currPos);\n    }\n\n    function offset() {\n      return peg$reportedPos;\n    }\n\n    function line() {\n      return peg$computePosDetails(peg$reportedPos).line;\n    }\n\n    function column() {\n      return peg$computePosDetails(peg$reportedPos).column;\n    }\n\n    function expected(description) {\n      throw peg$buildException(\n        null,\n        [{ type: \"other\", description: description }],\n        peg$reportedPos\n      );\n    }\n\n    function error(message) {\n      throw peg$buildException(message, null, peg$reportedPos);\n    }\n\n    function peg$computePosDetails(pos) {\n      function advance(details, startPos, endPos) {\n        var p, ch;\n\n        for (p = startPos; p < endPos; p++) {\n          ch = input.charAt(p);\n          if (ch === \"\\n\") {\n            if (!details.seenCR) { details.line++; }\n            details.column = 1;\n            details.seenCR = false;\n          } else if (ch === \"\\r\" || ch === \"\\u2028\" || ch === \"\\u2029\") {\n            details.line++;\n            details.column = 1;\n            details.seenCR = true;\n          } else {\n            details.column++;\n            details.seenCR = false;\n          }\n        }\n      }\n\n      if (peg$cachedPos !== pos) {\n        if (peg$cachedPos > pos) {\n          peg$cachedPos = 0;\n          peg$cachedPosDetails = { line: 1, column: 1, seenCR: false };\n        }\n        advance(peg$cachedPosDetails, peg$cachedPos, pos);\n        peg$cachedPos = pos;\n      }\n\n      return peg$cachedPosDetails;\n    }\n\n    function peg$fail(expected) {\n      if (peg$currPos < peg$maxFailPos) { return; }\n\n      if (peg$currPos > peg$maxFailPos) {\n        peg$maxFailPos = peg$currPos;\n        peg$maxFailExpected = [];\n      }\n\n      peg$maxFailExpected.push(expected);\n    }\n\n    function peg$buildException(message, expected, pos) {\n      function cleanupExpected(expected) {\n        var i = 1;\n\n        expected.sort(function(a, b) {\n          if (a.description < b.description) {\n            return -1;\n          } else if (a.description > b.description) {\n            return 1;\n          } else {\n            return 0;\n          }\n        });\n\n        while (i < expected.length) {\n          if (expected[i - 1] === expected[i]) {\n            expected.splice(i, 1);\n          } else {\n            i++;\n          }\n        }\n      }\n\n      function buildMessage(expected, found) {\n        function stringEscape(s) {\n          function hex(ch) { return ch.charCodeAt(0).toString(16).toUpperCase(); }\n\n          return s\n            .replace(/\\\\/g,   '\\\\\\\\')\n            .replace(/\"/g,    '\\\\\"')\n            .replace(/\\x08/g, '\\\\b')\n            .replace(/\\t/g,   '\\\\t')\n            .replace(/\\n/g,   '\\\\n')\n            .replace(/\\f/g,   '\\\\f')\n            .replace(/\\r/g,   '\\\\r')\n            .replace(/[\\x00-\\x07\\x0B\\x0E\\x0F]/g, function(ch) { return '\\\\x0' + hex(ch); })\n            .replace(/[\\x10-\\x1F\\x80-\\xFF]/g,    function(ch) { return '\\\\x'  + hex(ch); })\n            .replace(/[\\u0180-\\u0FFF]/g,         function(ch) { return '\\\\u0' + hex(ch); })\n            .replace(/[\\u1080-\\uFFFF]/g,         function(ch) { return '\\\\u'  + hex(ch); });\n        }\n\n        var expectedDescs = new Array(expected.length),\n            expectedDesc, foundDesc, i;\n\n        for (i = 0; i < expected.length; i++) {\n          expectedDescs[i] = expected[i].description;\n        }\n\n        expectedDesc = expected.length > 1\n          ? expectedDescs.slice(0, -1).join(\", \")\n              + \" or \"\n              + expectedDescs[expected.length - 1]\n          : expectedDescs[0];\n\n        foundDesc = found ? \"\\\"\" + stringEscape(found) + \"\\\"\" : \"end of input\";\n\n        return \"Expected \" + expectedDesc + \" but \" + foundDesc + \" found.\";\n      }\n\n      var posDetails = peg$computePosDetails(pos),\n          found      = pos < input.length ? input.charAt(pos) : null;\n\n      if (expected !== null) {\n        cleanupExpected(expected);\n      }\n\n      return new SyntaxError(\n        message !== null ? message : buildMessage(expected, found),\n        expected,\n        found,\n        pos,\n        posDetails.line,\n        posDetails.column\n      );\n    }\n\n    function peg$parsestart() {\n      var s0, s1;\n\n      s0 = peg$parsesourceEntries();\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = [];\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c1();\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parsesourceEntries() {\n      var s0, s1, s2, s3, s4, s5;\n\n      s0 = peg$currPos;\n      s1 = peg$parsesourceEntry();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewhitespace();\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          s3 = peg$parsewhitespace();\n        }\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 44) {\n            s3 = peg$c3;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c4); }\n          }\n          if (s3 !== peg$FAILED) {\n            s4 = [];\n            s5 = peg$parsewhitespace();\n            while (s5 !== peg$FAILED) {\n              s4.push(s5);\n              s5 = peg$parsewhitespace();\n            }\n            if (s4 !== peg$FAILED) {\n              s5 = peg$parsesourceEntries();\n              if (s5 !== peg$FAILED) {\n                peg$reportedPos = s0;\n                s1 = peg$c5(s1, s5);\n                s0 = s1;\n              } else {\n                peg$currPos = s0;\n                s0 = peg$c2;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$c2;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = peg$parsesourceEntry();\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c6(s1);\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parsesourceEntry() {\n      var s0;\n\n      s0 = peg$parseurlEntry();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parselocalEntry();\n      }\n\n      return s0;\n    }\n\n    function peg$parseurlEntry() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      s1 = peg$parseurl();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewhitespace();\n        if (s3 !== peg$FAILED) {\n          while (s3 !== peg$FAILED) {\n            s2.push(s3);\n            s3 = peg$parsewhitespace();\n          }\n        } else {\n          s2 = peg$c2;\n        }\n        if (s2 !== peg$FAILED) {\n          s3 = peg$parseformat();\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c7(s1, s3);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = peg$parseurl();\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c8(s1);\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parseurl() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 4) === peg$c9) {\n        s1 = peg$c9;\n        peg$currPos += 4;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c10); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c13(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parseformat() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 7) === peg$c14) {\n        s1 = peg$c14;\n        peg$currPos += 7;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c15); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c13(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parselocalEntry() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 6) === peg$c16) {\n        s1 = peg$c16;\n        peg$currPos += 6;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c17); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c18(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parsevalue() {\n      var s0, s1, s2;\n\n      s0 = peg$currPos;\n      s1 = [];\n      if (peg$c19.test(input.charAt(peg$currPos))) {\n        s2 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c20); }\n      }\n      if (s2 !== peg$FAILED) {\n        while (s2 !== peg$FAILED) {\n          s1.push(s2);\n          if (peg$c19.test(input.charAt(peg$currPos))) {\n            s2 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s2 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c20); }\n          }\n        }\n      } else {\n        s1 = peg$c2;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c21(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsewhitespace() {\n      var s0;\n\n      if (peg$c22.test(input.charAt(peg$currPos))) {\n        s0 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s0 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c23); }\n      }\n\n      return s0;\n    }\n\n\n      var util = require('../util');\n\n\n    peg$result = peg$startRuleFunction();\n\n    if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n      return peg$result;\n    } else {\n      if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n        peg$fail({ type: \"end\", description: \"end of input\" });\n      }\n\n      throw peg$buildException(null, peg$maxFailExpected, peg$maxFailPos);\n    }\n  }\n\n  return {\n    SyntaxError: SyntaxError,\n    parse:       parse\n  };\n})();\n","var trimCSSWhitespace = function (value) {\n    var whitespaceRegex = /^[\\t\\r\\f\\n ]*(.+?)[\\t\\r\\f\\n ]*$/;\n\n    return value.replace(whitespaceRegex, \"$1\");\n};\n\nvar unquoteString = function (quotedUrl) {\n    var doubleQuoteRegex = /^\"(.*)\"$/,\n        singleQuoteRegex = /^'(.*)'$/;\n\n    if (doubleQuoteRegex.test(quotedUrl)) {\n        return quotedUrl.replace(doubleQuoteRegex, \"$1\");\n    } else {\n        if (singleQuoteRegex.test(quotedUrl)) {\n            return quotedUrl.replace(singleQuoteRegex, \"$1\");\n        } else {\n            return quotedUrl;\n        }\n    }\n};\n\nexports.extractValue = function (value) {\n    return unquoteString(trimCSSWhitespace(value));\n};\n"]}