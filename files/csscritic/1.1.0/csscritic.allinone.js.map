{"version":3,"sources":["node_modules/grunt-browserify/node_modules/browserify/node_modules/browser-pack/_prelude.js","build/csscritic.umd.js","build/csscritic.concat.css","node_modules/ayepromise/ayepromise.js","node_modules/cssify/browser.js","node_modules/imagediff/imagediff.js","node_modules/rasterizehtml/dist/rasterizeHTML.js","node_modules/imagediff/browser/canvas.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/url/url.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/punycode/punycode.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/is-array/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/ieee754/index.js","node_modules/rasterizehtml/node_modules/css-mediaquery/index.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/encode.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/querystring-es3/decode.js","node_modules/grunt-browserify/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib/b64.js","node_modules/rasterizehtml/node_modules/xmlserializer/lib/serializer.js","node_modules/inlineresources/src/inline.js","node_modules/inlineresources/src/util.js","node_modules/inlineresources/src/inlineImage.js","node_modules/inlineresources/src/inlineScript.js","node_modules/inlineresources/src/inlineCss.js","node_modules/inlineresources/src/cssSupport.js","node_modules/inlineresources/src/backgroundValueParser.js","node_modules/inlineresources/node_modules/css-font-face-src/lib/index.js","node_modules/inlineresources/node_modules/cssom/lib/index.js","node_modules/inlineresources/node_modules/cssom/lib/CSSStyleDeclaration.js","node_modules/inlineresources/node_modules/cssom/lib/CSSStyleRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSMediaRule.js","node_modules/inlineresources/node_modules/cssom/lib/MediaList.js","node_modules/inlineresources/node_modules/cssom/lib/CSSImportRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSFontFaceRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSStyleSheet.js","node_modules/inlineresources/node_modules/cssom/lib/CSSKeyframesRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSKeyframeRule.js","node_modules/inlineresources/node_modules/cssom/lib/CSSDocumentRule.js","node_modules/inlineresources/node_modules/cssom/lib/StyleSheet.js","node_modules/inlineresources/node_modules/cssom/lib/CSSValue.js","node_modules/inlineresources/node_modules/cssom/lib/MatcherList.js","node_modules/inlineresources/node_modules/cssom/lib/CSSValueExpression.js","node_modules/inlineresources/node_modules/cssom/lib/parse.js","node_modules/inlineresources/node_modules/cssom/lib/clone.js","node_modules/inlineresources/node_modules/css-font-face-src/lib/grammar/index.js","node_modules/inlineresources/node_modules/css-font-face-src/lib/util.js"],"names":["root","factory","define","amd","a0","b1","c2","exports","module","require","ayepromise","imagediff","rasterizeHTML","this","csscriticLib","main","regression","reporting","util","storage","selectionFilter","currentComponentLabel","testCases","component","componentLabel","supportUrlAsOnlyTestCaseInput","testCase","url","add","augmentedTestCase","clone","undefined","push","fetchStartingComparisons","all","map","readReferenceImage","then","referenceImageRecord","referenceImage","image","viewport","selectComparisons","configuredComparisons","configuredComparison","selected","isComparisonSelected","reportConfiguredComparisons","comparisonSelection","selection","isSelected","doReportConfiguredComparison","executeTestCase","startingComparison","compare","comparison","doReportComparison","execute","allPassed","startingComp","selectedComparisons","filter","comparisons","hasTestSuitePassed","doReportTestSuite","renderer","toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux","workAroundFirefoxResourcesSporadicallyMissing","htmlImage","diff","workAroundBrowserIssues","pageImage","workAroundTransparencyIssueInFirefox","compareRenderingAndReference","isEqual","adaptedHtmlImage","equal","comparisonResult","textualStatus","renderErrors","result","status","loadPageAndCompare","render","hover","active","width","height","renderResult","errors","viewportFallback","fallbackWidth","fallbackHeight","reporters","addReporter","reporter","testCaseIsResizable","attachPageAcceptHelpers","viewportWidth","viewportHeight","resizePageImage","acceptPage","storeReferenceImage","reportingMethod","reportSelectedComparison","reportDeselectedComparison","reportingFunc","reportComparison","passed","reportTestSuite","success","getDataURIForImage","canvas","window","document","createElement","context","getContext","naturalWidth","naturalHeight","drawImage","toDataURL","getImageForUrl","defer","Image","onload","resolve","onerror","reject","src","promise","getUncachableURL","delimiter","indexOf","Date","now","ajax","xhr","XMLHttpRequest","response","open","send","e","loadAsBlob","responseType","loadBlobAsText","blob","reader","FileReader","target","readAsText","loadBlobAsDataURI","readAsDataURL","excludeKeys","theMap","Array","prototype","slice","call","arguments","newMap","Object","keys","forEach","key","serializeMap","serializationEntries","sort","join","object","i","theClone","hasOwnProperty","successfulPromise","value","dataUri","nonPassingTestCases","length","hasValidTestSetup","functionReturnValues","pendingFunctionCalls","resolvedValues","functionCallResolved","idx","returnValue","browserRenderer","jobQueue","queue","cache","getOrCreateJobQueue","extractErrorMessages","error","msg","logErrorToConsole","console","doRenderHtml","parameters","drawOptions","cacheBucket","executeJs","executeJsTimeout","baseUrl","drawHTML","html","renderHtmlFromBlob","content","loadImageFromBlob","fallbackFilter","windowLocation","storageKey","fullDescription","desc","sessionStorage","getItem","filterFor","setItem","reload","filterForComponent","clearFilter","removeItem","indexeddbstorage","createDb","db","createObjectStore","keyPath","getDb","request","indexedDB","onsuccess","event","onupgradeneeded","buildKey","testCaseParameters","serializedParameters","imageUri","transaction","objectStore","put","reference","close","get","dataObj","img","busy","runJob","job","func","nextInQueue","shift","constructJob","niceReporter","pageNavigationHandlingFallback","packageVersion","originalTitle","escapeValue","toString","replace","RegExp","template","templateStr","values","_","param","elementFor","htmlString","tmp","insertAdjacentHTML","firstChild","findElementIn","container","elementClassName","querySelector","escapeId","id","headerClassName","timeTakenClassName","progressBarClassName","statusTextClassName","createContainer","parentContainer","reportBody","showHeader","appendChild","elementDimensions","element","initialPosition","getBoundingClientRect","scrollOffsetTop","body","scrollTop","documentElement","scrollOffsetLeft","scrollLeft","top","left","right","px","makeElementFixedOnScroll","dimensions","scrollingClass","smallClass","smallScrollThreshold","isScrolling","isSmall","pseudoInlineElement","addEventListener","scrollY","classList","style","position","parentElement","insertBefore","remove","removeChild","header","updateStatusInDocumentTitle","totalCount","doneCount","title","padNumber","number","renderMilliseconds","time","seconds","Math","floor","milliSeconds","showTimeTaken","timeTakenInMillis","timeTaken","textContent","setOutcomeOnHeader","successful","progressBarPendingClassName","testDescription","comparisonKey","addTickToProgressBar","linkTarget","progressBar","clickableTickTemplate","deactivatedTickTemplate","tickTemplate","tick","install","markTickDone","renderErrorCount","tickElement","singularPlural","singularForm","pluralForm","statusTotalText","selectedCount","totalContent","total","statusIssueText","issueCount","issueContent","doneContent","noTestsContent","doneWithoutErrors","issues","acceptAllClassName","acceptAllButton","showAcceptAllButtonIfNeccessary","acceptableEntries","statusText","button","onclick","acceptableEntry","acceptComparison","entry","setAttribute","installFallbackClearSelectionHandler","preventDefault","updateStatusBar","runAllUrl","clearFilterUrl","runAll","innerHTML","getOrCreateToc","tocClassName","toc","className","addTocEntry","headline","installFallbackComponentSelectionHandler","addComponentHeading","filterUrl","filterUrlForComponent","headlineElement","runningComparisonClassName","imageContainerClassName","errorContainerClassName","imageWrapper","wrapper","serializeValue","installFallbackSelectionHandler","addComparison","titleLinkClassName","filterUrlFor","anchorTarget","imageContainer","titleLink","canvasForImageCanvas","imageData","putImageData","diffPageImages","imageA","imageB","align","embossChanges","d","data","getDifferenceCanvas","differenceImageData","canvasForImage","addImageDiff","imageForDiff","acceptClassName","acceptButton","changedImageContainer","changedImageContainerClassName","outerChangedImageContainer","showComparisonWithDiff","pageAsIframe","testCaseUrl","iframe","scrolling","showComparisonWithRenderedPage","showComparisonWithoutReference","sameOriginWarning","showComparisonWithError","errorMsg","errorContainer","showRenderErrors","listElement","li","updateComparisonStatus","supportsReadingHtmlFromCanvas","browserIssueChecked","showBrowserWarningIfNeeded","supported","NiceReporter","outerContainer","containerElement","timeStarted","lastComponentLabel","progressTickElements","runningComparisonEntries","acceptableComparisons","registerComparison","comparisonElement","fakeTargetClassName","clearFakeActiveClass","previousTargets","querySelectorAll","elem","triggerFakeActiveClass","targetElement","scrollTo","getElementById","scrollIntoView","globalNavigationHandlingInstalled","installGlobalNavigationHandling","onpopstate","state","targetLink","decodeURIComponent","href","targetId","substr","history","pushState","urlQueryFilter","filterParam","parseUrlSearch","search","paramString","split","keyValue","equalsIdx","serializeKeyValuePair","pair","getFilterValue","filterKeyValue","entryPair","pop","existingQueryParams","queryPart","queryParams","encodeURIComponent","csscritic","installCallChain","self","apply","startsWith","str","prefix","needsFallback","location","indexedDbStorage","queryFilter","css","once","wasCalled","wrappedFunction","getThenableIfExists","obj","aThenHandler","onFulfilled","onRejected","doHandlerCall","setTimeout","TypeError","callFulfilled","callRejected","handle","FULFILLED","PENDING","REJECTED","outcome","thenHandlers","doSettle","settledState","doFulfill","doReject","registerThenHandler","thenHandler","safelyResolveThenable","thenable","onceWrapper","transparentlyResolveThenablesAndSettle","fail","customDocument","doc","createStyleSheet","sheet","cssText","ownerNode","head","getElementsByTagName","type","styleSheet","createTextNode","byUrl","link","rel","name","definition","Canvas","Error","message","getCanvas","getImageData","clearRect","createImageData","getCanvasRef","isImage","isType","TYPE_IMAGE","isCanvas","TYPE_CANVAS","isContext","TYPE_CONTEXT","isImageData","TYPE_IMAGE_DATA","UNDEFINED","isImageType","match","copyImageData","newImageData","newData","toImageData","toImageDataFromImage","toImageDataFromCanvas","toImageDataFromContext","toCanvas","equalWidth","a","b","equalHeight","equalDimensions","tolerance","aData","bData","abs","options","diffEqual","diffUnequal","c","cData","offsets","rowOffset","columnOffset","row","column","j","max","checkType","imageDataToPNG","outputFile","callback","base64Data","decodedImage","Function","Buffer","writeFile","jasmine","previous","toBeImageData","actual","toImageDiffEqual","expected","div","overflow","createCanvas","noConflict","d3","e4","cssMediaQuery","xmlserializer","inlineresources","uniqueIdList","joinUrl","relUrl","getConstantUniqueIdFor","isObject","parseOptionalParameters","args","proxies","monkeyPatchInstanceMethod","methodName","proxyFunc","originalFunc","baseUrlRespectingXhr","XHRObject","xhrConstructor","originalOpen","method","joinedUrl","concat","finishNotifyingXhr","totalXhrCount","doneXhrCount","waitingForPendingToClose","checkAllRequestsFinished","pendingXhrCount","originalSend","waitForRequestsToFinish","documentUtil","asArray","arrayLike","addClassNameRecursively","parentNode","ownerDocument","changeCssRule","rule","newRuleText","parentStyleSheet","ruleIdx","cssRules","insertRule","deleteRule","updateRuleSelector","updatedSelector","styleDefinitions","newRule","cssRulesToText","reduce","rewriteStyleContent","styleElement","matchingSimpleSelectorsRegex","simpleSelectorList","replaceSimpleSelectorsBy","caseInsensitiveReplaceFunc","selectorRegex","matchingRules","selectorText","test","newSelector","prefixMatch","selectorMatch","rewriteCssSelectorWith","oldSelector","lowercaseCssTypeSelectors","matchingTagNames","toLowerCase","findHtmlOnlyNodeNames","currentTagName","treeWalker","createTreeWalker","NodeFilter","SHOW_ELEMENT","htmlNodeNames","nonHtmlNodeNames","nextNode","currentNode","tagName","namespaceURI","documentHelper","fakeHover","hoverSelector","fakeHoverClass","fakeActive","activeSelector","fakeActiveClass","fakeFocus","focusSelector","fakeFocusClass","persistInputValues","inputs","textareas","isCheckable","input","checked","removeAttribute","textarea","rewriteTagNameSelectorsToLowerCase","mediaQueryHelper","hasEmIssue","svgImgBlueByEmMediaQuery","svg","firstPixelHasColor","r","g","hasEmMediaQueryIssue","needsEmWorkaround","mediaQueryRule","mediaQueries","exchangeRuleWithNewContent","serializeExpression","exp","feature","modifier","serializeQueryPart","q","segments","inverse","expressions","serializeQuery","queryParts","transformEmIntoPx","em","replaceEmValueWithPx","exec","parseFloat","substituteEmWithPx","mediaQuery","parsedQuery","parse","hasChanges","rewrittenValue","replaceEmsWithPx","mediaQueryRules","anyRuleHasChanges","reworkedMediaQueries","media","rewrittenMediaQuery","workAroundWebKitEmSizeIssue","styles","CSSRule","MEDIA_RULE","browser","theWindow","createHiddenElement","visibility","executeJavascript","outerHTML","iframeErrorsMessages","timeout","doResolve","contentDocument","waitForJavaScriptToRun","finishNotifyXhrProxy","contentWindow","baseUrlXhrProxy","resourceType","write","createHiddenSandboxedIFrame","sandbox","createIframeWithSizeAtZoomLevel1","zoom","scaledViewportWidth","scaledViewportHeight","calculateZoomedContentSizeAndRoundUp","actualViewport","requestedWidth","requestedHeight","calculateContentSize","selector","originalWidth","originalHeight","rootFontSize","rect","contentSize","actualViewportWidth","scrollWidth","clientWidth","actualViewportHeight","scrollHeight","clientHeight","getComputedStyle","fontSize","calculateDocumentContentSize","size","clip","addHTMLTagAttributes","htmlTagSubstitute","elementSubstitute","attribute","attributeMatch","helperDoc","implementation","createHTMLDocument","attributes","parseHTML","isParseError","parsedDocument","p","DOMParser","errorneousParse","parseFromString","parsererrorNS","getElementsByTagNameNS","failOnParseError","validateXHTML","xhtml","lastCacheDate","doDocumentLoad","ajaxRequest","augmentedUrl","responseXML","err","loadDocument","svg2image","checkForBlobsResult","urlForSvg","useBlobs","URL","createObjectURL","Blob","cleanUpUrl","revokeObjectURL","simpleForeignObjectSvg","supportsReadingObjectFromCanvas","readingBackFromCanvasBenefitsFromOldSchoolDataUris","blobUrl","supportsReadingFromBlobs","s","supportsBlobBuilding","checkBlobSupport","doesBenefit","checkForBlobs","buildImageUrl","renderSvg","resetEventHandlers","cleanUp","imageUrl","document2svg","zoomedElementSizingAttributes","zoomFactor","closestScaledWith","closestScaledHeight","offsetX","offsetY","round","x","y","transform","workAroundCollapsingMarginsAcrossSVGElementInWebKitLike","workAroundSafariSometimesNotShowingExternalResources","externalResourcesRequired","workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll","serializeAttributes","convertDocumentToSvg","serializeToString","getSvgForDocument","needsWorkaround","drawDocumentAsSvg","focus","rasterize","generalDrawError","drawSvgAsImg","drawImageOnCanvas","doDraw","operateJavaScriptOnDocument","inlineOptions","inlineScripts","inlineReferences","drawResult","getViewportSize","defaultWidth","defaultHeight","constructOptions","params","drawDocument","optionalArguments","workAroundFirefoxNotLoadingStylesheetStyles","replaceChild","extendedOptions","drawURL","workaround","subject","encoding","byteLength","isArray","kMaxLength","RangeError","TYPED_ARRAY_SUPPORT","_augment","Uint8Array","_isBuffer","_set","isArrayish","isBuffer","readUInt8","poolSize","parent","rootParent","SlowBuffer","buf","hexWrite","string","offset","Number","remaining","strLen","parsed","parseInt","isNaN","utf8Write","charsWritten","blitBuffer","utf8ToBytes","asciiWrite","asciiToBytes","binaryWrite","base64Write","base64ToBytes","utf16leWrite","utf16leToBytes","base64Slice","start","end","base64","fromByteArray","utf8Slice","res","min","decodeUtf8Char","String","fromCharCode","asciiSlice","ret","binarySlice","hexSlice","len","out","toHex","utf16leSlice","bytes","checkOffset","ext","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","ieee754","writeDouble","base64clean","stringtrim","INVALID_BASE64_RE","trim","n","units","Infinity","codePoint","leadSurrogate","charCodeAt","byteArray","hi","lo","toByteArray","dst","INSPECT_MAX_BYTES","ArrayBuffer","arr","foo","subarray","isEncoding","list","totalLength","pos","item","copy","loweredCase","equals","inspect","val","byteOffset","arrayIndexOf","foundIndex","log","set","v","writeUInt8","isFinite","swap","toJSON","_arr","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt16LE","readUInt16BE","readUInt32LE","readUInt32BE","readIntLE","pow","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","read","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","writeUIntBE","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","target_start","fill","toArrayBuffer","buffer","BP","constructor","toLocaleString","Url","protocol","slashes","auth","host","port","hostname","hash","query","pathname","path","urlParse","parseQueryString","slashesDenoteHost","u","urlFormat","isString","format","urlResolve","source","relative","urlResolveObject","resolveObject","arg","isNull","isNullOrUndefined","punycode","protocolPattern","portPattern","delims","unwise","autoEscape","nonHostChars","hostEndingChars","hostnameMaxLen","hostnamePartPattern","hostnamePartStart","unsafeProtocol","javascript","javascript:","hostlessProtocol","slashedProtocol","http","https","ftp","gopher","file","http:","https:","ftp:","gopher:","file:","querystring","rest","proto","lowerProto","hostEnd","hec","atSign","lastIndexOf","parseHost","ipv6Hostname","hostparts","l","part","newpart","k","validParts","notHost","bit","unshift","domainArray","newOut","encode","h","ae","esc","escape","qm","stringify","charAt","relPath","isSourceAbs","isRelAbs","mustEndAbs","removeAllDots","srcPath","psychotic","authInHost","last","hasTrailingSlash","up","splice","isAbsolute","decode","array","fn","mapDomain","regexSeparators","ucs2decode","extra","output","counter","ucs2encode","stringFromCharCode","basicToDigit","base","digitToBasic","digit","flag","adapt","delta","numPoints","firstTime","damp","baseMinusTMin","tMax","skew","basic","index","oldi","w","t","baseMinusT","inputLength","initialN","bias","initialBias","maxInt","tMin","handledCPCount","basicLength","m","currentValue","handledCPCountPlusOne","qMinusT","toUnicode","domain","regexPunycode","toASCII","regexNonASCII","freeExports","freeModule","freeGlobal","global","not-basic","invalid-input","version","ucs2","nodeType","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","rt","LN2","matchQuery","parseQuery","some","typeMatch","expressionsMatch","every","expression","expValue","toPx","toDpi","toDecimal","captures","RE_MEDIA_QUERY","RE_MQ_EXPRESSION","RE_MQ_FEATURE","ratio","numbers","decimal","resolution","RE_RESOLUTION_UNIT","RE_LENGTH_UNIT","xs","f","stringifyPrimitive","sep","eq","objectKeys","ks","prop","qs","regexp","maxKeys","kstr","vstr","lookup","elt","code","PLUS","PLUS_URL_SAFE","SLASH","SLASH_URL_SAFE","NUMBER","UPPER","LOWER","b64ToByteArray","b64","L","placeHolders","Arr","uint8ToBase64","uint8","num","tripletToBase64","temp","extraBytes","base64js","removeInvalidCharacters","serializeAttributeValue","serializeTextContent","serializeAttribute","attr","getTagName","node","serializeNamespace","nodeHasXmlnsAttr","attrs","serializeChildren","childNodes","childNode","nodeTreeToXHTML","serializeTag","serializeText","text","nodeValue","serializeComment","serializeCDATA","nodeName","inlineImage","inlineScript","inlineCss","cssSupport","getUrlBasePath","parameterHashFunction","JSON","memoizeFunctionOnCaching","memoize","requestExternalsForStylesheet","styleContent","alreadyLoadedCssUrls","rulesForCssText","loadCSSImportsForRules","cssImportResult","loadAndInlineCSSResourcesForRules","cssResourcesResult","loadAndInlineCssForStyle","processExternals","cloneArray","getCssStyleElements","loadAndInlineStyles","allErrors","getDocumentBaseUrl","substituteLinkWithInlineStyle","oldLinkNode","styleNode","requestStylesheetAndInlineResources","hasChangesFromPathAdjustment","adjustPathsOfCssResources","loadLinkedCSS","cssHref","documentBaseUrl","ajaxOptions","processStylesheet","getCssStylesheetLinks","links","loadAndInlineCssLinks","loadAndInlineImages","inline","loadAndInlineScript","inlineFuncs","baseURI","nodeList","isDataUri","promises","pendingPromiseCount","collectAndReportErrors","overrideMimeType","mimeType","binaryAjax","binaryContent","detectMimeType","substring","getDataURIForImageURL","base64Content","btoa","constantUniqueIdFor","hasher","memo","retValue","argumentHash","funcHash","encodeImageAsDataURI","documentBase","dataURI","filterExternalImages","images","filterInputsForImageType","toArray","imageInputs","externalImages","loadLinkedScript","script","escapeClosingTags","substituteExternalScriptWithInline","scriptNode","jsCode","removeNamedItem","getScripts","scripts","backgroundValueParser","fontFaceSrcValueParser","updateCssPropertyValue","property","setProperty","getPropertyPriority","findBackgroundImageRules","STYLE_RULE","getPropertyValue","findBackgroundDeclarations","rules","backgroundDeclarations","findFontFaceRules","FONT_FACE_RULE","findCSSImportRules","IMPORT_RULE","findExternalBackgroundUrls","parsedBackground","matchIndices","backgroundLayer","findExternalFontFaceUrls","parsedFontFaceSources","sourceIndices","sourceItem","backgroundRules","change","declaration","backgroundValue","externalBackgroundIndices","backgroundLayerIndex","relativeUrl","serialize","externalFontFaceUrlIndices","fontFaceSrcDeclaration","fontFaceUrlIndex","changeFontFaceRuleSrc","cssUrl","exchangeRule","substituteRule","newCssRules","fulfilledPromise","loadAndInlineCSSImport","cssHrefRelativeToDoc","unquoteString","externalCssRules","rulesToInline","moreErrors","loadAndInlineBackgroundImages","externalBackgroundLayerIndices","iterateOverRulesAndInlineBackgroundImages","cssHasChanges","loadAndInlineFontFace","srcDeclarationValue","urlIndex","fontSrc","iterateOverRulesAndInlineFontFace","cssom","quotedUrl","doubleQuoteRegex","singleQuoteRegex","rulesForCssTextFromBrowser","browserHasBackgroundImageUrlIssue","newSrc","trimCSSWhitespace","whitespaceRegex","extractCssUrl","urlRegex","sliceBackgroundDeclaration","backgroundDeclarationText","outerRepeatedMatch","functionParamRegexS","valueRegexS","simpleSingularBackgroundRegexS","simpleBackgroundRegexS","simpleSingularBackgroundRegex","backgroundLayers","getValues","singularBackgroundDeclaration","repeatedMatch","valueRegex","backgroundValues","findBackgroundImageUrlInValues","backgroundLayerValues","urlMatch","preUrl","postUrl","grammar","SyntaxError","fontFaceSourceValue","itemValue","local","CSSStyleDeclaration","CSSStyleRule","MediaList","CSSMediaRule","CSSImportRule","CSSFontFaceRule","StyleSheet","CSSStyleSheet","CSSKeyframesRule","CSSKeyframeRule","MatcherList","CSSDocumentRule","CSSValue","CSSValueExpression","CSSOM","parentRule","_importants","priority","removeProperty","prevValue","getPropertyCSSValue","getPropertyShorthand","isPropertyImplicit",{"end":{"file":"?","comments_before":[],"nlb":false,"endpos":2540,"endcol":12,"endline":112,"pos":2533,"col":5,"line":112,"value":"cssText","type":"name"},"start":{"file":"?","comments_before":[],"nlb":false,"endpos":2540,"endcol":12,"endline":112,"pos":2533,"col":5,"line":112,"value":"cssText","type":"name"},"name":"cssText"},"properties","dummyRule","defineProperty","ruleText","character","SIGNIFICANT_WHITESPACE","styleRule","cssTexts","mediaText","appendMedium","medium","deleteMedium","PAGE_RULE","WEBKIT_KEYFRAMES_RULE","WEBKIT_KEYFRAME_RULE","cssRule","_vendorPrefix","keyText","matcher","matcherText","_getConstructorName","Exception","appendMatcher","deleteMatcher","token","_token","_idx","info","paren","_parseJSComment","_parseJSRexExp","_parseJSString","nextChar","endIdx","commentEndChar","startIdx","_findMatchedIdx","before","legalRegx","isLegal","reg","NOT_FOUND","matched","nextNewLineIdx","mediaRule","importRule","fontFaceRule","keyframesRule","documentRule","atRule","importRule-begin","atBlock","documentRule-begin","currentScope","atKeyframesRegExp","parseError","lines","lineCount","charCount","line","__starts","lastIndex","matchKeyframes","__ends","stylesheet","cloned","RULE_TYPES",1,4,8,9,"rulesLength","ruleClone","styleClone","styleLength","peg$subclass","child","ctor","found","peg$computePosDetails","advance","details","startPos","endPos","ch","seenCR","peg$cachedPos","peg$cachedPosDetails","peg$fail","peg$maxFailPos","peg$currPos","peg$maxFailExpected","peg$buildException","cleanupExpected","description","buildMessage","stringEscape","hex","toUpperCase","expectedDesc","foundDesc","expectedDescs","posDetails","peg$parsestart","s0","s1","peg$parsesourceEntries","peg$FAILED","peg$reportedPos","peg$c1","s2","s3","s4","s5","peg$parsesourceEntry","peg$parsewhitespace","peg$c3","peg$silentFails","peg$c4","peg$c5","peg$c2","peg$c6","peg$parseurlEntry","peg$parselocalEntry","peg$parseurl","peg$parseformat","peg$c7","peg$c8","peg$c9","peg$c10","peg$parsevalue","peg$c11","peg$c12","peg$c13","peg$c14","peg$c15","peg$c16","peg$c17","peg$c18","peg$c19","peg$c20","peg$c21","peg$c22","peg$c23","peg$result","peg$startRuleFunctions","peg$startRuleFunction","chars","extractValue","startRule"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module unless amdModuleId is set\n    define([\"ayepromise\",\"imagediff\",\"rasterizeHTML\"], function (a0,b1,c2) {\n      return (root['csscritic'] = factory(a0,b1,c2));\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(require(\"ayepromise\"),require(\"imagediff\"),require(\"rasterizehtml\"),require(\"../build/csscritic.concat.css\"));\n  } else {\n    root['csscritic'] = factory(ayepromise,imagediff,rasterizeHTML);\n  }\n}(this, function (ayepromise, imagediff, rasterizeHTML) {\n\nvar csscriticLib = {};\n\ncsscriticLib.main = function (regression, reporting, util, storage, selectionFilter) {\n    \"use strict\";\n\n    var module = {};\n\n    var testCases = [],\n        currentComponentLabel;\n\n\n    module.component = function (componentLabel) {\n        currentComponentLabel = componentLabel;\n    };\n\n\n    var supportUrlAsOnlyTestCaseInput = function (testCase) {\n        if (typeof testCase === 'string') {\n            return {\n                url: testCase\n            };\n        }\n        return testCase;\n    };\n\n    module.add = function (testCase) {\n        var augmentedTestCase = util.clone(supportUrlAsOnlyTestCaseInput(testCase));\n\n        if (currentComponentLabel && augmentedTestCase.component === undefined) {\n            augmentedTestCase.component = currentComponentLabel;\n        }\n\n        testCases.push(augmentedTestCase);\n    };\n\n\n    var fetchStartingComparisons = function (testCases) {\n        return util.all(testCases.map(function (testCase) {\n            return storage.readReferenceImage(testCase)\n                .then(function (referenceImageRecord) {\n                    return {\n                        testCase: testCase,\n                        referenceImage: referenceImageRecord.image,\n                        viewport: referenceImageRecord.viewport\n                    };\n                }, function () {\n                    // no referenceImage found\n                    return {\n                        testCase: testCase\n                    };\n                });\n        }));\n    };\n\n    var selectComparisons = function (configuredComparisons) {\n        return configuredComparisons.map(function (configuredComparison) {\n            return {\n                configuredComparison: configuredComparison,\n                selected: !selectionFilter || selectionFilter.isComparisonSelected(configuredComparison)\n            };\n        });\n    };\n\n    var reportConfiguredComparisons = function (comparisonSelection) {\n        return util.all(comparisonSelection.map(function (selection) {\n            var isSelected = selection.selected;\n            return reporting.doReportConfiguredComparison(selection.configuredComparison, isSelected);\n        }));\n    };\n\n    var executeTestCase = function (startingComparison) {\n        return regression.compare(startingComparison).then(function (comparison) {\n            return reporting.doReportComparison(comparison).then(function () {\n                return comparison;\n            });\n        });\n    };\n\n    module.execute = function () {\n        var comparisonSelection, allPassed;\n\n        return fetchStartingComparisons(testCases)\n            .then(function (startingComp) {\n                comparisonSelection = selectComparisons(startingComp);\n\n                return reportConfiguredComparisons(comparisonSelection);\n            })\n            .then(function () {\n                var selectedComparisons = comparisonSelection.filter(function (selection) {\n                    return selection.selected;\n                }).map(function (selection) {\n                    return selection.configuredComparison;\n                });\n\n                return util.all(selectedComparisons.map(\n                    executeTestCase\n                ));\n            })\n            .then(function (comparisons) {\n                allPassed = util.hasTestSuitePassed(comparisons);\n            })\n            .then(function () {\n                return reporting.doReportTestSuite(allPassed);\n            })\n            .then(function () {\n                return allPassed;\n            });\n    };\n\n    return module;\n};\n\ncsscriticLib.regression = function (renderer, util, imagediff) {\n    \"use strict\";\n\n    var module = {};\n\n    var toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux = 1;\n\n    var workAroundFirefoxResourcesSporadicallyMissing = function (htmlImage, referenceImage) {\n        if (referenceImage) {\n            // This does nothing meaningful for us, but seems to trigger Firefox to load any missing resources.\n            imagediff.diff(htmlImage, referenceImage);\n        }\n    };\n\n    var workAroundBrowserIssues = function (pageImage, referenceImage) {\n        workAroundFirefoxResourcesSporadicallyMissing(pageImage, referenceImage);\n\n        return util.workAroundTransparencyIssueInFirefox(pageImage);\n    };\n\n    var compareRenderingAndReference = function (pageImage, referenceImage) {\n        var isEqual;\n\n        return workAroundBrowserIssues(pageImage, referenceImage).then(function (adaptedHtmlImage) {\n            if (referenceImage) {\n                isEqual = imagediff.equal(\n                    adaptedHtmlImage,\n                    referenceImage,\n                    toleranceToWorkAroundFirefoxRenderingAFewPixelsIndeterministicallyOnLinux\n                );\n                return isEqual ? \"passed\" : \"failed\";\n            } else {\n                return \"referenceMissing\";\n            }\n        });\n    };\n\n    var comparisonResult = function (textualStatus, testCase, viewport, renderErrors, pageImage, referenceImage) {\n        var result = {\n            status: textualStatus,\n            testCase: testCase,\n            viewport: util.clone(viewport),\n            renderErrors: renderErrors\n        };\n\n        if (pageImage) {\n            result.pageImage = pageImage;\n        }\n        if (referenceImage) {\n            result.referenceImage = referenceImage;\n        }\n        return result;\n    };\n\n    var loadPageAndCompare = function (testCase, viewport, referenceImage) {\n        return renderer.render({\n            url: testCase.url,\n            hover: testCase.hover,\n            active: testCase.active,\n            width: viewport.width,\n            height: viewport.height\n        }).then(function (renderResult) {\n            return compareRenderingAndReference(renderResult.image, referenceImage).then(function (textualStatus) {\n                return comparisonResult(textualStatus,\n                                        testCase,\n                                        viewport,\n                                        renderResult.errors,\n                                        renderResult.image,\n                                        referenceImage);\n            });\n        }, function () {\n            return comparisonResult(\"error\",\n                                    testCase,\n                                    viewport,\n                                    []);\n        });\n    };\n\n    var viewportFallback = function (testCase) {\n        var fallbackWidth = 800,\n            fallbackHeight = 100;\n        return {\n            width: testCase.width || fallbackWidth,\n            height: testCase.height || fallbackHeight\n        };\n    };\n\n    module.compare = function (startingComparison) {\n        var viewport = startingComparison.viewport;\n\n        if (startingComparison.referenceImage === undefined) {\n            viewport = viewportFallback(startingComparison.testCase);\n        }\n\n        return loadPageAndCompare(startingComparison.testCase, viewport, startingComparison.referenceImage);\n    };\n\n    return module;\n};\n\ncsscriticLib.reporting = function (renderer, storage, util) {\n    \"use strict\";\n\n    var module = {};\n\n    var reporters = [];\n\n    module.addReporter = function (reporter) {\n        reporters.push(reporter);\n    };\n\n    var testCaseIsResizable = function (testCase) {\n        return testCase.width === undefined && testCase.height === undefined;\n    };\n\n    var attachPageAcceptHelpers = function (comparison) {\n        var viewportWidth, viewportHeight;\n\n        if (comparison.pageImage) {\n            viewportWidth = comparison.viewport.width;\n            viewportHeight = comparison.viewport.height;\n\n            if (testCaseIsResizable(comparison.testCase)) {\n                comparison.resizePageImage = function (width, height) {\n                    viewportWidth = width;\n                    viewportHeight = height;\n\n                    return renderer.render({\n                        url: comparison.testCase.url,\n                        hover: comparison.testCase.hover,\n                        active: comparison.testCase.active,\n                        width: width,\n                        height: height\n                    }).then(function (renderResult) {\n                        comparison.pageImage = renderResult.image;\n                        return renderResult.image;\n                    });\n                };\n            }\n            comparison.acceptPage = function () {\n                storage.storeReferenceImage(comparison.testCase, comparison.pageImage, {\n                    width: viewportWidth,\n                    height: viewportHeight\n                });\n            };\n        }\n    };\n\n    var reportingMethod = function (reporter, isSelected) {\n        if (isSelected) {\n            return reporter.reportSelectedComparison;\n        } else {\n            return reporter.reportDeselectedComparison;\n        }\n    };\n\n    module.doReportConfiguredComparison = function (configuredComparison, isSelected) {\n        return util.all(reporters.map(function (reporter) {\n            var reportingFunc = reportingMethod(reporter, isSelected);\n            if (reportingFunc) {\n                return reportingFunc(configuredComparison);\n            }\n        }));\n    };\n\n    module.doReportComparison = function (comparison) {\n        var result = util.clone(comparison);\n\n        attachPageAcceptHelpers(result);\n\n        return util.all(reporters.map(function (reporter) {\n            if (reporter.reportComparison) {\n                return reporter.reportComparison(result);\n            }\n        }));\n    };\n\n    module.doReportTestSuite = function (passed) {\n        return util.all(reporters.map(function (reporter) {\n            if (reporter.reportTestSuite) {\n                return reporter.reportTestSuite({success: passed});\n            }\n        }));\n    };\n\n    return module;\n};\n\ncsscriticLib.util = function () {\n    \"use strict\";\n\n    var module = {};\n\n    module.getDataURIForImage = function (image) {\n        var canvas = window.document.createElement(\"canvas\"),\n            context = canvas.getContext(\"2d\");\n\n        canvas.width = image.naturalWidth;\n        canvas.height = image.naturalHeight;\n\n        context.drawImage(image, 0, 0);\n\n        return canvas.toDataURL(\"image/png\");\n    };\n\n    module.getImageForUrl = function (url) {\n        var defer = ayepromise.defer(),\n            image = new window.Image();\n\n        image.onload = function () {\n            defer.resolve(image);\n        };\n        image.onerror = function () {\n            defer.reject();\n        };\n        image.src = url;\n\n        return defer.promise;\n    };\n\n    var getUncachableURL = function (url) {\n        var delimiter;\n        if (url.indexOf(\"?\") < 0) {\n            delimiter = \"?\";\n        } else {\n            delimiter = \"&\";\n        }\n        return url + delimiter + \"_=\" + Date.now();\n    };\n\n    module.ajax = function (url) {\n        var defer = ayepromise.defer(),\n            xhr = new XMLHttpRequest();\n\n        xhr.onload = function () {\n            if (xhr.status === 200 || xhr.status === 0) {\n                defer.resolve(xhr.response);\n            } else {\n                defer.reject();\n            }\n        };\n\n        xhr.onerror = function () {\n            defer.reject();\n        };\n\n        try {\n            xhr.open('get', getUncachableURL(url), true);\n            xhr.send();\n        } catch (e) {\n            defer.reject();\n        }\n\n        return defer.promise;\n    };\n\n    module.loadAsBlob = function (url) {\n        var defer = ayepromise.defer(),\n            xhr = new XMLHttpRequest();\n\n        xhr.onload = function () {\n            if (xhr.status === 200 || xhr.status === 0) {\n                defer.resolve(xhr.response);\n            } else {\n                defer.reject();\n            }\n        };\n\n        xhr.onerror = function () {\n            defer.reject();\n        };\n\n        try {\n            xhr.open('get', getUncachableURL(url), true);\n            xhr.responseType = 'blob';\n            xhr.send();\n        } catch (e) {\n            defer.reject();\n        }\n\n        return defer.promise;\n    };\n\n    module.loadBlobAsText = function (blob) {\n        var defer = ayepromise.defer(),\n            reader = new FileReader();\n\n        reader.onload = function (e) {\n            defer.resolve(e.target.result);\n        };\n\n        reader.onerror = function () {\n            defer.reject();\n        };\n\n        reader.readAsText(blob);\n\n        return defer.promise;\n    };\n\n    module.loadBlobAsDataURI = function (blob) {\n        var defer = ayepromise.defer(),\n            reader = new FileReader();\n\n        reader.onload = function (e) {\n            defer.resolve(e.target.result);\n        };\n\n        reader.onerror = function () {\n            defer.reject();\n        };\n\n        reader.readAsDataURL(blob);\n\n        return defer.promise;\n\n    };\n\n    // excludeKeys(theMap, excludeKey...)\n    module.excludeKeys = function (theMap) {\n        var excludeKeys = Array.prototype.slice.call(arguments, 1),\n            newMap = {};\n\n        Object.keys(theMap).forEach(function (key) {\n            if (excludeKeys.indexOf(key) === -1) {\n                newMap[key] = theMap[key];\n            }\n        });\n\n        return newMap;\n    };\n\n    module.serializeMap = function (theMap) {\n        var serializationEntries = [],\n            keys = Object.keys(theMap);\n\n        keys.sort();\n        keys.forEach(function (key) {\n            serializationEntries.push(key + '=' + theMap[key]);\n        });\n        return serializationEntries.join(',');\n    };\n\n    module.clone = function (object) {\n        var theClone = {},\n            i;\n        for (i in object) {\n            if (object.hasOwnProperty(i)) {\n               theClone[i] = object[i];\n            }\n        }\n        return theClone;\n    };\n\n    var successfulPromise = function (value) {\n        var defer = ayepromise.defer();\n        defer.resolve(value);\n        return defer.promise;\n    };\n\n    module.workAroundTransparencyIssueInFirefox = function (image) {\n        // Work around bug https://bugzilla.mozilla.org/show_bug.cgi?id=790468 where the content of a canvas\n        //   drawn to another one will be slightly different if transparency is involved.\n        // Here the reference image has been drawn to a canvas once (to serialize it to localStorage), while the\n        //   image of the newly rendered page hasn't.  Solution: apply the same transformation to the second image, too.\n        var dataUri;\n        try {\n            dataUri = module.getDataURIForImage(image);\n        } catch (e) {\n            // Fallback for Chrome & Safari\n            return successfulPromise(image);\n        }\n\n        return module.getImageForUrl(dataUri);\n    };\n\n    module.hasTestSuitePassed = function (comparisons) {\n        var nonPassingTestCases = comparisons.filter(function (comparison) {\n                return comparison.status !== \"passed\";\n            }),\n            allPassed = nonPassingTestCases.length === 0,\n            hasValidTestSetup = comparisons.length > 0;\n\n        return hasValidTestSetup && allPassed;\n    };\n\n    module.all = function (functionReturnValues) {\n        var defer = ayepromise.defer(),\n            pendingFunctionCalls = functionReturnValues.length,\n            resolvedValues = [];\n\n        var functionCallResolved = function (value, idx) {\n            pendingFunctionCalls -= 1;\n            resolvedValues[idx] = value;\n\n            if (pendingFunctionCalls === 0) {\n                defer.resolve(resolvedValues);\n            }\n        };\n\n        if (functionReturnValues.length === 0) {\n            defer.resolve([]);\n            return defer.promise;\n        }\n\n        functionReturnValues.forEach(function (returnValue, idx) {\n            if (returnValue && returnValue.then) {\n                returnValue.then(function (result) {\n                    functionCallResolved(result, idx);\n                }, function (e) {\n                    defer.reject(e);\n                });\n            } else {\n                functionCallResolved(returnValue, idx);\n            }\n        });\n        return defer.promise;\n    };\n\n    return module;\n};\n\ncsscriticLib.browserRenderer = function (util, jobQueue, rasterizeHTML) {\n    \"use strict\";\n\n    var module = {};\n\n    var cache = {};\n\n    var queue;\n\n    var getOrCreateJobQueue = function () {\n        if (!queue) {\n            queue = jobQueue();\n        }\n        return queue;\n    };\n\n    var extractErrorMessages = function (errors) {\n        return errors.map(function (error) {\n            return error.msg;\n        });\n    };\n\n    var logErrorToConsole = function (e) {\n        console.error(e);\n\n        throw e;\n    };\n\n    var doRenderHtml = function (parameters) {\n        var drawOptions = {\n                cache: 'repeated',\n                cacheBucket: cache,\n                width: parameters.width,\n                height: parameters.height,\n                executeJs: true,\n                executeJsTimeout: 50,\n                baseUrl: parameters.baseUrl\n            };\n        if (parameters.hover) {\n            drawOptions.hover = parameters.hover;\n        }\n        if (parameters.active) {\n            drawOptions.active = parameters.active;\n        }\n\n        return rasterizeHTML.drawHTML(parameters.html, drawOptions).then(function (result) {\n            var renderErrors = extractErrorMessages(result.errors);\n\n            return {\n                image: result.image,\n                errors: renderErrors\n            };\n        }, logErrorToConsole);\n    };\n\n    var renderHtmlFromBlob = function (blob, parameters) {\n        return util.loadBlobAsText(blob).then(function (content) {\n            return doRenderHtml({\n                html: content,\n                baseUrl: parameters.url,\n                width: parameters.width,\n                height: parameters.height,\n                hover: parameters.hover,\n                active: parameters.active\n            });\n        });\n    };\n\n    var loadImageFromBlob = function (blob, parameters) {\n        return util.loadBlobAsDataURI(blob)\n            .then(util.getImageForUrl)\n            .then(function (image) {\n                return {\n                    image: image,\n                    errors: []\n                };\n            }, function () {\n                // It's not an image, so it must be a HTML page\n                return renderHtmlFromBlob(blob, parameters);\n            });\n    };\n\n    module.render = function (parameters) {\n        // Execute render jobs one after another to stabilise rendering (especially JS execution).\n        // Also provides a more fluid response. Performance seems not to be affected.\n        return getOrCreateJobQueue().execute(function () {\n            return util.loadAsBlob(parameters.url)\n                .then(function (blob) {\n                    return loadImageFromBlob(blob, parameters);\n                });\n        });\n    };\n\n    return module;\n};\n\ncsscriticLib.fallbackFilter = function (windowLocation) {\n    \"use strict\";\n\n    var module = {};\n\n    var storageKey = 'csscriticFallbackFilter';\n\n    var fullDescription = function (testCase) {\n        return testCase.component ? testCase.component + ' ' + testCase.desc : testCase.desc;\n    };\n\n    module.isComparisonSelected = function (comparison) {\n        var filter = sessionStorage.getItem(storageKey);\n\n        if (!filter) {\n            return true;\n        }\n\n        if (comparison.testCase.desc && fullDescription(comparison.testCase) === filter) {\n            return true;\n        }\n        if (comparison.testCase.component && comparison.testCase.component === filter) {\n            return true;\n        }\n\n        return !filter || comparison.testCase.url === filter;\n    };\n\n    module.filterFor = function (testCase) {\n        var filter;\n\n        if (testCase.desc) {\n            filter = fullDescription(testCase);\n        } else {\n            filter = testCase.url;\n        }\n        sessionStorage.setItem(storageKey, filter);\n\n        windowLocation.reload();\n    };\n\n    module.filterForComponent = function (componentLabel) {\n        sessionStorage.setItem(storageKey, componentLabel);\n\n        windowLocation.reload();\n    };\n\n    module.clearFilter = function () {\n        sessionStorage.removeItem(storageKey);\n\n        windowLocation.reload();\n    };\n\n    return module;\n};\n\ncsscriticLib.indexeddbstorage = function (util) {\n    \"use strict\";\n\n    var module = {};\n\n    var createDb = function(db) {\n        db.createObjectStore('references', { keyPath: \"testCase\" });\n    };\n\n    var getDb = function () {\n        var defer = ayepromise.defer(),\n            request = indexedDB.open('csscritic', 1);\n\n        request.onsuccess = function (event) {\n            var db = event.target.result;\n            defer.resolve(db);\n        };\n        request.onupgradeneeded = function (event) {\n            var db = event.target.result;\n            createDb(db);\n        };\n        return defer.promise;\n    };\n\n    var buildKey = function (testCase) {\n        var testCaseParameters = util.excludeKeys(testCase, 'url'),\n            serializedParameters = util.serializeMap(testCaseParameters),\n            key = testCase.url;\n\n        if (serializedParameters) {\n            key += ',' + serializedParameters;\n        }\n\n        return key;\n    };\n\n    module.storeReferenceImage = function (testCase, referenceImage, viewport) {\n        var defer = ayepromise.defer(),\n            imageUri;\n\n        imageUri = util.getDataURIForImage(referenceImage);\n\n        var key = buildKey(testCase);\n\n        getDb().then(function (db) {\n            var request = db.transaction(['references'], 'readwrite')\n                .objectStore('references')\n                .put({\n                    testCase: key,\n                    reference: {\n                        imageUri: imageUri,\n                        viewport: viewport\n                    }\n                });\n\n            request.onsuccess = function () {\n                db.close();\n\n                defer.resolve();\n            };\n        });\n\n        return defer.promise;\n    };\n\n    module.readReferenceImage = function (testCase) {\n        var defer = ayepromise.defer(),\n            key = buildKey(testCase);\n\n        getDb().then(function (db) {\n            var request = db.transaction(['references'])\n                .objectStore('references')\n                .get(key);\n\n            request.onsuccess = function () {\n                db.close();\n\n                if (request.result === undefined || request.result.reference === undefined || request.result.reference.imageUri === undefined) {\n                    defer.reject();\n                    return;\n                }\n\n                var dataObj = request.result.reference;\n\n                util.getImageForUrl(dataObj.imageUri).then(function (img) {\n                    var viewport = dataObj.viewport || {\n                        width: img.width,\n                        height: img.height\n                    };\n\n                    defer.resolve({\n                        image: img,\n                        viewport: viewport\n                    });\n                }, defer.reject);\n            };\n        });\n\n        return defer.promise;\n    };\n\n    return module;\n};\n\ncsscriticLib.jobQueue = function () {\n    \"use strict\";\n\n    var module = {};\n\n    var jobQueue = [],\n        busy = false;\n\n    var runJob = function (job) {\n        var result = job.func();\n\n        job.resolve(result);\n        return result;\n    };\n\n    var nextInQueue = function () {\n        var job;\n        if (jobQueue.length > 0) {\n            busy = true;\n\n            job = jobQueue.shift();\n\n            runJob(job)\n                .then(nextInQueue, nextInQueue);\n        } else {\n            busy = false;\n        }\n    };\n\n    var constructJob = function (func) {\n        var defer = ayepromise.defer();\n\n        return {\n            func: func,\n            resolve: defer.resolve,\n            promise: defer.promise\n        };\n    };\n\n    module.execute = function (func) {\n        var job = constructJob(func);\n\n        jobQueue.push(job);\n        if (!busy) {\n            nextInQueue();\n        }\n\n        return job.promise;\n    };\n\n    return module;\n};\n\ncsscriticLib.niceReporter = function (window, util, selectionFilter, pageNavigationHandlingFallback, rasterizeHTML, packageVersion) {\n    \"use strict\";\n\n    var module = {};\n\n    // our very own templating implementation\n\n    var escapeValue = function (value) {\n        return value.toString()\n            .replace(/&/g, '&amp;')\n            .replace(new RegExp('<'), '&lt;', 'g') // work around https://github.com/cburgmer/inlineresources/issues/2\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&apos;');\n    };\n\n    var template = function (templateStr, values) {\n        return templateStr.replace(/\\{\\{(\\w+)\\}\\}/g, function (_, param) {\n            var value = values[param] !== undefined ? values[param] : '';\n            return escapeValue(value);\n        });\n    };\n\n    var elementFor = function (htmlString) {\n        var tmp = document.createElement('body');\n        tmp.insertAdjacentHTML('beforeend', htmlString);\n        return tmp.firstChild;\n    };\n\n    var findElementIn = function (container, elementClassName) {\n        return container.querySelector('.' + elementClassName);\n    };\n\n    var escapeId = function (id) {\n        return id.replace(/ /g, '_');\n    };\n\n    // container\n\n    var headerClassName = 'header',\n        timeTakenClassName = 'timeTaken',\n        progressBarClassName = 'progressBar',\n        statusTextClassName = 'statusText';\n\n    var createContainer = function (parentContainer) {\n        var reportBody = elementFor('<div class=\"cssCriticNiceReporter\"></div>');\n\n        showHeader(reportBody);\n\n        parentContainer.appendChild(reportBody);\n\n        return reportBody;\n    };\n\n    var elementDimensions = function (element) {\n        var initialPosition = element.getBoundingClientRect(),\n            scrollOffsetTop = document.body.scrollTop || document.documentElement.scrollTop,\n            scrollOffsetLeft = document.body.scrollLeft || document.documentElement.scrollLeft;\n\n        return {\n            top: initialPosition.top + scrollOffsetTop,\n            left: initialPosition.left + scrollOffsetLeft,\n            right: initialPosition.right - initialPosition.width + scrollOffsetLeft,\n            height: initialPosition.height\n        };\n    };\n\n    var px = function (value) {\n        return value + 'px';\n    };\n\n    var makeElementFixedOnScroll = function (element) {\n        var scrollingClass = 'scrolling',\n            smallClass = 'small',\n            smallScrollThreshold = 50,\n            isScrolling = false,\n            isSmall = false,\n            pseudoInlineElement = document.createElement('div'),\n            dimensions;\n\n        window.addEventListener(\"scroll\", function () {\n            if (window.scrollY > 0) {\n                if (! isScrolling) {\n                    isScrolling = true;\n\n                    dimensions = elementDimensions(element);\n\n                    element.classList.add(scrollingClass);\n\n                    element.style.position = 'fixed';\n                    element.style.top = px(dimensions.top);\n                    element.style.left = px(dimensions.left);\n                    element.style.right = px(dimensions.right);\n\n                    pseudoInlineElement.style.height = px(dimensions.height);\n                    element.parentElement.insertBefore(pseudoInlineElement, element);\n                }\n                if (! isSmall && window.scrollY > smallScrollThreshold) {\n                    isSmall = true;\n                    element.classList.add(smallClass);\n                } else if (isSmall && window.scrollY <= smallScrollThreshold) {\n                    isSmall = false;\n                    element.classList.remove(smallClass);\n                }\n            } else {\n                if (isScrolling) {\n                    isScrolling = false;\n\n                    element.classList.remove(scrollingClass);\n                    element.classList.remove(smallClass);\n\n                    element.style.position = '';\n                    element.style.top = '';\n                    element.style.left = '';\n                    element.style.right = '';\n\n                    element.parentElement.removeChild(pseudoInlineElement);\n                }\n            }\n        });\n    };\n\n    var showHeader = function (container) {\n        var header = elementFor(template('<header class=\"{{headerClassName}}\">' +\n                                         '<span class=\"{{timeTakenClassName}}\"></span>' +\n                                         '<a href=\"http://cburgmer.github.io/csscritic/\" class=\"cssCriticVersion\">' +\n                                         'CSS Critic {{packageVersion}}' +\n                                         '</a>' +\n                                         '<ul class=\"{{progressBarClassName}}\"></ul>' +\n                                         '<div class=\"{{statusTextClassName}}\" class=\"statusText\"></div>' +\n                                         '</header>', {\n                                             headerClassName: headerClassName,\n                                             timeTakenClassName: timeTakenClassName,\n                                             progressBarClassName: progressBarClassName,\n                                             statusTextClassName: statusTextClassName,\n                                             packageVersion: packageVersion\n                                         }));\n\n        makeElementFixedOnScroll(header);\n        container.appendChild(header);\n    };\n\n    // document title\n\n    var originalTitle;\n\n    var updateStatusInDocumentTitle = function (totalCount, doneCount) {\n        if (originalTitle === undefined) {\n            originalTitle = document.title;\n        }\n\n        document.title = \"(\" + doneCount + \"/\" + totalCount + \") \" + originalTitle;\n    };\n\n    // header\n\n    var padNumber = function (number, length) {\n        number += '';\n        while (number.length < length) {\n            number = \"0\" + number;\n        }\n        return number;\n    };\n\n    var renderMilliseconds = function (time) {\n        var seconds = Math.floor(time / 1000),\n            milliSeconds = time % 1000;\n        return seconds + '.' + padNumber(milliSeconds, 3);\n    };\n\n    var showTimeTaken = function (container, timeTakenInMillis) {\n        var timeTaken = findElementIn(container, timeTakenClassName);\n        timeTaken.textContent = \"finished in \" + renderMilliseconds(timeTakenInMillis) + \"s\";\n    };\n\n    var setOutcomeOnHeader = function (container, successful) {\n        var header = findElementIn(container, headerClassName);\n\n        header.classList.add(successful ? 'pass' : 'fail');\n    };\n\n    // progress bar\n\n    var progressBarPendingClassName = 'pending';\n\n    var testDescription = function (testCase) {\n        var component;\n        if (testCase.desc) {\n            component = testCase.component ? testCase.component + ' ' : '';\n            return component + testCase.desc;\n        } else {\n            return comparisonKey(testCase);\n        }\n    };\n\n    var addTickToProgressBar = function (container, testCase, linkTarget) {\n        var progressBar = findElementIn(container, progressBarClassName),\n            clickableTickTemplate = '<li><a href=\"#{{linkTarget}}\" title=\"{{title}}\"></a></li>',\n            deactivatedTickTemplate = '<li><a title=\"{{title}}\"></a></li>',\n            tickTemplate = linkTarget ? clickableTickTemplate : deactivatedTickTemplate;\n\n        var tick = elementFor(template(tickTemplate, {\n            linkTarget: linkTarget ? escapeId(linkTarget) : '',\n            title: testDescription(testCase)\n        }));\n        tick.classList.add(progressBarPendingClassName);\n        progressBar.appendChild(tick);\n\n        if (pageNavigationHandlingFallback) {\n            pageNavigationHandlingFallback.install(tick.querySelector('a'));\n        }\n\n        return tick;\n    };\n\n    var markTickDone = function (status, renderErrorCount, tickElement) {\n        tickElement.classList.remove(progressBarPendingClassName);\n        tickElement.classList.add(status);\n        if (renderErrorCount > 0) {\n            tickElement.classList.add('hasRenderErrors');\n        }\n    };\n\n    // status bar\n\n    var singularPlural = function (value, singularForm, pluralForm) {\n        if (value === 1) {\n            return singularForm;\n        } else {\n            return pluralForm;\n        }\n    };\n\n    var statusTotalText = function (totalCount, selectedCount) {\n        var totalContent = '{{total}} ' + singularPlural(totalCount, 'entry', 'entries') + ', ';\n        if (selectedCount < totalCount) {\n            totalContent = '{{selected}} of ' + totalContent;\n        }\n        return template('<span>' +\n                        totalContent +\n                        '</span>', {\n            total: totalCount,\n            selected: selectedCount\n        });\n    };\n\n    var statusIssueText = function (issueCount, selectedCount, doneCount) {\n        var issueContent = '{{issues}} ' + singularPlural(issueCount, 'needs', 'need') + ' some love',\n            doneContent = 'all good',\n            noTestsContent = \"nothing here yet\",\n            doneWithoutErrors = selectedCount === doneCount && issueCount === 0,\n            content;\n        if (selectedCount === 0) {\n            content = noTestsContent;\n        } else if (doneWithoutErrors) {\n            content = doneContent;\n        } else {\n            content = issueContent;\n        }\n        return template('<span>' +\n                        content +\n                        '</span>', {\n                            issues: issueCount\n                        });\n    };\n\n    var acceptAllClassName = 'acceptAll';\n\n    var acceptAllButton = function () {\n        return elementFor(template('<button class=\"{{acceptAllClassName}}\">... accept all (I know what I\\'m doing)</button>', {\n            acceptAllClassName: acceptAllClassName\n        }));\n    };\n\n    var showAcceptAllButtonIfNeccessary = function (container, acceptableEntries) {\n        var statusText = findElementIn(container, statusTextClassName),\n            button = statusText.querySelector('.' + acceptAllClassName);\n\n        if (acceptableEntries.length > 2) {\n            button.classList.add('active');\n            button.onclick = function () {\n                acceptableEntries.forEach(function (acceptableEntry) {\n                    acceptableEntry.acceptPage();\n                    acceptComparison(acceptableEntry.entry);\n                });\n\n                button.setAttribute('disabled', 'disabled');\n            };\n        }\n    };\n\n    var installFallbackClearSelectionHandler = function (element) {\n        if (selectionFilter.clearFilter) {\n            element.onclick = function (e) {\n                selectionFilter.clearFilter();\n                e.preventDefault();\n            };\n        }\n    };\n\n    var updateStatusBar = function (container, totalCount, selectedCount, issueCount, doneCount) {\n        var runAllUrl = selectionFilter.clearFilterUrl ? selectionFilter.clearFilterUrl() : '#',\n            runAll = elementFor(template('<a class=\"runAll\" href=\"{{url}}\">Run all</a>', {\n                url: runAllUrl\n            })),\n            statusText = findElementIn(container, statusTextClassName);\n\n        statusText.innerHTML = '';\n        statusText.appendChild(elementFor(statusTotalText(totalCount, selectedCount)));\n        statusText.appendChild(elementFor(statusIssueText(issueCount, selectedCount, doneCount)));\n        statusText.appendChild(acceptAllButton());\n        if (totalCount > selectedCount) {\n            installFallbackClearSelectionHandler(runAll);\n            statusText.appendChild(runAll);\n        }\n    };\n\n    // ToC\n\n    var getOrCreateToc = function (container) {\n        var tocClassName = 'tocParent',\n            toc = container.querySelector('.' + tocClassName);\n\n        if (!toc) {\n            toc = elementFor(template('<div class=\"{{className}}\"><ul class=\"toc\"></ul></div>', {\n                className: tocClassName\n            }));\n            container.querySelector('.' + headerClassName).appendChild(toc);\n        }\n        return toc.querySelector('ul');\n    };\n\n    var addTocEntry = function (container, componentLabel, linkTarget) {\n        var toc = getOrCreateToc(container),\n            entry = elementFor(template('<li class=\"tocEntry\">' +\n                                        '<a href=\"#{{linkTarget}}\">{{headline}}</a>' +\n                                        '</li>', {\n                                            linkTarget: escapeId(linkTarget),\n                                            headline: componentLabel\n                                        }));\n\n        if (pageNavigationHandlingFallback) {\n            pageNavigationHandlingFallback.install(entry.querySelector('a'));\n        }\n\n        toc.appendChild(entry);\n    };\n\n    // component headline\n\n    var installFallbackComponentSelectionHandler = function (element, componentLabel) {\n        if (selectionFilter.filterForComponent) {\n            element.onclick = function (e) {\n                selectionFilter.filterForComponent(componentLabel);\n                e.preventDefault();\n            };\n        }\n    };\n\n    var addComponentHeading = function (container, componentLabel) {\n        var filterUrl = selectionFilter.filterUrlForComponent ? selectionFilter.filterUrlForComponent(componentLabel) : '#',\n            headlineElement = elementFor(template('<h2 class=\"componentLabel\"><a href=\"{{filterUrl}}\">{{headline}}</a></h2>', {\n                headline: componentLabel,\n                filterUrl: filterUrl\n            }));\n\n        installFallbackComponentSelectionHandler(headlineElement, componentLabel);\n        container.appendChild(headlineElement);\n    };\n\n    // comparisons\n\n    var comparisonKey = function (testCase) {\n        var testCaseParameters = util.excludeKeys(testCase, 'url'),\n            serializedParameters = util.serializeMap(testCaseParameters),\n            key = testCase.url;\n\n        if (serializedParameters) {\n            return key + ',' + serializedParameters;\n        }\n\n        return key;\n    };\n\n    var runningComparisonClassName = 'running',\n        imageContainerClassName = 'imageContainer',\n        errorContainerClassName = 'errorText';\n\n    var imageWrapper = function (image) {\n        var wrapper = elementFor('<div class=\"imageWrapper\"></div>');\n        wrapper.appendChild(image);\n        return wrapper;\n    };\n\n    var serializeValue = function (value) {\n        if (typeof value === 'string') {\n            return \"'\" + value + \"'\";\n        }\n        return value;\n    };\n\n    var testCaseParameters = function (testCase) {\n        var parameters = util.excludeKeys(testCase, 'url', 'desc', 'component'),\n            keys = Object.keys(parameters);\n\n        if (!keys.length) {\n            return '';\n        }\n        keys.sort();\n\n        return '<dl class=\"parameters\">' +\n            keys.map(function (key) {\n                return template('<dt>{{key}}</dt><dd>{{value}}</dd>', {\n                    key: key,\n                    value: serializeValue(parameters[key])\n                });\n            }).join('\\n') +\n            '</dl>';\n    };\n\n    var installFallbackSelectionHandler = function (element, testCase) {\n        if (selectionFilter.filterFor) {\n            element.onclick = function (e) {\n                selectionFilter.filterFor(testCase);\n                e.preventDefault();\n            };\n        }\n    };\n\n    var addComparison = function (container, testCase, referenceImage, key) {\n        var titleLinkClassName = 'titleLink',\n            filterUrl = selectionFilter.filterUrlFor ? selectionFilter.filterUrlFor(testCase) : '#',\n            comparison = elementFor(template('<section class=\"comparison {{runningComparisonClassName}}\">' +\n                                             '<h3 class=\"title\">' +\n                                             '<a class=\"{{titleLinkClassName}}\" href=\"{{filterUrl}}\">{{title}}</a> ' +\n                                             '<a class=\"externalLink\" href=\"{{url}}\"></a>' +\n                                             testCaseParameters(testCase) +\n                                             '</h3>' +\n                                             '<div class=\"{{errorContainerClassName}}\"></div>' +\n                                             '<div><div class=\"{{imageContainerClassName}}\"></div></div>' +\n                                             '</section>', {\n                                                 url: testCase.url,\n                                                 title: testCase.desc ? testCase.desc : testCase.url,\n                                                 filterUrl: filterUrl,\n                                                 runningComparisonClassName: runningComparisonClassName,\n                                                 errorContainerClassName: errorContainerClassName,\n                                                 imageContainerClassName: imageContainerClassName,\n                                                 titleLinkClassName: titleLinkClassName\n                                             })),\n            anchorTarget = elementFor(template('<span class=\"fixedHeaderAnchorTarget\" id=\"{{id}}\"></span>', {\n                id: escapeId(key)\n            })),\n            imageContainer = comparison.querySelector('.' + imageContainerClassName),\n            titleLink = comparison.querySelector('.' + titleLinkClassName);\n\n        if (referenceImage) {\n            imageContainer.appendChild(imageWrapper(referenceImage));\n        }\n        installFallbackSelectionHandler(titleLink, testCase);\n\n        container.appendChild(anchorTarget);\n        container.appendChild(comparison);\n\n        return comparison;\n    };\n\n    var canvasForImageCanvas = function (imageData) {\n        var canvas = document.createElement(\"canvas\"),\n            context;\n\n        canvas.height = imageData.height;\n        canvas.width  = imageData.width;\n\n        context = canvas.getContext(\"2d\");\n        context.putImageData(imageData, 0, 0);\n\n        return canvas;\n    };\n\n    var diffPageImages = function (imageA, imageB) {\n        return imagediff.diff(imageA, imageB, {align: 'top'});\n    };\n\n    var embossChanges = function (imageData) {\n        var d = imageData.data,\n            i;\n        for (i = 0; i < d.length; i += 4) {\n            if (d[i] === 0 && d[i+1] === 0 && d[i+2] === 0) {\n                d[i+3] = 0;\n            } else {\n                d[i] = 0;\n                d[i+1] = 0;\n                d[i+2] = 255;\n                d[i+3] = 255;\n            }\n        }\n        return imageData;\n    };\n\n    var getDifferenceCanvas = function (imageA, imageB) {\n        var differenceImageData = diffPageImages(imageA, imageB),\n            canvas = canvasForImageCanvas(embossChanges(differenceImageData));\n\n        canvas.classList.add('diff');\n        return canvas;\n    };\n\n    // Use a canvas for display to work around https://bugzilla.mozilla.org/show_bug.cgi?id=986403\n    var canvasForImage = function (image) {\n        var canvas = document.createElement(\"canvas\"),\n            width  = image.naturalWidth,\n            height = image.naturalHeight,\n            context;\n\n        canvas.width  = width;\n        canvas.height = height;\n\n        context = canvas.getContext(\"2d\");\n        context.drawImage(image, 0, 0, width, height);\n\n        // fix size in css so the tests will show something (canvas is not supported so far)\n        canvas.style.width = width + 'px';\n        canvas.style.height = height + 'px';\n\n        return canvas;\n    };\n\n    var addImageDiff = function (image, imageForDiff, container) {\n        var imageContainer = container.querySelector('.' + imageContainerClassName);\n\n        imageContainer.appendChild(getDifferenceCanvas(image, imageForDiff));\n    };\n\n    var acceptClassName = 'accept';\n\n    var acceptComparison = function (container) {\n        var acceptButton = container.querySelector('.' + acceptClassName);\n        acceptButton.setAttribute('disabled', 'disabled');\n        acceptButton.textContent = \"\";\n        container.classList.add('accepted');\n    };\n\n    var changedImageContainer = function (pageImage, acceptPage, container) {\n        var changedImageContainerClassName = 'changedImageContainer',\n            outerChangedImageContainer = elementFor(template('<div class=\"outerChangedImageContainer\">' +\n                                                             '<div class=\"{{changedImageContainerClassName}}\"></div>' +\n                                                             '<button class=\"{{acceptClassName}}\"><span>Accept</span></button>' +\n                                                             '</div>', {\n                                                                 changedImageContainerClassName: changedImageContainerClassName,\n                                                                 acceptClassName: acceptClassName\n                                                             })),\n            changedImageContainer = outerChangedImageContainer.querySelector('.' + changedImageContainerClassName),\n            acceptButton = outerChangedImageContainer.querySelector('button');\n\n        changedImageContainer.appendChild(imageWrapper(pageImage));\n        acceptButton.onclick = function () {\n            acceptPage();\n            acceptComparison(container);\n        };\n\n        return outerChangedImageContainer;\n    };\n\n    var showComparisonWithDiff = function (pageImage, referenceImage, acceptPage, container) {\n        addImageDiff(referenceImage, pageImage, container);\n        container.appendChild(changedImageContainer(canvasForImage(pageImage), acceptPage, container));\n    };\n\n    var pageAsIframe = function (pageImage, testCaseUrl) {\n        var iframe = document.createElement('iframe');\n        iframe.width = pageImage.width;\n        iframe.height = pageImage.height;\n        iframe.src = testCaseUrl;\n        iframe.scrolling = \"no\";\n        return iframe;\n    };\n\n    var showComparisonWithRenderedPage = function (pageImage, testCaseUrl, container) {\n        var imageContainer = container.querySelector('.' + imageContainerClassName);\n\n        imageContainer.innerHTML = '';\n        imageContainer.appendChild(imageWrapper(canvasForImage(pageImage)));\n\n        imageContainer.addEventListener('dblclick', function () {\n            imageContainer.innerHTML = '';\n            imageContainer.appendChild(imageWrapper(pageAsIframe(pageImage, testCaseUrl)));\n\n            imageContainer.classList.add('realView');\n        }, false);\n    };\n\n    var showComparisonWithoutReference = function (pageImage, acceptPage, container) {\n        container.appendChild(changedImageContainer(canvasForImage(pageImage), acceptPage, container));\n    };\n\n    var sameOriginWarning = 'Make sure the path lies within the ' +\n        '<a href=\"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\">' +\n        'same origin' +\n        '</a> ' +\n        'as this document.';\n\n    var showComparisonWithError = function (url, container) {\n        var errorMsg = elementFor(template('<span>' +\n                                           'The page \"{{url}}\" could not be rendered. ' +\n                                           sameOriginWarning +\n                                           '</span>', {\n                                               url: url\n                                           })),\n            errorContainer = container.querySelector('.' + errorContainerClassName);\n        errorContainer.appendChild(errorMsg);\n    };\n\n    var showRenderErrors = function (errors, container) {\n        var errorMsg = elementFor(template('<span>' +\n                                           'Had the following errors rendering the page:' +\n                                           '<ul></ul>' +\n                                           sameOriginWarning +\n                                           '</span>')),\n            listElement = errorMsg.querySelector('ul'),\n            errorContainer = container.querySelector('.' + errorContainerClassName);\n\n        errors.map(function (error) {\n            return elementFor(template('<li>{{msg}}</li>', {msg: error}));\n        }).forEach(function (li) {\n            listElement.appendChild(li);\n        });\n\n        errorContainer.appendChild(errorMsg);\n    };\n\n    var updateComparisonStatus = function (status, container) {\n        container.classList.remove(runningComparisonClassName);\n        container.classList.add(status);\n    };\n\n    // browser warning\n\n    var supportsReadingHtmlFromCanvas = function () {\n        return rasterizeHTML.drawHTML('<b></b>').then(function (result) {\n            var canvas = document.createElement(\"canvas\"),\n                context = canvas.getContext(\"2d\");\n            try {\n                context.drawImage(result.image, 0, 0);\n                // This will fail in Chrome & Safari\n                canvas.toDataURL(\"image/png\");\n                return true;\n            } catch (e) {\n                return false;\n            }\n        });\n    };\n\n    var browserIssueChecked = false;\n\n    var showBrowserWarningIfNeeded = function (container) {\n        if (browserIssueChecked) {\n            return;\n        }\n        browserIssueChecked = true;\n\n        supportsReadingHtmlFromCanvas().then(function (supported) {\n            if (supported) {\n                return;\n            }\n\n            container.appendChild(elementFor(\n                '<div class=\"browserWarning\">' +\n                    'Your browser is currently not supported, ' +\n                    'as it does not support reading rendered HTML from the canvas ' +\n                    '(<a href=\"https://code.google.com/p/chromium/issues/detail?id=294129\">Chrome #294129</a>, ' +\n                    '<a href=\"https://bugs.webkit.org/show_bug.cgi?id=17352\">Safari #17352</a>). How about trying Firefox?' +\n                    '</div>'\n            ));\n        });\n    };\n\n    // the reporter\n\n    module.NiceReporter = function (outerContainer) {\n        var totalCount = 0,\n            selectedCount = 0,\n            doneCount = 0,\n            issueCount = 0,\n            progressTickElements = {},\n            runningComparisonEntries = {},\n            acceptableComparisons = [],\n            containerElement, timeStarted, lastComponentLabel;\n\n        var container = function () {\n            if (!containerElement) {\n                containerElement = createContainer(outerContainer || document.body);\n            }\n            return containerElement;\n        };\n\n        var registerComparison = function () {\n            totalCount += 1;\n            if (!timeStarted) {\n                timeStarted = Date.now();\n            }\n\n            showBrowserWarningIfNeeded(container());\n            updateStatusInDocumentTitle(totalCount, doneCount);\n            updateStatusBar(container(), totalCount, selectedCount, issueCount);\n        };\n\n        return {\n            reportDeselectedComparison: function (comparison) {\n                registerComparison();\n\n                addTickToProgressBar(container(), comparison.testCase);\n            },\n            reportSelectedComparison: function (comparison) {\n                var key = comparisonKey(comparison.testCase);\n                selectedCount += 1;\n\n                if (comparison.testCase.component && comparison.testCase.component !== lastComponentLabel) {\n                    lastComponentLabel = comparison.testCase.component;\n                    addComponentHeading(container(), comparison.testCase.component);\n                    addTocEntry(container(), comparison.testCase.component, key);\n                }\n\n                registerComparison();\n\n                var tickElement = addTickToProgressBar(container(), comparison.testCase, key);\n                progressTickElements[key] = tickElement;\n\n                var comparisonElement = addComparison(container(),\n                                                      comparison.testCase,\n                                                      comparison.referenceImage,\n                                                      key);\n                runningComparisonEntries[key] = comparisonElement;\n            },\n            reportComparison: function (comparison) {\n                var key = comparisonKey(comparison.testCase),\n                    tickElement = progressTickElements[key],\n                    entry = runningComparisonEntries[key];\n\n                doneCount += 1;\n                if (comparison.status !== 'passed') {\n                    issueCount += 1;\n                }\n\n                updateStatusInDocumentTitle(totalCount, doneCount);\n                updateStatusBar(container(), totalCount, selectedCount, issueCount, doneCount);\n                markTickDone(comparison.status, comparison.renderErrors.length, tickElement);\n\n                if (comparison.status === 'failed') {\n                    showComparisonWithDiff(comparison.pageImage,\n                                           comparison.referenceImage,\n                                           comparison.acceptPage,\n                                           entry);\n                    acceptableComparisons.push(comparison);\n                } else if (comparison.status === 'referenceMissing') {\n                    showComparisonWithoutReference(comparison.pageImage,\n                                                   comparison.acceptPage,\n                                                   entry);\n                    acceptableComparisons.push(comparison);\n                } else if (comparison.status === 'passed') {\n                    showComparisonWithRenderedPage(comparison.pageImage,\n                                                   comparison.testCase.url,\n                                                   entry);\n                } else if (comparison.status === 'error') {\n                    showComparisonWithError(comparison.testCase.url,\n                                            entry);\n                }\n\n                if (comparison.renderErrors.length > 0) {\n                    showRenderErrors(comparison.renderErrors, entry);\n                }\n\n                updateComparisonStatus(comparison.status, entry);\n            },\n            reportTestSuite: function (result) {\n                var acceptableEntries = acceptableComparisons.map(function (comparison) {\n                    var key = comparisonKey(comparison.testCase);\n                    return {\n                        acceptPage: comparison.acceptPage,\n                        entry: runningComparisonEntries[key]\n                    };\n                });\n\n                updateStatusInDocumentTitle(totalCount, doneCount);\n                updateStatusBar(container(), totalCount, selectedCount, issueCount, doneCount);\n\n                showTimeTaken(container(), timeStarted ? Date.now() - timeStarted : 0);\n                setOutcomeOnHeader(container(), result.success);\n                showAcceptAllButtonIfNeccessary(container(), acceptableEntries);\n            }\n        };\n    };\n\n    return module;\n};\n\n/* Work around https://bugzilla.mozilla.org/show_bug.cgi?id=1005634\n * Replaces anchors with inner page targets with a JavaScript navigation handling implementation.\n */\ncsscriticLib.pageNavigationHandlingFallback = function () {\n    \"use strict\";\n\n    var module = {};\n\n    var fakeTargetClassName = 'fakeTarget';\n\n    var clearFakeActiveClass = function () {\n        var previousTargets = Array.prototype.slice.call(document.querySelectorAll('.' + fakeTargetClassName));\n        previousTargets.forEach(function (elem) {\n            elem.classList.remove(fakeTargetClassName);\n        });\n    };\n\n    var triggerFakeActiveClass = function (targetElement) {\n        targetElement.classList.add(fakeTargetClassName);\n    };\n\n    var scrollTo = function (id) {\n        var targetElement;\n\n        clearFakeActiveClass();\n        if (id) {\n            targetElement = document.getElementById(id);\n            targetElement.scrollIntoView();\n            triggerFakeActiveClass(targetElement);\n        } else {\n            window.scrollTo(0, 0);\n        }\n    };\n\n    var globalNavigationHandlingInstalled = false;\n\n    var installGlobalNavigationHandling = function () {\n        if (!globalNavigationHandlingInstalled) {\n            globalNavigationHandlingInstalled = true;\n\n            window.onpopstate = function (e) {\n                scrollTo(e.state);\n            };\n        }\n    };\n\n    module.install = function (element) {\n        installGlobalNavigationHandling();\n\n        element.onclick = function (e) {\n            var targetLink = decodeURIComponent(e.target.href),\n                targetId = targetLink.substr(targetLink.indexOf('#')+1);\n\n            scrollTo(targetId);\n            history.pushState(targetId, targetId);\n            e.preventDefault();\n        };\n    };\n\n    return module;\n};\n\ncsscriticLib.urlQueryFilter = function (windowLocation) {\n    \"use strict\";\n\n    var module = {};\n\n    var filterParam = 'filter';\n\n    var parseUrlSearch = function (search) {\n        var paramString = search.replace(/^\\?/, '');\n        if (!paramString) {\n            return [];\n        }\n        return paramString\n            .split('&')\n            .map(function (keyValue) {\n                var equalsIdx = keyValue.indexOf('='),\n                    key, value;\n\n                if (equalsIdx >= 0) {\n                    key = keyValue.substr(0, equalsIdx);\n                    value = keyValue.substr(equalsIdx + 1);\n                } else {\n                    key = keyValue;\n                }\n                return {\n                    key: key,\n                    value: value\n                };\n            });\n    };\n\n    var serializeKeyValuePair = function (pair) {\n        if (pair.value) {\n            return pair.key + '=' + pair.value;\n        }\n        return pair.key;\n    };\n\n    var getFilterValue = function () {\n        var filterKeyValue = parseUrlSearch(windowLocation.search)\n                .filter(function (entryPair) {\n                    return entryPair.key === filterParam;\n                })\n                .pop();\n\n        if (filterKeyValue) {\n            return decodeURIComponent(filterKeyValue.value);\n        }\n    };\n\n    var fullDescription = function (testCase) {\n        return testCase.component ? testCase.component + ' ' + testCase.desc : testCase.desc;\n    };\n\n    var filter = getFilterValue(),\n        existingQueryParams = parseUrlSearch(windowLocation.search);\n\n    // interface towards main.js\n\n    module.isComparisonSelected = function (comparison) {\n        if (!filter) {\n            return true;\n        }\n\n        if (comparison.testCase.desc && fullDescription(comparison.testCase) === filter) {\n            return true;\n        }\n        if (comparison.testCase.component && comparison.testCase.component === filter) {\n            return true;\n        }\n        return comparison.testCase.url === filter;\n    };\n\n    // interface towards browser reporters\n\n    var queryPart = function (selection) {\n        var queryParams = existingQueryParams\n                .filter(function (pair) {\n                    return pair.key !== filterParam;\n                });\n        if (selection) {\n            queryParams.push({\n                key: filterParam,\n                value: encodeURIComponent(selection)\n            });\n        }\n\n        return '?' + queryParams.map(serializeKeyValuePair).join('&');\n    };\n\n    module.filterUrlForComponent = function (componentLabel) {\n        return queryPart(componentLabel);\n    };\n\n    module.filterUrlFor = function (testCase) {\n        if (testCase.desc) {\n            return queryPart(fullDescription(testCase));\n        }\n        return queryPart(testCase.url);\n    };\n\n    module.clearFilterUrl = function () {\n        return queryPart();\n    };\n\n    return module;\n};\n\ncsscriticLib.packageVersion = '1.1.0';\n\n/* exported csscritic */\nvar csscritic = (function () {\n    \"use strict\";\n\n    var installCallChain = function (func, self) {\n        return function chainableProxy() {\n            func.apply(null, arguments);\n            return self;\n        };\n    };\n\n    var startsWith = function (str, prefix) {\n        // PhantomJS has no startsWith\n        return str.substr(0, prefix.length) === prefix;\n    };\n\n    // Work around https://bugzilla.mozilla.org/show_bug.cgi?id=1005634\n    var needsFallback = function () {\n        return startsWith(window.location.href, 'file://');\n    };\n\n    var packageVersion = csscriticLib.packageVersion || 'dev',\n        util = csscriticLib.util();\n\n    var indexedDbStorage = csscriticLib.indexeddbstorage(util);\n\n    var browserRenderer = csscriticLib.browserRenderer(util, csscriticLib.jobQueue, rasterizeHTML),\n        reporting = csscriticLib.reporting(browserRenderer, indexedDbStorage, util),\n        regression = csscriticLib.regression(browserRenderer, util, imagediff),\n        queryFilter = csscriticLib.urlQueryFilter(window.location),\n        fallbackFilter = csscriticLib.fallbackFilter(window.location);\n\n    var filter = needsFallback() ? fallbackFilter : queryFilter;\n\n    var main = csscriticLib.main(\n        regression,\n        reporting,\n        util,\n        indexedDbStorage,\n        filter\n    );\n\n    var pageNavigationHandlingFallback = csscriticLib.pageNavigationHandlingFallback(window.location),\n        niceReporter = csscriticLib.niceReporter(\n            window,\n            util,\n            filter,\n            needsFallback() ? pageNavigationHandlingFallback : undefined,\n            rasterizeHTML,\n            packageVersion\n        );\n\n\n    var self = {};\n\n    self.add = installCallChain(main.add, self);\n    self.component = installCallChain(main.component, self);\n    self.execute = main.execute;\n\n    self.addReporter = installCallChain(reporting.addReporter, self);\n\n    self.NiceReporter = niceReporter.NiceReporter;\n\n    return self;\n}());\n\nreturn csscritic;\n\n}));\n","var css = \".cssCriticNiceReporter{font-family:sans-serif;font-size:16px}.cssCriticNiceReporter a{text-decoration:none;color:inherit}.cssCriticNiceReporter .comparison .title .titleLink:hover,.cssCriticNiceReporter .componentLabel:hover,.cssCriticNiceReporter .errorText a{text-decoration:underline}.cssCriticNiceReporter button{padding:2px 10px;border-radius:3px;border:none;background-color:#00c04e;font-size:inherit;font-family:inherit}.cssCriticNiceReporter button[disabled]{background-color:#ddd}.cssCriticNiceReporter button:hover{background-color:#24d66c}.cssCriticNiceReporter button:not([disabled]):active{background-color:#4cec8d}.cssCriticNiceReporter .errorText{color:#591100;margin-bottom:1em}.cssCriticNiceReporter .errorText:not(:empty)::before{content:\\\"\\\";color:#591100;font-size:1.2rem;padding-right:5px;vertical-align:middle}.cssCriticNiceReporter .errorText ul{margin:.2em 0}.cssCriticNiceReporter .header{padding:15px;transition:background-color 1s}.cssCriticNiceReporter .header.scrolling{z-index:1;background-color:#fff;margin-top:-8px;margin-bottom:-8px;border-top:8px solid #fff}.cssCriticNiceReporter .fixedHeaderAnchorTarget{height:130px;margin-top:-130px;display:block;visibility:hidden}.cssCriticNiceReporter .header.pass{background-color:#00c04e}.cssCriticNiceReporter .header.fail{background-color:#ff3100}.cssCriticNiceReporter .timeTaken{float:right;padding:.5em 0 0 1em}.cssCriticNiceReporter .statusText{margin-top:.45rem;display:inline-block}.cssCriticNiceReporter .statusText .runAll{display:block;margin-top:.5em;text-decoration:underline}.cssCriticNiceReporter .acceptAll{display:none;margin:-4px 0 -4px 1em}.cssCriticNiceReporter .acceptAll.active{display:inline-block}.cssCriticNiceReporter .cssCriticVersion{display:block;margin:.25rem 0 .45rem;font-size:.7rem}.cssCriticNiceReporter .header.small{padding:10px 8px;opacity:.85}.cssCriticNiceReporter .header.small .cssCriticVersion,.cssCriticNiceReporter .header.small .statusText,.cssCriticNiceReporter .header.small .timeTaken{display:none}.cssCriticNiceReporter .progressBar{margin:0;list-style:none;padding:0}.cssCriticNiceReporter .progressBar:empty::after{content:'';width:0;height:0;border:.63rem solid;border-radius:50%;display:inline-block;opacity:.15}.cssCriticNiceReporter .progressBar li{display:inline-block;margin-right:-.4rem;transition:color 1s}.cssCriticNiceReporter .progressBar a{width:0;height:0;border:.63rem solid;border-radius:50%;display:block}.cssCriticNiceReporter .progressBar .pending{color:grey}.cssCriticNiceReporter .progressBar .passed{color:#048337}.cssCriticNiceReporter .progressBar .failed{color:#b62705}.cssCriticNiceReporter .progressBar .error{color:#591100}.cssCriticNiceReporter .progressBar .referenceMissing{color:#ff0}.cssCriticNiceReporter .progressBar a:focus{outline:0}.cssCriticNiceReporter .progressBar .hasRenderErrors{position:relative}.cssCriticNiceReporter .progressBar .hasRenderErrors a::after{content:'!';color:#000;line-height:1.26rem;text-align:center;position:absolute;top:0;left:0;right:0;bottom:0}.cssCriticNiceReporter .componentLabel{margin:1.8em 0 .5em 15px;font-size:1.15rem}.cssCriticNiceReporter .toc{display:inline-block;list-style:none;padding:3px;margin:1rem -3px 0;font-size:.9rem;background:rgba(255,255,255,.3)}.cssCriticNiceReporter .header.small .toc{margin-top:.5rem}.cssCriticNiceReporter .tocEntry{display:inline-block;margin-right:.8rem}.cssCriticNiceReporter .tocEntry:last-child{margin-right:0}.cssCriticNiceReporter .comparison{background-color:#f5f5f5;padding:15px;margin:4px 0 0}.cssCriticNiceReporter .comparison .title{font-weight:400}.cssCriticNiceReporter .fakeTarget+.comparison,.cssCriticNiceReporter :target+.comparison{padding-left:10px;border-left:5px solid rgba(0,0,0,.15)}.cssCriticNiceReporter .comparison .title .externalLink{vertical-align:top;font-size:.8rem;line-height:.6em;color:#888;display:inline-block}.cssCriticNiceReporter .comparison .title .externalLink:hover{transform:scale(1.1);transform-origin:bottom left}.cssCriticNiceReporter .comparison .parameters,.cssCriticNiceReporter .comparison .parameters dd,.cssCriticNiceReporter .comparison .parameters dt{display:inline-block;margin:0}.cssCriticNiceReporter .comparison .parameters{margin-left:1.5em;color:#444}.cssCriticNiceReporter .comparison .parameters dt{font-style:italic}.cssCriticNiceReporter .comparison .parameters dt::after{content:\\\":\\\"}.cssCriticNiceReporter .comparison .parameters dd{margin-left:.5em;margin-right:.7em}.cssCriticNiceReporter .comparison .parameters dd::after{content:\\\",\\\"}.cssCriticNiceReporter .comparison .parameters dd:last-child::after{content:\\\"\\\"}.cssCriticNiceReporter .running.comparison .imageContainer{opacity:.2}.cssCriticNiceReporter .comparison .imageContainer:empty{display:none}.cssCriticNiceReporter .comparison .imageWrapper{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAKUlEQVQ4jWNYt27df2Lwo0ePiMIMowaOGjgsDSRWIbEWjxo4auCwNBAAenk4PB4atggAAAAASUVORK5CYII=)-5px -5px;-webkit-user-select:none;-moz-user-select:none;user-select:none}.cssCriticNiceReporter .comparison canvas,.cssCriticNiceReporter .comparison img{display:block}.cssCriticNiceReporter .comparison .changedImageContainer,.cssCriticNiceReporter .comparison .imageContainer{border:1px solid #000}.cssCriticNiceReporter .comparison .outerChangedImageContainer{margin-top:4px;display:inline-block;position:relative}.cssCriticNiceReporter .comparison .imageContainer{position:relative;display:inline-block}.cssCriticNiceReporter .comparison .imageContainer .diff{max-height:0;max-width:0;opacity:0}.cssCriticNiceReporter .failed.comparison .imageContainer:hover .diff{max-height:none;max-width:none;opacity:1;transition:opacity 1s}.cssCriticNiceReporter .failed.comparison .imageContainer:hover .imageWrapper{opacity:.5;transition:opacity 1s;position:absolute;top:0;left:0;right:0;bottom:0}.cssCriticNiceReporter .comparison iframe{border:none;display:block;background:0 0}.cssCriticNiceReporter .comparison .realView{border-style:dashed}.cssCriticNiceReporter .comparison .accept{vertical-align:top;position:absolute;top:0;bottom:0;right:-65px;width:50px;font-size:.7rem}.cssCriticNiceReporter .accepted.comparison .accept{font-size:1.4rem}.cssCriticNiceReporter .comparison button span{transform:rotate(-90deg);display:block}.cssCriticNiceReporter .comparison .imageContainer{opacity:1;max-height:1000000px}.cssCriticNiceReporter .accepted.comparison .imageContainer{opacity:0;max-height:0;border-width:0;transition:max-height .001s ease 1s,opacity 1s,border-width .001s ease 1s}.cssCriticNiceReporter .comparison:hover .imageContainer::after{position:absolute;top:0;right:0;transform:translateX(100%);margin-right:-8px;padding:4px;white-space:nowrap;background-color:#000;opacity:.55;color:#fff;font-size:.9rem;border-radius:5px}.cssCriticNiceReporter .failed.comparison:hover .imageContainer::after{content:\\\"< Hover over the reference image to highlight changes\\\"}.cssCriticNiceReporter .failed.comparison .imageContainer:hover::after{display:none}.cssCriticNiceReporter .passed.comparison .imageContainer:not(.realView):hover::after{content:\\\"< Double click the image to expose the DOM of the underlying page\\\"}.cssCriticNiceReporter .browserWarning::before{content:\\\"\\\";font-size:1.2rem;padding-right:5px;vertical-align:middle}.cssCriticNiceReporter .browserWarning{position:fixed;top:0;left:0;width:100%;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;z-index:2;background-color:rgba(182,39,5,.85);color:#fff;font-size:1.2rem;border:2px solid #000;padding:20px}\"; (require(\"./../node_modules/cssify\"))(css); module.exports = css;","// UMD header\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.ayepromise = factory();\n    }\n}(this, function () {\n    'use strict';\n\n    var ayepromise = {};\n\n    /* Wrap an arbitrary number of functions and allow only one of them to be\n       executed and only once */\n    var once = function () {\n        var wasCalled = false;\n\n        return function wrapper(wrappedFunction) {\n            return function () {\n                if (wasCalled) {\n                    return;\n                }\n                wasCalled = true;\n                wrappedFunction.apply(null, arguments);\n            };\n        };\n    };\n\n    var getThenableIfExists = function (obj) {\n        // Make sure we only access the accessor once as required by the spec\n        var then = obj && obj.then;\n\n        if (typeof obj === \"object\" && typeof then === \"function\") {\n            // Bind function back to it's object (so fan's of 'this' don't get sad)\n            return function() { return then.apply(obj, arguments); };\n        }\n    };\n\n    var aThenHandler = function (onFulfilled, onRejected) {\n        var defer = ayepromise.defer();\n\n        var doHandlerCall = function (func, value) {\n            setTimeout(function () {\n                var returnValue;\n                try {\n                    returnValue = func(value);\n                } catch (e) {\n                    defer.reject(e);\n                    return;\n                }\n\n                if (returnValue === defer.promise) {\n                    defer.reject(new TypeError('Cannot resolve promise with itself'));\n                } else {\n                    defer.resolve(returnValue);\n                }\n            }, 1);\n        };\n\n        var callFulfilled = function (value) {\n            if (onFulfilled && onFulfilled.call) {\n                doHandlerCall(onFulfilled, value);\n            } else {\n                defer.resolve(value);\n            }\n        };\n\n        var callRejected = function (value) {\n            if (onRejected && onRejected.call) {\n                doHandlerCall(onRejected, value);\n            } else {\n                defer.reject(value);\n            }\n        };\n\n        return {\n            promise: defer.promise,\n            handle: function (state, value) {\n                if (state === FULFILLED) {\n                    callFulfilled(value);\n                } else {\n                    callRejected(value);\n                }\n            }\n        };\n    };\n\n    // States\n    var PENDING = 0,\n        FULFILLED = 1,\n        REJECTED = 2;\n\n    ayepromise.defer = function () {\n        var state = PENDING,\n            outcome,\n            thenHandlers = [];\n\n        var doSettle = function (settledState, value) {\n            state = settledState;\n            // persist for handlers registered after settling\n            outcome = value;\n\n            thenHandlers.forEach(function (then) {\n                then.handle(state, outcome);\n            });\n\n            // Discard all references to handlers to be garbage collected\n            thenHandlers = null;\n        };\n\n        var doFulfill = function (value) {\n            doSettle(FULFILLED, value);\n        };\n\n        var doReject = function (error) {\n            doSettle(REJECTED, error);\n        };\n\n        var registerThenHandler = function (onFulfilled, onRejected) {\n            var thenHandler = aThenHandler(onFulfilled, onRejected);\n\n            if (state === PENDING) {\n                thenHandlers.push(thenHandler);\n            } else {\n                thenHandler.handle(state, outcome);\n            }\n\n            return thenHandler.promise;\n        };\n\n        var safelyResolveThenable = function (thenable) {\n            // Either fulfill, reject or reject with error\n            var onceWrapper = once();\n            try {\n                thenable(\n                    onceWrapper(transparentlyResolveThenablesAndSettle),\n                    onceWrapper(doReject)\n                );\n            } catch (e) {\n                onceWrapper(doReject)(e);\n            }\n        };\n\n        var transparentlyResolveThenablesAndSettle = function (value) {\n            var thenable;\n\n            try {\n                thenable = getThenableIfExists(value);\n            } catch (e) {\n                doReject(e);\n                return;\n            }\n\n            if (thenable) {\n                safelyResolveThenable(thenable);\n            } else {\n                doFulfill(value);\n            }\n        };\n\n        var onceWrapper = once();\n        return {\n            resolve: onceWrapper(transparentlyResolveThenablesAndSettle),\n            reject: onceWrapper(doReject),\n            promise: {\n                then: registerThenHandler,\n                fail: function (onRejected) {\n                    return registerThenHandler(null, onRejected);\n                }\n            }\n        };\n    };\n\n    return ayepromise;\n}));\n","module.exports = function (css, customDocument) {\n  var doc = customDocument || document;\n  if (doc.createStyleSheet) {\n    var sheet = doc.createStyleSheet()\n    sheet.cssText = css;\n    return sheet.ownerNode;\n  } else {\n    var head = doc.getElementsByTagName('head')[0],\n        style = doc.createElement('style');\n\n    style.type = 'text/css';\n\n    if (style.styleSheet) {\n      style.styleSheet.cssText = css;\n    } else {\n      style.appendChild(doc.createTextNode(css));\n    }\n\n    head.appendChild(style);\n    return style;\n  }\n};\n\nmodule.exports.byUrl = function(url) {\n  if (document.createStyleSheet) {\n    return document.createStyleSheet(url).ownerNode;\n  } else {\n    var head = document.getElementsByTagName('head')[0],\n        link = document.createElement('link');\n\n    link.rel = 'stylesheet';\n    link.href = url;\n\n    head.appendChild(link);\n    return link;\n  }\n};\n","// js-imagediff 1.0.3\n// (c) 2011-2012 Carl Sutherland, Humble Software\n// Distributed under the MIT License\n// For original source and documentation visit:\n// http://www.github.com/HumbleSoftware/js-imagediff\n\n(function (name, definition) {\n  var root = this;\n  if (typeof module !== 'undefined') {\n    try {\n      var Canvas = require('canvas');\n    } catch (e) {\n      throw new Error(\n        e.message + '\\n' +\n        'Please see https://github.com/HumbleSoftware/js-imagediff#cannot-find-module-canvas\\n'\n      );\n    }\n    module.exports = definition(root, name, Canvas);\n  } else if (typeof define === 'function' && typeof define.amd === 'object') {\n    define(definition);\n  } else {\n    root[name] = definition(root, name);\n  }\n})('imagediff', function (root, name, Canvas) {\n\n  var\n    TYPE_ARRAY        = /\\[object Array\\]/i,\n    TYPE_CANVAS       = /\\[object (Canvas|HTMLCanvasElement)\\]/i,\n    TYPE_CONTEXT      = /\\[object CanvasRenderingContext2D\\]/i,\n    TYPE_IMAGE        = /\\[object (Image|HTMLImageElement)\\]/i,\n    TYPE_IMAGE_DATA   = /\\[object ImageData\\]/i,\n\n    UNDEFINED         = 'undefined',\n\n    canvas            = getCanvas(),\n    context           = canvas.getContext('2d'),\n    previous          = root[name],\n    imagediff, jasmine;\n\n  // Creation\n  function getCanvas (width, height) {\n    var\n      canvas = Canvas ?\n        new Canvas() :\n        document.createElement('canvas');\n    if (width) canvas.width = width;\n    if (height) canvas.height = height;\n    return canvas;\n  }\n  function getImageData (width, height) {\n    canvas.width = width;\n    canvas.height = height;\n    context.clearRect(0, 0, width, height);\n    return context.createImageData(width, height);\n  }\n  // expost canvas module\n  function getCanvasRef() {\n    return Canvas;\n  }\n\n\n  // Type Checking\n  function isImage (object) {\n    return isType(object, TYPE_IMAGE);\n  }\n  function isCanvas (object) {\n    return isType(object, TYPE_CANVAS);\n  }\n  function isContext (object) {\n    return isType(object, TYPE_CONTEXT);\n  }\n  function isImageData (object) {\n    return !!(object &&\n      isType(object, TYPE_IMAGE_DATA) &&\n      typeof(object.width) !== UNDEFINED &&\n      typeof(object.height) !== UNDEFINED &&\n      typeof(object.data) !== UNDEFINED);\n  }\n  function isImageType (object) {\n    return (\n      isImage(object) ||\n      isCanvas(object) ||\n      isContext(object) ||\n      isImageData(object)\n    );\n  }\n  function isType (object, type) {\n    return typeof (object) === 'object' && !!Object.prototype.toString.apply(object).match(type);\n  }\n\n\n  // Type Conversion\n  function copyImageData (imageData) {\n    var\n      height = imageData.height,\n      width = imageData.width,\n      data = imageData.data,\n      newImageData, newData, i;\n\n    canvas.width = width;\n    canvas.height = height;\n    newImageData = context.getImageData(0, 0, width, height);\n    newData = newImageData.data;\n\n    for (i = imageData.data.length; i--;) {\n        newData[i] = data[i];\n    }\n\n    return newImageData;\n  }\n  function toImageData (object) {\n    if (isImage(object)) { return toImageDataFromImage(object); }\n    if (isCanvas(object)) { return toImageDataFromCanvas(object); }\n    if (isContext(object)) { return toImageDataFromContext(object); }\n    if (isImageData(object)) { return object; }\n  }\n  function toImageDataFromImage (image) {\n    var\n      height = image.height,\n      width = image.width;\n    canvas.width = width;\n    canvas.height = height;\n    context.clearRect(0, 0, width, height);\n    context.drawImage(image, 0, 0);\n    return context.getImageData(0, 0, width, height);\n  }\n  function toImageDataFromCanvas (canvas) {\n    var\n      height = canvas.height,\n      width = canvas.width,\n      context = canvas.getContext('2d');\n    return context.getImageData(0, 0, width, height);\n  }\n  function toImageDataFromContext (context) {\n    var\n      canvas = context.canvas,\n      height = canvas.height,\n      width = canvas.width;\n    return context.getImageData(0, 0, width, height);\n  }\n  function toCanvas (object) {\n    var\n      data = toImageData(object),\n      canvas = getCanvas(data.width, data.height),\n      context = canvas.getContext('2d');\n\n    context.putImageData(data, 0, 0);\n    return canvas;\n  }\n\n\n  // ImageData Equality Operators\n  function equalWidth (a, b) {\n    return a.width === b.width;\n  }\n  function equalHeight (a, b) {\n    return a.height === b.height;\n  }\n  function equalDimensions (a, b) {\n    return equalHeight(a, b) && equalWidth(a, b);\n  }\n  function equal (a, b, tolerance) {\n\n    var\n      aData     = a.data,\n      bData     = b.data,\n      length    = aData.length,\n      i;\n\n    tolerance = tolerance || 0;\n\n    if (!equalDimensions(a, b)) return false;\n    for (i = length; i--;) if (aData[i] !== bData[i] && Math.abs(aData[i] - bData[i]) > tolerance) return false;\n\n    return true;\n  }\n\n\n  // Diff\n  function diff (a, b, options) {\n    return (equalDimensions(a, b) ? diffEqual : diffUnequal)(a, b, options);\n  }\n  function diffEqual (a, b, options) {\n\n    var\n      height  = a.height,\n      width   = a.width,\n      c       = getImageData(width, height), // c = a - b\n      aData   = a.data,\n      bData   = b.data,\n      cData   = c.data,\n      length  = cData.length,\n      row, column,\n      i, j, k, v;\n\n    for (i = 0; i < length; i += 4) {\n      cData[i] = Math.abs(aData[i] - bData[i]);\n      cData[i+1] = Math.abs(aData[i+1] - bData[i+1]);\n      cData[i+2] = Math.abs(aData[i+2] - bData[i+2]);\n      cData[i+3] = Math.abs(255 - Math.abs(aData[i+3] - bData[i+3]));\n    }\n\n    return c;\n  }\n  function diffUnequal (a, b, options) {\n\n    var\n      height  = Math.max(a.height, b.height),\n      width   = Math.max(a.width, b.width),\n      c       = getImageData(width, height), // c = a - b\n      aData   = a.data,\n      bData   = b.data,\n      cData   = c.data,\n      align   = options && options.align,\n      rowOffset,\n      columnOffset,\n      row, column,\n      i, j, k, v;\n\n\n    for (i = cData.length - 1; i > 0; i = i - 4) {\n      cData[i] = 255;\n    }\n\n    // Add First Image\n    offsets(a);\n    for (row = a.height; row--;){\n      for (column = a.width; column--;) {\n        i = 4 * ((row + rowOffset) * width + (column + columnOffset));\n        j = 4 * (row * a.width + column);\n        cData[i+0] = aData[j+0]; // r\n        cData[i+1] = aData[j+1]; // g\n        cData[i+2] = aData[j+2]; // b\n        // cData[i+3] = aData[j+3]; // a\n      }\n    }\n\n    // Subtract Second Image\n    offsets(b);\n    for (row = b.height; row--;){\n      for (column = b.width; column--;) {\n        i = 4 * ((row + rowOffset) * width + (column + columnOffset));\n        j = 4 * (row * b.width + column);\n        cData[i+0] = Math.abs(cData[i+0] - bData[j+0]); // r\n        cData[i+1] = Math.abs(cData[i+1] - bData[j+1]); // g\n        cData[i+2] = Math.abs(cData[i+2] - bData[j+2]); // b\n      }\n    }\n\n    // Helpers\n    function offsets (imageData) {\n      if (align === 'top') {\n        rowOffset = 0;\n        columnOffset = 0;\n      } else {\n        rowOffset = Math.floor((height - imageData.height) / 2);\n        columnOffset = Math.floor((width - imageData.width) / 2);\n      }\n    }\n\n    return c;\n  }\n\n\n  // Validation\n  function checkType () {\n    var i;\n    for (i = 0; i < arguments.length; i++) {\n      if (!isImageType(arguments[i])) {\n        throw {\n          name : 'ImageTypeError',\n          message : 'Submitted object was not an image.'\n        };\n      }\n    }\n  }\n\n\n  // Jasmine Matchers\n  function get (element, content) {\n    element = document.createElement(element);\n    if (element && content) {\n      element.innerHTML = content;\n    }\n    return element;\n  }\n\n  jasmine = {\n\n    toBeImageData : function () {\n      return imagediff.isImageData(this.actual);\n    },\n\n    toImageDiffEqual : function (expected, tolerance) {\n\n      if (typeof (document) !== UNDEFINED) {\n        this.message = function () {\n          var\n            div     = get('div'),\n            a       = get('div', '<div>Actual:</div>'),\n            b       = get('div', '<div>Expected:</div>'),\n            c       = get('div', '<div>Diff:</div>'),\n            diff    = imagediff.diff(this.actual, expected),\n            canvas  = getCanvas(),\n            context;\n\n          canvas.height = diff.height;\n          canvas.width  = diff.width;\n\n          div.style.overflow = 'hidden';\n          a.style.float = 'left';\n          b.style.float = 'left';\n          c.style.float = 'left';\n\n          context = canvas.getContext('2d');\n          context.putImageData(diff, 0, 0);\n\n          a.appendChild(toCanvas(this.actual));\n          b.appendChild(toCanvas(expected));\n          c.appendChild(canvas);\n\n          div.appendChild(a);\n          div.appendChild(b);\n          div.appendChild(c);\n\n          return [\n            div,\n            \"Expected not to be equal.\"\n          ];\n        };\n      }\n\n      return imagediff.equal(this.actual, expected, tolerance);\n    }\n  };\n\n\n  // Image Output\n  function imageDataToPNG (imageData, outputFile, callback) {\n\n    var\n      canvas = toCanvas(imageData),\n      base64Data,\n      decodedImage;\n\n    callback = callback || Function;\n\n    base64Data = canvas.toDataURL().replace(/^data:image\\/\\w+;base64,/,\"\");\n    decodedImage = new Buffer(base64Data, 'base64');\n    require('fs').writeFile(outputFile, decodedImage, callback);\n  }\n\n\n  // Definition\n  imagediff = {\n\n    createCanvas : getCanvas,\n    createImageData : getImageData,\n    getCanvasRef: getCanvasRef,\n\n    isImage : isImage,\n    isCanvas : isCanvas,\n    isContext : isContext,\n    isImageData : isImageData,\n    isImageType : isImageType,\n\n    toImageData : function (object) {\n      checkType(object);\n      if (isImageData(object)) { return copyImageData(object); }\n      return toImageData(object);\n    },\n\n    equal : function (a, b, tolerance) {\n      checkType(a, b);\n      a = toImageData(a);\n      b = toImageData(b);\n      return equal(a, b, tolerance);\n    },\n    diff : function (a, b, options) {\n      checkType(a, b);\n      a = toImageData(a);\n      b = toImageData(b);\n      return diff(a, b, options);\n    },\n\n    jasmine : jasmine,\n\n    // Compatibility\n    noConflict : function () {\n      root[name] = previous;\n      return imagediff;\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    imagediff.imageDataToPNG = imageDataToPNG;\n  }\n\n  return imagediff;\n});\n","/*! rasterizeHTML.js - v1.1.0 - 2015-03-26\n* http://www.github.com/cburgmer/rasterizeHTML.js\n* Copyright (c) 2015 Christoph Burgmer; Licensed MIT */\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module unless amdModuleId is set\n    define([\"url\",\"cssMediaQuery\",\"xmlserializer\",\"ayepromise\",\"inlineresources\"], function (a0,b1,c2,d3,e4) {\n      return (root['rasterizeHTML'] = factory(a0,b1,c2,d3,e4));\n    });\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(require(\"url\"),require(\"css-mediaquery\"),require(\"xmlserializer\"),require(\"ayepromise\"),require(\"inlineresources\"));\n  } else {\n    root['rasterizeHTML'] = factory(url,cssMediaQuery,xmlserializer,ayepromise,inlineresources);\n  }\n}(this, function (url, cssMediaQuery, xmlserializer, ayepromise, inlineresources) {\n\nvar util = (function (url) {\n    \"use strict\";\n\n    var module = {};\n\n    var uniqueIdList = [];\n\n    module.joinUrl = function (baseUrl, relUrl) {\n        if (!baseUrl) {\n            return relUrl;\n        }\n        return url.resolve(baseUrl, relUrl);\n    };\n\n    module.getConstantUniqueIdFor = function (element) {\n        // HACK, using a list results in O(n), but how do we hash e.g. a DOM node?\n        if (uniqueIdList.indexOf(element) < 0) {\n            uniqueIdList.push(element);\n        }\n        return uniqueIdList.indexOf(element);\n    };\n\n    module.clone = function (object) {\n        var theClone = {},\n            i;\n        for (i in object) {\n            if (object.hasOwnProperty(i)) {\n                theClone[i] = object[i];\n            }\n        }\n        return theClone;\n    };\n\n    var isObject = function (obj) {\n        return typeof obj === \"object\" && obj !== null;\n    };\n\n    var isCanvas = function (obj) {\n        return isObject(obj) &&\n            Object.prototype.toString.apply(obj).match(/\\[object (Canvas|HTMLCanvasElement)\\]/i);\n    };\n\n    // args: canvas, options\n    module.parseOptionalParameters = function (args) {\n        var parameters = {\n            canvas: null,\n            options: {}\n        };\n\n        if (args[0] == null || isCanvas(args[0])) {\n            parameters.canvas = args[0] || null;\n\n            parameters.options = module.clone(args[1]);\n        } else {\n            parameters.options = module.clone(args[0]);\n        }\n\n        return parameters;\n    };\n\n    return module;\n}(url));\n\n// Proxy objects by monkey patching\nvar proxies = (function (util, ayepromise) {\n    \"use strict\";\n\n    var module = {};\n\n    var monkeyPatchInstanceMethod = function (object, methodName, proxyFunc) {\n        var originalFunc = object[methodName];\n\n        object[methodName] = function () {\n            var args = Array.prototype.slice.call(arguments);\n\n            return proxyFunc.apply(this, [args, originalFunc]);\n        };\n\n        return originalFunc;\n    };\n\n    // Bases all XHR calls on the given base URL\n    module.baseUrlRespectingXhr = function (XHRObject, baseUrl) {\n        var xhrConstructor = function () {\n            var xhr = new XHRObject();\n\n            monkeyPatchInstanceMethod(xhr, 'open', function (args, originalOpen) {\n                var method = args.shift(),\n                    url = args.shift(),\n                    joinedUrl = util.joinUrl(baseUrl, url);\n\n                return originalOpen.apply(this, [method, joinedUrl].concat(args));\n            });\n\n            return xhr;\n        };\n\n        return xhrConstructor;\n    };\n\n    // Provides a convenient way of being notified when all pending XHR calls are finished\n    module.finishNotifyingXhr = function (XHRObject) {\n        var totalXhrCount = 0,\n            doneXhrCount = 0,\n            waitingForPendingToClose = false,\n            defer = ayepromise.defer();\n\n        var checkAllRequestsFinished = function () {\n            var pendingXhrCount = totalXhrCount - doneXhrCount;\n\n            if (pendingXhrCount <= 0 && waitingForPendingToClose) {\n                defer.resolve({totalCount: totalXhrCount});\n            }\n        };\n\n        var xhrConstructor = function () {\n            var xhr = new XHRObject();\n\n            monkeyPatchInstanceMethod(xhr, 'send', function (_, originalSend) {\n                totalXhrCount += 1;\n                return originalSend.apply(this, arguments);\n            });\n\n            xhr.addEventListener('load', function () {\n                doneXhrCount += 1;\n\n                checkAllRequestsFinished();\n            });\n\n            return xhr;\n        };\n\n        xhrConstructor.waitForRequestsToFinish = function () {\n            waitingForPendingToClose = true;\n            checkAllRequestsFinished();\n            return defer.promise;\n        };\n\n        return xhrConstructor;\n    };\n\n    return module;\n}(util, ayepromise));\n\nvar documentUtil = (function () {\n    \"use strict\";\n\n    var module = {};\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    module.addClassNameRecursively = function (element, className) {\n        element.className += ' ' + className;\n\n        if (element.parentNode !== element.ownerDocument) {\n            module.addClassNameRecursively(element.parentNode, className);\n        }\n    };\n\n    var changeCssRule = function (rule, newRuleText) {\n        var styleSheet = rule.parentStyleSheet,\n            ruleIdx = asArray(styleSheet.cssRules).indexOf(rule);\n\n        // Exchange rule with the new text\n        styleSheet.insertRule(newRuleText, ruleIdx+1);\n        styleSheet.deleteRule(ruleIdx);\n    };\n\n    var updateRuleSelector = function (rule, updatedSelector) {\n        var styleDefinitions = rule.cssText.replace(/^[^\\{]+/, ''),\n            newRule = updatedSelector + ' ' + styleDefinitions;\n\n        changeCssRule(rule, newRule);\n    };\n\n    var cssRulesToText = function (cssRules) {\n        return asArray(cssRules).reduce(function (cssText, rule) {\n            return cssText + rule.cssText;\n        }, '');\n    };\n\n    var rewriteStyleContent = function (styleElement) {\n        styleElement.textContent = cssRulesToText(styleElement.sheet.cssRules);\n    };\n\n    var matchingSimpleSelectorsRegex = function (simpleSelectorList) {\n        return '(' +\n            '(?:^|[^.#:\\\\w])' +            // start of string or not a simple selector character,\n            '|' +                          // ... or ...\n            '(?=\\\\W)' +                    // the next character parsed is not an alphabetic character (and thus a natural boundary)\n            ')' +\n            '(' +\n            simpleSelectorList.join('|') + // one out of the given simple selectors\n            ')' +\n            '(?=\\\\W|$)';                   // followed either by a non-alphabetic character or the end of the string\n    };\n\n    var replaceSimpleSelectorsBy = function (doc, simpleSelectorList, caseInsensitiveReplaceFunc) {\n        var selectorRegex = matchingSimpleSelectorsRegex(simpleSelectorList);\n\n        asArray(doc.querySelectorAll('style')).forEach(function (styleElement) {\n            var matchingRules = asArray(styleElement.sheet.cssRules).filter(function (rule) {\n                return rule.selectorText && new RegExp(selectorRegex, 'i').test(rule.selectorText);\n            });\n\n            if (matchingRules.length) {\n                matchingRules.forEach(function (rule) {\n                    var newSelector = rule.selectorText.replace(new RegExp(selectorRegex, 'gi'),\n                                                             function (_, prefixMatch, selectorMatch) {\n                        return prefixMatch + caseInsensitiveReplaceFunc(selectorMatch);\n                    });\n\n                    if (newSelector !== rule.selectorText) {\n                        updateRuleSelector(rule, newSelector);\n                    }\n                });\n\n                rewriteStyleContent(styleElement);\n            }\n        });\n    };\n\n    module.rewriteCssSelectorWith = function (doc, oldSelector, newSelector) {\n        replaceSimpleSelectorsBy(doc, [oldSelector], function () {\n            return newSelector;\n        });\n    };\n\n    module.lowercaseCssTypeSelectors = function (doc, matchingTagNames) {\n        replaceSimpleSelectorsBy(doc, matchingTagNames, function (match) {\n            return match.toLowerCase();\n        });\n    };\n\n    module.findHtmlOnlyNodeNames = function (doc) {\n        var treeWalker = doc.createTreeWalker(doc, NodeFilter.SHOW_ELEMENT),\n            htmlNodeNames = {},\n            nonHtmlNodeNames = {},\n            currentTagName;\n\n        while(treeWalker.nextNode()) {\n            currentTagName = treeWalker.currentNode.tagName.toLowerCase();\n            if (treeWalker.currentNode.namespaceURI === 'http://www.w3.org/1999/xhtml') {\n                htmlNodeNames[currentTagName] = true;\n            } else {\n                nonHtmlNodeNames[currentTagName] = true;\n            }\n        }\n\n        return Object.keys(htmlNodeNames).filter(function (tagName) {\n            return !nonHtmlNodeNames[tagName];\n        });\n    };\n\n    return module;\n}());\n\nvar documentHelper = (function (documentUtil) {\n    \"use strict\";\n\n    var module = {};\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    module.fakeHover = function (doc, hoverSelector) {\n        var elem = doc.querySelector(hoverSelector),\n            fakeHoverClass = 'rasterizehtmlhover';\n        if (! elem) {\n            return;\n        }\n\n        documentUtil.addClassNameRecursively(elem, fakeHoverClass);\n        documentUtil.rewriteCssSelectorWith(doc, ':hover', '.' + fakeHoverClass);\n    };\n\n    module.fakeActive = function (doc, activeSelector) {\n        var elem = doc.querySelector(activeSelector),\n            fakeActiveClass = 'rasterizehtmlactive';\n        if (! elem) {\n            return;\n        }\n\n        documentUtil.addClassNameRecursively(elem, fakeActiveClass);\n        documentUtil.rewriteCssSelectorWith(doc, ':active', '.' + fakeActiveClass);\n    };\n\n    module.fakeFocus = function (doc, focusSelector) {\n        var elem = doc.querySelector(focusSelector),\n            fakeFocusClass = 'rasterizehtmlfocus';\n        if (! elem) {\n            return;\n        }\n\n        documentUtil.addClassNameRecursively(elem, fakeFocusClass);\n        documentUtil.rewriteCssSelectorWith(doc, ':focus', '.' + fakeFocusClass);\n    };\n\n    module.persistInputValues = function (doc) {\n        var inputs = doc.querySelectorAll('input'),\n            textareas = doc.querySelectorAll('textarea'),\n            isCheckable = function (input) {\n                return input.type === 'checkbox' || input.type === 'radio';\n            };\n\n        asArray(inputs).filter(isCheckable)\n            .forEach(function (input) {\n                if (input.checked) {\n                    input.setAttribute('checked', '');\n                } else {\n                    input.removeAttribute('checked');\n                }\n            });\n\n        asArray(inputs).filter(function (input) { return !isCheckable(input); })\n            .forEach(function (input) {\n                input.setAttribute('value', input.value);\n            });\n\n        asArray(textareas)\n            .forEach(function (textarea) {\n                textarea.textContent = textarea.value;\n            });\n    };\n\n    module.rewriteTagNameSelectorsToLowerCase = function (doc) {\n        documentUtil.lowercaseCssTypeSelectors(doc, documentUtil.findHtmlOnlyNodeNames(doc));\n    };\n\n    return module;\n}(documentUtil));\n\nvar mediaQueryHelper = (function (cssMediaQuery) {\n    \"use strict\";\n\n    var module = {};\n\n    var svgImgBlueByEmMediaQuery = function () {\n        var svg = '<svg id=\"svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"10\" height=\"10\">' +\n                '<style>@media (max-width: 1em) { svg { background: #00f; } }</style>' +\n                '</svg>';\n\n        var url = \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(svg),\n            img = document.createElement('img');\n\n        img.src = url;\n\n        return img;\n    };\n\n    var firstPixelHasColor = function (img, r, g, b) {\n        var canvas = document.createElement(\"canvas\");\n        canvas.width = img.width;\n        canvas.height = img.height;\n\n        var context = canvas.getContext(\"2d\"),\n            data;\n\n        context.drawImage(img, 0, 0);\n        data = context.getImageData(0, 0, 1, 1).data;\n        return data[0] === r && data[1] === g && data[2] === b;\n    };\n\n    var hasEmMediaQueryIssue = function () {\n        var img = svgImgBlueByEmMediaQuery(),\n            defer = ayepromise.defer();\n\n        document.querySelector('body').appendChild(img);\n\n        img.onload = function () {\n            document.querySelector('body').removeChild(img);\n            try {\n                defer.resolve(!firstPixelHasColor(img, 0, 0, 255));\n            } catch (e) {\n                // Fails in PhantomJS, let's assume the issue exists\n                defer.resolve(true);\n            }\n        };\n        img.onerror = function () {\n            defer.reject();\n        };\n\n        return defer.promise;\n    };\n\n    var hasEmIssue;\n\n    module.needsEmWorkaround = function () {\n        if (hasEmIssue === undefined) {\n            hasEmIssue = hasEmMediaQueryIssue();\n        }\n        return hasEmIssue;\n    };\n\n    var asArray = function (arrayLike) {\n        return Array.prototype.slice.call(arrayLike);\n    };\n\n    var cssRulesToText = function (cssRules) {\n        return asArray(cssRules).map(function (rule) {\n            return rule.cssText;\n        }).join('\\n');\n    };\n\n    var mediaQueryRule = function (mediaQueries, cssRules) {\n        return '@media ' + mediaQueries.join(', ') + '{' +\n            cssRulesToText(cssRules) +\n            '}';\n    };\n\n    var exchangeRuleWithNewContent = function (styleSheet, ruleIdx, newRuleText) {\n        try {\n            styleSheet.insertRule(newRuleText, ruleIdx+1);\n        } catch (e) {\n            // In case the browser does not like our new rule we just keep the existing one and quietly leave\n            return;\n        }\n        styleSheet.deleteRule(ruleIdx);\n    };\n\n    var changeCssRule = function (rule, newRuleText) {\n        var styleSheet = rule.parentStyleSheet,\n            ruleIdx = asArray(styleSheet.cssRules).indexOf(rule);\n\n        exchangeRuleWithNewContent(styleSheet, ruleIdx, newRuleText);\n    };\n\n    var rewriteStyleContent = function (styleElement) {\n        styleElement.textContent = cssRulesToText(styleElement.sheet.cssRules);\n    };\n\n    var serializeExpression = function (exp) {\n        var feature = exp.modifier ? exp.modifier + '-' + exp.feature : exp.feature;\n        if (exp.value) {\n            return '(' + feature + ': ' + exp.value + ')';\n        } else {\n            return '(' + feature + ')';\n        }\n    };\n\n    var serializeQueryPart = function (q) {\n        var segments = [];\n\n        if (q.inverse) {\n            segments.push(\"not\");\n        }\n\n        segments.push(q.type);\n\n        if (q.expressions.length > 0) {\n            segments.push('and ' + q.expressions.map(serializeExpression).join(' and '));\n        }\n\n        return segments.join(' ');\n    };\n\n    // poor man's testability\n    module.serializeQuery = function (q) {\n        var queryParts = q.map(serializeQueryPart);\n        return queryParts.join(', ');\n    };\n\n    var transformEmIntoPx = function (em) {\n        return em * 16;\n    };\n\n    var replaceEmValueWithPx = function (value) {\n        // Match a number with em unit. Doesn't match all, but should be enough for now\n        var match = /^((?:\\d+\\.)?\\d+)em/.exec(value);\n        if (match) {\n            return transformEmIntoPx(parseFloat(match[1])) + 'px';\n        }\n        return value;\n    };\n\n    var substituteEmWithPx = function (mediaQuery) {\n        var parsedQuery = cssMediaQuery.parse(mediaQuery),\n            hasChanges = false;\n\n        parsedQuery.forEach(function (q) {\n            q.expressions.forEach(function (exp) {\n                var rewrittenValue = replaceEmValueWithPx(exp.value);\n\n                hasChanges |= rewrittenValue !== exp.value;\n                exp.value = rewrittenValue;\n            });\n        });\n\n        if (hasChanges) {\n            mediaQuery = module.serializeQuery(parsedQuery);\n        }\n\n        return mediaQuery;\n    };\n\n    var replaceEmsWithPx = function (mediaQueryRules) {\n        var anyRuleHasChanges = false;\n\n        mediaQueryRules.forEach(function (rule) {\n            var hasChanges = false;\n\n            var reworkedMediaQueries = asArray(rule.media).map(function (mediaQuery) {\n                var rewrittenMediaQuery = substituteEmWithPx(mediaQuery);\n\n                hasChanges |= rewrittenMediaQuery !== mediaQuery;\n                return rewrittenMediaQuery;\n            });\n\n            if (hasChanges) {\n                changeCssRule(rule, mediaQueryRule(reworkedMediaQueries, rule.cssRules));\n            }\n\n            anyRuleHasChanges |= hasChanges;\n        });\n\n        return anyRuleHasChanges;\n    };\n\n    module.workAroundWebKitEmSizeIssue = function (document) {\n        var styles = document.querySelectorAll('style');\n\n        asArray(styles).forEach(function (style) {\n            var mediaQueryRules = asArray(style.sheet.cssRules).filter(function (rule) {\n                return rule.type === window.CSSRule.MEDIA_RULE;\n            });\n\n            var hasChanges = replaceEmsWithPx(mediaQueryRules);\n            if (hasChanges) {\n                rewriteStyleContent(style);\n            }\n        });\n    };\n\n    return module;\n}(cssMediaQuery));\n\nvar browser = (function (util, proxies, ayepromise, theWindow) {\n    \"use strict\";\n\n    var module = {};\n\n    var createHiddenElement = function (doc, tagName, width, height) {\n        var element = doc.createElement(tagName);\n        // 'display: none' doesn't cut it, as browsers seem to be lazy loading CSS\n        element.style.visibility = \"hidden\";\n        element.style.width = width + \"px\";\n        element.style.height = height + \"px\";\n        element.style.position = \"absolute\";\n        element.style.top = (-10000 - height) + \"px\";\n        element.style.left = (-10000 - width) + \"px\";\n        // We need to add the element to the document so that its content gets loaded\n        doc.getElementsByTagName(\"body\")[0].appendChild(element);\n        return element;\n    };\n\n    module.executeJavascript = function (doc, options) {\n        var iframe = createHiddenElement(theWindow.document, \"iframe\", options.width, options.height),\n            html = doc.documentElement.outerHTML,\n            iframeErrorsMessages = [],\n            defer = ayepromise.defer(),\n            timeout = options.executeJsTimeout || 0;\n\n        var doResolve = function () {\n            var doc = iframe.contentDocument;\n            theWindow.document.getElementsByTagName(\"body\")[0].removeChild(iframe);\n            defer.resolve({\n                document: doc,\n                errors: iframeErrorsMessages\n            });\n        };\n\n        var waitForJavaScriptToRun = function () {\n            var d = ayepromise.defer();\n            if (timeout > 0) {\n                setTimeout(d.resolve, timeout);\n            } else {\n                d.resolve();\n            }\n            return d.promise;\n        };\n\n        iframe.onload = function () {\n            waitForJavaScriptToRun()\n                .then(finishNotifyXhrProxy.waitForRequestsToFinish)\n                .then(doResolve);\n        };\n\n        var xhr = iframe.contentWindow.XMLHttpRequest,\n            finishNotifyXhrProxy = proxies.finishNotifyingXhr(xhr),\n            baseUrlXhrProxy = proxies.baseUrlRespectingXhr(finishNotifyXhrProxy, options.baseUrl);\n\n        iframe.contentDocument.open();\n        iframe.contentWindow.XMLHttpRequest = baseUrlXhrProxy;\n        iframe.contentWindow.onerror = function (msg) {\n            iframeErrorsMessages.push({\n                resourceType: \"scriptExecution\",\n                msg: msg\n            });\n        };\n\n        iframe.contentDocument.write('<!DOCTYPE html>');\n        iframe.contentDocument.write(html);\n        iframe.contentDocument.close();\n\n        return defer.promise;\n    };\n\n    var createHiddenSandboxedIFrame = function (doc, width, height) {\n        var iframe = doc.createElement('iframe');\n        iframe.style.width = width + \"px\";\n        iframe.style.height = height + \"px\";\n        // 'display: none' doesn't cut it, as browsers seem to be lazy loading content\n        iframe.style.visibility = \"hidden\";\n        iframe.style.position = \"absolute\";\n        iframe.style.top = (-10000 - height) + \"px\";\n        iframe.style.left = (-10000 - width) + \"px\";\n        // Don't execute JS, all we need from sandboxing is access to the iframe's document\n        iframe.sandbox = 'allow-same-origin';\n        // Don't include a scrollbar on Linux\n        iframe.scrolling = 'no';\n        return iframe;\n    };\n\n    var createIframeWithSizeAtZoomLevel1 = function (width, height, zoom) {\n        var scaledViewportWidth = Math.floor(width / zoom),\n            scaledViewportHeight = Math.floor(height / zoom);\n\n        return createHiddenSandboxedIFrame(theWindow.document, scaledViewportWidth, scaledViewportHeight);\n    };\n\n    var calculateZoomedContentSizeAndRoundUp = function (actualViewport, requestedWidth, requestedHeight, zoom) {\n        return {\n            width: Math.max(actualViewport.width * zoom, requestedWidth),\n            height: Math.max(actualViewport.height * zoom, requestedHeight)\n        };\n    };\n\n    var calculateContentSize = function (doc, selector, requestedWidth, requestedHeight, zoom) {\n            // clientWidth/clientHeight needed for PhantomJS\n        var actualViewportWidth = Math.max(doc.documentElement.scrollWidth, doc.body.clientWidth),\n            actualViewportHeight = Math.max(doc.documentElement.scrollHeight, doc.body.scrollHeight, doc.body.clientHeight),\n            top, left, originalWidth, originalHeight, rootFontSize,\n            element, rect, contentSize;\n\n        if (selector) {\n            element = doc.querySelector(selector);\n\n            if (!element) {\n                throw {\n                    message: \"Clipping selector not found\"\n                };\n            }\n\n            rect = element.getBoundingClientRect();\n\n            top = rect.top;\n            left = rect.left;\n            originalWidth = rect.width;\n            originalHeight = rect.height;\n        } else {\n            top = 0;\n            left = 0;\n            originalWidth = actualViewportWidth;\n            originalHeight = actualViewportHeight;\n        }\n\n        contentSize = calculateZoomedContentSizeAndRoundUp({\n                width: originalWidth,\n                height: originalHeight\n            },\n            requestedWidth,\n            requestedHeight,\n            zoom);\n\n        rootFontSize = theWindow.getComputedStyle(doc.documentElement).fontSize;\n\n        return {\n            left: left,\n            top: top,\n            width: contentSize.width,\n            height: contentSize.height,\n            viewportWidth: actualViewportWidth,\n            viewportHeight: actualViewportHeight,\n\n            rootFontSize: rootFontSize\n        };\n    };\n\n    module.calculateDocumentContentSize = function (doc, options) {\n        var html = doc.documentElement.outerHTML,\n            defer = ayepromise.defer(),\n            zoom = options.zoom || 1,\n            iframe;\n\n\n        iframe = createIframeWithSizeAtZoomLevel1(options.width, options.height, zoom);\n        // We need to add the element to the document so that its content gets loaded\n        theWindow.document.getElementsByTagName(\"body\")[0].appendChild(iframe);\n\n        iframe.onload = function () {\n            var doc = iframe.contentDocument,\n                size;\n\n            try {\n                size = calculateContentSize(doc, options.clip, options.width, options.height, zoom);\n\n                defer.resolve(size);\n            } catch (e) {\n                defer.reject(e);\n            } finally {\n                theWindow.document.getElementsByTagName(\"body\")[0].removeChild(iframe);\n            }\n        };\n\n        // srcdoc doesn't work in PhantomJS yet\n        iframe.contentDocument.open();\n        iframe.contentDocument.write('<!DOCTYPE html>');\n        iframe.contentDocument.write(html);\n        iframe.contentDocument.close();\n\n        return defer.promise;\n    };\n\n    var addHTMLTagAttributes = function (doc, html) {\n        var attributeMatch = /<html((?:\\s+[^>]*)?)>/im.exec(html),\n            helperDoc = theWindow.document.implementation.createHTMLDocument(''),\n            htmlTagSubstitute,\n            i, elementSubstitute, attribute;\n\n        if (!attributeMatch) {\n            return;\n        }\n\n        htmlTagSubstitute = '<div' + attributeMatch[1] + '></div>';\n        helperDoc.documentElement.innerHTML = htmlTagSubstitute;\n        elementSubstitute = helperDoc.querySelector('div');\n\n        for (i = 0; i < elementSubstitute.attributes.length; i++) {\n            attribute = elementSubstitute.attributes[i];\n            doc.documentElement.setAttribute(attribute.name, attribute.value);\n        }\n    };\n\n    module.parseHTML = function (html) {\n        // We should be using the DOMParser, but it is not supported in older browsers\n        var doc = theWindow.document.implementation.createHTMLDocument('');\n        doc.documentElement.innerHTML = html;\n\n        addHTMLTagAttributes(doc, html);\n        return doc;\n    };\n\n    var isParseError = function (parsedDocument) {\n        // http://stackoverflow.com/questions/11563554/how-do-i-detect-xml-parsing-errors-when-using-javascripts-domparser-in-a-cross\n        var p = new DOMParser(),\n            errorneousParse = p.parseFromString('<', 'text/xml'),\n            parsererrorNS = errorneousParse.getElementsByTagName(\"parsererror\")[0].namespaceURI;\n\n        if (parsererrorNS === 'http://www.w3.org/1999/xhtml') {\n            // In PhantomJS the parseerror element doesn't seem to have a special namespace, so we are just guessing here :(\n            return parsedDocument.getElementsByTagName(\"parsererror\").length > 0;\n        }\n\n        return parsedDocument.getElementsByTagNameNS(parsererrorNS, 'parsererror').length > 0;\n    };\n\n    var failOnParseError = function (doc) {\n        if (doc === null || isParseError(doc)) {\n            throw {\n                message: \"Invalid source\"\n            };\n        }\n    };\n\n    module.validateXHTML = function (xhtml) {\n        var p = new DOMParser(),\n            doc = p.parseFromString(xhtml, \"application/xml\");\n\n        failOnParseError(doc);\n    };\n\n    var lastCacheDate = null;\n\n    var getUncachableURL = function (url, cache) {\n        if (cache === 'none' || cache === 'repeated') {\n            if (lastCacheDate === null || cache !== 'repeated') {\n                lastCacheDate = Date.now();\n            }\n            return url + \"?_=\" + lastCacheDate;\n        } else {\n            return url;\n        }\n    };\n\n    var doDocumentLoad = function (url, options) {\n        var ajaxRequest = new window.XMLHttpRequest(),\n            joinedUrl = util.joinUrl(options.baseUrl, url),\n            augmentedUrl = getUncachableURL(joinedUrl, options.cache),\n            defer = ayepromise.defer(),\n            doReject = function () {\n                defer.reject({message: \"Unable to load page\"});\n            };\n\n        ajaxRequest.addEventListener(\"load\", function () {\n            if (ajaxRequest.status === 200 || ajaxRequest.status === 0) {\n                defer.resolve(ajaxRequest.responseXML);\n            } else {\n                doReject();\n            }\n        }, false);\n\n        ajaxRequest.addEventListener(\"error\", function () {\n            doReject();\n        }, false);\n\n        try {\n            ajaxRequest.open('GET', augmentedUrl, true);\n            ajaxRequest.responseType = \"document\";\n            ajaxRequest.send(null);\n        } catch (err) {\n            doReject();\n        }\n\n        return defer.promise;\n    };\n\n    module.loadDocument = function (url, options) {\n        return doDocumentLoad(url, options)\n            .then(function (doc) {\n                failOnParseError(doc);\n\n                return doc;\n            });\n    };\n\n    return module;\n}(util, proxies, ayepromise, window));\n\nvar svg2image = (function (ayepromise, window) {\n    \"use strict\";\n\n    var module = {};\n\n    var urlForSvg = function (svg, useBlobs) {\n        if (useBlobs) {\n            return URL.createObjectURL(new Blob([svg], {\"type\": \"image/svg+xml\"}));\n        } else {\n            return \"data:image/svg+xml;charset=utf-8,\" + encodeURIComponent(svg);\n        }\n    };\n\n    var cleanUpUrl = function (url) {\n        if (url instanceof Blob) {\n            URL.revokeObjectURL(url);\n        }\n    };\n\n    var simpleForeignObjectSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"1\" height=\"1\"><foreignObject></foreignObject></svg>';\n\n    var supportsReadingObjectFromCanvas = function (url) {\n        var canvas = document.createElement(\"canvas\"),\n            image = new Image(),\n            defer = ayepromise.defer();\n\n        image.onload = function () {\n            var context = canvas.getContext(\"2d\");\n            try {\n                context.drawImage(image, 0, 0);\n                // This will fail in Chrome & Safari\n                canvas.toDataURL(\"image/png\");\n                defer.resolve(true);\n            } catch (e) {\n                defer.resolve(false);\n            }\n        };\n        image.onerror = defer.reject;\n        image.src = url;\n\n        return defer.promise;\n    };\n\n    var readingBackFromCanvasBenefitsFromOldSchoolDataUris = function () {\n        // Check for work around for https://code.google.com/p/chromium/issues/detail?id=294129\n        var blobUrl = urlForSvg(simpleForeignObjectSvg, true);\n        return supportsReadingObjectFromCanvas(blobUrl)\n            .then(function (supportsReadingFromBlobs) {\n                cleanUpUrl(blobUrl);\n                if (supportsReadingFromBlobs) {\n                    return false;\n                }\n                return supportsReadingObjectFromCanvas(urlForSvg(simpleForeignObjectSvg, false))\n                    .then(function (s) {\n                        return s;\n                    });\n            }, function () {\n                return false;\n            });\n    };\n\n    var supportsBlobBuilding = function () {\n        if (window.Blob) {\n            // Available as constructor only in newer builds for all browsers\n            try {\n                new Blob(['<b></b>'], { \"type\" : \"text/xml\" });\n                return true;\n            } catch (err) {}\n        }\n        return false;\n    };\n\n    var checkBlobSupport = function () {\n        var defer = ayepromise.defer();\n\n        if (supportsBlobBuilding && window.URL) {\n            readingBackFromCanvasBenefitsFromOldSchoolDataUris()\n                .then(function (doesBenefit) {\n                    defer.resolve(! doesBenefit);\n                }, function () {\n                    defer.reject();\n                });\n        } else {\n            defer.resolve(false);\n        }\n\n        return defer.promise;\n    };\n\n    var checkForBlobsResult;\n\n    var checkForBlobs = function () {\n        if (checkForBlobsResult === undefined) {\n            checkForBlobsResult = checkBlobSupport();\n        }\n\n        return checkForBlobsResult;\n    };\n\n    var buildImageUrl = function (svg) {\n        return checkForBlobs().then(function (useBlobs) {\n            return urlForSvg(svg, useBlobs);\n        });\n    };\n\n    module.renderSvg = function (svg) {\n        var url, image,\n            defer = ayepromise.defer(),\n            resetEventHandlers = function () {\n                image.onload = null;\n                image.onerror = null;\n            },\n            cleanUp = function () {\n                if (url) {\n                    cleanUpUrl(url);\n                }\n            };\n\n        image = new Image();\n        image.onload = function() {\n            resetEventHandlers();\n            cleanUp();\n\n            defer.resolve(image);\n        };\n        image.onerror = function () {\n            cleanUp();\n\n            // Webkit calls the onerror handler if the SVG is faulty\n            defer.reject();\n        };\n\n        buildImageUrl(svg).then(function (imageUrl) {\n            url = imageUrl;\n            image.src = url;\n        }, defer.reject);\n\n        return defer.promise;\n    };\n\n    return module;\n}(ayepromise, window));\n\nvar document2svg = (function (util, browser, documentHelper, mediaQueryHelper, xmlserializer) {\n    \"use strict\";\n\n    var module = {};\n\n    var zoomedElementSizingAttributes = function (size, zoomFactor) {\n        var closestScaledWith, closestScaledHeight,\n            offsetX, offsetY;\n\n        zoomFactor = zoomFactor || 1;\n        closestScaledWith = Math.round(size.viewportWidth);\n        closestScaledHeight = Math.round(size.viewportHeight);\n\n        offsetX = -size.left;\n        offsetY = -size.top;\n\n        var attributes = {\n             'x': offsetX,\n             'y': offsetY,\n             'width': closestScaledWith,\n             'height': closestScaledHeight\n        };\n\n        if (zoomFactor !== 1) {\n            attributes.transform = 'scale(' + zoomFactor + ')';\n        }\n\n        return attributes;\n    };\n\n    var workAroundCollapsingMarginsAcrossSVGElementInWebKitLike = function (attributes) {\n        var style = attributes.style || '';\n        attributes.style = style + 'float: left;';\n    };\n\n    var workAroundSafariSometimesNotShowingExternalResources = function (attributes) {\n        /* Let's hope that works some magic. The spec says SVGLoad only fires\n         * now when all externals are available.\n         * http://www.w3.org/TR/SVG/struct.html#ExternalResourcesRequired */\n        attributes.externalResourcesRequired = true;\n    };\n\n    var workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll = function () {\n        return '<style scoped=\"\">html::-webkit-scrollbar { display: none; }</style>';\n    };\n\n    var serializeAttributes = function (attributes) {\n        var keys = Object.keys(attributes);\n        if (!keys.length) {\n            return '';\n        }\n\n        return ' ' + keys.map(function (key) {\n            return key + '=\"' + attributes[key] + '\"';\n        }).join(' ');\n    };\n\n    var convertDocumentToSvg = function (doc, size, zoomFactor) {\n        var xhtml = xmlserializer.serializeToString(doc);\n\n        browser.validateXHTML(xhtml);\n\n        var attributes = zoomedElementSizingAttributes(size, zoomFactor);\n\n        workAroundCollapsingMarginsAcrossSVGElementInWebKitLike(attributes);\n        workAroundSafariSometimesNotShowingExternalResources(attributes);\n\n        return (\n            '<svg xmlns=\"http://www.w3.org/2000/svg\"' +\n                ' width=\"' + size.width + '\"' +\n                ' height=\"' + size.height + '\"' +\n                ' font-size=\"' + size.rootFontSize + '\"' +\n                '>' +\n                workAroundChromeShowingScrollbarsUnderLinuxIfHtmlIsOverflowScroll() +\n                '<foreignObject' + serializeAttributes(attributes) + '>' +\n                xhtml +\n                '</foreignObject>' +\n                '</svg>'\n        );\n    };\n\n    module.getSvgForDocument = function (doc, size, zoomFactor) {\n        documentHelper.rewriteTagNameSelectorsToLowerCase(doc);\n\n        return mediaQueryHelper.needsEmWorkaround().then(function (needsWorkaround) {\n            if (needsWorkaround) {\n                mediaQueryHelper.workAroundWebKitEmSizeIssue(doc);\n            }\n\n            return convertDocumentToSvg(doc, size, zoomFactor);\n        });\n    };\n\n    module.drawDocumentAsSvg = function (doc, options) {\n        if (options.hover) {\n            documentHelper.fakeHover(doc, options.hover);\n        }\n        if (options.active) {\n            documentHelper.fakeActive(doc, options.active);\n        }\n        if (options.focus) {\n            documentHelper.fakeFocus(doc, options.focus);\n        }\n\n        return browser.calculateDocumentContentSize(doc, options)\n            .then(function (size) {\n                return module.getSvgForDocument(doc, size, options.zoom);\n            });\n    };\n\n    return module;\n}(util, browser, documentHelper, mediaQueryHelper, xmlserializer));\n\nvar rasterize = (function (util, browser, documentHelper, document2svg, svg2image, inlineresources) {\n    \"use strict\";\n\n    var module = {};\n\n    var generalDrawError = function () {\n        return {message: \"Error rendering page\"};\n    };\n\n    var drawSvgAsImg = function (svg) {\n        return svg2image.renderSvg(svg)\n            .then(function (image) {\n                return {\n                    image: image,\n                    svg: svg\n                };\n            }, function () {\n                throw generalDrawError();\n            });\n    };\n\n    var drawImageOnCanvas = function (image, canvas) {\n        try {\n            canvas.getContext(\"2d\").drawImage(image, 0, 0);\n        } catch (e) {\n            // Firefox throws a 'NS_ERROR_NOT_AVAILABLE' if the SVG is faulty\n            throw generalDrawError();\n        }\n    };\n\n    var doDraw = function (doc, canvas, options) {\n        return document2svg.drawDocumentAsSvg(doc, options)\n            .then(drawSvgAsImg)\n            .then(function (result) {\n                if (canvas) {\n                    drawImageOnCanvas(result.image, canvas);\n                }\n\n                return result;\n            });\n    };\n\n    var operateJavaScriptOnDocument = function (doc, options) {\n        return browser.executeJavascript(doc, options)\n            .then(function (result) {\n                var document = result.document;\n                documentHelper.persistInputValues(document);\n\n                return {\n                    document: document,\n                    errors: result.errors\n                };\n            });\n    };\n\n    module.rasterize = function (doc, canvas, options) {\n        var inlineOptions;\n\n        inlineOptions = util.clone(options);\n        inlineOptions.inlineScripts = options.executeJs === true;\n\n        return inlineresources.inlineReferences(doc, inlineOptions)\n            .then(function (errors) {\n                if (options.executeJs) {\n                    return operateJavaScriptOnDocument(doc, options)\n                        .then(function (result) {\n                            return {\n                                document: result.document,\n                                errors: errors.concat(result.errors)\n                            };\n                        });\n                } else {\n                    return {\n                        document: doc,\n                        errors: errors\n                    };\n                }\n            }).then(function (result) {\n                return doDraw(result.document, canvas, options)\n                    .then(function (drawResult) {\n                        return {\n                            image: drawResult.image,\n                            svg: drawResult.svg,\n                            errors: result.errors\n                        };\n                    });\n            });\n    };\n\n    return module;\n}(util, browser, documentHelper, document2svg, svg2image, inlineresources));\n\nvar rasterizeHTML = (function (util, browser, rasterize) {\n    \"use strict\";\n\n    var module = {};\n\n    var getViewportSize = function (canvas, options) {\n        var defaultWidth = 300,\n            defaultHeight = 200,\n            fallbackWidth = canvas ? canvas.width : defaultWidth,\n            fallbackHeight = canvas ? canvas.height : defaultHeight,\n            width = options.width !== undefined ? options.width : fallbackWidth,\n            height = options.height !== undefined ? options.height : fallbackHeight;\n\n        return {\n            width: width,\n            height: height\n        };\n    };\n\n    var constructOptions = function (params) {\n        var viewport = getViewportSize(params.canvas, params.options),\n            options;\n\n        options = util.clone(params.options);\n        options.width = viewport.width;\n        options.height = viewport.height;\n\n        return options;\n    };\n\n    /**\n     * Draws a Document to the canvas.\n     * rasterizeHTML.drawDocument( document [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawDocument = function () {\n        var doc = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return rasterize.rasterize(doc, params.canvas, constructOptions(params));\n    };\n\n    var drawHTML = function (html, canvas, options) {\n        var doc = browser.parseHTML(html);\n\n        return module.drawDocument(doc, canvas, options);\n    };\n\n    /**\n     * Draws a HTML string to the canvas.\n     * rasterizeHTML.drawHTML( html [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawHTML = function () {\n        var html = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return drawHTML(html, params.canvas, params.options);\n    };\n\n    // work around https://bugzilla.mozilla.org/show_bug.cgi?id=925493\n    var workAroundFirefoxNotLoadingStylesheetStyles = function (doc, url, options) {\n        var d = document.implementation.createHTMLDocument('');\n        d.replaceChild(doc.documentElement, d.documentElement);\n\n        var extendedOptions = options ? util.clone(options) : {};\n\n        if (!options.baseUrl) {\n            extendedOptions.baseUrl = url;\n        }\n\n        return {\n            document: d,\n            options: extendedOptions\n        };\n    };\n\n    var drawURL = function (url, canvas, options) {\n        return browser.loadDocument(url, options)\n            .then(function (doc) {\n                var workaround = workAroundFirefoxNotLoadingStylesheetStyles(doc, url, options);\n                return module.drawDocument(workaround.document, canvas, workaround.options);\n            });\n    };\n\n    /**\n     * Draws a page to the canvas.\n     * rasterizeHTML.drawURL( url [, canvas] [, options] ).then(function (result) { ... });\n     */\n    module.drawURL = function () {\n        var url = arguments[0],\n            optionalArguments = Array.prototype.slice.call(arguments, 1),\n            params = util.parseOptionalParameters(optionalArguments);\n\n        return drawURL(url, params.canvas, params.options);\n    };\n\n    return module;\n}(util, browser, rasterize));\n\nreturn rasterizeHTML;\n\n}));\n","\"use strict\";\n\nmodule.exports = function Canvas () {\n  return document.createElement('canvas');\n};\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('is-array')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\nBuffer.poolSize = 8192 // not used by this implementation\n\nvar kMaxLength = 0x3fffffff\nvar rootParent = {}\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Note:\n *\n * - Implementation must support adding new properties to `Uint8Array` instances.\n *   Firefox 4-29 lacked support, fixed in Firefox 30+.\n *   See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *  - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *  - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *    incorrect length in some situations.\n *\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they will\n * get the Object implementation, which is slower but will work correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = (function () {\n  try {\n    var buf = new ArrayBuffer(0)\n    var arr = new Uint8Array(buf)\n    arr.foo = function () { return 42 }\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        new Uint8Array(1).subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n})()\n\n/**\n * Class: Buffer\n * =============\n *\n * The Buffer constructor returns instances of `Uint8Array` that are augmented\n * with function properties for all the node `Buffer` API functions. We use\n * `Uint8Array` so that square bracket notation works as expected -- it returns\n * a single octet.\n *\n * By augmenting the instances, we can avoid modifying the `Uint8Array`\n * prototype.\n */\nfunction Buffer (subject, encoding) {\n  var self = this\n  if (!(self instanceof Buffer)) return new Buffer(subject, encoding)\n\n  var type = typeof subject\n  var length\n\n  if (type === 'number') {\n    length = +subject\n  } else if (type === 'string') {\n    length = Buffer.byteLength(subject, encoding)\n  } else if (type === 'object' && subject !== null) {\n    // assume object is array-like\n    if (subject.type === 'Buffer' && isArray(subject.data)) subject = subject.data\n    length = +subject.length\n  } else {\n    throw new TypeError('must start with number, buffer, array or string')\n  }\n\n  if (length > kMaxLength) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum size: 0x' +\n      kMaxLength.toString(16) + ' bytes')\n  }\n\n  if (length < 0) length = 0\n  else length >>>= 0 // coerce to uint32\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Preferred: Return an augmented `Uint8Array` instance for best performance\n    self = Buffer._augment(new Uint8Array(length)) // eslint-disable-line consistent-this\n  } else {\n    // Fallback: Return THIS instance of Buffer (created by `new`)\n    self.length = length\n    self._isBuffer = true\n  }\n\n  var i\n  if (Buffer.TYPED_ARRAY_SUPPORT && typeof subject.byteLength === 'number') {\n    // Speed optimization -- use set if we're copying from a typed array\n    self._set(subject)\n  } else if (isArrayish(subject)) {\n    // Treat array-ish objects as a byte array\n    if (Buffer.isBuffer(subject)) {\n      for (i = 0; i < length; i++) {\n        self[i] = subject.readUInt8(i)\n      }\n    } else {\n      for (i = 0; i < length; i++) {\n        self[i] = ((subject[i] % 256) + 256) % 256\n      }\n    }\n  } else if (type === 'string') {\n    self.write(subject, 0, encoding)\n  } else if (type === 'number' && !Buffer.TYPED_ARRAY_SUPPORT) {\n    for (i = 0; i < length; i++) {\n      self[i] = 0\n    }\n  }\n\n  if (length > 0 && length <= Buffer.poolSize) self.parent = rootParent\n\n  return self\n}\n\nfunction SlowBuffer (subject, encoding) {\n  if (!(this instanceof SlowBuffer)) return new SlowBuffer(subject, encoding)\n\n  var buf = new Buffer(subject, encoding)\n  delete buf.parent\n  return buf\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n  for (var i = 0, len = Math.min(x, y); i < len && a[i] === b[i]; i++) {}\n  if (i !== len) {\n    x = a[i]\n    y = b[i]\n  }\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'binary':\n    case 'base64':\n    case 'raw':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, totalLength) {\n  if (!isArray(list)) throw new TypeError('list argument must be an Array of Buffers.')\n\n  if (list.length === 0) {\n    return new Buffer(0)\n  } else if (list.length === 1) {\n    return list[0]\n  }\n\n  var i\n  if (totalLength === undefined) {\n    totalLength = 0\n    for (i = 0; i < list.length; i++) {\n      totalLength += list[i].length\n    }\n  }\n\n  var buf = new Buffer(totalLength)\n  var pos = 0\n  for (i = 0; i < list.length; i++) {\n    var item = list[i]\n    item.copy(buf, pos)\n    pos += item.length\n  }\n  return buf\n}\n\nBuffer.byteLength = function byteLength (str, encoding) {\n  var ret\n  str = str + ''\n  switch (encoding || 'utf8') {\n    case 'ascii':\n    case 'binary':\n    case 'raw':\n      ret = str.length\n      break\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      ret = str.length * 2\n      break\n    case 'hex':\n      ret = str.length >>> 1\n      break\n    case 'utf8':\n    case 'utf-8':\n      ret = utf8ToBytes(str).length\n      break\n    case 'base64':\n      ret = base64ToBytes(str).length\n      break\n    default:\n      ret = str.length\n  }\n  return ret\n}\n\n// pre-set for values that may exist in the future\nBuffer.prototype.length = undefined\nBuffer.prototype.parent = undefined\n\n// toString(encoding, start=0, end=buffer.length)\nBuffer.prototype.toString = function toString (encoding, start, end) {\n  var loweredCase = false\n\n  start = start >>> 0\n  end = end === undefined || end === Infinity ? this.length : end >>> 0\n\n  if (!encoding) encoding = 'utf8'\n  if (start < 0) start = 0\n  if (end > this.length) end = this.length\n  if (end <= start) return ''\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'binary':\n        return binarySlice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return 0\n  return Buffer.compare(this, b)\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset) {\n  if (byteOffset > 0x7fffffff) byteOffset = 0x7fffffff\n  else if (byteOffset < -0x80000000) byteOffset = -0x80000000\n  byteOffset >>= 0\n\n  if (this.length === 0) return -1\n  if (byteOffset >= this.length) return -1\n\n  // Negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = Math.max(this.length + byteOffset, 0)\n\n  if (typeof val === 'string') {\n    if (val.length === 0) return -1 // special case: looking for empty string always fails\n    return String.prototype.indexOf.call(this, val, byteOffset)\n  }\n  if (Buffer.isBuffer(val)) {\n    return arrayIndexOf(this, val, byteOffset)\n  }\n  if (typeof val === 'number') {\n    if (Buffer.TYPED_ARRAY_SUPPORT && Uint8Array.prototype.indexOf === 'function') {\n      return Uint8Array.prototype.indexOf.call(this, val, byteOffset)\n    }\n    return arrayIndexOf(this, [ val ], byteOffset)\n  }\n\n  function arrayIndexOf (arr, val, byteOffset) {\n    var foundIndex = -1\n    for (var i = 0; byteOffset + i < arr.length; i++) {\n      if (arr[byteOffset + i] === val[foundIndex === -1 ? 0 : i - foundIndex]) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === val.length) return byteOffset + foundIndex\n      } else {\n        foundIndex = -1\n      }\n    }\n    return -1\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\n// `get` will be removed in Node 0.13+\nBuffer.prototype.get = function get (offset) {\n  console.log('.get() is deprecated. Access using array indexes instead.')\n  return this.readUInt8(offset)\n}\n\n// `set` will be removed in Node 0.13+\nBuffer.prototype.set = function set (v, offset) {\n  console.log('.set() is deprecated. Access using array indexes instead.')\n  return this.writeUInt8(v, offset)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new Error('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; i++) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) throw new Error('Invalid hex string')\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  var charsWritten = blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n  return charsWritten\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  var charsWritten = blitBuffer(asciiToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction binaryWrite (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  var charsWritten = blitBuffer(base64ToBytes(string), buf, offset, length)\n  return charsWritten\n}\n\nfunction utf16leWrite (buf, string, offset, length) {\n  var charsWritten = blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n  return charsWritten\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Support both (string, offset, length, encoding)\n  // and the legacy (string, encoding, offset, length)\n  if (isFinite(offset)) {\n    if (!isFinite(length)) {\n      encoding = length\n      length = undefined\n    }\n  } else {  // legacy\n    var swap = encoding\n    encoding = offset\n    offset = length\n    length = swap\n  }\n\n  offset = Number(offset) || 0\n\n  if (length < 0 || offset < 0 || offset > this.length) {\n    throw new RangeError('attempt to write outside buffer bounds')\n  }\n\n  var remaining = this.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n  encoding = String(encoding || 'utf8').toLowerCase()\n\n  var ret\n  switch (encoding) {\n    case 'hex':\n      ret = hexWrite(this, string, offset, length)\n      break\n    case 'utf8':\n    case 'utf-8':\n      ret = utf8Write(this, string, offset, length)\n      break\n    case 'ascii':\n      ret = asciiWrite(this, string, offset, length)\n      break\n    case 'binary':\n      ret = binaryWrite(this, string, offset, length)\n      break\n    case 'base64':\n      ret = base64Write(this, string, offset, length)\n      break\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      ret = utf16leWrite(this, string, offset, length)\n      break\n    default:\n      throw new TypeError('Unknown encoding: ' + encoding)\n  }\n  return ret\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  var res = ''\n  var tmp = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    if (buf[i] <= 0x7F) {\n      res += decodeUtf8Char(tmp) + String.fromCharCode(buf[i])\n      tmp = ''\n    } else {\n      tmp += '%' + buf[i].toString(16)\n    }\n  }\n\n  return res + decodeUtf8Char(tmp)\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction binarySlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; i++) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = Buffer._augment(this.subarray(start, end))\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; i++) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  if (newBuf.length) newBuf.parent = this.parent || this\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('buffer must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkInt(this, value, offset, byteLength, Math.pow(2, 8 * byteLength), 0)\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) >>> 0 & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  byteLength = byteLength >>> 0\n  if (!noAssert) checkInt(this, value, offset, byteLength, Math.pow(2, 8 * byteLength), 0)\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) >>> 0 & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = value\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; i++) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = value\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; i++) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = value\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = value\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkInt(\n      this, value, offset, byteLength,\n      Math.pow(2, 8 * byteLength - 1) - 1,\n      -Math.pow(2, 8 * byteLength - 1)\n    )\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = value < 0 ? 1 : 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) {\n    checkInt(\n      this, value, offset, byteLength,\n      Math.pow(2, 8 * byteLength - 1) - 1,\n      -Math.pow(2, 8 * byteLength - 1)\n    )\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = value < 0 ? 1 : 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = value\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = value\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = value\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset >>> 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = value\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (value > max || value < min) throw new RangeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('index out of range')\n  if (offset < 0) throw new RangeError('index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, target_start, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (target_start >= target.length) target_start = target.length\n  if (!target_start) target_start = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (target_start < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - target_start < end - start) {\n    end = target.length - target_start + start\n  }\n\n  var len = end - start\n\n  if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < len; i++) {\n      target[i + target_start] = this[i + start]\n    }\n  } else {\n    target._set(this.subarray(start, start + len), target_start)\n  }\n\n  return len\n}\n\n// fill(value, start=0, end=buffer.length)\nBuffer.prototype.fill = function fill (value, start, end) {\n  if (!value) value = 0\n  if (!start) start = 0\n  if (!end) end = this.length\n\n  if (end < start) throw new RangeError('end < start')\n\n  // Fill 0 bytes; we're done\n  if (end === start) return\n  if (this.length === 0) return\n\n  if (start < 0 || start >= this.length) throw new RangeError('start out of bounds')\n  if (end < 0 || end > this.length) throw new RangeError('end out of bounds')\n\n  var i\n  if (typeof value === 'number') {\n    for (i = start; i < end; i++) {\n      this[i] = value\n    }\n  } else {\n    var bytes = utf8ToBytes(value.toString())\n    var len = bytes.length\n    for (i = start; i < end; i++) {\n      this[i] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n/**\n * Creates a new `ArrayBuffer` with the *copied* memory of the buffer instance.\n * Added in Node 0.12. Only available in browsers that support ArrayBuffer.\n */\nBuffer.prototype.toArrayBuffer = function toArrayBuffer () {\n  if (typeof Uint8Array !== 'undefined') {\n    if (Buffer.TYPED_ARRAY_SUPPORT) {\n      return (new Buffer(this)).buffer\n    } else {\n      var buf = new Uint8Array(this.length)\n      for (var i = 0, len = buf.length; i < len; i += 1) {\n        buf[i] = this[i]\n      }\n      return buf.buffer\n    }\n  } else {\n    throw new TypeError('Buffer.toArrayBuffer not supported in this browser')\n  }\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar BP = Buffer.prototype\n\n/**\n * Augment a Uint8Array *instance* (not the Uint8Array class!) with Buffer methods\n */\nBuffer._augment = function _augment (arr) {\n  arr.constructor = Buffer\n  arr._isBuffer = true\n\n  // save reference to original Uint8Array set method before overwriting\n  arr._set = arr.set\n\n  // deprecated, will be removed in node 0.13+\n  arr.get = BP.get\n  arr.set = BP.set\n\n  arr.write = BP.write\n  arr.toString = BP.toString\n  arr.toLocaleString = BP.toString\n  arr.toJSON = BP.toJSON\n  arr.equals = BP.equals\n  arr.compare = BP.compare\n  arr.indexOf = BP.indexOf\n  arr.copy = BP.copy\n  arr.slice = BP.slice\n  arr.readUIntLE = BP.readUIntLE\n  arr.readUIntBE = BP.readUIntBE\n  arr.readUInt8 = BP.readUInt8\n  arr.readUInt16LE = BP.readUInt16LE\n  arr.readUInt16BE = BP.readUInt16BE\n  arr.readUInt32LE = BP.readUInt32LE\n  arr.readUInt32BE = BP.readUInt32BE\n  arr.readIntLE = BP.readIntLE\n  arr.readIntBE = BP.readIntBE\n  arr.readInt8 = BP.readInt8\n  arr.readInt16LE = BP.readInt16LE\n  arr.readInt16BE = BP.readInt16BE\n  arr.readInt32LE = BP.readInt32LE\n  arr.readInt32BE = BP.readInt32BE\n  arr.readFloatLE = BP.readFloatLE\n  arr.readFloatBE = BP.readFloatBE\n  arr.readDoubleLE = BP.readDoubleLE\n  arr.readDoubleBE = BP.readDoubleBE\n  arr.writeUInt8 = BP.writeUInt8\n  arr.writeUIntLE = BP.writeUIntLE\n  arr.writeUIntBE = BP.writeUIntBE\n  arr.writeUInt16LE = BP.writeUInt16LE\n  arr.writeUInt16BE = BP.writeUInt16BE\n  arr.writeUInt32LE = BP.writeUInt32LE\n  arr.writeUInt32BE = BP.writeUInt32BE\n  arr.writeIntLE = BP.writeIntLE\n  arr.writeIntBE = BP.writeIntBE\n  arr.writeInt8 = BP.writeInt8\n  arr.writeInt16LE = BP.writeInt16LE\n  arr.writeInt16BE = BP.writeInt16BE\n  arr.writeInt32LE = BP.writeInt32LE\n  arr.writeInt32BE = BP.writeInt32BE\n  arr.writeFloatLE = BP.writeFloatLE\n  arr.writeFloatBE = BP.writeFloatBE\n  arr.writeDoubleLE = BP.writeDoubleLE\n  arr.writeDoubleBE = BP.writeDoubleBE\n  arr.fill = BP.fill\n  arr.inspect = BP.inspect\n  arr.toArrayBuffer = BP.toArrayBuffer\n\n  return arr\n}\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-z\\-]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction isArrayish (subject) {\n  return isArray(subject) || Buffer.isBuffer(subject) ||\n      subject && typeof subject === 'object' &&\n      typeof subject.length === 'number'\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n  var i = 0\n\n  for (; i < length; i++) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (leadSurrogate) {\n        // 2 leads in a row\n        if (codePoint < 0xDC00) {\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          leadSurrogate = codePoint\n          continue\n        } else {\n          // valid surrogate pair\n          codePoint = leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00 | 0x10000\n          leadSurrogate = null\n        }\n      } else {\n        // no lead yet\n\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else {\n          // valid lead\n          leadSurrogate = codePoint\n          continue\n        }\n      }\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n      leadSurrogate = null\n    }\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x200000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; i++) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction decodeUtf8Char (str) {\n  try {\n    return decodeURIComponent(str)\n  } catch (err) {\n    return String.fromCharCode(0xFFFD) // UTF 8 invalid char\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar punycode = require('punycode');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a puny coded representation of \"domain\".\n      // It only converts the part of the domain name that\n      // has non ASCII characters. I.e. it dosent matter if\n      // you call it with a domain that already is in ASCII.\n      var domainArray = this.hostname.split('.');\n      var newOut = [];\n      for (var i = 0; i < domainArray.length; ++i) {\n        var s = domainArray[i];\n        newOut.push(s.match(/[^A-Za-z0-9_-]/) ?\n            'xn--' + punycode.encode(s) : s);\n      }\n      this.hostname = newOut.join('.');\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  Object.keys(this).forEach(function(k) {\n    result[k] = this[k];\n  }, this);\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    Object.keys(relative).forEach(function(k) {\n      if (k !== 'protocol')\n        result[k] = relative[k];\n    });\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      Object.keys(relative).forEach(function(k) {\n        result[k] = relative[k];\n      });\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especialy happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!isNull(result.pathname) || !isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host) && (last === '.' || last === '..') ||\n      last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last == '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especialy happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!isNull(result.pathname) || !isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n\nfunction isString(arg) {\n  return typeof arg === \"string\";\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isNull(arg) {\n  return arg === null;\n}\nfunction isNullOrUndefined(arg) {\n  return  arg == null;\n}\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","/*! http://mths.be/punycode v1.2.4 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^ -~]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /\\x2E|\\u3002|\\uFF0E|\\uFF61/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\twhile (length--) {\n\t\t\tarray[length] = fn(array[length]);\n\t\t}\n\t\treturn array;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings.\n\t * @private\n\t * @param {String} domain The domain name.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\treturn map(string.split(regexSeparators), fn).join('.');\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <http://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * http://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols to a Punycode string of ASCII-only\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name to Unicode. Only the\n\t * Punycoded parts of the domain name will be converted, i.e. it doesn't\n\t * matter if you call it on a string that has already been converted to\n\t * Unicode.\n\t * @memberOf punycode\n\t * @param {String} domain The Punycode domain name to convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(domain) {\n\t\treturn mapDomain(domain, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name to Punycode. Only the\n\t * non-ASCII parts of the domain name will be converted, i.e. it doesn't\n\t * matter if you call it with a domain that's already in ASCII.\n\t * @memberOf punycode\n\t * @param {String} domain The domain name to convert, as a Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name.\n\t */\n\tfunction toASCII(domain) {\n\t\treturn mapDomain(domain, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.2.4',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <http://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","\n/**\n * isArray\n */\n\nvar isArray = Array.isArray;\n\n/**\n * toString\n */\n\nvar str = Object.prototype.toString;\n\n/**\n * Whether or not the given `val`\n * is an array.\n *\n * example:\n *\n *        isArray([]);\n *        // > true\n *        isArray(arguments);\n *        // > false\n *        isArray('');\n *        // > false\n *\n * @param {mixed} val\n * @return {bool}\n */\n\nmodule.exports = isArray || function (val) {\n  return !! val && '[object Array]' == str.call(val);\n};\n","exports.read = function(buffer, offset, isLE, mLen, nBytes) {\n  var e, m,\n      eLen = nBytes * 8 - mLen - 1,\n      eMax = (1 << eLen) - 1,\n      eBias = eMax >> 1,\n      nBits = -7,\n      i = isLE ? (nBytes - 1) : 0,\n      d = isLE ? -1 : 1,\n      s = buffer[offset + i];\n\n  i += d;\n\n  e = s & ((1 << (-nBits)) - 1);\n  s >>= (-nBits);\n  nBits += eLen;\n  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8);\n\n  m = e & ((1 << (-nBits)) - 1);\n  e >>= (-nBits);\n  nBits += mLen;\n  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8);\n\n  if (e === 0) {\n    e = 1 - eBias;\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity);\n  } else {\n    m = m + Math.pow(2, mLen);\n    e = e - eBias;\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen);\n};\n\nexports.write = function(buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c,\n      eLen = nBytes * 8 - mLen - 1,\n      eMax = (1 << eLen) - 1,\n      eBias = eMax >> 1,\n      rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0),\n      i = isLE ? 0 : (nBytes - 1),\n      d = isLE ? 1 : -1,\n      s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0;\n\n  value = Math.abs(value);\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0;\n    e = eMax;\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2);\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--;\n      c *= 2;\n    }\n    if (e + eBias >= 1) {\n      value += rt / c;\n    } else {\n      value += rt * Math.pow(2, 1 - eBias);\n    }\n    if (value * c >= 2) {\n      e++;\n      c /= 2;\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0;\n      e = eMax;\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * Math.pow(2, mLen);\n      e = e + eBias;\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen);\n      e = 0;\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8);\n\n  e = (e << mLen) | m;\n  eLen += mLen;\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8);\n\n  buffer[offset + i - d] |= s * 128;\n};\n","/*\nCopyright (c) 2014, Yahoo! Inc. All rights reserved.\nCopyrights licensed under the New BSD License.\nSee the accompanying LICENSE file for terms.\n*/\n\n'use strict';\n\nexports.match = matchQuery;\nexports.parse = parseQuery;\n\n// -----------------------------------------------------------------------------\n\nvar RE_MEDIA_QUERY     = /(?:(only|not)?\\s*([^\\s\\(\\)]+)(?:\\s*and)?\\s*)?(.+)?/i,\n    RE_MQ_EXPRESSION   = /\\(\\s*([^\\s\\:\\)]+)\\s*(?:\\:\\s*([^\\s\\)]+))?\\s*\\)/,\n    RE_MQ_FEATURE      = /^(?:(min|max)-)?(.+)/,\n    RE_LENGTH_UNIT     = /(em|rem|px|cm|mm|in|pt|pc)?$/,\n    RE_RESOLUTION_UNIT = /(dpi|dpcm|dppx)?$/;\n\nfunction matchQuery(mediaQuery, values) {\n    return parseQuery(mediaQuery).some(function (query) {\n        var inverse = query.inverse;\n\n        // Either the parsed or specified `type` is \"all\", or the types must be\n        // equal for a match.\n        var typeMatch = query.type === 'all' || values.type === query.type;\n\n        // Quit early when `type` doesn't match, but take \"not\" into account.\n        if ((typeMatch && inverse) || !(typeMatch || inverse)) {\n            return false;\n        }\n\n        var expressionsMatch = query.expressions.every(function (expression) {\n            var feature  = expression.feature,\n                modifier = expression.modifier,\n                expValue = expression.value,\n                value    = values[feature];\n\n            // Missing or falsy values don't match.\n            if (!value) { return false; }\n\n            switch (feature) {\n                case 'orientation':\n                case 'scan':\n                    return value.toLowerCase() === expValue.toLowerCase();\n\n                case 'width':\n                case 'height':\n                case 'device-width':\n                case 'device-height':\n                    expValue = toPx(expValue);\n                    value    = toPx(value);\n                    break;\n\n                case 'resolution':\n                    expValue = toDpi(expValue);\n                    value    = toDpi(value);\n                    break;\n\n                case 'aspect-ratio':\n                case 'device-aspect-ratio':\n                case /* Deprecated */ 'device-pixel-ratio':\n                    expValue = toDecimal(expValue);\n                    value    = toDecimal(value);\n                    break;\n\n                case 'grid':\n                case 'color':\n                case 'color-index':\n                case 'monochrome':\n                    expValue = parseInt(expValue, 10) || 1;\n                    value    = parseInt(value, 10) || 0;\n                    break;\n            }\n\n            switch (modifier) {\n                case 'min': return value >= expValue;\n                case 'max': return value <= expValue;\n                default   : return value === expValue;\n            }\n        });\n\n        return (expressionsMatch && !inverse) || (!expressionsMatch && inverse);\n    });\n}\n\nfunction parseQuery(mediaQuery) {\n    return mediaQuery.split(',').map(function (query) {\n        query = query.trim();\n\n        var captures    = query.match(RE_MEDIA_QUERY),\n            modifier    = captures[1],\n            type        = captures[2],\n            expressions = captures[3] || '',\n            parsed      = {};\n\n        parsed.inverse = !!modifier && modifier.toLowerCase() === 'not';\n        parsed.type    = type ? type.toLowerCase() : 'all';\n\n        // Split expressions into a list.\n        expressions = expressions.match(/\\([^\\)]+\\)/g) || [];\n\n        parsed.expressions = expressions.map(function (expression) {\n            var captures = expression.match(RE_MQ_EXPRESSION),\n                feature  = captures[1].toLowerCase().match(RE_MQ_FEATURE);\n\n            return {\n                modifier: feature[1],\n                feature : feature[2],\n                value   : captures[2]\n            };\n        });\n\n        return parsed;\n    });\n}\n\n// -- Utilities ----------------------------------------------------------------\n\nfunction toDecimal(ratio) {\n    var decimal = Number(ratio),\n        numbers;\n\n    if (!decimal) {\n        numbers = ratio.match(/^(\\d+)\\s*\\/\\s*(\\d+)$/);\n        decimal = numbers[1] / numbers[2];\n    }\n\n    return decimal;\n}\n\nfunction toDpi(resolution) {\n    var value = parseFloat(resolution),\n        units = String(resolution).match(RE_RESOLUTION_UNIT)[1];\n\n    switch (units) {\n        case 'dpcm': return value / 2.54;\n        case 'dppx': return value * 96;\n        default    : return value;\n    }\n}\n\nfunction toPx(length) {\n    var value = parseFloat(length),\n        units = String(length).match(RE_LENGTH_UNIT)[1];\n\n    switch (units) {\n        case 'em' : return value * 16;\n        case 'rem': return value * 16;\n        case 'cm' : return value * 96 / 2.54;\n        case 'mm' : return value * 96 / 2.54 / 10;\n        case 'in' : return value * 96;\n        case 'pt' : return value * 72;\n        case 'pc' : return value * 72 / 12;\n        default   : return value;\n    }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n;(function (exports) {\n\t'use strict';\n\n  var Arr = (typeof Uint8Array !== 'undefined')\n    ? Uint8Array\n    : Array\n\n\tvar PLUS   = '+'.charCodeAt(0)\n\tvar SLASH  = '/'.charCodeAt(0)\n\tvar NUMBER = '0'.charCodeAt(0)\n\tvar LOWER  = 'a'.charCodeAt(0)\n\tvar UPPER  = 'A'.charCodeAt(0)\n\tvar PLUS_URL_SAFE = '-'.charCodeAt(0)\n\tvar SLASH_URL_SAFE = '_'.charCodeAt(0)\n\n\tfunction decode (elt) {\n\t\tvar code = elt.charCodeAt(0)\n\t\tif (code === PLUS ||\n\t\t    code === PLUS_URL_SAFE)\n\t\t\treturn 62 // '+'\n\t\tif (code === SLASH ||\n\t\t    code === SLASH_URL_SAFE)\n\t\t\treturn 63 // '/'\n\t\tif (code < NUMBER)\n\t\t\treturn -1 //no match\n\t\tif (code < NUMBER + 10)\n\t\t\treturn code - NUMBER + 26 + 26\n\t\tif (code < UPPER + 26)\n\t\t\treturn code - UPPER\n\t\tif (code < LOWER + 26)\n\t\t\treturn code - LOWER + 26\n\t}\n\n\tfunction b64ToByteArray (b64) {\n\t\tvar i, j, l, tmp, placeHolders, arr\n\n\t\tif (b64.length % 4 > 0) {\n\t\t\tthrow new Error('Invalid string. Length must be a multiple of 4')\n\t\t}\n\n\t\t// the number of equal signs (place holders)\n\t\t// if there are two placeholders, than the two characters before it\n\t\t// represent one byte\n\t\t// if there is only one, then the three characters before it represent 2 bytes\n\t\t// this is just a cheap hack to not do indexOf twice\n\t\tvar len = b64.length\n\t\tplaceHolders = '=' === b64.charAt(len - 2) ? 2 : '=' === b64.charAt(len - 1) ? 1 : 0\n\n\t\t// base64 is 4/3 + up to two characters of the original data\n\t\tarr = new Arr(b64.length * 3 / 4 - placeHolders)\n\n\t\t// if there are placeholders, only get up to the last complete 4 chars\n\t\tl = placeHolders > 0 ? b64.length - 4 : b64.length\n\n\t\tvar L = 0\n\n\t\tfunction push (v) {\n\t\t\tarr[L++] = v\n\t\t}\n\n\t\tfor (i = 0, j = 0; i < l; i += 4, j += 3) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 18) | (decode(b64.charAt(i + 1)) << 12) | (decode(b64.charAt(i + 2)) << 6) | decode(b64.charAt(i + 3))\n\t\t\tpush((tmp & 0xFF0000) >> 16)\n\t\t\tpush((tmp & 0xFF00) >> 8)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\tif (placeHolders === 2) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 2) | (decode(b64.charAt(i + 1)) >> 4)\n\t\t\tpush(tmp & 0xFF)\n\t\t} else if (placeHolders === 1) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 10) | (decode(b64.charAt(i + 1)) << 4) | (decode(b64.charAt(i + 2)) >> 2)\n\t\t\tpush((tmp >> 8) & 0xFF)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\treturn arr\n\t}\n\n\tfunction uint8ToBase64 (uint8) {\n\t\tvar i,\n\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\toutput = \"\",\n\t\t\ttemp, length\n\n\t\tfunction encode (num) {\n\t\t\treturn lookup.charAt(num)\n\t\t}\n\n\t\tfunction tripletToBase64 (num) {\n\t\t\treturn encode(num >> 18 & 0x3F) + encode(num >> 12 & 0x3F) + encode(num >> 6 & 0x3F) + encode(num & 0x3F)\n\t\t}\n\n\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])\n\t\t\toutput += tripletToBase64(temp)\n\t\t}\n\n\t\t// pad the end with zeros, but make sure to not forget the extra bytes\n\t\tswitch (extraBytes) {\n\t\t\tcase 1:\n\t\t\t\ttemp = uint8[uint8.length - 1]\n\t\t\t\toutput += encode(temp >> 2)\n\t\t\t\toutput += encode((temp << 4) & 0x3F)\n\t\t\t\toutput += '=='\n\t\t\t\tbreak\n\t\t\tcase 2:\n\t\t\t\ttemp = (uint8[uint8.length - 2] << 8) + (uint8[uint8.length - 1])\n\t\t\t\toutput += encode(temp >> 10)\n\t\t\t\toutput += encode((temp >> 4) & 0x3F)\n\t\t\t\toutput += encode((temp << 2) & 0x3F)\n\t\t\t\toutput += '='\n\t\t\t\tbreak\n\t\t}\n\n\t\treturn output\n\t}\n\n\texports.toByteArray = b64ToByteArray\n\texports.fromByteArray = uint8ToBase64\n}(typeof exports === 'undefined' ? (this.base64js = {}) : exports))\n","var removeInvalidCharacters = function (content) {\n    // See http://www.w3.org/TR/xml/#NT-Char for valid XML 1.0 characters\n    return content.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F]/g, '');\n};\n\nvar serializeAttributeValue = function (value) {\n    return value\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&apos;');\n};\n\nvar serializeTextContent = function (content) {\n    return content\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n};\n\nvar serializeAttribute = function (attr) {\n    var value = attr.value;\n\n    return ' ' + attr.name + '=\"' + serializeAttributeValue(value) + '\"';\n};\n\nvar getTagName = function (node) {\n    var tagName = node.tagName;\n\n    // Aid in serializing of original HTML documents\n    if (node.namespaceURI === 'http://www.w3.org/1999/xhtml') {\n        tagName = tagName.toLowerCase();\n    }\n    return tagName;\n};\n\nvar serializeNamespace = function (node) {\n    var nodeHasXmlnsAttr = Array.prototype.map.call(node.attributes || node.attrs, function (attr) {\n            return attr.name;\n        })\n        .indexOf('xmlns') >= 0;\n    // Serialize the namespace as an xmlns attribute whenever the element\n    // doesn't already have one and the inherited namespace does not match\n    // the element's namespace.\n    // As a special case, always include an xmlns for html elements, in case\n    // of broken namespaceURI handling by browsers.\n    if (!nodeHasXmlnsAttr &&\n            (!node.parentNode ||\n             node.namespaceURI !== node.parentNode.namespaceURI ||\n             getTagName(node) === 'html')) {\n         return ' xmlns=\"' + node.namespaceURI + '\"';\n    } else {\n        return '';\n    }\n};\n\nvar serializeChildren = function (node) {\n    return Array.prototype.map.call(node.childNodes, function (childNode) {\n        return nodeTreeToXHTML(childNode);\n    }).join('');\n};\n\nvar serializeTag = function (node) {\n    var output = '<' + getTagName(node);\n    output += serializeNamespace(node);\n\n    Array.prototype.forEach.call(node.attributes || node.attrs, function (attr) {\n        output += serializeAttribute(attr);\n    });\n\n    if (node.childNodes.length > 0) {\n        output += '>';\n        output += serializeChildren(node);\n        output += '</' + getTagName(node) + '>';\n    } else {\n        output += '/>';\n    }\n    return output;\n};\n\nvar serializeText = function (node) {\n    var text = node.nodeValue || node.value || '';\n    return serializeTextContent(text);\n};\n\nvar serializeComment = function (node) {\n    return '<!--' +\n        node.data\n            .replace(/-/g, '&#45;') +\n        '-->';\n};\n\nvar serializeCDATA = function (node) {\n    return '<![CDATA[' + node.nodeValue + ']]>';\n};\n\nvar nodeTreeToXHTML = function (node) {\n    if (node.nodeName === '#document' ||\n        node.nodeName === '#document-fragment') {\n        return serializeChildren(node);\n    } else {\n        if (node.tagName) {\n            return serializeTag(node);\n        } else if (node.nodeName === '#text') {\n            return serializeText(node);\n        } else if (node.nodeName === '#comment') {\n            return serializeComment(node);\n        } else if (node.nodeName === '#cdata-section') {\n            return serializeCDATA(node);\n        }\n    }\n};\n\nexports.serializeToString = function (document) {\n    return removeInvalidCharacters(nodeTreeToXHTML(document));\n};\n","\"use strict\";\n\nvar util = require('./util'),\n    inlineImage = require('./inlineImage'),\n    inlineScript = require('./inlineScript'),\n    inlineCss = require('./inlineCss'),\n    cssSupport = require('./cssSupport');\n\n\nvar getUrlBasePath = function (url) {\n    return util.joinUrl(url, '.');\n};\n\nvar parameterHashFunction = function (params) {\n    // HACK JSON.stringify is poor man's hashing;\n    // same objects might not receive same result as key order is not guaranteed\n    var a = params.map(function (param, idx) {\n        // Only include options relevant for method\n        if (idx === (params.length - 1)) {\n            param = {\n                // Two different HTML pages on the same path level have the same base path, but a different URL\n                baseUrl: getUrlBasePath(param.baseUrl)\n            };\n        }\n        return JSON.stringify(param);\n    });\n    return a;\n};\n\nvar memoizeFunctionOnCaching = function (func, options) {\n    if ((options.cache !== false && options.cache !== 'none') && options.cacheBucket) {\n        return util.memoize(func, parameterHashFunction, options.cacheBucket);\n    } else {\n        return func;\n    }\n};\n\n/* Style inlining */\n\nvar requestExternalsForStylesheet = function (styleContent, alreadyLoadedCssUrls, options) {\n    var cssRules = cssSupport.rulesForCssText(styleContent);\n\n    return inlineCss.loadCSSImportsForRules(cssRules, alreadyLoadedCssUrls, options).then(function (cssImportResult) {\n        return inlineCss.loadAndInlineCSSResourcesForRules(cssRules, options).then(function (cssResourcesResult) {\n            var errors = cssImportResult.errors.concat(cssResourcesResult.errors),\n                hasChanges = cssImportResult.hasChanges || cssResourcesResult.hasChanges;\n\n            if (hasChanges) {\n                styleContent = cssSupport.cssRulesToText(cssRules);\n            }\n\n            return {\n                hasChanges: hasChanges,\n                content: styleContent,\n                errors: errors\n            };\n        });\n    });\n};\n\nvar loadAndInlineCssForStyle = function (style, options, alreadyLoadedCssUrls) {\n    var styleContent = style.textContent,\n        processExternals = memoizeFunctionOnCaching(requestExternalsForStylesheet, options);\n\n    return processExternals(styleContent, alreadyLoadedCssUrls, options).then(function (result) {\n        if (result.hasChanges) {\n            style.childNodes[0].nodeValue = result.content;\n        }\n\n        return util.cloneArray(result.errors);\n    });\n};\n\nvar getCssStyleElements = function (doc) {\n    var styles = doc.getElementsByTagName(\"style\");\n\n    return Array.prototype.filter.call(styles, function (style) {\n        return !style.attributes.type || style.attributes.type.nodeValue === \"text/css\";\n    });\n};\n\nexports.loadAndInlineStyles = function (doc, options) {\n    var styles = getCssStyleElements(doc),\n        allErrors = [],\n        alreadyLoadedCssUrls = [],\n        inlineOptions;\n\n    inlineOptions = util.clone(options);\n    inlineOptions.baseUrl = inlineOptions.baseUrl || util.getDocumentBaseUrl(doc);\n\n    return util.all(styles.map(function (style) {\n        return loadAndInlineCssForStyle(style, inlineOptions, alreadyLoadedCssUrls).then(function (errors) {\n            allErrors = allErrors.concat(errors);\n        });\n    })).then(function () {\n        return allErrors;\n    });\n};\n\n/* CSS link inlining */\n\nvar substituteLinkWithInlineStyle = function (oldLinkNode, styleContent) {\n    var parent = oldLinkNode.parentNode,\n        styleNode;\n\n    styleContent = styleContent.trim();\n    if (styleContent) {\n        styleNode = oldLinkNode.ownerDocument.createElement(\"style\");\n        styleNode.type = \"text/css\";\n        styleNode.appendChild(oldLinkNode.ownerDocument.createTextNode(styleContent));\n\n        parent.insertBefore(styleNode, oldLinkNode);\n    }\n\n    parent.removeChild(oldLinkNode);\n};\n\nvar requestStylesheetAndInlineResources = function (url, options) {\n    return util.ajax(url, options)\n        .then(function (content) {\n            var cssRules = cssSupport.rulesForCssText(content);\n\n            return {\n                content: content,\n                cssRules: cssRules\n            };\n        })\n        .then(function (result) {\n            var hasChangesFromPathAdjustment = inlineCss.adjustPathsOfCssResources(url, result.cssRules);\n\n            return {\n                content: result.content,\n                cssRules: result.cssRules,\n                hasChanges: hasChangesFromPathAdjustment\n            };\n        })\n        .then(function (result) {\n            return inlineCss.loadCSSImportsForRules(result.cssRules, [], options)\n                .then(function (cssImportResult) {\n                    return {\n                        content: result.content,\n                        cssRules: result.cssRules,\n                        hasChanges: result.hasChanges || cssImportResult.hasChanges,\n                        errors: cssImportResult.errors\n                    };\n                });\n        })\n        .then(function (result) {\n            return inlineCss.loadAndInlineCSSResourcesForRules(result.cssRules, options)\n                .then(function (cssResourcesResult) {\n                    return {\n                        content: result.content,\n                        cssRules: result.cssRules,\n                        hasChanges: result.hasChanges || cssResourcesResult.hasChanges,\n                        errors: result.errors.concat(cssResourcesResult.errors)\n                    };\n                });\n        })\n        .then(function (result) {\n            var content = result.content;\n            if (result.hasChanges) {\n                content = cssSupport.cssRulesToText(result.cssRules);\n            }\n            return {\n                content: content,\n                errors: result.errors\n            };\n        });\n};\n\nvar loadLinkedCSS = function (link, options) {\n    var cssHref = link.attributes.href.nodeValue,\n        documentBaseUrl = util.getDocumentBaseUrl(link.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBaseUrl) {\n        ajaxOptions.baseUrl = documentBaseUrl;\n    }\n\n    var processStylesheet = memoizeFunctionOnCaching(requestStylesheetAndInlineResources, options);\n\n    return processStylesheet(cssHref, ajaxOptions).then(function (result) {\n        return {\n            content: result.content,\n            errors: util.cloneArray(result.errors)\n        };\n    });\n};\n\nvar getCssStylesheetLinks = function (doc) {\n    var links = doc.getElementsByTagName(\"link\");\n\n    return Array.prototype.filter.call(links, function (link) {\n        return link.attributes.rel && link.attributes.rel.nodeValue === \"stylesheet\" &&\n            (!link.attributes.type || link.attributes.type.nodeValue === \"text/css\");\n    });\n};\n\nexports.loadAndInlineCssLinks = function (doc, options) {\n    var links = getCssStylesheetLinks(doc),\n        errors = [];\n\n    return util.all(links.map(function (link) {\n        return loadLinkedCSS(link, options).then(function(result) {\n            substituteLinkWithInlineStyle(link, result.content + \"\\n\");\n\n            errors = errors.concat(result.errors);\n        }, function (e) {\n            errors.push({\n                resourceType: \"stylesheet\",\n                url: e.url,\n                msg: \"Unable to load stylesheet \" + e.url\n            });\n        });\n    })).then(function () {\n        return errors;\n    });\n};\n\n/* Main */\n\nexports.loadAndInlineImages = inlineImage.inline;\nexports.loadAndInlineScript = inlineScript.inline;\n\nexports.inlineReferences = function (doc, options) {\n    var allErrors = [],\n        inlineFuncs = [\n            exports.loadAndInlineImages,\n            exports.loadAndInlineStyles,\n            exports.loadAndInlineCssLinks];\n\n    if (options.inlineScripts !== false) {\n        inlineFuncs.push(exports.loadAndInlineScript);\n    }\n\n    return util.all(inlineFuncs.map(function (func) {\n        return func(doc, options)\n            .then(function (errors) {\n                allErrors = allErrors.concat(errors);\n            });\n    })).then(function () {\n        return allErrors;\n    });\n};\n","\"use strict\";\n\nvar url = require('url'),\n    ayepromise = require('ayepromise');\n\n\nexports.getDocumentBaseUrl = function (doc) {\n    if (doc.baseURI !== 'about:blank') {\n        return doc.baseURI;\n    }\n\n    return null;\n};\n\nexports.clone = function (object) {\n    var theClone = {},\n        i;\n    for (i in object) {\n        if (object.hasOwnProperty(i)) {\n           theClone[i] = object[i];\n        }\n    }\n    return theClone;\n};\n\nexports.cloneArray = function (nodeList) {\n    return Array.prototype.slice.apply(nodeList, [0]);\n};\n\nexports.joinUrl = function (baseUrl, relUrl) {\n    if (!baseUrl) {\n        return relUrl;\n    }\n    return url.resolve(baseUrl, relUrl);\n};\n\nexports.isDataUri = function (url) {\n    return (/^data:/).test(url);\n};\n\nexports.all = function (promises) {\n    var defer = ayepromise.defer(),\n        pendingPromiseCount = promises.length,\n        resolvedValues = [];\n\n    if (promises.length === 0) {\n        defer.resolve([]);\n        return defer.promise;\n    }\n\n    promises.forEach(function (promise, idx) {\n        promise.then(function (value) {\n            pendingPromiseCount -= 1;\n            resolvedValues[idx] = value;\n\n            if (pendingPromiseCount === 0) {\n                defer.resolve(resolvedValues);\n            }\n        }, function (e) {\n            defer.reject(e);\n        });\n    });\n    return defer.promise;\n};\n\nexports.collectAndReportErrors = function (promises) {\n    var errors = [];\n\n    return exports.all(promises.map(function (promise) {\n        return promise.fail(function (e) {\n            errors.push(e);\n        });\n    })).then(function () {\n        return errors;\n    });\n};\n\nvar lastCacheDate = null;\n\nvar getUncachableURL = function (url, cache) {\n    if (cache === false || cache === 'none' || cache === 'repeated') {\n        if (lastCacheDate === null || cache !== 'repeated') {\n            lastCacheDate = Date.now();\n        }\n        return url + \"?_=\" + lastCacheDate;\n    } else {\n        return url;\n    }\n};\n\nexports.ajax = function (url, options) {\n    var ajaxRequest = new window.XMLHttpRequest(),\n        defer = ayepromise.defer(),\n        joinedUrl = exports.joinUrl(options.baseUrl, url),\n        augmentedUrl;\n\n    var doReject = function () {\n        defer.reject({\n            msg: 'Unable to load url',\n            url: joinedUrl\n        });\n    };\n\n    augmentedUrl = getUncachableURL(joinedUrl, options.cache);\n\n    ajaxRequest.addEventListener(\"load\", function () {\n        if (ajaxRequest.status === 200 || ajaxRequest.status === 0) {\n            defer.resolve(ajaxRequest.response);\n        } else {\n            doReject();\n        }\n    }, false);\n\n    ajaxRequest.addEventListener(\"error\", doReject, false);\n\n    try {\n        ajaxRequest.open('GET', augmentedUrl, true);\n        ajaxRequest.overrideMimeType(options.mimeType);\n        ajaxRequest.send(null);\n    } catch (e) {\n        doReject();\n    }\n\n    return defer.promise;\n};\n\nexports.binaryAjax = function (url, options) {\n    var ajaxOptions = exports.clone(options);\n\n    ajaxOptions.mimeType = 'text/plain; charset=x-user-defined';\n\n    return exports.ajax(url, ajaxOptions)\n        .then(function (content) {\n            var binaryContent = \"\";\n\n            for (var i = 0; i < content.length; i++) {\n                binaryContent += String.fromCharCode(content.charCodeAt(i) & 0xFF);\n            }\n\n            return binaryContent;\n        });\n};\n\nvar detectMimeType = function (content) {\n    var startsWith = function (string, substring) {\n        return string.substring(0, substring.length) === substring;\n    };\n\n    if (startsWith(content, '<?xml') || startsWith(content, '<svg')) {\n        return 'image/svg+xml';\n    }\n    return 'image/png';\n};\n\nexports.getDataURIForImageURL = function (url, options) {\n    return exports.binaryAjax(url, options)\n        .then(function (content) {\n            var base64Content = btoa(content),\n                mimeType = detectMimeType(content);\n\n            return 'data:' + mimeType + ';base64,' + base64Content;\n        });\n};\n\nvar uniqueIdList = [];\n\nvar constantUniqueIdFor = function (element) {\n    // HACK, using a list results in O(n), but how do we hash a function?\n    if (uniqueIdList.indexOf(element) < 0) {\n        uniqueIdList.push(element);\n    }\n    return uniqueIdList.indexOf(element);\n};\n\nexports.memoize = function (func, hasher, memo) {\n    if (typeof memo !== \"object\") {\n        throw new Error(\"cacheBucket is not an object\");\n    }\n\n    return function () {\n        var args = Array.prototype.slice.call(arguments);\n\n        var argumentHash = hasher(args),\n            funcHash = constantUniqueIdFor(func),\n            retValue;\n\n        if (memo[funcHash] && memo[funcHash][argumentHash]) {\n            return memo[funcHash][argumentHash];\n        } else {\n            retValue = func.apply(null, args);\n\n            memo[funcHash] = memo[funcHash] || {};\n            memo[funcHash][argumentHash] = retValue;\n\n            return retValue;\n        }\n    };\n};\n","\"use strict\";\n\nvar util = require('./util');\n\n\nvar encodeImageAsDataURI = function (image, options) {\n    var url = image.attributes.src ? image.attributes.src.nodeValue : null,\n        documentBase = util.getDocumentBaseUrl(image.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBase) {\n        ajaxOptions.baseUrl = documentBase;\n    }\n\n    return util.getDataURIForImageURL(url, ajaxOptions)\n        .then(function (dataURI) {\n            return dataURI;\n        }, function (e) {\n            throw {\n                resourceType: \"image\",\n                url: e.url,\n                msg: \"Unable to load image \" + e.url\n            };\n        });\n};\n\nvar filterExternalImages = function (images) {\n    return images.filter(function (image) {\n        var url = image.attributes.src ? image.attributes.src.nodeValue : null;\n\n        return url !== null && !util.isDataUri(url);\n    });\n};\n\nvar filterInputsForImageType = function (inputs) {\n    return Array.prototype.filter.call(inputs, function (input) {\n        return input.type === \"image\";\n    });\n};\n\nvar toArray = function (arrayLike) {\n    return Array.prototype.slice.call(arrayLike);\n};\n\nexports.inline = function (doc, options) {\n    var images = toArray(doc.getElementsByTagName(\"img\")),\n        imageInputs = filterInputsForImageType(doc.getElementsByTagName(\"input\")),\n        externalImages = filterExternalImages(images.concat(imageInputs));\n\n    return util.collectAndReportErrors(externalImages.map(function (image) {\n        return encodeImageAsDataURI(image, options).then(function (dataURI) {\n            image.attributes.src.nodeValue = dataURI;\n        });\n    }));\n};\n","\"use strict\";\n\nvar util = require('./util');\n\n\nvar loadLinkedScript = function (script, options) {\n    var src = script.attributes.src.nodeValue,\n        documentBase = util.getDocumentBaseUrl(script.ownerDocument),\n        ajaxOptions = util.clone(options);\n\n    if (!ajaxOptions.baseUrl && documentBase) {\n        ajaxOptions.baseUrl = documentBase;\n    }\n\n    return util.ajax(src, ajaxOptions)\n        .fail(function (e) {\n            throw {\n                resourceType: \"script\",\n                url: e.url,\n                msg: \"Unable to load script \" + e.url\n            };\n        });\n};\n\nvar escapeClosingTags = function (text) {\n    // http://stackoverflow.com/questions/9246382/escaping-script-tag-inside-javascript\n    return text.replace(/<\\//g, '<\\\\/');\n};\n\nvar substituteExternalScriptWithInline = function (scriptNode, jsCode) {\n    scriptNode.attributes.removeNamedItem('src');\n    scriptNode.textContent = escapeClosingTags(jsCode);\n};\n\nvar getScripts = function (doc) {\n    var scripts = doc.getElementsByTagName(\"script\");\n\n    return Array.prototype.filter.call(scripts, function (script) {\n        return !!script.attributes.src;\n    });\n};\n\nexports.inline = function (doc, options) {\n    var scripts = getScripts(doc);\n\n    return util.collectAndReportErrors(scripts.map(function (script) {\n        return loadLinkedScript(script, options).then(function (jsCode) {\n            substituteExternalScriptWithInline(script, jsCode);\n        });\n    }));\n};\n","\"use strict\";\n\nvar ayepromise = require('ayepromise'),\n    util = require('./util'),\n    cssSupport = require('./cssSupport'),\n    backgroundValueParser = require('./backgroundValueParser'),\n    fontFaceSrcValueParser = require('css-font-face-src');\n\n\nvar updateCssPropertyValue = function (rule, property, value) {\n    rule.style.setProperty(property, value, rule.style.getPropertyPriority(property));\n};\n\nvar findBackgroundImageRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.STYLE_RULE && (rule.style.getPropertyValue('background-image') || rule.style.getPropertyValue('background'));\n    });\n};\n\nvar findBackgroundDeclarations = function (rules) {\n    var backgroundDeclarations = [];\n\n    rules.forEach(function (rule) {\n        if (rule.style.getPropertyValue('background-image')) {\n            backgroundDeclarations.push({\n                property: 'background-image',\n                value: rule.style.getPropertyValue('background-image'),\n                rule: rule\n            });\n        } else if (rule.style.getPropertyValue('background')) {\n            backgroundDeclarations.push({\n                property: 'background',\n                value: rule.style.getPropertyValue('background'),\n                rule: rule\n            });\n        }\n    });\n\n    return backgroundDeclarations;\n};\n\nvar findFontFaceRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.FONT_FACE_RULE && rule.style.getPropertyValue(\"src\");\n    });\n};\n\nvar findCSSImportRules = function (cssRules) {\n    return cssRules.filter(function (rule) {\n        return rule.type === window.CSSRule.IMPORT_RULE && rule.href;\n    });\n};\n\nvar findExternalBackgroundUrls = function (parsedBackground) {\n    var matchIndices = [];\n\n    parsedBackground.forEach(function (backgroundLayer, i) {\n        if (backgroundLayer.url && !util.isDataUri(backgroundLayer.url)) {\n            matchIndices.push(i);\n        }\n    });\n\n    return matchIndices;\n};\n\nvar findExternalFontFaceUrls = function (parsedFontFaceSources) {\n    var sourceIndices = [];\n    parsedFontFaceSources.forEach(function (sourceItem, i) {\n        if (sourceItem.url && !util.isDataUri(sourceItem.url)) {\n            sourceIndices.push(i);\n        }\n    });\n    return sourceIndices;\n};\n\nexports.adjustPathsOfCssResources = function (baseUrl, cssRules) {\n    var backgroundRules = findBackgroundImageRules(cssRules),\n        backgroundDeclarations = findBackgroundDeclarations(backgroundRules),\n        change = false;\n\n    backgroundDeclarations.forEach(function (declaration) {\n        var parsedBackground = backgroundValueParser.parse(declaration.value),\n            externalBackgroundIndices = findExternalBackgroundUrls(parsedBackground),\n            backgroundValue;\n\n        if (externalBackgroundIndices.length > 0) {\n            externalBackgroundIndices.forEach(function (backgroundLayerIndex) {\n                var relativeUrl = parsedBackground[backgroundLayerIndex].url,\n                    url = util.joinUrl(baseUrl, relativeUrl);\n                parsedBackground[backgroundLayerIndex].url = url;\n            });\n\n            backgroundValue = backgroundValueParser.serialize(parsedBackground);\n\n            updateCssPropertyValue(declaration.rule, declaration.property, backgroundValue);\n\n            change = true;\n        }\n    });\n    findFontFaceRules(cssRules).forEach(function (rule) {\n        var fontFaceSrcDeclaration = rule.style.getPropertyValue(\"src\"),\n            parsedFontFaceSources, externalFontFaceUrlIndices;\n\n        try {\n            parsedFontFaceSources = fontFaceSrcValueParser.parse(fontFaceSrcDeclaration);\n        } catch (e) {\n            return;\n        }\n        externalFontFaceUrlIndices = findExternalFontFaceUrls(parsedFontFaceSources);\n\n        if (externalFontFaceUrlIndices.length > 0) {\n            externalFontFaceUrlIndices.forEach(function (fontFaceUrlIndex) {\n                var relativeUrl = parsedFontFaceSources[fontFaceUrlIndex].url,\n                    url = util.joinUrl(baseUrl, relativeUrl);\n\n                parsedFontFaceSources[fontFaceUrlIndex].url = url;\n            });\n\n            cssSupport.changeFontFaceRuleSrc(cssRules, rule, fontFaceSrcValueParser.serialize(parsedFontFaceSources));\n\n            change = true;\n        }\n    });\n    findCSSImportRules(cssRules).forEach(function (rule) {\n        var cssUrl = rule.href,\n            url = util.joinUrl(baseUrl, cssUrl);\n\n        cssSupport.exchangeRule(cssRules, rule, \"@import url(\" + url + \");\");\n\n        change = true;\n    });\n\n    return change;\n};\n\n/* CSS import inlining */\n\nvar substituteRule = function (cssRules, rule, newCssRules) {\n    var position = cssRules.indexOf(rule);\n\n    cssRules.splice(position, 1);\n\n    newCssRules.forEach(function (newRule, i) {\n        cssRules.splice(position + i, 0, newRule);\n    });\n};\n\nvar fulfilledPromise = function (value) {\n    var defer = ayepromise.defer();\n    defer.resolve(value);\n    return defer.promise;\n};\n\nvar loadAndInlineCSSImport = function (cssRules, rule, alreadyLoadedCssUrls, options) {\n    var url = rule.href,\n        cssHrefRelativeToDoc;\n\n    url = cssSupport.unquoteString(url);\n\n    cssHrefRelativeToDoc = util.joinUrl(options.baseUrl, url);\n\n    if (alreadyLoadedCssUrls.indexOf(cssHrefRelativeToDoc) >= 0) {\n        // Remove URL by adding empty string\n        substituteRule(cssRules, rule, []);\n        return fulfilledPromise([]);\n    } else {\n        alreadyLoadedCssUrls.push(cssHrefRelativeToDoc);\n    }\n\n    return util.ajax(url, options)\n        .then(function (cssText) {\n            var externalCssRules = cssSupport.rulesForCssText(cssText);\n\n            // Recursively follow @import statements\n            return exports.loadCSSImportsForRules(externalCssRules, alreadyLoadedCssUrls, options)\n                .then(function (result) {\n                    exports.adjustPathsOfCssResources(url, externalCssRules);\n\n                    substituteRule(cssRules, rule, externalCssRules);\n\n                    return result.errors;\n                });\n        }, function (e) {\n            throw {\n                resourceType: \"stylesheet\",\n                url: e.url,\n                msg: \"Unable to load stylesheet \" + e.url\n            };\n        });\n};\n\nexports.loadCSSImportsForRules = function (cssRules, alreadyLoadedCssUrls, options) {\n    var rulesToInline = findCSSImportRules(cssRules),\n        errors = [],\n        hasChanges = false;\n\n    return util.all(rulesToInline.map(function (rule) {\n        return loadAndInlineCSSImport(cssRules, rule, alreadyLoadedCssUrls, options).then(function (moreErrors) {\n            errors = errors.concat(moreErrors);\n\n            hasChanges = true;\n        }, function (e) {\n            errors.push(e);\n        });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\n/* CSS linked resource inlining */\n\nvar loadAndInlineBackgroundImages = function (backgroundValue, options) {\n    var parsedBackground = backgroundValueParser.parse(backgroundValue),\n        externalBackgroundLayerIndices = findExternalBackgroundUrls(parsedBackground),\n        hasChanges = false;\n\n    return util.collectAndReportErrors(externalBackgroundLayerIndices.map(function (backgroundLayerIndex) {\n        var url = parsedBackground[backgroundLayerIndex].url;\n\n        return util.getDataURIForImageURL(url, options)\n            .then(function (dataURI) {\n                parsedBackground[backgroundLayerIndex].url = dataURI;\n\n                hasChanges = true;\n            }, function (e) {\n                throw {\n                    resourceType: \"backgroundImage\",\n                    url: e.url,\n                    msg: \"Unable to load background-image \" + e.url\n                };\n            });\n    })).then(function (errors) {\n        return {\n            backgroundValue: backgroundValueParser.serialize(parsedBackground),\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar iterateOverRulesAndInlineBackgroundImages = function (cssRules, options) {\n    var rulesToInline = findBackgroundImageRules(cssRules),\n        backgroundDeclarations = findBackgroundDeclarations(rulesToInline),\n        errors = [],\n        cssHasChanges = false;\n\n    return util.all(backgroundDeclarations.map(function (declaration) {\n        return loadAndInlineBackgroundImages(declaration.value, options)\n            .then(function (result) {\n                if (result.hasChanges) {\n                    updateCssPropertyValue(declaration.rule, declaration.property, result.backgroundValue);\n\n                    cssHasChanges = true;\n                }\n\n                errors = errors.concat(result.errors);\n            });\n    })).then(function () {\n        return {\n            hasChanges: cssHasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar loadAndInlineFontFace = function (srcDeclarationValue, options) {\n    var hasChanges = false,\n        parsedFontFaceSources, externalFontFaceUrlIndices;\n\n    try {\n        parsedFontFaceSources = fontFaceSrcValueParser.parse(srcDeclarationValue);\n    } catch (e) {\n        parsedFontFaceSources = [];\n    }\n    externalFontFaceUrlIndices = findExternalFontFaceUrls(parsedFontFaceSources);\n\n    return util.collectAndReportErrors(externalFontFaceUrlIndices.map(function (urlIndex) {\n        var fontSrc = parsedFontFaceSources[urlIndex],\n            format = fontSrc.format || \"woff\";\n\n        return util.binaryAjax(fontSrc.url, options)\n            .then(function (content) {\n                var base64Content = btoa(content);\n                fontSrc.url = 'data:font/' + format + ';base64,' + base64Content;\n\n                hasChanges = true;\n            }, function (e) {\n                throw {\n                    resourceType: \"fontFace\",\n                    url: e.url,\n                    msg: \"Unable to load font-face \" + e.url\n                };\n            });\n    })).then(function (errors) {\n        return {\n            srcDeclarationValue: fontFaceSrcValueParser.serialize(parsedFontFaceSources),\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nvar iterateOverRulesAndInlineFontFace = function (cssRules, options) {\n    var rulesToInline = findFontFaceRules(cssRules),\n        errors = [],\n        hasChanges = false;\n\n    return util.all(rulesToInline.map(function (rule) {\n        var srcDeclarationValue = rule.style.getPropertyValue(\"src\");\n\n        return loadAndInlineFontFace(srcDeclarationValue, options).then(function (result) {\n            if (result.hasChanges) {\n                cssSupport.changeFontFaceRuleSrc(cssRules, rule, result.srcDeclarationValue);\n\n                hasChanges = true;\n            }\n\n            errors = errors.concat(result.errors);\n        });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n\nexports.loadAndInlineCSSResourcesForRules = function (cssRules, options) {\n    var hasChanges = false,\n        errors = [];\n\n    return util.all([iterateOverRulesAndInlineBackgroundImages, iterateOverRulesAndInlineFontFace].map(function (func) {\n        return func(cssRules, options)\n            .then(function (result) {\n                hasChanges = hasChanges || result.hasChanges;\n                errors = errors.concat(result.errors);\n            });\n    })).then(function () {\n        return {\n            hasChanges: hasChanges,\n            errors: errors\n        };\n    });\n};\n","\"use strict\";\n\nvar cssom = require('cssom');\n\n\nexports.unquoteString = function (quotedUrl) {\n    var doubleQuoteRegex = /^\"(.*)\"$/,\n        singleQuoteRegex = /^'(.*)'$/;\n\n    if (doubleQuoteRegex.test(quotedUrl)) {\n        return quotedUrl.replace(doubleQuoteRegex, \"$1\");\n    } else {\n        if (singleQuoteRegex.test(quotedUrl)) {\n            return quotedUrl.replace(singleQuoteRegex, \"$1\");\n        } else {\n            return quotedUrl;\n        }\n    }\n};\n\nvar rulesForCssTextFromBrowser = function (styleContent) {\n    var doc = document.implementation.createHTMLDocument(\"\"),\n        styleElement = document.createElement(\"style\"),\n        rules;\n\n    styleElement.textContent = styleContent;\n    // the style will only be parsed once it is added to a document\n    doc.body.appendChild(styleElement);\n    rules = styleElement.sheet.cssRules;\n\n    return Array.prototype.slice.call(rules);\n};\n\nvar browserHasBackgroundImageUrlIssue = (function () {\n    // Checks for http://code.google.com/p/chromium/issues/detail?id=161644\n    var rules = rulesForCssTextFromBrowser('a{background:url(i)}');\n    return !rules.length || rules[0].cssText.indexOf('url()') >= 0;\n}());\n\nexports.rulesForCssText = function (styleContent) {\n    if (browserHasBackgroundImageUrlIssue && cssom.parse) {\n        return cssom.parse(styleContent).cssRules;\n    } else {\n        return rulesForCssTextFromBrowser(styleContent);\n    }\n};\n\nexports.cssRulesToText = function (cssRules) {\n    return cssRules.reduce(function (cssText, rule) {\n        return cssText + rule.cssText;\n    }, '');\n};\n\nexports.exchangeRule = function (cssRules, rule, newRuleText) {\n    var ruleIdx = cssRules.indexOf(rule),\n        styleSheet = rule.parentStyleSheet;\n\n    // Generate a new rule\n    styleSheet.insertRule(newRuleText, ruleIdx+1);\n    styleSheet.deleteRule(ruleIdx);\n    // Exchange with the new\n    cssRules[ruleIdx] = styleSheet.cssRules[ruleIdx];\n};\n\n// Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=443978\nexports.changeFontFaceRuleSrc = function (cssRules, rule, newSrc) {\n    var newRuleText = '@font-face { font-family: ' + rule.style.getPropertyValue(\"font-family\") + '; ';\n\n    if (rule.style.getPropertyValue(\"font-style\")) {\n        newRuleText += 'font-style: ' + rule.style.getPropertyValue(\"font-style\") + '; ';\n    }\n\n    if (rule.style.getPropertyValue(\"font-weight\")) {\n        newRuleText += 'font-weight: ' + rule.style.getPropertyValue(\"font-weight\") + '; ';\n    }\n\n    newRuleText += 'src: ' + newSrc + '}';\n    exports.exchangeRule(cssRules, rule, newRuleText);\n};\n","// Simple, stupid \"background\"/\"background-image\" value parser that just aims at exposing the image URLs\n\"use strict\";\n\nvar cssSupport = require('./cssSupport');\n\n\nvar trimCSSWhitespace = function (url) {\n    var whitespaceRegex = /^[\\t\\r\\f\\n ]*(.+?)[\\t\\r\\f\\n ]*$/;\n\n    return url.replace(whitespaceRegex, \"$1\");\n};\n\n// TODO exporting this for the sake of unit testing. Should rather test the background value parser explicitly.\nexports.extractCssUrl = function (cssUrl) {\n    var urlRegex = /^url\\(([^\\)]+)\\)/,\n        quotedUrl;\n\n    if (!urlRegex.test(cssUrl)) {\n        throw new Error(\"Invalid url\");\n    }\n\n    quotedUrl = urlRegex.exec(cssUrl)[1];\n    return cssSupport.unquoteString(trimCSSWhitespace(quotedUrl));\n};\n\nvar sliceBackgroundDeclaration = function (backgroundDeclarationText) {\n    var functionParamRegexS = \"\\\\s*(?:\\\"[^\\\"]*\\\"|'[^']*'|[^\\\\(]+)\\\\s*\",\n        valueRegexS = \"(\" + \"url\\\\(\" + functionParamRegexS + \"\\\\)\" + \"|\" + \"[^,\\\\s]+\" + \")\",\n        simpleSingularBackgroundRegexS = \"(?:\\\\s*\" + valueRegexS + \")+\",\n        simpleBackgroundRegexS = \"^\\\\s*(\" + simpleSingularBackgroundRegexS + \")\" +\n                                  \"(?:\\\\s*,\\\\s*(\" + simpleSingularBackgroundRegexS + \"))*\" +\n                                  \"\\\\s*$\",\n        simpleSingularBackgroundRegex = new RegExp(simpleSingularBackgroundRegexS, \"g\"),\n        outerRepeatedMatch,\n        backgroundLayers = [],\n        getValues = function (singularBackgroundDeclaration) {\n            var valueRegex = new RegExp(valueRegexS, \"g\"),\n                backgroundValues = [],\n                repeatedMatch;\n\n            repeatedMatch = valueRegex.exec(singularBackgroundDeclaration);\n            while (repeatedMatch) {\n                backgroundValues.push(repeatedMatch[1]);\n                repeatedMatch = valueRegex.exec(singularBackgroundDeclaration);\n            }\n            return backgroundValues;\n        };\n\n    if (backgroundDeclarationText.match(new RegExp(simpleBackgroundRegexS))) {\n        outerRepeatedMatch = simpleSingularBackgroundRegex.exec(backgroundDeclarationText);\n        while (outerRepeatedMatch) {\n            backgroundLayers.push(getValues(outerRepeatedMatch[0]));\n            outerRepeatedMatch = simpleSingularBackgroundRegex.exec(backgroundDeclarationText);\n        }\n\n        return backgroundLayers;\n    }\n    return [];\n};\n\nvar findBackgroundImageUrlInValues = function (values) {\n    var i, url;\n\n    for(i = 0; i < values.length; i++) {\n        try {\n            url = exports.extractCssUrl(values[i]);\n            return {\n                url: url,\n                idx: i\n            };\n        } catch (e) {}\n    }\n};\n\nexports.parse = function (backgroundValue) {\n    var backgroundLayers = sliceBackgroundDeclaration(backgroundValue);\n\n    return backgroundLayers.map(function (backgroundLayerValues) {\n        var urlMatch = findBackgroundImageUrlInValues(backgroundLayerValues);\n\n        if (urlMatch) {\n            return {\n                preUrl: backgroundLayerValues.slice(0, urlMatch.idx),\n                url: urlMatch.url,\n                postUrl: backgroundLayerValues.slice(urlMatch.idx+1),\n            };\n        } else {\n            return {\n                preUrl: backgroundLayerValues\n            };\n        }\n    });\n};\n\nexports.serialize = function (parsedBackground) {\n    var backgroundLayers = parsedBackground.map(function (backgroundLayer) {\n        var values = [].concat(backgroundLayer.preUrl);\n\n        if (backgroundLayer.url) {\n            values.push('url(\"' + backgroundLayer.url + '\")');\n        }\n        if (backgroundLayer.postUrl) {\n            values = values.concat(backgroundLayer.postUrl);\n        }\n\n        return values.join(' ');\n    });\n\n    return backgroundLayers.join(', ');\n};\n","var grammar = require('./grammar');\n\n\nexports.SyntaxError = function (message, offset) {\n    this.message  = message;\n    this.offset   = offset;\n};\n\nexports.parse = function (fontFaceSourceValue) {\n    try {\n        return grammar.parse(fontFaceSourceValue);\n    } catch (e) {\n        throw new exports.SyntaxError(e.message, e.offset);\n    }\n};\n\nexports.serialize = function (parsedFontFaceSources) {\n    return parsedFontFaceSources.map(function (sourceItem) {\n        var itemValue;\n\n        if (sourceItem.url) {\n            itemValue = 'url(\"' + sourceItem.url + '\")';\n            if (sourceItem.format) {\n                itemValue += ' format(\"' + sourceItem.format + '\")';\n            }\n        } else {\n            itemValue = 'local(\"' + sourceItem.local + '\")';\n        }\n        return itemValue;\n    }).join(', ');\n};\n","'use strict';\n\nexports.CSSStyleDeclaration = require('./CSSStyleDeclaration').CSSStyleDeclaration;\nexports.CSSRule = require('./CSSRule').CSSRule;\nexports.CSSStyleRule = require('./CSSStyleRule').CSSStyleRule;\nexports.MediaList = require('./MediaList').MediaList;\nexports.CSSMediaRule = require('./CSSMediaRule').CSSMediaRule;\nexports.CSSImportRule = require('./CSSImportRule').CSSImportRule;\nexports.CSSFontFaceRule = require('./CSSFontFaceRule').CSSFontFaceRule;\nexports.StyleSheet = require('./StyleSheet').StyleSheet;\nexports.CSSStyleSheet = require('./CSSStyleSheet').CSSStyleSheet;\nexports.CSSKeyframesRule = require('./CSSKeyframesRule').CSSKeyframesRule;\nexports.CSSKeyframeRule = require('./CSSKeyframeRule').CSSKeyframeRule;\nexports.MatcherList = require('./MatcherList').MatcherList;\nexports.CSSDocumentRule = require('./CSSDocumentRule').CSSDocumentRule;\nexports.CSSValue = require('./CSSValue').CSSValue;\nexports.CSSValueExpression = require('./CSSValueExpression').CSSValueExpression;\nexports.parse = require('./parse').parse;\nexports.clone = require('./clone').clone;\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration\n */\nCSSOM.CSSStyleDeclaration = function CSSStyleDeclaration(){\n\tthis.length = 0;\n\tthis.parentRule = null;\n\n\t// NON-STANDARD\n\tthis._importants = {};\n};\n\n\nCSSOM.CSSStyleDeclaration.prototype = {\n\n\tconstructor: CSSOM.CSSStyleDeclaration,\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-getPropertyValue\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set.\n\t */\n\tgetPropertyValue: function(name) {\n\t\treturn this[name] || \"\";\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @param {string} value\n\t * @param {string} [priority=null] \"important\" or null\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-setProperty\n\t */\n\tsetProperty: function(name, value, priority) {\n\t\tif (this[name]) {\n\t\t\t// Property already exist. Overwrite it.\n\t\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\t\tif (index < 0) {\n\t\t\t\tthis[this.length] = name;\n\t\t\t\tthis.length++;\n\t\t\t}\n\t\t} else {\n\t\t\t// New property.\n\t\t\tthis[this.length] = name;\n\t\t\tthis.length++;\n\t\t}\n\t\tthis[name] = value;\n\t\tthis._importants[name] = priority;\n\t},\n\n\t/**\n\t *\n\t * @param {string} name\n\t * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleDeclaration-removeProperty\n\t * @return {string} the value of the property if it has been explicitly set for this declaration block.\n\t * Returns the empty string if the property has not been set or the property name does not correspond to a known CSS property.\n\t */\n\tremoveProperty: function(name) {\n\t\tif (!(name in this)) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar index = Array.prototype.indexOf.call(this, name);\n\t\tif (index < 0) {\n\t\t\treturn \"\";\n\t\t}\n\t\tvar prevValue = this[name];\n\t\tthis[name] = \"\";\n\n\t\t// That's what WebKit and Opera do\n\t\tArray.prototype.splice.call(this, index, 1);\n\n\t\t// That's what Firefox does\n\t\t//this[index] = \"\"\n\n\t\treturn prevValue;\n\t},\n\n\tgetPropertyCSSValue: function() {\n\t\t//FIXME\n\t},\n\n\t/**\n\t *\n\t * @param {String} name\n\t */\n\tgetPropertyPriority: function(name) {\n\t\treturn this._importants[name] || \"\";\n\t},\n\n\n\t/**\n\t *   element.style.overflow = \"auto\"\n\t *   element.style.getPropertyShorthand(\"overflow-x\")\n\t *   -> \"overflow\"\n\t */\n\tgetPropertyShorthand: function() {\n\t\t//FIXME\n\t},\n\n\tisPropertyImplicit: function() {\n\t\t//FIXME\n\t},\n\n\t// Doesn't work in IE < 9\n\tget cssText(){\n\t\tvar properties = [];\n\t\tfor (var i=0, length=this.length; i < length; ++i) {\n\t\t\tvar name = this[i];\n\t\t\tvar value = this.getPropertyValue(name);\n\t\t\tvar priority = this.getPropertyPriority(name);\n\t\t\tif (priority) {\n\t\t\t\tpriority = \" !\" + priority;\n\t\t\t}\n\t\t\tproperties[i] = name + \": \" + value + priority + \";\";\n\t\t}\n\t\treturn properties.join(\" \");\n\t},\n\n\tset cssText(cssText){\n\t\tvar i, name;\n\t\tfor (i = this.length; i--;) {\n\t\t\tname = this[i];\n\t\t\tthis[name] = \"\";\n\t\t}\n\t\tArray.prototype.splice.call(this, 0, this.length);\n\t\tthis._importants = {};\n\n\t\tvar dummyRule = CSSOM.parse('#bogus{' + cssText + '}').cssRules[0].style;\n\t\tvar length = dummyRule.length;\n\t\tfor (i = 0; i < length; ++i) {\n\t\t\tname = dummyRule[i];\n\t\t\tthis.setProperty(dummyRule[i], dummyRule.getPropertyValue(name), dummyRule.getPropertyPriority(name));\n\t\t}\n\t}\n};\n\n\n//.CommonJS\nexports.CSSStyleDeclaration = CSSOM.CSSStyleDeclaration;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleDeclaration.js\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssstylerule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleRule\n */\nCSSOM.CSSStyleRule = function CSSStyleRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.selectorText = \"\";\n\tthis.style = new CSSOM.CSSStyleDeclaration;\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSStyleRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSStyleRule.prototype.constructor = CSSOM.CSSStyleRule;\nCSSOM.CSSStyleRule.prototype.type = 1;\n\nObject.defineProperty(CSSOM.CSSStyleRule.prototype, \"cssText\", {\n\tget: function() {\n\t\tvar text;\n\t\tif (this.selectorText) {\n\t\t\ttext = this.selectorText + \" {\" + this.style.cssText + \"}\";\n\t\t} else {\n\t\t\ttext = \"\";\n\t\t}\n\t\treturn text;\n\t},\n\tset: function(cssText) {\n\t\tvar rule = CSSOM.CSSStyleRule.parse(cssText);\n\t\tthis.style = rule.style;\n\t\tthis.selectorText = rule.selectorText;\n\t}\n});\n\n\n/**\n * NON-STANDARD\n * lightweight version of parse.js.\n * @param {string} ruleText\n * @return CSSStyleRule\n */\nCSSOM.CSSStyleRule.parse = function(ruleText) {\n\tvar i = 0;\n\tvar state = \"selector\";\n\tvar index;\n\tvar j = i;\n\tvar buffer = \"\";\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true\n\t};\n\n\tvar styleRule = new CSSOM.CSSStyleRule;\n\tvar selector, name, value, priority=\"\";\n\n\tfor (var character; character = ruleText.charAt(i); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\t// Squash 2 or more white-spaces in the row into 1\n\t\t\t\tswitch (ruleText.charAt(i - 1)) {\n\t\t\t\t\tcase \" \":\n\t\t\t\t\tcase \"\\t\":\n\t\t\t\t\tcase \"\\r\":\n\t\t\t\t\tcase \"\\n\":\n\t\t\t\t\tcase \"\\f\":\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbuffer += \" \";\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf('\"', j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow '\" is missing';\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tj = i + 1;\n\t\t\tindex = ruleText.indexOf(\"'\", j) + 1;\n\t\t\tif (!index) {\n\t\t\t\tthrow \"' is missing\";\n\t\t\t}\n\t\t\tbuffer += ruleText.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (ruleText.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = ruleText.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tthrow new SyntaxError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && ruleText.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"name\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tif (state === \"value\") {\n\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\tpriority = \"\";\n\t\t\t\tbuffer = \"\";\n\t\t\t} else if (state === \"name\") {\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tstate = \"selector\";\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\t}\n\t}\n\n\treturn styleRule;\n\n};\n\n\n//.CommonJS\nexports.CSSStyleRule = CSSOM.CSSStyleRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssmediarule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSMediaRule\n */\nCSSOM.CSSMediaRule = function CSSMediaRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.media = new CSSOM.MediaList;\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSMediaRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSMediaRule.prototype.constructor = CSSOM.CSSMediaRule;\nCSSOM.CSSMediaRule.prototype.type = 4;\n//FIXME\n//CSSOM.CSSMediaRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSMediaRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://opensource.apple.com/source/WebCore/WebCore-658.28/css/CSSMediaRule.cpp\nObject.defineProperty(CSSOM.CSSMediaRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n      cssTexts.push(this.cssRules[i].cssText);\n    }\n    return \"@media \" + this.media.mediaText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSMediaRule = CSSOM.CSSMediaRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-medialist-interface\n */\nCSSOM.MediaList = function MediaList(){\n\tthis.length = 0;\n};\n\nCSSOM.MediaList.prototype = {\n\n\tconstructor: CSSOM.MediaList,\n\n\t/**\n\t * @return {string}\n\t */\n\tget mediaText() {\n\t\treturn Array.prototype.join.call(this, \", \");\n\t},\n\n\t/**\n\t * @param {string} value\n\t */\n\tset mediaText(value) {\n\t\tvar values = value.split(\",\");\n\t\tvar length = this.length = values.length;\n\t\tfor (var i=0; i<length; i++) {\n\t\t\tthis[i] = values[i].trim();\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tappendMedium: function(medium) {\n\t\tif (Array.prototype.indexOf.call(this, medium) === -1) {\n\t\t\tthis[this.length] = medium;\n\t\t\tthis.length++;\n\t\t}\n\t},\n\n\t/**\n\t * @param {string} medium\n\t */\n\tdeleteMedium: function(medium) {\n\t\tvar index = Array.prototype.indexOf.call(this, medium);\n\t\tif (index !== -1) {\n\t\t\tArray.prototype.splice.call(this, index, 1);\n\t\t}\n\t}\n\n};\n\n\n//.CommonJS\nexports.MediaList = CSSOM.MediaList;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tMediaList: require(\"./MediaList\").MediaList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#cssimportrule\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSImportRule\n */\nCSSOM.CSSImportRule = function CSSImportRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.href = \"\";\n\tthis.media = new CSSOM.MediaList;\n\tthis.styleSheet = new CSSOM.CSSStyleSheet;\n};\n\nCSSOM.CSSImportRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSImportRule.prototype.constructor = CSSOM.CSSImportRule;\nCSSOM.CSSImportRule.prototype.type = 3;\n\nObject.defineProperty(CSSOM.CSSImportRule.prototype, \"cssText\", {\n  get: function() {\n    var mediaText = this.media.mediaText;\n    return \"@import url(\" + this.href + \")\" + (mediaText ? \" \" + mediaText : \"\") + \";\";\n  },\n  set: function(cssText) {\n    var i = 0;\n\n    /**\n     * @import url(partial.css) screen, handheld;\n     *        ||               |\n     *        after-import     media\n     *         |\n     *         url\n     */\n    var state = '';\n\n    var buffer = '';\n    var index;\n    var mediaText = '';\n    for (var character; character = cssText.charAt(i); i++) {\n\n      switch (character) {\n        case ' ':\n        case '\\t':\n        case '\\r':\n        case '\\n':\n        case '\\f':\n          if (state === 'after-import') {\n            state = 'url';\n          } else {\n            buffer += character;\n          }\n          break;\n\n        case '@':\n          if (!state && cssText.indexOf('@import', i) === i) {\n            state = 'after-import';\n            i += 'import'.length;\n            buffer = '';\n          }\n          break;\n\n        case 'u':\n          if (state === 'url' && cssText.indexOf('url(', i) === i) {\n            index = cssText.indexOf(')', i + 1);\n            if (index === -1) {\n              throw i + ': \")\" not found';\n            }\n            i += 'url('.length;\n            var url = cssText.slice(i, index);\n            if (url[0] === url[url.length - 1]) {\n              if (url[0] === '\"' || url[0] === \"'\") {\n                url = url.slice(1, -1);\n              }\n            }\n            this.href = url;\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case '\"':\n          if (state === 'url') {\n            index = cssText.indexOf('\"', i + 1);\n            if (!index) {\n              throw i + \": '\\\"' not found\";\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case \"'\":\n          if (state === 'url') {\n            index = cssText.indexOf(\"'\", i + 1);\n            if (!index) {\n              throw i + ': \"\\'\" not found';\n            }\n            this.href = cssText.slice(i + 1, index);\n            i = index;\n            state = 'media';\n          }\n          break;\n\n        case ';':\n          if (state === 'media') {\n            if (buffer) {\n              this.media.mediaText = buffer.trim();\n            }\n          }\n          break;\n\n        default:\n          if (state === 'media') {\n            buffer += character;\n          }\n          break;\n      }\n    }\n  }\n});\n\n\n//.CommonJS\nexports.CSSImportRule = CSSOM.CSSImportRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-cssrule-interface\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSRule\n */\nCSSOM.CSSRule = function CSSRule() {\n\tthis.parentRule = null;\n\tthis.parentStyleSheet = null;\n};\n\nCSSOM.CSSRule.STYLE_RULE = 1;\nCSSOM.CSSRule.IMPORT_RULE = 3;\nCSSOM.CSSRule.MEDIA_RULE = 4;\nCSSOM.CSSRule.FONT_FACE_RULE = 5;\nCSSOM.CSSRule.PAGE_RULE = 6;\nCSSOM.CSSRule.WEBKIT_KEYFRAMES_RULE = 8;\nCSSOM.CSSRule.WEBKIT_KEYFRAME_RULE = 9;\n\n// Obsolete in CSSOM http://dev.w3.org/csswg/cssom/\n//CSSOM.CSSRule.UNKNOWN_RULE = 0;\n//CSSOM.CSSRule.CHARSET_RULE = 2;\n\n// Never implemented\n//CSSOM.CSSRule.VARIABLES_RULE = 7;\n\nCSSOM.CSSRule.prototype = {\n\tconstructor: CSSOM.CSSRule\n\t//FIXME\n};\n\n\n//.CommonJS\nexports.CSSRule = CSSOM.CSSRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#css-font-face-rule\n */\nCSSOM.CSSFontFaceRule = function CSSFontFaceRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.style = new CSSOM.CSSStyleDeclaration;\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSFontFaceRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSFontFaceRule.prototype.constructor = CSSOM.CSSFontFaceRule;\nCSSOM.CSSFontFaceRule.prototype.type = 5;\n//FIXME\n//CSSOM.CSSFontFaceRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSFontFaceRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSFontFaceRule.cpp\nObject.defineProperty(CSSOM.CSSFontFaceRule.prototype, \"cssText\", {\n  get: function() {\n    return \"@font-face {\" + this.style.cssText + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSFontFaceRule = CSSOM.CSSFontFaceRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tStyleSheet: require(\"./StyleSheet\").StyleSheet,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet\n */\nCSSOM.CSSStyleSheet = function CSSStyleSheet() {\n\tCSSOM.StyleSheet.call(this);\n\tthis.cssRules = [];\n};\n\n\nCSSOM.CSSStyleSheet.prototype = new CSSOM.StyleSheet;\nCSSOM.CSSStyleSheet.prototype.constructor = CSSOM.CSSStyleSheet;\n\n\n/**\n * Used to insert a new rule into the style sheet. The new rule now becomes part of the cascade.\n *\n *   sheet = new Sheet(\"body {margin: 0}\")\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *   sheet.insertRule(\"img {border: none}\", 0)\n *   -> 0\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *\n * @param {string} rule\n * @param {number} index\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-insertRule\n * @return {number} The index within the style sheet's rule collection of the newly inserted rule.\n */\nCSSOM.CSSStyleSheet.prototype.insertRule = function(rule, index) {\n\tif (index < 0 || index > this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tvar cssRule = CSSOM.parse(rule).cssRules[0];\n\tcssRule.parentStyleSheet = this;\n\tthis.cssRules.splice(index, 0, cssRule);\n\treturn index;\n};\n\n\n/**\n * Used to delete a rule from the style sheet.\n *\n *   sheet = new Sheet(\"img{border:none} body{margin:0}\")\n *   sheet.toString()\n *   -> \"img{border:none;}body{margin:0;}\"\n *   sheet.deleteRule(0)\n *   sheet.toString()\n *   -> \"body{margin:0;}\"\n *\n * @param {number} index within the style sheet's rule list of the rule to remove.\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSStyleSheet-deleteRule\n */\nCSSOM.CSSStyleSheet.prototype.deleteRule = function(index) {\n\tif (index < 0 || index >= this.cssRules.length) {\n\t\tthrow new RangeError(\"INDEX_SIZE_ERR\");\n\t}\n\tthis.cssRules.splice(index, 1);\n};\n\n\n/**\n * NON-STANDARD\n * @return {string} serialize stylesheet\n */\nCSSOM.CSSStyleSheet.prototype.toString = function() {\n\tvar result = \"\";\n\tvar rules = this.cssRules;\n\tfor (var i=0; i<rules.length; i++) {\n\t\tresult += rules[i].cssText + \"\\n\";\n\t}\n\treturn result;\n};\n\n\n//.CommonJS\nexports.CSSStyleSheet = CSSOM.CSSStyleSheet;\nCSSOM.parse = require('./parse').parse; // Cannot be included sooner due to the mutual dependency between parse.js and CSSStyleSheet.js\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframesRule\n */\nCSSOM.CSSKeyframesRule = function CSSKeyframesRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.name = '';\n\tthis.cssRules = [];\n};\n\nCSSOM.CSSKeyframesRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSKeyframesRule.prototype.constructor = CSSOM.CSSKeyframesRule;\nCSSOM.CSSKeyframesRule.prototype.type = 8;\n//FIXME\n//CSSOM.CSSKeyframesRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframesRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframesRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframesRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n      cssTexts.push(\"  \" + this.cssRules[i].cssText);\n    }\n    return \"@\" + (this._vendorPrefix || '') + \"keyframes \" + this.name + \" { \\n\" + cssTexts.join(\"\\n\") + \"\\n}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframesRule = CSSOM.CSSKeyframesRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSRule: require(\"./CSSRule\").CSSRule,\n\tCSSStyleDeclaration: require('./CSSStyleDeclaration').CSSStyleDeclaration\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/css3-animations/#DOM-CSSKeyframeRule\n */\nCSSOM.CSSKeyframeRule = function CSSKeyframeRule() {\n\tCSSOM.CSSRule.call(this);\n\tthis.keyText = '';\n\tthis.style = new CSSOM.CSSStyleDeclaration;\n\tthis.style.parentRule = this;\n};\n\nCSSOM.CSSKeyframeRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSKeyframeRule.prototype.constructor = CSSOM.CSSKeyframeRule;\nCSSOM.CSSKeyframeRule.prototype.type = 9;\n//FIXME\n//CSSOM.CSSKeyframeRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSKeyframeRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\n// http://www.opensource.apple.com/source/WebCore/WebCore-955.66.1/css/WebKitCSSKeyframeRule.cpp\nObject.defineProperty(CSSOM.CSSKeyframeRule.prototype, \"cssText\", {\n  get: function() {\n    return this.keyText + \" {\" + this.style.cssText + \"} \";\n  }\n});\n\n\n//.CommonJS\nexports.CSSKeyframeRule = CSSOM.CSSKeyframeRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n    CSSRule: require(\"./CSSRule\").CSSRule,\n    MatcherList: require(\"./MatcherList\").MatcherList\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.CSSDocumentRule = function CSSDocumentRule() {\n    CSSOM.CSSRule.call(this);\n    this.matcher = new CSSOM.MatcherList;\n    this.cssRules = [];\n};\n\nCSSOM.CSSDocumentRule.prototype = new CSSOM.CSSRule;\nCSSOM.CSSDocumentRule.prototype.constructor = CSSOM.CSSDocumentRule;\nCSSOM.CSSDocumentRule.prototype.type = 10;\n//FIXME\n//CSSOM.CSSDocumentRule.prototype.insertRule = CSSStyleSheet.prototype.insertRule;\n//CSSOM.CSSDocumentRule.prototype.deleteRule = CSSStyleSheet.prototype.deleteRule;\n\nObject.defineProperty(CSSOM.CSSDocumentRule.prototype, \"cssText\", {\n  get: function() {\n    var cssTexts = [];\n    for (var i=0, length=this.cssRules.length; i < length; i++) {\n        cssTexts.push(this.cssRules[i].cssText);\n    }\n    return \"@-moz-document \" + this.matcher.matcherText + \" {\" + cssTexts.join(\"\") + \"}\";\n  }\n});\n\n\n//.CommonJS\nexports.CSSDocumentRule = CSSOM.CSSDocumentRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://dev.w3.org/csswg/cssom/#the-stylesheet-interface\n */\nCSSOM.StyleSheet = function StyleSheet() {\n\tthis.parentStyleSheet = null;\n};\n\n\n//.CommonJS\nexports.StyleSheet = CSSOM.StyleSheet;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n *\n * TODO: add if needed\n */\nCSSOM.CSSValue = function CSSValue() {\n};\n\nCSSOM.CSSValue.prototype = {\n\tconstructor: CSSOM.CSSValue,\n\n\t// @see: http://www.w3.org/TR/DOM-Level-2-Style/css.html#CSS-CSSValue\n\tset cssText(text) {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Exception('DOMException: property \"cssText\" of \"' + name + '\" is readonly!');\n\t},\n\n\tget cssText() {\n\t\tvar name = this._getConstructorName();\n\n\t\tthrow new Exception('getter \"cssText\" of \"' + name + '\" is not implemented!');\n\t},\n\n\t_getConstructorName: function() {\n\t\tvar s = this.constructor.toString(),\n\t\t\t\tc = s.match(/function\\s([^\\(]+)/),\n\t\t\t\tname = c[1];\n\n\t\treturn name;\n\t}\n};\n\n\n//.CommonJS\nexports.CSSValue = CSSOM.CSSValue;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @constructor\n * @see https://developer.mozilla.org/en/CSS/@-moz-document\n */\nCSSOM.MatcherList = function MatcherList(){\n    this.length = 0;\n};\n\nCSSOM.MatcherList.prototype = {\n\n    constructor: CSSOM.MatcherList,\n\n    /**\n     * @return {string}\n     */\n    get matcherText() {\n        return Array.prototype.join.call(this, \", \");\n    },\n\n    /**\n     * @param {string} value\n     */\n    set matcherText(value) {\n        // just a temporary solution, actually it may be wrong by just split the value with ',', because a url can include ','.\n        var values = value.split(\",\");\n        var length = this.length = values.length;\n        for (var i=0; i<length; i++) {\n            this[i] = values[i].trim();\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    appendMatcher: function(matcher) {\n        if (Array.prototype.indexOf.call(this, matcher) === -1) {\n            this[this.length] = matcher;\n            this.length++;\n        }\n    },\n\n    /**\n     * @param {string} matcher\n     */\n    deleteMatcher: function(matcher) {\n        var index = Array.prototype.indexOf.call(this, matcher);\n        if (index !== -1) {\n            Array.prototype.splice.call(this, index, 1);\n        }\n    }\n\n};\n\n\n//.CommonJS\nexports.MatcherList = CSSOM.MatcherList;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSValue: require('./CSSValue').CSSValue\n};\n///CommonJS\n\n\n/**\n * @constructor\n * @see http://msdn.microsoft.com/en-us/library/ms537634(v=vs.85).aspx\n *\n */\nCSSOM.CSSValueExpression = function CSSValueExpression(token, idx) {\n\tthis._token = token;\n\tthis._idx = idx;\n};\n\nCSSOM.CSSValueExpression.prototype = new CSSOM.CSSValue;\nCSSOM.CSSValueExpression.prototype.constructor = CSSOM.CSSValueExpression;\n\n/**\n * parse css expression() value\n *\n * @return {Object}\n *\t\t\t\t - error:\n *\t\t\t\t or\n *\t\t\t\t - idx:\n *\t\t\t\t - expression:\n *\n * Example:\n *\n * .selector {\n *\t\tzoom: expression(documentElement.clientWidth > 1000 ? '1000px' : 'auto');\n * }\n */\nCSSOM.CSSValueExpression.prototype.parse = function() {\n\tvar token = this._token,\n\t\t\tidx = this._idx;\n\n\tvar character = '',\n\t\t\texpression = '',\n\t\t\terror = '',\n\t\t\tinfo,\n\t\t\tparen = [];\n\n\n\tfor (; ; ++idx) {\n\t\tcharacter = token.charAt(idx);\n\n\t\t// end of token\n\t\tif (character == '') {\n\t\t\terror = 'css expression error: unfinished expression!';\n\t\t\tbreak;\n\t\t}\n\n\t\tswitch(character) {\n\t\t\tcase '(':\n\t\t\t\tparen.push(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase ')':\n\t\t\t\tparen.pop(character);\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\n\t\t\tcase '/':\n\t\t\t\tif (info = this._parseJSComment(token, idx)) { // comment?\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\terror = 'css expression error: unfinished comment in expression!';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tidx = info.idx;\n\t\t\t\t\t\t// ignore the comment\n\t\t\t\t\t}\n\t\t\t\t} else if (info = this._parseJSRexExp(token, idx)) { // regexp\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else { // other\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"'\":\n\t\t\tcase '\"':\n\t\t\t\tinfo = this._parseJSString(token, idx, character);\n\t\t\t\tif (info) { // string\n\t\t\t\t\tidx = info.idx;\n\t\t\t\t\texpression += info.text;\n\t\t\t\t} else {\n\t\t\t\t\texpression += character;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\texpression += character;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (error) {\n\t\t\tbreak;\n\t\t}\n\n\t\t// end of expression\n\t\tif (paren.length == 0) {\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tvar ret;\n\tif (error) {\n\t\tret = {\n\t\t\terror: error\n\t\t}\n\t} else {\n\t\tret = {\n\t\t\tidx: idx,\n\t\t\texpression: expression\n\t\t}\n\t}\n\n\treturn ret;\n};\n\n\n/**\n *\n * @return {Object|false}\n *          - idx:\n *          - text:\n *          or\n *          - error:\n *          or\n *          false\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSComment = function(token, idx) {\n\tvar nextChar = token.charAt(idx + 1),\n\t\t\ttext;\n\n\tif (nextChar == '/' || nextChar == '*') {\n\t\tvar startIdx = idx,\n\t\t\t\tendIdx,\n\t\t\t\tcommentEndChar;\n\n\t\tif (nextChar == '/') { // line comment\n\t\t\tcommentEndChar = '\\n';\n\t\t} else if (nextChar == '*') { // block comment\n\t\t\tcommentEndChar = '*/';\n\t\t}\n\n\t\tendIdx = token.indexOf(commentEndChar, startIdx + 1 + 1);\n\t\tif (endIdx !== -1) {\n\t\t\tendIdx = endIdx + commentEndChar.length - 1;\n\t\t\ttext = token.substring(idx, endIdx + 1);\n\t\t\treturn {\n\t\t\t\tidx: endIdx,\n\t\t\t\ttext: text\n\t\t\t}\n\t\t} else {\n\t\t\terror = 'css expression error: unfinished comment in expression!';\n\t\t\treturn {\n\t\t\t\terror: error\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn false;\n\t}\n};\n\n\n/**\n *\n * @return {Object|false}\n *\t\t\t\t\t- idx:\n *\t\t\t\t\t- text:\n *\t\t\t\t\tor \n *\t\t\t\t\tfalse\n *\n */\nCSSOM.CSSValueExpression.prototype._parseJSString = function(token, idx, sep) {\n\tvar endIdx = this._findMatchedIdx(token, idx, sep),\n\t\t\ttext;\n\n\tif (endIdx === -1) {\n\t\treturn false;\n\t} else {\n\t\ttext = token.substring(idx, endIdx + sep.length);\n\n\t\treturn {\n\t\t\tidx: endIdx,\n\t\t\ttext: text\n\t\t}\n\t}\n};\n\n\n/**\n * parse regexp in css expression\n *\n * @return {Object|false}\n *\t\t\t\t - idx:\n *\t\t\t\t - regExp:\n *\t\t\t\t or \n *\t\t\t\t false\n */\n\n/*\n\nall legal RegExp\n \n/a/\n(/a/)\n[/a/]\n[12, /a/]\n\n!/a/\n\n+/a/\n-/a/\n* /a/\n/ /a/\n%/a/\n\n===/a/\n!==/a/\n==/a/\n!=/a/\n>/a/\n>=/a/\n</a/\n<=/a/\n\n&/a/\n|/a/\n^/a/\n~/a/\n<</a/\n>>/a/\n>>>/a/\n\n&&/a/\n||/a/\n?/a/\n=/a/\n,/a/\n\n\t\tdelete /a/\n\t\t\t\tin /a/\ninstanceof /a/\n\t\t\t new /a/\n\t\ttypeof /a/\n\t\t\tvoid /a/\n\n*/\nCSSOM.CSSValueExpression.prototype._parseJSRexExp = function(token, idx) {\n\tvar before = token.substring(0, idx).replace(/\\s+$/, \"\"),\n\t\t\tlegalRegx = [\n\t\t\t\t/^$/,\n\t\t\t\t/\\($/,\n\t\t\t\t/\\[$/,\n\t\t\t\t/\\!$/,\n\t\t\t\t/\\+$/,\n\t\t\t\t/\\-$/,\n\t\t\t\t/\\*$/,\n\t\t\t\t/\\/\\s+/,\n\t\t\t\t/\\%$/,\n\t\t\t\t/\\=$/,\n\t\t\t\t/\\>$/,\n\t\t\t\t/\\<$/,\n\t\t\t\t/\\&$/,\n\t\t\t\t/\\|$/,\n\t\t\t\t/\\^$/,\n\t\t\t\t/\\~$/,\n\t\t\t\t/\\?$/,\n\t\t\t\t/\\,$/,\n\t\t\t\t/delete$/,\n\t\t\t\t/in$/,\n\t\t\t\t/instanceof$/,\n\t\t\t\t/new$/,\n\t\t\t\t/typeof$/,\n\t\t\t\t/void$/,\n\t\t\t];\n\n\tvar isLegal = legalRegx.some(function(reg) {\n\t\treturn reg.test(before);\n\t});\n\n\tif (!isLegal) {\n\t\treturn false;\n\t} else {\n\t\tvar sep = '/';\n\n\t\t// same logic as string\n\t\treturn this._parseJSString(token, idx, sep);\n\t}\n};\n\n\n/**\n *\n * find next sep(same line) index in `token`\n *\n * @return {Number}\n *\n */\nCSSOM.CSSValueExpression.prototype._findMatchedIdx = function(token, idx, sep) {\n\tvar startIdx = idx,\n\t\t\tendIdx;\n\n\tvar NOT_FOUND = -1;\n\n\twhile(true) {\n\t\tendIdx = token.indexOf(sep, startIdx + 1);\n\n\t\tif (endIdx === -1) { // not found\n\t\t\tendIdx = NOT_FOUND;\n\t\t\tbreak;\n\t\t} else {\n\t\t\tvar text = token.substring(idx + 1, endIdx),\n\t\t\t\t\tmatched = text.match(/\\\\+$/);\n\t\t\tif (!matched || matched[0] % 2 == 0) { // not escaped\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tstartIdx = endIdx;\n\t\t\t}\n\t\t}\n\t}\n\n\t// boundary must be in the same line(js sting or regexp)\n\tvar nextNewLineIdx = token.indexOf('\\n', idx + 1);\n\tif (nextNewLineIdx < endIdx) {\n\t\tendIdx = NOT_FOUND;\n\t}\n\n\n\treturn endIdx;\n}\n\n\n\n\n//.CommonJS\nexports.CSSValueExpression = CSSOM.CSSValueExpression;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {};\n///CommonJS\n\n\n/**\n * @param {string} token\n */\nCSSOM.parse = function parse(token) {\n\n\tvar i = 0;\n\n\t/**\n\t\t\"before-selector\" or\n\t\t\"selector\" or\n\t\t\"atRule\" or\n\t\t\"atBlock\" or\n\t\t\"before-name\" or\n\t\t\"name\" or\n\t\t\"before-value\" or\n\t\t\"value\"\n\t*/\n\tvar state = \"before-selector\";\n\n\tvar index;\n\tvar buffer = \"\";\n\n\tvar SIGNIFICANT_WHITESPACE = {\n\t\t\"selector\": true,\n\t\t\"value\": true,\n\t\t\"atRule\": true,\n\t\t\"importRule-begin\": true,\n\t\t\"importRule\": true,\n\t\t\"atBlock\": true,\n\t\t'documentRule-begin': true\n\t};\n\n\tvar styleSheet = new CSSOM.CSSStyleSheet;\n\n\t// @type CSSStyleSheet|CSSMediaRule|CSSFontFaceRule|CSSKeyframesRule|CSSDocumentRule\n\tvar currentScope = styleSheet;\n\n\t// @type CSSMediaRule|CSSKeyframesRule|CSSDocumentRule\n\tvar parentRule;\n\n\tvar selector, name, value, priority=\"\", styleRule, mediaRule, importRule, fontFaceRule, keyframesRule, keyframeRule, documentRule;\n\n\tvar atKeyframesRegExp = /@(-(?:\\w+-)+)?keyframes/g;\n\n\tvar parseError = function(message) {\n\t\tvar lines = token.substring(0, i).split('\\n');\n\t\tvar lineCount = lines.length;\n\t\tvar charCount = lines.pop().length + 1;\n\t\tvar error = new Error(message + ' (line ' + lineCount + ', char ' + charCount + ')');\n\t\terror.line = lineCount;\n\t\terror.char = charCount;\n\t\terror.styleSheet = styleSheet;\n\t\tthrow error;\n\t};\n\n\tfor (var character; character = token.charAt(i); i++) {\n\n\t\tswitch (character) {\n\n\t\tcase \" \":\n\t\tcase \"\\t\":\n\t\tcase \"\\r\":\n\t\tcase \"\\n\":\n\t\tcase \"\\f\":\n\t\t\tif (SIGNIFICANT_WHITESPACE[state]) {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// String\n\t\tcase '\"':\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf('\"', index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError('Unmatched \"');\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\')\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"'\":\n\t\t\tindex = i + 1;\n\t\t\tdo {\n\t\t\t\tindex = token.indexOf(\"'\", index) + 1;\n\t\t\t\tif (!index) {\n\t\t\t\t\tparseError(\"Unmatched '\");\n\t\t\t\t}\n\t\t\t} while (token[index - 2] === '\\\\')\n\t\t\tbuffer += token.slice(i, index);\n\t\t\ti = index - 1;\n\t\t\tswitch (state) {\n\t\t\t\tcase 'before-value':\n\t\t\t\t\tstate = 'value';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'importRule-begin':\n\t\t\t\t\tstate = 'importRule';\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// Comment\n\t\tcase \"/\":\n\t\t\tif (token.charAt(i + 1) === \"*\") {\n\t\t\t\ti += 2;\n\t\t\t\tindex = token.indexOf(\"*/\", i);\n\t\t\t\tif (index === -1) {\n\t\t\t\t\tparseError(\"Missing */\");\n\t\t\t\t} else {\n\t\t\t\t\ti = index + 1;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tif (state === \"importRule-begin\") {\n\t\t\t\tbuffer += \" \";\n\t\t\t\tstate = \"importRule\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\t// At-rule\n\t\tcase \"@\":\n\t\t\tif (token.indexOf(\"@-moz-document\", i) === i) {\n\t\t\t\tstate = \"documentRule-begin\";\n\t\t\t\tdocumentRule = new CSSOM.CSSDocumentRule;\n\t\t\t\tdocumentRule.__starts = i;\n\t\t\t\ti += \"-moz-document\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@media\", i) === i) {\n\t\t\t\tstate = \"atBlock\";\n\t\t\t\tmediaRule = new CSSOM.CSSMediaRule;\n\t\t\t\tmediaRule.__starts = i;\n\t\t\t\ti += \"media\".length;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@import\", i) === i) {\n\t\t\t\tstate = \"importRule-begin\";\n\t\t\t\ti += \"import\".length;\n\t\t\t\tbuffer += \"@import\";\n\t\t\t\tbreak;\n\t\t\t} else if (token.indexOf(\"@font-face\", i) === i) {\n\t\t\t\tstate = \"fontFaceRule-begin\";\n\t\t\t\ti += \"font-face\".length;\n\t\t\t\tfontFaceRule = new CSSOM.CSSFontFaceRule;\n\t\t\t\tfontFaceRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tbreak;\n\t\t\t} else {\n\t\t\t\tatKeyframesRegExp.lastIndex = i;\n\t\t\t\tvar matchKeyframes = atKeyframesRegExp.exec(token);\n\t\t\t\tif (matchKeyframes && matchKeyframes.index === i) {\n\t\t\t\t\tstate = \"keyframesRule-begin\";\n\t\t\t\t\tkeyframesRule = new CSSOM.CSSKeyframesRule;\n\t\t\t\t\tkeyframesRule.__starts = i;\n\t\t\t\t\tkeyframesRule._vendorPrefix = matchKeyframes[1]; // Will come out as undefined if no prefix was found\n\t\t\t\t\ti += matchKeyframes[0].length - 1;\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tbreak;\n\t\t\t\t} else if (state == \"selector\") {\n\t\t\t\t\tstate = \"atRule\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\n\t\tcase \"{\":\n\t\t\tif (state === \"selector\" || state === \"atRule\") {\n\t\t\t\tstyleRule.selectorText = buffer.trim();\n\t\t\t\tstyleRule.style.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"atBlock\") {\n\t\t\t\tmediaRule.media.mediaText = buffer.trim();\n\t\t\t\tcurrentScope = parentRule = mediaRule;\n\t\t\t\tmediaRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t} else if (state === \"fontFaceRule-begin\") {\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tfontFaceRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tfontFaceRule.parentStyleSheet = styleSheet;\n\t\t\t\tstyleRule = fontFaceRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"keyframesRule-begin\") {\n\t\t\t\tkeyframesRule.name = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tkeyframesRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tkeyframesRule.parentStyleSheet = styleSheet;\n\t\t\t\tcurrentScope = parentRule = keyframesRule;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t} else if (state === \"keyframeRule-begin\") {\n\t\t\t\tstyleRule = new CSSOM.CSSKeyframeRule;\n\t\t\t\tstyleRule.keyText = buffer.trim();\n\t\t\t\tstyleRule.__starts = i;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-name\";\n\t\t\t} else if (state === \"documentRule-begin\") {\n\t\t\t\t// FIXME: what if this '{' is in the url text of the match function?\n\t\t\t\tdocumentRule.matcher.matcherText = buffer.trim();\n\t\t\t\tif (parentRule) {\n\t\t\t\t\tdocumentRule.parentRule = parentRule;\n\t\t\t\t}\n\t\t\t\tcurrentScope = parentRule = documentRule;\n\t\t\t\tdocumentRule.parentStyleSheet = styleSheet;\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-selector\";\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \":\":\n\t\t\tif (state === \"name\") {\n\t\t\t\tname = buffer.trim();\n\t\t\t\tbuffer = \"\";\n\t\t\t\tstate = \"before-value\";\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase '(':\n\t\t\tif (state === 'value') {\n\t\t\t\t// ie css expression mode\n\t\t\t\tif (buffer.trim() == 'expression') {\n\t\t\t\t\tvar info = (new CSSOM.CSSValueExpression(token, i)).parse();\n\n\t\t\t\t\tif (info.error) {\n\t\t\t\t\t\tparseError(info.error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuffer += info.expression;\n\t\t\t\t\t\ti = info.idx;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tindex = token.indexOf(')', i + 1);\n\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\tparseError('Unmatched \"(\"');\n\t\t\t\t\t}\n\t\t\t\t\tbuffer += token.slice(i, index + 1);\n\t\t\t\t\ti = index;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase \"!\":\n\t\t\tif (state === \"value\" && token.indexOf(\"!important\", i) === i) {\n\t\t\t\tpriority = \"important\";\n\t\t\t\ti += \"important\".length;\n\t\t\t} else {\n\t\t\t\tbuffer += character;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \";\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"atRule\":\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule\":\n\t\t\t\t\timportRule = new CSSOM.CSSImportRule;\n\t\t\t\t\timportRule.parentStyleSheet = importRule.styleSheet.parentStyleSheet = styleSheet;\n\t\t\t\t\timportRule.cssText = buffer + character;\n\t\t\t\t\tstyleSheet.cssRules.push(importRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbuffer += character;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase \"}\":\n\t\t\tswitch (state) {\n\t\t\t\tcase \"value\":\n\t\t\t\t\tstyleRule.style.setProperty(name, buffer.trim(), priority);\n\t\t\t\t\tpriority = \"\";\n\t\t\t\tcase \"before-name\":\n\t\t\t\tcase \"name\":\n\t\t\t\t\tstyleRule.__ends = i + 1;\n\t\t\t\t\tif (parentRule) {\n\t\t\t\t\t\tstyleRule.parentRule = parentRule;\n\t\t\t\t\t}\n\t\t\t\t\tstyleRule.parentStyleSheet = styleSheet;\n\t\t\t\t\tcurrentScope.cssRules.push(styleRule);\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tif (currentScope.constructor === CSSOM.CSSKeyframesRule) {\n\t\t\t\t\t\tstate = \"keyframeRule-begin\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"keyframeRule-begin\":\n\t\t\t\tcase \"before-selector\":\n\t\t\t\tcase \"selector\":\n\t\t\t\t\t// End of media/document rule.\n\t\t\t\t\tif (!parentRule) {\n\t\t\t\t\t\tparseError(\"Unexpected }\");\n\t\t\t\t\t}\n\t\t\t\t\tcurrentScope.__ends = i + 1;\n\t\t\t\t\t// Nesting rules aren't supported yet\n\t\t\t\t\tstyleSheet.cssRules.push(currentScope);\n\t\t\t\t\tcurrentScope = styleSheet;\n\t\t\t\t\tparentRule = null;\n\t\t\t\t\tbuffer = \"\";\n\t\t\t\t\tstate = \"before-selector\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tswitch (state) {\n\t\t\t\tcase \"before-selector\":\n\t\t\t\t\tstate = \"selector\";\n\t\t\t\t\tstyleRule = new CSSOM.CSSStyleRule;\n\t\t\t\t\tstyleRule.__starts = i;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-name\":\n\t\t\t\t\tstate = \"name\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"before-value\":\n\t\t\t\t\tstate = \"value\";\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"importRule-begin\":\n\t\t\t\t\tstate = \"importRule\";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbuffer += character;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn styleSheet;\n};\n\n\n//.CommonJS\nexports.parse = CSSOM.parse;\n// The following modules cannot be included sooner due to the mutual dependency with parse.js\nCSSOM.CSSStyleSheet = require(\"./CSSStyleSheet\").CSSStyleSheet;\nCSSOM.CSSStyleRule = require(\"./CSSStyleRule\").CSSStyleRule;\nCSSOM.CSSImportRule = require(\"./CSSImportRule\").CSSImportRule;\nCSSOM.CSSMediaRule = require(\"./CSSMediaRule\").CSSMediaRule;\nCSSOM.CSSFontFaceRule = require(\"./CSSFontFaceRule\").CSSFontFaceRule;\nCSSOM.CSSStyleDeclaration = require('./CSSStyleDeclaration').CSSStyleDeclaration;\nCSSOM.CSSKeyframeRule = require('./CSSKeyframeRule').CSSKeyframeRule;\nCSSOM.CSSKeyframesRule = require('./CSSKeyframesRule').CSSKeyframesRule;\nCSSOM.CSSValueExpression = require('./CSSValueExpression').CSSValueExpression;\nCSSOM.CSSDocumentRule = require('./CSSDocumentRule').CSSDocumentRule;\n///CommonJS\n","//.CommonJS\nvar CSSOM = {\n\tCSSStyleSheet: require(\"./CSSStyleSheet\").CSSStyleSheet,\n\tCSSStyleRule: require(\"./CSSStyleRule\").CSSStyleRule,\n\tCSSMediaRule: require(\"./CSSMediaRule\").CSSMediaRule,\n\tCSSStyleDeclaration: require(\"./CSSStyleDeclaration\").CSSStyleDeclaration,\n\tCSSKeyframeRule: require('./CSSKeyframeRule').CSSKeyframeRule,\n\tCSSKeyframesRule: require('./CSSKeyframesRule').CSSKeyframesRule\n};\n///CommonJS\n\n\n/**\n * Produces a deep copy of stylesheet  the instance variables of stylesheet are copied recursively.\n * @param {CSSStyleSheet|CSSOM.CSSStyleSheet} stylesheet\n * @nosideeffects\n * @return {CSSOM.CSSStyleSheet}\n */\nCSSOM.clone = function clone(stylesheet) {\n\n\tvar cloned = new CSSOM.CSSStyleSheet;\n\n\tvar rules = stylesheet.cssRules;\n\tif (!rules) {\n\t\treturn cloned;\n\t}\n\n\tvar RULE_TYPES = {\n\t\t1: CSSOM.CSSStyleRule,\n\t\t4: CSSOM.CSSMediaRule,\n\t\t//3: CSSOM.CSSImportRule,\n\t\t//5: CSSOM.CSSFontFaceRule,\n\t\t//6: CSSOM.CSSPageRule,\n\t\t8: CSSOM.CSSKeyframesRule,\n\t\t9: CSSOM.CSSKeyframeRule\n\t};\n\n\tfor (var i=0, rulesLength=rules.length; i < rulesLength; i++) {\n\t\tvar rule = rules[i];\n\t\tvar ruleClone = cloned.cssRules[i] = new RULE_TYPES[rule.type];\n\n\t\tvar style = rule.style;\n\t\tif (style) {\n\t\t\tvar styleClone = ruleClone.style = new CSSOM.CSSStyleDeclaration;\n\t\t\tfor (var j=0, styleLength=style.length; j < styleLength; j++) {\n\t\t\t\tvar name = styleClone[j] = style[j];\n\t\t\t\tstyleClone[name] = style[name];\n\t\t\t\tstyleClone._importants[name] = style.getPropertyPriority(name);\n\t\t\t}\n\t\t\tstyleClone.length = style.length;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('keyText')) {\n\t\t\truleClone.keyText = rule.keyText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('selectorText')) {\n\t\t\truleClone.selectorText = rule.selectorText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('mediaText')) {\n\t\t\truleClone.mediaText = rule.mediaText;\n\t\t}\n\n\t\tif (rule.hasOwnProperty('cssRules')) {\n\t\t\truleClone.cssRules = clone(rule).cssRules;\n\t\t}\n\t}\n\n\treturn cloned;\n\n};\n\n//.CommonJS\nexports.clone = CSSOM.clone;\n///CommonJS\n","module.exports = (function() {\n  /*\n   * Generated by PEG.js 0.8.0.\n   *\n   * http://pegjs.majda.cz/\n   */\n\n  function peg$subclass(child, parent) {\n    function ctor() { this.constructor = child; }\n    ctor.prototype = parent.prototype;\n    child.prototype = new ctor();\n  }\n\n  function SyntaxError(message, expected, found, offset, line, column) {\n    this.message  = message;\n    this.expected = expected;\n    this.found    = found;\n    this.offset   = offset;\n    this.line     = line;\n    this.column   = column;\n\n    this.name     = \"SyntaxError\";\n  }\n\n  peg$subclass(SyntaxError, Error);\n\n  function parse(input) {\n    var options = arguments.length > 1 ? arguments[1] : {},\n\n        peg$FAILED = {},\n\n        peg$startRuleFunctions = { start: peg$parsestart },\n        peg$startRuleFunction  = peg$parsestart,\n\n        peg$c0 = [],\n        peg$c1 = function() { return []},\n        peg$c2 = peg$FAILED,\n        peg$c3 = \",\",\n        peg$c4 = { type: \"literal\", value: \",\", description: \"\\\",\\\"\" },\n        peg$c5 = function(x, xs) { return [x].concat(xs); },\n        peg$c6 = function(entry) { return [entry]; },\n        peg$c7 = function(url, format) { return {url: url, format: format}; },\n        peg$c8 = function(url) { return {url: url}; },\n        peg$c9 = \"url(\",\n        peg$c10 = { type: \"literal\", value: \"url(\", description: \"\\\"url(\\\"\" },\n        peg$c11 = \")\",\n        peg$c12 = { type: \"literal\", value: \")\", description: \"\\\")\\\"\" },\n        peg$c13 = function(value) { return value; },\n        peg$c14 = \"format(\",\n        peg$c15 = { type: \"literal\", value: \"format(\", description: \"\\\"format(\\\"\" },\n        peg$c16 = \"local(\",\n        peg$c17 = { type: \"literal\", value: \"local(\", description: \"\\\"local(\\\"\" },\n        peg$c18 = function(value) { return {local: value}; },\n        peg$c19 = /^[^)]/,\n        peg$c20 = { type: \"class\", value: \"[^)]\", description: \"[^)]\" },\n        peg$c21 = function(chars) { return util.extractValue(chars.join(\"\")); },\n        peg$c22 = /^[ \\t\\r\\n\\f]/,\n        peg$c23 = { type: \"class\", value: \"[ \\\\t\\\\r\\\\n\\\\f]\", description: \"[ \\\\t\\\\r\\\\n\\\\f]\" },\n\n        peg$currPos          = 0,\n        peg$reportedPos      = 0,\n        peg$cachedPos        = 0,\n        peg$cachedPosDetails = { line: 1, column: 1, seenCR: false },\n        peg$maxFailPos       = 0,\n        peg$maxFailExpected  = [],\n        peg$silentFails      = 0,\n\n        peg$result;\n\n    if (\"startRule\" in options) {\n      if (!(options.startRule in peg$startRuleFunctions)) {\n        throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n      }\n\n      peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n    }\n\n    function text() {\n      return input.substring(peg$reportedPos, peg$currPos);\n    }\n\n    function offset() {\n      return peg$reportedPos;\n    }\n\n    function line() {\n      return peg$computePosDetails(peg$reportedPos).line;\n    }\n\n    function column() {\n      return peg$computePosDetails(peg$reportedPos).column;\n    }\n\n    function expected(description) {\n      throw peg$buildException(\n        null,\n        [{ type: \"other\", description: description }],\n        peg$reportedPos\n      );\n    }\n\n    function error(message) {\n      throw peg$buildException(message, null, peg$reportedPos);\n    }\n\n    function peg$computePosDetails(pos) {\n      function advance(details, startPos, endPos) {\n        var p, ch;\n\n        for (p = startPos; p < endPos; p++) {\n          ch = input.charAt(p);\n          if (ch === \"\\n\") {\n            if (!details.seenCR) { details.line++; }\n            details.column = 1;\n            details.seenCR = false;\n          } else if (ch === \"\\r\" || ch === \"\\u2028\" || ch === \"\\u2029\") {\n            details.line++;\n            details.column = 1;\n            details.seenCR = true;\n          } else {\n            details.column++;\n            details.seenCR = false;\n          }\n        }\n      }\n\n      if (peg$cachedPos !== pos) {\n        if (peg$cachedPos > pos) {\n          peg$cachedPos = 0;\n          peg$cachedPosDetails = { line: 1, column: 1, seenCR: false };\n        }\n        advance(peg$cachedPosDetails, peg$cachedPos, pos);\n        peg$cachedPos = pos;\n      }\n\n      return peg$cachedPosDetails;\n    }\n\n    function peg$fail(expected) {\n      if (peg$currPos < peg$maxFailPos) { return; }\n\n      if (peg$currPos > peg$maxFailPos) {\n        peg$maxFailPos = peg$currPos;\n        peg$maxFailExpected = [];\n      }\n\n      peg$maxFailExpected.push(expected);\n    }\n\n    function peg$buildException(message, expected, pos) {\n      function cleanupExpected(expected) {\n        var i = 1;\n\n        expected.sort(function(a, b) {\n          if (a.description < b.description) {\n            return -1;\n          } else if (a.description > b.description) {\n            return 1;\n          } else {\n            return 0;\n          }\n        });\n\n        while (i < expected.length) {\n          if (expected[i - 1] === expected[i]) {\n            expected.splice(i, 1);\n          } else {\n            i++;\n          }\n        }\n      }\n\n      function buildMessage(expected, found) {\n        function stringEscape(s) {\n          function hex(ch) { return ch.charCodeAt(0).toString(16).toUpperCase(); }\n\n          return s\n            .replace(/\\\\/g,   '\\\\\\\\')\n            .replace(/\"/g,    '\\\\\"')\n            .replace(/\\x08/g, '\\\\b')\n            .replace(/\\t/g,   '\\\\t')\n            .replace(/\\n/g,   '\\\\n')\n            .replace(/\\f/g,   '\\\\f')\n            .replace(/\\r/g,   '\\\\r')\n            .replace(/[\\x00-\\x07\\x0B\\x0E\\x0F]/g, function(ch) { return '\\\\x0' + hex(ch); })\n            .replace(/[\\x10-\\x1F\\x80-\\xFF]/g,    function(ch) { return '\\\\x'  + hex(ch); })\n            .replace(/[\\u0180-\\u0FFF]/g,         function(ch) { return '\\\\u0' + hex(ch); })\n            .replace(/[\\u1080-\\uFFFF]/g,         function(ch) { return '\\\\u'  + hex(ch); });\n        }\n\n        var expectedDescs = new Array(expected.length),\n            expectedDesc, foundDesc, i;\n\n        for (i = 0; i < expected.length; i++) {\n          expectedDescs[i] = expected[i].description;\n        }\n\n        expectedDesc = expected.length > 1\n          ? expectedDescs.slice(0, -1).join(\", \")\n              + \" or \"\n              + expectedDescs[expected.length - 1]\n          : expectedDescs[0];\n\n        foundDesc = found ? \"\\\"\" + stringEscape(found) + \"\\\"\" : \"end of input\";\n\n        return \"Expected \" + expectedDesc + \" but \" + foundDesc + \" found.\";\n      }\n\n      var posDetails = peg$computePosDetails(pos),\n          found      = pos < input.length ? input.charAt(pos) : null;\n\n      if (expected !== null) {\n        cleanupExpected(expected);\n      }\n\n      return new SyntaxError(\n        message !== null ? message : buildMessage(expected, found),\n        expected,\n        found,\n        pos,\n        posDetails.line,\n        posDetails.column\n      );\n    }\n\n    function peg$parsestart() {\n      var s0, s1;\n\n      s0 = peg$parsesourceEntries();\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = [];\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c1();\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parsesourceEntries() {\n      var s0, s1, s2, s3, s4, s5;\n\n      s0 = peg$currPos;\n      s1 = peg$parsesourceEntry();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewhitespace();\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          s3 = peg$parsewhitespace();\n        }\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 44) {\n            s3 = peg$c3;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c4); }\n          }\n          if (s3 !== peg$FAILED) {\n            s4 = [];\n            s5 = peg$parsewhitespace();\n            while (s5 !== peg$FAILED) {\n              s4.push(s5);\n              s5 = peg$parsewhitespace();\n            }\n            if (s4 !== peg$FAILED) {\n              s5 = peg$parsesourceEntries();\n              if (s5 !== peg$FAILED) {\n                peg$reportedPos = s0;\n                s1 = peg$c5(s1, s5);\n                s0 = s1;\n              } else {\n                peg$currPos = s0;\n                s0 = peg$c2;\n              }\n            } else {\n              peg$currPos = s0;\n              s0 = peg$c2;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = peg$parsesourceEntry();\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c6(s1);\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parsesourceEntry() {\n      var s0;\n\n      s0 = peg$parseurlEntry();\n      if (s0 === peg$FAILED) {\n        s0 = peg$parselocalEntry();\n      }\n\n      return s0;\n    }\n\n    function peg$parseurlEntry() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      s1 = peg$parseurl();\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        s3 = peg$parsewhitespace();\n        if (s3 !== peg$FAILED) {\n          while (s3 !== peg$FAILED) {\n            s2.push(s3);\n            s3 = peg$parsewhitespace();\n          }\n        } else {\n          s2 = peg$c2;\n        }\n        if (s2 !== peg$FAILED) {\n          s3 = peg$parseformat();\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c7(s1, s3);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n      if (s0 === peg$FAILED) {\n        s0 = peg$currPos;\n        s1 = peg$parseurl();\n        if (s1 !== peg$FAILED) {\n          peg$reportedPos = s0;\n          s1 = peg$c8(s1);\n        }\n        s0 = s1;\n      }\n\n      return s0;\n    }\n\n    function peg$parseurl() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 4) === peg$c9) {\n        s1 = peg$c9;\n        peg$currPos += 4;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c10); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c13(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parseformat() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 7) === peg$c14) {\n        s1 = peg$c14;\n        peg$currPos += 7;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c15); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c13(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parselocalEntry() {\n      var s0, s1, s2, s3;\n\n      s0 = peg$currPos;\n      if (input.substr(peg$currPos, 6) === peg$c16) {\n        s1 = peg$c16;\n        peg$currPos += 6;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c17); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parsevalue();\n        if (s2 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 41) {\n            s3 = peg$c11;\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s3 !== peg$FAILED) {\n            peg$reportedPos = s0;\n            s1 = peg$c18(s2);\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$c2;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$c2;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$c2;\n      }\n\n      return s0;\n    }\n\n    function peg$parsevalue() {\n      var s0, s1, s2;\n\n      s0 = peg$currPos;\n      s1 = [];\n      if (peg$c19.test(input.charAt(peg$currPos))) {\n        s2 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c20); }\n      }\n      if (s2 !== peg$FAILED) {\n        while (s2 !== peg$FAILED) {\n          s1.push(s2);\n          if (peg$c19.test(input.charAt(peg$currPos))) {\n            s2 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s2 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c20); }\n          }\n        }\n      } else {\n        s1 = peg$c2;\n      }\n      if (s1 !== peg$FAILED) {\n        peg$reportedPos = s0;\n        s1 = peg$c21(s1);\n      }\n      s0 = s1;\n\n      return s0;\n    }\n\n    function peg$parsewhitespace() {\n      var s0;\n\n      if (peg$c22.test(input.charAt(peg$currPos))) {\n        s0 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s0 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c23); }\n      }\n\n      return s0;\n    }\n\n\n      var util = require('../util');\n\n\n    peg$result = peg$startRuleFunction();\n\n    if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n      return peg$result;\n    } else {\n      if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n        peg$fail({ type: \"end\", description: \"end of input\" });\n      }\n\n      throw peg$buildException(null, peg$maxFailExpected, peg$maxFailPos);\n    }\n  }\n\n  return {\n    SyntaxError: SyntaxError,\n    parse:       parse\n  };\n})();\n","var trimCSSWhitespace = function (value) {\n    var whitespaceRegex = /^[\\t\\r\\f\\n ]*(.+?)[\\t\\r\\f\\n ]*$/;\n\n    return value.replace(whitespaceRegex, \"$1\");\n};\n\nvar unquoteString = function (quotedUrl) {\n    var doubleQuoteRegex = /^\"(.*)\"$/,\n        singleQuoteRegex = /^'(.*)'$/;\n\n    if (doubleQuoteRegex.test(quotedUrl)) {\n        return quotedUrl.replace(doubleQuoteRegex, \"$1\");\n    } else {\n        if (singleQuoteRegex.test(quotedUrl)) {\n            return quotedUrl.replace(singleQuoteRegex, \"$1\");\n        } else {\n            return quotedUrl;\n        }\n    }\n};\n\nexports.extractValue = function (value) {\n    return unquoteString(trimCSSWhitespace(value));\n};\n"]}