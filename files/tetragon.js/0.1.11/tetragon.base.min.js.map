{"version":3,"sources":["tetragon.base.js"],"names":["w","Tetragon","version","window","T","extend","obj","obj2","i","j","arg","args","Array","prototype","slice","call","arguments","length","hasOwnProperty","undefined","loadImages","images","options","handleDone","errorCount","error","loadedImgs","done","waitForLoad","src","key","image","Image","onload","load","loadCount","keys","onerror","fail","Object","AnimationLoop","framerate","this","lastTime","proto","advanceToTime","time","tickFunc","Math","max","reset","Vector","x","y","isPrototypeOf","parseFloat","defineProperty","get","sqrt","a","atan2","PI","floor","add","vec","sub","mult","val","div","normalize","mag","len","dot","rotate","r","c","cos","s","sin","reflect","wall","refraction","out","inc","dec","shl","n","shr","copy","Matrix","values","set","translate","scale","m","invert","det","mat","setContextTransform","ctx","setTransform","Range","location","enumerable","end","contains","value","intersects","range","Rect","p","pos","size","maxPos","center","rectPos","rectMaxPos","rect","QuadTree","Quad","parent","idx","quads","quadFlags","items","addItem","object","item","index","quad","Item","push","quadRect","forEachItemInRect","callback","subquad","remove","toQuad","indexOf","splice","move","document","TRANSFORM_UPDATED","AUTO_CLEAR","Canvas","element","tick","draw","autoClear","origin","getContext","animationLoop","_viewport","_inverseTrans","_flags","matrixStack","width","height","_prepareMatrixStack","transform","matrix","viewport","_updateTransform","_tick","self","Date","getTime","info","deltaTime","dt","frameDelta","_draw","animationFrame","requestAnimationFrame","clear","save","clearRect","restore","startAnimating","stopAnimating","cancelAnimationFrame","redraw","offsetFromEvent","e","elem","getBoundingClientRect","offset","left","top","changedTouches","pageX","pageY","clientX","clientY","worldPositionFromOffset","inverseTransform","offsetFromWorldPosition","pushMatrix","popMatrix","pop"],"mappings":"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","file":"tetragon.base.min.js","sourcesContent":["(function (w) {\n'use strict';\n\nw.Tetragon = w.Tetragon || {\n\tversion: '0.1.11',\n};\n\n}(window));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nT.extend = function (obj, obj2) {\n\tvar i, j;\n\tvar arg;\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tobj = obj || {};\n\n\tfor (i = 0; i < args.length; i ++) {\n\t\tvar arg = args[i] || {};\n\n\t\tfor (j in arg) {\n\t\t\tif (arg.hasOwnProperty(j)) {\n\t\t\t\tif (arg[j] !== null && arg[j] !== undefined) {\n\t\t\t\t\tobj[j] = arg[j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn obj;\n};\n\nT.loadImages = function (images, options) {\n\tvar i;\n\tvar keys;\n\tvar options    = options || {};\n\tvar loadCount  = 0;\n\tvar errorCount = 0;\n\tvar loadedImgs = {};\n\n\tfunction handleDone() {\n\t\tif (errorCount) {\n\t\t\tif (options.error) {\n\t\t\t\toptions.error(loadedImgs);\n\t\t\t}\n\t\t}\n\t\telse if (options.done) {\n\t\t\toptions.done(loadedImgs);\n\t\t}\n\t}\n\n\tfunction waitForLoad(src, key) {\n\t\tvar image = new Image();\n\n\t\timage.onload = function () {\n\t\t\tif (!loadedImgs[key]) {\n\t\t\t\tloadedImgs[key] = image;\n\n\t\t\t\tif (options.load) {\n\t\t\t\t\toptions.load(key, image);\n\t\t\t\t}\n\n\t\t\t\tif (++ loadCount >= keys.length) {\n\t\t\t\t\thandleDone();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timage.onerror = function () {\n\t\t\terrorCount ++;\n\n\t\t\tif (!loadedImgs[key]) {\n\t\t\t\tloadedImgs[key] = undefined;\n\n\t\t\t\tif (options.fail) {\n\t\t\t\t\toptions.fail(key, src);\n\t\t\t\t}\n\n\t\t\t\tif (++ loadCount >= keys.length) {\n\t\t\t\t\thandleDone();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timage.src = src;\n\n\t\treturn image;\n\t}\n\n\toptions = T.extend({\n\t\tdone: null,\n\t\terror: null,\n\t\tload: null,\n\t\tfail: null,\n\t}, options);\n\n\tkeys = Object.keys(images);\n\n\tif (keys.length == 0) {\n\t\tif (options.done) {\n\t\t\toptions.done(loadedImgs);\n\t\t}\n\t}\n\n\tfor (i = 0; i < keys.length; i ++) {\n\t\tvar key = keys[i];\n\t\tvar src = images[key];\n\n\t\t// assuming an image element\n\t\tif (src === Object(src)) {\n\t\t\tsrc = src.src;\n\t\t}\n\n\t\twaitForLoad(src, key);\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Animation loop\n */\nvar AnimationLoop = T.AnimationLoop = function (framerate) {\n\tthis.framerate = framerate;\n\tthis.lastTime  = 0;\n}\n\nvar proto = AnimationLoop.prototype;\n\n/**\n * Advance animation loop to new time\n *\n * `tickFunc` is called every frame\n */\nproto.advanceToTime = function (time, tickFunc) {\n\t// set `lastTime` to previous frame if first frame\n\tif (this.lastTime == 0) {\n\t\tthis.lastTime = time - 1.0 / 60.0;\n\t}\n\n\t// limit previous time if animation was paused or had a greater lag,\n\t// the loop will not try to catch up with a too big time step\n\tthis.lastTime = Math.max(time - 1.0 / 20.0, this.lastTime)\n\n\t// only advance to previous frame\n\ttime -= this.framerate;\n\n\t// advance to new time\n\twhile (this.lastTime < time) {\n\t\ttickFunc(this.framerate);\n\t\tthis.lastTime += this.framerate;\n\t}\n};\n\n/**\n * Reset loop\n */\nproto.reset = function () {\n\tthis.lastTime = 0;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar Vector = T.Vector = function (x, y) {\n\tif (Vector.prototype.isPrototypeOf(x)) {\n\t\tthis.x = x.x;\n\t\tthis.y = x.y;\n\t}\n\telse {\n\t\tthis.x = parseFloat(x) || 0.0;\n\t\tthis.y = parseFloat(y) || 0.0;\n\t}\n};\n\nvar proto = Vector.prototype;\n\nObject.defineProperty(proto, 'length', {\n\tget: function () {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t}\n});\n\nObject.defineProperty(proto, 'lengthSquared', {\n\tget: function () {\n\t\treturn this.x * this.x + this.y * this.y;\n\t}\n});\n\nObject.defineProperty(proto, 'negated', {\n\tget: function () {\n\t\treturn new Vector(-this.x, -this.y);\n\t}\n});\n\nObject.defineProperty(proto, 'rotation', {\n\tget: function () {\n\t\tvar a = Math.atan2(this.y, this.x);\n\t\ta = a < 0 ? a + 2.0 * Math.PI : a;\n\t\treturn a / Math.PI * 180.0;\n\t}\n});\n\nObject.defineProperty(proto, 'integ', {\n\tget: function () {\n\t\treturn new Vector(Math.floor(this.x), Math.floor(this.y));\n\t}\n});\n\nproto.add = function (vec) {\n\treturn new Vector(this.x + vec.x, this.y + vec.y);\n};\n\nproto.sub = function (vec) {\n\treturn new Vector(this.x - vec.x, this.y - vec.y);\n};\n\nproto.mult = function (val) {\n\tif (val === Object(val)) {\n\t\treturn new Vector(this.x * val.x, this.y * val.y);\n\t}\n\telse {\n\t\treturn new Vector(this.x * val, this.y * val);\n\t}\n};\n\nproto.div = function (val) {\n\tif (val === Object(val)) {\n\t\treturn new Vector(this.x / val.x, this.y / val.y);\n\t}\n\telse {\n\t\treturn new Vector(this.x / val, this.y / val);\n\t}\n};\n\nproto.normalize = function (mag) {\n\tif (mag === undefined) {\n\t\tmag = 1.0;\n\t}\n\n\tvar len = this.length;\n\n\tif (len) {\n\t\tlen = mag / len;\n\t}\n\n\treturn new Vector(this.x * len, this.y * len);\n};\n\nproto.dot = function (vec) {\n\treturn this.x * vec.x + this.y * vec.y;\n};\n\nproto.rotate = function (a) {\n\tvar r = a / 180.0 * Math.PI;\n\tvar c = Math.cos(r);\n\tvar s = Math.sin(r);\n\n\treturn new Vector(\n\t\tthis.x * c - this.y * s,\n\t\tthis.x * s + this.y * c\n\t);\n};\n\nproto.reflect = function (wall, refraction) {\n\tvar out;\n\n\trefraction = refraction === undefined ? 1.0 : 0.5 + refraction * 0.5;\n\twall = wall.normalize();\n\tout = this.sub(wall.mult(2.0 * wall.dot(this)).mult(refraction));\n\n\tif (refraction != 2.0) {\n\t\tout = out.normalize(this.length);\n\t}\n\n\treturn out;\n};\n\nproto.inc = function (vec) {\n\tthis.x += vec.x;\n\tthis.y += vec.y;\n};\n\nproto.dec = function (vec) {\n\tthis.x -= vec.x;\n\tthis.y -= vec.y;\n};\n\nproto.shl = function (n) {\n\treturn new Vector(this.x << n, this.y << n);\n};\n\nproto.shr = function (n) {\n\treturn new Vector(this.x >> n, this.y >> n);\n};\n\nproto.copy = function (a) {\n\treturn new Vector(this.x, this.y);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Matrix = T.Matrix = function (values) {\n\tif (values) {\n\t\tthis.set(values);\n\t}\n\telse {\n\t\tthis.set([\n\t\t\t1, 0,\n\t\t\t0, 1,\n\t\t\t0, 0,\n\t\t]);\n\t}\n};\n\nvar proto = Matrix.prototype;\n\nproto.translate = function (vec) {\n\tthis[4] += vec.x * this[0] + vec.y * this[2];\n\tthis[5] += vec.x * this[1] + vec.y * this[3];\n\n\treturn this;\n};\n\nproto.scale = function (vec) {\n\tthis[0] *= vec.x;\n\tthis[2] *= vec.x;\n\tthis[1] *= vec.y;\n\tthis[3] *= vec.y;\n\n\treturn this;\n};\n\nproto.rotate = function (a) {\n\tvar s, c;\n\n\ta = a / 180.0 * Math.PI;\n\ts = Math.sin(a);\n\tc = Math.cos(a);\n\n\tvar m = this.mult(new T.Matrix([\n\t\tc, s,\n\t\t-s, c,\n\t\t0, 0,\n\t]));\n\n\tthis.set(m);\n\n\treturn this;\n};\n\nproto.mult = function (val) {\n\tif (T.Vector.prototype.isPrototypeOf(val)) {\n\t\treturn new T.Vector(\n\t\t\tthis[0] * val.x + this[2] * val.y + this[4],\n\t\t\tthis[1] * val.x + this[3] * val.y + this[5]\n\t\t);\n\t}\n\tif (T.Matrix.prototype.isPrototypeOf(val)) {\n\t\treturn new Matrix([\n\t\t\tthis[0] * val[0] + this[2] * val[1],\n\t\t\tthis[1] * val[0] + this[3] * val[1],\n\t\t\tthis[0] * val[2] + this[2] * val[3],\n\t\t\tthis[1] * val[2] + this[3] * val[3],\n\t\t\tthis[0] * val[4] + this[2] * val[5] + this[4],\n\t\t\tthis[1] * val[4] + this[3] * val[5] + this[5]\n\t\t]);\n\t}\n};\n\nproto.invert = function () {\n\tvar det;\n\tvar mat = new T.Matrix();\n\n\tmat[0] =  this[3];\n\tmat[1] = -this[1];\n\tmat[2] = -this[2];\n\tmat[3] =  this[0];\n\tmat[4] =  this[2] * this[5] - this[3] * this[4];\n\tmat[5] = -this[0] * this[5] + this[1] * this[4];\n\n\tdet = this[0] * mat[0] + this[2] * mat[1];\n\n\tif (det == 0.0) {\n\t\treturn this.copy();\n\t}\n\n\tdet = 1.0 / det;\n\n\tmat[0] *= det;\n\tmat[1] *= det;\n\tmat[2] *= det;\n\tmat[3] *= det;\n\tmat[4] *= det;\n\tmat[5] *= det;\n\n\treturn mat;\n};\n\nproto.copy = function () {\n\treturn new T.Matrix(this);\n};\n\nproto.set = function (mat) {\n\tthis[0] = mat[0];\n\tthis[1] = mat[1];\n\tthis[2] = mat[2];\n\tthis[3] = mat[3];\n\tthis[4] = mat[4];\n\tthis[5] = mat[5];\n\n\treturn this;\n};\n\nproto.setContextTransform = function (ctx) {\n\tctx.setTransform(this[0], this[1], this[2], this[3], this[4], this[5]);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Range = T.Range = function (location, length) {\n\tthis.location = location || 0;\n\tthis.length = length || 0;\n};\n\nvar proto = Range.prototype;\n\nObject.defineProperty(proto, 'end', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.location + this.length;\n\t},\n\tset: function (end) {\n\t\tthis.location = end - this.length;\n\t}\n});\n\nproto.contains = function (value) {\n\tif (T.Range.prototype.isPrototypeOf(val)) {\n\t\treturn value.location >= this.location && value.end <= this.end;\n\t}\n\telse {\n\t\treturn value >= this.location && value < this.end;\n\t}\n};\n\nproto.intersects = function (range) {\n\treturn range.location < this.end && range.end > this.location;\n};\n\nproto.extend = function (val) {\n\tvar end = this.end;\n\n\tif (Range.prototype.isPrototypeOf(val)) {\n\t\tif (val.location < this.location) {\n\t\t\tthis.location = val.location;\n\t\t\tthis.length = end - this.location;\n\t\t}\n\t\telse if (val.end > end) {\n\t\t\tthis.length = val.end - this.location;\n\t\t}\n\t}\n\telse {\n\t\tif (val < this.location) {\n\t\t\tthis.location = val;\n\t\t\tthis.length = end - val;\n\t\t}\n\t\telse if (val > end) {\n\t\t\tthis.length = val - location;\n\t\t}\n\t}\n};\n\nproto.copy = function () {\n\treturn new Range(this.location, this.length);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Rect = T.Rect = function (p, s) {\n\tif (Rect.prototype.isPrototypeOf(p)) {\n\t\tthis.pos  = p.pos.copy();\n\t\tthis.size = p.size.copy();\n\t}\n\telse {\n\t\tthis.pos  = p ? p.copy() : new T.Vector();\n\t\tthis.size = s ? s.copy() : new T.Vector();\n\t}\n};\n\nvar proto = Rect.prototype;\n\nObject.defineProperty(proto, 'maxPos', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.pos.add(this.size);\n\t},\n\tset: function (maxPos) {\n\t\tthis.pos = maxPos.sub(this.size);\n\t}\n});\n\nObject.defineProperty(proto, 'center', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.pos.add(this.size.mult(0.5));\n\t},\n\tset: function (center) {\n\t\tthis.pos = center.sub(this.size.mult(0.5));\n\t}\n});\n\nproto.contains = function (val) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\n\tif (T.Vector.prototype.isPrototypeOf(val)) {\n\t\tif (val.x >= pos.x && val.x < maxPos.x) {\n\t\t\tif (val.y >= pos.y && val.y < maxPos.y) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\telse if (T.Rect.prototype.isPrototypeOf(val)) {\n\t\tvar rectPos = val.pos;\n\t\tvar rectMaxPos = val.maxPos;\n\n\t\tif (rectPos.x >= pos.x && rectMaxPos.x <= maxPos.x) {\n\t\t\tif (rectPos.y >= pos.y && rectMaxPos.y <= maxPos.y) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.intersects = function (rect) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\tvar rectPos = rect.pos;\n\tvar rectMaxPos = rect.maxPos;\n\n\tif (rectMaxPos.x > pos.x && rectPos.x < maxPos.x) {\n\t\tif (rectMaxPos.y > pos.y && rectPos.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.extend = function (val) {\n\tvar maxPos = this.maxPos;\n\n\tif (T.Vector.prototype.isPrototypeOf(val)) {\n\t\tif (val.x < this.pos.x) {\n\t\t\tthis.pos.x = val.x;\n\t\t\tthis.size.x = maxPos.x - val.x;\n\t\t}\n\t\telse if (val.x > maxPos.x) {\n\t\t\tthis.size.x = val.x - this.pos.x;\n\t\t}\n\n\t\tif (val.y < this.pos.y) {\n\t\t\tthis.pos.y = val.y;\n\t\t\tthis.size.y = maxPos.y - val.y;\n\t\t}\n\t\telse if (val.y > maxPos.y) {\n\t\t\tthis.size.y = maxPos.y - this.pos.y;\n\t\t}\n\t}\n\telse if (T.Rect.prototype.isPrototypeOf(val)) {\n\t\tif (val.pos.x < this.pos.x) {\n\t\t\tthis.pos.x = val.pos.x;\n\t\t\tthis.size.x = maxPos.x - val.pos.x;\n\t\t}\n\t\telse if (val.maxPos.x > maxPos.x) {\n\t\t\tthis.size.x = val.maxPos.x - this.pos.x;\n\t\t}\n\n\t\tif (val.pos.y < this.pos.y) {\n\t\t\tthis.pos.y = val.pos.y;\n\t\t\tthis.size.y = maxPos.y - val.pos.y;\n\t\t}\n\t\telse if (val.maxPos.y > maxPos.y) {\n\t\t\tthis.size.y = val.maxPos.y - this.pos.y;\n\t\t}\n\t}\n};\n\nproto.copy = function () {\n\treturn new Rect(this.pos, this.size);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend rect.js\n */\n\n(function (T) {\n'use strict';\n\nvar QuadTree = T.QuadTree = function (rect) {\n\tQuad.call(this, rect);\n};\n\nvar Quad = QuadTree.Quad = function (rect, parent, idx) {\n\tthis.parent = parent;\n\tthis.idx = idx;\n\tthis.quads = [];\n\tthis.quadFlags = 0;\n\tthis.items = [];\n\tthis.rect = new T.Rect(rect);\n};\n\nQuad.prototype.addItem = function (object, rect, item) {\n\tvar index;\n\tvar quad = this;\n\tvar center;\n\n\tif (!item) {\n\t\titem = new Item(object, rect);\n\t}\n\n\twhile (quad) {\n\t\tcenter = quad.rect.center;\n\n\t\tif (!quad.items.length) {\n\t\t\titem.quad = quad;\n\t\t\tquad.items.push(item);\n\t\t\tbreak;\n\t\t}\n\t\telse if (quad.rect.contains(rect)) {\n\t\t\tif (rect.pos.x + rect.size.x < center.x) {\n\t\t\t\tindex = 0;\n\t\t\t}\n\t\t\telse if (rect.pos.x >= center.x) {\n\t\t\t\tindex = 2;\n\t\t\t}\n\t\t\telse {\n\t\t\t\titem.quad = quad;\n\t\t\t\tquad.items.push(item);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (rect.pos.y + rect.size.y < center.y) {\n\t\t\t\tindex += 0;\n\t\t\t}\n\t\t\telse if (rect.pos.y >= center.y) {\n\t\t\t\tindex += 1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\titem.quad = quad;\n\t\t\t\tquad.items.push(item);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\titem.quad = quad;\n\t\t\tquad.items.push(item);\n\t\t\tbreak;\n\t\t}\n\n\t\tif (!quad.quads[index]) {\n\t\t\tvar quadRect = quad.rect.copy();\n\n\t\t\tquadRect.size.x *= 0.5;\n\t\t\tquadRect.size.y *= 0.5;\n\n\t\t\tswitch (index) {\n\t\t\t\tcase 0: {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 1: {\n\t\t\t\t\tquadRect.pos.y += quadRect.size.y;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 2: {\n\t\t\t\t\tquadRect.pos.x += quadRect.size.x;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 3: {\n\t\t\t\t\tquadRect.pos.x += quadRect.size.x;\n\t\t\t\t\tquadRect.pos.y += quadRect.size.y;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tquad.quads[index] = new Quad(quadRect, quad, index);\n\t\t\tquad.quadFlags |= (1 << index);\n\t\t}\n\n\t\tquad = quad.quads[index];\n\t}\n\n\treturn item;\n};\n\nQuad.prototype.forEachItemInRect = function (callback, rect) {\n\tvar i;\n\tvar quad = this;\n\n\tfor (i = 0; i < quad.items.length; i ++) {\n\t\tvar item = quad.items[i];\n\n\t\tif (rect.intersects(item.rect)) {\n\t\t\tcallback(item.item, item);\n\t\t}\n\t}\n\n\tfor (i = 0; i < quad.quads.length; i ++) {\n\t\tvar subquad = quad.quads[i];\n\n\t\tif (subquad && rect.intersects(subquad.rect)) {\n\t\t\tsubquad.forEachItemInRect(callback, rect);\n\t\t}\n\t}\n};\n\nQuadTree.prototype = new Quad();\n\nvar Item = QuadTree.Item = function (item, rect) {\n\tthis.quad = null;\n\tthis.item = item;\n\tthis.rect = rect.copy();\n};\n\nItem.prototype.remove = function (toQuad) {\n\tvar idx;\n\tvar parent;\n\tvar quad = this.quad;\n\n\tidx = quad.items.indexOf(this);\n\tquad.items.splice(idx, 1);\n\n\tfor (; quad; quad = parent) {\n\t\tif (quad == toQuad) {\n\t\t\tbreak;\n\t\t}\n\n\t\tparent = quad.parent;\n\n\t\tif (parent && !quad.items.length && !quad.quadFlags) {\n\t\t\tdelete parent.quads[quad.idx];\n\t\t\tparent.quadFlags &= ~(1 << quad.idx);\n\t\t}\n\t}\n};\n\nItem.prototype.move = function (rect) {\n\tvar quad = this.quad;\n\n\t// search lowest quad containing new rect\n\twhile (quad.parent) {\n\t\tif (quad.rect.contains(rect)) {\n\t\t\tbreak;\n\t\t}\n\n\t\tquad = quad.parent;\n\t}\n\n\tthis.rect = new T.Rect(rect);\n\n\t// remove from current quad but do not remove new quad\n\tthis.remove(quad);\n\tquad.addItem(null, rect, this);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend animation-loop.js\n * @depend vector.js\n * @depend matrix.js\n */\n\n(function (window, document, T) {\n'use strict';\n\nvar TRANSFORM_UPDATED = 1 << 0;\nvar AUTO_CLEAR        = 1 << 1;\n\n/**\n * Encapsulates canvas animation\n */\nvar Canvas = T.Canvas = function (options) {\n\toptions = T.extend({\n\t\telement: null,\n\t\ttick: function () {},\n\t\tdraw: function () {},\n\t\tframerate: 1.0 / 120.0,\n\t\tautoClear: true,\n\t\torigin: new T.Vector(0.5, 0.5),\n\t\tscale: null,\n\t}, options);\n\n\tthis.element       = options.element;\n\tthis.ctx           = options.element.getContext('2d');\n\tthis.tick          = options.tick;\n\tthis.draw          = options.draw;\n\tthis.framerate     = options.framerate;\n\tthis.animationLoop = new T.AnimationLoop(this.framerate);\n\tthis._viewport     = new T.Rect();\n\tthis._inverseTrans = null;\n\tthis._flags        = 0;\n\tthis.options       = options;\n\tthis.matrixStack   = [];\n\n\tif (options.autoClear) {\n\t\tthis._flags |= AUTO_CLEAR;\n\t}\n};\n\nvar proto = Canvas.prototype;\n\nObject.defineProperty(proto, 'viewport', {\n\tget: function () {\n\t\tvar element = this.element;\n\t\tvar width   = +element.width;\n\t\tvar height  = +element.height;\n\n\t\tthis._viewport.size.x = width;\n\t\tthis._viewport.size.y = height;\n\n\t\treturn this._viewport;\n\t}\n});\n\nObject.defineProperty(proto, 'transform', {\n\tget: function () {\n\t\tvar transform;\n\n\t\tif (!this.matrixStack.length) {\n\t\t\tthis._prepareMatrixStack();\n\t\t}\n\n\t\treturn this.matrixStack[this.matrixStack.length - 1].copy();\n\t},\n\tset: function (transform) {\n\t\tvar matrix;\n\n\t\tif (!this.matrixStack.length) {\n\t\t\tthis._prepareMatrixStack();\n\t\t}\n\n\t\tmatrix = this.matrixStack[this.matrixStack.length - 1];\n\t\tmatrix.set(transform);\n\n\t\tmatrix.setContextTransform(this.ctx);\n\t\tthis._flags |= TRANSFORM_UPDATED;\n\t}\n});\n\nObject.defineProperty(proto, 'inverseTransform', {\n\tget: function () {\n\t\tif (this._flags & TRANSFORM_UPDATED || !this._inverseTrans) {\n\t\t\tthis._inverseTrans = this.transform.invert();\n\t\t\tthis._flags &= ~TRANSFORM_UPDATED;\n\t\t}\n\n\t\treturn this._inverseTrans.copy();\n\t}\n});\n\nproto._prepareMatrixStack = function () {\n\tvar transform = new T.Matrix();\n\n\tif (this.options.origin) {\n\t\ttransform.translate(this.options.origin.mult(this.viewport.size));\n\t}\n\n\tif (this.options.scale) {\n\t\ttransform.scale(this.options.scale);\n\t}\n\n\tthis.matrixStack.push(transform);\n};\n\nproto._updateTransform = function (transform) {\n\ttransform = transform || this.transform;\n\ttransform.setContextTransform(this.ctx);\n};\n\n/**\n * Advance time\n */\nproto._tick = function () {\n\tvar self = this;\n\tvar time = (new Date()).getTime() / 1000;\n\tvar info = {viewport: self.viewport, ctx: self.ctx};\n\n\tif (this.framerate) {\n\t\tthis.animationLoop.advanceToTime(time, function () {\n\t\t\tinfo.deltaTime = self.framerate;\n\t\t\tself.tick(self.framerate, info);\n\t\t});\n\t}\n\t// link framerate to draw rate\n\telse {\n\t\tvar dt = 0;\n\n\t\tif (this.animationLoop.lastTime == 0) {\n\t\t\tdt = 1.0 / 60.0;\n\t\t}\n\t\telse {\n\t\t\tdt = time - this.animationLoop.lastTime;\n\t\t}\n\n\t\tinfo.deltaTime = dt;\n\t\tself.tick(dt, info);\n\n\t\tthis.animationLoop.lastTime = time;\n\t}\n\n\tif (this.animationLoop.framerate) {\n\t\tinfo.frameDelta = time - this.animationLoop.lastTime;\n\t}\n\telse {\n\t\tinfo.frameDelta = 0;\n\t}\n\n\tthis._draw(info);\n\n\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\tself._tick();\n\t});\n};\n\nproto.clear = function () {\n\tvar transform;\n\tvar size   = this.viewport.size;\n\tvar width  = size.x;\n\tvar height = size.y;\n\n\tthis.ctx.save();\n\n\tthis._updateTransform(new T.Matrix());\n\tthis.ctx.clearRect(0, 0, width, height);\n\tthis._updateTransform();\n\n\tthis.ctx.restore();\n};\n\n/**\n * Draw frame\n */\nproto._draw = function (info) {\n\tif (this._flags & AUTO_CLEAR) {\n\t\tthis.clear();\n\t}\n\n\tthis.ctx.save();\n\tthis._updateTransform();\n\n\tthis.draw.call(this, this.ctx, info);\n\n\tthis.ctx.restore();\n};\n\n/**\n * Start animation loop\n */\nproto.startAnimating = function () {\n\tvar self = this;\n\n\tif (!this.animationFrame) {\n\t\tthis.animationLoop.reset();\n\n\t\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\t\tself._tick();\n\t\t});\n\t}\n};\n\n/**\n * Stop animation loop\n */\nproto.stopAnimating = function () {\n\tif (this.animationFrame) {\n\t\twindow.cancelAnimationFrame(this.animationFrame);\n\t\tthis.animationFrame = null;\n\t}\n};\n\n/**\n * Redraw frame\n */\nproto.redraw = function () {\n\tvar self = this;\n\n\tthis._draw({\n\t\tviewport: self.viewport,\n\t\tctx: self.ctx,\n\t\tdeltaTime: 0,\n\t\tframeDelta: 0,\n\t});\n};\n\n/**\n * Get canvas offset from mouse event\n */\nproto.offsetFromEvent = function (e) {\n\tvar elem = this.element;\n\tvar rect = elem.getBoundingClientRect();\n\tvar offset = new T.Vector(rect.left, rect.top);\n\n\tif (!e.changedTouches) {\n\t\toffset.x = e.clientX - offset.x;\n\t\toffset.y = e.clientY - offset.y;\n\t}\n\t// is touch event\n\telse {\n\t\toffset.x = e.changedTouches[0].pageX - offset.x;\n\t\toffset.y = e.changedTouches[0].pageY - offset.y;\n\t}\n\n\toffset = offset.mult(new T.Vector(\n\t\tthis.element.width / rect.width,\n\t\tthis.element.height / rect.height\n\t));\n\n\treturn offset;\n};\n\n/**\n * Get world position from relative pixel offset\n */\nproto.worldPositionFromOffset = function (offset) {\n\treturn this.inverseTransform.mult(offset);\n};\n\n/**\n * Get relative pixel offset from world position\n */\nproto.offsetFromWorldPosition = function (offset) {\n\treturn this.transform.mult(offset);\n};\n\n/**\n * Push new matrix to stack\n */\nproto.pushMatrix = function () {\n\tvar matrix;\n\n\tif (this.matrixStack.length) {\n\t\tmatrix = this.matrixStack[this.matrixStack.length - 1].copy();\n\t}\n\telse {\n\t\tmatrix = this.transform;\n\t}\n\n\tthis.matrixStack.push(matrix);\n};\n\n/**\n * Pop matrix from stack\n */\nproto.popMatrix = function () {\n\tif (this.matrixStack.length > 1) {\n\t\tthis.matrixStack.pop();\n\t\tthis.transform = this.matrixStack[this.matrixStack.length - 1];\n\t}\n};\n\n}(window, document, Tetragon));\n"]}