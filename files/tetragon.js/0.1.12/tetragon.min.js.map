{"version":3,"sources":["tetragon.js"],"names":["w","Tetragon","version","window","T","Tween","options","extend","startValue","endValue","duration","done","easeFunc","this","time","state","STATE_RUNNING","STATE_ENDED","easeInQuad","t","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","Math","cos","PI","easeOutSine","sin","easeInOutSine","easeInExpo","pow","easeOutExpo","easeInOutExpo","easeInCirc","sqrt","easeOutCirc","easeInOutCirc","easeInElastic","s","p","a","abs","asin","easeOutElastic","easeInOutElastic","easeInBack","undefined","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce","proto","prototype","Object","defineProperty","enumerable","get","d","tick","dt","delta","min","reset","Vector","x","y","isPrototypeOf","parseFloat","atan2","floor","add","vec","sub","mult","val","div","normalize","mag","len","length","dot","rotate","r","c","reflect","wall","refraction","out","inc","dec","shl","n","shr","copy","AnimationLoop","framerate","lastTime","advanceToTime","tickFunc","max","Constraint","p1","p2","restDist","stiffness","solve","l","f1","mass","s1","s2","pinned","Controls","keys","LEFT","TOP","RIGHT","BOTTOM","keyMap",37,38,39,40,65,87,68,83,"pressKeyWithCode","keyCode","releaseKeyWithCode","isKeyPressed","key","EntityComponent","id","name","construct","destruct","data","iterate","func","i","args","Array","slice","call","arguments","hasOwnProperty","apply","EntitySystem","entities","freeEntites","components","namedComponents","component","createComponent","push","entity","Entity","createEntity","pop","unshift","system","addComponent","instance","removeComponent","componentData","mask","obj","obj2","j","arg","loadImages","images","handleDone","errorCount","error","loadedImgs","waitForLoad","src","image","Image","allowCrossOrigin","setAttribute","onload","load","loadCount","onerror","fail","document","ImageUpscaler","frontBuffer","createElement","backBuffer","width","height","scale","scaledWidth","scaledHeight","frontCtx","getContext","backCtx","drawImage","buffer","bufferCtx","Matrix","values","set","translate","m","invert","det","mat","setContextTransform","ctx","setTransform","PointMass","position","pp","invMass","Number","MAX_VALUE","damping","inertia","dtf","v","applyForce","force","pin","Range","location","end","contains","value","intersects","range","Rect","pos","size","maxPos","center","rectPos","rectMaxPos","rect","TRANSFORM_UPDATED","AUTO_CLEAR","Canvas","element","draw","autoClear","origin","animationLoop","_viewport","_inverseTrans","_flags","matrixStack","_prepareMatrixStack","transform","matrix","viewport","_updateTransform","_tick","self","Date","getTime","info","deltaTime","frameDelta","_draw","animationFrame","requestAnimationFrame","clear","save","clearRect","restore","startAnimating","stopAnimating","cancelAnimationFrame","redraw","offsetFromEvent","e","elem","getBoundingClientRect","offset","left","top","changedTouches","pageX","pageY","clientX","clientY","worldPositionFromOffset","inverseTransform","offsetFromWorldPosition","pushMatrix","popMatrix","QuadTree","Quad","parent","idx","quads","quadFlags","items","addItem","object","item","index","quad","Item","quadRect","forEachItemInRect","callback","subquad","remove","toQuad","indexOf","splice","move"],"mappings":"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","file":"tetragon.min.js","sourcesContent":["(function (w) {\n'use strict';\n\nw.Tetragon = w.Tetragon || {\n\tversion: '0.1.12',\n};\n\n}(window));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar Tween = T.Tween = function (options) {\n\toptions = T.extend({\n\t\tstartValue: 0,\n\t\tendValue: 0,\n\t\tduration: 1,\n\t\tdone: null,\n\t\teaseFunc: null,\n\t}, options);\n\n\tthis.time       = 0;\n\tthis.state      = 0;\n\tthis.startValue = options.startValue;\n\tthis.endValue   = options.endValue;\n\tthis.duration   = options.duration;\n\tthis.done       = options.done;\n\tthis.options    = options;\n};\n\nTween.STATE_RUNNING = 1;\nTween.STATE_ENDED   = 2;\n\nTween.easeInQuad = function (t) {\n\treturn t*t;\n};\n\nTween.easeOutQuad = function (t) {\n\treturn -t*(t-2);\n};\n\nTween.easeInOutQuad = function (t) {\n\tif ((t/=0.5) < 1) return 0.5*t*t;\n\treturn -0.5 * ((--t)*(t-2) - 1);\n};\n\nTween.easeInCubic = function (t) {\n\treturn t*t*t;\n};\n\nTween.easeOutCubic = function (t) {\n\treturn ((t=t-1)*t*t + 1);\n};\n\nTween.easeInOutCubic = function (t) {\n\tif ((t/=0.5) < 1) return 0.5*t*t*t;\n\treturn 0.5*((t-=2)*t*t + 2);\n};\n\nTween.easeInQuart = function (t) {\n\treturn t*t*t*t;\n};\n\nTween.easeOutQuart = function (t) {\n\treturn -((t=t-1)*t*t*t - 1);\n};\n\nTween.easeInOutQuart = function (t) {\n\tif ((t/=0.5) < 1) return 0.5*t*t*t*t;\n\treturn -0.5 * ((t-=2)*t*t*t - 2);\n};\n\nTween.easeInQuint = function (t) {\n\treturn t*t*t*t*t;\n};\n\nTween.easeOutQuint = function (t) {\n\treturn ((t=t-1)*t*t*t*t + 1);\n};\n\nTween.easeInOutQuint = function (t) {\n\tif ((t/=0.5) < 1) return 0.5*t*t*t*t*t;\n\treturn 0.5*((t-=2)*t*t*t*t + 2);\n};\n\nTween.easeInSine = function (t) {\n\treturn -1 * Math.cos(t * (Math.PI/2)) + 1;\n};\n\nTween.easeOutSine = function (t) {\n\treturn Math.sin(t * (Math.PI/2));\n};\n\nTween.easeInOutSine = function (t) {\n\treturn -0.5 * (Math.cos(Math.PI*t) - 1);\n};\n\nTween.easeInExpo = function (t) {\n\treturn (t==0) ? 0 : 1 * Math.pow(2, 10 * (t - 1));\n};\n\nTween.easeOutExpo = function (t) {\n\treturn (t==1) ? 1 : 1 * (-Math.pow(2, -10 * t) + 1);\n};\n\nTween.easeInOutExpo = function (t) {\n\tif (t==0) return 0;\n\tif (t==1) return 1;\n\tif ((t/=0.5) < 1) return 0.5 * Math.pow(2, 10 * (t - 1));\n\treturn 0.5 * (-Math.pow(2, -10 * --t) + 2);\n};\n\nTween.easeInCirc = function (t) {\n\treturn -(Math.sqrt(1 - t*t) - 1);\n};\n\nTween.easeOutCirc = function (t) {\n\treturn Math.sqrt(1 - (t=t-1)*t);\n};\n\nTween.easeInOutCirc = function (t) {\n\tif ((t/=0.5) < 1) return -0.5 * (Math.sqrt(1 - t*t) - 1);\n\treturn 0.5 * (Math.sqrt(1 - (t-=2)*t) + 1);\n};\n\nTween.easeInElastic = function (t) {\n\tvar s=1.70158;var p=0;var a=1;\n\tif (t==0) return 0;  if (t==1) return 1;  if (!p) p=1*0.3;\n\tif (a < Math.abs(1)) { a=1; var s=p/4; }\n\telse var s = p/(2*Math.PI) * Math.asin (1/a);\n\treturn -(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*1-s)*(2*Math.PI)/p ));\n};\n\nTween.easeOutElastic = function (t) {\n\tvar s=1.70158;var p=0;var a=1;\n\tif (t==0) return 0;  if (t==1) return 1;  if (!p) p=1*.3;\n\tif (a < Math.abs(1)) { a=1; var s=p/4; }\n\telse var s = p/(2*Math.PI) * Math.asin (1/a);\n\treturn a*Math.pow(2,-10*t) * Math.sin( (t*1-s)*(2*Math.PI)/p ) + 1;\n};\n\nTween.easeInOutElastic = function (t) {\n\tvar s=1.70158;var p=0;var a=1;\n\tif (t==0) return 0;  if ((t/=0.5)==2) return 1;  if (!p) p=1*(.3*1.5);\n\tif (a < Math.abs(1)) { a=1; var s=p/4; }\n\telse var s = p/(2*Math.PI) * Math.asin (1/a);\n\tif (t < 1) return -0.5*(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*1-s)*(2*Math.PI)/p ));\n\treturn a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*1-s)*(2*Math.PI)/p )*0.5 + 1;\n};\n\nTween.easeInBack = function (t, s) {\n\tif (s == undefined) s = 1.70158;\n\treturn t*t*((s+1)*t - s);\n};\n\nTween.easeOutBack = function (t, s) {\n\tif (s == undefined) s = 1.70158;\n\treturn ((t=t-1)*t*((s+1)*t + s) + 1);\n};\n\nTween.easeInOutBack = function (t, s) {\n\tif (s == undefined) s = 1.70158;\n\tif ((t/=0.5) < 1) return 0.5*(t*t*(((s*=(1.525))+1)*t - s));\n\treturn 0.5*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2);\n};\n\nTween.easeInBounce = function (t) {\n\treturn 1 - Tween.easeOutBounce (1-t, 0);\n};\n\nTween.easeOutBounce = function (t) {\n\tif (t < (1/2.75)) {\n\t\treturn (7.5625*t*t);\n\t} else if (t < (2/2.75)) {\n\t\treturn (7.5625*(t-=(1.5/2.75))*t + 0.75);\n\t} else if (t < (2.5/2.75)) {\n\t\treturn (7.5625*(t-=(2.25/2.75))*t + 0.9375);\n\t} else {\n\t\treturn (7.5625*(t-=(2.625/2.75))*t + 0.984375);\n\t}\n};\n\nTween.easeInOutBounce = function (t) {\n\tif (t < 0.5) return Tween.easeInBounce (t*2, 0) * 0.5;\n\treturn Tween.easeOutBounce (t*2-1, 0) * 0.5 + 0.5;\n};\n\nvar proto = Tween.prototype;\n\nObject.defineProperty(proto, 'value', {\n\tenumerable: true,\n\tget: function () {\n\t\tvar d = this.time / this.duration;\n\n\t\tif (this.options.easeFunc) {\n\t\t\td = this.options.easeFunc(d);\n\t\t}\n\n\t\treturn this.startValue + d * (this.endValue - this.startValue);\n\t},\n});\n\nproto.tick = function (dt) {\n\tvar delta;\n\n\tthis.time = Math.min(this.time + dt, this.duration);\n\tdelta = this.time / this.duration;\n\n\tif (this.time >= this.duration) {\n\t\tif (this.done) {\n\t\t\tthis.done();\n\t\t\tthis.done = null;\n\t\t}\n\t}\n};\n\nproto.reset = function () {\n\tthis.time = 0;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar Vector = T.Vector = function (x, y) {\n\tif (Vector.prototype.isPrototypeOf(x)) {\n\t\tthis.x = x.x;\n\t\tthis.y = x.y;\n\t}\n\telse {\n\t\tthis.x = parseFloat(x) || 0.0;\n\t\tthis.y = parseFloat(y) || 0.0;\n\t}\n};\n\nvar proto = Vector.prototype;\n\nObject.defineProperty(proto, 'length', {\n\tget: function () {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t}\n});\n\nObject.defineProperty(proto, 'lengthSquared', {\n\tget: function () {\n\t\treturn this.x * this.x + this.y * this.y;\n\t}\n});\n\nObject.defineProperty(proto, 'negated', {\n\tget: function () {\n\t\treturn new Vector(-this.x, -this.y);\n\t}\n});\n\nObject.defineProperty(proto, 'rotation', {\n\tget: function () {\n\t\tvar a = Math.atan2(this.y, this.x);\n\t\ta = a < 0 ? a + 2.0 * Math.PI : a;\n\t\treturn a / Math.PI * 180.0;\n\t}\n});\n\nObject.defineProperty(proto, 'integ', {\n\tget: function () {\n\t\treturn new Vector(Math.floor(this.x), Math.floor(this.y));\n\t}\n});\n\nproto.add = function (vec) {\n\treturn new Vector(this.x + vec.x, this.y + vec.y);\n};\n\nproto.sub = function (vec) {\n\treturn new Vector(this.x - vec.x, this.y - vec.y);\n};\n\nproto.mult = function (val) {\n\tif (val === Object(val)) {\n\t\treturn new Vector(this.x * val.x, this.y * val.y);\n\t}\n\telse {\n\t\treturn new Vector(this.x * val, this.y * val);\n\t}\n};\n\nproto.div = function (val) {\n\tif (val === Object(val)) {\n\t\treturn new Vector(this.x / val.x, this.y / val.y);\n\t}\n\telse {\n\t\treturn new Vector(this.x / val, this.y / val);\n\t}\n};\n\nproto.normalize = function (mag) {\n\tif (mag === undefined) {\n\t\tmag = 1.0;\n\t}\n\n\tvar len = this.length;\n\n\tif (len) {\n\t\tlen = mag / len;\n\t}\n\n\treturn new Vector(this.x * len, this.y * len);\n};\n\nproto.dot = function (vec) {\n\treturn this.x * vec.x + this.y * vec.y;\n};\n\nproto.rotate = function (a) {\n\tvar r = a / 180.0 * Math.PI;\n\tvar c = Math.cos(r);\n\tvar s = Math.sin(r);\n\n\treturn new Vector(\n\t\tthis.x * c - this.y * s,\n\t\tthis.x * s + this.y * c\n\t);\n};\n\nproto.reflect = function (wall, refraction) {\n\tvar out;\n\n\trefraction = refraction === undefined ? 1.0 : 0.5 + refraction * 0.5;\n\twall = wall.normalize();\n\tout = this.sub(wall.mult(2.0 * wall.dot(this)).mult(refraction));\n\n\tif (refraction != 2.0) {\n\t\tout = out.normalize(this.length);\n\t}\n\n\treturn out;\n};\n\nproto.inc = function (vec) {\n\tthis.x += vec.x;\n\tthis.y += vec.y;\n};\n\nproto.dec = function (vec) {\n\tthis.x -= vec.x;\n\tthis.y -= vec.y;\n};\n\nproto.shl = function (n) {\n\treturn new Vector(this.x << n, this.y << n);\n};\n\nproto.shr = function (n) {\n\treturn new Vector(this.x >> n, this.y >> n);\n};\n\nproto.copy = function (a) {\n\treturn new Vector(this.x, this.y);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Animation loop\n */\nvar AnimationLoop = T.AnimationLoop = function (framerate) {\n\tthis.framerate = framerate;\n\tthis.lastTime  = 0;\n}\n\nvar proto = AnimationLoop.prototype;\n\n/**\n * Advance animation loop to new time\n *\n * `tickFunc` is called every frame\n */\nproto.advanceToTime = function (time, tickFunc) {\n\t// set `lastTime` to previous frame if first frame\n\tif (this.lastTime == 0) {\n\t\tthis.lastTime = time - 1.0 / 60.0;\n\t}\n\n\t// limit previous time if animation was paused or had a greater lag,\n\t// the loop will not try to catch up with a too big time step\n\tthis.lastTime = Math.max(time - 1.0 / 20.0, this.lastTime)\n\n\t// only advance to previous frame\n\ttime -= this.framerate;\n\n\t// advance to new time\n\twhile (this.lastTime < time) {\n\t\ttickFunc(this.framerate);\n\t\tthis.lastTime += this.framerate;\n\t}\n};\n\n/**\n * Reset loop\n */\nproto.reset = function () {\n\tthis.lastTime = 0;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Defines a constraint between two point masses\n *\n * Keeps the points `p1` and `p1` at a given resting distance `restDist`\n * A `stiffness` value of 1.0 sets the maximum responsiveness\n * Values below 1.0 and above 0.0 make the constraint more \"rubbery\"\n *\n * If `restDist` is omitted, it is set to the initial distance\n *   between `p1` and `p2`\n * If `stiffness` is omitted, it is set to its maximum value 1.0\n */\nvar Constraint = T.Constraint = function (p1, p2, restDist, stiffness) {\n\t// set current distance as resting distance if not defined\n\tif (restDist === undefined) {\n\t\trestDist = p2.p.sub(p1.p).length;\n\t}\n\n\t// set default stiffness to maximum if not defined\n\tif (stiffness === undefined) {\n\t\tstiffness = 1.0;\n\t}\n\n\t// set controlling points\n\tthis.p1 = p1;\n\tthis.p2 = p2;\n\n\t// set resting distance\n\tthis.restDist = restDist;\n\n\t// set stiffness\n\tthis.stiffness = stiffness;\n}\n\nvar proto = Constraint.prototype;\n\n/**\n * Solve step\n */\nproto.solve = function() {\n\tvar p1 = this.p1;\n\tvar p2 = this.p2;\n\n\t// current distance vector between points\n\t// d = p1 - p2\n\tvar d = p1.p.sub(p2.p);\n\n\t// scalar distance between points\n\t// l = |d|\n\tvar l = d.length;\n\n\tvar r = 0.0;\n\n\t// proportion between current distance and resting distance\n\tif (l != 0.0) {\n\t\tr = (this.restDist - l) / l;\n\t}\n\n\t// distance vector differing from resting distance\n\t// d *= r\n\td = d.mult(r);\n\n\t// mass influence of `p1` as fraction between 0.0 and 1.0\n\t// `0.5` would mean that `p1` and `p2` have the same mass\n\tvar f1 = 1.0 - p1.mass / (p1.mass + p2.mass);\n\n\t// influences of `p1` and `p2`\n\tvar s1 = f1 * this.stiffness;\n\tvar s2 = this.stiffness - s1;\n\n\tif (!p1.pinned) {\n\t\t// p1 += d * s1\n\t\tp1.p = p1.p.add(d.mult(s1));\n\t}\n\n\tif (!p2.pinned) {\n\t\t// p2 -= d * s2\n\t\tp2.p = p2.p.sub(d.mult(s2));\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar Controls = T.Controls = function () {\n\tthis.keys = 0;\n};\n\nControls.LEFT   = 1 << 0;\nControls.TOP    = 1 << 1;\nControls.RIGHT  = 1 << 2;\nControls.BOTTOM = 1 << 3;\n\nControls.keyMap = {\n\t37: Controls.LEFT,   // arrow left\n\t38: Controls.TOP,    // arrow up\n\t39: Controls.RIGHT,  // arrow right\n\t40: Controls.BOTTOM, // arrow down\n\n\t65: Controls.LEFT,   // A\n\t87: Controls.TOP,    // W\n\t68: Controls.RIGHT,  // D\n\t83: Controls.BOTTOM  // S\n};\n\nvar proto = Controls.prototype;\n\nproto.pressKeyWithCode = function (keyCode) {\n\tif (Controls.keyMap[keyCode]) {\n\t\tthis.keys |= Controls.keyMap[keyCode];\n\t}\n};\n\nproto.releaseKeyWithCode = function (keyCode) {\n\tif (Controls.keyMap[keyCode]) {\n\t\tthis.keys &= ~Controls.keyMap[keyCode];\n\t}\n};\n\nproto.isKeyPressed = function (key) {\n\treturn this.keys & key;\n};\n\nproto.reset = function () {\n\tthis.keys = 0;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar EntityComponent = T.EntityComponent = function (id, options) {\n\tthis.id = id;\n\tthis.name = options.name;\n\tthis.options = options;\n\tthis.construct = options.construct;\n\tthis.destruct = options.destruct;\n\tthis.data = [];\n};\n\nvar proto = EntityComponent.prototype;\n\n/**\n * Iterate entity component data\n *\n * If `func` is a callback, it will be called with the entity component data as\n * first argument followed by all arguments given to this function.\n * If `func` is a string, the corresponding callback of the component is used.\n */\nproto.iterate = function (func) {\n\tvar i;\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tif (typeof func == 'string') {\n\t\tfunc = this.options[func];\n\t}\n\n\tfor (i in this.data) {\n\t\tif (this.data.hasOwnProperty(i)) {\n\t\t\tfunc.apply(this.data[i], args);\n\t\t}\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend entity-component.js\n */\n\n(function (T) {\n'use strict';\n\nvar EntitySystem = T.EntitySystem = function () {\n\tthis.entities = [];\n\tthis.freeEntites = [];\n\tthis.components = [];\n\tthis.namedComponents = {};\n};\n\nvar proto = EntitySystem.prototype;\n\nproto.component = function (name) {\n\treturn this.namedComponents[name];\n};\n\nproto.createComponent = function (options) {\n\toptions = T.extend({\n\t\tconstruct: null,\n\t\tdestruct: null,\n\t}, options);\n\n\tvar id = this.components.length;\n\tvar component = new T.EntityComponent(id, options);\n\tthis.components.push(component);\n\tthis.namedComponents[component.name] = component;\n\n\treturn component;\n};\n\nproto.entity = function (id) {\n\tif (this.entities[id] === undefined) {\n\t\treturn null;\n\t}\n\n\treturn new T.Entity(id, this);\n};\n\nproto.createEntity = function () {\n\tvar id = this.freeEntites.pop();\n\n\tif (id === undefined) {\n\t\tid = this.entities.length + 1;\n\t\tthis.entities.push(0);\n\t}\n\n\treturn new T.Entity(id, this);\n};\n\nproto.iterate = function (name, func) {\n\tvar args = Array.prototype.slice.call(arguments, 2);\n\tvar component = this.component(name);\n\n\tif (component) {\n\t\targs.unshift(func);\n\t\tcomponent.iterate.apply(component, args);\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend entity-system.js\n * @depend entity-component.js\n */\n\n(function (T) {\n'use strict';\n\nvar Entity = T.Entity = function (id, system) {\n\tthis.id = id;\n\tthis.system = system;\n};\n\nvar proto = Entity.prototype;\n\nproto.addComponent = function (component) {\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tif (typeof component == 'string') {\n\t\tcomponent = this.system.component(component);\n\n\t\tif (!component) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tif (component.data[this.id - 1]) {\n\t\treturn null;\n\t}\n\n\tvar instance = {\n\t\tentity: this,\n\t};\n\n\tif (component.construct) {\n\t\tcomponent.construct.apply(instance, args);\n\t}\n\n\tcomponent.data[this.id - 1] = instance;\n\tthis.system.entities[this.id - 1] |= (1 << component.id);\n\n\treturn instance;\n};\n\nproto.removeComponent = function (component) {\n\tif (typeof component == 'string') {\n\t\tcomponent = this.system.component(component);\n\n\t\tif (!component) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tif (!component.data[this.id - 1]) {\n\t\treturn null;\n\t}\n\n\tif (component.destruct) {\n\t\tcomponent.destruct.apply(component.data[this.id - 1]);\n\t}\n\n\tdelete component.data[this.id - 1];\n\tthis.system.entities[this.id - 1] &= ~(1 << component.id);\n};\n\nproto.componentData = function (name) {\n\tvar component = this.system.namedComponents[name];\n\n\tif (!component) {\n\t\treturn null;\n\t}\n\n\treturn component.data[this.id - 1];\n};\n\nproto.delete = function () {\n\tvar n = 0;\n\tvar system = this.system;\n\n\tif (system.entities[this.id - 1] === undefined) {\n\t\treturn;\n\t}\n\n\tvar mask = system.entities[this.id - 1];\n\n\twhile (mask) {\n\t\tif (!(mask & 0xFF)) {\n\t\t\tmask >>= 8;\n\t\t\tn += 8;\n\t\t}\n\n\t\tif (mask & 1) {\n\t\t\tvar component = system.components[n];\n\n\t\t\tif (component.destruct) {\n\t\t\t\tcomponent.destruct.apply(component.data[this.id - 1]);\n\t\t\t}\n\n\t\t\tdelete component.data[this.id - 1];\n\t\t}\n\n\t\tmask >>= 1;\n\t\tn ++;\n\t}\n\n\tdelete system.entities[this.id - 1];\n\tsystem.freeEntites.push(this.id);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nT.extend = function (obj, obj2) {\n\tvar i, j;\n\tvar arg;\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tobj = obj || {};\n\n\tfor (i = 0; i < args.length; i ++) {\n\t\tvar arg = args[i] || {};\n\n\t\tfor (j in arg) {\n\t\t\tif (arg.hasOwnProperty(j)) {\n\t\t\t\tif (arg[j] !== null && arg[j] !== undefined) {\n\t\t\t\t\tobj[j] = arg[j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn obj;\n};\n\nT.loadImages = function (images, options) {\n\tvar i;\n\tvar keys;\n\tvar options    = options || {};\n\tvar loadCount  = 0;\n\tvar errorCount = 0;\n\tvar loadedImgs = {};\n\n\tfunction handleDone() {\n\t\tif (errorCount) {\n\t\t\tif (options.error) {\n\t\t\t\toptions.error(loadedImgs);\n\t\t\t}\n\t\t}\n\t\telse if (options.done) {\n\t\t\toptions.done(loadedImgs);\n\t\t}\n\t}\n\n\tfunction waitForLoad(src, key) {\n\t\tvar image = new Image();\n\n\t\tif (options.allowCrossOrigin) {\n\t\t\timage.setAttribute('crossorigin', 'anonymous');\n\t\t}\n\n\t\timage.onload = function () {\n\t\t\tif (!loadedImgs[key]) {\n\t\t\t\tloadedImgs[key] = image;\n\n\t\t\t\tif (options.load) {\n\t\t\t\t\toptions.load(key, image);\n\t\t\t\t}\n\n\t\t\t\tif (++ loadCount >= keys.length) {\n\t\t\t\t\thandleDone();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timage.onerror = function () {\n\t\t\terrorCount ++;\n\n\t\t\tif (!loadedImgs[key]) {\n\t\t\t\tloadedImgs[key] = undefined;\n\n\t\t\t\tif (options.fail) {\n\t\t\t\t\toptions.fail(key, src);\n\t\t\t\t}\n\n\t\t\t\tif (++ loadCount >= keys.length) {\n\t\t\t\t\thandleDone();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timage.src = src;\n\n\t\treturn image;\n\t}\n\n\toptions = T.extend({\n\t\tdone: null,\n\t\terror: null,\n\t\tload: null,\n\t\tfail: null,\n\t\tallowCrossOrigin: false,\n\t}, options);\n\n\tkeys = Object.keys(images);\n\n\tif (keys.length == 0) {\n\t\tif (options.done) {\n\t\t\toptions.done(loadedImgs);\n\t\t}\n\t}\n\n\tfor (i = 0; i < keys.length; i ++) {\n\t\tvar key = keys[i];\n\t\tvar src = images[key];\n\n\t\t// assuming an image element\n\t\tif (src === Object(src)) {\n\t\t\tsrc = src.src;\n\t\t}\n\n\t\twaitForLoad(src, key);\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (window, document, T) {\n'use strict';\n\nvar ImageUpscaler = T.ImageUpscaler = function () {\n\tthis.frontBuffer = document.createElement('canvas');\n\tthis.backBuffer = document.createElement('canvas');\n\tthis.frontBuffer.width = 64;\n\tthis.frontBuffer.height = 64;\n\tthis.backBuffer.width = 64;\n\tthis.backBuffer.height = 64;\n};\n\nImageUpscaler.prototype.scale = function (image, scale) {\n\tvar x, y;\n\tvar width = image.width;\n\tvar height = image.height;\n\tvar scaledWidth = width * scale.x;\n\tvar scaledHeight = height * scale.y;\n\n\tthis.frontBuffer.width = Math.max(scaledWidth, this.frontBuffer.width);\n\tthis.frontBuffer.height = Math.max(scaledHeight, this.frontBuffer.height);\n\tthis.backBuffer.width = this.frontBuffer.width;\n\tthis.backBuffer.height = this.frontBuffer.height;\n\n\tvar frontCtx = this.frontBuffer.getContext('2d');\n\tvar backCtx = this.backBuffer.getContext('2d');\n\n\tfor (x = 0; x < width; x ++) {\n\t\tfrontCtx.drawImage(image, x, 0, 1, height, x * scale.x, 0, 1, height);\n\t}\n\n\tfor (y = 0; y < height; y ++) {\n\t\tbackCtx.drawImage(this.frontBuffer, 0, y, scaledWidth, 1, 0, y * scale.y, scaledWidth, 1);\n\t}\n\n\tvar buffer = document.createElement('canvas');\n\tvar bufferCtx = buffer.getContext('2d');\n\n\tbuffer.width = scaledWidth;\n\tbuffer.height = scaledHeight;\n\n\tfor (x = 0; x < scale.x; x ++) {\n\t\tfor (y = 0; y < scale.y; y ++) {\n\t\t\tbufferCtx.drawImage(this.backBuffer, x, y);\n\t\t}\n\t}\n\n\treturn buffer;\n};\n\n}(window, document, Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Matrix = T.Matrix = function (values) {\n\tif (values) {\n\t\tthis.set(values);\n\t}\n\telse {\n\t\tthis.set([\n\t\t\t1, 0,\n\t\t\t0, 1,\n\t\t\t0, 0,\n\t\t]);\n\t}\n};\n\nvar proto = Matrix.prototype;\n\nproto.translate = function (vec) {\n\tthis[4] += vec.x * this[0] + vec.y * this[2];\n\tthis[5] += vec.x * this[1] + vec.y * this[3];\n\n\treturn this;\n};\n\nproto.scale = function (vec) {\n\tthis[0] *= vec.x;\n\tthis[2] *= vec.x;\n\tthis[1] *= vec.y;\n\tthis[3] *= vec.y;\n\n\treturn this;\n};\n\nproto.rotate = function (a) {\n\tvar s, c;\n\n\ta = a / 180.0 * Math.PI;\n\ts = Math.sin(a);\n\tc = Math.cos(a);\n\n\tvar m = this.mult(new T.Matrix([\n\t\tc, s,\n\t\t-s, c,\n\t\t0, 0,\n\t]));\n\n\tthis.set(m);\n\n\treturn this;\n};\n\nproto.mult = function (val) {\n\tif (T.Vector.prototype.isPrototypeOf(val)) {\n\t\treturn new T.Vector(\n\t\t\tthis[0] * val.x + this[2] * val.y + this[4],\n\t\t\tthis[1] * val.x + this[3] * val.y + this[5]\n\t\t);\n\t}\n\tif (T.Matrix.prototype.isPrototypeOf(val)) {\n\t\treturn new Matrix([\n\t\t\tthis[0] * val[0] + this[2] * val[1],\n\t\t\tthis[1] * val[0] + this[3] * val[1],\n\t\t\tthis[0] * val[2] + this[2] * val[3],\n\t\t\tthis[1] * val[2] + this[3] * val[3],\n\t\t\tthis[0] * val[4] + this[2] * val[5] + this[4],\n\t\t\tthis[1] * val[4] + this[3] * val[5] + this[5]\n\t\t]);\n\t}\n};\n\nproto.invert = function () {\n\tvar det;\n\tvar mat = new T.Matrix();\n\n\tmat[0] =  this[3];\n\tmat[1] = -this[1];\n\tmat[2] = -this[2];\n\tmat[3] =  this[0];\n\tmat[4] =  this[2] * this[5] - this[3] * this[4];\n\tmat[5] = -this[0] * this[5] + this[1] * this[4];\n\n\tdet = this[0] * mat[0] + this[2] * mat[1];\n\n\tif (det == 0.0) {\n\t\treturn this.copy();\n\t}\n\n\tdet = 1.0 / det;\n\n\tmat[0] *= det;\n\tmat[1] *= det;\n\tmat[2] *= det;\n\tmat[3] *= det;\n\tmat[4] *= det;\n\tmat[5] *= det;\n\n\treturn mat;\n};\n\nproto.copy = function () {\n\treturn new T.Matrix(this);\n};\n\nproto.set = function (mat) {\n\tthis[0] = mat[0];\n\tthis[1] = mat[1];\n\tthis[2] = mat[2];\n\tthis[3] = mat[3];\n\tthis[4] = mat[4];\n\tthis[5] = mat[5];\n\n\treturn this;\n};\n\nproto.setContextTransform = function (ctx) {\n\tctx.setTransform(this[0], this[1], this[2], this[3], this[4], this[5]);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Defines a point mass\n *\n * The point is initialized with an initial `position` and a `mass`\n * More mass means more inertness\n */\nvar PointMass = T.PointMass = function (position, mass) {\n\t// current position\n\tthis.p = position.copy();\n\n\t// previous position\n\tthis.pp = position.copy();\n\n\t// acceleration for current frame\n\tthis.a = new T.Vector(); // null vector\n\n\t// mass; set to 1.0 if not defined\n\tthis.mass = mass ||1.0;\n\n\t// inverse mass\n\tif (this.mass == 0.0) {\n\t\tthis.invMass = Number.MAX_VALUE;\n\t}\n\telse if (this.mass == Number.MAX_VALUE) {\n\t\tthis.invMass = 0.0;\n\t}\n\telse {\n\t\tthis.invMass = 1.0 / this.mass;\n\t}\n\n\t// set default damping value\n\tthis.damping = 0.997;\n\n\t// `true` if pinned to current position\n\tthis.pinned = false;\n};\n\nvar proto = PointMass.prototype;\n\n/**\n * Move point to next position\n */\nproto.inertia = function(dt) {\n\t// time depending factor used for acceleration\n\t// dtf = 0.5 * dt^2\n\tvar dtf = 0.5 * dt * dt;\n\n\t// get velocity vector and add damping\n\t// v = (p - pp) * damping\n\tvar v = this.p.sub(this.pp).mult(this.damping);\n\n\t// this is more accurate, but also slower\n\t// v = (p - pp) * damping ^ dt\n\t//var v = this.p.sub(this.pp).mult(Math.pow(this.damping, dt));\n\n\t// calculate next position by adding velocity\n\t// and acceleration to current position\n\t// n = p + v + a * dtf\n\tvar n = this.p.add(v.add(this.a.mult(dtf)));\n\n\t// set previous position to current position\n\tthis.pp = this.p.copy();\n\n\t// set current position to next position\n\tthis.p = n;\n\n\t// clear acceleration for current step\n\tthis.a = new T.Vector();\n};\n\n/**\n * Add force vector\n */\nproto.applyForce = function(force) {\n\t// add force multiplied with inverse of mass\n\t// a += force * (1.0 / mass)\n\tthis.a = this.a.add(force.mult(this.invMass));\n};\n\n/**\n * Pin point to its current position\n */\nproto.pin = function() {\n\tthis.pp     = this.p.copy();\n\tthis.pinned = true;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Range = T.Range = function (location, length) {\n\tthis.location = location || 0;\n\tthis.length = length || 0;\n};\n\nvar proto = Range.prototype;\n\nObject.defineProperty(proto, 'end', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.location + this.length;\n\t},\n\tset: function (end) {\n\t\tthis.location = end - this.length;\n\t}\n});\n\nproto.contains = function (value) {\n\tif (T.Range.prototype.isPrototypeOf(val)) {\n\t\treturn value.location >= this.location && value.end <= this.end;\n\t}\n\telse {\n\t\treturn value >= this.location && value < this.end;\n\t}\n};\n\nproto.intersects = function (range) {\n\treturn range.location < this.end && range.end > this.location;\n};\n\nproto.extend = function (val) {\n\tvar end = this.end;\n\n\tif (Range.prototype.isPrototypeOf(val)) {\n\t\tif (val.location < this.location) {\n\t\t\tthis.location = val.location;\n\t\t\tthis.length = end - this.location;\n\t\t}\n\t\telse if (val.end > end) {\n\t\t\tthis.length = val.end - this.location;\n\t\t}\n\t}\n\telse {\n\t\tif (val < this.location) {\n\t\t\tthis.location = val;\n\t\t\tthis.length = end - val;\n\t\t}\n\t\telse if (val > end) {\n\t\t\tthis.length = val - location;\n\t\t}\n\t}\n};\n\nproto.copy = function () {\n\treturn new Range(this.location, this.length);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Rect = T.Rect = function (p, s) {\n\tif (Rect.prototype.isPrototypeOf(p)) {\n\t\tthis.pos  = p.pos.copy();\n\t\tthis.size = p.size.copy();\n\t}\n\telse {\n\t\tthis.pos  = p ? p.copy() : new T.Vector();\n\t\tthis.size = s ? s.copy() : new T.Vector();\n\t}\n};\n\nvar proto = Rect.prototype;\n\nObject.defineProperty(proto, 'maxPos', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.pos.add(this.size);\n\t},\n\tset: function (maxPos) {\n\t\tthis.pos = maxPos.sub(this.size);\n\t}\n});\n\nObject.defineProperty(proto, 'center', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.pos.add(this.size.mult(0.5));\n\t},\n\tset: function (center) {\n\t\tthis.pos = center.sub(this.size.mult(0.5));\n\t}\n});\n\nproto.contains = function (val) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\n\tif (T.Vector.prototype.isPrototypeOf(val)) {\n\t\tif (val.x >= pos.x && val.x < maxPos.x) {\n\t\t\tif (val.y >= pos.y && val.y < maxPos.y) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\telse if (T.Rect.prototype.isPrototypeOf(val)) {\n\t\tvar rectPos = val.pos;\n\t\tvar rectMaxPos = val.maxPos;\n\n\t\tif (rectPos.x >= pos.x && rectMaxPos.x <= maxPos.x) {\n\t\t\tif (rectPos.y >= pos.y && rectMaxPos.y <= maxPos.y) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.intersects = function (rect) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\tvar rectPos = rect.pos;\n\tvar rectMaxPos = rect.maxPos;\n\n\tif (rectMaxPos.x > pos.x && rectPos.x < maxPos.x) {\n\t\tif (rectMaxPos.y > pos.y && rectPos.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.extend = function (val) {\n\tvar maxPos = this.maxPos;\n\n\tif (T.Vector.prototype.isPrototypeOf(val)) {\n\t\tif (val.x < this.pos.x) {\n\t\t\tthis.pos.x = val.x;\n\t\t\tthis.size.x = maxPos.x - val.x;\n\t\t}\n\t\telse if (val.x > maxPos.x) {\n\t\t\tthis.size.x = val.x - this.pos.x;\n\t\t}\n\n\t\tif (val.y < this.pos.y) {\n\t\t\tthis.pos.y = val.y;\n\t\t\tthis.size.y = maxPos.y - val.y;\n\t\t}\n\t\telse if (val.y > maxPos.y) {\n\t\t\tthis.size.y = maxPos.y - this.pos.y;\n\t\t}\n\t}\n\telse if (T.Rect.prototype.isPrototypeOf(val)) {\n\t\tif (val.pos.x < this.pos.x) {\n\t\t\tthis.pos.x = val.pos.x;\n\t\t\tthis.size.x = maxPos.x - val.pos.x;\n\t\t}\n\t\telse if (val.maxPos.x > maxPos.x) {\n\t\t\tthis.size.x = val.maxPos.x - this.pos.x;\n\t\t}\n\n\t\tif (val.pos.y < this.pos.y) {\n\t\t\tthis.pos.y = val.pos.y;\n\t\t\tthis.size.y = maxPos.y - val.pos.y;\n\t\t}\n\t\telse if (val.maxPos.y > maxPos.y) {\n\t\t\tthis.size.y = val.maxPos.y - this.pos.y;\n\t\t}\n\t}\n};\n\nproto.copy = function () {\n\treturn new Rect(this.pos, this.size);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend animation-loop.js\n * @depend vector.js\n * @depend matrix.js\n */\n\n(function (window, document, T) {\n'use strict';\n\nvar TRANSFORM_UPDATED = 1 << 0;\nvar AUTO_CLEAR        = 1 << 1;\n\n/**\n * Encapsulates canvas animation\n */\nvar Canvas = T.Canvas = function (options) {\n\toptions = T.extend({\n\t\telement: null,\n\t\ttick: function () {},\n\t\tdraw: function () {},\n\t\tframerate: 1.0 / 120.0,\n\t\tautoClear: true,\n\t\torigin: new T.Vector(0.5, 0.5),\n\t\tscale: null,\n\t}, options);\n\n\tthis.element       = options.element;\n\tthis.ctx           = options.element.getContext('2d');\n\tthis.tick          = options.tick;\n\tthis.draw          = options.draw;\n\tthis.framerate     = options.framerate;\n\tthis.animationLoop = new T.AnimationLoop(this.framerate);\n\tthis._viewport     = new T.Rect();\n\tthis._inverseTrans = null;\n\tthis._flags        = 0;\n\tthis.options       = options;\n\tthis.matrixStack   = [];\n\n\tif (options.autoClear) {\n\t\tthis._flags |= AUTO_CLEAR;\n\t}\n};\n\nvar proto = Canvas.prototype;\n\nObject.defineProperty(proto, 'viewport', {\n\tget: function () {\n\t\tvar element = this.element;\n\t\tvar width   = +element.width;\n\t\tvar height  = +element.height;\n\n\t\tthis._viewport.size.x = width;\n\t\tthis._viewport.size.y = height;\n\n\t\treturn this._viewport;\n\t}\n});\n\nObject.defineProperty(proto, 'transform', {\n\tget: function () {\n\t\tvar transform;\n\n\t\tif (!this.matrixStack.length) {\n\t\t\tthis._prepareMatrixStack();\n\t\t}\n\n\t\treturn this.matrixStack[this.matrixStack.length - 1].copy();\n\t},\n\tset: function (transform) {\n\t\tvar matrix;\n\n\t\tif (!this.matrixStack.length) {\n\t\t\tthis._prepareMatrixStack();\n\t\t}\n\n\t\tmatrix = this.matrixStack[this.matrixStack.length - 1];\n\t\tmatrix.set(transform);\n\n\t\tmatrix.setContextTransform(this.ctx);\n\t\tthis._flags |= TRANSFORM_UPDATED;\n\t}\n});\n\nObject.defineProperty(proto, 'inverseTransform', {\n\tget: function () {\n\t\tif (this._flags & TRANSFORM_UPDATED || !this._inverseTrans) {\n\t\t\tthis._inverseTrans = this.transform.invert();\n\t\t\tthis._flags &= ~TRANSFORM_UPDATED;\n\t\t}\n\n\t\treturn this._inverseTrans.copy();\n\t}\n});\n\nproto._prepareMatrixStack = function () {\n\tvar transform = new T.Matrix();\n\n\tif (this.options.origin) {\n\t\ttransform.translate(this.options.origin.mult(this.viewport.size));\n\t}\n\n\tif (this.options.scale) {\n\t\ttransform.scale(this.options.scale);\n\t}\n\n\tthis.matrixStack.push(transform);\n};\n\nproto._updateTransform = function (transform) {\n\ttransform = transform || this.transform;\n\ttransform.setContextTransform(this.ctx);\n};\n\n/**\n * Advance time\n */\nproto._tick = function () {\n\tvar self = this;\n\tvar time = (new Date()).getTime() / 1000;\n\tvar info = {viewport: self.viewport, ctx: self.ctx};\n\n\tif (this.framerate) {\n\t\tthis.animationLoop.advanceToTime(time, function () {\n\t\t\tinfo.deltaTime = self.framerate;\n\t\t\tself.tick(self.framerate, info);\n\t\t});\n\t}\n\t// link framerate to draw rate\n\telse {\n\t\tvar dt = 0;\n\n\t\tif (this.animationLoop.lastTime == 0) {\n\t\t\tdt = 1.0 / 60.0;\n\t\t}\n\t\telse {\n\t\t\t// limit previous time if animation was paused or had a greater lag,\n\t\t\t// the loop will not try to catch up with a too big time step\n\t\t\tdt = Math.min(1.0 / 30.0, time - this.animationLoop.lastTime);\n\t\t}\n\n\t\tinfo.deltaTime = dt;\n\t\tself.tick(dt, info);\n\n\t\tthis.animationLoop.lastTime = time;\n\t}\n\n\tif (this.animationLoop.framerate) {\n\t\tinfo.frameDelta = time - this.animationLoop.lastTime;\n\t}\n\telse {\n\t\tinfo.frameDelta = 0;\n\t}\n\n\tthis._draw(info);\n\n\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\tself._tick();\n\t});\n};\n\nproto.clear = function () {\n\tvar transform;\n\tvar size   = this.viewport.size;\n\tvar width  = size.x;\n\tvar height = size.y;\n\n\tthis.ctx.save();\n\n\tthis._updateTransform(new T.Matrix());\n\tthis.ctx.clearRect(0, 0, width, height);\n\tthis._updateTransform();\n\n\tthis.ctx.restore();\n};\n\n/**\n * Draw frame\n */\nproto._draw = function (info) {\n\tif (this._flags & AUTO_CLEAR) {\n\t\tthis.clear();\n\t}\n\n\tthis.ctx.save();\n\tthis._updateTransform();\n\n\tthis.draw.call(this, this.ctx, info);\n\n\tthis.ctx.restore();\n};\n\n/**\n * Start animation loop\n */\nproto.startAnimating = function () {\n\tvar self = this;\n\n\tif (!this.animationFrame) {\n\t\tthis.animationLoop.reset();\n\n\t\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\t\tself._tick();\n\t\t});\n\t}\n};\n\n/**\n * Stop animation loop\n */\nproto.stopAnimating = function () {\n\tif (this.animationFrame) {\n\t\twindow.cancelAnimationFrame(this.animationFrame);\n\t\tthis.animationFrame = null;\n\t}\n};\n\n/**\n * Redraw frame\n */\nproto.redraw = function () {\n\tvar self = this;\n\n\tthis._draw({\n\t\tviewport: self.viewport,\n\t\tctx: self.ctx,\n\t\tdeltaTime: 0,\n\t\tframeDelta: 0,\n\t});\n};\n\n/**\n * Get canvas offset from mouse event\n */\nproto.offsetFromEvent = function (e) {\n\tvar elem = this.element;\n\tvar rect = elem.getBoundingClientRect();\n\tvar offset = new T.Vector(rect.left, rect.top);\n\n\tif (!e.changedTouches) {\n\t\toffset.x = e.clientX - offset.x;\n\t\toffset.y = e.clientY - offset.y;\n\t}\n\t// is touch event\n\telse {\n\t\toffset.x = e.changedTouches[0].pageX - offset.x;\n\t\toffset.y = e.changedTouches[0].pageY - offset.y;\n\t}\n\n\toffset = offset.mult(new T.Vector(\n\t\tthis.element.width / rect.width,\n\t\tthis.element.height / rect.height\n\t));\n\n\treturn offset;\n};\n\n/**\n * Get world position from relative pixel offset\n */\nproto.worldPositionFromOffset = function (offset) {\n\treturn this.inverseTransform.mult(offset);\n};\n\n/**\n * Get relative pixel offset from world position\n */\nproto.offsetFromWorldPosition = function (offset) {\n\treturn this.transform.mult(offset);\n};\n\n/**\n * Push new matrix to stack\n */\nproto.pushMatrix = function () {\n\tvar matrix;\n\n\tif (this.matrixStack.length) {\n\t\tmatrix = this.matrixStack[this.matrixStack.length - 1].copy();\n\t}\n\telse {\n\t\tmatrix = this.transform;\n\t}\n\n\tthis.matrixStack.push(matrix);\n};\n\n/**\n * Pop matrix from stack\n */\nproto.popMatrix = function () {\n\tif (this.matrixStack.length > 1) {\n\t\tthis.matrixStack.pop();\n\t\tthis.transform = this.matrixStack[this.matrixStack.length - 1];\n\t}\n};\n\n}(window, document, Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend rect.js\n */\n\n(function (T) {\n'use strict';\n\nvar QuadTree = T.QuadTree = function (rect) {\n\tQuad.call(this, rect);\n};\n\nvar Quad = QuadTree.Quad = function (rect, parent, idx) {\n\tthis.parent = parent;\n\tthis.idx = idx;\n\tthis.quads = [];\n\tthis.quadFlags = 0;\n\tthis.items = [];\n\tthis.rect = new T.Rect(rect);\n};\n\nQuad.prototype.addItem = function (object, rect, item) {\n\tvar index;\n\tvar quad = this;\n\tvar center;\n\n\tif (!item) {\n\t\titem = new Item(object, rect);\n\t}\n\n\twhile (quad) {\n\t\tcenter = quad.rect.center;\n\n\t\tif (!quad.items.length) {\n\t\t\titem.quad = quad;\n\t\t\tquad.items.push(item);\n\t\t\tbreak;\n\t\t}\n\t\telse if (quad.rect.contains(rect)) {\n\t\t\tif (rect.pos.x + rect.size.x < center.x) {\n\t\t\t\tindex = 0;\n\t\t\t}\n\t\t\telse if (rect.pos.x >= center.x) {\n\t\t\t\tindex = 2;\n\t\t\t}\n\t\t\telse {\n\t\t\t\titem.quad = quad;\n\t\t\t\tquad.items.push(item);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (rect.pos.y + rect.size.y < center.y) {\n\t\t\t\tindex += 0;\n\t\t\t}\n\t\t\telse if (rect.pos.y >= center.y) {\n\t\t\t\tindex += 1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\titem.quad = quad;\n\t\t\t\tquad.items.push(item);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\titem.quad = quad;\n\t\t\tquad.items.push(item);\n\t\t\tbreak;\n\t\t}\n\n\t\tif (!quad.quads[index]) {\n\t\t\tvar quadRect = quad.rect.copy();\n\n\t\t\tquadRect.size.x *= 0.5;\n\t\t\tquadRect.size.y *= 0.5;\n\n\t\t\tswitch (index) {\n\t\t\t\tcase 0: {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 1: {\n\t\t\t\t\tquadRect.pos.y += quadRect.size.y;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 2: {\n\t\t\t\t\tquadRect.pos.x += quadRect.size.x;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcase 3: {\n\t\t\t\t\tquadRect.pos.x += quadRect.size.x;\n\t\t\t\t\tquadRect.pos.y += quadRect.size.y;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tquad.quads[index] = new Quad(quadRect, quad, index);\n\t\t\tquad.quadFlags |= (1 << index);\n\t\t}\n\n\t\tquad = quad.quads[index];\n\t}\n\n\treturn item;\n};\n\nQuad.prototype.forEachItemInRect = function (callback, rect) {\n\tvar i;\n\tvar quad = this;\n\n\tfor (i = 0; i < quad.items.length; i ++) {\n\t\tvar item = quad.items[i];\n\n\t\tif (rect.intersects(item.rect)) {\n\t\t\tcallback(item.item, item);\n\t\t}\n\t}\n\n\tfor (i = 0; i < quad.quads.length; i ++) {\n\t\tvar subquad = quad.quads[i];\n\n\t\tif (subquad && rect.intersects(subquad.rect)) {\n\t\t\tsubquad.forEachItemInRect(callback, rect);\n\t\t}\n\t}\n};\n\nQuadTree.prototype = new Quad();\n\nvar Item = QuadTree.Item = function (item, rect) {\n\tthis.quad = null;\n\tthis.item = item;\n\tthis.rect = rect.copy();\n};\n\nItem.prototype.remove = function (toQuad) {\n\tvar idx;\n\tvar parent;\n\tvar quad = this.quad;\n\n\tidx = quad.items.indexOf(this);\n\tquad.items.splice(idx, 1);\n\n\tfor (; quad && quad != toQuad; quad = parent) {\n\t\tparent = quad.parent;\n\n\t\tif (parent && !quad.items.length && !quad.quadFlags) {\n\t\t\tdelete parent.quads[quad.idx];\n\t\t\tparent.quadFlags &= ~(1 << quad.idx);\n\t\t}\n\t}\n};\n\nItem.prototype.move = function (rect) {\n\tvar quad = this.quad;\n\n\t// search lowest quad containing new rect\n\twhile (quad.parent) {\n\t\tif (quad.rect.contains(rect)) {\n\t\t\tbreak;\n\t\t}\n\n\t\tquad = quad.parent;\n\t}\n\n\tthis.rect = new T.Rect(rect);\n\n\t// remove from current quad but do not remove new quad\n\tthis.remove(quad);\n\tquad.addItem(null, rect, this);\n};\n\n}(Tetragon));\n"]}