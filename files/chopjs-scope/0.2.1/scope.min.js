$ch.define("scope",function(){"use strict";function a(a,b){var c=!0;"string"==typeof a&&(c=!1,b=a,a=document);var d,e=a;d=c?[a]:e.querySelectorAll("[ch-scope="+b+"]");var f=$$CHOP.scope(b);void 0!==d&&null!==d&&d.forEach(function(a){var b=a;void 0===f._els?f._els=[a]:f._els.push(a),a=a.cloneNode(!0);var c=a.querySelectorAll("[ch-scope]");null!==c&&void 0!==c&&c.forEach(function(a){a.parentNode.removeChild(a)});var d=a.querySelectorAll("[ch-name]");null!==d&&void 0!==d&&d.forEach(function(a){var c=a.getAttribute("ch-name"),d=a.getAttribute("id");d&&c&&(f[c]=$$CHOP.element(b.querySelector("#"+d)))});var e=a.querySelectorAll("[ch-data]");null!==e&&void 0!==e&&e.forEach(function(a){var b=a.getAttribute("id");b&&(b=b.trim(),void 0===f._data_entities?f._data_entities=[b]:f._data_entities.push(b))});var g=f._eventHandler,h=a.querySelectorAll("[ch-event]")||[];h.forEach(function(a){var b=a.getAttribute("id"),c=a.getAttribute("ch-event")||"";c=c.split(";").map(function(a){return a.trim()}),c.forEach(function(a){var c=a.split(":").map(function(a){return a.trim()}),d=c[0],e=c[1].split(",").map(function(a){return a.trim()});document.querySelector("#"+b).addEventListener(d,function(a){e.forEach(function(b){g.emit(b,a)})},!1)})})})}function b(a){var b=$$CHOP.scope(a);if(b&&void 0!==b._els&&$$CHOP.isArray(b._els)!==!1){var d=b._data_entities;d.forEach(function(d){var e=!0,f=document.querySelector("#"+d),g=f.getAttribute("ch-data");if(null!==g&&""!==g)e=!1,c(a,g,f,!1);else{var h=f.innerHTML.match(/{{[^{]{1,}}}/g);if(null!==h)for(var i=0,j=h.length;i!==j;++i)g=h[i],g=g.split("|")[0],g=g.replace(/{{/g,""),g=g.replace(/}}/g,""),g=g.trim(),c(a,g,f,!0)}var k="keyup",l=f.getAttribute("type");null!==l&&(l=l.toUpperCase(),("RANGE"===l||"SELECT"===f.tagName.toUpperCase())&&(k="change"));var m=f.tagName.toUpperCase();if(("INPUT"===m||"TEXTAREA"===m||"SELECT"===m)&&f.addEventListener(k,function(b){b=b||window.event,g=g.trim();var c=b.target||b.srcElement,d=c.value,e=$$CHOP.scopes[a][g].get();d!==e&&$$CHOP.scopes[a][g].set(d)},!1),e){for(var n=f.innerHTML,o=f.innerHTML.match(/{{[^{]{1,}}}/g),i=0;i!==o.length;++i){var p=o[i].replace(/{/g,"");p=p.replace(/}/g,"");var q=p.split("|").map(function(a){return a.trim()});p=q[0].trim(),p=p.split(".")[0],p=b[p].get();for(var r=1,s=q.length;r!==s;++r){var t=q[r].trim();t=b[t]||function(a){return a},p=t.call(this,p)}n=n.replace(new RegExp(o[i],"g"),p)}f.innerHTML=n,$$CHOP._loadView(f)}})}}function c(a,b,c,e){var f=$$CHOP.scope(a);b=b.split(".")[0],void 0===f._data[b]&&(f._data[b]={_els:[],_val:void 0,_watch:function(){},watch:function(a){if("function"!=typeof a)throw new Error("ChopJS Scope data has to be watched by a function.");return this._watch=a,this},get:function(){return this._val},set:function(a){if(0===arguments.length)return!1;var b=this._val;this._val=a,this._watch.apply(this,[b,this._val]);var c=this;this._els.forEach(function(a){var b=a._isInline;if(b){var e=a._html,g=e.match(/{{[^{]{1,}}}/g)||[];g.forEach(function(a){var b,c;if(a=a.replace(/{/g,""),a=a.replace(/}/g,""),a=a.trim(),-1===a.indexOf(".")){b=a.split("|").map(function(a){return a.trim()});for(var g=f._data[b[0]].get(),h=1,i=b.length;h!==i;++h)c=b[h].trim(),c=f[c]||function(a){return a},g=c.call(this,g);e=d(e,a,g)}else{b=a.split("|").map(function(a){return a.trim()});for(var j=b[0].split("."),g=f._data[j[0]].get(),h=1,i=j.length;h!==i;++h)g=g[j[h]];for(h=1,i=b.length;h!==i;++h)c=b[h].trim(),c=f[c]||function(a){return a},g=c.call(this,g);e=d(e,a,g)}}),document.querySelector("#"+a._id).innerHTML=e}else $$CHOP.find("#"+a._id).val(c._val)})}}),b=b.split(".")[0];var g=c.getAttribute("id");f._data[b]._els.push({_isInline:e,_id:g,_html:c.innerHTML}),$$CHOP.scopes[a][b]=f._data[b]}function d(a,b,c){b=b.trim(),b=b.replace(/\|/g,"\\|");var d=new RegExp("{{[\\ ]*?"+b+"[\\ ]*?}}","g");return a.replace(d,c)}function e(a){this.scope=a}$$CHOP.scopes={},$$CHOP.scope=function(c,d,f){if("string"!=typeof c)throw new Error("$ch.scope requires at least a string-type name parameter.");if(void 0===d&&void 0===f)return $$CHOP.scopes[c];"function"==typeof d&&(f=d,d=!0),$$CHOP.scopes[c]={_els:[],_data_entities:[],_data:{},_events:{}};var g=new e($$CHOP.scopes[c]);$$CHOP.scopes[c]._eventHandler=g,a(c),b(c);var h=document.querySelectorAll("[ch-scope="+c+"]")||[];return h.forEach(function(a){d===!0&&$$CHOP._addInlineTemplate(a),$$CHOP._loadView(a)}),f.apply(this,[$$CHOP.scopes[c],g]),$$CHOP},e.prototype={listen:function(a,b){if("string"!=typeof a||"function"!=typeof b)throw new Error('ChopJS Scope event "listen" requires a string-type name parameter and a callback function.');return this.scope._events[a]=b,this},emit:function(a){if("string"!=typeof a)throw new Error('ChopJS Scope event "emit" requires at least a string-type event name parameter.');var b=this.scope._events[a];if("function"==typeof b){for(var c=[],d=1;d!==arguments.length;++d)c.push(arguments[d]);b.apply(this,c)}return this}}});