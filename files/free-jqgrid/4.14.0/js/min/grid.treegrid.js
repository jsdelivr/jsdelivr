!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return b||(b=window),void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),require("./grid.base"),a(c),c}:a(jQuery)}(function(a){"use strict";var b=a.jgrid,c=b.getAccessor,d=b.stripPref,e=b.jqID,f=a.fn.jqGrid,g=function(){var c=a.makeArray(arguments);return c[0]="treeGrid"+c[0].charAt(0).toUpperCase()+c[0].substring(1),c.unshift(""),c.unshift(""),c.unshift(this.p),b.feedback.apply(this,c)};b.extend({setTreeNode:function(){return this.each(function(){var b=this,c=a(b),e=b.p;if(b.grid&&e.treeGrid){var g=e.treeReader.expanded_field,h=e.treeReader.leaf_field,i=function(b,i,j){if(null!=j){var k=a(j.target),l=k.closest("tr.jqgrow>td"),m=l.parent(),n=function(){var a=e.data[e._index[d(e.idPrefix,i)]],b=a[g]?"collapse":"expand";a[h]||(f[b+"Row"].call(c,a,m),f[b+"Node"].call(c,a,m))};return k.is("div.treeclick")?n():e.ExpandColClick&&l.length>0&&k.closest("span.cell-wrapper",l).length>0&&n(),!0}};c.off("jqGridBeforeSelectRow.setTreeNode"),c.on("jqGridBeforeSelectRow.setTreeNode",i)}})},setTreeGrid:function(){return this.each(function(){var b,c,d,e=this,f=e.p,g=[],h=["leaf_field","expanded_field","loaded"];if(f.treeGrid){f.treedatatype||a.extend(e.p,{treedatatype:f.datatype}),f.subGrid=!1,f.altRows=!1,f.pgbuttons=!1,f.pginput=!1,f.gridview=!0,null===f.rowTotal&&(f.rowNum=f.maxRowNum),f.rowList=[],f.treeIcons.plus="rtl"===f.direction?f.treeIcons.plusRtl:f.treeIcons.plusLtr,"nested"===f.treeGridModel?f.treeReader=a.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},f.treeReader):"adjacency"===f.treeGridModel&&(f.treeReader=a.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},f.treeReader));for(c in f.colModel)if(f.colModel.hasOwnProperty(c)){b=f.colModel[c].name;for(d in f.treeReader)f.treeReader.hasOwnProperty(d)&&f.treeReader[d]===b&&g.push(b)}a.each(f.treeReader,function(b){var c=String(this);c&&a.inArray(c,g)===-1&&(a.inArray(b,h)>=0?f.additionalProperties.push({name:c,search:!1,convert:function(a){return a===!0||"true"===String(a).toLowerCase()||"1"===String(a)||a}}):f.additionalProperties.push(c))})}})},expandRow:function(b){this.each(function(){var d=this,e=a(d),h=d.p;if(d.grid&&h.treeGrid){var i=h.treeReader.expanded_field,j=b[h.localReader.id];if(g.call(d,"beforeExpandRow",{rowid:j,item:b})){var k=f.getNodeChildren.call(e,b);a(k).each(function(){var b=h.idPrefix+c(this,h.localReader.id);a(f.getGridRowById.call(e,b)).css("display",""),this[i]&&f.expandRow.call(e,this)}),g.call(d,"afterExpandRow",{rowid:j,item:b})}}})},collapseRow:function(b){this.each(function(){var d=this,e=a(d),h=d.p;if(d.grid&&h.treeGrid){var i=h.treeReader.expanded_field,j=b[h.localReader.id];if(g.call(d,"beforeCollapseRow",{rowid:j,item:b})){var k=f.getNodeChildren.call(e,b);a(k).each(function(){var b=h.idPrefix+c(this,h.localReader.id);a(f.getGridRowById.call(e,b)).css("display","none"),this[i]&&f.collapseRow.call(e,this)}),g.call(d,"afterCollapseRow",{rowid:j,item:b})}}})},getRootNodes:function(){var b=[];return this.each(function(){var c=this,d=c.p;if(c.grid&&d.treeGrid)switch(d.treeGridModel){case"nested":var e=d.treeReader.level_field;a(d.data).each(function(){parseInt(this[e],10)===parseInt(d.tree_root_level,10)&&b.push(this)});break;case"adjacency":var f=d.treeReader.parent_id_field;a(d.data).each(function(){null!==this[f]&&"null"!==String(this[f]).toLowerCase()||b.push(this)})}}),b},getNodeDepth:function(b){var c=null;return this.each(function(){var d=this,e=d.p;if(d.grid&&e.treeGrid)switch(e.treeGridModel){case"nested":var g=e.treeReader.level_field;c=parseInt(b[g],10)-parseInt(e.tree_root_level,10);break;case"adjacency":c=f.getNodeAncestors.call(a(d),b).length}}),c},getNodeParent:function(b){var c=this[0];if(!c||!c.grid||null==c.p||!c.p.treeGrid||null==b)return null;var d=c.p,e=d.treeReader,f=e.parent_id_field,g=b[f];if("nested"===d.treeGridModel){var h=null,i=e.left_field,j=e.right_field,k=e.level_field,l=parseInt(b[i],10),m=parseInt(b[j],10),n=parseInt(b[k],10);return a(d.data).each(function(){if(parseInt(this[k],10)===n-1&&parseInt(this[i],10)<l&&parseInt(this[j],10)>m)return h=this,!1}),h}if(null===g||"null"===g)return null;var o=d._index[g];return void 0!==o?d.data[o]:null},getNodeChildren:function(b){var c=[];return this.each(function(){var d=this,e=d.p;if(d.grid&&e.treeGrid)switch(e.treeGridModel){case"nested":var f=e.treeReader.left_field,g=e.treeReader.right_field,h=e.treeReader.level_field,i=parseInt(b[f],10),j=parseInt(b[g],10),k=parseInt(b[h],10);a(e.data).each(function(){parseInt(this[h],10)===k+1&&parseInt(this[f],10)>i&&parseInt(this[g],10)<j&&c.push(this)});break;case"adjacency":var l=e.treeReader.parent_id_field,m=e.localReader.id;a(e.data).each(function(){String(this[l])===String(b[m])&&c.push(this)})}}),c},getFullTreeNode:function(b){var c=[];return this.each(function(){var d,e=this,f=e.p;if(e.grid&&f.treeGrid)switch(f.treeGridModel){case"nested":var g=f.treeReader.left_field,h=f.treeReader.right_field,i=f.treeReader.level_field,j=parseInt(b[g],10),k=parseInt(b[h],10),l=parseInt(b[i],10);a(f.data).each(function(){parseInt(this[i],10)>=l&&parseInt(this[g],10)>=j&&parseInt(this[g],10)<=k&&c.push(this)});break;case"adjacency":if(b){c.push(b);var m=f.treeReader.parent_id_field,n=f.localReader.id;a(f.data).each(function(){var a;for(d=c.length,a=0;a<d;a++)if(String(c[a][n])===String(this[m])){c.push(this);break}})}}}),c},getNodeAncestors:function(b){var c=[];return this.each(function(){var d=this,e=a(d),g=f.getNodeParent;if(d.grid&&d.p.treeGrid)for(var h=g.call(e,b);h;)c.push(h),h=g.call(e,h)}),c},isVisibleNode:function(b){var c=!0;return this.each(function(){var d=this,e=d.p;if(d.grid&&e.treeGrid){var g=f.getNodeAncestors.call(a(d),b),h=e.treeReader.expanded_field;a(g).each(function(){if(c=c&&this[h],!c)return!1})}}),c},isNodeLoaded:function(b){var c;return this.each(function(){var d=this,e=d.p;if(d.grid&&e.treeGrid){var g=e.treeReader.leaf_field,h=e.treeReader.loaded;c=void 0!==b&&(void 0!==b[h]?b[h]:!!(b[g]||f.getNodeChildren.call(a(d),b).length>0))}}),c},expandNode:function(b){return this.each(function(){var d=this,h=d.p;if(d.grid&&h.treeGrid){var i=h.treeReader.expanded_field,j=h.treeReader.parent_id_field,k=h.treeReader.loaded,l=h.treeReader.level_field,m=h.treeReader.left_field,n=h.treeReader.right_field;if(!b[i]){var o=c(b,h.localReader.id);if(!g.call(d,"beforeExpandNode",{rowid:o,item:b}))return;var p=a("#"+h.idPrefix+e(o),d.grid.bDiv)[0],q=h._index[o];"local"===h.treedatatype||f.isNodeLoaded.call(a(d),h.data[q])?(b[i]=!0,a("div.treeclick",p).removeClass(h.treeIcons.plus+" tree-plus").addClass(h.treeIcons.commonIconClass).addClass(h.treeIcons.minus+" tree-minus")):d.grid.hDiv.loading||(b[i]=!0,a("div.treeclick",p).removeClass(h.treeIcons.plus+" tree-plus").addClass(h.treeIcons.commonIconClass).addClass(h.treeIcons.minus+" tree-minus"),h.treeANode=p.rowIndex,h.datatype=h.treedatatype,f.setGridParam.call(a(d),{postData:"nested"===h.treeGridModel?{nodeid:o,n_level:b[l],n_left:b[m],n_right:b[n]}:{nodeid:o,n_level:b[l],parentid:b[j]}}),a(d).trigger("reloadGrid"),b[k]=!0,f.setGridParam.call(a(d),{postData:"nested"===h.treeGridModel?{nodeid:"",n_level:"",n_left:"",n_right:""}:{nodeid:"",n_level:"",parentid:""}})),g.call(d,"afterExpandNode",{rowid:o,item:b})}}})},collapseNode:function(b){return this.each(function(){var d=this,f=d.p;if(d.grid&&f.treeGrid){var h=f.treeReader.expanded_field;if(b[h]){var i=c(b,f.localReader.id);if(!g.call(d,"beforeCollapseNode",{rowid:i,item:b}))return;b[h]=!1,a("#"+f.idPrefix+e(i),d.grid.bDiv).find("div.treeclick").removeClass(f.treeIcons.minus+" tree-minus").addClass(f.treeIcons.commonIconClass).addClass(f.treeIcons.plus+" tree-plus"),(f.unloadNodeOnCollapse===!0||a.isFunction(f.unloadNodeOnCollapse)&&f.unloadNodeOnCollapse.call(d,b))&&(b[f.treeReader.loaded]=!1,a(d).jqGrid("delTreeNode",i,!0)),g.call(d,"afterCollapseNode",{rowid:i,item:b})}}})},SortTree:function(d,g,h,i){return this.each(function(){var j=this,k=j.p,l=a(j);if(j.grid&&k.treeGrid){var m,n,o,p=[],q=f.getRootNodes.call(l),r=b.from.call(j,q);r.orderBy(d,g,h,i);var s=r.select();for(m=0,n=s.length;m<n;m++)o=s[m],p.push(o),f.collectChildrenSortTree.call(l,p,o,d,g,h,i);a.each(p,function(b){var d=c(this,k.localReader.id);a(j.rows[b]).after(l.find(">tbody>tr#"+e(d)))})}})},collectChildrenSortTree:function(c,d,e,g,h,i){return this.each(function(){var j=this,k=a(j);if(j.grid&&j.p.treeGrid){var l,m,n,o=f.getNodeChildren.call(k,d),p=b.from.call(j,o);p.orderBy(e,g,h,i);var q=p.select();for(l=0,m=q.length;l<m;l++)n=q[l],c.push(n),f.collectChildrenSortTree.call(k,c,n,e,g,h,i)}})},setTreeRow:function(b,c){var d=!1;return this.each(function(){var e=this;e.grid&&e.p.treeGrid&&(d=f.setRowData.call(a(e),b,c))}),d},delTreeNode:function(c,d){return this.each(function(){var e,g,h,i,j,k=this,l=k.p,m=l.localReader.id,n=a(k),o=l.treeReader.left_field,p=l.treeReader.right_field;if(k.grid&&l.treeGrid){var q=l._index[c];if(void 0!==q){e=parseInt(l.data[q][p],10),g=e-parseInt(l.data[q][o],10)+1;var r=f.getFullTreeNode.call(n,l.data[q]);if(r.length>0)for(j=0;j<r.length;j++)d&&c===r[j][m]||f.delRowData.call(n,r[j][m]);if("nested"===l.treeGridModel){if(h=b.from.call(k,l.data).greater(o,e,{stype:"integer"}).select(),h.length)for(i in h)h.hasOwnProperty(i)&&(h[i][o]=parseInt(h[i][o],10)-g);if(h=b.from.call(k,l.data).greater(p,e,{stype:"integer"}).select(),h.length)for(i in h)h.hasOwnProperty(i)&&(h[i][p]=parseInt(h[i][p],10)-g)}}}})},addChildNode:function(c,d,e,g){return this.each(function(){if(e){var h,i,j,k,l,m,n,o=this,p=o.p,q=a(o),r=f.getInd,s=d,t=p.treeReader.expanded_field,u=p.treeReader.leaf_field,v=p.treeReader.level_field,w=p.treeReader.parent_id_field,x=p.treeReader.left_field,y=p.treeReader.right_field,z=p.treeReader.loaded;void 0===g&&(g=!1),null==c&&(c=b.randId());var A=r.call(q,d);if(m=!1,void 0===d||null===d||""===d)d=null,s=null,h="last",k=p.tree_root_level;else{h="after",i=p._index[d],j=p.data[i],d=j[p.localReader.id],l=r.call(q,d),k=parseInt(j[v],10)+1;var B=f.getFullTreeNode.call(q,j);if(B.length){var C,D,E;for(C=0;C<B.length;C++)E=B[C][p.localReader.id],D=r.call(q,E),D>l&&(l=D,s=E)}j[u]&&(m=!0,j[t]=!0,a(o.rows[A]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(p.treeIcons.leaf+" tree-leaf").addClass(p.treeIcons.commonIconClass).addClass(p.treeIcons.minus+" tree-minus"),p.data[i][u]=!1,j[z]=!0)}if(void 0===e[t]&&(e[t]=!1),void 0===e[z]&&(e[z]=!1),e[v]=k,void 0===e[u]&&(e[u]=!0),"adjacency"===p.treeGridModel&&(e[w]=d),"nested"===p.treeGridModel){var F,G,H;if(null!==d){if(n=parseInt(j[y],10),F=b.from.call(o,p.data),F=F.greaterOrEquals(y,n,{stype:"integer"}),G=F.select(),G.length)for(H in G)G.hasOwnProperty(H)&&(G[H][x]=G[H][x]>n?parseInt(G[H][x],10)+2:G[H][x],G[H][y]=G[H][y]>=n?parseInt(G[H][y],10)+2:G[H][y]);e[x]=n,e[y]=n+1}else{if(n=parseInt(f.getCol.call(q,y,!1,"max"),10),G=b.from.call(o,p.data).greater(x,n,{stype:"integer"}).select(),G.length)for(H in G)G.hasOwnProperty(H)&&(G[H][x]=parseInt(G[H][x],10)+2);if(G=b.from.call(o,p.data).greater(y,n,{stype:"integer"}).select(),G.length)for(H in G)G.hasOwnProperty(H)&&(G[H][y]=parseInt(G[H][y],10)+2);e[x]=n+1,e[y]=n+2}}(null===d||f.isNodeLoaded.call(q,j)||m)&&f.addRowData.call(q,c,e,h,s),j&&!j[t]&&g&&a(o.rows[A]).find("div.treeclick").click()}})}})});
//# sourceMappingURL=grid.treegrid.js.map