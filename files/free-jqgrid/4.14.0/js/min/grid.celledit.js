!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return b||(b=window),void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),require("./grid.base"),require("./jquery.fmatter"),require("./grid.common"),a(c,b),c}:a(jQuery)}(function(a){"use strict";var b=a.jgrid,c=function(){var c=a.makeArray(arguments);return c.unshift(""),c.unshift(""),c.unshift(this.p),b.feedback.apply(this,c)},d=function(b,c){var d=this,e=d.grid.fbRows;return a((null!=e&&e[0].cells.length>c?e[b.rowIndex]:b).cells[c])};b.extend({editCell:function(e,f,g){return this.each(function(){var h,i,j,k,l=this,m=a(l),n=l.p,o=l.rows;if(l.grid&&n.cellEdit===!0&&null!=o&&null!=o[e]&&(e=parseInt(e,10),f=parseInt(f,10),!isNaN(e)&&!isNaN(f))){var p,q=o[e],r=null!=q?q.id:null,s=a(q),t=parseInt(n.iCol,10),u=parseInt(n.iRow,10),v=a(o[u]),w=n.savedRow;if(null!=r){if(n.selrow=r,n.knv||m.jqGrid("GridNav"),w.length>0){if(g===!0&&e===u&&f===t)return;m.jqGrid("saveCell",w[0].id,w[0].ic)}else setTimeout(function(){a("#"+b.jqID(n.knv)).attr("tabindex","-1").focus()},1);if(k=n.colModel[f],h=k.name,"subgrid"!==h&&"cb"!==h&&"rn"!==h){j=d.call(l,q,f);var x=k.editable,y="cell";a.isFunction(x)&&(x=x.call(l,{rowid:r,iCol:f,iRow:e,cmName:h,cm:k,mode:y}));var z=m.jqGrid("getGuiStyles","states.select","edit-cell"),A=m.jqGrid("getGuiStyles","states.hover","selected-row");if(x!==!0||g!==!0||j.hasClass("not-editable-cell"))t>=0&&u>=0&&(d.call(l,v[0],t).removeClass(z),v.removeClass(A)),j.addClass(z),s.addClass(A),i=j.html().replace(/&#160;/gi,""),c.call(l,"onSelectCell",r,h,i,e,f);else{t>=0&&u>=0&&(d.call(l,v[0],t).removeClass(z),v.removeClass(A)),j.addClass(z),s.addClass(A),k.edittype||(k.edittype="text"),p=k.edittype;try{i=a.unformat.call(l,j,{rowId:r,colModel:k},f)}catch(a){i="textarea"===p?j.text():j.html()}if(n.autoEncodeOnEdit&&(i=b.oldDecodePostedData(i)),w.push({id:e,ic:f,name:h,v:i}),("&nbsp;"===i||"&#160;"===i||1===i.length&&160===i.charCodeAt(0))&&(i=""),a.isFunction(n.formatCell)){var B=n.formatCell.call(l,r,h,i,e,f);void 0!==B&&(i=B)}c.call(l,"beforeEditCell",r,h,i,e,f);var C=a.extend({},k.editoptions||{},{id:e+"_"+h,name:h,rowId:r,mode:y,cm:k,iCol:f}),D=b.createEl.call(l,p,C,i,!0,a.extend({},b.ajaxOptions,n.ajaxSelectOptions||{})),E=j,F=n.treeGrid===!0&&h===n.ExpandColumn;F&&(E=j.children("span.cell-wrapperleaf,span.cell-wrapper")),E.html("").append(D).attr("tabindex","0"),F&&a(D).width(j.width()-j.children("div.tree-wrap").outerWidth()),b.bindEv.call(l,D,C),setTimeout(function(){a(D).focus()},1),a("input, select, textarea",j).on("keydown",function(b){if(27===b.keyCode&&(a("input.hasDatepicker",j).length>0?a(".ui-datepicker").is(":hidden")?m.jqGrid("restoreCell",e,f):a("input.hasDatepicker",j).datepicker("hide"):m.jqGrid("restoreCell",e,f)),13===b.keyCode&&!b.shiftKey)return m.jqGrid("saveCell",e,f),!1;if(9===b.keyCode){if(l.grid.hDiv.loading)return!1;b.shiftKey?m.jqGrid("prevCell",e,f):m.jqGrid("nextCell",e,f)}b.stopPropagation()}),c.call(l,"afterEditCell",r,h,i,e,f)}n.iCol=f,n.iRow=e}}}})},saveCell:function(e,f){return this.each(function(){var g=this,h=a(g),i=g.p,j=g.grid,k=b.info_dialog,l=b.jqID;if(j&&i.cellEdit===!0){var m=h.jqGrid("getGridRes","errors"),n=m.errcap,o=h.jqGrid("getGridRes","edit"),p=o.bClose,q=i.savedRow,r=q.length>=1?0:null;if(null!==r){var s,t=g.rows[e],u=t.id,v=a(t),w=i.colModel[f],x=w.name,y=d.call(g,t,f),z={},A=b.getEditedValue.call(g,y,w,z);if(A!==q[r].v){s=h.triggerHandler("jqGridBeforeSaveCell",[u,x,A,e,f]),void 0!==s&&(A=s),a.isFunction(i.beforeSaveCell)&&(s=i.beforeSaveCell.call(g,u,x,A,e,f),void 0!==s&&(A=s));var B=b.checkValues.call(g,A,f,void 0,void 0,{oldValue:q[r].v,newValue:A,cmName:x,rowid:u,iCol:f,iRow:e,cm:w,tr:t,td:y,mode:"cell"}),C=w.formatoptions||{};if(null==B||B===!0||B[0]===!0){var D=h.triggerHandler("jqGridBeforeSubmitCell",[u,x,A,e,f])||{};if(a.isFunction(i.beforeSubmitCell)&&(D=i.beforeSubmitCell.call(g,u,x,A,e,f),D||(D={})),a("input.hasDatepicker",y).length>0&&a("input.hasDatepicker",y).datepicker("hide"),"date"===w.formatter&&C.sendFormatted!==!0&&(A=a.unformat.date.call(g,A,w)),"remote"===i.cellsubmit)if(i.cellurl){var E={};E[x]=A;var F=i.prmNames,G=F.id,H=F.oper;E[G]=b.stripPref(i.idPrefix,u),E[H]=F.editoper,E=a.extend(D,E),i.autoEncodeOnEdit&&a.each(E,function(c,d){a.isFunction(d)||(E[c]=b.oldEncodePostedData(d))}),h.jqGrid("progressBar",{method:"show",loadtype:i.loadui,htmlcontent:h.jqGrid("getGridRes","defaults.savetext")||"Saving..."}),j.hDiv.loading=!0,a.ajax(a.extend({url:a.isFunction(i.cellurl)?i.cellurl.call(g,i.cellurl,e,f,u,A,x):i.cellurl,data:b.serializeFeedback.call(g,i.serializeCellData,"jqGridSerializeCellData",E),type:"POST",complete:function(b){if(j.endReq.call(g),(b.status<300||304===b.status)&&(0!==b.status||4!==b.readyState)){var d=h.triggerHandler("jqGridAfterSubmitCell",[g,b,E.id,x,A,e,f])||[!0,""];(d===!0||d[0]===!0&&a.isFunction(i.afterSubmitCell))&&(d=i.afterSubmitCell.call(g,b,E.id,x,A,e,f)),null==d||d===!0||d[0]===!0?(h.jqGrid("setCell",u,f,A,!1,!1,!0),y.addClass("dirty-cell"),v.addClass("edited"),c.call(g,"afterSaveCell",u,x,A,e,f),q.splice(0,1)):(k.call(g,n,d[1],p),h.jqGrid("restoreCell",e,f))}},error:function(b,c,d){h.triggerHandler("jqGridErrorCell",[b,c,d]),a.isFunction(i.errorCell)?(i.errorCell.call(g,b,c,d),h.jqGrid("restoreCell",e,f)):(k.call(g,n,b.status+" : "+b.statusText+"<br/>"+c,p),h.jqGrid("restoreCell",e,f))}},b.ajaxOptions,i.ajaxCellOptions||{}))}else try{k.call(g,n,m.nourl,p),h.jqGrid("restoreCell",e,f)}catch(a){}"clientArray"===i.cellsubmit&&(h.jqGrid("setCell",u,f,"select"===w.edittype&&"select"!==w.formatter?z.text:A,!1,!1,!0),y.addClass("dirty-cell"),v.addClass("edited"),c.call(g,"afterSaveCell",u,x,A,e,f),q.splice(0,1))}else try{setTimeout(function(){var c=b.getRelativeRect.call(g,y);k.call(g,n,A+" "+B[1],p,{top:c.top,left:c.left+a(g).closest(".ui-jqgrid").offset().left})},50),h.jqGrid("restoreCell",e,f)}catch(a){}}else h.jqGrid("restoreCell",e,f)}setTimeout(function(){a("#"+l(i.knv)).attr("tabindex","-1").focus()},0)}})},restoreCell:function(b,e){return this.each(function(){var f,g,h,i=this,j=i.p,k=i.rows[b],l=k.id;if(i.grid&&j.cellEdit===!0){var m=j.savedRow,n=d.call(i,k,e);if(m.length>=1){if(a.isFunction(a.fn.datepicker))try{a("input.hasDatepicker",n).datepicker("hide")}catch(a){}g=j.colModel[e],j.treeGrid===!0&&g.name===j.ExpandColumn?n.children("span.cell-wrapperleaf,span.cell-wrapper").empty():n.empty(),n.attr("tabindex","-1"),f=m[0].v,h=g.formatoptions||{},"date"===g.formatter&&h.sendFormatted!==!0&&(f=a.unformat.date.call(i,f,g)),a(i).jqGrid("setCell",l,e,f,!1,!1,!0),c.call(i,"afterRestoreCell",l,f,b,e),m.splice(0,1)}setTimeout(function(){a("#"+j.knv).attr("tabindex","-1").focus()},0)}})},nextCell:function(b,c){return this.each(function(){var d,e,f,g=this,h=a(g),i=g.p,j=!1,k=g.rows;if(g.grid&&i.cellEdit===!0&&null!=k&&null!=k[b]){for(d=c+1;d<i.colModel.length;d++)if(f=i.colModel[d],e=f.editable,a.isFunction(e)&&(e=e.call(g,{rowid:k[b].id,iCol:d,iRow:b,cmName:f.name,cm:f,mode:"cell"})),e===!0){j=d;break}j!==!1?h.jqGrid("editCell",b,j,!0):i.savedRow.length>0&&h.jqGrid("saveCell",b,c)}})},prevCell:function(b,c){return this.each(function(){var d,e,f,g=this,h=a(g),i=g.p,j=!1,k=g.rows;if(g.grid&&i.cellEdit===!0&&null!=k&&null!=k[b]){for(d=c-1;d>=0;d--)if(f=i.colModel[d],e=f.editable,a.isFunction(e)&&(e=e.call(g,{rowid:k[b].id,iCol:d,iRow:b,cmName:f.name,cm:f,mode:"cell"})),e===!0){j=d;break}j!==!1?h.jqGrid("editCell",b,j,!0):i.savedRow.length>0&&h.jqGrid("saveCell",b,c)}})},GridNav:function(){return this.each(function(){function b(a,b,c){var d=f.rows[a];if("v"===c.substr(0,1)){var e=j.clientHeight,g=j.scrollTop,h=d.offsetTop+d.clientHeight,i=d.offsetTop;"vd"===c&&h>=e&&(j.scrollTop=j.scrollTop+d.clientHeight),"vu"===c&&i<g&&(j.scrollTop=j.scrollTop-d.clientHeight)}if("h"===c){var k=j.clientWidth,l=j.scrollLeft,m=d.cells[b],n=m.offsetLeft+m.clientWidth,o=m.offsetLeft;n>=k+parseInt(l,10)?j.scrollLeft=j.scrollLeft+m.clientWidth:o<l&&(j.scrollLeft=j.scrollLeft-m.clientWidth)}}function c(a,b){var c,d=0,e=h.colModel;if("lft"===b)for(d=a+1,c=a;c>=0;c--)if(e[c].hidden!==!0){d=c;break}if("rgt"===b)for(d=a-1,c=a;c<e.length;c++)if(e[c].hidden!==!0){d=c;break}return d}var d,e,f=this,g=a(f),h=f.p,i=f.grid;if(i&&h.cellEdit===!0){var j=i.bDiv;h.knv=h.id+"_kn";var k=a("<div style='position:fixed;top:0px;width:1px;height:1px;' tabindex='0'><div tabindex='-1' style='width:1px;height:1px;' id='"+h.knv+"'></div></div>");a(k).insertBefore(i.cDiv),a("#"+h.knv).focus().keydown(function(a){var i=parseInt(h.iRow,10),j=parseInt(h.iCol,10);switch(e=a.keyCode,"rtl"===h.direction&&(37===e?e=39:39===e&&(e=37)),e){case 38:i-1>0&&(b(i-1,j,"vu"),g.jqGrid("editCell",i-1,j,!1));break;case 40:i+1<=f.rows.length-1&&(b(i+1,j,"vd"),g.jqGrid("editCell",i+1,j,!1));break;case 37:j-1>=0&&(d=c(j-1,"lft"),b(i,d,"h"),g.jqGrid("editCell",i,d,!1));break;case 39:j+1<=h.colModel.length-1&&(d=c(j+1,"rgt"),b(i,d,"h"),g.jqGrid("editCell",i,d,!1));break;case 13:j>=0&&i>=0&&g.jqGrid("editCell",i,j,!0);break;default:return!0}return!1})}})},getChangedCells:function(c){var e=[];return c||(c="all"),this.each(function(){var f=this,g=f.p,h=b.htmlDecode,i=f.rows;f.grid&&g.cellEdit===!0&&a(i).each(function(b){var j={};if(a(this).hasClass("edited")){var k=this;a(this.cells).each(function(e){var l=g.colModel[e],m=l.name,n=d.call(f,k,e);if("cb"!==m&&"subgrid"!==m&&"rn"!==m&&("dirty"!==c||n.hasClass("dirty-cell")))try{j[m]=a.unformat.call(f,n[0],{rowId:i[b].id,colModel:l},e)}catch(a){j[m]=h(n.html())}}),j.id=this.id,e.push(j)}})}),e}})});
//# sourceMappingURL=grid.celledit.js.map