(function(c){"function"===typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],c):"object"===typeof exports?c(require("jquery")):c(jQuery)})(function(c){var n=c.jgrid,D=n.fullBoolFeedback,A=n.hasOneFromClasses,K=c.fn.jqGrid,F=function(c){return K.getGuiStyles.call(this,"states."+c)},G=function(d){var m=c.makeArray(arguments).slice(1);m.unshift("");m.unshift("Inline");m.unshift(d);return n.feedback.apply(this,m)};n.inlineEdit=n.inlineEdit||{};n.extend({editRow:function(d,
m,e,l,b,k,r,t,h,a){var f={},g=c.makeArray(arguments).slice(1);"object"===c.type(g[0])?f=g[0]:(void 0!==m&&(f.keys=m),c.isFunction(e)&&(f.oneditfunc=e),c.isFunction(l)&&(f.successfunc=l),void 0!==b&&(f.url=b),null!=k&&(f.extraparam=k),c.isFunction(r)&&(f.aftersavefunc=r),c.isFunction(t)&&(f.errorfunc=t),c.isFunction(h)&&(f.afterrestorefunc=h),c.isFunction(a)&&(f.beforeEditRow=a));return this.each(function(){var a=this,b=c(a),q=a.p,l=0,k=null,m={},e=q.colModel,h=q.prmNames;if(a.grid){var g=c.extend(!0,
{keys:!1,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeEditRow:null,mtype:"POST",focusField:!0},n.inlineEdit,q.inlineEditing||{},f),u=b.jqGrid("getInd",d,!0),r=g.focusField,t="object"===typeof r&&null!=r?c(r.target||r).closest("tr.jqgrow>td")[0]:null;if(!1!==u&&(g.extraparam[h.oper]===h.addoper||G.call(a,g,"beforeEditRow",g,d))&&"0"===(c(u).attr("editable")||"0")&&!c(u).hasClass("not-editable-row")){h=n.detectRowEditing.call(a,
d);if(null!=h&&"cellEditing"===h.mode){var h=h.savedRow,C=a.rows[h.id],z=F.call(a,"select");b.jqGrid("restoreCell",h.id,h.ic);c(C.cells[h.ic]).removeClass("edit-cell "+z);c(C).addClass(z).attr({"aria-selected":"true",tabindex:"0"})}n.enumEditableCells.call(a,u,c(u).hasClass("jqgrid-new-row")?"add":"edit",function(b){var f=b.cm,h=c(b.dataElement),e=b.dataWidth,g,r=f.name,t=f.edittype,u=b.iCol,v=f.editoptions||{};if("hidden"!==b.editable){try{g=c.unformat.call(this,b.td,{rowId:d,colModel:f},u)}catch(H){g=
"textarea"===t?h.text():h.html()}m[r]=g;h.html("");f=c.extend({},v,{id:d+"_"+r,name:r,rowId:d,mode:b.mode,cm:f,iCol:u});if("&nbsp;"===g||"&#160;"===g||1===g.length&&160===g.charCodeAt(0))g="";g=n.createEl.call(a,t,f,g,!0,c.extend({},n.ajaxOptions,q.ajaxSelectOptions||{}));c(g).addClass("editable");h.append(g);e&&c(g).width(b.dataWidth);n.bindEv.call(a,g,f);"select"===t&&!0===v.multiple&&void 0===v.dataUrl&&n.msie&&c(g).width(c(g).width());null===k&&(k=u);l++}});0<l&&(m.id=d,q.savedRow.push(m),c(u).attr("editable",
"1"),r&&("number"===typeof r&&parseInt(r,10)<=e.length?k=r:"string"===typeof r?k=q.iColByName[r]:null!=t&&(k=t.cellIndex),setTimeout(function(){var d=b.jqGrid("getNumberOfFrozenColumns"),f=function(c){return q.frozenColumns&&0<d&&k<d?a.grid.fbRows[u.rowIndex].cells[c]:u.cells[c]},h=function(a){return c(a).find("input,textarea,select,button,object,*[tabindex]").filter(":input:visible:not(:disabled)")},l=function(){return h(q.frozenColumns&&0<d?a.grid.fbRows[u.rowIndex]:u).first()},e=h(f(k));0<e.length?
e.first().focus():"number"===typeof g.defaultFocusField||"string"===typeof g.defaultFocusField?(e=h(f("number"===typeof g.defaultFocusField?g.defaultFocusField:q.iColByName[g.defaultFocusField])),0===e.length&&(e=l()),e.first().focus()):l().focus()},0)),!0===g.keys&&(e=c(u),q.frozenColumns&&(e=e.add(a.grid.fbRows[u.rowIndex])),e.bind("keydown",function(a){if(27===a.keyCode)return b.jqGrid("restoreRow",d,g.afterrestorefunc),!1;if(13===a.keyCode){if("TEXTAREA"===a.target.tagName)return!0;b.jqGrid("saveRow",
d,g);return!1}})),D.call(a,g.oneditfunc,"jqGridInlineEditRow",d,g))}}})},saveRow:function(d,m,e,l,b,k,r,t){var h=c.makeArray(arguments).slice(1),a={},f=this[0],g=c(f),p=null!=f?f.p:null,H=n.info_dialog;if(f.grid&&null!=p){"object"===c.type(h[0])?a=h[0]:(c.isFunction(m)&&(a.successfunc=m),void 0!==e&&(a.url=e),void 0!==l&&(a.extraparam=l),c.isFunction(b)&&(a.aftersavefunc=b),c.isFunction(k)&&(a.errorfunc=k),c.isFunction(r)&&(a.afterrestorefunc=r),c.isFunction(t)&&(a.beforeSaveRow=t));var h=function(a){return g.jqGrid("getGridRes",
a)},a=c.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeSaveRow:null,ajaxSaveOptions:{},serializeSaveData:null,mtype:"POST",saveui:"enable",savetext:h("defaults.savetext")||"Saving..."},n.inlineEdit,p.inlineEditing||{},a),q={},I={},x={},y,B,v,E;v=g.jqGrid("getInd",d,!0);var u=c(v);y=p.prmNames;var A=h("errors.errcap"),J=h("edit.bClose"),C;if(!1!==v&&(h=a.extraparam[y.oper]===y.addoper?"add":"edit",G.call(f,a,"beforeSaveRow",
a,d,h)&&(y=u.attr("editable"),a.url=a.url||p.editurl,C="clientArray"!==a.url,"1"===y)))if(n.enumEditableCells.call(f,v,u.hasClass("jqgrid-new-row")?"add":"edit",function(a){var b=a.cm,p=b.formatter,g=b.editoptions||{},h=b.formatoptions||{},e={},l=(c.jgrid.detectRowEditing.call(f,d)||{}).savedRow,k=n.getEditedValue.call(f,c(a.dataElement),b,e,a.editable);"select"===b.edittype&&"select"!==b.formatter&&(I[b.name]=e.text);E=n.checkValues.call(f,k,a.iCol,void 0,void 0,c.extend(a,{oldValue:null!=l?l[b.name]:
null,newValue:k,oldRowData:l}));if(!1===E[0])return!1;"date"===p&&!0!==h.sendFormatted&&(k=c.unformat.date.call(f,k,b));C&&!0===g.NullIfEmpty&&""===k&&(k="null");q[b.name]=k}),!1===E[0])try{var z=g.jqGrid("getGridRowById",d),w=n.findPos(z);H.call(f,A,E[1],J,{left:w[0],top:w[1]+c(z).outerHeight()})}catch(L){alert(E[1])}else if(z=d,y=p.prmNames,w=!1===p.keyName?y.id:p.keyName,q&&(q[y.oper]=y.editoper,void 0===q[w]||""===q[w]?q[w]=d:v.id!==p.idPrefix+q[w]&&(v=n.stripPref(p.idPrefix,d),void 0!==p._index[v]&&
(p._index[q[w]]=p._index[v],delete p._index[v]),d=p.idPrefix+q[w],u.attr("id",d),p.selrow===z&&(p.selrow=d),c.isArray(p.selarrrow)&&(v=c.inArray(z,p.selarrrow),0<=v&&(p.selarrrow[v]=d)),p.multiselect&&(v="jqg_"+p.id+"_"+d,u.find("input.cbox").attr("id",v).attr("name",v))),q=c.extend({},q,p.inlineData||{},a.extraparam)),C)g.jqGrid("progressBar",{method:"show",loadtype:a.saveui,htmlcontent:a.savetext}),x=c.extend({},q,x),x[w]=n.stripPref(p.idPrefix,x[w]),p.autoEncodeOnEdit&&c.each(x,function(a,b){c.isFunction(b)||
(x[a]=n.oldEncodePostedData(b))}),c.ajax(c.extend({url:c.isFunction(a.url)?a.url.call(f,x[w],h,x,a):a.url,data:n.serializeFeedback.call(f,c.isFunction(a.serializeSaveData)?a.serializeSaveData:p.serializeRowData,"jqGridInlineSerializeSaveData",x),type:c.isFunction(a.mtype)?a.mtype.call(f,h,a,x[w],x):a.mtype,complete:function(b,h){g.jqGrid("progressBar",{method:"hide",loadtype:a.saveui,htmlcontent:a.savetext});if((300>b.status||304===b.status)&&(0!==b.status||4!==b.readyState)){var k,e;e=g.triggerHandler("jqGridInlineSuccessSaveRow",
[b,d,a]);c.isArray(e)||(e=[!0,q]);e[0]&&c.isFunction(a.successfunc)&&(e=a.successfunc.call(f,b));c.isArray(e)?(k=e[0],q=e[1]||q):k=e;if(!0===k){p.autoEncodeOnEdit&&c.each(q,function(a,b){q[a]=n.oldDecodePostedData(b)});q=c.extend({},q,I);g.jqGrid("setRowData",d,q);u.attr("editable","0");for(k=0;k<p.savedRow.length;k++)if(String(p.savedRow[k].id)===String(d)){B=k;break}0<=B&&p.savedRow.splice(B,1);D.call(f,a.aftersavefunc,"jqGridInlineAfterSaveRow",d,b,q,a);u.removeClass("jqgrid-new-row").unbind("keydown")}else D.call(f,
a.errorfunc,"jqGridInlineErrorSaveRow",d,b,h,null,a),!0===a.restoreAfterError&&g.jqGrid("restoreRow",d,a.afterrestorefunc)}},error:function(b,e,k){c("#lui_"+n.jqID(p.id)).hide();g.triggerHandler("jqGridInlineErrorSaveRow",[d,b,e,k,a]);if(c.isFunction(a.errorfunc))a.errorfunc.call(f,d,b,e,k);else{b=b.responseText||b.statusText;try{H.call(f,A,'<div class="'+F.call(f,"error")+'">'+b+"</div>",J,{buttonalign:"right"})}catch(h){alert(b)}}!0===a.restoreAfterError&&g.jqGrid("restoreRow",d,a.afterrestorefunc)}},
n.ajaxOptions,p.ajaxRowOptions,a.ajaxSaveOptions||{}));else{q=c.extend({},q,I);v=g.jqGrid("setRowData",d,q);u.attr("editable","0");for(h=0;h<p.savedRow.length;h++)if(String(p.savedRow[h].id)===String(z)){B=h;break}0<=B&&p.savedRow.splice(B,1);D.call(f,a.aftersavefunc,"jqGridInlineAfterSaveRow",d,v,q,a);u.removeClass("jqgrid-new-row").unbind("keydown")}}},restoreRow:function(d,m){var e=c.makeArray(arguments).slice(1),l={};"object"===c.type(e[0])?l=e[0]:c.isFunction(m)&&(l.afterrestorefunc=m);return this.each(function(){var b=
this,e=c(b),m=b.p,t=-1,h={},a;if(b.grid){var f=c.extend(!0,{},n.inlineEdit,m.inlineEditing||{},l),g=e.jqGrid("getInd",d,!0);if(!1!==g&&G.call(b,f,"beforeCancelRow",f,d)){for(a=0;a<m.savedRow.length;a++)if(String(m.savedRow[a].id)===String(d)){t=a;break}if(0<=t){if(c.isFunction(c.fn.datepicker))try{c("input.hasDatepicker","#"+n.jqID(g.id)).datepicker("hide")}catch(p){}c.each(m.colModel,function(){var a=this.name;m.savedRow[t].hasOwnProperty(a)&&(h[a]=m.savedRow[t][a],!this.formatter||"date"!==this.formatter||
null!=this.formatoptions&&!0===this.formatoptions.sendFormatted||(h[a]=c.unformat.date.call(b,h[a],this)))});e.jqGrid("setRowData",d,h);c(g).attr("editable","0").unbind("keydown");m.savedRow.splice(t,1);c("#"+n.jqID(d),b).hasClass("jqgrid-new-row")&&setTimeout(function(){e.jqGrid("delRowData",d);e.jqGrid("showAddEditButtons",!1)},0)}D.call(b,f.afterrestorefunc,"jqGridInlineAfterRestoreRow",d)}}})},addRow:function(d){return this.each(function(){if(this.grid){var m=this,e=c(m),l=m.p,b=c.extend(!0,{rowID:null,
initdata:{},position:"first",useDefValues:!0,useFormatter:!1,beforeAddRow:null,addRowParams:{extraparam:{}}},n.inlineEdit,l.inlineEditing||{},d||{});G.call(m,b,"beforeAddRow",b.addRowParams)&&(b.rowID=c.isFunction(b.rowID)?b.rowID.call(m,b):null!=b.rowID?b.rowID:n.randId(),!0===b.useDefValues&&c(l.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var d=this.editoptions.defaultValue;b.initdata[this.name]=c.isFunction(d)?d.call(m):d}}),b.rowID=l.idPrefix+b.rowID,e.jqGrid("addRowData",
b.rowID,b.initdata,b.position),c("#"+n.jqID(b.rowID),m).addClass("jqgrid-new-row"),b.useFormatter?c("#"+n.jqID(b.rowID)+" .ui-inline-edit",m).click():(l=l.prmNames,b.addRowParams.extraparam[l.oper]=l.addoper,e.jqGrid("editRow",b.rowID,b.addRowParams),e.jqGrid("setSelection",b.rowID)))}})},inlineNav:function(d,m){"object"===typeof d&&(m=d,d=void 0);return this.each(function(){var e=this,l=c(e),b=e.p;if(this.grid&&null!=b){var k,r=d===b.toppager?b.idSel+"_top":b.idSel,t=d===b.toppager?b.id+"_top":b.id,
h=F.call(e,"disabled"),a=c.extend(!0,{edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",save:!0,saveicon:"ui-icon-disk",cancel:!0,cancelicon:"ui-icon-cancel",commonIconClass:"ui-icon",iconsOverText:!1,addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:!0},l.jqGrid("getGridRes","nav"),n.nav||{},b.navOptions||{},n.inlineNav||{},b.inlineNavOptions||{},m||{});if(void 0===d)if(b.pager)if(l.jqGrid("inlineNav",b.pager,a),b.toppager)d=b.toppager,r=b.idSel+"_top",t=b.id+
"_top";else return;else b.toppager&&(d=b.toppager,r=b.idSel+"_top",t=b.id+"_top");if(void 0!==d&&(k=c(d),!(0>=k.length))){0>=k.find(".navtable").length&&l.jqGrid("navGrid",d,{add:!1,edit:!1,del:!1,search:!1,refresh:!1,view:!1});b._inlinenav=!0;if(!0===a.addParams.useFormatter){k=b.colModel;var f,g;for(f=0;f<k.length;f++)if(k[f].formatter&&"actions"===k[f].formatter){k[f].formatoptions&&(g={keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},k=c.extend(g,
k[f].formatoptions),a.addParams.addRowParams={keys:k.keys,oneditfunc:k.onEdit,successfunc:k.onSuccess,url:k.url,extraparam:k.extraparam,aftersavefunc:k.afterSave,errorfunc:k.onError,afterrestorefunc:k.afterRestore});break}}a.add&&l.jqGrid("navButtonAdd",d,{caption:a.addtext,title:a.addtitle,commonIconClass:a.commonIconClass,buttonicon:a.addicon,iconsOverText:a.iconsOverText,id:t+"_iladd",onClickButton:function(){A(this,h)||l.jqGrid("addRow",a.addParams)}});a.edit&&l.jqGrid("navButtonAdd",d,{caption:a.edittext,
title:a.edittitle,commonIconClass:a.commonIconClass,buttonicon:a.editicon,iconsOverText:a.iconsOverText,id:t+"_iledit",onClickButton:function(){if(!A(this,h)){var c=b.selrow;c?l.jqGrid("editRow",c,a.editParams):e.modalAlert()}}});a.save&&(l.jqGrid("navButtonAdd",d,{caption:a.savetext,title:a.savetitle,commonIconClass:a.commonIconClass,buttonicon:a.saveicon,iconsOverText:a.iconsOverText,id:t+"_ilsave",onClickButton:function(){if(!A(this,h)){var d=b.savedRow[0].id;if(d){var f=b.prmNames,g=f.oper,k=
a.editParams;c("#"+n.jqID(d),e).hasClass("jqgrid-new-row")?(a.addParams.addRowParams.extraparam[g]=f.addoper,k=a.addParams.addRowParams):(a.editParams.extraparam||(a.editParams.extraparam={}),a.editParams.extraparam[g]=f.editoper);l.jqGrid("saveRow",d,k)}else e.modalAlert()}}}),c(r+"_ilsave").addClass(h));a.cancel&&(l.jqGrid("navButtonAdd",d,{caption:a.canceltext,title:a.canceltitle,commonIconClass:a.commonIconClass,buttonicon:a.cancelicon,iconsOverText:a.iconsOverText,id:t+"_ilcancel",onClickButton:function(){if(!A(this,
h)){var d=b.savedRow[0].id,f=a.editParams;d?(c("#"+n.jqID(d),e).hasClass("jqgrid-new-row")&&(f=a.addParams.addRowParams),l.jqGrid("restoreRow",d,f)):e.modalAlert()}}}),c(r+"_ilcancel").addClass(h));!0===a.restoreAfterSelect&&l.bind("jqGridSelectRow",function(c,d){if(0<b.savedRow.length&&!0===b._inlinenav){var e=b.savedRow[0].id;d!==e&&"number"!==typeof e&&l.jqGrid("restoreRow",e,a.editParams)}});l.bind("jqGridInlineAfterRestoreRow jqGridInlineAfterSaveRow",function(){l.jqGrid("showAddEditButtons",
!1)});l.bind("jqGridInlineEditRow",function(a,b){l.jqGrid("showAddEditButtons",!0,b)})}}})},showAddEditButtons:function(d){return this.each(function(){if(this.grid){var m=this.p,e=m.idSel,l=F.call(this,"disabled"),b=e+"_ilsave,"+e+"_ilcancel"+(m.toppager?","+e+"_top_ilsave,"+e+"_top_ilcancel":""),m=e+"_iladd,"+e+"_iledit"+(m.toppager?","+e+"_top_iladd,"+e+"_top_iledit":"");c(d?m:b).addClass(l);c(d?b:m).removeClass(l)}})}})});
//# sourceMappingURL=grid.inlinedit.map
