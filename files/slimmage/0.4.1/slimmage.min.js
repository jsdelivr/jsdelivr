/*
 Slimmage 0.4.1, use with ImageResizer. MIT/Apache2 dual licensed by Imazen 
*/
'use strict';(function(f){function p(){if(a.verbose&&f.console&&f.console.log)try{f.console.log.apply(f.console,arguments)}catch(c){}}var a=window.slimmage||{};window.slimmage=a;void 0===a.verbose&&(a.verbose=!1);void 0===a.tryWebP&&(a.tryWebP=!1);void 0===a.maxWidth&&(a.maxWidth=2048);void 0===a.widthStep&&(a.widthStep=160);void 0===a.jpegQuality&&(a.jpegQuality=90);void 0===a.jpegRetinaQuality&&(a.jpegRetinaQuality=80);void 0===a.webpTimeout&&(a.webpTimeout=0);a.changed=[];a.j=function(){if(a.tryWebP&&
!a.c){a.c=!0;var c=new Image;c.onload=c.onerror=function(){a.webp=2==c.height;a.c=!1;a.a&&a.a()};c.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}};a.j();a.b=function(a,e,b){e=e.toLowerCase();"class"==e?a.className=b:"tabindex"==e?a.tabIndex=b:"usemap"==e?a.useMap=b:a.setAttribute(e,b)};a.setAttribute=a.b;a.f=function(a){return"none"===a||null===a||void 0===a||""===a||!1===a};a.getCssValue=function(c,e){var b="undefined"!=typeof window.getComputedStyle&&
window.getComputedStyle(c,null).getPropertyValue(e);if(!a.f(b))return b;c.currentStyle&&(b=c.currentStyle[e.replace(/([a-z])\-([a-z])/,function(a,c,b){return c+b.toUpperCase()})]||c.currentStyle[e]);return a.f(b)?null:b};a.getCssPixels=function(c,e){var b=a.getCssValue(c,e);if(null===b||"0"===b||0===b)return b;if("px"==b.slice(-2))return parseFloat(b.slice(0,-2));var d=document.createElement("div");d.style.overflow=d.style.visibility="hidden";d.style.cssFloat="none";c.parentNode.appendChild(d);d.style.width=
b;b=d.offsetWidth;c.parentNode.removeChild(d);return b};a.g=function(a){for(var e=[],b=a.length>>>0;b--;)e[b]=a[b];return e};a.mutateUrl=function(a,e,b,d){a=/^([^?#]*)?(\?([^#]*))?(#.*)?/.exec(a);var l=a[3]||"",f=/(^&*|&+)([^&=]*)=?([^&]*)/g;l.replace(f,e);e="?"+l.replace(f,b).replace(/(?:^\?*&*)|(?:[?&]+$)/g,"").replace(/&&+/g,"&");return(a[1]||"")+d(e)+(a[4]||"")};a.getImageInfo=function(c,e,b,d){var f={webp:a.webp,width:c,dpr:window.devicePixelRatio||1,src:e,element:d};d=a.webp?65:a.jpegRetinaQuality;
var m=a.webp?78:a.jpegQuality;f.quality=1.49<f.dpr?d:m;f.requestedWidth=Math.min(a.maxWidth,Math.round(Math.ceil(c*f.dpr/a.widthStep)*a.widthStep));(c=a.adjustImageParameters)&&"function"===typeof c&&c(f);var n=f.requestedWidth;if(n>b){var g={},h={};return{src:a.mutateUrl(e,function(a,b,c,d){g[c.toLowerCase()]=d},function(a,b,c){void 0===h.zoom&&(h.zoom=parseFloat(g.zoom||1),isNaN(h.zoom)&&(h.zoom=1),h.i=(n/h.zoom).toFixed());if(void 0===h.h){var d=parseFloat(g.width||g.i||g.n),e=parseFloat(g.height||
g.e||g.m);!isNaN(d)&&!isNaN(e)&&0<d&&0<e?(h.h=d/e,h.e=(n/h.zoom/d*e).toFixed()):h.h="noclue"}return c.match(/^format$/i)&&f.webp?b+"format=webp":c.match(/^quality/i)?b+"quality="+f.quality:c.match(/^w|width|maxwidth$/i)?b+c+"="+h.i:c.match(/^h|height|maxheight$/i)?b+c+"="+h.e:a},function(a){return a}),"data-pixel-width":n}}return null};a.adjustImageSrc=function(c,e){var b=a.getCssPixels(c,"max-width"),d=a.getImageInfo(b,e,c.getAttribute("data-pixel-width")|0,c);d?(c.src=d.src,a.b(c,"data-pixel-width",
d["data-pixel-width"]),a.enforceCss&&(b<d["data-pixel-width"]?(c.style.width=a.getCssValue(c,"max-width"),a.b(c,"data-width-enforced",!0)):c.style.width="auto"),a.changed.push(c),p("Slimming: updating "+d.src)):a.enforceCss&&c.getAttribute("data-width-enforced")&&(d=parseFloat(c.getAttribute("data-pixel-width")),!isNaN(d)&&b>=d&&(c.style.width="auto",c.removeAttribute("data-width-enforced")))};a.a=function(c){var e,b,d,l,m;0<a.d&&f.clearTimeout(a.d);a.d=0;a.c&&0<a.webpTimeout&&!a.l&&(a.l=!0,c=a.webpTimeout);
if(c&&0<c)a.d=f.setTimeout(a.a,c);else{c=(new Date).getTime();var n=0;m=a.g(f.document.getElementsByTagName("noscript"));e=0;for(b=m.length;e<b;e++){var g=m[e];if(null!==g.getAttribute("data-slimmage")){d=f.document.createElement("div");if((l=g.textContent||g.innerHTML)&&0!==l.replace(/[\s\t\r\n]+/,"").length)d.innerHTML=l.replace(/\s+src\s*=\s*(['"])/i," data-src=$1").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");else{l=new Image;for(var h=0;h<g.attributes.length;h++){var k=g.attributes[h];
k&&k.specified&&0===k.name.indexOf("data-img-")&&a.b(l,k.name.slice(9-k.name.length),k.value)}d.appendChild(l)}h=d.getElementsByTagName("img");d=0;for(l=h.length;d<l;d++)k=h[d],null!==k.src&&0<k.src.length&&(a.b(k,"data-src",k.src),k.src=""),a.b(k,"data-slimmage",!0),g.parentNode.insertBefore(k,g),n++;g.parentNode.removeChild(g)}}"function"===typeof a.beforeAdjustSrc&&a.beforeAdjustSrc();e=0;g=a.g(f.document.getElementsByTagName("img"));b=0;for(m=g.length;b<m;b++)null!==g[b].getAttribute("data-slimmage")&&
(d=g[b].getAttribute("data-src")||g[b].src,a.adjustImageSrc(g[b],d),e++);b=a.changed.slice();a.changed.length=0;(0<b.length||!a.k)&&"function"===typeof a.readyCallback&&(a.readyCallback(b),a.k=!0);p("Slimmage: restored "+n+" images from noscript tags, checked "+e+" images, changed "+b.length+". "+((new Date).getTime()-c)+"ms")}};a.checkResponsiveImages=a.a;f.addEventListener?(f.addEventListener("resize",function(){a.a(500)},!1),f.addEventListener("DOMContentLoaded",function(){a.a();f.removeEventListener("load",
a.a,!1)},!1),f.addEventListener("load",a.a,!1)):f.attachEvent&&(f.attachEvent("onload",a.a),f.attachEvent("onresize",function(){a.a(500)}))})(this);