/*
Project: angular-gantt v1.3.1 - Gantt chart component for AngularJS
Authors: Marco Schweighauser, RÃ©mi Alvergnat
License: MIT
Homepage: https://www.angular-gantt.com
Github: https://github.com/angular-gantt/angular-gantt.git
*/

!function(){"use strict";angular.module("gantt.sections",["gantt","gantt.sections.templates"]).directive("ganttSections",["moment","$compile","$document",function(a,b,c){return{restrict:"E",require:"^gantt",scope:{enabled:"=?",keepProportions:"=?",disableMagnet:"=?",disableDaily:"=?"},link:function(a,d,e,f){var g=f.gantt.api;if(a.options&&"object"==typeof a.options.sections)for(var h in a.options.sections)a[h]=a.options.sections[h];void 0===a.enabled&&(a.enabled=!0),void 0===a.keepProportions&&(a.keepProportions=!0),g.directives.on.new(a,function(d,f,g){if("ganttTaskForeground"===d){var h=f.$new();h.pluginScope=a,h.task=f.task;var i=c[0].createElement("div");angular.element(i).attr("data-ng-if","task.model.sections !== undefined && pluginScope.enabled"),angular.element(i).attr("class","gantt-task-foreground-sections");var j=c[0].createElement("gantt-task-sections");void 0!==e.templateUrl&&angular.element(j).attr("data-template-url",e.templateUrl),void 0!==e.template&&angular.element(j).attr("data-template",e.template),angular.element(i).append(j),g.append(b(i)(h))}})}}}])}(),function(){"use strict";angular.module("gantt.sections").directive("ganttTaskSection",["$templateCache",function(a){return{restrict:"E",requires:"^ganttTaskSections",templateUrl:function(b,c){var d;return d=void 0===c.templateUrl?"plugins/sections/taskSection.tmpl.html":c.templateUrl,void 0!==c.template&&a.put(d,c.template),d},replace:!0,scope:{section:"=",task:"=",index:"=",options:"=?"},controller:["$scope","$element","ganttUtils","moment",function(a,b,c,d){var e=d(a.section.from).isSame(d(a.task.model.from)),f=d(a.section.to).isSame(d(a.task.model.to)),g=function(){if(a.task._movingTaskSections){var b=a.task._movingTaskSections,c=b["$$index_"+a.index];a.section=c.section,a.sectionCss=c.sectionCss,e=c.fromTask,f=c.toTask,delete b["$$index_"+a.index]}var d=!0;for(var g in a.task._movingTaskSections)if(a.task._movingTaskSections.hasOwnProperty(g)){d=!1;break}d&&delete a.task._movingTaskSections};g();var h=function(){if(e)return 0;var b,f=a.task.rowsManager.gantt,g=a.task.left,h=c.firstProperty([a.section,a.options],"disableMagnet",a.$parent.pluginScope.disableMagnet);b=h?a.section.from:f.getMagnetDate(a.section.from);var i=c.firstProperty([a.section,a.options],"disableDaily",a.$parent.pluginScope.disableDaily);!i&&f.options.value("daily")&&(b=d(b).startOf("day"));var j=f.getPositionByDate(b);return j-g},i=function(){var b=c.firstProperty([a.section,a.options],"keepProportions",a.$parent.pluginScope.keepProportions);if(f&&b)return a.task.width;var e=a.task.rowsManager.gantt,g=a.task.left,h=c.firstProperty([a.section,a.options],"disableMagnet",a.$parent.pluginScope.disableMagnet),i=h?a.section.to:e.getMagnetDate(a.section.to),j=c.firstProperty([a.section,a.options],"disableDaily",a.$parent.pluginScope.disableDaily);!j&&e.options.value("daily")&&(i=d(i).startOf("day"));var k=e.getPositionByDate(i);return k-g},j=function(b){return b/a.task.width*100},k=function(){var b=h(),d=i()-b,e=c.firstProperty([a.section,a.options],"keepProportions",a.$parent.pluginScope.keepProportions);e?(a.sectionCss.left=j(b)+"%",a.sectionCss.width=j(d)+"%"):(a.sectionCss.left=b+"px",a.sectionCss.width=d+"px")},l=function(){a.section.color?a.sectionCss["background-color"]=a.section.color:a.sectionCss["background-color"]=void 0};void 0===a.sectionCss&&(a.sectionCss={},k(),l());var m=function(d){if(d===a.task){var g,h=a.task.rowsManager.gantt,i=b[0].offsetLeft,j=c.firstProperty([a.section,a.options],"disableMagnet",a.$parent.pluginScope.disableMagnet);g=e?a.task.model.from:h.getDateByPosition(a.task.modelLeft+i,!j);var l;if(f)l=a.task.model.to;else{var m=i+b[0].offsetWidth;l=h.getDateByPosition(a.task.modelLeft+m,!j)}a.section.from=g,a.section.to=l,k()}},n=function(b){if(b.id===a.task.model.id){var c=a.section;void 0===c.from||d.isMoment(c.from)||(c.from=d(c.from)),void 0===c.to||d.isMoment(c.to)||(c.to=d(c.to))}};n(a.task.model),a.task.rowsManager.gantt.api.tasks.on.clean(a,n),a.task.rowsManager.gantt.api.tasks.on.change(a,m);var o=function(b){var c=b._movingTaskSections;c||(c={},b._movingTaskSections=c),c["$$index_"+a.index]={section:a.section,sectionCss:a.sectionCss,fromTask:e,toTask:f}};a.task.rowsManager.gantt.api.tasks.on.beforeViewRowChange(a,o),a.task.rowsManager.gantt.api.directives.raise.new("ganttTaskSection",a,b),a.$on("$destroy",function(){a.task.rowsManager.gantt.api.directives.raise.destroy("ganttTaskSection",a,b)})}]}}])}(),function(){"use strict";angular.module("gantt.sections").directive("ganttTaskSections",["$templateCache",function(a){return{restrict:"E",requires:"^ganttTask",templateUrl:function(b,c){var d;return d=void 0===c.templateUrl?"plugins/sections/taskSections.tmpl.html":c.templateUrl,void 0!==c.template&&a.put(d,c.template),d},replace:!0,scope:!0,controller:["$scope","$element",function(a,b){a.task.rowsManager.gantt.api.directives.raise.new("ganttTaskSections",a,b),a.$on("$destroy",function(){a.task.rowsManager.gantt.api.directives.raise.destroy("ganttTaskSections",a,b)})}]}}])}(),angular.module("gantt.sections.templates",[]).run(["$templateCache",function(a){a.put("plugins/sections/taskSection.tmpl.html",'<div ng-style="sectionCss"\n     ng-class="section.classes"\n     class="gantt-task-section"></div>\n'),a.put("plugins/sections/taskSections.tmpl.html",'<div ng-cloak class="gantt-task-sections">\n    <gantt-task-section section="section"\n                        task="task"\n                        options="task.model.sections"\n                        index="$index"\n                        ng-repeat="section in task.model.sections.items track by $index">\n    </gantt-task-section>\n</div>\n')}]);
//# sourceMappingURL=angular-gantt-sections-plugin.min.js.map