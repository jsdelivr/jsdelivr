/* @license MIT LICENSE https://github.com/grenouille220/jquery-musketeer/blob/master/LICENSE */
!function(t,n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?module.exports=n(require("jquery")):t.musketeer=n(t.jQuery)}(this,function($){function t(t){this.init()}function n(t){var n=t.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0];return $("<head />").html($.parseHTML(n,document,!0))}function e(t){var n=t.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0];return $("<div />").html($.parseHTML(n,document,!0))}return $.parseJSON||($.parseJSON=function(t){var n;try{n=JSON.parse(t)}catch(t){window.console&&window.console.log&&window.console.log(t),n=null}return n}),t.defaults={debug:"0",i18n:{},barbajs:{head:["meta[name='keywords']","meta[name='description']","meta[property^='og']","meta[name^='twitter']","meta[itemprop]","link[itemprop]","link[rel='prev']","link[rel='next']","link[rel='canonical']","script[ lang ]"].join(",")}},t.prototype.log=function(){},t.prototype.init=function(){var t=this;$(document).ready(function(){var n=$("#musketeer-options");n.length?t.options=$.extend(!0,t.constructor.defaults,$.parseJSON(n.html())):t.options?t.options=$.extend(!0,t.constructor.defaults,t.options):t.options=t.constructor.defaults,t.options.debug=parseInt(t.options.debug||0,10),!isNaN(t.options.debug)&&t.options.debug>0&&(t.log=function(t,n){1===arguments.length?window.console&&window.console.log&&window.console.log("jQuery Musketeer: "+arguments[0]):window.console&&window.console[t]&&window.console[t]("jQuery Musketeer: "+n)}),t.lang=$.jStorage.get("lang",t.options.i18n.base),t.getRemoteData(function(){t.i18n()}),t.pjaxify()})},t.prototype.url2path=function(t){var n=(t||"").replace([window.location.protocol,"//",window.location.host].join(""),"");return n=n.replace(/\?.*/,""),n=n.replace(/#.*/,"")},t.prototype.urlfaker=function(t){var n=this;n.log("info","urlfaker("+(t||"")+")");var e=window.location.protocol,a=window.location.host,o=window.location.pathname,i=window.location.search,r=window.location.hash;return t?(o=n.url2path(t),i=/\?/.test(t)?"?"+t.split("?")[1].split("#")[0]:"",r=/#/.test(t)?"#"+t.split("#")[1]:""):t=document.location.href,$.each(n.options.i18n.langs,function(){o=o.replace(new RegExp("^/"+this.toString()+"/"),"/")}),/lang/.test(i||"")&&(i=i.replace(/lang\=[a-zA-Z-_]+/,""),i.length<2&&(i="")),$.inArray((r||"").replace("#",""),n.options.i18n.langs)>-1&&(r=""),n.lang!==n.options.i18n.base&&(a+="/"+n.lang),t=[window.location.protocol,"//",a,o,i,r].join(""),n.log("The following url was generated:"+t),t},t.prototype.urlunfaker=function(){var t=this;t.log("info","urlunfaker()");var n=window.location.protocol,e=window.location.host,a=window.location.pathname,o=window.location.search,i=window.location.hash,r="";return $.each(t.options.i18n.langs,function(){var t=this.toString(),n=new RegExp("^/"+t+"/");if(n.test(a))return a=a.replace(n,"/"),o.length?o+="&lang="+t:o="?lang="+t,!0}),r=[n,"//",e,a,o,i].join(""),t.log("The following url was generated:"+r),r},t.prototype.triggerLang=function(t){$(this.options.i18n.menu).find("a[ lang='"+t+"' ],a[ hreflang='"+t+"' ]").trigger("click")},t.prototype.pjaxify=function(){var t=this,e=document.documentElement||{};if(!window.Barba||!this.options.barbajs)return!1;Barba.Pjax.cacheEnabled=!1;var a="";Barba.Pjax.getCurrentUrl=function(){return a},Barba.Pjax.goTo=function(n){t.log("info","Barbar.Pjax.goTo("+n+")"),a=n,Barba.Pjax.onStateChange(),window.history.pushState(null,null,t.urlfaker(n))};var o=!1;Barba.Dispatcher.on("linkClicked",function(t,n){o=!0}),Barba.Pjax.originalOnStateChange=Barba.Pjax.onStateChange,Barba.Pjax.onStateChange=function(){if(o)return Barba.Pjax.originalOnStateChange.call(this),void(o=!1);t.log("warn","URL requested from browser back / next buttons");var n=window.location.pathname.replace(/index\.\w+$/,""),e=t.url2path(a).replace(/index\.\w+$/,""),i=0;if(n===e)return t.triggerLang(t.options.i18n.base);$.each(t.options.i18n.langs,function(){var a=new RegExp("^/"+this.toString()+"/");if(a.test(n)&&new RegExp(n.replace(a,"/"))===e)return i=1,t.triggerLang(this.toString()),!1}),i>0||(Barba.Dispatcher.trigger("linkClicked"),a=t.urlunfaker(),Barba.Pjax.onStateChange())},Barba.Pjax.start(),Barba.Dispatcher.on("newPageReady",function(a,o,i,r){var l=n(r),s=t.options.barbajs.head;$("head").find(s).remove(),l.find(s).appendTo("head");var c=e.lang||"en";t.getRemoteData(function(){t.triggerLang(c)}),window.ga&&window.ga("send","pageview",window.location.pathname+window.location.search)})},t.prototype.i18n=function(){if(!this.options||!this.options.i18n)return!1;if(!this.options.i18n.langs||!this.options.i18n.langs.length)return!1;var t=function(){if(!window.Barba)return!0;var t=$("."+Barba.Pjax.Dom.containerClass),n=window.twttr||!1,e=window.FB||!1,a=window.gapi||!1;n&&n.widgets&&n.widgets.load(t[t.length-1]),e&&e.XFBML&&e.XFBML.parse(t[t.length-1]),a&&a.plusone&&a.plusone.go()},n=this,e=document.documentElement||{};e.lang=e.lang||"en";var a=function(a){n.log("info","Switching Language to "+a),$(document).trigger("musketeer:ready"),n.lang=a,$.jStorage.set("lang",a);var o=$("body");o.hasClass(n.lang)||(o.removeClass(e.lang),e.lang=n.lang,o.addClass(n.lang));var i=n.urlfaker();i!==document.location.href&&window.history&&window.history.pushState&&window.history.pushState(null,null,i);var r=$("#head-"+a);if(r.length){var l=$.parseJSON(r.html()),s=$("head");$("head").find(n.options.barbajs.head).filter(":not( script )").remove();for(var c in l)if(l.hasOwnProperty(c))if(/title/.test(c))document.title=l[c];else for(var g=l[c],h=0,d,u,p=g.length;h<p;h++){u=g[h],d="<"+c;for(var w in u)d+=" "+w+'="'+u[w]+'"';d+=">",s.append(d)}}$.each(n.options.i18n.langs,function(){(a=this.toString())!==n.lang&&o.find(n.options.i18n.selector.replace("%lang",a)).each(function(){var t=$(this);t.length&&(/script/.test((t[0].tagName||"").toLowerCase())||($(this).children().length&&$(this).data("cached",$(this).html()),$(this).empty().css("display","none")))})}),o.find(n.options.i18n.selector.replace("%lang",n.lang)).each(function(){var t=$(this);if(t.length)if(/script/.test((t[0].tagName||"").toLowerCase())){var n=$.parseJSON(t.html());n&&n.id&&n.content&&$("#"+n.id).html(n.content).data("cached",null)}else!t.children().length&&t.data("cached")&&t.html(t.data("cached")).css("display","block").data("cached",null)}),t(),$(document).trigger("musketeer:complete")};if(this.options.i18n.menu){var o=$(this.options.i18n.menu);o.on("click","a",function(t){t.preventDefault(),a($(this).attr("hreflang")||$(this).attr("lang")),o.find(".ui-state-active").removeClass("ui-state-active"),$(this).addClass("ui-state-active")})}var i=[];i=/lang/.test(document.location.href)?document.location.href.match(/lang\=([a-zA-Z_-]+)/):window.location.hash&&window.location.hash.length>1?window.location.hash.match(/\#([a-zA-Z_-]+)/):window.location.pathname.match(/^\/([a-zA-Z_-]+)\//),i&&i.length&&i[1]&&$.inArray(i[1],this.options.i18n.langs)>-1?n.triggerLang(i[1]):a($.jStorage.get("lang",e.lang))},t.prototype.getRemoteData=function(t){var a=this,o=$("[data-remote]"),i=o.length;if(i<1)return t&&"function"==typeof t&&t(),1;o.each(function(){var o=$(this),r=o.attr("id")||!1;if(r){var l=function(a){i--,o.html($(e(a)).find("#"+r).html());var l=$(n(a)).find("script[lang]");l.length&&($("#"+l.attr("id")).remove(),$("head").append(l)),i<1&&t&&"function"==typeof t&&t()},s=function(t){a.log(t.message)};window.Barba?Barba.Utils.xhr(o.attr("data-remote")).then(l,s):$.ajax({url:o.attr("data-remote"),success:l,error:s}),o.removeAttr("data-remote")}else a.log("warn","Missing id attribute on el"+o),o.remove()})},new t});
//# sourceMappingURL=./jquery.musketeer.min.js.map