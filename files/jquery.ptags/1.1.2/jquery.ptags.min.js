/*
 * jQuery Pines Tags (ptags) Plugin 1.1.2
 *
 * http://pinesframework.org/ptags/
 * Copyright (c) 2009-2012 Hunter Perrin
 *
 * Triple license under the GPL, LGPL, and MPL:
 *	  http://www.gnu.org/licenses/gpl.html
 *	  http://www.gnu.org/licenses/lgpl.html
 *	  http://www.mozilla.org/MPL/MPL-1.1.html
 */
(function(b){b.fn.ptags_add=function(b){if(!b)return this;this.each(function(){this.pines_tags&&this.pines_tags.ptags_add(b)});return this};b.fn.ptags_remove=function(b){if(!b)return this;this.each(function(){this.pines_tags&&this.pines_tags.ptags_remove(b)});return this};b.fn.ptags_remove_all=function(){this.each(function(){this.pines_tags&&this.pines_tags.ptags_remove_all()});return this};var f=b.fn.val;b.fn.val=function(b){var g=f.apply(this,arguments);typeof b!="undefined"&&this.each(function(){typeof this.pines_tags!=
"undefined"&&this.pines_tags.ptags_sync_input()});return g};b.fn.ptags=function(f){var g=b.extend({},b.fn.ptags.defaults,f);this.each(function(){var a=b(this);a.ptags_version="1.1.2";if(a.hasClass("ui-ptags-tag-box"))return true;a.addClass("ui-ptags-tag-box");a.extend(a,g);a.ptags_widget=b("<span />");a.ptags_container=b("<span />");a.ptags_tags=a.ptags_tags.slice();a.ptags_add=function(c){b.merge(a.ptags_tags,typeof c=="string"?[c]:c);a.ptags_unique_check();a.ptags_update_val();a.ptags_update_tags()};
a.ptags_remove=function(c){b.each(typeof c=="string"?[c]:c,function(){var c=b.inArray(""+this,a.ptags_tags);c>-1&&a.ptags_tags.splice(c,1)});a.ptags_update_val();a.ptags_update_tags()};a.ptags_remove_all=function(){a.ptags_tags=[];a.ptags_update_val();a.ptags_update_tags()};a.ptags_unique_check=function(){for(var c=0;c<a.ptags_tags.length;c++)if(a.ptags_trim_tags&&(a.ptags_tags[c]=b.trim(a.ptags_tags[c])),b.inArray(a.ptags_tags[c],a.ptags_tags)<c||a.ptags_tags[c].length==0)a.ptags_tags.splice(c,1),
c--};a.ptags_update_val=function(){var b=a.val(),d=a.ptags_tags.join(a.ptags_delimiter);b!=d&&a.val(d).change()};a.ptags_sync_input=function(){var b=a.ptags_tags.join(a.ptags_delimiter),d=a.val();if(d!=b)a.ptags_tags=d.split(a.ptags_delimiter),a.ptags_unique_check(),a.ptags_update_val(),a.ptags_update_tags()};a.ptags_update_tags=function(){a.ptags_show_tags&&(a.ptags_tag_container.empty(),b.each(a.ptags_tags,function(c,f){var e=b("<span />").addClass("ui-state-default ui-corner-all ui-ptags-tag");
e.append(b('<a href="#" />').addClass("ui-ptags-tag-text").html(f).click(function(){if(a.ptags_editable&&a.ptags_input_box){if(a.ptags_noclick)return a.ptags_noclick=false,e.removeClass("ui-state-hover"),false;d.val(e.text()).focus().select();a.ptags_remove(e.text())}return false}));a.ptags_editable&&a.ptags_input_box&&e.hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});a.ptags_remover&&e.children().addClass("ui-ptags-tag-text-icon").end().append(b('<a href="#" />').addClass("ui-ptags-tag-remover ui-icon ui-icon-circle-minus").click(function(){a.ptags_remove(e.text());
return false}));a.ptags_tag_container.append(e)}))};a.ptags_widget.addClass("ui-ptags");a.wrapAll(a.ptags_widget);a.ptags_widget=a.parent();a.ptags_container.addClass("ui-ptags-tag-box-container");a.wrapAll(a.ptags_container);a.ptags_container=a.parent();if(a.ptags_input_box){var d=b(a.get(0)).clone().val("").keydown(function(b){if(b.keyCode==13&&!b.shiftKey)return a.ptags_add(d.val().split(a.ptags_delimiter)),d.val(""),false}).blur(function(){d.val()!=""&&(a.ptags_add(d.val().split(a.ptags_delimiter)),
d.val(""))});d.attr("id")&&d.attr("id",d.attr("id")+"__ptags");d.attr("name")&&d.attr("name",d.attr("name")+"__ptags");a.ptags_container.append(d)}if(a.ptags_current_text){var f=a.val().split(a.ptags_delimiter);b.merge(a.ptags_tags,f);a.ptags_unique_check();a.ptags_update_val()}if(a.ptags_show_tags)a.ptags_tag_container=b("<span />").addClass("ui-ptags-tag-container"),a.ptags_widget.append(a.ptags_tag_container),a.ptags_update_tags();a.change(a.ptags_sync_input);a.ptags_sortable!=false&&a.ptags_tag_container.sortable(a.ptags_sortable).bind("sortupdate",
function(){a.ptags_tags=b.map(a.ptags_tag_container.find("a.ui-ptags-tag-text"),function(a){return b(a).text()});a.ptags_update_val()}).bind("sortstop",function(){a.ptags_noclick=true});a.ptags_show_box||a.css("display","none");this.pines_tags=a});return this};b.fn.ptags.defaults={ptags_tags:[],ptags_current_text:true,ptags_delimiter:",",ptags_trim_tags:true,ptags_show_tags:true,ptags_show_box:false,ptags_input_box:true,ptags_remover:true,ptags_editable:true,ptags_sortable:false}})(jQuery);
