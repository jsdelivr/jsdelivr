!function(e,n,t){"use strict";function i(e){throw new Error("StarchupTracker --- "+e)}function r(){var e=new XMLHttpRequest;return e.open("GET","https://api.ipify.org/",!1),e.send(null),e.responseText}function a(e,t,i){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3);var a="expires="+r.toUTCString();n.cookie=e+"="+t+"; "+a}function o(e){for(var t=e+"=",i=n.cookie.split(";"),r=0;r<i.length;r++){for(var a=i[r];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""}var s="tracker_device_id",c={customerId:null,agentId:null,deviceId:null,access_token:null,cleanerIdentifier:null},d=function(e,n){c.cleanerIdentifier=e;var t=o(s);return t&&t.length>0&&(c.deviceId=t),n&&(c.agentId=n),this},u=function(e,r){r&&r!==t||(r=I),e||i("Missing event");var a=M("utm_source"),o=M("utm_medium"),s=M("utm_campaign"),d=n.referrer;a&&a.length>0?e.utmSource=a:d&&d.length>1&&(e.utmSource=d),o&&a.length>0&&(e.utmMedium=o),s&&a.length>0&&(e.utmCampaign=s),c.agentId&&(e.agentId=c.agentId),c.customerId&&(e.customerId=c.customerId),c.deviceId&&(e.deviceId=c.deviceId),c.deviceId?h("POST","Events",e,r):x(function(n,t){t&&(e.deviceId=t.id),h("POST","Events",e,r)})},p=function(e,n,r,a){a&&a!==t||(a=I),e||n||i("Missing user Id"),r||i("Missing token"),c.deviceId||i("Invalid device"),c.access_token=r,c.customerId=e,c.agentId=n;var o=function(n,t){var i={customerId:e};if(t&&t.length>0){var r=t[0].id;i.deviceId=t[0].deviceId,t.forEach(function(e){e.customerId==c.customerId&&e.agentId==c.agentId&&e.id&&e.deviceId&&e.id!==r&&(e.id>r||(r=e.id,i.deviceId=e.deviceId))})}h("PUT","DeviceData/"+c.deviceId,i,a)};e?v(o):n&&l(o)},g=function(){c.customerId=null,c.deviceId=null,c.access_token=null,a(s,null,0)};d.prototype.trackEvent=u,d.prototype.logIn=p,d.prototype.logOut=g,d.init=d,e.StarchupTracker=d;var I=function(){},f=function(e,n){n&&n!==t||(n=I);var i={where:e};h("GET","DeviceData",i,n)},v=function(e){c.customerId||i("Missing customerId"),f({customerId:c.customerId},e)},l=function(e){c.agentId||i("Missing agentId"),f({agentId:c.agentId},e)},m=function(){var n=e.location.hostname;return e.location.port.length>0&&(n=n.replace(":"+e.location.port,"")),"localhost"===n?"http://dev.starchup.com:3005/api":"dev.starchup.com"===n?"http://dev.starchup.com:3005/api":"stage.starchup.com"===n?"https://stage.starchup.com:3004/api":"https://api.starchup.com:3003/api"},h=function(e,n,r,a){a&&a!==t||(a=I),e||i("Missing method"),n||i("Missing resource"),r||i("Missing data");var o=m(),s=o+"/"+n;c.access_token&&(s=s+"?access_token="+c.access_token);var d=new XMLHttpRequest;d.onreadystatechange=function(){4===this.readyState&&(200!=this.status?a():a(null,JSON.parse(this.responseText)))},d.open(e,s,!0),d.setRequestHeader("Content-type","application/json"),d.send(JSON.stringify(r))},x=function(e){e&&e!==t||(e=I);var n=S();c.customerId&&(n.customerId=c.customerId),c.agentId&&(n.agentId=c.agentId),n.deviceId=O(),n.ip=r(),n.app=c.cleanerIdentifier,h("POST","DeviceData",n,function(n,t){t&&t.id&&(c.deviceId=t.id,a(s,t.id,.5)),e(n,t)})},O=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},M=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),t=n.exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},S=function(){var e,n,t,i=navigator.userAgent,r=navigator.appName,a=""+parseFloat(navigator.appVersion);return-1!=(n=i.indexOf("Opera"))?(r="Opera",a=i.substring(n+6),-1!=(n=i.indexOf("Version"))&&(a=i.substring(n+8))):-1!=(n=i.indexOf("MSIE"))?(r="Microsoft Internet Explorer",a=i.substring(n+5)):-1!=(n=i.indexOf("Chrome"))?(r="Chrome",a=i.substring(n+7)):-1!=(n=i.indexOf("Safari"))?(r="Safari",a=i.substring(n+7),-1!=(n=i.indexOf("Version"))&&(a=i.substring(n+8))):-1!=(n=i.indexOf("Firefox"))?(r="Firefox",a=i.substring(n+8)):(e=i.lastIndexOf(" ")+1)<(n=i.lastIndexOf("/"))&&(r=i.substring(e,n),a=i.substring(n+1),r.toLowerCase()==r.toUpperCase()&&(r=navigator.appName)),-1!=(t=a.indexOf(";"))&&(a=a.substring(0,t)),-1!=(t=a.indexOf(" "))&&(a=a.substring(0,t)),{browser:r,appVersion:a,codeName:navigator.userAgent,os:b()}},b=function(){return-1!=navigator.appVersion.indexOf("Win")?"Windows":-1!=navigator.appVersion.indexOf("Mac")?"MacOS":-1!=navigator.appVersion.indexOf("X11")?"UNIX":-1!=navigator.appVersion.indexOf("Linux")?"Linux":"Unkown"}}(window,document);